id,title,state,created_at,updated_at,closed_at,body,user,url
MDU6SXNzdWUzNzkzNzIxNQ==,no freebayes-parallel,CLOSED,2014-07-15T23:46:36Z,2015-01-31T05:01:05Z,2015-01-31T05:01:05Z,"We are having a look at snippy. 

With exception of perl, bioperl & awk all other binaries appear to be bundled. 

uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/test> make
../bin/snippy --outdir test1 --force --ref example.fna reads_R1.fastq.gz reads_R2.fastq.gz
[09:37:26] This is snippy 1.4
[09:37:26] Written by Torsten Seemann torsten.seemann@monash.edu
[09:37:26] Obtained from http://www.vicbioinformatics.com
[09:37:26] Detected operating system: linux
[09:37:26] Enabling bundled tools in: /work2/UQ/Science/SCMB/Beatson/bin/snippy/1.4/bin/binaries/{linux,noarch}
[09:37:26] Found cp - ok.
[09:37:26] Found rm - ok.
[09:37:26] Found awk - ok.
[09:37:26] Found renice - ok.
[09:37:26] Found bwa - ok.
[09:37:26] Found samtools - ok.
[09:37:26] Found vcfutils.pl - ok.
which: no freebayes-parallel in <SNIP>
</SNIP>
[09:37:26] Can not find 'freebayes-parallel' in PATH
make: **\* [test1] Error 2

uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/binaries> ls *
darwin:
bwa  samtools

linux:
bcftools  bwa  freebayes  samtools  vcfstreamsort  vcfuniq

noarch:
fasta_generate_regions.py  freebayes-parallel  parallel  vcfutils.pl
",mscook,https://github.com/tseemann/snippy/issues/1
MDU6SXNzdWUzNzkzNzM1OQ==,Please provide static executables,CLOSED,2014-07-15T23:49:32Z,2015-02-14T19:58:39Z,2015-02-14T19:58:39Z,"uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/binaries/linux> ./bcftools
./bcftools: /lib64/libz.so.1: no version information available (required by ./bcftools)
./bcftools: /lib64/libc.so.6: version `GLIBC_2.14' not found (required by ./bcftools)
./bcftools: /lib64/libc.so.6: version`GLIBC_2.15' not found (required by ./bcftools)

uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/binaries/linux> ./bwa
./bwa: /lib64/libc.so.6: version `GLIBC_2.14' not found (required by ./bwa)
./bwa: /lib64/libc.so.6: version`GLIBC_2.15' not found (required by ./bwa)

./freebayes: /lib64/libc.so.6: version `GLIBC_2.15' not found (required by ./freebayes)
./freebayes: /lib64/libc.so.6: version`GLIBC_2.14' not found (required by ./freebayes)
./freebayes: /sw/gcc/4.5.2/lib64/gcc/x86_64-suse-linux/4.5.2/libstdc++.so.6: version `GLIBCXX_3.4.15' not found (required by ./freebayes)

uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/binaries/linux> ./samtools
./samtools: error while loading shared libraries: libtinfo.so.5: cannot open shared object file: No such file or directory

uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/binaries/linux> ./vcfstreamsort
./vcfstreamsort: /lib64/libc.so.6: version `GLIBC_2.15' not found (required by ./vcfstreamsort)
./vcfstreamsort: /lib64/libc.so.6: version`GLIBC_2.14' not found (required by ./vcfstreamsort)
./vcfstreamsort: /sw/gcc/4.5.2/lib64/gcc/x86_64-suse-linux/4.5.2/libstdc++.so.6: version `GLIBCXX_3.4.15' not found (required by ./vcfstreamsort)

uqmstan1@barrine2:~/Beatson_shared/bin/snippy/1.4/binaries/linux> ./vcfuniq
./vcfuniq: /lib64/libc.so.6: version `GLIBC_2.15' not found (required by ./vcfuniq)
./vcfuniq: /lib64/libc.so.6: version`GLIBC_2.14' not found (required by ./vcfuniq)
./vcfuniq: /sw/gcc/4.5.2/lib64/gcc/x86_64-suse-linux/4.5.2/libstdc++.so.6: version `GLIBCXX_3.4.15' not found (required by ./vcfuniq)
",mscook,https://github.com/tseemann/snippy/issues/2
MDU6SXNzdWU0MDIwODEwMA==,vcf-consensus option,CLOSED,2014-08-13T22:58:19Z,2015-01-31T04:36:30Z,2015-01-31T04:36:22Z,"It would be useful to have a vcf-consensus option built in:
$ bgzip snps.vcf
$ tabix -p vcf snps.vcf.gz
$ vcf-consensus snps.vcf.gz < ref.fa > new.fa
",kwongj,https://github.com/tseemann/snippy/issues/3
MDU6SXNzdWU0MjIxMTMxOA==,Genome chunking wrong if --ref .gbk,CLOSED,2014-09-08T15:49:32Z,2015-02-14T20:17:41Z,2015-02-14T20:17:41Z,"Uses file size as proxy for genome size. 
This does not work for .gbk --ref files!
",tseemann,https://github.com/tseemann/snippy/issues/4
MDU6SXNzdWU1NzcwNTE1OQ==,Put all the ref.* file in a subdirectory of --outdir for neatness,CLOSED,2015-02-14T20:18:24Z,2015-02-14T22:17:00Z,2015-02-14T22:17:00Z,,tseemann,https://github.com/tseemann/snippy/issues/5
MDU6SXNzdWU1NzcwNTE3Ng==,"Allow --ref to be a GFF3 file, or add --gff option",OPEN,2015-02-14T20:19:06Z,2019-07-08T00:30:51Z,,,tseemann,https://github.com/tseemann/snippy/issues/6
MDU6SXNzdWU1NzcwNTIwMw==,Current version not correctly honouring --minfrac,CLOSED,2015-02-14T20:20:08Z,2015-04-11T08:12:09Z,2015-04-11T08:12:09Z,"Although freebayes -F $minfrac is being used, Erik says that is only a guide to trigger a variant call. For a single sample like ours, it probably works, but not guaranteed?
",tseemann,https://github.com/tseemann/snippy/issues/7
MDU6SXNzdWU1NzcwNTI2Mw==,Parallelize the --report component ,CLOSED,2015-02-14T20:21:56Z,2018-04-29T02:30:57Z,2018-04-29T02:30:54Z,"As advertised, --report is very slow for lots of SNPs.  Use GNU parallel to run in batches.
",tseemann,https://github.com/tseemann/snippy/issues/8
MDU6SXNzdWU1NzcwNTMwMw==,The .csv file is really .tsv,CLOSED,2015-02-14T20:23:15Z,2015-02-14T20:39:58Z,2015-02-14T20:39:58Z,"Perhaps write a .tab file, then also write a true .csv from that using Text::CSV ?
",tseemann,https://github.com/tseemann/snippy/issues/9
MDU6SXNzdWU1NzcwNTM0Ng==,Also write a simple snps.html report,CLOSED,2015-02-14T20:24:38Z,2015-02-14T21:04:58Z,2015-02-14T21:04:58Z,"Might be useful for deploying to websites, in conjunction with the --report in HTML format.
",tseemann,https://github.com/tseemann/snippy/issues/10
MDU6SXNzdWU1NzcwNTQzOQ==,Add a snps.txt report summarizing things,CLOSED,2015-02-14T20:27:29Z,2015-02-14T20:54:04Z,2015-02-14T20:54:04Z,"eg.

```
Ref xxx.gbk
Reads R1.fq R2.fq
SNP 34
MNP 2
INS 4
DEL 7
ReadsAligned 454355
PercentAligned 86.2%
```
",tseemann,https://github.com/tseemann/snippy/issues/11
MDU6SXNzdWU1NzcwNjE4Nw==,Add alignment statistics to .txt output,CLOSED,2015-02-14T20:54:33Z,2015-04-11T07:51:20Z,2015-04-11T07:51:20Z,"From samtools flagstat or samtools stats 
",tseemann,https://github.com/tseemann/snippy/issues/12
MDU6SXNzdWU1NzcwNjIzMA==,Summary .txt clashed with .txt from --report option!,CLOSED,2015-02-14T20:55:52Z,2015-02-14T21:08:32Z,2015-02-14T21:08:32Z,,tseemann,https://github.com/tseemann/snippy/issues/13
MDU6SXNzdWU1NzcwODY1OQ==,Show output files 1 per line at end of log,CLOSED,2015-02-14T22:19:42Z,2015-02-14T22:48:15Z,2015-02-14T22:48:15Z,,tseemann,https://github.com/tseemann/snippy/issues/14
MDU6SXNzdWU1NzcwODY5Mg==,Show amino acid / codon effect when feature is a CDS,CLOSED,2015-02-14T22:20:37Z,2015-10-29T02:09:50Z,2015-10-29T02:09:50Z,"Include in FEATURES column in snps.tab and snps.csv
",tseemann,https://github.com/tseemann/snippy/issues/15
MDU6SXNzdWU1NzcwODcxMw==,Show full path to discovered binaries,CLOSED,2015-02-14T22:21:25Z,2015-04-11T08:09:47Z,2015-04-11T08:09:47Z,"So we can tell which binary actually got used when there could be more than one.
",tseemann,https://github.com/tseemann/snippy/issues/16
MDU6SXNzdWU2NzI4NjkxNA==,snps.aligned.fa has ref ID rather than Isolate in FASTA header,CLOSED,2015-04-09T05:50:40Z,2015-04-11T08:00:41Z,2015-04-11T08:00:41Z,,tseemann,https://github.com/tseemann/snippy/issues/17
MDU6SXNzdWU2NzI4Njk5NQ==,snippy-core too slow with lots of samples,CLOSED,2015-04-09T05:51:14Z,2015-04-11T07:49:58Z,2015-04-11T07:49:58Z,"You can just cat the individual ""snps.aligned.fa"" files dummy!
",tseemann,https://github.com/tseemann/snippy/issues/18
MDU6SXNzdWU2NzczNDIyMQ==,snippy-core,CLOSED,2015-04-11T04:54:56Z,2015-04-11T07:59:01Z,2015-04-11T07:59:01Z,"When entering folder names in command-line for snippy-core, the trailing '/' causes an error with generating the ID, particularly if there are multiple folders with the trailing slash. This allocates multiple samples to have an ID = ' '.
",kwongj,https://github.com/tseemann/snippy/issues/19
MDU6SXNzdWU2Nzc1NDA2OQ==,Consider setting RG ID to --dir rather than --prefix,CLOSED,2015-04-11T08:10:51Z,2018-04-29T02:30:29Z,2018-04-29T02:30:29Z,,tseemann,https://github.com/tseemann/snippy/issues/20
MDU6SXNzdWU2ODI0OTU3MA==,snippy-core should produce a multi-sample VCF,CLOSED,2015-04-14T03:19:38Z,2015-06-07T08:51:39Z,2015-06-07T08:51:39Z,"Combine all the individual ones.
",tseemann,https://github.com/tseemann/snippy/issues/21
MDU6SXNzdWU3MTE0NjQ5OQ==,Output of core genome size for subset of samples,OPEN,2015-04-27T01:24:21Z,2018-04-14T21:41:15Z,,"Hi Torsten

Could snippy/snippy-core please output the number of core genome sites/percentage core shared amongst a group of isolates. Could possibly be added to the core.txt file where all the individual % aligned to reference data is?

Thanks,
Bainesy
",sbaines,https://github.com/tseemann/snippy/issues/22
MDU6SXNzdWU3MTE2Mjg5Mw==,Duplicate ref.fa IDs fails downstream,CLOSED,2015-04-27T03:11:11Z,2015-10-29T02:31:26Z,2015-10-29T02:31:26Z,"Not my fault, samtools faidx doesn't even check. But Freebayes fails. We should check it.
",tseemann,https://github.com/tseemann/snippy/issues/23
MDU6SXNzdWU4MjY3MDM0OA==,MSG: Got a sequence without letters. Could not guess alphabet,CLOSED,2015-05-30T02:31:13Z,2016-07-10T06:47:26Z,2015-06-07T08:51:28Z,"```
[12:30:16] Generating aligned/masked FASTA relative to reference: snps.aligned.fa

--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------

--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------

--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------

--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------

--------------------- WARNING ---------------------
MSG: Got a sequence without letters. Could not guess alphabet
---------------------------------------------------
[12:30:20] Creating extra output files: BED GFF CSV TXT HTML
```
",tseemann,https://github.com/tseemann/snippy/issues/24
MDU6SXNzdWU4MzU3MDQ2Nw==,snippy install on OS X (chapmanb/cbl/vcflib 2015-03-13 did not build),CLOSED,2015-06-01T15:45:35Z,2015-06-06T09:41:22Z,2015-06-06T09:41:22Z,"See downstream report here https://github.com/chapmanb/homebrew-cbl/issues/22.
",gawbul,https://github.com/tseemann/snippy/issues/25
MDU6SXNzdWU4NDM0NDI2NQ==,Freebayes over chunking when reference short,CLOSED,2015-06-03T03:56:16Z,2015-06-07T08:57:27Z,2015-06-07T08:57:27Z,"```
Freebayes will process 256 chunks of 3 bp, 64 chunks at a time.
```

Whoops.
",tseemann,https://github.com/tseemann/snippy/issues/26
MDU6SXNzdWU4NTg3NzUwNQ==,Errors when SNPs hidden in 'complex' variants,CLOSED,2015-06-07T08:50:04Z,2016-09-11T07:18:44Z,2015-06-07T08:51:52Z,"Because we are not joint-calling, we can get variant sites from different isolates which have different SNP types. eg. position 344421 could be 'snp' in isolate1, 'mnp' in 2, and 'complex' in 3 !

We are ignoring 'complex' types.  Need to take them into consideration so we don't get false matches to reference!
",tseemann,https://github.com/tseemann/snippy/issues/27
MDU6SXNzdWU4NTg3NzY1Nw==,Including 'complex' variants introduces monomorphics to nway output,CLOSED,2015-06-07T08:53:00Z,2018-04-07T11:57:25Z,2018-04-07T11:57:25Z,"Need logic to remove monomorphic columns (resulting from 'complex' types where some bases match the reference) so they don't end up in nway.tab.

I don't think they will end up in regular .tab output though.
",tseemann,https://github.com/tseemann/snippy/issues/28
MDU6SXNzdWU5MDczNzIyOQ==,Snippy help for analyzing output,CLOSED,2015-06-24T17:21:50Z,2015-07-05T09:37:25Z,2015-07-05T09:37:25Z,"Hi Seemann,

Greetings for the day!!!

I have just started using the snippy tool for finding snp's from a bacterial genome and i found it really awesome and very fast detection and annotation tool.

I have a few questions:

1) I have used a draft genome as a reference. How confident can i be of the snp's called and annotated?

2) Also this genome has been sequenced on Iontorrent platform. So they are single end reads. Is the tool suitable for this platform.?

3) There is a file called .depth.gz. is it the file that indicated the depth of coverage of snp's called? IS there any other file from which i can take the depth parameters to take into consideration the real snp's?

Thanks in advance,
Ramya.
",ramyag03,https://github.com/tseemann/snippy/issues/29
MDU6SXNzdWU5MzEwNzU0Mg==,SVG::Graph still required,CLOSED,2015-07-05T12:25:10Z,2015-07-07T05:02:00Z,2015-07-07T05:01:40Z,"SVG::GRaph is erroneously required during install via brew.
",Slugger70,https://github.com/tseemann/snippy/issues/30
MDU6SXNzdWUxMDc2OTg4NTQ=,Incorrect numbering/reference nucleotide,CLOSED,2015-09-22T11:51:59Z,2018-10-02T23:32:16Z,2018-10-02T23:32:16Z,"The nucleotide listed as the reference in snps.tab file is not always (or perhaps ever) the correct one for the nucleotide position and codon position listed.
",conmeehan,https://github.com/tseemann/snippy/issues/31
MDU6SXNzdWUxMTE0MDkwMDA=,BGzip included in snippy,CLOSED,2015-10-14T14:21:17Z,2018-04-07T10:00:37Z,2018-04-07T10:00:37Z,"Note,

binary version of BGZIP included with source code is dependent on glibc, with the static compile that is included compiled against glibc 2.14.  Had to recompile from samtools/htseq from my own install of samtools and replace binary.
",scholzmb,https://github.com/tseemann/snippy/issues/32
MDU6SXNzdWUxMTM3OTE0Njc=,Is it possible to have *.aligned.fa with variants?,CLOSED,2015-10-28T10:54:08Z,2018-04-07T10:27:25Z,2018-04-07T10:27:25Z,"Hi Torst.

Would it be possible for .aligned.fa to also include variants (SNPs)? .consensus.fa includes all variants (including indels --- meaning it has a different length from the reference) making it hard to cut using coordinates from the reference.

My idea would be to produce a snps.vcf.gz with SNPs only, and then apply vcf-concensus. Would that work?

Anders.
",andersgs,https://github.com/tseemann/snippy/issues/33
MDU6SXNzdWUxMTM5NzExNTM=,Snippy fails on snpEff when reference is FASTA only,CLOSED,2015-10-29T03:24:56Z,2015-10-29T03:33:19Z,2015-10-29T03:33:19Z,"Because snpEff build doesn't like empty GFF files.
",tseemann,https://github.com/tseemann/snippy/issues/34
MDU6SXNzdWUxMTQ0MDE1MTA=,Missing 13bp deletion due to freebayes -F 0.9  :-/,CLOSED,2015-10-31T10:04:44Z,2015-10-31T10:48:03Z,2015-10-31T10:48:03Z,"NRS384_contig000001       2460777 .       CAGTAGGATACATTG CG      4140.99 .       AB=0;ABP=0;AC=1;AF=1;AN=1;AO=140;CIGAR=1M13D1M;DP=140;DPB=21;DPRA=0;EPP=9.21451;EPPR=0;GTI=0;LEN=13;MEANALT=1;MQM=60;MQMR=0;NS=1;NUMALT=1;ODDS=953.498;PAIRED=1;PAIREDR=0;PAO=17.5;PQA=577.5;PQR=514.5;PRO=15.5;QA=4536;QR=0;RO=0;RPL=86;RPP=18.8931;RPPR=0;RPR=54;RUN=1;SAF=54;SAP=18.8931;SAR=86;SRF=0;SRP=0;SRR=0;TYPE=del GT:DP:RO:QR:AO:QA:GL    1:140:0:0:140:4536:-414.099,0
",tseemann,https://github.com/tseemann/snippy/issues/35
MDU6SXNzdWUxMTU0MzMyNDU=,core.tab headers off,CLOSED,2015-11-06T04:51:21Z,2015-11-09T04:32:13Z,2015-11-09T04:32:05Z,"Currently core.tab has SNP effect (e.g., ""missense_variant c.741C>A p.Asp247Glu"") under the LOCUS_TAG heading.

Anders.
",andersgs,https://github.com/tseemann/snippy/issues/36
MDU6SXNzdWUxMTU4MDg0NjM=,snpEff results are wierd sometimes,CLOSED,2015-11-09T06:28:37Z,2015-11-09T06:32:47Z,2015-11-09T06:32:03Z,"The SNP and AA positions are correct but the amino acids are wrong.
",tseemann,https://github.com/tseemann/snippy/issues/37
MDU6SXNzdWUxMTU4MzM2NTE=,Update docs for --unmapped ,CLOSED,2015-11-09T08:58:27Z,2016-02-11T06:38:02Z,2016-02-11T06:38:02Z,,tseemann,https://github.com/tseemann/snippy/issues/38
MDU6SXNzdWUxMTYyMTQ2OTQ=,allow use of targets file (freebayes -t),CLOSED,2015-11-10T22:15:06Z,2018-04-29T02:30:06Z,2018-04-29T02:30:05Z,"It's useful to restrict the analysis to a list of targets in bed format (freebayes -t flag). I find this more efficient than filtering the vcf by position with tabix, vcftools etc afterwards.
",Perugolate,https://github.com/tseemann/snippy/issues/39
MDU6SXNzdWUxMTkxMTE2Mzg=,"""variant did not have ANN annotation"" in EFFECT field of .tab",CLOSED,2015-11-26T23:50:43Z,2015-11-28T11:50:01Z,2015-11-28T11:50:01Z,"the ""EFFECT"" field of the .tab output contains mostly ""variant did not have ANN annotation"".

snippy v2.9
gbk reference from prokka v1.11

Only ever used snippy with prokka gbk files and never had ""variant did not have ANN annotation"" before. Tried reannotating with prokka but issue presists.
",Perugolate,https://github.com/tseemann/snippy/issues/40
MDU6SXNzdWUxMTkzMjgxODE=,Exception: Unable to read reference sequence base past end of current cached sequence.,CLOSED,2015-11-29T01:12:14Z,2018-04-07T11:58:01Z,2018-04-07T11:58:00Z,"In one of my projects with 100's of samples, the total size of the snippy output directories was > 20X larger than expected. I realised that the log files are each filled with ~25000-160000 instances of:

> Exception: Unable to read reference sequence base past end of current cached sequence.

e.g.

> Exception: Unable to read reference sequence base past end of current cached sequence.
> jla513_unpol:36
> 35-336
> alignment: AATTTCATAACATCAACTAGGGTTTGGTCCGAAGCATACGTGTTTACAATGTTCGAACAACTTATACAGTTCTTATACATACTTTATAAATTATTTCCCAAACTGTTTTGATACACTCACTAACAGATACTCTATAGAAGGAAAAGTTATCCACTTATGCACATTTATAGTTTTCAGAATTGTGGATAATTAGAAATTACACACAAAGTTATACTATTTTTAGCAACATATTCACAGGTATTTGACATATAGAGAACTGAAAAAGTATAATTGTGTGGATAAGTCGTCCAACTCATGATTT
> currentSequence: CGATTAAAGATAGAAATACACGATGCGAGCAATCAAATTTCATAACATCACCATGAGTTTGGTCCGAAGCATGAGTGTTTACAATGTTCGAACACCTTATACAGTTCTTATACATACTTTATAAATTATTTCCCAAACTGTTTTGATACACTCACTAACAGATACTCTATAGAAGGAAAAGTTATCCACTTATGCACATTTATAGTTTTCAGAATTGTGGATAATTAGAAATTACACACAAAGTTATACTATTTTTAGCAACATATTCACAGGTATTTGACATATAGAGAACTGAAAAAGTATAATTGTGTGGATAAGTCGTCCAACTCATGATT
> currentSequence matching:

This seems to be a known freebayes issue https://github.com/ekg/freebayes/issues/165 and installing v1.0.1 seems to have resolved it for me. The number of SNPs increases with v.1.0.1. Don't know if this is related to the exception or to some other change in freebayes behaviour.
",Perugolate,https://github.com/tseemann/snippy/issues/41
MDU6SXNzdWUxMjAxNjAyOTU=,BAM file as input,CLOSED,2015-12-03T12:28:47Z,2018-04-07T10:28:00Z,2018-04-07T10:28:00Z,"Hi!

Any plans on including BAM format as input to snippy..? It would be convenient a convenient option :)

Best,
Shaman
",shaman-narayanasamy,https://github.com/tseemann/snippy/issues/42
MDU6SXNzdWUxMjEwNDAwODE=,Error when using GBK file,CLOSED,2015-12-08T16:07:25Z,2016-03-31T00:52:38Z,2016-03-31T00:52:38Z,"Thanks for creating this pipeline - it is very useful.  I'm able to get everything to work if I use just a multi-fasta file for a reference, however, I'm getting an error during the snpEff build step if I use a GBK file.  I've tried both an NCBI GBK and one I created manually - both give me the same error  

Here's the error from the log file:

```
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

java.lang.RuntimeException: Error reading file '/Users/ngs/Desktop/Anid_snps/MRB326/reference/./ref/genes.gff'
java.lang.RuntimeException: FATAL ERROR: Offending line (lineNum: 15): 'Chr1    snippy  CDS 1976    1986    .   +   0   ID=AN10814;codon_start=1;locus_tag=AN10814;product=Has domain(s) with predicted oxidoreductase activity and role in metabolic process;protein_id=ncbi:rna_AN10814-1;translation=MRSESSTDVLIVGAGPAGLTTALWLAHTGVQFRIIDKRPNIPRRGQADGLSPRTMEILETFEVAHEVTRLWERATDEMLWCRDAQGNLTRMERFRNQPPQGVRWGHGTLQQGVVEEIMKKKITEVCGVEVEYETTLFELSLDTTKANDPEAFPWSATVRYGTDEPAGQMLSKTMLAKYVVGADGGRSFVRQTMGIEMQGTKGEAVWGVMDIIGTSDFPDDIDGAVDFVRREKDRDAITPESIIVKCEYIIRPYKLYIKEHVWWSAFTVAQRISNSMAVHNRGFLVGDAVHTHSPLCGAGMNTAVQLHRDAYNLGWKLAGVLKHQLNPEILQTYGAERRPVAEALLDADKTILALFHAPLGPEAEALLAKADHIQAYLSGRGIQYRASLLTHGSAEGLRSLAVLPGHCIPDITVQNYMTGRASNLHSWIMADGGWSVIFWASDLSCASRVENIHNCCKQVESIRAKTSSKVGYMLDAFLIHCNEWPSVDLAALPGLFLPPSKYGCLDYGKIFVREETASCKSERMNNLGGIAVVRPDKYVGWVGGLDDMVGLGLYFSKIFL'. File '/Users/ngs/Desktop/Anid_snps/MRB326/reference/./ref/genes.gff' line 15
    'Chr1   snippy  CDS 1976    1986    .   +   0   ID=AN10814;codon_start=1;locus_tag=AN10814;product=Has domain(s) with predicted oxidoreductase activity and role in metabolic process;protein_id=ncbi:rna_AN10814-1;translation=MRSESSTDVLIVGAGPAGLTTALWLAHTGVQFRIIDKRPNIPRRGQADGLSPRTMEILETFEVAHEVTRLWERATDEMLWCRDAQGNLTRMERFRNQPPQGVRWGHGTLQQGVVEEIMKKKITEVCGVEVEYETTLFELSLDTTKANDPEAFPWSATVRYGTDEPAGQMLSKTMLAKYVVGADGGRSFVRQTMGIEMQGTKGEAVWGVMDIIGTSDFPDDIDGAVDFVRREKDRDAITPESIIVKCEYIIRPYKLYIKEHVWWSAFTVAQRISNSMAVHNRGFLVGDAVHTHSPLCGAGMNTAVQLHRDAYNLGWKLAGVLKHQLNPEILQTYGAERRPVAEALLDADKTILALFHAPLGPEAEALLAKADHIQAYLSGRGIQYRASLLTHGSAEGLRSLAVLPGHCIPDITVQNYMTGRASNLHSWIMADGGWSVIFWASDLSCASRVENIHNCCKQVESIRAKTSSKVGYMLDAFLIHCNEWPSVDLAALPGLFLPPSKYGCLDYGKIFVREETASCKSERMNNLGGIAVVRPDKYVGWVGGLDDMVGLGLYFSKIFL'

    at ca.mcgill.mcb.pcingola.snpEffect.factory.SnpEffPredictorFactoryGff.create(SnpEffPredictorFactoryGff.java:132)
    at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEffCmdBuild.createSnpEffPredictor(SnpEffCmdBuild.java:115)
    at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:304)
    at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEff.run(SnpEff.java:883)
    at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEff.main(SnpEff.java:128)
```
",nextgenusfs,https://github.com/tseemann/snippy/issues/43
MDU6SXNzdWUxMjQ4NzM3NjY=,Masking recombinant sites?,CLOSED,2016-01-05T01:08:01Z,2016-02-11T06:39:35Z,2016-02-11T06:39:35Z,"It would be a nice addition to snippy if one could provide a BED file (or a tab separated file with chr start end fields), and have variants that intersect with these regions ignored... Say, for removing recombinant sites.
",andersgs,https://github.com/tseemann/snippy/issues/44
MDU6SXNzdWUxMjk4OTA5Mjc=,fails with samtools 1.3,CLOSED,2016-01-29T21:46:35Z,2016-02-11T06:21:53Z,2016-02-11T06:21:44Z,"Looks like something changed between 1.1 and 1.3 regarding the -T -o options to sort. See the log file below.

```
### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.02 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.84 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.45 sec
[main] Version: 0.7.12-r1039
[main] CMD: bwa index reference/ref.fa
[main] Real time: 1.653 sec; CPU: 1.369 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### (bwa mem  -v 2 -M -R '@RG   ID:snps SM:snps' -t 16 reference/ref.fa /nv/vol46/uvabx/projects/houpt/samara-mtb/snps/ERR027468_1.fastq.gz /nv/vol46/uvabx/projects/houpt/samara-mtb/snps/ERR027468_2.fastq.gz | samtools view -@ 16 -F 3844 -q 60 -S -b -u -T ref.fa - | samtools sort -@ 16 - snps)

[bam_sort] Use -T PREFIX / -o FILE to specify temporary and final output files
Usage: samtools sort [options...] [in.bam]
Options:
  -l INT     Set compression level, from 0 (uncompressed) to 9 (best)
  -m INT     Set maximum memory per thread; suffix K/M/G recognized [768M]
  -n         Sort by read name
  -o FILE    Write final output to FILE rather than standard output
  -T PREFIX  Write temporary files to PREFIX.nnnn.bam
  -@, --threads INT
             Set number of sorting and compression threads [1]
      --input-fmt-option OPT[=VAL]
               Specify a single input file format option in the form
               of OPTION or OPTION=VALUE
  -O, --output-fmt FORMAT[,OPT[=VAL]]...
               Specify output format (SAM, BAM, CRAM)
      --output-fmt-option OPT[=VAL]
               Specify a single output file format option in the form
               of OPTION or OPTION=VALUE
      --reference FILE
               Reference sequence FASTA FILE [null]
[samfaipath] fail to read file ref.fa.
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (314, 741, 1299)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3269)
[M::mem_pestat] mean and std.dev: (885.94, 718.35)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 4254)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (142, 172, 213)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 355)
[M::mem_pestat] mean and std.dev: (179.11, 54.24)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 426)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (622, 1410, 3220)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 8416)
[M::mem_pestat] mean and std.dev: (2037.37, 1944.74)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 11014)
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (386, 721, 1296)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3116)
[M::mem_pestat] mean and std.dev: (864.82, 652.77)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 4026)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_pestat] skip orientation RR
```
",stephenturner,https://github.com/tseemann/snippy/issues/45
MDU6SXNzdWUxMzI4OTk3ODQ=,Allow SNP finding between reference and a contigs file,CLOSED,2016-02-11T06:24:59Z,2016-02-11T06:27:27Z,2016-02-11T06:27:27Z,,tseemann,https://github.com/tseemann/snippy/issues/47
MDU6SXNzdWUxMzMxMTAwNjA=,No docs for --ctgs option,CLOSED,2016-02-11T22:57:49Z,2017-08-31T05:23:44Z,2017-08-31T05:23:44Z,,tseemann,https://github.com/tseemann/snippy/issues/48
MDU6SXNzdWUxMzMxMTAzNDk=,Add --fast option,CLOSED,2016-02-11T22:59:28Z,2018-07-07T07:26:54Z,2018-07-07T07:26:53Z,"Add a filter to only align to the first N reads such that we get approximately `2 * $mincov` coverage of the reference genome.

This will allow most SNPs to be called but greatly speed up both `bwa`, `samtools` and `freebayes`.
",tseemann,https://github.com/tseemann/snippy/issues/49
MDU6SXNzdWUxMzMxMjA3ODM=,Fix coverage of fake reads at contig ends when using --ctgs option,CLOSED,2016-02-11T23:52:11Z,2018-04-07T10:45:22Z,2018-04-07T10:45:19Z,"The ends of contigs get low coverage due to the algorithm used to shredding into reads.

Fix this or the ends of contigs will have issues.
",tseemann,https://github.com/tseemann/snippy/issues/50
MDU6SXNzdWUxMzk0NjU3MDg=,snippy-core error,CLOSED,2016-03-09T03:29:13Z,2016-06-07T05:29:28Z,2016-06-07T05:29:28Z,"Hi Torsten, having issues with snippy-core as follows:
`$snippy-core --prefix core mysnps1 mysnps2 mysnps3`
`""any"" is not exported by the List::Util module
Can't continue after import errors at /mydir/snippy/bin/snippy-core line 5.
BEGIN failed--compilation aborted at /mydir/snippy/bin/snippy-core line 5.`

Perhaps this is a usage/install error but would appreciate help.
",vscooper,https://github.com/tseemann/snippy/issues/51
MDU6SXNzdWUxNDIxNTUwODU=,Use of uninitialized value in join or string at snippy-vcf_to_tab lin e 87,CLOSED,2016-03-20T11:40:59Z,2018-04-07T10:20:59Z,2018-04-07T10:20:59Z,"```
Parsing variants: snps.vcf
Use of uninitialized value in join or string at /home/tseemann/git/snippy/bin/snippy-vcf_to_tab lin
e 87, <VCF> line 353.
```
",tseemann,https://github.com/tseemann/snippy/issues/52
MDU6SXNzdWUxNDI1OTA0MDg=,Add PILON as suggestion of assembly corrector tool,CLOSED,2016-03-22T09:18:25Z,2016-06-07T05:08:29Z,2016-06-07T05:08:29Z,"http://www.broadinstitute.org/software/pilon/
",tseemann,https://github.com/tseemann/snippy/issues/53
MDU6SXNzdWUxNDMyMTYxNTk=,Snippy VCF doesn't put PASS in column 6,CLOSED,2016-03-24T10:58:01Z,2016-06-07T05:20:32Z,2016-06-07T05:20:32Z,"http://www.1000genomes.org/wiki/Analysis/Variant%20Call%20Format/vcf-variant-call-format-version-40
",tseemann,https://github.com/tseemann/snippy/issues/54
MDU6SXNzdWUxNDMyNjk4MDY=,Monomorphs appearing in snippy-core nway.tab,CLOSED,2016-03-24T15:00:50Z,2018-04-07T12:58:39Z,2018-04-07T12:58:39Z,"Occuring for bases between SNPs in MNPs and COMPLEX :-(

```
NC_000962 105007 C C C C C C C C G C G Rv0095c  hypothetical protein missense_variant c.205_209delCTGAGinsTTGAC p.LeuSer69LeuThr
NC_000962 105008 T T T T T T T T T T T Rv0095c  hypothetical protein missense_variant c.205_209delCTGAGinsTTGAC p.LeuSer69LeuThr
NC_000962 105009 C C C C C C C C C C C Rv0095c  hypothetical protein missense_variant c.205_209delCTGAGinsTTGAC p.LeuSer69LeuThr
NC_000962 105010 A A A A A A A A A A A Rv0095c  hypothetical protein missense_variant c.205_209delCTGAGinsTTGAC p.LeuSer69LeuThr
```
",tseemann,https://github.com/tseemann/snippy/issues/55
MDU6SXNzdWUxNDUzMDQwOTc=,Error in bwa step,CLOSED,2016-04-01T22:54:12Z,2017-07-25T00:33:20Z,2016-04-02T01:13:33Z,"I can't get the bwa step to proceed. When it starts running the bwa mem command it returns an error ('Error running command, check snps.log'). It happens when I use fasta or gbk (prokka 1.12 output) as reference input. 

[samfaipath] fail to read file ref.fa.
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat](25, 50, 75) percentile: (465, 499, 533)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (329, 669)
[M::mem_pestat] mean and std.dev: (498.91, 49.88)
[M::mem_pestat] low and high boundaries for proper pairs: (261, 737)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs

I tried searching for the error message ('skip orientation RF/RR...') but google hits tell me it's not even an error message at all. I wonder if anyone has encountered this before? 

For other types of gbk reference (RefSeq or GenBank) I've tried to use it returns a different error early in the run
(""[bwa_index] Pack FASTA... [bns_fasta2bntseq] Failed to allocate 0 bytes at bntseq.c line 303: Success"").

I remember I've tried snippy about a month ago (same version, 2.9) I got it to work but only with a fasta reference. Now it's not working even with that anymore.
",ADGM,https://github.com/tseemann/snippy/issues/56
MDU6SXNzdWUxNDU4MTU4ODI=,Set --mincov to 1 when using --ctgs,CLOSED,2016-04-04T21:55:54Z,2018-04-07T10:05:58Z,2018-04-07T10:05:58Z,"This will resolve #50 too, and you could probably use less coverage.

Not sure how well BWA MEM would align 10 kbp reads?
",tseemann,https://github.com/tseemann/snippy/issues/57
MDU6SXNzdWUxNDU4NjI0Mzc=,Don't chunk genome when --cpus 1 for freebayes-parallel,CLOSED,2016-04-05T02:09:50Z,2018-04-07T10:09:51Z,2018-04-07T10:09:51Z,,tseemann,https://github.com/tseemann/snippy/issues/58
MDU6SXNzdWUxNDU5MjA1NDk=,Put original command line in snps.log,CLOSED,2016-04-05T07:58:47Z,2017-08-31T06:43:48Z,2017-08-31T06:43:48Z,,tseemann,https://github.com/tseemann/snippy/issues/59
MDU6SXNzdWUxNDU5MjI2Nzk=,Revamp --unmapped output files to support 'samtools fastq' in 1.3,CLOSED,2016-04-05T08:08:46Z,2018-04-07T09:58:15Z,2018-04-07T09:58:10Z,"Can probably skip the `view | bam2fq` and use this directly!

```
Usage: samtools fastq [options...] <in.bam>
Options:
  -0 FILE   write paired reads flagged both or neither READ1 and READ2 to FILE
  -1 FILE   write paired reads flagged READ1 to FILE
  -2 FILE   write paired reads flagged READ2 to FILE
  -f INT    only include reads with all bits set in INT set in FLAG [0]
  -F INT    only include reads with none of the bits set in INT set in FLAG [0]
  -n        don't append /1 and /2 to the read name
  -O        output quality in the OQ tag if present
  -s FILE   write singleton reads to FILE [assume single-end]
  -t        copy RG, BC and QT tags to the FASTQ header line
  -v INT    default quality score if not given in file [1]
      --input-fmt-option OPT[=VAL]
               Specify a single input file format option in the form
               of OPTION or OPTION=VALUE
      --reference FILE
               Reference sequence FASTA FILE [null]
```
",tseemann,https://github.com/tseemann/snippy/issues/60
MDU6SXNzdWUxNDcyMDgwODA=,Bundled samtools requires libncurses.so.6,CLOSED,2016-04-10T09:03:45Z,2016-05-21T23:47:10Z,2016-05-21T23:47:10Z,"on my system (Ubuntu 14.04) the bundled samtools won't run due to missing libncursesw.so.6

From what I can see Ubuntu 14.04 still bundles ncurses5

Can work around by downloading ncurses6 from GNU website and building and adding to LD_LIBRARY_PATH

./configure --prefix=`pwd`/install --with-shared --enable-widec
export LD_LIBRARY_PATH=`pwd`/install/lib

Might be good to bundle that library, or drop it from samtools build, or build with v5 instead.
",nickloman,https://github.com/tseemann/snippy/issues/61
MDU6SXNzdWUxNDcyMDgzMDQ=,Bundled freebayes needs specific GLIBC version,CLOSED,2016-04-10T09:09:39Z,2016-05-21T23:46:07Z,2016-05-21T23:46:07Z,"Ubuntu 14.04 again

freebayes: relocation error: freebayes: symbol _ZTVNSt7__cxx1119basic_istringstreamIcSt11char_traitsIcE
SaIcEEE, version GLIBCXX_3.4.21 not defined in file libstdc++.so.6 with link time reference

I can't be bothered to fix this so I will build freebayes from source

Maybe the bundled bins should use static libraries?
",nickloman,https://github.com/tseemann/snippy/issues/62
MDU6SXNzdWUxNDc2ODE5NjE=,No bam file produced with samtools 1.1 or 1.2,CLOSED,2016-04-12T08:55:36Z,2017-08-31T06:21:48Z,2017-08-31T06:21:48Z,"I recently installed snippy-3.0 on a cluster and found that I had to use samtools 1.3 to get a bam-file to be produced. I had previously tried using samtools 1.1 and 1.2.
",mattbawn,https://github.com/tseemann/snippy/issues/64
MDU6SXNzdWUxNTA4MjYyNzI=,SnpEff annotation uses locus_tag rather than gene,CLOSED,2016-04-25T11:17:34Z,2017-08-31T06:19:40Z,2017-08-31T06:19:40Z,"When annotating SNPs using a GenBank format reference genome, the CDS ""gene"" tags are ignored, and the SNPs are annotated using the ""locus_tag"". This means that the VCF annotations contain only systematic gene IDs rather than human-readable gene names.
",RoyChaudhuri,https://github.com/tseemann/snippy/issues/65
MDU6SXNzdWUxNTQ3NDEzMzc=,"vcflib (vcfuniq) on Mac OSX, compilation error??",CLOSED,2016-05-13T15:39:43Z,2016-05-21T23:43:37Z,2016-05-21T23:43:37Z,"Hi Torsten,

So snippy appears to be working correctly, however, by chance I was interested in looking at the options of `vcfuniq` and seeing what it was doing.  I don't know if this is problematic or not, but when I try to run `vcfuniq` from the command line I get the following:

```
ngs@ngs-mac-pro:~$ vcfuniq -h
libc++abi.dylib: terminating with uncaught exception of type std::out_of_range: basic_string
Abort trap: 6
```

If I run it with any other flag I get the same response, no input and nothing seems to happen (it just runs as perhaps it is expecting something from STDIN?).

So I'm concerned that perhaps it isn't installed correctly and not doing what it is suppose to be doing?  As I said, snippy appears to run to completion and I don't get any error messages.  I'm on Mac 10.10 and have installed snippy using home-brew.

Should I be concerned?

Thanks,
Jon
",nextgenusfs,https://github.com/tseemann/snippy/issues/67
MDU6SXNzdWUxNTYxMzIxODM=,README: Quick Start: commands typo,CLOSED,2016-05-22T03:03:27Z,2016-05-22T03:12:35Z,2016-05-22T03:12:25Z,"--R1 and --R1 are listed instead of --R1 and --R2
",AnnaSyme,https://github.com/tseemann/snippy/issues/68
MDU6SXNzdWUxNTg4MzU1NDE=,Fails when --ref is GBK but has wierd file ext like '.dat',CLOSED,2016-06-07T04:24:21Z,2016-06-07T04:26:09Z,2016-06-07T04:26:09Z,"This happens in Galaxy.
",tseemann,https://github.com/tseemann/snippy/issues/69
MDU6SXNzdWUxNTk4NjgyNzQ=,Add snpEff result to snps.gff,OPEN,2016-06-13T03:39:12Z,2016-06-13T03:39:12Z,,"via @AnnaSyme
",tseemann,https://github.com/tseemann/snippy/issues/70
MDU6SXNzdWUxNjA2MzkzMzQ=,Snippy instalation Error :,CLOSED,2016-06-16T11:29:21Z,2016-09-11T07:40:40Z,2016-09-11T07:40:40Z,"$brew install snippy
Last 15 lines from /home/.cache/Homebrew/Logs/freebayes/02.make:
/usr/include/c++/6/bits/stl_pair.h:425:5: note: candidate: template<class _T1, class _T2> constexpr std::pair<typename std::__decay_and_strip<_Tp>::__type, typename std::__decay_and_strip<_T2>::__type> std::make_pair(_T1&&, _T2&&)
     make_pair(_T1&& __x, _T2&& __y)
     ^~~~~~~~~
/usr/include/c++/6/bits/stl_pair.h:425:5: note:   template argument deduction/substitution failed:
/tmp/freebayes-20160616-14946-1v8a66c/bamtools/src/toolkit/bamtools_resolve.cpp:1051:70: note:   cannot convert â€˜rg.BamTools::SamReadGroup::IDâ€™ (type â€˜const string {aka const std::__cxx11::basic_string<char>}â€™) to type â€˜std::__cxx11::basic_string<char>&&â€™
         m_readGroups.insert( make_pair<string, ReadGroupResolver>(rg.ID, ReadGroupResolver()) );
                                                                   ~~~^~
src/toolkit/CMakeFiles/bamtools_cmd.dir/build.make:257: recipe for target 'src/toolkit/CMakeFiles/bamtools_cmd.dir/bamtools_resolve.cpp.o' failed
make[2]: **\* [src/toolkit/CMakeFiles/bamtools_cmd.dir/bamtools_resolve.cpp.o] Error 1
make[2]: Leaving directory '/tmp/freebayes-20160616-14946-1v8a66c/bamtools/build'
CMakeFiles/Makefile2:523: recipe for target 'src/toolkit/CMakeFiles/bamtools_cmd.dir/all' failed
make[1]: **\* [src/toolkit/CMakeFiles/bamtools_cmd.dir/all] Error 2
make[1]: Leaving directory '/tmp/freebayes-20160616-14946-1v8a66c/bamtools/build'
Makefile:130: recipe for target 'all' failed
make: **\* [all] Error 2

READ THIS: https://github.com/Linuxbrew/brew/blob/master/share/doc/homebrew/Troubleshooting.md#troubleshooting
If reporting this issue please do so at (not Homebrew/brew):
  https://github.com/chapmanb/homebrew-cbl/issues
",hirenbioinfo,https://github.com/tseemann/snippy/issues/71
MDU6SXNzdWUxNjA2NjQwNjY=,snpeff build stackoverflow error,CLOSED,2016-06-16T13:39:15Z,2017-08-31T05:29:25Z,2017-08-31T05:29:25Z,"I'm getting a stackoverflow error at the snpeff build step.  
My reference file is the Mycobacterium tuberculosis complete genome in genbank (full) format (downloaded from http://www.ncbi.nlm.nih.gov/nuccore/448814763?report=genbank).  

Works fine when I use the fasta as a reference, but  I'd like to get the annotation information from using the genbank reference.

My original command was:
snippy --cpus 16 --outdir testgb_snps --ref Myc_tub_H37Rv_NC_000962.gb --pe1 136MDR_S6_R1.fq.gz --pe2 136MDR_S6_R2.fq.gz

The command that threw the error was:
snpEff build -c reference/snpeff.config -dataDir . -gff3 ref
java.lang.StackOverflowError
        at java.lang.Character.toLowerCase(Character.java:6338)
        at java.lang.Character.toLowerCase(Character.java:6309)
        at java.lang.String.toLowerCase(String.java:2581)
        at java.lang.String.toLowerCase(String.java:2670)
        at ca.mcgill.mcb.pcingola.interval.GffMarker.hasAttr(GffMarker.java:207)
etc.

Software versions:
snippy 3.1
snpeff 4.2
java 1.8.0_91
bwa 0.7.12
samtools 1.3

Any advice would be appreciated.
",afkoeppel,https://github.com/tseemann/snippy/issues/72
MDU6SXNzdWUxNjA2OTgwMDc=,Snippy-core problem,CLOSED,2016-06-16T15:59:19Z,2017-08-01T08:55:14Z,2017-08-01T08:55:14Z,"Hello,

I am analyzing some bacterial strains. I ran snippy and then ran snippy-core to see the snp-core. 
The problem is when i ran snippy-core with all my data i get 700 core snp but when i ran with a subset of my data i get a less quantity of core snp. When i use others subsets of data i get a higher quantity of 700 core snp.

I would think with a less quantity of data i get a higher quantity of core snp?

Best Regards
",FelipeMelis,https://github.com/tseemann/snippy/issues/73
MDU6SXNzdWUxNjY1OTU3NzU=,"Add post-analysis script for SNP density plots, SNP pairwsie distance plots",CLOSED,2016-07-20T14:30:38Z,2017-08-31T05:27:27Z,2017-08-31T05:27:27Z,"Hey Torst,

How hard would it be to add an extra script that takes a list of snippy output filenames and produces Nullarbor-esque plots, i.e. Pairwise core SNP distances and Core SNP density?

This would definitely save a lot of duplication of effort, as these are common post-SNP call analysis steps.

No worries if it's a hassle.

Ta,

Phil
",flashton2003,https://github.com/tseemann/snippy/issues/74
MDU6SXNzdWUxNjc1Nzk5NTg=,snpEff stack overflow build command,CLOSED,2016-07-26T11:00:25Z,2020-09-17T01:30:16Z,2017-08-01T08:50:35Z,"Hi Torsten,

I am getting the following error when I run snippy 3.0:
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

java.lang.StackOverflowError
    at java.lang.Character.toLowerCase(Character.java:6338)
    at java.lang.Character.toLowerCase(Character.java:6309)
    at java.lang.String.toLowerCase(String.java:2581)
    at java.lang.String.toLowerCase(String.java:2670)
    at ca.mcgill.mcb.pcingola.interval.GffMarker.hasAttr(GffMarker.java:207)
    at ca.mcgill.mcb.pcingola.interval.GffMarker.getGffParentId(GffMarker.java:135)
    at ca.mcgill.mcb.pcingola.interval.GffMarker.getGeneId(GffMarker.java:119)
    at ca.mcgill.mcb.pcingola.interval.GffMarker.getGffParentId(GffMarker.java:140)

And the last 2 lines repeat over and over. Any idea what is going on here? 

Thanks in advance for the help.

Conor
",conmeehan,https://github.com/tseemann/snippy/issues/75
MDU6SXNzdWUxNjgxMTQyNTE=,Use of uninitialized value $header,CLOSED,2016-07-28T14:46:32Z,2017-08-01T08:58:54Z,2017-08-01T08:58:54Z,"```
[sisadmin@centos-nullarbor` genometrackr]$ nice make -j 1 -C /home/sisadmin/genometrackr/nullarborjb
make: Entering directory `/home/sisadmin/genometrackr/nullarborjb'
mkdir -p SRR1207440
mkdir -p SRR1207460
mkdir -p SRR1207461
mkdir -p SRR1207468
mkdir -p SRR1207483
mkdir -p SRR1207515
snippy-core SRR1207440/SRR1207440 SRR1207460/SRR1207460 SRR1207461/SRR1207461 SRR1207468/SRR1207468 SRR1207483/SRR1207483 SRR1207515/SRR1207515
[15:31:38] Loading Snippy folders
[15:31:38] Using ID 'SRR1207440' for SRR1207440/SRR1207440
Use of uninitialized value $header in pattern match (m//) at /home/sisadmin/.linuxbrew/bin/snippy-core line 215.
Use of uninitialized value $header in concatenation (.) or string at /home/sisadmin/.linuxbrew/bin/snippy-core line 215.
[15:31:38] Unexpected header in SRR1207440/SRR1207440/snps.tab: 
make: *** [core.aln] Error 255
make: Leaving directory `/home/sisadmin/genometrackr/nullarborjb
```
",jb2cool,https://github.com/tseemann/snippy/issues/76
MDU6SXNzdWUxNzE2MjM4NTU=,Possible for snippy-core to use --minfrac when outputting core snp alignments?,CLOSED,2016-08-17T10:23:48Z,2018-04-07T10:05:34Z,2018-04-07T10:05:34Z,"Having used --minfrac for my snp calling, I would like to generate a core alignment and core vcf that only contains snps/variants above my minimum fraction.  I guess I could combine the .aligned.fa files (or consensus.subs.fa), but it would be nice if snippy-core could do that automatically.  Cheers.
",matbeale,https://github.com/tseemann/snippy/issues/77
MDU6SXNzdWUxNzcxNDk3MTM=,Error reading file ,CLOSED,2016-09-15T11:13:58Z,2017-08-02T11:23:31Z,2017-08-01T08:56:52Z,"Hi, Torsten
Below is the error message in snps.log 
`java.lang.RuntimeException: Error reading file '/home/ubuntu/ResearchProject/Snippy/Wildtype/Wildtype_snps/reference/./ref/genes.gff'
java.lang.StringIndexOutOfBoundsException: String index out of range: -2024846
        at ca.mcgill.mcb.pcingola.snpEffect.factory.SnpEffPredictorFactoryGff.create(SnpEffPredictorFactoryGff.java:132)
        at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEffCmdBuild.createSnpEffPredictor(SnpEffCmdBuild.java:115)
        at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:304)
        at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEff.run(SnpEff.java:883)
        at ca.mcgill.mcb.pcingola.snpEffect.commandLine.SnpEff.main(SnpEff.java:128)` 

I was trying to fix the problem by looking into the scripts but still can't able to solved it.
",YiwenZhou,https://github.com/tseemann/snippy/issues/78
MDU6SXNzdWUxODkyNzc5MTM=,Freebayes Invalid Option,CLOSED,2016-11-15T01:50:52Z,2017-08-01T08:45:10Z,2017-08-01T08:45:10Z,"Hi Torsten,

Not sure what I am doing wrong but I keep getting an invalid option error during the freebayes-parallel step. I've tried using different references (in fasta and gbk format) and cpu count and still getting the error. 

See attached log.
[snps.txt](https://github.com/tseemann/snippy/files/590920/snps.txt)

",CNoune,https://github.com/tseemann/snippy/issues/79
MDU6SXNzdWUxOTI0Nzk0Mjg=,Bioconda Snippy,CLOSED,2016-11-30T05:32:58Z,2017-07-11T08:33:39Z,2017-07-11T08:33:39Z,"Hi Torsten,

thanks for making Snippy available on Bioconda. I ran into a few issues when installing into a virtual-env running Python 3.5:

```bash
conda create -n snippy-test python=3.5
source activate snippy-test
conda install -c=bioconda snippy
```

1. Bioperl could not find SeqIO. Although the folder `Bio` was present in `.../envs/snippy-test/lib/perl5/site_perl/5.22.0/Bio`, the module was not present. Conda installs BioPerl-1.6.924. I replaced the entire folder with the `Bio` directory in [BioPerl-1.007001](http://search.cpan.org/dist/BioPerl/Bio/SeqIO.pm) and this fixed it.

2. When Snippy is installed into the virual-env, the `freebayes-parallel` script is located in `.../envs/snippy-test/bin` but points to `../vcflib/scripts/vcffirstheader` and `../vcflib/bin/vcfstreamsort` which it can't find. I copied `.../envs/snippy-test/binaries/noarch/vcffirstheader` to `.../envs/snippy-test/bin` where `vcfstreamsort` was also located and replaced the references in `freebayes-parallel` with simply `vcfstreamsort` and `vcffirstheader`. This fixed it.

3. `vcffirstheader` starts with `!#/usr/bin/python` which in my case points to Python 3 so replaced it with `!#/usr/bin/python2`

This is all a bit dodgy from my side - are there any better solutions to this or would you be able to make it work right from Bioconda?

Many thanks!



",esteinig,https://github.com/tseemann/snippy/issues/80
MDU6SXNzdWUyMDA0NDkzNDM=,Vcf.pm,CLOSED,2017-01-12T18:52:28Z,2017-08-01T08:46:16Z,2017-08-01T08:46:16Z,"I installed Snippy 3.1 through linuxbrew (thanks for making this option available)!
 One initial problem was that Vcf.pm wasnt avaialble in @INC.  I fixed it by exporting the module:

export PERL5LIB=<PATHTO>/.linuxbrew/Cellar/snippy/3.1/perl5",plasmid02,https://github.com/tseemann/snippy/issues/81
MDU6SXNzdWUyMDA0NTAwOTE=,multiple references,CLOSED,2017-01-12T18:55:56Z,2023-06-08T16:40:38Z,2017-08-01T08:48:14Z,"What is the way to specify multiple annotated reference molecules in the --ref command(e.g GBK files of chromosome and plasmids)?  Missed it when I was looking through the documentation.

Thanks!",plasmid02,https://github.com/tseemann/snippy/issues/82
MDU6SXNzdWUyMDY1MzA3Mzc=,Filter by quality score,CLOSED,2017-02-09T15:08:35Z,2017-08-31T06:16:04Z,2017-08-31T06:16:04Z,"Hi Torsten,

First off, thanks for all the tools you have created...I use them daily! So far Snippy has been great, but I was curious if there was any way to filter the bwa reads by quality score (eg. -q 31) so that only high quality mapped reads are included in the variant call process. Any elaboration on the current quality threshold would be helpful!

Thanks again,
Ryan",ryjohnson09,https://github.com/tseemann/snippy/issues/83
MDU6SXNzdWUyMDY3MDQyMTE=,In `snippy-core` what does the option `--mincov=i      Minimum depth of coverage to consider core (default '10').` do?,CLOSED,2017-02-10T04:09:27Z,2017-02-14T06:24:54Z,2017-02-14T06:24:54Z,"I checked the code, and it doesn't seem to be used at all.

A.",andersgs,https://github.com/tseemann/snippy/issues/84
MDU6SXNzdWUyMTE0MjY1ODk=,SNP calling more than  --minfrac 0.9,CLOSED,2017-03-02T15:34:52Z,2017-03-02T21:50:56Z,2017-03-02T21:50:56Z,"Hi Torsten 

We have been testing some bacterial isolate stabilities with ngs. I used the starting point isolates as the references from fastq to fasta. After the SNPs were identified, I inspected the short reads aligned to the reference for some of the SNPs with the Tablet. There were 3 positions where the calls were less than 90%. Position A: the reference was a G, short reads 34 Ts and 12 Gs; Position B: the reference was an A, short reads 28 Cs and 12 As; Position C: the reference was a T, short reads 25 Ts and 12 Cs. I have to say this is the first time I have seen this. So my question is whether I can change --minfrac to improve my SNP calling as by default, Snippy should only call a SNP when more than 90% bases differ with the reference?

Many thanks,
Yue",aphayt,https://github.com/tseemann/snippy/issues/85
MDU6SXNzdWUyMTE5ODE4ODQ=,error with gbk ,CLOSED,2017-03-05T20:41:20Z,2019-10-09T15:39:45Z,2017-04-05T04:44:12Z,"Hello everybody
I used snippy with the NCBI gbk file not working, I got the following error;

[20:33:15] Running: samtools faidx reference / ref.fa 2 >> snps.log
[20:33:15] Running: bwa index reference / ref.fa 2 >> snps.log
[20:33:16] Running: mkdir reference / genomes && cp -f reference / ref.fa reference / genomes / ref.fa 2 >> snps.log
[20:33:16] Running: mkdir reference / ref && bgzip -c reference / ref.gff> reference / ref / genes.gff.gz 2 >> snps.log
[20:33:16] Running: snpEff build -c reference / snpeff.config -dataDir. -gff3 ref 2 >> snps.log
[20:33:16] Error running command, check /home/user/Bureau/AB15/ABE8snp1l/snps.log

But when I use fatsa format the command works it but I need to use .gbk format to annotate the bacterial genome variation",gosalone,https://github.com/tseemann/snippy/issues/86
MDU6SXNzdWUyMTc0NjkyNTc=,snpEff cracks it at bare RBS ,CLOSED,2017-03-28T07:21:26Z,2017-08-31T02:57:21Z,2017-08-31T02:57:21Z,"From Dieter:

```
NC_003197.gbk

     RBS             325..330                                                                                                                            gene            337..2799

NC_003197       snippy  RBS     325     330     .       +       0

java.lang.RuntimeException: Error reading file '/home/dbulach/Bacteria/Salmonella/Typhimurium/LT2/DT135_2014-11823/DT135_2014-11823/reference/./ref/genes.gff'
java.lang.RuntimeException: FATAL ERROR: Offending line (lineNum: 3): 'NC_003197        snippy  RBS     325     330     .       +       0       '. File '/home/dbulach/Bacteria/Salmonella/Typhimurium/LT2/DT135_2014-11823/DT135_2014-11823/reference/./ref/genes.gff' line 3
        'NC_003197      snippy  RBS     325     330     .       +       0       '

        at org.snpeff.snpEffect.factory.SnpEffPredictorFactoryGff.create(SnpEffPredictorFactoryGff.java:353)
```
",tseemann,https://github.com/tseemann/snippy/issues/87
MDU6SXNzdWUyMTk0MzgzNDk=,Ran into the following will trying to run snippy with --cleanup,CLOSED,2017-04-05T01:38:44Z,2017-04-05T04:21:15Z,2017-04-05T04:21:15Z,"```
[11:35:49] Removing folder: reference
cannot unlink file for reference/.nfs00000009a20b002b00005433: Device or resource busy at /home/tseemann/git/snippy/bin/snippy line 386.
cannot restore permissions to 0100644 for reference/.nfs00000009a20b002b00005433: Device or resource busy at /home/tseemann/git/snippy/bin/snippy line 386.
cannot remove directory for reference: Directory not empty at /home/tseemann/git/snippy/bin/snippy line 386.
```

And, `reference` folder continues to exist... Odd...",andersgs,https://github.com/tseemann/snippy/issues/88
MDU6SXNzdWUyMTk3NTY0NzI=,snps.depth.gz does not have the same number of rows as bases in the reference,CLOSED,2017-04-06T00:50:50Z,2017-08-31T03:08:31Z,2017-08-31T03:08:31Z,"Need to use `samtools depth -aa`.

A.

",andersgs,https://github.com/tseemann/snippy/issues/89
MDU6SXNzdWUyMTk3ODE2Njk=,Reference with IUPAC codes fails at vcf-consensus,CLOSED,2017-04-06T04:11:54Z,2017-08-31T02:54:19Z,2017-08-31T02:54:19Z,"eg. E.coli CFT073

```
### vcf-consensus snps.vcf.gz < reference/ref.fa > snps.consensus.fa

The fasta sequence does not match the REF at gi|26111730|gb|AE014075.1|:136590. TGGYGCGS(GGYGCGSCAGCTC) in .fa, TGGNGCGN in .vcf, frz=136567
 at /home/linuxbrew/.linuxbrew/Cellar/vcftools/0.1.14_1/libexec/bin/vcf-consensus line 18, <__ANONIO__> line 867.
        main::error(""The fasta sequence does not match the REF at gi|26111730|gb|A""...) called at /home/linuxbrew/.linuxbrew/Cellar/vcftools/0.1.14_1/libexec/bin/vcf-consensus line 260
        main::apply_variant(HASH(0x9e0a68), ARRAY(0xa0b888)) called at /home/linuxbrew/.linuxbrew/Cellar/vcftools/0.1.14_1/libexec/bin/vcf-consensus line 144
        main::do_consensus(HASH(0x9e0a68)) called at /home/linuxbrew/.linuxbrew/Cellar/vcftools/0.1.14_1/libexec/bin/vcf-consensus line 9

```
",tseemann,https://github.com/tseemann/snippy/issues/90
MDU6SXNzdWUyMjAyMTEzNTE=,snippy > snps.txt VS snippy-core > core.tab,CLOSED,2017-04-07T13:18:54Z,2017-08-01T08:33:36Z,2017-08-01T08:33:36Z,"Hi Torsten. 
I notice that the number of SNPs summarized in the output file snps.txt, located in the folder produced by snippy, shows a snps number that sometime is different by that shown in the output file.tab produced by snippy-core.
Could you explain me why?  
Thanks a lot
BW
Federica",fedex88,https://github.com/tseemann/snippy/issues/91
MDU6SXNzdWUyMjI5NDYxMDM=,Low frequency SNPs,CLOSED,2017-04-20T04:26:55Z,2018-04-07T10:02:18Z,2018-04-07T10:02:18Z,"Hi Torsten,

I am working with some isolates that present mutations only in 50% and 40% of the reads but I don't detect them by using snippy. If I run snippy with the options --mincov 5 and --minfrac going up to 0.2 I still don't pick up this mutations. What else I can change in the parameters to be able to detect these cases.

Thanks,

Elena",elenamd,https://github.com/tseemann/snippy/issues/92
MDU6SXNzdWUyMzM5NzM0OTY=,bwa error,CLOSED,2017-06-06T17:53:29Z,2017-07-11T08:34:23Z,2017-07-11T08:34:23Z,"### bwa index reference/ref.fa

[bwa_index] Pack FASTA... [bns_fasta2bntseq] Failed to allocate 0 bytes at bntseq.c line 303: Success",roshni-b,https://github.com/tseemann/snippy/issues/93
MDU6SXNzdWUyMzY3NTUwOTk=,"Impact of ""Warning Got a sequence without letters. Could not guess alphabet""   ; issue #24  ?",CLOSED,2017-06-19T00:18:53Z,2018-04-03T12:55:43Z,2018-04-01T12:06:06Z,"Hi,

I'm running snippy v3.2 and I also get the above message even though snippy runs to completion.
Is there any impact on snippy's output or is this just a warning that something is off?

Otherwise I'm not sure I understand what your fix was in the response to issue #24.

Thanks in advance,
GL.

",gleveq1,https://github.com/tseemann/snippy/issues/94
MDU6SXNzdWUyNDY5MjYyMTg=,Extracting loci of SNPs after removal of recombined regions,CLOSED,2017-08-01T01:00:54Z,2017-09-11T06:15:04Z,2017-09-11T06:15:03Z,"Hi, 
I managed to run Snippy, and generate the csv file of the SNPs (*), then generate the alignment and use the .aln as input to Gubbins.

From Gubbins, I can generate the PDF file of the phylogenetic tree. There is also a csv file which contains a breakdown of the SNPs (in/out recombination region)

My query is: Is there a way of generating a csv file of the SNPS like from Snippy, which lists the SNPs after removal of recombination regions?

Thanks",kelvin-wcl,https://github.com/tseemann/snippy/issues/95
MDU6SXNzdWUyNDY5OTg5ODU=,snpEff message in log: WARNING: All frames are zero!,CLOSED,2017-08-01T08:51:58Z,2019-01-19T02:11:51Z,2018-04-07T10:21:47Z,"```
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
```

My knowledge says 'frame' is 'phase' and should be 0 if all CDS are in phase.
",tseemann,https://github.com/tseemann/snippy/issues/96
MDU6SXNzdWUyNDcwOTQwNTQ=,error: no VCF header,CLOSED,2017-08-01T14:45:19Z,2018-04-07T10:03:55Z,2018-04-07T10:03:55Z,"Dear Torsten,

I tried to use snippy with own data and the test on linux machine ubuntu 16.04 LTS.
I always obtained the same error 'no VCF header' at the 'freebayes-parallel' step.

Have you an idea ?

thanks per avance

All the best,

Richard
 
### samtools faidx reference/ref.fa
### bwa index reference/ref.fa
[bwa_index] Pack FASTA... 0.01 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.11 seconds elapse.
[bwa_index] Update BWT... 0.00 sec
[bwa_index] Pack forward-only FASTA... 0.00 sec
[bwa_index] Construct SA from BWT and Occ... 0.05 sec
[main] Version: 0.7.12-r1039
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.697 sec; CPU: 0.180 sec
### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa
### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref
WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
### (bwa mem  -v 2 -M -R '@RG	ID:snps	SM:snps' -t 8 reference/ref.fa /usr/local/snippy/test/reads_R1.fastq.gz /usr/local/snippy/test/reads_R2.fastq.gz | samtools view -@ 8 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -O bam -o snps.bam -@ 8 -)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (454, 498, 543)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (276, 721)
[M::mem_pestat] mean and std.dev: (498.46, 65.48)
[M::mem_pestat] low and high boundaries for proper pairs: (187, 810)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[main] Version: 0.7.12-r1039
[main] CMD: bwa mem -v 2 -M -R @RG	ID:snps	SM:snps -t 8 reference/ref.fa /usr/local/snippy/test/reads_R1.fastq.gz /usr/local/snippy/test/reads_R2.fastq.gz
[main] Real time: 2.981 sec; CPU: 14.068 sec
### samtools index snps.bam
### samtools depth -q 20 snps.bam | bgzip > snps.depth.gz
### tabix -s 1 -b 2 -e 2 snps.depth.gz
### fasta_generate_regions.py reference/ref.fa.fai 10086 > reference/ref.txt
### freebayes-parallel reference/ref.txt 8 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf

error: no VCF header
Traceback (most recent call last):
  File ""/usr/local/snippy/bin/../binaries/noarch/vcffirstheader"", line 16, in <module>
    print line.strip()
IOError: [Errno 32] Broken pipe

",rbonnet,https://github.com/tseemann/snippy/issues/97
MDU6SXNzdWUyNDg0NDkxMDc=,Bio::Perl dependence,CLOSED,2017-08-07T15:34:26Z,2017-08-24T09:12:02Z,2017-08-24T09:12:02Z,"==> Installing snippy from tseemann/bioinformatics-linux
snippy: Unsatisfied dependency: Bio::Perl
Homebrew does not provide special Perl dependencies; install with:
  `cpan -i Bio::Perl`
Error: An unsatisfied requirement failed this build.",cryptic0,https://github.com/tseemann/snippy/issues/98
MDU6SXNzdWUyNDkyMDAyNzM=,Snippy with --cleanup removes ref directory. Snippy core will then not work,CLOSED,2017-08-10T00:34:14Z,2017-08-31T02:24:48Z,2017-08-31T02:24:48Z,"Suggestions: 
1. Don't remove the directory, just clean up the index.
```
if ($cleanup) {
  my @delme = map { ""$refdir/ref.fa$_"" } ('', qw(.fai .amb .ann .bwt .pac .sa));
  push @delme, (""$prefix.bam"", ""$prefix.bam.bai"", ""$prefix.raw.vcf"");
  for my $file (@delme) {
    msg(""Deleting: $file"");
    unlink $file;
  }
  msg(""Removing folder: $refdir"");
  remove_tree($refdir);
}
```
Get rid of the `remove_tree($refdir);` line..

2. Allow snippy-core to take a reference fasta as an option",Slugger70,https://github.com/tseemann/snippy/issues/99
MDU6SXNzdWUyNDk2Mjg5MTU=,Incompatability with latest bwa due to tabs in @RG ,CLOSED,2017-08-11T13:01:34Z,2017-11-02T13:52:05Z,2017-08-31T03:10:03Z,"https://github.com/tseemann/snippy/blob/848a62efb3186bffb92597f9d6f9ab4924cf70d5/bin/snippy#L214

line 214:
https://github.com/tseemann/snippy/blob/v3.1/bin/snippy#L214

This is double quoted string, which interpolates \t into actual tab, however latest bwa dies if it sees tabs there: 
https://github.com/lh3/bwa/blob/master/bwa.c#L428

which could be clearly seen in the error log, among other warnings and messages:
[E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t

however this scenario is not handled and it keeps going further.

A simple double-escape of tab: $bwaopt .= qq{ -v 2 -M -R '\\@RG\\\tID:$rgid\\\tSM:$rgid'};
solves the problem

",EugeneBragin,https://github.com/tseemann/snippy/issues/100
MDU6SXNzdWUyNTI4NDA5ODg=,old versions of bundled tools in git repo,CLOSED,2017-08-25T09:08:54Z,2017-08-31T01:54:53Z,2017-08-31T01:54:53Z,"Hi,

Just tried installing Snippy from source, and found out that it checks for versions of tools. The ones bundled with the source (I used HEAD in master branch) are older than required:
freebayes (no version), while 1.1 is required
snpEff 4.1l, while 4.3 is required

Possibly other too, I haven't got that far. Checking out release v3.0 got me started snappier:)
",seru71,https://github.com/tseemann/snippy/issues/102
MDU6SXNzdWUyNTQxNzczMjk=,Linux freebayes and snpEff versions,CLOSED,2017-08-31T00:58:37Z,2017-08-31T01:54:13Z,2017-08-31T01:54:12Z,"Thanks for the software! I am looking forward to the results. A quick fyi: I obtained snippy 3.2-dev from github and found that I was unable to run due to incorrect versions of dependencies on CentOS 6.9. After a little digging I see the following version info for the problematic packages that came with the github download:

$ ~/sftwr/snippy-master/binaries/linux/freebayes --version
version:  

$ ~/sftwr/snippy-master/binaries/noarch/snpEff -version
4.1l

I was able to bypass this issue by commenting the following lines out and it seems to be running smoothly now:
#parse_version( 'freebayes --version', 1.1, qr/\sv(\d+\.\d+)/        );
#parse_version( 'snpEff -version',     4.3, qr/(\d+\.\d+)/           );

Is it problematic to be using the included freebayes and snpEff dists?",jbisanz,https://github.com/tseemann/snippy/issues/103
MDU6SXNzdWUyNTQxOTc5NDE=,Consider using samtools depth in stream only,CLOSED,2017-08-31T03:09:26Z,2018-04-07T09:57:51Z,2018-04-07T09:57:51Z,"currently
* depth | gzip > file.gz
* zcat file.gz
* tabix

Can probably just read directly once and don't keep the files - who needs them?
",tseemann,https://github.com/tseemann/snippy/issues/104
MDU6SXNzdWUyNTU4ODkxMjE=,.aligned explanation in readme,CLOSED,2017-09-07T10:24:13Z,2017-09-11T06:12:23Z,2017-09-11T06:12:22Z,"It says: .aligned.fa | A version of the reference but with `-` at position with `depth=0` and `N` for `0 < depth < --minfrac` (**does not have variants**)
But mincov is used in the code. Do you mean mincov, not minfrac? 

Cheers.",EugeneBragin,https://github.com/tseemann/snippy/issues/105
MDU6SXNzdWUyNTc5Mzk3NTA=,Allele numbering core vcf,CLOSED,2017-09-15T06:29:46Z,2017-10-04T01:00:46Z,2017-10-04T01:00:14Z,"Hi! 

I am writing a script to parse the snippy-core output and wonder if allele 2 or 3 could be the major allele in the snippy core vcf? Or is it always 0 or 1? Are they just numbered after the order in which they occur in the core genome parsing or after any kind of frequency?

Best wishes,

Kaisa",thorellk,https://github.com/tseemann/snippy/issues/106
MDU6SXNzdWUyNTkzNTEwMDA=,Snippy no longer puts '-' for 0 coverage,CLOSED,2017-09-21T01:44:04Z,2017-09-21T04:41:54Z,2017-09-21T04:41:54Z,"Due to  `samtools depth -aa` change:
https://github.com/tseemann/snippy/commit/8d6780998fcf59386987adbbb672ab9c2d3025f6

it never produces a `-` char.
",tseemann,https://github.com/tseemann/snippy/issues/107
MDU6SXNzdWUyNTkzNzI1Mzg=,Add TRAVIS-CI support,CLOSED,2017-09-21T04:32:07Z,2017-09-21T04:42:00Z,2017-09-21T04:42:00Z,Just copy abricate's one as a template,tseemann,https://github.com/tseemann/snippy/issues/108
MDU6SXNzdWUyNTkzNzI4ODk=,Snippy --help returns 1,CLOSED,2017-09-21T04:35:26Z,2017-09-21T04:42:06Z,2017-09-21T04:42:06Z,"Should return 0.

",tseemann,https://github.com/tseemann/snippy/issues/109
MDU6SXNzdWUyNTkzNzQwNTg=,Add simple test suite,CLOSED,2017-09-21T04:45:55Z,2018-04-28T23:17:57Z,2018-04-28T23:17:57Z,And add tests to travis,tseemann,https://github.com/tseemann/snippy/issues/110
MDU6SXNzdWUyNTk0NzQyMzk=,rRNA SNP nucleotide position,CLOSED,2017-09-21T12:11:04Z,2018-05-31T07:13:33Z,2018-05-31T07:13:33Z,"This may just be something I am missing but when I run snippy and look at the snps.tab file, I see nucleotide and amino acid positions of SNPs within a gene if it is a CDS but not if it is an rRNA. Of course no AA number should be there but is there anyway to find out the nucleotide number of the SNP in the gene when it is an rRNA related gene? An example is:
NC_000962	979704	snp	G	C	C:91 G:0	CDS	+	343/867	115/288	missense_variant c.343G>C p.Gly115Arg	Rv0881		tRNA/rRNA methyltransferase
NC_000962	1473246	snp	A	G	G:77 A:0	rRNA	+			non_coding_transcript_variant  	Rvnr01	rrs	16S ribosomal RNA


Any help is appreciated!

Con
",conmeehan,https://github.com/tseemann/snippy/issues/111
MDU6SXNzdWUyNTk2ODAwMzk=,different refs with different .consensus.fa?,CLOSED,2017-09-22T01:44:07Z,2017-09-22T02:52:45Z,2017-09-22T02:52:45Z,"I am doing virus mapping to get genomes. I dont get why I changed the reference of virus genome, snippy returned different snps.consensus.fa with about >30 snps differ. Is that means the method is worng to get virus genome? or Should I remove duplicates first?

anyone can help? thanks alot!",indexofire,https://github.com/tseemann/snippy/issues/112
MDU6SXNzdWUyNjA4NjQ2Njc=,snippy-core needs --ref X even for --noref,CLOSED,2017-09-27T06:49:13Z,2018-07-07T07:27:20Z,2018-07-07T07:27:20Z,See  https://github.com/tseemann/nullarbor/issues/130,tseemann,https://github.com/tseemann/snippy/issues/113
MDU6SXNzdWUyNjEyODQ1MjA=,Minimum set of files to calculate core?,CLOSED,2017-09-28T11:26:56Z,2020-07-12T19:29:22Z,2017-09-29T04:25:13Z,"Hi!

I am currently comparing > 1000 genomes to several references and am basically only going to use the output to create core genome alignments within different constellation of strains. Since keeping all output files take a lot of space it would be great to know what the minimum set of output files in each snippy directory would need to be to still be able to apply snippy-core to them. That way one can delete all other files while keeping only the possibility to rerun snippy-core if one wants to :)

Best wishes,

Kaisa ",thorellk,https://github.com/tseemann/snippy/issues/114
MDU6SXNzdWUyNjM2OTM3Mzc=,"about the ""bwa mem -R "" in snippy or wombac",CLOSED,2017-10-08T05:12:41Z,2018-05-16T05:50:58Z,2018-03-17T23:12:45Z,"i always get a err when i use the wombac or snippy,i think i find a bug in the file snippy. so , i  modify the line 214 to [$bwaopt .= qq{ -v 2 -M -R '\\@RG\\\tID:$rgid\\\tSM:$rgid'};] then i can get the right result using the command [snippy --outdir test --ref example.fna --R1 reads_R1.fastq.gz --R2 reads_R2.fastq.gz]. I want to know if what i did is rigth ? do any other friend find this problem ?

",WangSoybean,https://github.com/tseemann/snippy/issues/115
MDU6SXNzdWUyNjQ5NjYxMDA=,What positions are included in core.nway.tab file?,CLOSED,2017-10-12T14:36:34Z,2018-03-17T23:31:44Z,2018-03-17T23:31:44Z,"Hi!

Maybe trivial question but what loci are included in the nway tab file of the core output?

Thanks,

Kaisa",thorellk,https://github.com/tseemann/snippy/issues/116
MDU6SXNzdWUyNjkxOTc3NjY=,vcf-consensus  -- The fasta sequence does not match the REF,CLOSED,2017-10-27T18:36:11Z,2018-03-17T23:08:43Z,2018-03-17T23:08:43Z,"Hi there-
I expect this is a simple question (apologies in advance my Perl is rotten). I am having difficulty figuring out what the issue is with my input files to where I am not passing the sanity check in Snippy. I have pasted in my commands and then  the snps.log.

Any insight would be terrific.
My input consensus assembly does have a small number of gaps (Ns) and ambiguities (e.g., A,R,Y). I have also tried this by replacing the ambiguities with gaps (Ns), but get a similar error at the sanity check.

[nblouin@login001 MolBioLab]$ cat ~/shells/SnippyTestUW1.sh 
#!/bin/bash
#SBATCH -t 24:00:00
#SBATCH --mem=64G
#SBATCH --nodes=1-1
#SBATCH -J SnippyTester
#BATCH -D=/users/nblouin/scratch/MolBioLab

module unload biolite/0.3.3 
module load freebayes/1.1.0
module load snippy/Oct2017 


snippy --cpus 8 \
--reference SL1R_AssemblyMIRA.fasta \
 --outdir SnippyTestUW1 --force \
--pe1 trim_fwd_pair_UW1_S9_R1_001.fq \
--pe2 trim_rev_pair_UW1_S9_R2_001.fq


[nblouin@login001 MolBioLab]$ 
[nblouin@login001 MolBioLab]$ 
[nblouin@login001 MolBioLab]$ cat  SnippyTestUW1/snps.log
### cd /gpfs/scratch/nblouin/MolBioLab

### /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/snippy --cpus 8 --reference SL1R_AssemblyMIRA.fasta --outdir SnippyTestUW1 --force --pe1 trim_fwd_pair_UW1_S9_R1_001.fq --pe2 trim_rev_pair_UW1_S9_R2_001.fq

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.04 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.24 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.51 sec
[main] Version: 0.7.12-r1039
[main] CMD: bwa index reference/ref.fa
[main] Real time: 5.854 sec; CPU: 1.866 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### (bwa mem  -v 2 -M -R '@RG\tID:snps\tSM:snps' -t 8 reference/ref.fa /gpfs/scratch/nblouin/MolBioLab/trim_fwd_pair_UW1_S9_R1_001.fq /gpfs/scratch/nblouin/MolBioLab/trim_rev_pair_UW1_S9_R2_001.fq | samtools view -u -T reference/ref.fa -F 3844 -q 60 | samtools sort --reference reference/ref.fa > snps.bam)

[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (92, 178, 730)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 2006)
[M::mem_pestat] mean and std.dev: (347.00, 420.61)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2644)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (116, 165, 230)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 458)
[M::mem_pestat] mean and std.dev: (178.36, 83.07)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 572)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (87, 162, 361)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 909)
[M::mem_pestat] mean and std.dev: (222.40, 169.21)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1183)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (105, 165, 544)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1422)
[M::mem_pestat] mean and std.dev: (309.22, 398.59)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1861)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (115, 163, 228)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 454)
[M::mem_pestat] mean and std.dev: (176.99, 82.27)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 567)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (53, 99, 369)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1001)
[M::mem_pestat] mean and std.dev: (161.33, 140.90)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1317)
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (106, 180, 375)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 913)
[M::mem_pestat] mean and std.dev: (188.40, 130.41)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1182)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (115, 181, 494)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1252)
[M::mem_pestat] mean and std.dev: (262.00, 216.86)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1631)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (115, 163, 228)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 454)
[M::mem_pestat] mean and std.dev: (176.86, 81.64)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 567)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (136, 218, 409)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 955)
[M::mem_pestat] mean and std.dev: (215.53, 153.07)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1228)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (233, 732, 1757)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 4805)
[M::mem_pestat] mean and std.dev: (854.60, 695.95)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 6329)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (116, 163, 226)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 446)
[M::mem_pestat] mean and std.dev: (176.24, 80.43)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 556)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (104, 111, 258)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 566)
[M::mem_pestat] mean and std.dev: (152.86, 93.67)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 720)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (161, 267, 1405)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3893)
[M::mem_pestat] mean and std.dev: (583.79, 763.52)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 5137)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (115, 164, 228)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 454)
[M::mem_pestat] mean and std.dev: (177.09, 82.20)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 567)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (92, 145, 213)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 455)
[M::mem_pestat] mean and std.dev: (147.67, 86.55)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 576)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (72, 136, 749)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 2103)
[M::mem_pestat] mean and std.dev: (304.30, 317.90)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2780)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (114, 162, 225)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 447)
[M::mem_pestat] mean and std.dev: (174.99, 81.02)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 558)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (124, 212, 443)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1081)
[M::mem_pestat] mean and std.dev: (228.69, 171.50)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1400)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (115, 162, 225)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 445)
[M::mem_pestat] mean and std.dev: (175.34, 80.12)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 555)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (130, 343, 665)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1735)
[M::mem_pestat] mean and std.dev: (423.70, 320.64)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2270)
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (77, 108, 204)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 458)
[M::mem_pestat] mean and std.dev: (142.72, 87.09)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 585)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (127, 179, 335)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 751)
[M::mem_pestat] mean and std.dev: (198.30, 110.22)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 959)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (115, 161, 224)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 442)
[M::mem_pestat] mean and std.dev: (174.35, 79.46)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 551)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (99, 141, 545)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1437)
[M::mem_pestat] mean and std.dev: (208.20, 178.36)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1883)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (103, 138, 252)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 550)
[M::mem_pestat] mean and std.dev: (168.89, 116.62)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 699)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (111, 157, 217)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 429)
[M::mem_pestat] mean and std.dev: (169.05, 77.13)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 535)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (86, 145, 231)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 521)
[M::mem_pestat] mean and std.dev: (149.28, 102.86)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 666)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (123, 173, 760)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 2034)
[M::mem_pestat] mean and std.dev: (366.62, 436.34)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2671)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (111, 156, 215)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 423)
[M::mem_pestat] mean and std.dev: (167.95, 75.82)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 527)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (60, 137, 303)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 789)
[M::mem_pestat] mean and std.dev: (155.80, 104.94)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1032)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (97, 108, 193)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 385)
[M::mem_pestat] mean and std.dev: (132.57, 65.28)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 481)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (114, 160, 221)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 435)
[M::mem_pestat] mean and std.dev: (172.70, 77.77)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 542)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (115, 162, 496)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1258)
[M::mem_pestat] mean and std.dev: (227.27, 190.58)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1639)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (169, 230, 522)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1228)
[M::mem_pestat] mean and std.dev: (337.33, 318.48)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1581)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (112, 157, 217)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 427)
[M::mem_pestat] mean and std.dev: (169.21, 77.00)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 532)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (177, 300, 498)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1140)
[M::mem_pestat] mean and std.dev: (225.08, 120.47)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1461)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (113, 181, 1178)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3308)
[M::mem_pestat] mean and std.dev: (405.57, 708.48)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 4373)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (109, 152, 210)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 412)
[M::mem_pestat] mean and std.dev: (163.95, 73.61)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 513)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (164, 280, 678)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1706)
[M::mem_pestat] mean and std.dev: (388.50, 317.69)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2220)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (160, 207, 359)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 757)
[M::mem_pestat] mean and std.dev: (233.10, 173.06)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 956)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (113, 158, 218)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 428)
[M::mem_pestat] mean and std.dev: (170.56, 76.04)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 533)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (140, 168, 688)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1784)
[M::mem_pestat] mean and std.dev: (380.82, 424.77)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2332)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[main] Version: 0.7.12-r1039
[main] CMD: bwa mem -v 2 -M -R @RG\tID:snps\tSM:snps -t 8 reference/ref.fa /gpfs/scratch/nblouin/MolBioLab/trim_fwd_pair_UW1_S9_R1_001.fq /gpfs/scratch/nblouin/MolBioLab/trim_rev_pair_UW1_S9_R2_001.fq
[main] Real time: 511.312 sec; CPU: 445.839 sec
[bam_sort_core] merging from 6 files...

### samtools index snps.bam


### samtools depth -aa -q 20 snps.bam | bgzip > snps.depth.gz


### tabix -s 1 -b 2 -e 2 snps.depth.gz


### fasta_generate_regions.py reference/ref.fa.fai 147137 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf


### /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/snippy-vcf_filter --minqual 10 --mincov 10 --minfrac 0.9  snps.raw.vcf > snps.filt.vcf

Parsing: snps.raw.vcf
Types: del=29 complex=490 mnp=22
Passed 541/570 variants (94.91%)

### cp snps.filt.vcf snps.vcf


### bgzip -c snps.vcf > snps.vcf.gz


### tabix -p vcf snps.vcf.gz


### /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 541 SNPs to TAB format.

### vcf-consensus snps.vcf.gz < reference/ref.fa > snps.consensus.fa

The fasta sequence does not match the REF at SL1R_AssemblyMIRA:575315. GYTN(YTNTTAGGG) in .fa, GNTN in .vcf, frz=571510
 at /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/../binaries/noarch/vcf-consensus line 20, <STDIN> line 9590.
	main::error('The fasta sequence does not match the REF at SL1R_AssemblyMIR...') called at /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/../binaries/noarch/vcf-consensus line 262
	main::apply_variant('HASH(0x1bddcb8)', 'ARRAY(0x1f3d4d8)') called at /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/../binaries/noarch/vcf-consensus line 146
	main::do_consensus('HASH(0x1bddcb8)') called at /gpfs/runtime/opt/snippy/Oct2017/snippy/bin/../binaries/noarch/vcf-consensus line 11
",nblouin,https://github.com/tseemann/snippy/issues/117
MDU6SXNzdWUyNjk5MTk3MTY=,Can't find freebayes-parallel in PATH,CLOSED,2017-10-31T11:10:51Z,2017-10-31T13:40:42Z,2017-10-31T13:40:42Z,,RJBeng,https://github.com/tseemann/snippy/issues/118
MDU6SXNzdWUyNzExOTc3NzM=,How to refer to this software,CLOSED,2017-11-04T14:54:46Z,2018-03-17T23:13:26Z,2018-03-17T23:13:26Z,I want to know how to refer to this software?,WangSoybean,https://github.com/tseemann/snippy/issues/119
MDU6SXNzdWUyNzI3MDU5NDk=,trouble  reading reference sequence,CLOSED,2017-11-09T20:11:08Z,2018-04-02T23:51:38Z,2018-04-02T23:51:38Z,"Hello,
I get the following message  
""Please supply a reference FASTA/GBK/EMBL file with --reference""
I have tried with various .fasta .gb .gbk sequences but it doesn't seem to work. My files are within other folder, I have also tried the full path. Anything else I can try?
Thanks!
",jnricaldi,https://github.com/tseemann/snippy/issues/120
MDU6SXNzdWUyNzU0NTY2NjY=,full.aln file,CLOSED,2017-11-20T18:38:33Z,2018-03-06T05:33:20Z,2018-03-06T05:33:14Z,"Hey Torsten,

What tools/programs are used under the hood when creating the full.aln file (tried to figure it out but my perl competency is lackluster). I'm also trying to figure out if it is compatible as input into gubbins.

Thanks,
Ryan",ryjohnson09,https://github.com/tseemann/snippy/issues/121
MDU6SXNzdWUyNzk4NDU0NjI=,VCF filtering: Pruning / thinnig,CLOSED,2017-12-06T17:45:02Z,2018-03-06T07:11:38Z,2018-03-06T07:11:38Z,"Hi Thorsten,
could you enhance snippy by allowing pruning the combined VCF files?
For genomes with frequent recombinations, it makes sense to consider SNPs only once and remove SNPs that are close. This is called pruning in CGE's [CSIPhylogeny](https://cge.cbs.dtu.dk/services/CSIPhylogeny/), thinning within [vcftools](http://vcftools.sourceforge.net/man_latest.html) and intersnp distance in bionumerics.

> vcftools
Thin sites so that no two sites are within the specified distance from one another.

I would do the pruning after calling the core snps and then compute the alignment fasta

This is what I did:
```
# 1. Call core snps
snippy-core --noref --prefix core_noref */

# 2. thin neigbouting SNPs
vcftools --vcf core_noref.vcf --out thinned --thin 100 --recode

# 3. Convert to tab format
vcf-to-tab < thinned.recode.vcf > thinned.tab

# 4. convert to alignment (from https://code.google.com/archive/p/vcf-tab-to-fasta/)
perl vcf_tab_to_fasta_alignment.pl -i thinned.tab > thinned.aln

# 5. compute distance matrix
snp-dists $analyis_dir/thinned.aln > $analyis_dir/snp_thinned_matrix.tsv
```

Of course it would be charming if snippy could do this with one call.


",crarlus,https://github.com/tseemann/snippy/issues/122
MDU6SXNzdWUyNzk4NDYwNDU=,Add snp-dists to snippy,CLOSED,2017-12-06T17:46:58Z,2018-03-06T05:31:59Z,2018-03-06T05:31:59Z,"Could you add the program [snp-dists](https://github.com/tseemann/snp-dists) to snippy?
Thanks!
",crarlus,https://github.com/tseemann/snippy/issues/123
MDU6SXNzdWUyODAzNTY3ODI=,Add Samtools markdup to Snippy,CLOSED,2017-12-08T03:15:38Z,2018-04-03T01:20:07Z,2018-04-02T23:50:41Z,"It would be great if users could implement an option in Snippy (something like ""--dedup"") that would mark read duplicates for removal via the newly available Samtools markdup (in Samtools Release 1.6). ",amilesj,https://github.com/tseemann/snippy/issues/124
MDU6SXNzdWUyODEzNzczMzQ=,Potentially missed SNP,CLOSED,2017-12-12T13:05:51Z,2018-03-17T23:08:00Z,2018-03-17T23:08:00Z,"Hi Torsten,

I am comparing the output of snippy to a GATK-based pipeline and have come across something weird. There is one SNP that was found by the GATK approach but not found in the snippy pipeline we use here. However, when I view the snippy bam file with IGV, I do see the snp. Am I missing something or is snippy missing that snp for some reason?
The dropbox link below gives you all the output from snippy. The position in question is 2439519. Let me know if I am missing something here please.
https://www.dropbox.com/sh/qy9dityjtrpzf2u/AAD8SQ-zyRP1o7ciOh9I76a0a?dl=0

Thanks,
Conor
 ",conmeehan,https://github.com/tseemann/snippy/issues/125
MDU6SXNzdWUyODg2MTk5ODA=,How to generate a multi-fasta alignement between contigs and a reference genome?,CLOSED,2018-01-15T14:52:40Z,2018-01-18T10:08:26Z,2018-01-15T23:30:40Z,"Dear Colleague(s),

I am contacting you concerning SNIPPY.

I would like to use it to generate a muti-fasta alignment between contigs and a reference genome.
Is that possible?
If yes, how to do it?

Many thanks,
Best,
Alia.",aliabenkahla,https://github.com/tseemann/snippy/issues/126
MDU6SXNzdWUyOTAwNDc2MTM=,Snippy on Galaxy,CLOSED,2018-01-19T17:16:55Z,2018-03-06T01:49:25Z,2018-03-06T01:49:25Z,"Hi everyone,

I'm using snippy on galaxy and I'm getting the error below. I'm very new to this program (and bioinfo in general...), but does anyone know what I could do to solve this problem? Because I am using the program through galaxy I don't think I can update BioPerl.

Best,
Korin

Fatal error: Exit code 2 ()
Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module) (@INC contains: /Library/Perl/5.18/darwin-thread-multi-2level /Library/Perl/5.18 /Network/Library/Perl/5.18/darwin-thread-multi-2level /Network/Library/Perl/5.18 /Library/Perl/Updates/5.18.2 /System/Library/Perl/5.18/darwin-thread-multi-2level /System/Library/Perl/5.18 /System/Library/Perl/Extras/5.18/darwin-thread-multi-2level /System/Library/Perl/Extras/5.18 .) at /Users/korinalbert/galaxy/database/dependencies/snippy/3.0/simon-gladman/package_snippy_3_0/c8d7d39f0781/bin/snippy line 11.
BEGIN failed--compilation aborted at /Users/korinalbert/galaxy/database/dependencies/snippy/3.0/simon-gladman/package_snippy_3_0/c8d7d39f0781/bin/snippy line 11.",korinalb,https://github.com/tseemann/snippy/issues/127
MDU6SXNzdWUyOTExMjk0OTQ=,What are the Ns in the alignment,CLOSED,2018-01-24T08:58:01Z,2018-03-06T04:54:42Z,2018-03-06T04:54:42Z,"Hello Thorsten.  
Could you please explain me what the N represent in the fasta alignments when we align raw fastq reads?
Thanks
Marcelino",suzumar,https://github.com/tseemann/snippy/issues/128
MDU6SXNzdWUyOTM1MTUyNTE=,start from precomputed .vcf files,CLOSED,2018-02-01T12:38:42Z,2018-03-06T13:32:00Z,2018-03-06T05:26:50Z,The variant calling in our project was done previously. Is it possible to have snippy start from our vcf files and create the data required by the core SNPs phylogeny? ,thkuo,https://github.com/tseemann/snippy/issues/129
MDU6SXNzdWUyOTU0NzU1NDY=,Snippy compiled from source on MacOS gives error!,CLOSED,2018-02-08T11:22:56Z,2018-03-06T05:29:21Z,2018-03-06T05:29:08Z,"Snippy log output:
```
### cd ~/

### ~/bin/snippy --ref ~/snippy/sequence.fasta --ctgs /snippy/47244_FI31.fas --outdir /snippy/47244_out

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.02 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.61 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.02 sec
[bwa_index] Construct SA from BWT and Occ... 0.17 sec
[main] Version: 0.7.12-r1039
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.875 sec; CPU: 0.850 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### (bwa mem  -v 2 -M -R '@RG\tID:snps\tSM:snps' -t 8 reference/ref.fa fake_reads.fq | samtools view -u -T reference/ref.fa -F 3844 -q 60 | samtools sort --reference reference/ref.fa > snps.bam)

[main] Version: 0.7.12-r1039
[main] CMD: bwa mem -v 2 -M -R @RG\tID:snps\tSM:snps -t 8 reference/ref.fa fake_reads.fq
[main] Real time: 14.415 sec; CPU: 51.978 sec

### samtools index snps.bam


### samtools depth -aa -q 20 snps.bam | bgzip > snps.depth.gz


### tabix -s 1 -b 2 -e 2 snps.depth.gz


### fasta_generate_regions.py reference/ref.fa.fai 52153 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf

libc++abi.dylib: terminating with uncaught exception of type std::out_of_range: basic_string
libc++abi.dylib: terminating with uncaught exception of type std::out_of_range: basic_string
/Users/mihkelm/snippy/bin/../binaries/noarch/freebayes-parallel: line 40:  6265 Exit 32                 ( cat $regionsfile | parallel -k -j $ncpus ""$command --region {}"" )
      6266 Done                    | vcffirstheader
      6267 Abort trap: 6           | vcfstreamsort -w 1000
      6269 Abort trap: 6           | vcfuniq
```",maesaar,https://github.com/tseemann/snippy/issues/130
MDU6SXNzdWUyOTc5NTk2MjE=,version check fails for java based programs under certain conditions,CLOSED,2018-02-17T00:26:47Z,2018-03-06T17:58:28Z,2018-03-06T17:58:28Z,"Hi @tseemann!

Our snpeff version check return the following as we have a env var set to control the JRE:

```
$ snpEff -version 
Picked up _JAVA_OPTIONS: -Xmx4G -Xms1G
4.3
```

`Picked up _JAVA_OPTIONS: -Xmx4G -Xms1G` is a message printed to stderr, so if you filter out stderr from https://github.com/tseemann/snippy/blob/master/bin/snippy#L80 this would solve it.

```
$ snpEff -version 2> /dev/null
4.3
```",bgruening,https://github.com/tseemann/snippy/issues/131
MDU6SXNzdWUyOTg4MjQzMDQ=,Call SNPs with pre-aligned BAM files:,CLOSED,2018-02-21T02:48:26Z,2018-02-28T23:17:57Z,2018-02-28T23:17:57Z,"Hi Torsten,

Thank you for making this tool -- works great!

Just a question, is it possible to run the pipeline on BAM files? (_i.e._ I would like to call SNPs with different mincov/minfrac thresholds, but don't want to re-map with BWA).

Cheers,
Raphael",EisenRa,https://github.com/tseemann/snippy/issues/132
MDU6SXNzdWUyOTkyMzQwMzc=,snps.consensus.subs.fa is not explained,CLOSED,2018-02-22T06:13:46Z,2018-04-07T10:29:28Z,2018-04-07T10:29:28Z,,tseemann,https://github.com/tseemann/snippy/issues/133
MDU6SXNzdWUyOTkyMzQ0Mjc=,Support for marking duplicates,CLOSED,2018-02-22T06:16:23Z,2018-04-02T23:47:52Z,2018-04-02T23:47:51Z,"Will need samtools markdup, which requires a pre-sorting step 

```
bwa mem -t 72 02.trimmed.fa ../../R1.fq.gz
../../R2.fq.gz | samtools sort --reference ref.gbk -m 4G -@
8 -T /tmp/sort.$RANDOM -l 0 -O BAM -n | samtools fixmate -m -@ 8 - - |
samtools sort --reference 02.trimmed.fa -m 4G -@ 8 -T /tmp/sortpos.$RANDOM |
samtools markdup -s -T /tmp/markdup.$RANDOM -l 0 -O BAM -@ 8 -
reads.bam && samtools index reads.bam
```
",tseemann,https://github.com/tseemann/snippy/issues/134
MDU6SXNzdWUzMDExMzczNzc=,output from multiple Snippy runs to find all sites where snp present in >=1 isolate,CLOSED,2018-02-28T18:43:16Z,2018-02-28T23:34:00Z,2018-02-28T23:15:39Z,"Hi there. I'm relatively new to this, but I was wondering if there was an easy way to run snippy on multiple samples compared to a single reference and then pool that output to generate a fasta file for each sample where only those sites that have snps in at least one isolate (of the many put through snippy) are included. I've written R code to do this myself, but I'm worried I'm missing something in the Snippy output--plus there are so many warnings online not to do this. 

I don't want snippy-core to the best of my knowledge because that only includes those snps that are common to all samples I'm investigating. It is similar to what I want to do though, but instead I want to include all sites that are variant in at least one sample of the many I'm evaluating. 

I apologize if this doesn't make sense, I'm not down with the lingo yet. Thanks for any effort that can be given to push me in the right direction. ",lydeejeanne,https://github.com/tseemann/snippy/issues/135
MDU6SXNzdWUzMDI0OTg4OTk=,Compile Error - Freebayes Upgrade,CLOSED,2018-03-05T23:02:38Z,2018-03-06T06:47:47Z,2018-03-06T06:47:47Z,"Hi Thorsten,

I have installed Gubbins and Snippy. When I tried to execute snippy, I received an error regarding upgrading Freebayes:

Can't exec ""freebayes"": No such file or directory at /home/ubuntu/snippy/bin/snippy line 80.
readline() on closed filehandle $VER at /home/ubuntu/snippy/bin/snippy line 81.
Use of uninitialized value $ver in numeric lt (<) at /home/ubuntu/snippy/bin/snippy line 85.
[22:35:37] Need freebayes --version >= 1.1 - please upgrade it.

I have tried to install Freebayes but I still receive the same error (git clone --recursive git://github.com/ekg/freebayes.git)

Please advise. Thank you.

Kind Regards,
Kelvin
",kelvin-wcl,https://github.com/tseemann/snippy/issues/136
MDU6SXNzdWUzMDI1NDY5MTE=,readline() on closed filehandle $VER at,CLOSED,2018-03-06T03:03:28Z,2018-03-06T06:47:08Z,2018-03-06T06:47:08Z,"```
[02:57:56] Checking version: samtools --version is >= 1.3 - ok, have 1.3

readline() on closed filehandle $VER at /home/travis/build/tseemann/snippy/bin/snippy line 81.
Use of uninitialized value $ver in numeric lt (<) at /home/travis/build/tseemann/snippy/bin/snippy line 85.

[02:57:56] Need freebayes --version >= 1.1 - please upgrade it.
```
",tseemann,https://github.com/tseemann/snippy/issues/137
MDU6SXNzdWUzMDQwNjgyMDc=,"I got ""No variants found"" message and empty .bed file",CLOSED,2018-03-10T12:48:44Z,2018-04-07T11:58:46Z,2018-04-07T11:58:46Z,"Hello,
I'm using snippy 3.2-dev on Macintosh OSX El Captan 10.11.6.
When I tried test data that came with snippy-master, everything was all right. But when I tried my own fastq files, it seemed to finished all right but the resulted .bed file was empty. I checked again and found the following messages displayed during the run.
Creating extra output files: BED GFF CSV TXT HTML
Identified 0 variants. 

In the .log file, there was a warning ""All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate"", which I cannot understand what this means. My input file is a fasta file of a complete genome about 1.6Mb.

I'd really appreciate it if you give me a suggestion.

.log-----------------------------------------------------------------------------------------------
### cd /Users/rusuzuki/Desktop/Snippy

### /Users/rusuzuki/snippy/bin/snippy --out miseq_nepal_OUT2 --ref Hpyl_F32.gb --R1 Nepal-1_S28_L001_R1_001.fastq.gz --R2 Nepal-1_S28_L001_R2_001.fastq.gz

### samtools faidx reference/ref.fa

### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.01 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.42 seconds elapse.
[bwa_index] Update BWT... 0.01 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.13 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.610 sec; CPU: 0.592 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### (bwa mem  -v 2 -M -R '@RG\tID:snps\tSM:snps' -t 8 reference/ref.fa /Users/rusuzuki/Desktop/Snippy/Nepal-1_S28_L001_R1_001.fastq.gz /Users/rusuzuki/Desktop/Snippy/Nepal-1_S28_L001_R2_001.fastq.gz | samtools view -u -T reference/ref.fa -F 3844 -q 60 | samtools sort --reference reference/ref.fa > snps.bam)

[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (23, 23, 24)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (21, 26)
[M::mem_pestat] mean and std.dev: (23.24, 0.43)
[M::mem_pestat] low and high boundaries for proper pairs: (20, 27)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] skip orientation FR as there are not enough pairs
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -v 2 -M -R @RG\tID:snps\tSM:snps -t 8 reference/ref.fa /Users/rusuzuki/Desktop/Snippy/Nepal-1_S28_L001_R1_001.fastq.gz /Users/rusuzuki/Desktop/Snippy/Nepal-1_S28_L001_R2_001.fastq.gz
[main] Real time: 16.481 sec; CPU: 105.285 sec

### samtools index snps.bam

### samtools depth -aa -q 20 snps.bam | bgzip > snps.depth.gz

### tabix -s 1 -b 2 -e 2 snps.depth.gz

### fasta_generate_regions.py reference/ref.fa.fai 50162 > reference/ref.txt

### freebayes-parallel reference/ref.txt 8 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf

### /Users/rusuzuki/snippy/bin/snippy-vcf_filter --minqual 10 --mincov 10 --minfrac 0.9  snps.raw.vcf > snps.filt.vcf

Parsing: snps.raw.vcf
No variants found.

### snpEff ann -no-downstream -no-upstream -no-intergenic -no-utr -c reference/snpeff.config -dataDir . -noStats ref snps.filt.vcf > snps.vcf
### bgzip -c snps.vcf > snps.vcf.gz
### tabix -p vcf snps.vcf.gz
### /Users/rusuzuki/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab
Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 0 SNPs to TAB format.
### vcf-consensus snps.vcf.gz < reference/ref.fa > snps.consensus.fa
### /Users/rusuzuki/snippy/bin/snippy-vcf_filter --subs snps.filt.vcf > snps.filt.subs.vcf
Parsing: snps.filt.vcf
No variants found.
### bgzip -c snps.filt.subs.vcf > snps.filt.subs.vcf.gz
### tabix -p vcf snps.filt.subs.vcf.gz
### vcf-consensus snps.filt.subs.vcf.gz < reference/ref.fa > snps.consensus.subs.fa
",gokigensz,https://github.com/tseemann/snippy/issues/138
MDU6SXNzdWUzMDQwNzM3OTg=,About snp-core ,CLOSED,2018-03-10T14:15:58Z,2018-03-17T23:05:19Z,2018-03-17T23:05:19Z,"Hi there I am working in 180 GBS isolates of different serotypes (Ia-IX) can i use different reference for each isolates (per closest match to serotype it belongs to) in snippy to find snp variant and then I wish to have aligned core snp file using snippy-core.
Kindly help me with the easiest way to do it.
Thanks
",uzmanadeem,https://github.com/tseemann/snippy/issues/139
MDU6SXNzdWUzMDQwNzM5NDg=,snippy-core commandline,CLOSED,2018-03-10T14:18:19Z,2018-03-17T23:06:19Z,2018-03-17T23:06:19Z,"Can anyone tell me the commandline you guys are using for snippy-core?
I am new to bionformatics any help would be appreciated
Thanks
",uzmanadeem,https://github.com/tseemann/snippy/issues/140
MDU6SXNzdWUzMDYxNTIwMzM=,running error,CLOSED,2018-03-17T12:17:32Z,2018-04-22T22:52:39Z,2018-04-03T01:55:14Z,"hello, everyone,  can you help me to deal with the error, when I perform snippy to investigate SNP between two genome, but the error still occurs. I don't know how to do?
thank you very much.


the snps.log as following:


### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.04 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.02 seconds elapse.
[bwa_index] Update BWT... 0.06 sec
[bwa_index] Pack forward-only FASTA... 0.02 sec
[bwa_index] Construct SA from BWT and Occ... 0.63 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 3.316 sec; CPU: 2.760 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### (bwa mem  -v 2 -M -R '@RG	ID:snps	SM:snps' -t 8 reference/ref.fa fake_reads.fq | samtools view -@ 8 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -O bam -o snps.bam -@ 8 -)

[E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t
sort: invalid option -- 'O'
open: No such file or directory
[bam_sort_core] fail to open file bam
[sam_header_read2] 41 sequences loaded.
[sam_read1] reference '' is recognized as '*'.
[main_samview] truncated file.

### samtools index snps.bam

open: No such file or directory
[bam_index_build2] fail to open the BAM file.

### samtools depth -q 20 snps.bam | bgzip > snps.depth.gz


### tabix -s 1 -b 2 -e 2 snps.depth.gz


### fasta_generate_regions.py reference/ref.fa.fai 203073 > reference/ref.txt

  File ""miniconda3/bin/fasta_generate_regions.py"", line 7
    print ""usage: "", sys.argv[0], "" <fasta file or index file> <region size>""
                  ^
SyntaxError: Missing parentheses in call to 'print'. Did you mean print(int ""usage: "", sys.argv[0], "" <fasta file or index file> <region size>"")?",yzhzu,https://github.com/tseemann/snippy/issues/141
MDU6SXNzdWUzMDYyOTQ2NjM=,Document the snippy-core --reference option,CLOSED,2018-03-18T23:10:09Z,2018-04-07T10:44:19Z,2018-04-07T10:44:16Z,"This was added recently and hasn't really been discussed.

This allows you to nuke all the `sample/reference/*` files and still do a core later.
",tseemann,https://github.com/tseemann/snippy/issues/142
MDU6SXNzdWUzMTA2MTA1ODc=,Is the core SNP codon aligned?,CLOSED,2018-04-02T21:02:43Z,2018-04-03T15:17:23Z,2018-04-03T15:17:23Z,"I was wondering if the output of the core SNP alignment is aligned by codon? If not, could such a tool be added?",JibrinLab,https://github.com/tseemann/snippy/issues/143
MDU6SXNzdWUzMTIxOTQ1NzQ=,EVIDENCE column has two items in it,CLOSED,2018-04-07T10:15:19Z,2018-04-07T10:16:45Z,2018-04-07T10:16:45Z,"Headers are out of sync!

```
CHROM             POS     TYPE  REF     ALT      EVIDENCE    FTYPE     STRAND  NT_POS  AA_POS     EFFECT   LOCUS_>
LBB_contig000001  1267    snp   A       C        C:88        A:0       CDS     +       393/846    131/280  missen>
LBB_contig000001  2427    snp   C       T        T:89        C:0       CDS     +       330/891    110/295  missen>
```
",tseemann,https://github.com/tseemann/snippy/issues/144
MDU6SXNzdWUzMTIxOTQ3NDA=,Unify versions across all tools,CLOSED,2018-04-07T10:17:49Z,2018-04-29T02:29:28Z,2018-04-29T02:29:28Z,"Need a `Snippy::Version` class.
",tseemann,https://github.com/tseemann/snippy/issues/145
MDU6SXNzdWUzMTIxOTUyMTk=,Add masking support,CLOSED,2018-04-07T10:24:48Z,2018-04-07T11:56:52Z,2018-04-07T11:56:52Z,"Can do it either 
1. in every snippy call
2. just in snippy-core

For @andersgs
",tseemann,https://github.com/tseemann/snippy/issues/146
MDU6SXNzdWUzMTIyMDQ5MDQ=,Use bcftools-csq instead of snpEff,OPEN,2018-04-07T13:03:00Z,2019-12-03T15:23:17Z,,"This will remove the need for snpeff and particularly Java!

Docs: http://www.htslib.org/doc/bcftools.html#csq

Interface:https://github.com/samtools/bcftools/blob/develop/csq.c

Paper: https://www.ncbi.nlm.nih.gov/pubmed/28205675
",tseemann,https://github.com/tseemann/snippy/issues/148
MDU6SXNzdWUzMTI0MDYwMTU=,Snippy core bed file logic broken two ways,CLOSED,2018-04-09T06:13:02Z,2018-04-15T05:06:01Z,2018-04-15T05:06:01Z,"1. Coordinates not in 1 base

2. Only last region per chromosome is keep",tseemann,https://github.com/tseemann/snippy/issues/149
MDU6SXNzdWUzMTI2NjMwODU=,snippy in conda,CLOSED,2018-04-09T19:49:55Z,2018-04-16T11:26:44Z,2018-04-16T10:49:30Z,"Hello,

I am trying to run snippy in conda (version 3.2 it is).

By:

snippy --outdir ./results --ref ./data/ref/ref.gbk --ctgs ./data/contigs/contigs.fasta --prefix first_test --report --force --unmapped

In the verbous stdout I already get the following warnings:
use of uninitialized value in uc at /data/anaconda3/envs/env/bin/snippy line 159, <GEN0> line 16934272.

The analysis ends by returning the following error in the log file:

##############
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

java.lang.RuntimeException: Error reading file '/data/results/reference/./ref/genes.gff'
java.lang.RuntimeException: FATAL ERROR: Offending line (lineNum: 6998): 'NC_016038     snippy  5'UTR   1       31      .       +       0
       '. File '/data/results/reference/./ref/genes.gff' line 6998
        'NC_016038      snippy  5'UTR   1       31      .       +       0       '

        at org.snpeff.snpEffect.factory.SnpEffPredictorFactoryGff.create(SnpEffPredictorFactoryGff.java:353)
        at org.snpeff.snpEffect.commandLine.SnpEffCmdBuild.createSnpEffPredictor(SnpEffCmdBuild.java:116)
        at org.snpeff.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:345)
        at org.snpeff.SnpEff.run(SnpEff.java:1009)
        at org.snpeff.SnpEff.main(SnpEff.java:155)

###########
Therefore, I am not sure if the warning and the error are related. It looks like the path to the gff reference is malformed.
I could not find a solution to install the latest version under conda.


Regards,

Thierry",thierryjanssens,https://github.com/tseemann/snippy/issues/150
MDU6SXNzdWUzMTQzODgwNDQ=,Remove File::Slurp dependency,CLOSED,2018-04-15T05:48:38Z,2018-04-15T06:10:32Z,2018-04-15T06:10:32Z,"Not in core, and not recommended.
",tseemann,https://github.com/tseemann/snippy/issues/151
MDU6SXNzdWUzMTc3ODI1MDA=,error using gbk.,CLOSED,2018-04-25T20:30:31Z,2018-04-27T08:42:54Z,2018-04-25T20:41:37Z,"When I provide a gbk reference input, I get the following error below. This did not occur using a fasta reference. 
Thanks.

java.lang.RuntimeException: Error parsing property 'ref.AE015924.codonTable'. No such codon table 'Bacterial_and_Plant_Plastid'
        at org.snpeff.snpEffect.Config.createCodonTables(Config.java:169)
        at org.snpeff.snpEffect.Config.readConfig(Config.java:650)
        at org.snpeff.snpEffect.Config.init(Config.java:480)
        at org.snpeff.snpEffect.Config.<init>(Config.java:117)
        at org.snpeff.SnpEff.loadConfig(SnpEff.java:451)
        at org.snpeff.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:364)
        at org.snpeff.SnpEff.run(SnpEff.java:1183)
        at org.snpeff.SnpEff.main(SnpEff.java:162)
",N/A,https://github.com/tseemann/snippy/issues/152
MDU6SXNzdWUzMTc3ODUxNzk=,Failed run - ?syntax issue,CLOSED,2018-04-25T20:38:54Z,2018-04-27T18:19:04Z,2018-04-27T18:17:11Z,"New user here, having recurrent issues right after:

[11:46:13] Running: fasta_generate_regions.py reference/ref.fa.fai 147471 > reference/ref.txt 2>> snps.log
[11:46:13] Error running command, check /path/to/snps.log

Getting following .log:

[snps.log](https://github.com/tseemann/snippy/files/1948727/snps.log)

Tried .gbff, .fasta as reference,  both ultimately failing.   

Appreciate your help!
",lflisboa,https://github.com/tseemann/snippy/issues/153
MDU6SXNzdWUzMTc3ODcxMzA=,error with gbk,CLOSED,2018-04-25T20:44:50Z,2019-12-03T22:23:41Z,2018-07-07T07:54:36Z,"When I provide a gbk reference input, I get the following error below. This did not occur using a fasta reference.
Thanks.

java.lang.RuntimeException: Error parsing property 'ref.AE015924.codonTable'. No such codon table 'Bacterial_and_Plant_Plastid'
at org.snpeff.snpEffect.Config.createCodonTables(Config.java:169)
at org.snpeff.snpEffect.Config.readConfig(Config.java:650)
at org.snpeff.snpEffect.Config.init(Config.java:480)
at org.snpeff.snpEffect.Config.(Config.java:117)
at org.snpeff.SnpEff.loadConfig(SnpEff.java:451)
at org.snpeff.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:364)
at org.snpeff.SnpEff.run(SnpEff.java:1183)
at org.snpeff.SnpEff.main(SnpEff.java:162)",aemiol,https://github.com/tseemann/snippy/issues/154
MDU6SXNzdWUzMTc4OTA3MTg=,BWA index issue ,CLOSED,2018-04-26T06:14:18Z,2018-07-07T07:54:08Z,2018-07-07T07:54:08Z,"Hi there,

When I use bwa index -a bwtsw  abc.fa, it shows:
`[bwa_index] Pack FASTA... [bns_fasta2bntseq] Failed to allocate 0 bytes at bntseq.c line 303: Success`
Any suggestion?

My abc.fa is a combined .fa file from both human hg19 and mouse mm10 genome. 

Simon",shengyongniu,https://github.com/tseemann/snippy/issues/155
MDU6SXNzdWUzMTgyOTA3NTA=,snippy-core --noref  has 'monomorphs' in nway.tab etc,CLOSED,2018-04-27T06:21:48Z,2018-07-06T07:58:45Z,2018-07-06T07:58:45Z,"When you use `--noref` you get all the original SNPs still:

`NC_017338       105     T       T`",tseemann,https://github.com/tseemann/snippy/issues/156
MDU6SXNzdWUzMTg2NzY0MDg=,Break --help into sections,CLOSED,2018-04-28T23:31:04Z,2018-04-29T02:29:19Z,2018-04-29T02:29:19Z,"Getting unweildly
",tseemann,https://github.com/tseemann/snippy/issues/157
MDU6SXNzdWUzMTk2ODc3NTk=,Freebayes call by snippy,CLOSED,2018-05-02T19:47:13Z,2018-05-03T01:09:18Z,2018-05-03T01:09:18Z,"Hello,

I had a couple of questions regarding the call to freebayes snippy makes.

When looking at the call to freebayes in a recent run of snippy, freebayes was called as follows:

`### freebayes-parallel reference/ref.txt 8 -p 2 -P 0.5 -q 13 -m 60 --min-repeat-entropy 1.0 -f reference/ref.fa snps.bam > snps.raw.vcf`

From my understanding, the -p parameter of freebayes sets the ploidy; why would ploidy be set to 2, if snippy is working with a haploid genome (Pseudomonas aeruginosa in my case)?

Further, does use of the --min-cov or --minfrac change prevent the use of --min-repeat-entropy parameter? And how does the use of these parameters affect the -P 0.05 option of freebayes (required probability of a polymorphism)?

Any response is greatly appreciated.

Thank you,
Conrad Izydorczyk

",cizydorczyk,https://github.com/tseemann/snippy/issues/158
MDU6SXNzdWUzMjAwNjI5Njc=,Linuxbrew link is broken in readme,CLOSED,2018-05-03T20:11:24Z,2018-05-04T03:36:45Z,2018-05-04T03:36:45Z,"Hi,

I noticed a small bug here in the README.md file.

https://github.com/tseemann/snippy/blob/82baf13f8739e7102c4a9359f018a616837a0162/README.md#L57

the correct link for linuxbrew would be 

`[LinuxBrew](http://linuxbrew.sh/)`

I'm interested to try this software, and I've already used prokka a ton. Thanks for your hard work generating these pieces of software to make my life easier.",davised,https://github.com/tseemann/snippy/issues/159
MDU6SXNzdWUzMjMyNTA4NTk=,stringency of calling and filteration,CLOSED,2018-05-15T14:45:54Z,2020-03-02T23:55:57Z,2018-05-21T05:01:50Z,"Hi Torsten,

First thanks for this great tool and then I've got a few questions need your help.

I used to call snp through the bowtie2+freebayes pipeline, and recently changed to snippy, so I'm kind of comparing the results generated from both to see if they are consistent.

I noticed that snippy sets the minimum mapping quality to 60 when running freebayes and wondering if there is a reason for this. Would it be too stringent? 

If I use the latest bowtie2 for the mapping, which value should I use then, let's say if I want to obtain the nearly same result? I used 30 (minimum mapping quality) in the bowtie2+freebayes before, which I thought was stringent enough, so it turns out maybe not actually true?

Regarding downstream variants filteration, how the default values used in snippy compare with the traditional strategies, such as filtering by quality, alternative fraction, reads count, etc..If you could explain a little bit on how and why you choose those as defaults. 

Thanks

Yu
      ",fengyuchengdu,https://github.com/tseemann/snippy/issues/160
MDU6SXNzdWUzMjM0MTU1OTk=,Freebayes --ploidy option in Snippy 4.0-dev2,CLOSED,2018-05-15T23:12:29Z,2018-05-18T08:30:45Z,2018-05-16T21:44:17Z,"Hi Torsten, 

I was just comparing a run with Snippy v3.2 to one with Snippy v4.0-dev2, and I have one question: why was the freebayes --ploidy option changed from 1 to 2? This was the only change I saw that puzzled me, and I just wanted to double check that it was intentional.

Thanks!
Arianna",amilesj,https://github.com/tseemann/snippy/issues/161
MDU6SXNzdWUzMjM4MDgxODA=,"Add flexibility to ""core site"" definition in snippy-core?",OPEN,2018-05-16T22:19:38Z,2019-08-01T20:40:59Z,,"I'm not sure how much of a pain this would be, but it would be very cool if future versions of snippy allowed the user to modify the ""core site"" threshold from being present in 100% of samples to being present in 99% of samples, 95% of samples, etc. ",amilesj,https://github.com/tseemann/snippy/issues/162
MDU6SXNzdWUzMjM5NjUzMzA=,snippy-core uses too much RAM,CLOSED,2018-05-17T10:33:49Z,2018-08-05T04:16:09Z,2018-08-05T04:16:09Z,"
For many isolates >3000 with lots of SNPs it can reach 100 GB RAM   

Need to fix this.
",tseemann,https://github.com/tseemann/snippy/issues/163
MDU6SXNzdWUzMjQ3MDEwMjI=,empty results,CLOSED,2018-05-20T11:06:59Z,2018-05-26T11:37:11Z,2018-05-26T11:37:11Z,"Hi, I'm trying to run snippy v4.0-dev and v4.0-dev2 and I find output files (also test files from snippy directory) are empty. I attach the logfile. Perhaps is due that I'm using a virtual machine with Ubuntu 14?
Thanks, 
María
[snps.log](https://github.com/tseemann/snippy/files/2020273/snps.log)

 
",mdtorohernando,https://github.com/tseemann/snippy/issues/164
MDU6SXNzdWUzMjcwMTQ4OTU=,snippy4 dependency issue,CLOSED,2018-05-28T12:46:42Z,2018-05-31T05:35:33Z,2018-05-31T05:35:33Z,"Hi Thorsten,
I am trying to test the snippy4 dev2 version. I installed the snippy4 conda package but used the source of the latest release for calling snippy. It passes the depenency checks, however can't find some files related to freebayes:
My error is here:
```
freebayes-parallel reference/ref.txt 20 -p 2 -P 0.5 -q 13 -m 60 --min-repeat-entropy 1.0 -f reference/ref.fa snps.bam > snps.raw.vcf
.../envs/snippy4/bin/freebayes-parallel: line 40: ../vcflib/scripts/vcffirstheader: No such file or directory
.../envs/snippy4/bin/freebayes-parallel: line 40: ../vcflib/bin/vcfstreamsort: No such file or directory
```
When I search for the missing files, I see that vcfstreamsort is in the bin folder and vcffirstheader is missing alltogether:
```
$ find . -name 'vcff*'
./bin/vcffixup
./bin/vcffilter
./bin/vcfflatten

$ find . -name 'vcfstr*'                                                                                                                                                                                                                     
./bin/vcfstreamsort
```

In snippy v 3.2 the files were here

```
$ find . -name 'vcff*'
./binaries/noarch/vcffirstheader
./bin/vcffixup
./bin/vcffilter
./bin/vcfflatten

$ find . -name 'vcfstream'                                                                                                                                                                                                                   
(snippy) denekec@maslxlabhpc01 20180528-14:21:37 ~/anaconda3/envs/snippy
$ find . -name 'vcfstream*'
./binaries/linux/vcfstreamsort
./binaries/darwin/vcfstreamsort
```

Maybe I should test snippy4 without the conda environment? It however does not pass the `snippy --check`:

```
$ snippy --check
perl: symbol lookup error: /home/xxx/perl5/lib/perl5/x86_64-linux-gnu-thread-multi/auto/List/Util/Util.so: undefined symbol: Perl_xs_apiversion_bootcheck
```",crarlus,https://github.com/tseemann/snippy/issues/165
MDU6SXNzdWUzMjcxNjUxOTc=,Add back consensus[.subs].fa outputs,CLOSED,2018-05-29T04:18:51Z,2018-05-31T07:11:05Z,2018-05-31T07:11:05Z,"But make all the .gz.tbi stuff temporary
",tseemann,https://github.com/tseemann/snippy/issues/166
MDU6SXNzdWUzMjcxNjU0MDE=,Filter zones with nearby het calls,OPEN,2018-05-29T04:20:25Z,2018-05-29T04:20:25Z,,"The problem is when we get zones of mixed population, some SNPs are het, others are hom. The whole region can't be trusted.

",tseemann,https://github.com/tseemann/snippy/issues/167
MDU6SXNzdWUzMjcxNjU1MDU=,Option to mask self-repeats,CLOSED,2018-05-29T04:21:16Z,2018-07-06T07:58:08Z,2018-07-06T07:58:08Z,"Align ref to itself and identify repeat regions, and don't report SNPs in those areas.

Done by COMPASS, CRYPTIC, NASP ?
",tseemann,https://github.com/tseemann/snippy/issues/168
MDU6SXNzdWUzMjcxNjU2NTQ=,Add option to subsample reads to a fraction,CLOSED,2018-05-29T04:22:25Z,2018-05-31T05:32:41Z,2018-05-31T05:32:41Z,"`--subsample 0.5` to use half of the reads via `seqtk sample FILE 0.5` 

Could auto-detect this like shovill does, but for now this is useful.

If you want to use BASH syntax for subshells:
```
$ENV{PERL5SHELL} = ""bash"";
```
See `perlrun(5)`",tseemann,https://github.com/tseemann/snippy/issues/169
MDU6SXNzdWUzMjgwMDI5OTI=,"--types snps,mnps misses complex mnps ?",CLOSED,2018-05-31T05:52:22Z,2018-07-07T03:18:50Z,2018-07-07T03:18:50Z,"Could be a bug :(
",tseemann,https://github.com/tseemann/snippy/issues/170
MDU6SXNzdWUzMjgwMzgyNDI=,Fix logging so it is like Shovill,OPEN,2018-05-31T08:17:01Z,2018-05-31T08:17:01Z,,,tseemann,https://github.com/tseemann/snippy/issues/171
MDU6SXNzdWUzMjg3MjM4Mjk=,Error running command,CLOSED,2018-06-02T07:49:44Z,2023-04-02T18:43:56Z,2018-06-06T10:57:36Z,"Hi,
It's the first time I use snippy and I run it in a virtual machine of Bio-Linux (Ubuntu 14.04) system. I want to use it to compare Vibrio genomes, but there is an error when I compared one genome (fasta file contains contigs) with a genbank format reference.  I copy the information on the screen below. Would you please take a look and help me to find out what the trouble is ?
Best regards,
Hong
--------------------------------------------------------------------
--------------------------------------------------------------------
manager@bl8vbox[251] snippy --outdir mut3 --ref BB22OP.gbk --ctgs 2520_CDC_K5330.fas 
[15:29:26] This is snippy 4.0-dev2
[15:29:26] Written by Torsten Seemann
[15:29:26] Obtained from https://github.com/tseemann/snippy
[15:29:26] Detected operating system: linux
[15:29:26] Enabling bundled linux tools.
[15:29:26] Found bwa - /usr/bin/bwa
[15:29:26] Found bcftools - /usr/local/bin/bcftools
[15:29:26] Found samtools - /usr/local/bin/samtools
[15:29:26] Found snpEff - /home/manager/software/snippy/binaries/noarch/snpEff
[15:29:26] Found java - /usr/bin/java
[15:29:26] Found gzip - /bin/gzip
[15:29:26] Found samclip - /home/manager/software/samclip/samclip
[15:29:26] Found seqtk - /home/manager/software/seqtk/seqtk
[15:29:26] Found parallel - /usr/bin/parallel
[15:29:26] Found freebayes - /usr/local/bin/freebayes
[15:29:26] Found freebayes-parallel - /home/manager/software/snippy/binaries/noarch/freebayes-parallel
[15:29:26] Found fasta_generate_regions.py - /home/manager/software/snippy/binaries/noarch/fasta_generate_regions.py
[15:29:26] Found vcfstreamsort - /home/manager/software/vcflib/bin/vcfstreamsort
[15:29:26] Found vcfuniq - /home/manager/software/vcflib/bin/vcfuniq
[15:29:26] Found vcffirstheader - /home/manager/software/vcflib/bin/vcffirstheader
[15:29:26] Found snippy-vcf_to_tab - /home/manager/software/snippy/bin/snippy-vcf_to_tab
[15:29:26] Found snippy-vcf_report - /home/manager/software/snippy/bin/snippy-vcf_report
[15:29:26] Checking version: samtools --version is >= 1.7 - ok, have 1.7
[15:29:26] Checking version: bcftools --version is >= 1.7 - ok, have 1.8
[15:29:26] Checking version: freebayes --version is >= 1.1 - ok, have 1.2
[15:29:27] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[15:29:27] Using reference: /home/manager/data/genomes/251/BB22OP.gbk
[15:29:27] Treating reference as 'genbank' format.
[15:29:27] Will use 8 CPU cores.
[15:29:27] Using read file: /home/manager/data/genomes/251/2520_CDC_K5330.fas
[15:29:27] Creating folder: mut3
[15:29:27] Changing working directory: mut3
[15:29:27] Creating reference folder: reference
[15:29:27] Extracting FASTA and GFF from reference.
[15:29:31] Wrote 1 sequences to ref.fa
[15:29:31] Wrote 4690 features to ref.gff
[15:29:31] Shredding /home/manager/data/genomes/251/2520_CDC_K5330.fas into pseudo-reads
[15:29:35] Wrote 442846 fake 250bp reads (20x, stride 25bp) to fake_reads.fq
[15:29:35] Creating reference/snpeff.config
[15:29:35] Freebayes will process 15 chunks of 345914 bp, 8 chunks at a time.
[15:29:35] Using BAM RG (Read Group) ID: mut3
[15:29:35] Running: samtools faidx reference/ref.fa 2>> snps.log
[15:29:35] Running: bwa index reference/ref.fa 2>> snps.log
[15:29:43] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[15:29:43] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[15:29:43] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[15:29:49] Running: bwa mem  -Y -M -R '@RG\tID:mut3\tSM:mut3' -t 8 reference/ref.fa fake_reads.fq | samclip --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.9749. --threads 8 -m 1000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.9749. --threads 8 -m 1000M | samtools markdup -T /tmp/snippy.9749. -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.2 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 320000 sequences (80000000 bp)...
[M::process] read 122846 sequences (30711500 bp)...
[M::mem_process_seqs] Processed 320000 reads in 78.584 CPU sec, 45.638 real sec
samtools sort: couldn't allocate memory for bam_mem
samtools sort: couldn't allocate memory for bam_mem
[15:30:35] Running: samtools index snps.bam 2>> snps.log
[15:30:35] Running: fasta_generate_regions.py reference/ref.fa.fai 345914 > reference/ref.txt 2>> snps.log
[15:30:35] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0.5 -q 13 -m 60 --min-repeat-entropy 1.0 -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[15:30:36] Error running command, check mut3/snps.log
------------------------------------------------------------------------------------
------------------------------------------------------------------------------------",hngyou,https://github.com/tseemann/snippy/issues/172
MDU6SXNzdWUzMjg4MDI0NTk=,snps.report.txt has MAPQ < 60 reads,CLOSED,2018-06-03T06:05:30Z,2018-06-03T06:56:14Z,2018-06-03T06:56:14Z,"Although SNP called only uses MAPQ >= 60, tview is using all reads.

Causes confusion between SNP calls and Stacked report.

This didn't happen in Snippy3 because the BAM was kept ""lean"".
",tseemann,https://github.com/tseemann/snippy/issues/173
MDU6SXNzdWUzMjg4MDQ5NTI=,"Document -- basequal, mapqual, maxsoft",CLOSED,2018-06-03T06:58:17Z,2018-07-07T07:32:30Z,2018-07-07T07:32:30Z,"Prefer user didn't change them though.
Mapqual is important.
",tseemann,https://github.com/tseemann/snippy/issues/174
MDU6SXNzdWUzMzAwODUwNDk=,Issue using GenBank files from prokka as reference,CLOSED,2018-06-07T01:24:08Z,2018-06-07T02:09:56Z,2018-06-07T02:09:56Z,"I looked around the issues and I couldn't see this one come up - hopefully I didn't miss it anywhere!

I'm having trouble running snippy using a specific reference genome: this is a .gbk that I assembled via SPAdes and annotated using prokka. I use a simple bash script to automate (given in the code as snippy_run.sh), but the problem occurs only when I use the GenBank file; I can run the script (and snippy) fine using the fasta file produced in prokka as the reference, but ideally I would like annotated SNPs as output. Other .gbk references from NCBI also work fine for me.

Based on the error messages, it seems related to this problem discussed on [BioStars](https://www.biostars.org/p/155268/) (specifically the second response, which mentions the gff3toembl tool for use on prokka output). I suspect I'll need to use something to adjust the prokka-produced file prior to running it through snippy, but I'm not sure what. 

Any help would be appreciated! 

```
$ bash snippy_run.sh SRR5238166.gbk javalist.csv
*** Samples: SRR3294513 SRR3182472 SRR3182490 SRR3457661 SRR3457664 SRR3457662 SRR3457665 SRR3457658 SRR3457660 SRR5238148 SRR5238235 SRR5238249 SRR5238264 SRR5318402 SRR5318398 SRR5366629 SRR5470972 SRR5470970 SRR5470973 SRR5470976
*** Logging to: snippy_with_SRR5238166.gbk/runlog_snippy_SRR5238166.gbk.txt
*** Run snippy on all samples in javalist.csv
*** Running snippy on SRR3294513
[11:46:05] This is snippy 3.2-dev
[11:46:05] Written by Torsten Seemann <torsten.seemann@gmail.com>
[11:46:05] Obtained from https://github.com/tseemann/snippy
[11:46:05] Detected operating system: linux
[11:46:05] Enabling bundled linux tools.
[11:46:05] Found bwa - /home/sabrina/miniconda3/envs/bioinfo/bin/bwa
[11:46:05] Found samtools - /home/sabrina/miniconda3/envs/bioinfo/bin/samtools
[11:46:05] Found tabix - /home/sabrina/miniconda3/envs/bioinfo/bin/tabix
[11:46:05] Found bgzip - /home/sabrina/miniconda3/envs/bioinfo/bin/bgzip
[11:46:05] Found snpEff - /home/sabrina/miniconda3/envs/bioinfo/bin/snpEff
[11:46:05] Found java - /home/sabrina/miniconda3/envs/bioinfo/bin/java
[11:46:05] Found gzip - /bin/gzip
[11:46:05] Found parallel - /home/sabrina/miniconda3/envs/bioinfo/bin/parallel
[11:46:05] Found freebayes - /home/sabrina/miniconda3/envs/bioinfo/bin/freebayes
[11:46:05] Found freebayes-parallel - /home/sabrina/miniconda3/envs/bioinfo/bin/freebayes-parallel
[11:46:05] Found fasta_generate_regions.py - /home/sabrina/miniconda3/envs/bioinfo/bin/fasta_generate_regions.py
[11:46:05] Found vcfstreamsort - /home/sabrina/miniconda3/envs/bioinfo/bin/vcfstreamsort
[11:46:05] Found vcfuniq - /home/sabrina/miniconda3/envs/bioinfo/bin/vcfuniq
[11:46:05] Found vcffirstheader - /home/sabrina/miniconda3/envs/bioinfo/bin/vcffirstheader
[11:46:05] Found vcf-consensus - /home/sabrina/miniconda3/envs/bioinfo/bin/../binaries/noarch/vcf-consensus
[11:46:05] Found snippy-vcf_to_tab - /home/sabrina/miniconda3/envs/bioinfo/bin/snippy-vcf_to_tab
[11:46:05] Found snippy-vcf_report - /home/sabrina/miniconda3/envs/bioinfo/bin/snippy-vcf_report
[11:46:05] Found snippy-vcf_filter - /home/sabrina/miniconda3/envs/bioinfo/bin/snippy-vcf_filter
[11:46:05] Checking version: samtools --version is >= 1.3 - ok, have 1.8
[11:46:05] Checking version: freebayes --version is >= 1.1 - ok, have 1.1
[11:46:05] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[11:46:05] Using reference: /home/sabrina/refs/assemblies/SRR5238166.gbk
[11:46:05] Treating reference as 'genbank' format.
[11:46:05] Will use 8 CPU cores.
[11:46:05] Using read file: /home/sabrina/NGS/Salmonella_java/trimmed_reads/SRR3294513_1_val_1.fq
[11:46:05] Using read file: /home/sabrina/NGS/Salmonella_java/trimmed_reads/SRR3294513_2_val_2.fq
[11:46:05] Creating folder: snippy_with_SRR5238166.gbk/SRR3294513
[11:46:05] Changing working directory: snippy_with_SRR5238166.gbk/SRR3294513
[11:46:05] Creating reference folder: reference
[11:46:05] Extracting FASTA and GFF from reference.

--------------------- WARNING ---------------------
MSG: Bad LOCUS name?  Changing [NODE_1_length_604759_cov_36.278604759] to 'unknown' and length to 'NODE_1_length_604759_cov_36.278604759'
---------------------------------------------------

--------------------- WARNING ---------------------
MSG: Bad LOCUS name?  Changing [NODE_2_length_397537_cov_32.5288397537] to 'unknown' and length to 'NODE_2_length_397537_cov_32.5288397537'
---------------------------------------------------
[11:46:05] Duplicate sequence unknown in /home/sabrina/refs/assemblies/SRR5238166.gbk
```
",sabrinadiemert,https://github.com/tseemann/snippy/issues/175
MDU6SXNzdWUzMzAzMjg4Mjk=,ERROR(freebayes),CLOSED,2018-06-07T15:38:32Z,2019-03-06T15:58:31Z,2018-07-07T07:32:10Z,"Hi, I get the following error (see below) regarding freebayes when using a gb file as reference.
In addition, when I try a .fasta file as reference I also get an error: "" invalid reference""
Any insights what could be the problem? thanks!

### cd /home/cobos

### /home/cobos/programs/snippy/bin/snippy --cpus 16 --outdir /home/cobos/PROJECTS/A_fumigatus/mysnps_Af293vsP1MR --ref /home/cobos/PROJECTS/A_fumigatus/Reference_genome_Af293_chromosomes/Af293_chrs.gb --R1 /home/cobos/PROJECTS/A_fumigatus/Clinical_samples_trimmed_fastQ/P1MR_trimmed_R1.fastq --R2 /home/cobos/PROJECTS/A_fumigatus/Clinical_samples_trimmed_fastQ/P1MR_trimmed_R2.fastq

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.18 sec
[bwa_index] Construct BWT for the packed sequence...
[BWTIncCreate] textLength=58769916, availableWord=16134824
[BWTIncConstructFromPacked] 10 iterations done. 26614380 characters processed.
[BWTIncConstructFromPacked] 20 iterations done. 49166028 characters processed.
[bwa_index] 10.72 seconds elapse.
[bwa_index] Update BWT... 0.13 sec
[bwa_index] Pack forward-only FASTA... 0.11 sec
[bwa_index] Construct SA from BWT and Occ... 6.07 sec
[main] Version: 0.7.5a-r405
[main] CMD: bwa index reference/ref.fa
[main] Real time: 17.429 sec; CPU: 17.224 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:mysnps_Af293vsP1MR\tSM:mysnps_Af293vsP1MR' -t 16 reference/ref.fa /home/cobos/PROJECTS/A_fumigatus/Clinical_samples_trimmed_fastQ/P1MR_trimmed_R1.fastq /home/cobos/PROJECTS/A_fumigatus/Clinical_samples_trimmed_fastQ/P1MR_trimmed_R2.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.21174. --threads 8 -m 1000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.21174. --threads 8 -m 1000M | samtools markdup -T /tmp/snippy.21174. -r -s - - > snps.bam

READ 0 WRITTEN 0 
EXCLUDED 0 EXAMINED 0
PAIRED 0 SINGLE 0
DULPICATE PAIR 0 DUPLICATE SINGLE 0
DUPLICATE TOTAL 0

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 963722 > reference/ref.txt


### freebayes-parallel reference/ref.txt 16 -p 2 -P 0.5 -q 13 -m 60 --no-partial-observations --haplotype-length 0 --min-repeat-entropy 1.0 -f reference/ref.fa snps.bam > snps.raw.vcf

Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007194:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007194:963722..1927444
Error: Failed to set region: -1:1,927,444-2,891,166(*)
ERROR(freebayes): Could not SetRegion to NC_007194:1927444..2891166
Error: Failed to set region: -1:2,891,166-3,854,888(*)
ERROR(freebayes): Could not SetRegion to NC_007194:2891166..3854888
Error: Failed to set region: -1:3,854,888-4,818,610(*)
ERROR(freebayes): Could not SetRegion to NC_007194:3854888..4818610
Error: Failed to set region: -1:4,818,610-4,918,979(*)
ERROR(freebayes): Could not SetRegion to NC_007194:4818610..4918979
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007195:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007195:963722..1927444
Error: Failed to set region: -1:1,927,444-2,891,166(*)
ERROR(freebayes): Could not SetRegion to NC_007195:1927444..2891166
Error: Failed to set region: -1:2,891,166-3,854,888(*)
ERROR(freebayes): Could not SetRegion to NC_007195:2891166..3854888
Error: Failed to set region: -1:3,854,888-4,818,610(*)
ERROR(freebayes): Could not SetRegion to NC_007195:3854888..4818610
Error: Failed to set region: -1:4,818,610-4,844,472(*)
ERROR(freebayes): Could not SetRegion to NC_007195:4818610..4844472
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007196:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007196:963722..1927444
Error: Failed to set region: -1:1,927,444-2,891,166(*)
ERROR(freebayes): Could not SetRegion to NC_007196:1927444..2891166
Error: Failed to set region: -1:2,891,166-3,854,888(*)
ERROR(freebayes): Could not SetRegion to NC_007196:2891166..3854888
Error: Failed to set region: -1:3,854,888-4,079,167(*)
ERROR(freebayes): Could not SetRegion to NC_007196:3854888..4079167
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007197:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007197:963722..1927444
Error: Failed to set region: -1:1,927,444-2,891,166(*)
ERROR(freebayes): Could not SetRegion to NC_007197:1927444..2891166
Error: Failed to set region: -1:2,891,166-3,854,888(*)
ERROR(freebayes): Could not SetRegion to NC_007197:2891166..3854888
Error: Failed to set region: -1:3,854,888-3,923,705(*)
ERROR(freebayes): Could not SetRegion to NC_007197:3854888..3923705
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007198:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007198:963722..1927444
Error: Failed to set region: -1:1,927,444-2,891,166(*)
ERROR(freebayes): Could not SetRegion to NC_007198:1927444..2891166
Error: Failed to set region: -1:2,891,166-3,854,888(*)
ERROR(freebayes): Could not SetRegion to NC_007198:2891166..3854888
Error: Failed to set region: -1:3,854,888-3,948,441(*)
ERROR(freebayes): Could not SetRegion to NC_007198:3854888..3948441
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007199:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007199:963722..1927444
Error: Failed to set region: -1:1,927,444-2,891,166(*)
ERROR(freebayes): Could not SetRegion to NC_007199:1927444..2891166
Error: Failed to set region: -1:2,891,166-3,778,736(*)
ERROR(freebayes): Could not SetRegion to NC_007199:2891166..3778736
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007200:0..963722
Error: Failed to set region: -1:963,722-1,927,444(*)
ERROR(freebayes): Could not SetRegion to NC_007200:963722..1927444
Error: Failed to set region: -1:1,927,444-2,058,334(*)
ERROR(freebayes): Could not SetRegion to NC_007200:1927444..2058334
Error: Failed to set region: -1:0-963,722(*)
ERROR(freebayes): Could not SetRegion to NC_007201:0..963722
Error: Failed to set region: -1:963,722-1,833,124(*)
ERROR(freebayes): Could not SetRegion to NC_007201:963722..1833124

### bcftools view --include 'GT=""1/1"" && DP>=0 && AF>=0' -Ov -o snps.filt.vcf snps.raw.vcf

Both INFO/DP and FORMAT/DP exist, which one do you want?


",SGarciaCobos,https://github.com/tseemann/snippy/issues/176
MDU6SXNzdWUzMzEwODA4NTM=,Is it possible to use a consensus as the reference genome?,CLOSED,2018-06-11T07:54:38Z,2018-07-07T07:23:02Z,2018-07-07T07:23:02Z,"Hi, 
I have been downloading a reference genome to use in my analyses.
In the next stage of analysis, I would like to compare between my own samples. Therefore I would like to assign one of my sample as the reference instead.

In trying to do so, I have generated a consensus of one sample (after mapping to a reference genome). When exporting the consensus, I have made sure that I kept the name short and also wrapped the sequence sample to 80 char.

I have tried the same command with the original reference genome and it worked fine.
Not sure what I am doing wrong here.
[snps.log](https://github.com/tseemann/snippy/files/2089085/snps.log)


Thanks.
Kelvin :)
",k3lvie,https://github.com/tseemann/snippy/issues/177
MDU6SXNzdWUzMzE2MTY3NzI=,Need help about error,CLOSED,2018-06-12T14:37:24Z,2018-06-12T19:52:00Z,2018-06-12T19:52:00Z,"I kept get the blow error.

22:26:52]cau@cau-PowerEdge-T630:~/ZJR/SNP/data_P101SC18010669-01-B2-21/raw_data> [22:26:52] This is snippy 2.9
[22:26:52] Written by Torsten Seemann <torsten.seemann@gmail.com>
[22:26:52] Obtained from https://github.com/tseemann/snippy
[22:26:52] Detected operating system: linux
[22:26:52] Enabling bundled linux tools.
[22:26:52] Found bwa - /usr/bin/bwa
[22:26:52] Found samtools - /usr/bin/samtools
[22:26:52] Found tabix - /usr/bin/tabix
[22:26:52] Found bgzip - /usr/bin/bgzip
[22:26:52] Found snpEff - /home/cau/bin/snippy-2.9/bin/../binaries/noarch/snpEff
[22:26:52] Found java - /usr/bin/java
[22:26:52] Found gzip - /bin/gzip
[22:26:52] Found parallel - /home/cau/bin/snippy-2.9/bin/../binaries/noarch/parallel
[22:26:52] Found freebayes - /usr/local/bin/freebayes
[22:26:52] Found freebayes-parallel - /home/cau/bin/snippy-2.9/bin/../binaries/noarch/freebayes-parallel
[22:26:52] Found fasta_generate_regions.py - /home/cau/bin/snippy-2.9/bin/../binaries/noarch/fasta_generate_regions.py
[22:26:52] Found vcfstreamsort - /home/cau/source/vcflib/bin/vcfstreamsort
[22:26:52] Found vcfuniq - /home/cau/source/vcflib/bin/vcfuniq
[22:26:52] Found vcffirstheader - /home/cau/source/vcflib/bin/vcffirstheader
[22:26:52] Found vcf-consensus - /home/cau/bin/vcftools/bin/vcf-consensus
[22:26:52] Found snippy-vcf_to_tab - /home/cau/bin/snippy-2.9/bin/snippy-vcf_to_tab
[22:26:52] Found snippy-vcf_report - /home/cau/bin/snippy-2.9/bin/snippy-vcf_report
[22:26:52] Found snippy-vcf_filter - /home/cau/bin/snippy-2.9/bin/snippy-vcf_filter
[22:26:52] Using reference: /home/cau/ZJR/SNP/data_P101SC18010669-01-B2-21/raw_data/ST870.gbk
[22:26:52] Will use 8 CPU cores.
[22:26:52] Using read file: /home/cau/ZJR/SNP/data_P101SC18010669-01-B2-21/raw_data/s870pbm_H773LDMXX_L1_1.fq.gz
[22:26:52] Using read file: /home/cau/ZJR/SNP/data_P101SC18010669-01-B2-21/raw_data/s870pbm_H773LDMXX_L1_2.fq.gz
[22:26:52] Creating folder: mysnps
[22:26:52] Changing working directory: mysnps
[22:26:52] Creating reference folder: reference
[22:26:52] Extracting FASTA and GFF from reference.
[22:26:53] Wrote 1 sequences to ref.fa
[22:26:53] Wrote 2375 features to ref.gff
[22:26:53] Creating reference/snpeff.config
[22:26:53] Freebayes will process 32 chunks of 69966 bp, 8 chunks at a time.
[22:26:53] Using BAM RG (Read Group) ID: snps
[22:26:53] Running: samtools faidx reference/ref.fa 2>> snps.log
[22:26:53] Running: bwa index reference/ref.fa 2>> snps.log
[22:26:54] Running: mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[22:26:54] Running: mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[22:26:54] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[22:26:57] Running: (bwa mem  -v 2 -M -R '@RG   ID:snps SM:snps' -t 8 reference/ref.fa /home/cau/ZJR/SNP/data_P101SC18010669-01-B2-21/raw_data/s870pbm_H773LDMXX_L1_1.fq.gz /home/cau/ZJR/SNP/data_P101SC18010669-01-B2-21/raw_data/s870pbm_H773LDMXX_L1_2.fq.gz | samtools view -@ 8 -F 3844 -q 60 -S -b -u -T ref.fa - | samtools sort -@ 8 - snps) 2>> snps.log
[22:28:47] Running: samtools index snps.bam 2>> snps.log
[22:28:52] Running: samtools depth -q 20 snps.bam | bgzip > snps.depth.gz 2>> snps.log
[22:29:14] Running: tabix -s 1 -b 2 -e 2 snps.depth.gz 2>> snps.log
[22:29:14] Running: fasta_generate_regions.py reference/ref.fa.fai 69966 > reference/ref.txt 2>> snps.log
[22:29:14] Running: freebayes-parallel reference/ref.txt 8 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[22:29:33] Error running command, check mysnps/snps.log

the snps.log ending with 

### fasta_generate_regions.py reference/ref.fa.fai 69966 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf

  File ""/home/cau/source/vcflib/bin/vcffirstheader"", line 9
    print line.strip()
             ^
SyntaxError: invalid syntax

Thanks, any help?

",wangchywen,https://github.com/tseemann/snippy/issues/178
MDU6SXNzdWUzMzIyNTU3MTA=,"Add counter to snippy-core ""Sample ..."" ",CLOSED,2018-06-14T05:25:14Z,2018-07-07T07:32:20Z,2018-07-07T07:32:20Z,"SO i know where it is up to when > 1000 isolates

```
Sample  2017-07661      snp=5622        del=539 ins=324 unaligned=72421
Sample  2017-20344      snp=6208        del=657 ins=404 unaligned=29251
Sample  2017-15271      snp=7900        del=855 ins=548 unaligned=37934
Sample  2017-05579      snp=7875        del=768 ins=500 unaligned=35195
Sample  2017-16943      snp=5274        del=652 ins=341 unaligned=73375
```",tseemann,https://github.com/tseemann/snippy/issues/179
MDU6SXNzdWUzMzM4MTIwMTU=,Mask het sites?,CLOSED,2018-06-19T19:43:36Z,2018-07-07T07:30:59Z,2018-07-07T07:30:59Z,"Inès revealed problem where some samples get a 0/1 call and others get 1/1
The 0/1 gets filtered out, so ends up with the reference allele
It should probably be masked with N or X ?
",tseemann,https://github.com/tseemann/snippy/issues/180
MDU6SXNzdWUzMzQ3MzUwOTg=,add capability for snippy-core to accept gbk format as --ref,CLOSED,2018-06-22T03:48:54Z,2018-07-07T07:51:46Z,2018-07-07T07:51:46Z,"```
$ snippy-core --ref ../2012-15877.gbk *
------------- EXCEPTION -------------
MSG: The sequence does not appear to be FASTA format (lacks a descriptor line '>')
STACK Bio::SeqIO::fasta::next_seq /home/linuxbrew/.linuxbrew/Cellar/perl/5.26.2_2/lib/perl5/site_perl/5.26.2/Bio/SeqIO/fasta.pm:136
STACK main::load_fasta_hash /home/tseemann/git/snippy/bin/snippy-core:301
STACK toplevel /home/tseemann/git/snippy/bin/snippy-core:50
-------------------------------------
```",kwongj,https://github.com/tseemann/snippy/issues/181
MDU6SXNzdWUzMzUwMjQ4MTI=,samtools 1.7 not found.,CLOSED,2018-06-22T21:29:50Z,2019-06-12T03:19:07Z,2018-06-28T16:53:01Z,"Hi @tseemann, I am trying to use snippy but running into a rather simple problem that I dont seem to be able to fix/ figure out why. I have the required samtools in the path, but for some reason snippy is not finding it. here is what i did:

```
$ snippy -outdir BBO --ref Burkh_genomic.fna -cpus 2 --pe1 BBO_trimmed_R1.fastq --pe2 BBO_trimmed_R2.fastq
[15:22:02] This is snippy 4.0-dev
[15:22:02] Written by Torsten Seemann
[15:22:02] Obtained from https://github.com/tseemann/snippy
[15:22:02] Detected operating system: linux
[15:22:02] Enabling bundled linux tools.
[15:22:02] Found bwa - /panfs/biopan01/apps/Anaconda3/bin/bwa
[15:22:02] Found bcftools - /panfs/biopan01/apps/Anaconda3/bin/bcftools
[15:22:02] Found samtools - /panfs/biopan01/apps/Anaconda3/bin/samtools
[15:22:02] Found snpEff - /panfs/biopan01/apps/Anaconda3/bin/snpEff
[15:22:02] Found java - /panfs/biopan01/apps/Anaconda3/bin/java
[15:22:02] Found gzip - /usr/bin/gzip
[15:22:02] Found samclip - /panfs/biopan01/apps/Anaconda3/bin/samclip
[15:22:02] Found parallel - /panfs/biopan01/apps/Anaconda3/bin/parallel
[15:22:02] Found freebayes - /panfs/biopan01/apps/Anaconda3/bin/freebayes
[15:22:02] Found freebayes-parallel - /panfs/biopan01/apps/Anaconda3/bin/freebayes-parallel
[15:22:02] Found fasta_generate_regions.py - /panfs/biopan01/apps/Anaconda3/bin/fasta_generate_regions.py
[15:22:02] Found vcfstreamsort - /panfs/biopan01/apps/Anaconda3/bin/vcfstreamsort
[15:22:02] Found vcfuniq - /panfs/biopan01/apps/Anaconda3/bin/vcfuniq
[15:22:02] Found vcffirstheader - /panfs/biopan01/apps/Anaconda3/bin/vcffirstheader
[15:22:02] Found snippy-vcf_to_tab - /panfs/biopan01/apps/Anaconda3/bin/snippy-vcf_to_tab
[15:22:02] Found snippy-vcf_report - /panfs/biopan01/apps/Anaconda3/bin/snippy-vcf_report
[15:22:03] Need samtools --version >= 1.7 but you have 0 - please upgrade it.

$ samtools

Program: samtools (Tools for alignments in the SAM format)
Version: 1.7 (using htslib 1.7)

Usage:   samtools <command> [options]

Commands:
  -- Indexing
     dict           create a sequence dictionary file
     faidx          index/extract FASTA
     index          index alignment

  -- Editing
     calmd          recalculate MD/NM tags and '=' bases
     fixmate        fix mate information
     reheader       replace BAM header
     targetcut      cut fosmid regions (for fosmid pool only)
     addreplacerg   adds or replaces RG tags
     markdup        mark duplicates

  -- File operations
     collate        shuffle and group alignments by name
     cat            concatenate BAMs
     merge          merge sorted alignments
     mpileup        multi-way pileup
     sort           sort alignment file
     split          splits a file by read group
     quickcheck     quickly check if SAM/BAM/CRAM file appears intact
     fastq          converts a BAM to a FASTQ
     fasta          converts a BAM to a FASTA

  -- Statistics
     bedcov         read depth per BED region
     depth          compute the depth
     flagstat       simple stats
     idxstats       BAM index stats
     phase          phase heterozygotes
     stats          generate stats (former bamcheck)

  -- Viewing
     flags          explain BAM flags
     tview          text alignment viewer
     view           SAM<->BAM<->CRAM conversion
     depad          convert padded BAM to unpadded BAM

```
Thanks for the help.

Migun
",mshakya,https://github.com/tseemann/snippy/issues/182
MDU6SXNzdWUzMzU2NDE2ODQ=,The fasta sequence does not match the REF ,CLOSED,2018-06-26T03:09:06Z,2018-08-21T02:08:15Z,2018-06-26T03:38:29Z,"Hi Torsten,

I have exported a consensus sequence from a sample to use as a reference in snippy, but I received this error message:

### vcf-consensus snps.vcf.gz < reference/ref.fa > snps.consensus.fa

The fasta sequence does not match the REF at C16SRHH060:217410. Y(AAAATA) in .fa, N in .vcf, frz=216930
 at /home/ubuntu/snippy/bin/../binaries/noarch/vcf-consensus line 20, <STDIN> line 3625.

Can you please advise what is wrong?

Thank you.

Kind Regards,
Kelvin",kelvin-wcl,https://github.com/tseemann/snippy/issues/183
MDU6SXNzdWUzMzYxNDk3NjQ=,mapping several libraries of same genome to one ref,CLOSED,2018-06-27T09:32:21Z,2018-06-28T02:40:07Z,2018-06-28T02:38:47Z,"I wonder how you can do it.

Let's say I have these reads for one genome:
library (i) sample_A_i_R1.fastq.gz sample_A_i_R2.fastq.gz
library (ii) sample_A_ii_R1.fastq.gz sample_A_ii_R2.fastq.gz

So 2 sets of reads (2 libraries) from the same genome.

Can we use all of them when using snippy?
I know for one assembly you can use several libraries.
Does snippy already have this function or not? ",sbridel,https://github.com/tseemann/snippy/issues/184
MDU6SXNzdWUzMzY0NTQzOTk=,Print some summary information with snippy-core about reference,OPEN,2018-06-28T02:51:18Z,2018-06-28T02:52:09Z,,"It might be useful to print the median, IQR, min and max core SNP distance to the reference as an output from `snippy-core`. 

I am thinking this might be a useful QC bit of data to display in Nullarbor reports.

Thinking out loud!",andersgs,https://github.com/tseemann/snippy/issues/185
MDU6SXNzdWUzMzgwOTM4MDY=,snippy-core bedfile mask only retains last entry,CLOSED,2018-07-04T00:30:02Z,2018-07-06T05:02:18Z,2018-07-06T05:02:18Z,"When you supply a mask file for snippy-core, only the last bedfile entry is used in the masking process. It correctly identifies the number of bed entries but only keeps the last one.

snippy-core --mask mask.bed --verbose SRR1264998_snippy/

NZ_CP012921.1 | 1 | 4751447
NZ_CP012921.1 | 21097 | 21097
NZ_CP012921.1 | 33581 | 33581
NZ_CP012921.1 | 157792 | 157792
NZ_CP012921.1 | 293728 | 293728
NZ_CP012921.1 | 300920 | 300920
NZ_CP012921.1 | 378270 | 378270

[19:23:14] Read 7 regions from BED file to mask SNPs from
$VAR1 = {
          'NZ_CP012921.1' => {
                               'END' => 378271,
                               'START' => '378270'
                             }
        };
",jrober84,https://github.com/tseemann/snippy/issues/186
MDU6SXNzdWUzMzkxMTE1MTU=,bcftools consensus warnings about missing header type,CLOSED,2018-07-07T02:51:43Z,2018-08-15T09:04:49Z,2018-08-15T09:04:49Z,"```
### bcftools consensus -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz

Note: the --sample option not given, applying all records

### bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf

[W::vcf_parse_format] FORMAT 'GT' is not defined in the header, assuming Type=String
[W::vcf_parse_format] FORMAT 'QR' is not defined in the header, assuming Type=String
[W::vcf_parse_format] FORMAT 'QA' is not defined in the header, assuming Type=String
```
",tseemann,https://github.com/tseemann/snippy/issues/187
MDU6SXNzdWUzMzkxMTU3Mjg=,Save BED file from --mask option (auto or otherwise),CLOSED,2018-07-07T04:17:22Z,2018-07-07T07:31:06Z,2018-07-07T07:31:06Z,"And document it.

",tseemann,https://github.com/tseemann/snippy/issues/188
MDU6SXNzdWUzMzkxMjgxNjM=,Document all the symbols in core.full.aln,CLOSED,2018-07-07T08:22:42Z,2018-07-07T08:44:25Z,2018-07-07T08:44:25Z,"```
AGTC
agtc
X
N
n
-
```
",tseemann,https://github.com/tseemann/snippy/issues/189
MDU6SXNzdWUzMzkxMzA1NDc=,False SNPs from insertions,CLOSED,2018-07-07T09:01:53Z,2018-07-30T06:51:00Z,2018-07-30T06:51:00Z,"These appear different at first sight
```
3/snps.vcf:AP009378     170474  .       GG      GCGAAAA 646.108 .      
AF=1;AO=23;DP=23;QA=782;QR=0;RO=0;TYPE=complex       
GT:DP:RO:QR:AO:QA:GL    1/1:23:0:0:23:782:-70.6857,-6.92369,0

4/snps.vcf:AP009378     170474  .       GGA     GCGAAAAA        1349.98 .   
    AF=1;AO=46;DP=47;QA=1628;QR=0;RO=0;TYPE=complex      
GT:DP:RO:QR:AO:QA:GL    1/1:47:0:0:46:1628:-146.466,-14.4494,0
```
leads to 
```
                                 REF    3       4
core.tab:AP009378       170475  G       C       C
core.tab:AP009378       170476  A       A       G
```
The pileups below seem to be the same?

Sample 3
```
         170461    170471
GTATGTGAGATGGGGTGGGGGGG*****GAATAATATT
.......................     A.........
, .....................CGAAAA.........
,    ..................CGAAAA.........
,    ..................CGAAAA.........
...  ..................CGAAAA.........
,,,,,     .............CGAAAA.........
,,,,,,    .............CGAAAA.........
........   ,,,,,,,,,,,,cgaaaa,,,,,,,,,
........    ,,,,,,,,,,,cgaaaa,,,,,,,,,
```

Sample 4:
```
         170461    170471
GTATGTGAGATGGGGTGGGGGGG*****GAATAATATT
.......................     A.........
,    ..................CGAAAA.........
...  ..................CGAAAA.........
...  ..................CGAAAA.........
...  ..................CGAAAA.........
...  ..................CGAAAA.........
,,,,,  ................CGAAAA.........
,,,,,     .............CGAAAA.........
,,,,,     .............CGAAAA.........

```

To me it's more likely
```
REF G-----G
ALT GcgaaaA
```
There are two interpretations.   
I think this is a known problem.
Joint SNP calling is probably needed for these cases.

This gives a consistent answer 
```
freebayes -r AP009378:170470-170485 -f core.ref.fa 3/snps.bam 4/snps.bam

#CHROM  POS     ID      REF     ALT     QUAL    FILTER  INFO    FORMAT  3       4
AP009378        170474  .       GGA     GCGAAAAA        2017.67 .   
    AB=0;ABP=0;AC=4;AF=1;AN=4;AO=69;CIGAR=1M5I1X1M;DP=70;DPB=185.333;DPRA=0;EPP=98.2089;EPPR=0;GTI=0;LEN=8;MEANALT=1.5;MQM=60;MQMR=0;NS=2;NUMALT=1;ODDS=40.3976;PAIRED=0.985507;PAIREDR=0;PAO=0.5;PQA=16.5;PQR=16.5;PRO=0.5;QA=2410;QR=0;RO=0;RPL=26;RPP=12.1053;RPPR=0;RPR=43;RUN=1;SAF=42;SAP=10.0912;SAR=27;SRF=0;SRP=0;SRR=0;TYPE=complex   
GT:DP:AD:RO:QR:AO:QA:GL 
1/1:23:0,23:0:0:23:782:-70.6857,-6.92369,0  
1/1:47:0,46:0:0:46:1628:-146.466,-14.4494,0
```
If in increase `--repeat-entropy 1.5` and 1.6 I get
```
AP009378        170474  .       GGAAT   GCGAAAAAAT
AP009378        170474  .       GGAATAATATTAATTATGATTGTGAC      GCGAAAAAATAATATTAATTATGATTGTAAC
```


",tseemann,https://github.com/tseemann/snippy/issues/190
MDU6SXNzdWUzMzkxMzIyMzc=,SNP count in core.tab != core.aln,CLOSED,2018-07-07T09:31:01Z,2018-07-07T11:33:43Z,2018-07-07T11:33:43Z,"
```
A       dna     1188
B       dna     1188
C       dna     1188
Reference       dna     1188

$ wc -l core.tab
1216 core.tab
```
",tseemann,https://github.com/tseemann/snippy/issues/191
MDU6SXNzdWUzMzkxMzg4NDg=,snp-dists doesn't  match between core.aln and core.full.aln,CLOSED,2018-07-07T11:26:29Z,2018-07-29T09:13:37Z,2018-07-29T09:13:25Z,"```
$snp-dists -b core.full.aln
Read 5 sequences of length 317336
        Reference       S1      S2      S3      S4
Reference       0       1642    1476    1589    1571
S1      1642    0       3099    3214    3196
S2      1476    3099    0       3050    3029
S3      1589    3214    3050    0       3138
S4      1571    3196    3029    3138    0

 $ snp-dists -b core.aln
Read 5 sequences of length 6189
        Reference       S1      S2      S3      S4
Reference       0       1634    1464    1576    1565
S1      1634    0       3089    3201    3188
S2      1464    3089    0       3028    3018
S3      1576    3201    3028    0       3125
S4      1565    3188    3018    3125    0
```
",tseemann,https://github.com/tseemann/snippy/issues/192
MDU6SXNzdWUzNDAxOTY5ODc=,Installing snippy from git source - cannot find 'vt',CLOSED,2018-07-11T11:12:53Z,2018-07-29T08:34:00Z,2018-07-29T08:34:00Z,"`snippy --check`
```
[13:07:22] This is snippy 4.0-pre_20180707
[13:07:22] Written by Torsten Seemann
[13:07:22] Obtained from https://github.com/tseemann/snippy
[13:07:22] Detected operating system: linux
[13:07:22] Enabling bundled linux tools.
[13:07:22] Found bwa - /usr/bin/bwa
[13:07:22] Found minimap2 - /media/sebastien/Olorin/Logiciels/minimap2-2.11_x64-linux/minimap2
[13:07:22] Found bcftools - /media/sebastien/Olorin/Logiciels/snippy/binaries/linux/bcftools
[13:07:22] Found samtools - /usr/bin/samtools
[13:07:22] Found java - /usr/bin/java
[13:07:22] Found snpEff - /media/sebastien/Olorin/Logiciels/snippy/binaries/noarch/snpEff
[13:07:22] Found samclip - /media/sebastien/Olorin/Logiciels/snippy/binaries/noarch/samclip
[13:07:22] Found seqtk - /media/sebastien/Olorin/Logiciels/seqtk/seqtk
[13:07:22] Found snp-sites - /usr/bin/snp-sites
[13:07:22] Found parallel - /media/sebastien/Olorin/Logiciels/snippy/binaries/noarch/parallel
[13:07:22] Found freebayes - /media/sebastien/Olorin/Logiciels/snippy/binaries/linux/freebayes
[13:07:22] Found freebayes-parallel - /media/sebastien/Olorin/Logiciels/snippy/binaries/noarch/freebayes-parallel
[13:07:22] Found fasta_generate_regions.py - /media/sebastien/Olorin/Logiciels/snippy/binaries/noarch/fasta_generate_regions.py
[13:07:22] Found vcfstreamsort - /media/sebastien/Olorin/Logiciels/snippy/binaries/linux/vcfstreamsort
[13:07:22] Found vcfuniq - /media/sebastien/Olorin/Logiciels/snippy/binaries/linux/vcfuniq
[13:07:22] Found vcffirstheader - /media/sebastien/Olorin/Logiciels/snippy/binaries/noarch/vcffirstheader
[13:07:22] Found gzip - /bin/gzip
[13:07:22] Found seqret - /usr/bin/seqret
**[13:07:22] Can not find required 'vt' in PATH**

```

Which thing I need to install in order to get that ""vt""?
I think it's the only thing I need in the dependancies ",sbridel,https://github.com/tseemann/snippy/issues/193
MDU6SXNzdWUzNDA1NzcyMzY=,how the snippy filter the SNP ,CLOSED,2018-07-12T10:20:24Z,2018-07-29T08:39:01Z,2018-07-29T08:39:01Z,I find the reason why my snp.vcf is larger than my snp.filt.vcf. because there is annotation in the last step. But I am sorry that I don't know how to delete this comment. ,wanyingsun,https://github.com/tseemann/snippy/issues/194
MDU6SXNzdWUzNDA2MDk4MTM=,snpEff,CLOSED,2018-07-12T12:07:20Z,2018-08-15T08:39:30Z,2018-08-15T08:39:30Z,"Dear Torsten Seemann, 

Using snippy 4.0-pre_20180707 on Ubuntu 18.04 LTS, I get an error when snippy tries to use SnpEff: 

Running: snpEff ann -noStats -no-downstream -no-upstream -no-intergenic -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[14:02:51] Error running command, check mysnps/snps.log

From snps.log: 

**### bcftools view --include '(GT=""1/1"" || GT=""1|1"") && DP>=0 && AF>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AF,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > **snps.filt.vcf**

**### snpEff ann -noStats -no-downstream -no-upstream -no-intergenic -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf**

Runs using plain FASTA as ref work normally
Could you suggest a solution that I could try?

With kind regards,

Jeroen
",Jeroen-K,https://github.com/tseemann/snippy/issues/195
MDU6SXNzdWUzNDI1MzYwOTU=,Conda dependency issue in 4.0.0-dev,CLOSED,2018-07-19T00:22:38Z,2018-07-19T00:39:35Z,2018-07-19T00:38:06Z,"Hi Torsten, 
the following [lines](https://github.com/tseemann/snippy/blob/b23af3ffd3a7648e8c84e70b0b98e5b397c9d5a0/bin/snippy-core#L8) in snippy-core make conda very unhappy.   
```
8 use Bio::SeqIO;
9 use List::Util qw(sum max any uniq min);
```

It's not really a big issue, but BioPerl is only available for Perl 5.22.0  (in conda space) and 
List::Util uniq seems to be a more recent addition to Perl, which necessitates the upgrade to at least 5.26.
Maybe i am missing something stupid, but it seems to be impossible to package the newest version of 
your tool with conda.
I am 4 hours into trying to package an updated bioperl and the fact, that running bcftools consensus myself is way easier, can no longer be ignored. 


",rekm,https://github.com/tseemann/snippy/issues/196
MDU6SXNzdWUzNDI2ODUzMzM=,How does snippy deal with recombination events?,CLOSED,2018-07-19T11:15:04Z,2018-07-29T08:37:14Z,2018-07-29T08:37:13Z,"Say I have a set of genomes but some have an inversion of some gene -- what is Snippy's way to deal with those? 

My intuition would be that reads that do not cover the boundaries of the recombination will be used to call SNPs but reads across boundaries will probably be lost in the mapping step, meaning less ""SNP resolution"" close to these boundaries -- is that correct?

Thank you.",phiweger,https://github.com/tseemann/snippy/issues/197
MDU6SXNzdWUzNDI5NjQ0NjY=,"Getting GT=1,2 and TYPE=complex,snp",CLOSED,2018-07-20T03:53:22Z,2018-07-21T02:21:04Z,2018-07-21T02:21:04Z,"Via @kristyhoran

```
CP009422        24259   .       GGCA    AGCG,CGCA       1226.7  .
AB=0.472727,0.527273;ABP=3.36563,3.36563;AC=1,1;
AF=0.5,0.5;AN=2;AO=26,29;CIGAR=1X2M1X,1X3M;
DP=55;DPB=55;DPRA=0,0;EPP=11.3621,12.0706;EPPR=0;GTI=0;LEN=4,1;
MEANALT=2,2;MQM=60,60;MQMR\=0;NS=1;NUMALT=2;ODDS=107.086;
PAIRED=0.615385,0.793103;PAIREDR=0;PAO=0,0;PQA=0,0;PQR=0;PRO=0;
QA=854,982;QR=0;RO=0;RPL=0,0;RPP=59.4686,65.983;RPPR=0;RPR=26,29;
RUN=1,1;SAF=18,20;SAP=11.3621,12.0706;SAR=8,9;SRF=0;SRP=0;SRR=0;
TYPE=complex,snp      
GT:DP:AD:RO:QR:AO:QA:GL 
1/2:55:0,26,29:0:0:26,29:854,982:-148.956,-79.9545,-72.1277,-69.3349,0,-60.605
```

```
CP009422  24255  c  9   .........     `eeeeeeee
CP009422  24256  c  10  ..........    e`ai``eee`
CP009422  24257  c  6   ......        a`eiee
CP009422  24258  g  7   .......       eeeeiii
CP009422  24259  g  9   ACCAAACCC     eae`eeeii
CP009422  24260  g  8   ........      eeiieeei
CP009422  24261  c  8   ........      e`i```ei
CP009422  24262  a  12  G...GGGG....  eiie`aieieei
CP009422  24263  t  11  ...........   ``eaie`iiii
CP009422  24264  a  12  ............  ``eeieeieiii
CP009422  24265  g  10  ..........    eaeiiaii``

#why
```",tseemann,https://github.com/tseemann/snippy/issues/198
MDU6SXNzdWUzNDQzMDM5OTQ=,Look into poly-G tails in Nextseq/Novaseq reads,OPEN,2018-07-25T06:02:16Z,2018-07-25T06:02:23Z,,"These will not globally align, and will be samclipped!
",tseemann,https://github.com/tseemann/snippy/issues/200
MDU6SXNzdWUzNDU0NTcwODg=,Invalid --reference filename,CLOSED,2018-07-28T15:32:03Z,2018-07-28T22:34:59Z,2018-07-28T15:41:54Z,"Hi, I was trying to run snippy but kept getting this result:
`Invalid --reference filename`

Here's the my input and output:
> MacBook-Pro:~ user$ snippy --outdir /snippy/result --reference /snippy/ref/Bh_F582.gbk --se /input/Bh/J510.fasta
[11:17:29] This is snippy 3.2-dev
[11:17:29] Written by Torsten Seemann <torsten.seemann@gmail.com>
[11:17:29] Obtained from https://github.com/tseemann/snippy
[11:17:29] Detected operating system: darwin
[11:17:29] Enabling bundled darwin tools.
[11:17:30] Found bwa - /anaconda3/bin/bwa
[11:17:30] Found samtools - /anaconda3/bin/samtools
[11:17:30] Found tabix - /anaconda3/bin/tabix
[11:17:30] Found bgzip - /anaconda3/bin/bgzip
[11:17:30] Found snpEff - /anaconda3/bin/snpEff
[11:17:30] Found java - /anaconda3/bin/java
[11:17:30] Found gzip - /usr/bin/gzip
[11:17:30] Found parallel - /anaconda3/bin/parallel
[11:17:30] Found freebayes - /anaconda3/bin/freebayes
[11:17:30] Found freebayes-parallel - /anaconda3/bin/freebayes-parallel
[11:17:30] Found fasta_generate_regions.py - /anaconda3/bin/fasta_generate_regions.py
[11:17:30] Found vcfstreamsort - /anaconda3/bin/vcfstreamsort
[11:17:30] Found vcfuniq - /anaconda3/bin/vcfuniq
[11:17:30] Found vcffirstheader - /anaconda3/bin/vcffirstheader
[11:17:30] Found vcf-consensus - /anaconda3/bin/../binaries/noarch/vcf-consensus
[11:17:30] Found snippy-vcf_to_tab - /anaconda3/bin/snippy-vcf_to_tab
[11:17:30] Found snippy-vcf_report - /anaconda3/bin/snippy-vcf_report
[11:17:30] Found snippy-vcf_filter - /anaconda3/bin/snippy-vcf_filter
[11:17:30] Checking version: samtools --version is >= 1.3 - ok, have 1.7
[11:17:30] Checking version: freebayes --version is >= 1.1 - ok, have 1.2
[11:17:30] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[11:17:30] Invalid --reference filename


How could I fix this?
Thank you. ",tkc216,https://github.com/tseemann/snippy/issues/201
MDU6SXNzdWUzNDU1NzkzMjk=,SNP f failure on -35 signal (using accession NC_003197),CLOSED,2018-07-30T01:01:21Z,2018-08-05T04:15:59Z,2018-08-05T04:15:59Z,"```### cd /home/wpitchers/MDU/JOBS/J2018_STm_MLVA03-15-11-10-523_TAS/nullarbor_LT2

### /home/tseemann/git/snippy/bin/snippy --force --cpus 4 --outdir 2014-03798/snippy --ref /home/wpitchers/MDU/JOBS/J2018_STm_MLVA03-15-11-10-523_TAS/NC_003197.gbk --R1 2014-03798/R1.fq.gz --R2 2014-03798/R2.fq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.04 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.87 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.02 sec
[bwa_index] Construct SA from BWT and Occ... 0.63 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 2.628 sec; CPU: 2.597 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

Picked up _JAVA_OPTIONS: -Duser.home=/home/wpitchers -Duser.name=wpitchers -Duser.timezone=Australia/Melbourne
java.lang.RuntimeException: Error reading file '/home/wpitchers/MDU/JOBS/J2018_STm_MLVA03-15-11-10-523_TAS/nullarbor_LT2/2014-03798/snippy/reference/./ref/genes.gff'
java.lang.RuntimeException: FATAL ERROR: Offending line (lineNum: 41): 'NC_003197       snippy  -35_signal      46083   46091   .       +  0'. File '/home/wpitchers/MDU/JOBS/J2018_STm_MLVA03-15-11-10-523_TAS/nullarbor_LT2/2014-03798/snippy/reference/./ref/genes.gff' line 41
        'NC_003197      snippy  -35_signal      46083   46091   .       +       0       '

        at org.snpeff.snpEffect.factory.SnpEffPredictorFactoryGff.create(SnpEffPredictorFactoryGff.java:353)
        at org.snpeff.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:369)
        at org.snpeff.SnpEff.run(SnpEff.java:1183)
        at org.snpeff.SnpEff.main(SnpEff.java:162)```",willpitchers,https://github.com/tseemann/snippy/issues/202
MDU6SXNzdWUzNDU1OTI0MTA=,Fix BAM desc for v4,CLOSED,2018-07-30T02:43:40Z,2018-07-30T06:49:05Z,2018-07-30T06:49:05Z,Note that multi-mapping and unmapped reads are not present.,tseemann,https://github.com/tseemann/snippy/issues/203
MDU6SXNzdWUzNDU2MDE1MTQ=,re-code lower case `n` as IUPAC ambiguous base instead,CLOSED,2018-07-30T03:47:52Z,2018-08-07T05:53:09Z,2018-08-07T05:53:09Z,,schultzm,https://github.com/tseemann/snippy/issues/204
MDU6SXNzdWUzNDYwNzM3NzU=,correct conda perl dependencies,CLOSED,2018-07-31T07:49:07Z,2018-08-03T01:30:03Z,2018-08-03T01:30:03Z,"Hi Torsten,

What is the ""right"" way to install the required Perl modules for Snippy v4.x?

I tried:

```bash
conda install -y -c bioconda perl-bioperl
```

Which gives:

```
snippy --help
# works

snippy-core --help
""uniq"" is not exported by the List::Util module
Can't continue after import errors at /usr/local/bin/snippy-core line 9.
BEGIN failed--compilation aborted at /usr/local/bin/snippy-core line 9.

# ok then, let's try
conda install perl-list-util
Solving environment: done

snippy
Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module) (@INC contains: .../src/snippy/bin/../perl5 
.../miniconda3/envs/klebsiella/lib/perl5/site_perl/5.22.0/darwin-thread-multi-2level .../miniconda3/envs/klebsiella/lib/perl5/site_perl/5.22.0 .../miniconda3/envs/klebsiella/lib/perl5/5.22.0/darwin-thread-multi-2level .../miniconda3/envs/klebsiella/lib/perl5/5.22.0 .) at /usr/local/bin/snippy line 15.
BEGIN failed--compilation aborted at /usr/local/bin/snippy line 15.
```

I have no experience w/ Perl, so I am not sure what is happening here.

Thank you for your help.
",phiweger,https://github.com/tseemann/snippy/issues/205
MDU6SXNzdWUzNDYzODIxNDc=,Explain snippy-core better,OPEN,2018-07-31T22:30:53Z,2023-08-14T10:06:44Z,,"The docs aren't that explicit on how it works.
",tseemann,https://github.com/tseemann/snippy/issues/206
MDU6SXNzdWUzNDY0MDQyODA=,Galaxy Error,CLOSED,2018-08-01T00:23:04Z,2018-08-02T22:45:54Z,2018-08-01T00:40:09Z,"When I try to run the Galaxy version of Snippy, I get the following error on all generated datasets:

```
Traceback (most recent call last):
  File ""/galaxy-central/lib/galaxy/jobs/runners/__init__.py"", line 170, in prepare_job
    job_wrapper.prepare()
  File ""/galaxy-central/lib/galaxy/jobs/__init__.py"", line 971, in prepare
    self.command_line, self.extra_filenames, self.environment_variables = tool_evaluator.build()
  File ""/galaxy-central/lib/galaxy/tools/evaluation.py"", line 454, in build
    raise e
KeyError: 'element_identifier'
```

Do you know what the problem might be?  Thanks!",matnguyen,https://github.com/tseemann/snippy/issues/207
MDU6SXNzdWUzNDY0Mjk3NTM=,Exclusion of reference from aln in snippy-core 4,CLOSED,2018-08-01T02:58:13Z,2019-09-09T03:12:26Z,2018-08-03T01:28:18Z,"Hi Torsten, 

Could you possibly add in the option to exclude the reference sequence from the alignments generated by snippy-core in v4? It was option --noref in the previous version.

Thanks, Sarah B.",sbaines,https://github.com/tseemann/snippy/issues/208
MDU6SXNzdWUzNDc4MDA2NDc=,replace special characters with N in core.full.aln,CLOSED,2018-08-06T06:54:51Z,2018-08-08T06:50:31Z,2018-08-08T06:50:31Z,"Hi Torst, 

Possible to have a version of the core.full.aln where there special characters are 'N' in the alignment. ",danielleingle,https://github.com/tseemann/snippy/issues/209
MDU6SXNzdWUzNDg1Mzk3NzQ=,make snippy4 --mincov 10,CLOSED,2018-08-08T01:14:02Z,2018-08-08T08:49:02Z,2018-08-08T08:49:02Z,Hi @tseemann as requested an issue for mincov!,kristyhoran,https://github.com/tseemann/snippy/issues/210
MDU6SXNzdWUzNDg2MzIzOTQ=,Old snippy-* scripts in bin/ ?,CLOSED,2018-08-08T08:49:40Z,2018-08-15T08:53:51Z,2018-08-15T08:53:51Z,"```
ln -s ../Cellar/snippy/4.0.0/bin/snippy snippy
ln -s ../Cellar/snippy/4.0.0/bin/snippy-clean_full_aln snippy-clean_full_aln
ln -s ../Cellar/snippy/4.0.0/bin/snippy-core snippy-core
ln -s ../Cellar/snippy/4.0.0/bin/snippy-core.OLD snippy-core.OLD
ln -s ../Cellar/snippy/4.0.0/bin/snippy-vcf_decompose_complex snippy-vcf_decompose_complex
ln -s ../Cellar/snippy/4.0.0/bin/snippy-vcf_extract_subs snippy-vcf_extract_subs
ln -s ../Cellar/snippy/4.0.0/bin/snippy-vcf_report snippy-vcf_report
ln -s ../Cellar/snippy/4.0.0/bin/snippy-vcf_to_tab snippy-vcf_to_tab
```
",tseemann,https://github.com/tseemann/snippy/issues/211
MDU6SXNzdWUzNDg2Nzc2NzQ=,the latest release crashed at snpEff,CLOSED,2018-08-08T11:02:50Z,2019-07-30T20:24:29Z,2018-08-15T08:42:19Z,"Hi Torsten,

I just upgraded it to the latest release and found out it crashed when entering snpEff step.

The screen output asked me to check the log file which is shown below

############ log starts here #############

### cd /home/zong/Desktop/20180806/test

### /home/zong/programs_and_scripts/snippy/bin/snippy --cpus 22 --ram 32 --unmapped --outdir ./refWCHKP095649_chr/115044bb_refWCHKP095649_chr --ref WCHKP095649_chr.gbk --R1 115044bb_1.fq.gz --R2 115044bb_2.fq.gz --bwaopt -t 22

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.12 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 4.26 seconds elapse.
[bwa_index] Update BWT... 0.07 sec
[bwa_index] Pack forward-only FASTA... 0.07 sec
[bwa_index] Construct SA from BWT and Occ... 1.25 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 5.838 sec; CPU: 5.776 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

Picked up _JAVA_OPTIONS: -Xms4096m -Xmx51200m

### bwa mem -t -Y -M -R '@RG\tID:115044bb_refWCHKP095649_chr\tSM:115044bb_refWCHKP095649_chr' -t 22 reference/ref.fa /home/zong/Desktop/20180806/test/115044bb_1.fq.gz /home/zong/Desktop/20180806/test/115044bb_2.fq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.27113. --threads 16 -m 2000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.27113. --threads 16 -m 2000M | samtools markdup -T /tmp/snippy.27113. -r -s - - > snps.bam

READ 6904436 WRITTEN 6047148 
EXCLUDED 3476945 EXAMINED 3427491
PAIRED 3357058 SINGLE 70433
DULPICATE PAIR 814398 DUPLICATE SINGLE 42890
DUPLICATE TOTAL 857288

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 129121 > reference/ref.txt


### freebayes-parallel reference/ref.txt 22 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05 -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf

Picked up _JAVA_OPTIONS: -Xms4096m -Xmx51200m

############ log ends here#############

I thought probably something wrong with ""Picked up _JAVA_OPTIONS: -Xms4096m -Xmx51200m"", so I remove these java options and manually tried the last command, which was ""/home/zong/programs_and_scripts/snippy/binaries/noarch/snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf"" and nothing on screen popped out.

I checked snps.filt.vcf which looked OK, but some errors were found in snps.vcf which is shown below

#############  snps.vcf starts here ################

[ERROR] [08/08/2018 19:01:07.729] [vcfWorkQueue-akka.actor.default-dispatcher-1] [ActorSystem(vcfWorkQueue)] Uncaught error from thread [vcfWorkQueue-akka.actor.default-dispatcher-1]
java.lang.NoSuchMethodError: sun.misc.Unsafe.monitorEnter(Ljava/lang/Object;)V
	at akka.routing.RoutedActorRef.newActorCell(Routing.scala:55)
	at akka.actor.LocalActorRef.<init>(ActorRef.scala:244)
	at akka.routing.RoutedActorRef.<init>(Routing.scala:27)
	at akka.actor.LocalActorRefProvider.actorOf(ActorRefProvider.scala:548)
	at akka.actor.ActorCell._actorOf(ActorCell.scala:374)
	at akka.actor.ActorCell.actorOf(ActorCell.scala:391)
	at org.snpeff.akka.Master.<init>(Master.java:63)
	at org.snpeff.akka.vcf.MasterVcf.<init>(MasterVcf.java:23)
	at org.snpeff.snpEffect.commandLine.eff.MasterEff.<init>(MasterEff.java:21)
	at org.snpeff.snpEffect.commandLine.SnpEffCmdEff$1.create(SnpEffCmdEff.java:505)
	at org.snpeff.snpEffect.commandLine.SnpEffCmdEff$1.create(SnpEffCmdEff.java:499)
	at akka.actor.Props$$anonfun$$init$$1.apply(Props.scala:124)
	at akka.actor.Props$$anonfun$$init$$1.apply(Props.scala:124)
	at akka.actor.ActorCell.newActor(ActorCell.scala:488)
	at akka.actor.ActorCell.create$1(ActorCell.scala:506)
	at akka.actor.ActorCell.systemInvoke(ActorCell.scala:593)
	at akka.dispatch.Mailbox.processAllSystemMessages(Mailbox.scala:208)
	at akka.dispatch.Mailbox.run(Mailbox.scala:177)
	at akka.dispatch.ForkJoinExecutorConfigurator$MailboxExecutionTask.exec(AbstractDispatcher.scala:505)
	at akka.jsr166y.ForkJoinTask.doExec(ForkJoinTask.java:259)
	at akka.jsr166y.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:974)
	at akka.jsr166y.ForkJoinPool.runWorker(ForkJoinPool.java:1478)
	at akka.jsr166y.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:104)

[ERROR] [08/08/2018 19:01:07.733] [vcfWorkQueue-akka.actor.default-dispatcher-2] [akka://vcfWorkQueue/user/masterVcf] null
java.lang.NullPointerException
	at akka.actor.ActorCell.invoke(ActorCell.scala:619)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:196)
	at akka.dispatch.Mailbox.run(Mailbox.scala:178)
	at akka.dispatch.ForkJoinExecutorConfigurator$MailboxExecutionTask.exec(AbstractDispatcher.scala:505)
	at akka.jsr166y.ForkJoinTask.doExec(ForkJoinTask.java:259)
	at akka.jsr166y.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:974)
	at akka.jsr166y.ForkJoinPool.runWorker(ForkJoinPool.java:1478)
	at akka.jsr166y.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:104)

[ERROR] [08/08/2018 19:01:07.734] [vcfWorkQueue-akka.actor.default-dispatcher-4] [akka://vcfWorkQueue/user/masterVcf] error while creating actor
java.lang.NullPointerException
	at akka.actor.ActorCell.doRecreate(ActorCell.scala:707)
	at akka.actor.ActorCell.recreate$1(ActorCell.scala:540)
	at akka.actor.ActorCell.systemInvoke(ActorCell.scala:594)
	at akka.dispatch.Mailbox.processAllSystemMessages(Mailbox.scala:208)
	at akka.dispatch.Mailbox.run(Mailbox.scala:177)
	at akka.dispatch.ForkJoinExecutorConfigurator$MailboxExecutionTask.exec(AbstractDispatcher.scala:505)
	at akka.jsr166y.ForkJoinTask.doExec(ForkJoinTask.java:259)
	at akka.jsr166y.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:974)
	at akka.jsr166y.ForkJoinPool.runWorker(ForkJoinPool.java:1478)
	at akka.jsr166y.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:104)

[ERROR] [08/08/2018 19:01:07.734] [vcfWorkQueue-akka.actor.default-dispatcher-4] [akka://vcfWorkQueue/user/masterVcf] error while creating actor
java.lang.NullPointerException
	at akka.actor.ActorCell.doRecreate(ActorCell.scala:721)
	at akka.actor.ActorCell.recreate$1(ActorCell.scala:540)
	at akka.actor.ActorCell.systemInvoke(ActorCell.scala:594)
	at akka.dispatch.Mailbox.processAllSystemMessages(Mailbox.scala:208)
	at akka.dispatch.Mailbox.run(Mailbox.scala:177)
	at akka.dispatch.ForkJoinExecutorConfigurator$MailboxExecutionTask.exec(AbstractDispatcher.scala:505)
	at akka.jsr166y.ForkJoinTask.doExec(ForkJoinTask.java:259)
	at akka.jsr166y.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:974)
	at akka.jsr166y.ForkJoinPool.runWorker(ForkJoinPool.java:1478)
	at akka.jsr166y.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:104)

###################### snps.vcf ends here #####################

 any idea how to fix this ?

thanks much,

Yu",fengyuchengdu,https://github.com/tseemann/snippy/issues/212
MDU6SXNzdWUzNDg5NjUwMTc=,"snpEff does not support java v9, need java v8 :-/",CLOSED,2018-08-09T03:33:40Z,2018-08-15T09:05:57Z,2018-08-15T09:05:57Z,,tseemann,https://github.com/tseemann/snippy/issues/213
MDU6SXNzdWUzNDkwMjE5Mjk=,bcftools issue,CLOSED,2018-08-09T08:09:57Z,2018-08-10T23:29:29Z,2018-08-10T23:29:29Z,"Dear Torsten Seemann,

Using Ubuntu 16.04 LTS i get issue with snippy recently because of snpEff so I upgraded snippy but i still have problems. For some of my genomes i get this error message : 

[09:54:51] This is snippy 4.0.0
[09:54:51] Written by Torsten Seemann
[09:54:51] Obtained from https://github.com/tseemann/snippy
[09:54:51] Detected operating system: linux
[09:54:51] Enabling bundled linux tools.
[09:54:51] Found bwa - /usr/local/bin/bwa
[09:54:51] Found minimap2 - /usr/local/bin/minimap2
[09:54:51] Found bcftools - /usr/local/bin/bcftools
[09:54:51] Found samtools - /usr/local/bin/samtools
[09:54:51] Found java - /usr/bin/java
[09:54:51] Found snpEff - /usr/local/bin/snpEff
[09:54:51] Found samclip - /home/marine/snippy/binaries/noarch/samclip
[09:54:51] Found seqtk - /usr/local/bin/seqtk
[09:54:51] Found snp-sites - /usr/bin/snp-sites
[09:54:51] Found parallel - /usr/local/bin/parallel
[09:54:51] Found freebayes - /usr/local/bin/freebayes
[09:54:51] Found freebayes-parallel - /usr/local/bin/freebayes-parallel
[09:54:51] Found fasta_generate_regions.py - /usr/local/bin/fasta_generate_regions.py
[09:54:51] Found vcfstreamsort - /usr/local/bin/vcfstreamsort
[09:54:51] Found vcfuniq - /usr/local/bin/vcfuniq
[09:54:51] Found vcffirstheader - /usr/local/bin/vcffirstheader
[09:54:51] Found gzip - /bin/gzip
[09:54:51] Found seqret - /usr/bin/seqret
[09:54:51] Found vt - /usr/local/bin/vt
[09:54:51] Found snippy-vcf_to_tab - /home/marine/snippy/bin/snippy-vcf_to_tab
[09:54:51] Found snippy-vcf_report - /home/marine/snippy/bin/snippy-vcf_report
[09:54:51] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[09:54:51] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[09:54:51] Checking version: freebayes --version is >= 1.1 - ok, have 1.1
[09:54:51] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[09:54:51] Using reference: /home/marine/Bureau/contigs_MH_australie/081661.gbk
[09:54:51] Treating reference as 'genbank' format.
[09:54:51] Will use 14 CPU cores.
[09:54:51] Using read file: /home/marine/Bureau/contigs_MH_australie/44440_MH_ST258.fna
[09:54:51] Used --force, will overwrite existing /home/marine/Bureau/contigs_MH_australie/snippy_081661/44440_MH_ST258
[09:54:51] Changing working directory: /home/marine/Bureau/contigs_MH_australie/snippy_081661/44440_MH_ST258
[09:54:51] Creating reference folder: reference
[09:54:51] Extracting FASTA and GFF from reference.
[09:54:53] Wrote 1 sequences to ref.fa
[09:54:53] Wrote 2624 features to ref.gff
[09:54:53] Shredding /home/marine/Bureau/contigs_MH_australie/44440_MH_ST258.fna into pseudo-reads
[09:54:54] Wrote 227940 fake 250bp reads (20x, stride 25bp) to fake_reads.fq
[09:54:54] Creating reference/snpeff.config
[09:54:54] Freebayes will process 27 chunks of 102840 bp, 14 chunks at a time.
[09:54:54] Using BAM RG (Read Group) ID: 44440_MH_ST258
[09:54:54] Running: samtools faidx reference/ref.fa 2>> snps.log
[09:54:54] Running: bwa index reference/ref.fa 2>> snps.log
[09:54:55] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[09:54:55] Running: ln -sf reference/ref.fa . 2>> snps.log
[09:54:55] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[09:54:55] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[09:54:55] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[09:54:58] Running: bwa mem  -Y -M -R '@RG\tID:44440_MH_ST258\tSM:44440_MH_ST258' -t 14 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.111975. --threads 14 -m 571M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.111975. --threads 14 -m 571M | samtools markdup -T /tmp/snippy.111975. -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.2 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 227940 sequences (56940564 bp)...
[M::mem_process_seqs] Processed 227940 reads in 24.802 CPU sec, 1.911 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @RG\tID:44440_MH_ST258\tSM:44440_MH_ST258 -t 14 reference/ref.fa fake_reads.fq
[main] Real time: 2.863 sec; CPU: 25.372 sec
[samclip] Total SAM records 229395, removed 7418, allowed 1307, passed 221977
[samclip] Header contained 3 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 14 in-memory blocks...
[bam_sort_core] merging from 0 files and 14 in-memory blocks...
[09:55:04] Running: samtools index snps.bam 2>> snps.log
[09:55:04] Running: fasta_generate_regions.py reference/ref.fa.fai 102840 > reference/ref.txt 2>> snps.log
[09:55:04] Running: freebayes-parallel reference/ref.txt 14 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05 -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[09:55:13] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [n] no fail on reference inconsistency for non SNPs false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa

[variant_manip.cpp:75 is_ref_consistent] Variant is not consistent: CP016073:1933449-1933468 - TNTTTAACAATTTTAAACTG(REF) vs TWTTTAACAATTTTAAACTG(FASTA)
[normalize.cpp:178 normalize] Normalization not performed due to inconsistent reference sequences. (use -n option to relax this)
[09:55:13] Error running command, check /home/marine/Bureau/contigs_MH_australie/snippy_081661/44440_MH_ST258/snps.log

I don't know why some of them are ok and some not, do you have any idea what can be wrong with my alignment? 

With kind regards,
Marine
",CocoMlle,https://github.com/tseemann/snippy/issues/214
MDU6SXNzdWUzNDkwNTM1MzQ=,"Snippy install ""Can't locate Bio/SeqIO.pm in @INC",CLOSED,2018-08-09T09:42:36Z,2020-11-12T00:59:49Z,2018-08-15T08:38:49Z,"Hello, I installed via miniconda bioconda instructions but installation check came up with this error message.  Can you please tell me how to fix this? (PS. I'm very new to this.)

Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module) (@INC contains: /home/sharb/miniconda3/lib/site_perl/5.26.2/x86_64-linux-thread-multi /home/sharb/miniconda3/lib/site_perl/5.26.2 /home/sharb/miniconda3/lib/5.26.2/x86_64-linux-thread-multi /home/sharb/miniconda3/lib/5.26.2 .) at /home/sharb/miniconda3/bin/snippy line 11.
BEGIN failed--compilation aborted at /home/sharb/miniconda3/bin/snippy line 11.

Thanks,",sharbie88,https://github.com/tseemann/snippy/issues/215
MDU6SXNzdWUzNDk0NDc3NDM=,alternative prefixes with snippy-core,CLOSED,2018-08-10T09:46:33Z,2018-08-11T08:25:38Z,2018-08-11T08:25:38Z,"Would it be possible to add back looking for alternative prefixes with snippy-core. 
e.g. instead of snps.vcf and alternate strain.vcf could be used if in the right directory",danielleingle,https://github.com/tseemann/snippy/issues/216
MDU6SXNzdWUzNTAxNTkwNDQ=,snippy-core v4.0.0 sample naming,CLOSED,2018-08-13T19:21:40Z,2018-08-14T01:18:31Z,2018-08-14T01:18:31Z,"I ran the new snippy-core on snippy output in a couple of different directories, and it names samples with the whole path to the directory I point to (as entered on the command line) rather than just the snippy directory name for each sample. 

For example: if i run `snippy-core ../*` to get all snippy files one directory up, the samples end up named `../sample1` rather than just `sample1` in the multifasta output. 

I think this is a new behavior in snippy 4. Let me know if it is intentional, or if I am doing something wrong!

Thanks,
Arianna",amilesj,https://github.com/tseemann/snippy/issues/217
MDU6SXNzdWUzNTAzMDY4MDI=,filtered variant calls difference,CLOSED,2018-08-14T07:12:46Z,2018-08-23T02:30:43Z,2018-08-23T02:30:43Z,"Hi, Torsten. I am aligning the reads of two highly similar isolates (isolate A and B) to a reference genome using snippy.

For a particular position, both isolates show a 'T' in the snps.raw.vcf and also the bam file.
However, this 'T' only present in isolate A in the snps.vcf and snps.filt.vcf

The particular snp shown in the snps.raw.vcf for the two isolates are as follows;

A:
CP014960.1	710089	.	G	T	116.417	.	AB=0;ABP=0;AC=2;AF=1;AN=2;AO=4;CIGAR=1X;DP=4;DPB=4;DPRA=0;EPP=5.18177;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=60;MQMR=0;NS=1;NUMALT=1;ODDS=10.1503;PAIRED=0;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=152;QR=0;RO=0;RPL=4;RPP=11.6962;RPPR=0;RPR=0;RUN=1;SAF=1;SAP=5.18177;SAR=3;SRF=0;SRP=0;SRR=0;TYPE=snp	GT:DP:AD:RO:QR:AO:QA:GL	1/1:4:0,4:0:0:4:152:-14.0499,-1.20412,0

B:
CP014960.1	710089	.	G	T	247.11	.	AB=0.909091;ABP=19.0002;AC=1;AF=0.5;AN=2;AO=10;CIGAR=1X;DP=11;DPB=11;DPRA=0;EPP=3.0103;EPPR=5.18177;GTI=0;LEN=1;MEANALT=1;MQM=60;MQMR=60;NS=1;NUMALT=1;ODDS=10.7924;PAIRED=0.7;PAIREDR=1;PAO=0;PQA=0;PQR=0;PRO=0;QA=350;QR=38;RO=1;RPL=10;RPP=24.725;RPPR=5.18177;RPR=0;RUN=1;SAF=5;SAP=3.0103;SAR=5;SRF=1;SRP=5.18177;SRR=0;TYPE=snp	GT:DP:AD:RO:QR:AO:QA:GL	0/1:11:1,10:1:38:10:350:-28.5219,0,-0.485939

I can't figure out why the snp in isolate B was filtered. It leads to one more SNP difference between A and B. Any manual/reference I can read further to understand how the filter work? Thank you so much.

The head of the vcf file for your reference:
##fileformat=VCFv4.2
##FILTER=<ID=PASS,Description=""All filters passed"">
##fileDate=20180810
##source=freeBayes v1.2.0
##reference=reference/ref.fa
##contig=<ID=CP014960.1,length=4799801>
##phasing=none
##commandline=""freebayes -p 2 -P 0.5 -q 13 -m 60 --min-repeat-entropy 1.0 -f reference/ref.fa snps.bam --region CP014960.1:0-157415""

",alantsangmb,https://github.com/tseemann/snippy/issues/218
MDU6SXNzdWUzNTA1MDA3Mjc=,Use snippy repeatedly on same reference: don't re-index,OPEN,2018-08-14T16:19:56Z,2018-08-15T07:53:46Z,,"If I have multiple samples that I want to run against the same reference, is there a way to avoid re-indexing the reference each time, to save both space and time?",JCSzamosi,https://github.com/tseemann/snippy/issues/219
MDU6SXNzdWUzNTA3MTQxNjg=,snpEff frame is wrong (again),CLOSED,2018-08-15T07:36:59Z,2018-08-15T09:34:38Z,2018-08-15T08:03:03Z,"Via @ingled
```
calling right base
reporting wrong codon
e.g. - this is one established one
missense_variant.c.259G.A.p.Asp87Asn
this is what is in the snps.tab
missense_variant c.259A>G p.Thr87Ala
```

I was using phase=0, then a snpEff bug (?) made me switch to phase=1 but it seems maybe phase=0 is correct again.
",tseemann,https://github.com/tseemann/snippy/issues/220
MDU6SXNzdWUzNTA3MTQ1MTg=,"Use of uninitialized value in concatenation (.) or string at snippy-vcf_extract_subs line 137, <> line 30.",CLOSED,2018-08-15T07:38:34Z,2018-08-15T08:23:18Z,2018-08-15T08:23:18Z,"```
sub recode_info {
  my($kv, @keep) = @_;
  @keep = keys %$kv unless @keep;
  return join(';', map { ""$_="".$kv->{$_} } @keep);    # line 137
}
```",tseemann,https://github.com/tseemann/snippy/issues/221
MDU6SXNzdWUzNTI0NjU0NTc=,Add license information for third-party binaries,OPEN,2018-08-21T09:49:30Z,2018-08-22T03:13:43Z,,"A number of third-party binaries are stored in the `binaries/` directory, some of which are licensed under the GPL, some LGPL, some MIT licenses (and that's just the ones I know).

These should probably have their own license information.",ikirker,https://github.com/tseemann/snippy/issues/222
MDU6SXNzdWUzNTI0NjY2OTE=,Fix instructions for installation from source package,CLOSED,2018-08-21T09:52:57Z,2018-08-22T03:13:32Z,2018-08-22T03:13:32Z,"Current:

```bash
cd $HOME
git clone https://github.com/tseemann/snippy.git
$HOME/bin/snippy --help
```

This will result in `~/snippy` being created, but there's no provided mechanism for getting to a state where `$HOME/bin` would contain a valid snippy file or link.

Maybe this should be:

```bash
cd $HOME
git clone https://github.com/tseemann/snippy.git
$HOME/snippy/bin/snippy --help
```",ikirker,https://github.com/tseemann/snippy/issues/223
MDU6SXNzdWUzNTI2Nzg1OTE=,vcffirstheader python 2 dependency in Snippy 4.x,CLOSED,2018-08-21T19:31:10Z,2019-12-02T05:03:15Z,2019-12-02T05:03:14Z,"vcffirstheader seems to use python 2. When I ran Snippy 4.0.5 in my normal environment with python 3.6.2, I got the following error in the log after the `freebayes-parallel` line: 

`File ""/home/amiles/miniconda3/bin/vcffirstheader"", line 9
    print line.strip()
             ^
SyntaxError: invalid syntax`

I changed my script to activate my environment with python 2.7 before running Snippy, and it worked fine. 

Best,
Arianna
",amilesj,https://github.com/tseemann/snippy/issues/224
MDU6SXNzdWUzNTI5MjAxODg=,freebayes-parallel Error: --tollef has been retired.,CLOSED,2018-08-22T11:55:13Z,2018-08-25T19:31:22Z,2018-08-25T19:31:21Z,"conda install of snippy

(snippy) stevep11@watt26:~/Datafiles/Pseudo/LIMS14437$ snippy --version
snippy 4.0.5

snippy --check is fine

 
snippy --cpus 16 --outdir ${wkdir}/snippy/tst --ref ${ref}.gbk --R1 ${R1} --R2 ${R2}

[snps.log](https://github.com/tseemann/snippy/files/2310171/snps.log)

tail of log file
### freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05 -f reference/ref.fa snps.bam > snps.raw.vcf

parallel: Error: --tollef has been retired.
parallel: Error: Remove --tollef or use --gnu to override --tollef.

(snippy) stevep11@watt26:~/Datafiles/Pseudo/LIMS14437$ parallel --version
GNU parallel 20180522
",scottishwormboy,https://github.com/tseemann/snippy/issues/225
MDU6SXNzdWUzNTMzMDc2MjM=,Add Freebayes optional flags customization,CLOSED,2018-08-23T09:51:55Z,2018-08-25T01:24:06Z,2018-08-25T01:24:03Z,"Could you add the ability for users to call additional freebayes flag similar to how there is one for bwa
in the form of  ""--bwaopt F""? I believe this will provide a lot of customization for the user.",jwcodee,https://github.com/tseemann/snippy/issues/226
MDU6SXNzdWUzNTM3NDg0ODc=,"when masking in snippy-core, (-) strand annotation crashes program",CLOSED,2018-08-24T11:35:34Z,2018-08-25T00:46:11Z,2018-08-25T00:46:11Z,"When the bed file used to `snippy-core --mask ...` has annotations on the minus strand (i.e. start > end) snippy-core errs out w/

```bash
Opening: core.tab
Opening: core.vcf
Processing contig: reference
Masking alignment at 27 regions
Negative repeat count does nothing at /usr/local/bin/snippy-core line 252, <VCF> line 5125.
Negative repeat count does nothing at /usr/local/bin/snippy-core line 252, <VCF> line 5125.
Negative repeat count does nothing at /usr/local/bin/snippy-core line 252, <VCF> line 5125.
Negative repeat count does nothing at /usr/local/bin/snippy-core line 252, <VCF> line 5125.
substr outside of string at /usr/local/bin/snippy-core line 253, <VCF> line 5125.
```

thx.",phiweger,https://github.com/tseemann/snippy/issues/227
MDU6SXNzdWUzNTQxNjgyOTg=,--minqual site masking,CLOSED,2018-08-27T03:33:43Z,2018-08-28T07:38:19Z,2018-08-28T07:38:19Z,"Could sites with poor genotype quality be masked in the *.aligned.fa file (in addition to depth and heterozygosity masking)? Currently, any site failing the --minqual flag seems to default to the reference sequence in the final alignment and in the downstream output of snippy-core. Whereas, I think it would be preferable to have this represented as an ambiguous site: N/n.

A simple code suggestion (sorry I didn't open up a pull request instead):

bcftools query -i 'GT=""het"" || QUAL<$minqual' -f '%CHROM\\t%POS\\t%REF\\n' $prefix.raw.vcf
",ktmeaton,https://github.com/tseemann/snippy/issues/228
MDU6SXNzdWUzNTQ3NDM5ODA=,error using gbk,CLOSED,2018-08-28T13:57:55Z,2018-09-08T06:35:49Z,2018-09-08T06:35:49Z,"Hi Torsten,

I'm trying to run snippy/4.1.0 with snpEff/4.3 and I get an error about the codonTable:

### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

java.lang.RuntimeException: Error parsing property 'ref.MYREF.codonTable'. No such codon table 'Bacterial_and_Plant_Plastid'
	at org.snpeff.snpEffect.Config.createCodonTables(Config.java:169)
	at org.snpeff.snpEffect.Config.readConfig(Config.java:650)
	at org.snpeff.snpEffect.Config.init(Config.java:480)
	at org.snpeff.snpEffect.Config.<init>(Config.java:117)
	at org.snpeff.SnpEff.loadConfig(SnpEff.java:451)
	at org.snpeff.snpEffect.commandLine.SnpEffCmdBuild.run(SnpEffCmdBuild.java:364)
	at org.snpeff.SnpEff.run(SnpEff.java:1183)
	at org.snpeff.SnpEff.main(SnpEff.java:162)

It seems the same error that some people noted in some previous issues, but it is not clear to me how we can fix it.  
https://github.com/tseemann/snippy/issues/86
https://github.com/tseemann/snippy/issues/154

Any feedback will be much appreciated!
Thanks,
Alexandra",memoriasresiduais,https://github.com/tseemann/snippy/issues/229
MDU6SXNzdWUzNTUyMjY4NDU=,Unable to create symbolic link snippy 4.05,CLOSED,2018-08-29T15:55:50Z,2018-08-30T08:21:19Z,2018-08-30T00:06:23Z,"Hi Torsten,

I have just upgraded from snippy 3.1 to snippy 4.05 but I have encountered an issue.

When running snippy I now get this error:

ln: failed to create symbolic link ‘./ref.fa’: Operation not supported

I understand this is because I am using CIFS/SMB shares and ln does not like this.

Is there anyway to fix this so it'll work?

Thanks in advance,

Nick",PyroEndy,https://github.com/tseemann/snippy/issues/230
MDU6SXNzdWUzNTU0MjcxOTc=,ALIGNED	& UNALIGNED calculation,CLOSED,2018-08-30T05:13:11Z,2018-09-08T06:35:33Z,2018-09-08T06:35:33Z,"An Unicycler hybrid-assembled plasmid (~34k) was mapped using its Illumina reads (same reads used in assembly, about 200x depth on average) previously gave us ZERO unaligned region (probably done by snippy 3.x or 4.0.dev). 

However, we did the same thing this week using snippy 4.1 and it told us there were two regions (~500bp x 2) with '-', hence ~1000bp had coverage=0  

We are not sure if this is normal, and wondering which is correct, thanks.

All snippy settings remained as default.",fengyuchengdu,https://github.com/tseemann/snippy/issues/231
MDU6SXNzdWUzNTY0MTU5OTQ=,snps.txt ReferenceSize is wrong,CLOSED,2018-09-03T09:00:57Z,2018-09-08T06:20:53Z,2018-09-08T06:20:53Z,"ReferenceSize   12717410
But the fasta has 12498763 
This is out by 218647 bp

From #231 
",tseemann,https://github.com/tseemann/snippy/issues/232
MDU6SXNzdWUzNTg0NDYwMzY=,FreeBayes ploidy:,CLOSED,2018-09-10T02:35:34Z,2018-09-10T03:14:59Z,2018-09-10T03:14:59Z,"Hi Torsten,

Just a quick question re. the default ploidy level for the variant calling step. Is there a reason that the default FreeBayes option for SNIPPY is -p2 (diploid)?

Thanks again for building this pipeline!

Best regards,
Raphael",EisenRa,https://github.com/tseemann/snippy/issues/233
MDU6SXNzdWUzNTg4ODU0MDc=,Is 5 SNPS + 1 DEL better than 1 INS and 2 DEL ,OPEN,2018-09-11T04:49:34Z,2018-10-03T03:37:36Z,,"I really don't want to use GATK indel realigner.

![image](https://user-images.githubusercontent.com/453972/45338661-aec8fd00-b5d1-11e8-960e-0c7e2eeb3c3e.png)

```
CP006053        1598997 .       
GGCGGCGGCGCGCGGGCTTTTCCA        
GCGCGGCGGCGCGGGCTTTTCCA 
2065.7

wt              G-GCGGCGGCGCGCGGGCTTTTCCA
mut             GCGCGGCG--GCGCGGGCTTTTCCA
                * ******  ***************

CP006053        1598998 .       GCGGCGGC        CGCGGCG

wt2             -GCGGCGGC
mut2            CGCGGCG--
                 ******

Looks like 1 INS, 2 DEL


Naive alignment:

GCGGCGGC        
CGCGGCG
xxx|x|x-

5 SNPs, 1 DEL

```

",tseemann,https://github.com/tseemann/snippy/issues/234
MDU6SXNzdWUzNTk3MTMzNzA=,mask non-ATCG nucleotides in reference?,CLOSED,2018-09-13T01:55:40Z,2018-09-16T06:23:28Z,2018-09-16T06:23:11Z,"ran into an issue where the final step, bcftools consensus didn't like the Y in the reference sequence",mcroxen,https://github.com/tseemann/snippy/issues/235
MDU6SXNzdWUzNTk3ODg2NzY=,Describe --mask auto in the --help,OPEN,2018-09-13T08:13:58Z,2020-02-24T04:40:07Z,,"It's a secret
",tseemann,https://github.com/tseemann/snippy/issues/236
MDU6SXNzdWUzNjAxNjM1NzY=,--mask auto produces lots of redundant BED regions,CLOSED,2018-09-14T05:39:59Z,2018-09-14T08:48:13Z,2018-09-14T08:48:13Z,"Because each repeat hits all the other repeats, you get multple similar zones.
Need to close/consolidate them using bedtools: https://bedtools.readthedocs.io/en/latest/

![image](https://user-images.githubusercontent.com/453972/45531709-504f8900-b834-11e8-8323-e4d4901432fe.png)
",tseemann,https://github.com/tseemann/snippy/issues/237
MDU6SXNzdWUzNjA2MDkxNTg=,How to handle N in reference,OPEN,2018-09-16T06:31:47Z,2018-09-16T06:31:55Z,,"In https://github.com/tseemann/snippy/issues/235 i replaced all IUPAC with `n` so that `bcftools` didn't complain.

side effct is that you can get snps like this:
```
NZ_FPDY01000049 392     .       NTTTC   TTTTG
NZ_FPDY01000005 132369  .       N       G
```
which is good for assembly correction
but could be bad for snipp-core phyolgeny, as a bad reference will mask this as non-core
despite all the isolates having it.
",tseemann,https://github.com/tseemann/snippy/issues/238
MDU6SXNzdWUzNjE2OTk5NzE=,brew install on MacOS throws error,CLOSED,2018-09-19T11:20:36Z,2018-10-09T04:09:05Z,2018-10-09T04:09:04Z,"Installing using homebrew on MacOSX 10:13

brew install brewsci/bio/snippy
==> Installing snippy from brewsci/bio
snippy: Linux is required.
Error: An unsatisfied requirement failed this build.

So the brew installer is looking for ""Linux""; is this inside the snippy bundle or is this some dependency?",mblaxter,https://github.com/tseemann/snippy/issues/239
MDU6SXNzdWUzNjM0NjkzMTM=,Use of uninitialized value,CLOSED,2018-09-25T08:42:45Z,2021-10-21T02:53:21Z,2018-10-02T23:31:25Z,"Hi Torsten,

I have used snippy without issue for ages but have started getting an error message:

### /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 4175 SNPs to TAB format.

### /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf

Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 28.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 29.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 30.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 31.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 32.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 33.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 34.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 35.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 36.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 37.
Use of uninitialized value in concatenation (.) or string at /gpfs0/users/bag/lipworth/miniconda2/bin/snippy-vcf_extract_subs line 137, <> line 38.

Having said this, the output from snippy still looks OK.  Any idea what the issue is?",samlipworth,https://github.com/tseemann/snippy/issues/240
MDU6SXNzdWUzNjYxMDQ2NjI=,Remove need for 'uniq' not in macos list::util,CLOSED,2018-10-02T22:29:26Z,2018-10-02T22:35:57Z,2018-10-02T22:35:52Z,"```
==> /usr/local/Cellar/snippy/4.2.1/bin/snippy-core --check
""uniq"" is not exported by the List::Util module
Can't continue after import errors at /usr/local/Cellar/snippy/4.2.1/bin/snippy-core line 9.
BEGIN failed--compilation aborted at /usr/local/Cellar/snippy/4.2.1/bin/snippy-core line 9.
I forgot mac perl modules are ancient!

/usr/bin/perldoc List::Util
       use List::Util qw(first max maxstr min minstr reduce shuffle sum);
perldoc List::Util

        use List::Util qw(
          reduce any all none notall first

          max maxstr min minstr product sum sum0

          pairs unpairs pairkeys pairvalues pairfirst pairgrep pairmap

          shuffle uniq uniqnum uniqstr
        );
```
",tseemann,https://github.com/tseemann/snippy/issues/241
MDU6SXNzdWUzNjY5NTc2ODI=,seqret parsing of fasta headers with pipes causes snippy-core to not parse reference information correctly ,CLOSED,2018-10-04T20:29:43Z,2018-10-04T23:30:57Z,2018-10-04T23:30:54Z,"seqret is changing fasta headers that is causing issues with snippy-core
input headers:
>NC_003197|1
>NC_003277

output headers:
>1 NC_003197
>NC_003277

These headers then get parsed as chromsome ids: ""1"",""NC_003277"" which no longer match the fasta information in the snippy folder.
Use of uninitialized value in transliteration (tr///) at line 174,175

This causes the unaligned portion to always be reported at 0bp.

If I run snippy with reference fastas without pipes then everything works great.",jrober84,https://github.com/tseemann/snippy/issues/242
MDU6SXNzdWUzNjkyMTkzNjg=,Question: snippy-core,CLOSED,2018-10-11T17:09:21Z,2018-10-11T23:38:05Z,2018-10-11T23:38:05Z,"I am running **snippy-core** with all output folders but it demands the **reference fasta**, although the reference is contained in all folders as ref.fa and reference/

`snippy-core folder1 folder2 folder3`

ERROR: Please provide --ref FASTA/GENBANK


",mweberr,https://github.com/tseemann/snippy/issues/243
MDU6SXNzdWUzNjkzMTI1NjQ=,Read 0 Write 0 read,CLOSED,2018-10-11T21:29:19Z,2019-11-03T05:55:35Z,2019-11-03T05:55:35Z,"Hi Torsten,

I've tried to run Snippy but it always gave me the following error in snps.log, could you help me out please:
```
### snippy/bin/snippy --cpus 16 --outdir snippy_test_FA --ref GCA_003014415.1_Ca
nd_auris_B11243_genomic.fna --R1 /data/huangx12/XinHuang/Cauris/CDCSecondBatch/m
etagenomics/input/GC_1836.R1.nohuman.r1.fastq --R2 /data/huangx12/XinHuang/Cauri
s/CDCSecondBatch/metagenomics/input/GC_1836.R1.nohuman.r2.fastq

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.12 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 7.59 seconds elapse.
[bwa_index] Update BWT... 0.08 sec
[bwa_index] Pack forward-only FASTA... 0.08 sec
[bwa_index] Construct SA from BWT and Occ... 2.86 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 10.916 sec; CPU: 10.738 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:snippy_test_FA\tSM:snippy_test_FA' -t 16 reference/ref.fa /data/huangx12/XinHuang/Cauris/CDCSecondBatch/metagenomics/input/GC_1836.R1.nohuman.r1.fastq /data/huangx12/XinHuang/Cauris/CDCSecondBatch/metagenomics/input/GC_1836.R1.nohuman.r2.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/huangx12/snippy.38235. --threads 16 -m 500M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/huangx12/snippy.38235. --threads 16 -m 500M | samtools markdup -T /tmp/huangx12/snippy.38235. -r -s - - > snps.bam

READ 0 WRITTEN 0 
EXCLUDED 0 EXAMINED 0
PAIRED 0 SINGLE 0
DULPICATE PAIR 0 DUPLICATE SINGLE 0
DUPLICATE TOTAL 0

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 405880 > reference/ref.txt


### freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf

Error: Failed to set region: -1:0-329,236(*)
ERROR(freebayes): Could not SetRegion to PYGM01000001.1:0..329236
Error: Failed to set region: -1:0-311,833(*)
ERROR(freebayes): Could not SetRegion to PYGM01000002.1:0..311833
Error: Failed to set region: -1:0-281,846(*)
ERROR(freebayes): Could not SetRegion to PYGM01000003.1:0..281846
Error: Failed to set region: -1:0-270,269(*)
```
What am I doing wrong?

Thank you,

Xin",XinHuang87,https://github.com/tseemann/snippy/issues/244
MDU6SXNzdWUzNjkzNzY1NDA=,Check folder parameters are actually folders,CLOSED,2018-10-12T02:37:56Z,2018-10-12T22:49:43Z,2018-10-12T22:49:43Z,"```
ERROR: Could not find .aligned.fa/.vcf in ST93.aln
```
",tseemann,https://github.com/tseemann/snippy/issues/245
MDU6SXNzdWUzNjk2MjU3NTk=,"Snippy-core error: ""Alignment core.full.aln contains sequences of unequal length""",CLOSED,2018-10-12T16:37:59Z,2019-12-02T05:04:37Z,2019-12-02T05:04:37Z,"I performed snippy for 74 isolates of P. aeruginosa in batch, using the same reference genome for all. The reference I used is a PacBio assembled genome, corrected using pilon. However, when I used the snippy-core script with the same reference:

$ /home/localadmin/snippy/bin/snippy-core' --ref st17_pilon.fasta <output folders from snippy>

I get the following error:

""Running: snp-sites -c -o core.aln core.full.aln
snp-sites: invalid option -- 'c'
Alignment core.full.aln contains sequences of unequal length. Expected length is 0 but got 6706800 in sequence Reference

ERROR: Could not run: snp-sites -c -o core.aln core.full.aln""

I can't understand why this happens. It seems to be happening after I updated snippy to the new version, as before there was no error but I'm not sure this is the reason.

[README_snippy_core.docx](https://github.com/tseemann/snippy/files/2473872/README_snippy_core.docx)",BaMagalhaes,https://github.com/tseemann/snippy/issues/246
MDU6SXNzdWUzNjk3Mzc1NDM=,Check ref IDs match .aln IDs ,CLOSED,2018-10-12T23:05:42Z,2019-10-03T23:04:06Z,2019-10-03T23:04:06Z,"
![image](https://user-images.githubusercontent.com/453972/46897619-728a0480-cecf-11e8-9568-7842acc8df60.png)

```
  ($seq{$id}) = load_fasta_hash($afa, 0);  # load snippy alignment (no uppercase)
  my $unal = sum( map { $seq{$id}{$_} =~ tr/-/-/ } @$chrom_list );
  my $nhet = sum( map { $seq{$id}{$_} =~ tr/n/n/ } @$chrom_list );
```
",tseemann,https://github.com/tseemann/snippy/issues/247
MDU6SXNzdWUzNjk4NjYxNTg=,Hompolymer indels with long context in VCF masking as het unncessarily,OPEN,2018-10-14T04:18:57Z,2018-10-14T04:18:57Z,,"Can use `bcftools norm` to fix this.

```
( bcftools norm -f ref.fa -Ov snps.bcf | grep INDEL | head && echo && bcftools view snps.bcf | grep INDEL | head  ) | less -S
##INFO=<ID=INDEL,Number=0,Type=Flag,Description=""Indicates that the variant is an INDEL."">
Chromosome      33      .       A       AG      36.9456 .       INDEL;IDV=25;IMF=0.925926;DP=27;V>
Chromosome      113     .       G       GA      60      .       INDEL;IDV=39;IMF=0.906977;DP=43;V>
Chromosome      5423    .       AG      A       36.4154 .       INDEL;IDV=2;IMF=1;DP=2;VDB=0.02;S>
Chromosome      11443   .       TACG    T       228     .       INDEL;IDV=78;IMF=0.928571;DP=84;V>
Chromosome      19161   .       T       TA      98      .       INDEL;IDV=25;IMF=0.581395;DP=43;V>
Chromosome      19299   .       TC      T       199     .       INDEL;IDV=59;IMF=0.951613;DP=62;V>
Chromosome      19600   .       G       GCAA    228     .       INDEL;IDV=83;IMF=0.912088;DP=91;V>
Chromosome      19602   .       A       AACT    228     .       INDEL;IDV=1;IMF=0.0111111;DP=90;V>
Chromosome      27369   .       GGT     G       218     .       INDEL;IDV=52;IMF=0.776119;DP=67;V>

##INFO=<ID=INDEL,Number=0,Type=Flag,Description=""Indicates that the variant is an INDEL."">
Chromosome      33      .       AGGGGG  AGGGGGG 36.9456 .       INDEL;IDV=25;IMF=0.925926;DP=27;V>
Chromosome      113     .       GAAAAAAA        GAAAAAAAA       60      .       INDEL;IDV=39;IMF=>
Chromosome      5423    .       AG      A       36.4154 .       INDEL;IDV=2;IMF=1;DP=2;VDB=0.02;S>
Chromosome      11443   .       TACGA   TA      228     .       INDEL;IDV=78;IMF=0.928571;DP=84;V>
Chromosome      19161   .       TAA     TAAA    98      .       INDEL;IDV=25;IMF=0.581395;DP=43;V>
Chromosome      19299   .       TC      T       199     .       INDEL;IDV=59;IMF=0.951613;DP=62;V>
Chromosome      19600   .       GCAA    GCAACAA 228     .       INDEL;IDV=83;IMF=0.912088;DP=91;V>
Chromosome      19602   .       AA      AACTA   228     .       INDEL;IDV=1;IMF=0.0111111;DP=90;V>
Chromosome      27369   .       GGTG    GG      218     .       INDEL;IDV=52;IMF=0.776119;DP=67;V>
```
",tseemann,https://github.com/tseemann/snippy/issues/248
MDU6SXNzdWUzNzEzMjE5MTg=,Add version and comand line to log file,CLOSED,2018-10-18T01:03:59Z,2019-04-02T00:23:25Z,2019-04-02T00:23:25Z,"Especially version
",tseemann,https://github.com/tseemann/snippy/issues/249
MDU6SXNzdWUzNzE3MjUyNjE=,any2fasta not handling .fasta ref ,CLOSED,2018-10-18T21:41:29Z,2018-10-18T22:38:41Z,2018-10-18T22:38:41Z,"Hey @tseemann the `any2fasta ` (line 90) is stopping `snippy-core` taking a .fa as a reference... I think?
The error I get is `Unknown option: f`",kristyhoran,https://github.com/tseemann/snippy/issues/250
MDU6SXNzdWUzNzIzNjc3NTU=,"Is core.full.aln a ""core"" genome alignment or ""reference"" genome alignment?",CLOSED,2018-10-21T23:25:13Z,2018-10-22T23:37:55Z,2018-10-22T23:33:10Z,"Hi,

Searched around a bit but couldn't find anything on the topic.

I found that the ""core.full.aln"" file is a whole genome alignment the same length as the reference sequence. I assume this means that the set of core SNPs for each isolate was simply imprinted on the reference sequence? (and so positions would be included in the alignment regardless of whether an isolate actually has data for those positions or not; the isolate would just have a reference base at any ""missing"" sites)

If the above statement is true, then is it possible to obtain a ""core genome alignment"" from Snippy, where it is a genome alignment containing variant and invariant sites but only from positions that are present among ALL isolate genomes?

I ask because I am interested in running a BEAST analysis afterward, and am not sure how clock rate estimation/etc. would be affected by including positions absent from an isolate in an alignment.

Thanks!
Conrad",cizydorczyk,https://github.com/tseemann/snippy/issues/251
MDU6SXNzdWUzNzIzNzAwNDY=,"Is the core.full.aln a ""core"" alignment or ""reference"" alignment?",CLOSED,2018-10-22T00:13:18Z,2018-10-22T16:09:45Z,2018-10-22T16:09:45Z,"Hello,

Is the Snippy core.full.aln an imprint of SNPs for each isolate onto the reference sequence (which I would assume based on the fact it is the same length as the reference)? As opposed to it including invariant positions only present among all isolates (leaving out those that might be in the reference but are missing from >=1 isolate)?

Is it possible to obtain an alignment such as the one described in the second scenario? I ask because I need a core genome alignment for a BEAST analysis I wish to run.

Thanks!
Conrad",cizydorczyk,https://github.com/tseemann/snippy/issues/252
MDU6SXNzdWUzNzUyNTE3MzA=,Contig shredding coverage with --ctgs,CLOSED,2018-10-29T23:00:52Z,2018-10-29T23:20:06Z,2018-10-29T23:20:06Z,"In the section on the README file below states that when using the `--ctgs` option snippy will shred contigs into reads at 2x the `--mincov` value. I have been running snippy with `--mincov` values of 10 (default), 30, and 40. When I look at the bam files they all show coverage values of ~20. Now my impression is that the `--ctgs` command shreds contigs into reads at coverage value of 20, and that changing the `--mincov` argument in the `snippy` command will not affect the read coverage. Is this how you intend the program to run? If so, could you clarify the README document, so it is clear that the coverage value is a fixed value. 

I was trying to increase the coverage of the shredded contigs to improve SNP detection, I realize now, I should be lowering the `--mincov`. I stumbled across issue #50, which helped me understand the pattern I was seeing in my bam files.  

**Finding SNPs between contigs**
Sometimes one of your samples is only available as contigs, without corresponding FASTQ reads. You can still use these contigs with Snippy to find variants against a reference. It does this by shredding the contigs into 250 bp single-end reads at `2 &times; --mincov uniform` coverage.",keithbg,https://github.com/tseemann/snippy/issues/253
MDU6SXNzdWUzNzg1NTY1MTg=,Annotations not showing in core.tab,OPEN,2018-11-08T02:50:46Z,2020-05-10T06:45:00Z,,"Hi @tseemann,

With the update to snippy v.4, are annotations dropped from the core.tab files produced in snippy-core? I can see annotations in my individual snp.tab files (i.e. for each sample), but after I run snippy-core on 21 samples, core.tab only has headings CHR, POS, REF, and all my samples names. 

Thanks!",sabrinadiemert,https://github.com/tseemann/snippy/issues/254
MDU6SXNzdWUzNzkyNzY3MDA=,error message,CLOSED,2018-11-09T18:41:42Z,2018-11-12T07:06:14Z,2018-11-12T07:06:14Z,"I constructed a pangenome reference from Roary (pan_genome_reference.gbk) and run snippy using Campylobacter fasta files with it- it was fine. When I run a Helicobacter pangenome reference, I have this error message with a folder of reference file generated but without the typical snippy output. 

I installed snippy via miniconda and the version is snippy 4.3.3.

This is the script I used (was successful with Campy before)

for file in *.fa; do tag=${file%.fa}; snippy --cpus 32 --outdir ""$tag"" --reference pan_genome_reference.gbk --ctgs ""$tag"".fa ""$file""; done

Here is the warning message:

--------------------- WARNING ---------------------
MSG: Bad LOCUS name?  Changing [pan_genome_reference_1191083] to 'unknown' and length to 'pan_genome_reference_1191083'
---------------------------------------------------

--------------------- WARNING ---------------------
MSG: Bad LOCUS name?  Changing [pan_genome_reference_1241392] to 'unknown' and length to 'pan_genome_reference_1241392'
---------------------------------------------------
[10:29:58] Duplicate sequence unknown in /pan_genome_reference.gbk",darwinbandoy,https://github.com/tseemann/snippy/issues/255
MDU6SXNzdWUzNzk4MDA0MDI=,Symbol not found,CLOSED,2018-11-12T14:26:16Z,2019-03-13T22:06:43Z,2019-03-13T22:06:43Z,"Hi tseeman,

I am trying to run snippy (v4.3.5) with MacOS, but an error message popped up as follow: 

My command was: ""snippy --cpus 16 --outdir UK48_snps --ref Tohama_ref_genbank.gbff --R1 UK48_1_PE.fasta --R2 UK48_2_PE.fasta""

[12:42:53] This is snippy 4.3.5
[12:42:53] Written by Torsten Seemann
[12:42:53] Obtained from https://github.com/tseemann/snippy
[12:42:53] Detected operating system: darwin
[12:42:53] Enabling bundled darwin tools.
[12:42:53] Found bwa - /Users/carissawong/bwa/bwa
[12:42:53] Found bcftools - /usr/local/bin/bcftools
[12:42:53] Found samtools - /Users/carissawong/samtools-1.9/samtools
[12:42:53] Found java - /usr/bin/java
[12:42:53] Found snpEff - /usr/local/bin/snpEff
[12:42:53] Found samclip - /usr/local/bin/samclip
[12:42:53] Found seqtk - /Users/carissawong/seqtk/seqtk
[12:42:53] Found parallel - /usr/local/bin/parallel
[12:42:53] Found freebayes - /usr/local/bin/freebayes
[12:42:53] Found freebayes-parallel - /usr/local/bin/freebayes-parallel
[12:42:53] Found fasta_generate_regions.py - /usr/local/bin/fasta_generate_regions.py
[12:42:53] Found vcfstreamsort - /usr/local/bin/vcfstreamsort
[12:42:53] Found vcfuniq - /usr/local/bin/vcfuniq
[12:42:53] Found vcffirstheader - /usr/local/bin/vcffirstheader
[12:42:53] Found gzip - /usr/bin/gzip
[12:42:53] Found vt - /usr/local/bin/vt
[12:42:53] Found snippy-vcf_to_tab - /Users/carissawong/snippy/bin/snippy-vcf_to_tab
[12:42:53] Found snippy-vcf_report - /Users/carissawong/snippy/bin/snippy-vcf_report
[12:42:53] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[12:42:53] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[12:42:53] Checking version: freebayes --version is >= 1.1 - ok, have 1.2
[12:42:54] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[12:42:54] Using reference: /Users/carissawong/Tohama_ref_genbank.gbff
[12:42:54] Treating reference as 'genbank' format.
[12:42:54] Will use 16 CPU cores.
[12:42:54] Using read file: /Users/carissawong/UK48_1_PE.fasta
[12:42:54] Using read file: /Users/carissawong/UK48_2_PE.fasta
[12:42:54] Creating folder: UK48_snps
[12:42:54] Changing working directory: UK48_snps
[12:42:54] Creating reference folder: reference
[12:42:54] Extracting FASTA and GFF from reference.
[12:42:57] Wrote 1 sequences to ref.fa
[12:42:57] Wrote 4489 features to ref.gff
[12:42:57] Creating reference/snpeff.config
[12:42:57] Freebayes will process 31 chunks of 134011 bp, 16 chunks at a time.
[12:42:57] Using BAM RG (Read Group) ID: UK48_snps
[12:42:57] Running: samtools faidx reference/ref.fa 2>> snps.log
[12:42:57] Running: bwa index reference/ref.fa 2>> snps.log
[12:42:59] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[12:42:59] Running: ln -sf reference/ref.fa . 2>> snps.log
[12:42:59] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[12:42:59] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[12:42:59] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[12:43:04] Running: bwa mem  -Y -M -R '@RG\tID:UK48_snps\tSM:UK48_snps' -t 16 reference/ref.fa /Users/carissawong/UK48_1_PE.fasta /Users/carissawong/UK48_2_PE.fasta | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /var/folders/jk/m1_krbw926l9pypgvdj4sqx40000gn/T//snippy.51932. --threads 16 -m 500M | samtools fixmate -m - - | samtools sort -l 0 -T /var/folders/jk/m1_krbw926l9pypgvdj4sqx40000gn/T//snippy.51932. --threads 16 -m 500M | samtools markdup -T /var/folders/jk/m1_krbw926l9pypgvdj4sqx40000gn/T//snippy.51932. -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.2 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 1042124 sequences (135654598 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (31, 443697, 7, 4)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (69, 171, 332)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 858)
[M::mem_pestat] mean and std.dev: (166.81, 138.64)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1121)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (354, 426, 508)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (46, 816)
[M::mem_pestat] mean and std.dev: (436.58, 112.71)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 970)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_process_seqs] Processed 1042124 reads in 241.869 CPU sec, 62.778 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[samclip] Processed 300000 records...
[samclip] Processed 400000 records...
[samclip] Processed 500000 records...
[samclip] Processed 600000 records...
[samclip] Processed 700000 records...
[samclip] Processed 800000 records...
[samclip] Processed 900000 records...
[samclip] Processed 1000000 records...
[main] Version: 0.7.17-r1194-dirty
[main] CMD: bwa mem -Y -M -R @RG\tID:UK48_snps\tSM:UK48_snps -t 16 reference/ref.fa /Users/carissawong/UK48_1_PE.fasta /Users/carissawong/UK48_2_PE.fasta
[main] Real time: 69.739 sec; CPU: 243.617 sec
[samclip] Total SAM records 1042940, removed 2784, allowed 1502, passed 1040156
[samclip] Header contained 3 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 16 in-memory blocks...
[bam_sort_core] merging from 0 files and 16 in-memory blocks...
[12:44:27] Running: samtools index snps.bam 2>> snps.log
[12:44:27] Running: fasta_generate_regions.py reference/ref.fa.fai 134011 > reference/ref.txt 2>> snps.log
[12:44:27] Running: freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[12:44:38] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
dyld: Symbol not found: __ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEED1Ev
  Referenced from: /usr/local/bin/vt
  Expected in: /usr/lib/libstdc++.6.dylib
 in /usr/local/bin/vt
[12:44:38] Error running command, check UK48_snps/snps.log

Is there any way of fixing this problem?
Thank you!",wwyc9,https://github.com/tseemann/snippy/issues/256
MDU6SXNzdWUzODAzNTk1MjM=,bam empty (problem with temporary bam file?),CLOSED,2018-11-13T18:17:33Z,2019-07-19T01:56:28Z,2019-07-19T01:56:23Z,"Hi Thorsten,

I am having some issues with snippy-4.2.1

I am running it on about 100 sequences, and a good proportion of them generate empty bam files.
I used snippy 3.0 on some f those samples in the past and I had no issues with them.

I think the problem might comes from the temporary files 

In the error file attached I get the following lines:
[slurm.err_snippy.txt](https://github.com/tseemann/snippy/files/2577485/slurm.err_snippy.txt)

[bam_sort_core] merging from 1 files and 1 in-memory blocks...
[E::hts_open_format] Failed to open file /tmp/snippy.16204..0000.bam
samtools sort: failed to create temporary file ""/tmp/snippy.16204..0000.bam"": File exists

I used the snippy --tmpdir to have a look at the temporary files, and they are being generated and they are not empty. But for some reason snippy cannot open them or merge them. Any idea of why this is happening ? Have you seen this issue before?

Thanks
Gaëtan",gthilliez,https://github.com/tseemann/snippy/issues/257
MDU6SXNzdWUzODI3MDEzNzg=,Alignment statistics for 'SNP caller',OPEN,2018-11-20T14:57:12Z,2019-07-17T21:56:33Z,,"When running core-snp analysis one receives a nice list of alignment/core-size statistics.. How does one obtain similar info for the 'regular' snippy analysis - meaning how many alignments where found with the ref sequence.

Thanks",rgranit,https://github.com/tseemann/snippy/issues/258
MDU6SXNzdWUzODU0OTYyNzQ=,Snpeff error with gbk,CLOSED,2018-11-28T23:07:35Z,2023-07-14T14:08:11Z,2019-04-02T00:27:57Z,"Hi,
I tried running snippy on a set of E. coli genomes with a .gbk reference and I get the following error (at the bottom):

```
$ snippy --outdir 'A058-E01-29-03-2006' --R1 '/home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R1.fastq' --R2 '/home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R2.fastq' --cpus 8 --reference /home/conrad/ecoli/snp-calling/A16_snippy/EC958_sequence.gbk --minfrac 0.9
[15:44:32] This is snippy 4.3.6
[15:44:32] Written by Torsten Seemann
[15:44:32] Obtained from https://github.com/tseemann/snippy
[15:44:32] Detected operating system: linux
[15:44:32] Enabling bundled linux tools.
[15:44:32] Found bwa - /home/conrad/anaconda3/envs/snippy-env/bin/bwa
[15:44:32] Found bcftools - /home/conrad/anaconda3/envs/snippy-env/bin/bcftools
[15:44:32] Found samtools - /home/conrad/anaconda3/envs/snippy-env/bin/samtools
[15:44:32] Found java - /home/conrad/anaconda3/envs/snippy-env/bin/java
[15:44:32] Found snpEff - /home/conrad/anaconda3/envs/snippy-env/bin/snpEff
[15:44:32] Found samclip - /home/conrad/anaconda3/envs/snippy-env/bin/samclip
[15:44:32] Found seqtk - /home/conrad/anaconda3/envs/snippy-env/bin/seqtk
[15:44:32] Found parallel - /home/conrad/anaconda3/envs/snippy-env/bin/parallel
[15:44:32] Found freebayes - /home/conrad/anaconda3/envs/snippy-env/bin/freebayes
[15:44:32] Found freebayes-parallel - /home/conrad/anaconda3/envs/snippy-env/bin/freebayes-parallel
[15:44:32] Found fasta_generate_regions.py - /home/conrad/anaconda3/envs/snippy-env/bin/fasta_generate_regions.py
[15:44:32] Found vcfstreamsort - /home/conrad/anaconda3/envs/snippy-env/bin/vcfstreamsort
[15:44:32] Found vcfuniq - /home/conrad/anaconda3/envs/snippy-env/bin/vcfuniq
[15:44:32] Found vcffirstheader - /home/conrad/anaconda3/envs/snippy-env/bin/vcffirstheader
[15:44:32] Found gzip - /bin/gzip
[15:44:32] Found vt - /home/conrad/anaconda3/envs/snippy-env/bin/vt
[15:44:32] Found snippy-vcf_to_tab - /home/conrad/anaconda3/envs/snippy-env/bin/snippy-vcf_to_tab
[15:44:32] Found snippy-vcf_report - /home/conrad/anaconda3/envs/snippy-env/bin/snippy-vcf_report
[15:44:32] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[15:44:32] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[15:44:32] Checking version: freebayes --version is >= 1.1 - ok, have 1.2
[15:44:33] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[15:44:33] Using reference: /home/conrad/ecoli/snp-calling/A16_snippy/EC958_sequence.gbk
[15:44:33] Treating reference as 'genbank' format.
[15:44:33] Will use 8 CPU cores.
[15:44:33] Using read file: /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R1.fastq
[15:44:33] Using read file: /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R2.fastq
[15:44:33] Creating folder: A058-E01-29-03-2006
[15:44:33] Changing working directory: A058-E01-29-03-2006
[15:44:33] Creating reference folder: reference
[15:44:33] Extracting FASTA and GFF from reference.
[15:44:34] Wrote 1 sequences to ref.fa
[15:44:34] Wrote 5137 features to ref.gff
[15:44:34] Creating reference/snpeff.config
[15:44:34] Freebayes will process 15 chunks of 346333 bp, 8 chunks at a time.
[15:44:34] Using BAM RG (Read Group) ID: A058-E01-29-03-2006
[15:44:34] Running: samtools faidx reference/ref.fa 2>> snps.log
[15:44:34] Running: bwa index reference/ref.fa 2>> snps.log
[15:44:37] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[15:44:37] Running: ln -sf reference/ref.fa . 2>> snps.log
[15:44:37] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[15:44:37] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[15:44:37] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[15:44:41] Running: bwa mem  -Y -M -R '@RG\tID:A058-E01-29-03-2006\tSM:A058-E01-29-03-2006' -t 8 reference/ref.fa /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R1.fastq /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R2.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.12753. --threads 8 -m 1000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.12753. --threads 8 -m 1000M | samtools markdup -T /tmp/snippy.12753. -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.2 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 266722 sequences (80000418 bp)...
[M::process] read 266720 sequences (80000264 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (27, 118178, 3, 14)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (281, 357, 554)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1100)
[M::mem_pestat] mean and std.dev: (371.08, 198.49)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1373)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (341, 403, 498)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (27, 812)
[M::mem_pestat] mean and std.dev: (429.38, 113.44)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 969)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (301, 374, 1570)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 4108)
[M::mem_pestat] mean and std.dev: (724.77, 631.17)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 5377)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_process_seqs] Processed 266722 reads in 41.550 CPU sec, 5.647 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[M::process] read 27476 sequences (8241827 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (11, 117877, 1, 15)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (211, 267, 669)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1585)
[M::mem_pestat] mean and std.dev: (392.09, 245.97)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2043)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (343, 407, 506)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (17, 832)
[M::mem_pestat] mean and std.dev: (433.95, 117.29)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 995)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (137, 249, 1364)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3818)
[M::mem_pestat] mean and std.dev: (661.73, 864.58)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 5045)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_process_seqs] Processed 266720 reads in 43.672 CPU sec, 5.971 real sec
[samclip] Processed 300000 records...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (1, 12196, 0, 2)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (343, 406, 502)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (25, 820)
[M::mem_pestat] mean and std.dev: (432.61, 114.89)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 979)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_process_seqs] Processed 27476 reads in 4.755 CPU sec, 0.681 real sec
[samclip] Processed 400000 records...
[samclip] Processed 500000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @RG\tID:A058-E01-29-03-2006\tSM:A058-E01-29-03-2006 -t 8 reference/ref.fa /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R1.fastq /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R2.fastq
[main] Real time: 13.396 sec; CPU: 90.393 sec
[samclip] Total SAM records 562252, removed 24219, allowed 22620, passed 538033
[samclip] Header contained 3 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 8 in-memory blocks...
[bam_sort_core] merging from 0 files and 8 in-memory blocks...
[15:45:06] Running: samtools index snps.bam 2>> snps.log
[15:45:06] Running: fasta_generate_regions.py reference/ref.fa.fai 346333 > reference/ref.txt 2>> snps.log
[15:45:06] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[15:45:40] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0.9' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [n] no fail on reference inconsistency for non SNPs false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa


stats: biallelic
          no. left trimmed                      : 0
          no. right trimmed                     : 15
          no. left and right trimmed            : 2
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. biallelic normalized           : 17

       multiallelic
          no. left trimmed                      : 0
          no. right trimmed                     : 0
          no. left and right trimmed            : 0
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. multiallelic normalized        : 0

       total no. variants normalized            : 17
       total no. variants observed              : 529
       total no. reference observed             : 0

Time elapsed: 0.01s

[15:45:40] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[15:45:41] Error running command, check A058-E01-29-03-2006/snps.log
```
The only warning I can find in the log file is a warning that ""all frames are 0"" indicated by snpeff:

```
### cd /home/conrad/ecoli/snp-calling/A16_snippy

### /home/conrad/anaconda3/envs/snippy-env/bin/snippy --outdir A058-E01-29-03-2006 --R1 /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R1.fastq --R2 /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R2.fastq --cpus 8 --reference /home/conrad/ecoli/snp-calling/A16_snippy/EC958_sequence.gbk --minfrac 0.9

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.03 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.17 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.04 sec
[bwa_index] Construct SA from BWT and Occ... 0.43 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 2.162 sec; CPU: 1.717 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:A058-E01-29-03-2006\tSM:A058-E01-29-03-2006' -t 8 reference/ref.fa /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R1.fastq /home/conrad/ecoli/fastq-files/a2-trimmed-fastq-q5/paired/A058-E01-29-03-2006_paired_R2.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.12753. --threads 8 -m 1000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.12753. --threads 8 -m 1000M | samtools markdup -T /tmp/snippy.12753. -r -s - - > snps.bam

READ 538033 WRITTEN 532315 
EXCLUDED 43103 EXAMINED 494930
PAIRED 478172 SINGLE 16758
DULPICATE PAIR 1842 DUPLICATE SINGLE 3876
DUPLICATE TOTAL 5718

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 346333 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0.9' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf
```
Indeed, I checked the .gff file and all frames are 0...but this is a valid option for a gff file (from my understanding) and shouldn't be breaking the script?

I am using snippy v4.3.6 and snpeff v4.3. I have tried running with a plain fasta instead of a .gbk and it runs no problem. My reference is a (decently) well-annotated E. coli ST131 genome: https://www.ncbi.nlm.nih.gov/nuccore/HG941718.1, so I don't think there should be any problems with the .gbk file.

I have searched for similar issues and found a couple, but all with old versions of snippy/snpeff. I gather bcftools csq is not yet implemented in snippy?",cizydorczyk,https://github.com/tseemann/snippy/issues/259
MDU6SXNzdWUzODk3OTQ3MjA=,Snippy bcftools error,CLOSED,2018-12-11T14:38:41Z,2020-05-23T22:53:25Z,2019-04-01T23:44:29Z,"Hello,

After checking the ""python"" problem, I am faced with another error :
[samclip] Processed 1000000 records...
[samclip] Processed 1100000 records...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (375, 119604, 8, 295)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (244, 342, 530)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1102)
[M::mem_pestat] mean and std.dev: (382.64, 213.66)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1388)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (335, 442, 565)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1025)
[M::mem_pestat] mean and std.dev: (455.22, 179.76)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1255)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (233, 399, 624)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1406)
[M::mem_pestat] mean and std.dev: (432.64, 280.90)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1797)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_process_seqs] Processed 246550 reads in 60.030 CPU sec, 20.808 real sec
[samclip] Processed 1200000 records...
[samclip] Processed 1300000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @rg\tID:mysnps\tSM:mysnps -t 8 reference/ref.fa /Users/jordanv/Pseudomonas-CHAR_R1_001.fastq /Users/jordanv/Pseudomonas-CHAR_R2_001.fastq
[main] Real time: 136.626 sec; CPU: 352.724 sec
[samclip] Total SAM records 1381406, removed 547162, allowed 87919, passed 834244
[samclip] Header contained 3 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 8 in-memory blocks...
[bam_sort_core] merging from 0 files and 8 in-memory blocks...
[14:55:33] Running: samtools index snps.bam 2>> snps.log
[14:55:35] Running: fasta_generate_regions.py reference/ref.fa.fai 465500 > reference/ref.txt 2>> snps.log
[14:55:35] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05 -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[14:56:20] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
dyld: Symbol not found: __ZNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEED1Ev
Referenced from: /usr/local/bin/vt
Expected in: /usr/lib/libstdc++.6.0.9.dylib
in /usr/local/bin/vt
[14:56:20] Error running command, check mysnps/snps.log

When I open the snps.log, I got this at the end:

bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf

Failed to open -: unknown file type

I try to use genbank or fasta file as ref, and I had the same error...

Thank's for your help.",JordanVV,https://github.com/tseemann/snippy/issues/260
MDU6SXNzdWUzOTc3ODQxMTQ=,Conda installation,CLOSED,2019-01-10T11:19:10Z,2019-07-19T01:55:42Z,2019-07-19T01:55:36Z,"I am trying to install snippy on the Anaconda environment using `conda install -c conda-forge -c bioconda snippy` and after installation I am having the version 3.1 and not the recent version. Is there any reason why this is happening?
I am running a Linux Mint 19 Cinnamon.
Thanks",idolawoye,https://github.com/tseemann/snippy/issues/261
MDU6SXNzdWU0MDA3NDY5Nzg=,Snippy-core insists on a reference. ,CLOSED,2019-01-18T14:27:47Z,2019-04-01T23:46:23Z,2019-04-01T23:46:23Z,"Running snippy 4.3.6 installed via conda

snippy-core insists on a --ref  (reference) although I don't see why. 

```
(base) (.venv) [galaxy@head-galaxy __snippy@4.3.6]$ bin/snippy-core  folder1    folder2  folder3 
This is snippy-core 4.3.6
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools.
Found any2fasta - /export/tool_deps/_conda/envs/__snippy@4.3.6/binaries/noarch/any2fasta
Found samtools - /export/tool_deps/_conda/bin/samtools
Found minimap2 - /export/tool_deps/_conda/bin/minimap2
Found bedtools - /export/tool_deps/_conda/bin/bedtools
Found snp-sites - /export/tool_deps/_conda/bin/snp-sites
ERROR: Please provide --ref FASTA/GENBANK

```",happykhan,https://github.com/tseemann/snippy/issues/262
MDU6SXNzdWU0MDA5MjQ4OTg=,snippy-multi .sh has wrong snippy-core --ref,CLOSED,2019-01-18T23:17:07Z,2019-04-01T22:43:11Z,2019-04-01T22:43:10Z,"I've been using `snippy-multi` to generate the output script, `runme.sh`. Looking at `runme.sh`, I noticed that the `snippy-core` script at the end has the wrong `--ref` defined. Instead of using the reference fasta I defined with the `snippy-multi --ref` flag, `snippy-core` lists the first sample in the tab separated input file as the reference. Interestingly, it looks like the _correct_ reference file is being used when `snippy-multi`/`snippy-core` runs, but the `runme.sh` file is confusingly wrong. Perhaps I'm missing something? Below is a small example:

`cat input_samples.tab`
sample1	sample1_trim_R1_paired.fastq.gz	sample1_trim_R2_paired.fastq.gz
sample2	sample2_trim_R1_paired.fastq.gz	sample2_trim_R2_paired.fastq.gz
sample3	sample3_trim_R1_paired.fastq.gz	sample3_trim_R2_paired.fastq.gz

`snippy-multi input_samples.tab --ref reference.fasta > snippy_multi.sh`

`cat snippy_multi.sh`
snippy --outdir 'sample1' --R1 'sample1_trim_R1_paired.fastq.gz' --R2 'sample1_trim_R2_paired.fastq.gz' --ref reference.fasta
snippy --outdir 'sample2' --R1 'sample2_trim_R1_paired.fastq.gz' --R2 'sample2_trim_R2_paired.fastq.gz' --ref reference.fasta
snippy --outdir 'sample3' --R1 'sample3_trim_R1_paired.fastq.gz' --R2 'sample3_trim_R2_paired.fastq.gz' --ref reference.fasta
snippy-core --ref 'sample1/ref.fa' sample1 sample2 sample3

`sh ./snippy_multi.sh`

`cat core.txt`
ID	LENGTH	ALIGNED	UNALIGNED	VARIANT	HET	MASKED	LOWCOV
sample1	4616416	4550945	26943	656	311	0	38217
sample2	4616416	4559071	33021	652	313	0	24011
sample3	4616416	4561979	26924	629	268	0	27245
Reference	4616416	4616416	0	0	0	0	0
",eam12,https://github.com/tseemann/snippy/issues/263
MDU6SXNzdWU0MDMzMDc0ODQ=,BEGIN failed--compilation aborted at ./snippy-core line 7.,CLOSED,2019-01-25T19:46:45Z,2023-03-18T06:39:20Z,2019-12-02T05:04:06Z,"Please I need help. 
I need to run snippy-core, but this was the error:
BEGIN failed--compilation aborted at ./snippy-core line 7.

My command was: ./snippy-core --ref /home/bioinformatica/C_Bioinformatica/Lazaro_Lactobacillus/Glr1_annotated/PROKKA_01172019.gbk /home/bioinformatica/C_Bioinformatica/Lazaro_Lactobacillus/snippyGlr1_3_24012019 /home/bioinformatica/C_Bioinformatica/Lazaro_Lactobacillus/Snippy_Fas23_18012019 

Version of snippy: snippy 4.3.6
Thanks for your help!

Regards

Belén",BioinformaticaUSFQ,https://github.com/tseemann/snippy/issues/264
MDU6SXNzdWU0MDQ2OTMzNjU=,Masking issue,CLOSED,2019-01-30T10:07:09Z,2019-09-30T08:54:24Z,2019-09-28T09:29:51Z,"I'm have a feeling that this is a silly formatting issue but I keep getting the error from snippy-core `ERROR: BED [Chrom ChromStart ChromEnd locus tag Comment] has CHR that is not in the reference`

My command is `snippy-core --prefix core-SNPs --mask /data/pilot_strain_heterogeneity/data/interim/snippy/Locus_to_exclude_Mtb_new.bed --ref /data/pilot_strain_heterogeneity/data/external/NC_000962/NC_000962.3.fasta /data/pilot_strain_heterogeneity/data/interim/snippy/PC12_S41 /data/pilot_strain_heterogeneity/data/interim/snippy/PC13_S20`

My BED file looks like this
```
head /data/pilot_strain_heterogeneity/data/interim/snippy/Locus_to_exclude_Mtb_new.bed
Chrom   ChromStart      ChromEnd        locus tag       Comment
gi|448814763|ref|NC_000962.3|   23182   23269   IG18_Rv0018c-Rv0019c
gi|448814763|ref|NC_000962.3|   33582   33794   Rv0031  remnant of A transposase
gi|448814763|ref|NC_000962.3|   80194   80623   IG71_Rv0071-Rv0072
gi|448814763|ref|NC_000962.3|   103710  104663  Rv0094c 50bp_duplicated
gi|448814763|ref|NC_000962.3|   104663  104805  IG_Rv0094c-Rv0095c
gi|448814763|ref|NC_000962.3|   104805  105215  Rv0095c 50bp_duplicated
gi|448814763|ref|NC_000962.3|   105215  105324  IG_Rv0095c-Rv0096
gi|448814763|ref|NC_000962.3|   105324  106715  Rv0096  PPE family protein
gi|448814763|ref|NC_000962.3|   131382  132872  Rv0109  PE-PGRS family protein
```
And the reference is
```
head /data/pilot_strain_heterogeneity/data/external/NC_000962/NC_000962.3.fasta
>gi|448814763|ref|NC_000962.3| Mycobacterium tuberculosis H37Rv, complete genome
TTGACCGATGACCCCGGTTCAGGCTTCACCACAGTGTGGAACGCGGTCGTCTCCGAACTTAACGGCGACC
CTAAGGTTGACGACGGACCCAGCAGTGATGCTAATCTCAGCGCTCCGCTGACCCCTCAGCAAAGGGCTTG
GCTCAATCTCGTCCAGCCATTGACCATCGTCGAGGGGTTTGCTCTGTTATCCGTGCCGAGCAGCTTTGTC
CAAAACGAAATCGAGCGCCATCTGCGGGCCCCGATTACCGACGCTCTCAGCCGCCGACTCGGACATCAGA
TCCAACTCGGGGTCCGCATCGCTCCGCCGGCGACCGACGAAGCCGACGACACTACCGTGCCGCCTTCCGA
AAATCCTGCTACCACATCGCCAGACACCACAACCGACAACGACGAGATTGATGACAGCGCTGCGGCACGG
GGCGATAACCAGCACAGTTGGCCAAGTTACTTCACCGAGCGCCCGCACAATACCGATTCCGCTACCGCTG
GCGTAACCAGCCTTAACCGTCGCTACACCTTTGATACGTTCGTTATCGGCGCCTCCAACCGGTTCGCGCA
CGCCGCCGCCTTGGCGATCGCAGAAGCACCCGCCCGCGCTTACAACCCCCTGTTCATCTGGGGCGAGTCC
```

for comparison, the bed files that snippy has generated from the same data look like this
```
head PC12_S41/snps.bed
gi|448814763|ref|NC_000962.3|   1848    1849
gi|448814763|ref|NC_000962.3|   1976    1977
gi|448814763|ref|NC_000962.3|   4012    4013
gi|448814763|ref|NC_000962.3|   7361    7362
gi|448814763|ref|NC_000962.3|   7584    7585
gi|448814763|ref|NC_000962.3|   9303    9304
gi|448814763|ref|NC_000962.3|   11819   11820
gi|448814763|ref|NC_000962.3|   11878   11879
gi|448814763|ref|NC_000962.3|   14784   14785
gi|448814763|ref|NC_000962.3|   14860   14861
```

I'm using snippy-core 4.3.2 and have tried using sed to change the bed file to all kinds of different chrom fields but no success. I've also tried removing the header and the metadata columns, but then get `ERROR: BED [gi|448814763|ref|NC_000962.3|  2356729 2358206] has CHR that is not in the reference`",pgcudahy,https://github.com/tseemann/snippy/issues/265
MDU6SXNzdWU0MDc1MDY0NjA=,"snps.aligned.fa consensus is different from snps.bam on TYPE=""complex""",OPEN,2019-02-07T01:29:21Z,2019-07-18T02:37:23Z,,"Hi Torsten,
Thank you for making this tool

I found an issue when comparing snps.bam (i opened the alignment with tablet), snps.filt.vcf and snps.aligned.fa

The problem occur when when the TYPE in vcf is detected as ""complex"", and the amount of nucleotide from reference is different from alternatife.

![tablet snps filt vcf and fasta](https://user-images.githubusercontent.com/47404887/52384924-a10d9a00-2ad3-11e9-8b02-51435e055b36.png)


![screenshot from 2019-02-07 13-58-41](https://user-images.githubusercontent.com/47404887/52388041-ae7d5100-2ae0-11e9-86f3-b3eeceb4024f.png)


Can you fix this problem, please?

Thank you
Noel
",noeldjitro,https://github.com/tseemann/snippy/issues/266
MDU6SXNzdWU0MDkwMjU5MjM=,Fix error message,CLOSED,2019-02-11T23:19:52Z,2019-04-01T23:42:32Z,2019-04-01T23:42:32Z,"When running `snippy-core`, if feeding snippy a folder name that does not exist, the following error message is wrong: `ERROR: Sample 'sample_x' is not a folder, seems to be a file?`",schultzm,https://github.com/tseemann/snippy/issues/267
MDU6SXNzdWU0MDkxMDA1MDI=,REF allele even though no reads have REF,OPEN,2019-02-12T03:14:56Z,2020-08-07T13:42:57Z,,"Checking some samples in IGV, I noticed several genotypes where snippy-core called the REF allele, even though none of the aligned reads were REF.

Inspecting more closely, this happens because freebayes does not output the SNP (false negative), but the site has 10 or more reads, so does not get explicitly masked either.

See the script below to reproduce. In summary, run snippy/snippy-core on samples SRR3219271 and SRR3219831 from SRA, aligning against NC_016845.1 from NCBI nuccore. Then, check position 4,308,984. All 12 reads of SRR3219271 are for the alternate allele G, yet its allele in core.vcf is the reference C.

![image](https://user-images.githubusercontent.com/9089216/52609078-e5c96600-2e30-11e9-9342-378f1c442805.png)

In addition, here is a VCF of the differences from snippy-core, annotated with allele depths from bcftools mpileup. At most of these sites, one of the samples was called REF but had (almost) no REF reads. Note these are very closely related samples -- a joint mpileup shows about 4 SNPs between them, however snippy-core gives a SNP distance of 30.
```
##fileformat=VCFv4.2
##FILTER=<ID=PASS,Description=""All filters passed"">
##commandLine=""snippy-core --ref NC_016845.1.fasta SRR3219271 SRR3219831""
##FORMAT=<ID=GT,Number=1,Type=String,Description=""Genotype"">
##INFO=<ID=TYPE,Number=A,Type=String,Description=""Allele type: snp ins del"">
##contig=<ID=NC_016845.1,len=5333942>
##INFO=<ID=AC,Number=A,Type=Integer,Description=""Allele count in genotypes"">
##INFO=<ID=AN,Number=1,Type=Integer,Description=""Total number of alleles in called genotypes"">
##bcftools_viewVersion=1.9+htslib-1.9
##bcftools_viewCommand=view --min-ac 1:minor -Oz -o diffs.vcf.gz core.vcf; Date=Tue Feb 12 01:27:56 2019
##FORMAT=<ID=AD,Number=R,Type=Integer,Description=""Allelic depths"">
##bcftools_annotateVersion=1.9+htslib-1.9
##bcftools_annotateCommand=annotate -a repileup.vcf.gz -c FMT/AD diffs.vcf.gz; Date=Tue Feb 12 01:34:06 2019
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	SRR3219271	SRR3219831
NC_016845.1	1767726	.	A	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:73,0	1:1,85
NC_016845.1	1767727	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:73,0	1:1,85
NC_016845.1	2519417	.	C	T	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,99	0:94,0
NC_016845.1	2999873	.	C	T	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,9	0:0,8
NC_016845.1	3434675	.	C	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,10	1:0,12
NC_016845.1	3434676	.	T	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,10	1:0,12
NC_016845.1	3728326	.	A	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,13	0:0,9
NC_016845.1	3744194	.	C	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,12	0:0,9
NC_016845.1	3757675	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:1,7	1:0,7
NC_016845.1	3757810	.	G	T	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,8	1:0,7
NC_016845.1	3807064	.	G	T	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:63,3	0:57,1
NC_016845.1	3819590	.	G	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,8	1:0,19
NC_016845.1	3834511	.	G	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,6	1:0,6
NC_016845.1	3936967	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,7	1:0,8
NC_016845.1	4145095	.	G	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,14	0:0,10
NC_016845.1	4149311	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,7	0:0,6
NC_016845.1	4171825	.	A	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,6	1:0,8
NC_016845.1	4201982	.	C	T	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,8	1:0,9
NC_016845.1	4280327	.	C	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,9	1:0,8
NC_016845.1	4284222	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,7	0:0,7
NC_016845.1	4288672	.	C	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,6	1:0,10
NC_016845.1	4297333	.	A	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,18	0:1,13
NC_016845.1	4297498	.	G	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,16	1:0,14
NC_016845.1	4308984	.	C	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,10	1:0,10
NC_016845.1	4309935	.	G	C	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:0,9	1:0,15
NC_016845.1	4334377	.	C	T	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,15	0:0,8
NC_016845.1	4369099	.	A	G	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,93	0:98,0
NC_016845.1	4400154	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	1:0,6	0:0,7
NC_016845.1	4405624	.	G	A	.	PASS	TYPE=snp;AC=1;AN=2	GT:AD	0:1,7	1:0,11
NC_016845.1 4568811 . T C . PASS TYPE=snp;AC=1;AN=2 GT:AD 0:0,10 1:0,12
```

I created this vcf with the following script:
```
#!/bin/bash

set -ex

REF=NC_016845.1
SAMPLE1=SRR3219271
SAMPLE2=SRR3219831

efetch -db nuccore -format fasta -id $REF > $REF.fasta

function run_snippy {
    local sample=$1
    fastq-dump --origfmt -I --split-files --gzip $sample
    trim_galore --paired --gzip ""$sample""_*.fastq.gz
    snippy --outdir $sample --ref $REF.fasta --R1 ""$sample""_1_val_1.fq.gz --R2 ""$sample""_2_val_2.fq.gz
}

run_snippy ""$SAMPLE1""
run_snippy ""$SAMPLE2""

snippy-core --ref ""$REF.fasta"" ""$SAMPLE1"" ""$SAMPLE2""

# get allele counts at sites where $SAMPLE1 != $SAMPLE2
bcftools view --min-ac 1:minor core.vcf -Oz -o diffs.vcf.gz
bcftools query -f '%CHROM\t%POS\n' diffs.vcf.gz > diffs.positions
bcftools mpileup --fasta-ref $REF.fasta -R diffs.positions $SAMPLE1/snps.bam $SAMPLE2/snps.bam -a FORMAT/AD -Oz -o repileup.vcf.gz

# merge snippy genotypes with mpileup allele depths
tabix diffs.vcf.gz
tabix repileup.vcf.gz
bcftools annotate -a repileup.vcf.gz -c FMT/AD diffs.vcf.gz > diffs_with_ad.vcf
```

I'm using snippy=4.3.6 and freebayes=1.2.0.",jackkamm,https://github.com/tseemann/snippy/issues/268
MDU6SXNzdWU0MDk4Mjg3MzM=,snippy multiple bam files,OPEN,2019-02-13T14:22:37Z,2019-03-13T22:03:07Z,,"Hi,
Is snippy not supporting multiple bam files as input in snippy-multiple ???",davidvilanova,https://github.com/tseemann/snippy/issues/269
MDU6SXNzdWU0MTE1OTU1MjA=,Snippy always returning 0 SNPs and alignment file only containing ---,CLOSED,2019-02-18T18:12:42Z,2024-04-14T07:36:13Z,2019-07-17T22:42:07Z,"I am using snippy for the first that's why I am not sure it's really an issue or my failure to properly run the program. First I tried to align 48 fasta files containing contigs with the reference genome in fasta format using the following commands:
snippy-multi input.tab --ref Reference.fasta > runme.sh
sh ./runme.sh

It went on creating 48 folders correspond to the 48 samples and everything seemed fine until the end. It failed to run a command because the number of SNPs were zero. 
Then to test I ran the program with only one sample file using the command:
snippy --cpus 16 --outdir mysnps --ref Reference.fasta --se sample1.fasta

This completed without any error but when I  examined the newly created folder I observed that the issue still remains. It shows zero snps and aligment only contains dashes. 
Then I went on created a small Reference.fasta artificially and by adding artificial SNPs created a sample.fasta and repeated the above command. Same result. 

please help.",abdullah314,https://github.com/tseemann/snippy/issues/270
MDU6SXNzdWU0MTIwMzcyMTA=,samtools sort could not allocate memory for bam_mem,CLOSED,2019-02-19T17:21:47Z,2019-02-20T04:46:04Z,2019-02-19T23:10:32Z,"First time trying snippy for variant calling of my bacterial genome. I passed the following command:

`snippy --outdir mysnps --ref myref.fasta --pe1 R1.fq.gz --pe2 R2.fq.gz`

It seems I have all the required packages/tools but the mission stopped at mapping using the bwa mem, and said the samtools sort could not allocate memory for bam_mem. The command that has executed by the snippy is:

`bwa mem  -v 2 -M -R '@RG   ID:snps SM:snps'  -t 8 reference/ref.fa  /media/sf_Ubuntu/Snippy/Test/R1.fq.gz  /media/sf_Ubuntu/Snippy/Test/R2.fq.gz | samtools view -@ 8 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -O bam -o snps.bam -@ 8 -
`
The above followed by the following error message:

> [E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t
samtools sort: couldn't allocate memory for bam_mem 

It seems the reads didn't even get mapped to the ref genome. 

Please help.

Thanks!

Ye

",bearnomore,https://github.com/tseemann/snippy/issues/271
MDU6SXNzdWU0MTI0OTc0ODc=,ERROR: Could not find .aligned.fa/.vcf,CLOSED,2019-02-20T15:53:12Z,2019-02-20T16:09:45Z,2019-02-20T16:09:45Z,"I have created a folder called core where I am running snippy-core from

~/miniconda2/bin/snippy-core --ref reference.fa ../*

As I have around 200 samples I use ../* to run snippy-core on all the files from snippy output instead of entering them manually, I get the following error 

ERROR: Could not find .aligned.fa/.vcf in ../snippy-core 

I am using version 4.3.6

Thanks
Rebecca 
 ",RJBeng,https://github.com/tseemann/snippy/issues/272
MDU6SXNzdWU0MTQwMDM0NTY=,Set a tmp for snippy-core,CLOSED,2019-02-25T09:15:28Z,2019-04-01T23:38:24Z,2019-04-01T23:38:24Z,"Hi,

Can it possible to set a tmp directory for snippy-core
 like in snippy `--tmpdir F       Fast temporary storage eg. local SSD (default '/tmp')` ?

I run a snippy-core with 301 snippy folder and it's took more than my 8Go of /tmp space...

Thanks in advance.

",Nilad,https://github.com/tseemann/snippy/issues/273
MDU6SXNzdWU0MTkxMDIxNzk=,Different results in .aligned.fa and vcf with the same reference ,CLOSED,2019-03-09T18:36:56Z,2019-03-13T22:01:18Z,2019-03-10T22:41:19Z,"As I was playing with snippy, I came across something strange. 

I pass to snippy different files of reference;

  a) multifasta with different genomes of influenza among them is the  sequence of main interes for me (>gb:KU976802), and I have a vcf file with 24 variants 

 b) the file fasta with  single sequence of reference (>gb:KU976802), I have a vcf with the 4 variant 

 c) multifasta with the several reference of same gene but differen isolates, I don't have any consensus   .
I know that the results are not properly from the pipe of snippy if not from bwa, but will know why this result happens ?

",edgarom,https://github.com/tseemann/snippy/issues/274
MDU6SXNzdWU0MjMyNTU2MTc=,snippy-multi,CLOSED,2019-03-20T13:38:33Z,2024-03-10T22:07:50Z,2019-04-01T23:32:32Z,"Hi, this is my first time trying to run snippy and I get the following error when I run snippy-multi: 
Bad ID: 
Nay help would be great
Cheers
Maria
",Mpaljacar,https://github.com/tseemann/snippy/issues/275
MDU6SXNzdWU0MjM3ODE2OTc=,samtools improperly gets an extra cpu,CLOSED,2019-03-21T15:10:29Z,2020-03-09T02:41:15Z,2019-10-03T23:08:55Z,"I noticed that with `--cpus 2`, I have a samtools command in my log, e.g.,

```samtools sort -O bam -o snps.bam -@ 2 -```

Which might be improper.  I believe that `-@` indicates how many _extra_ cpus are granted.",lskatz,https://github.com/tseemann/snippy/issues/276
MDU6SXNzdWU0MjQzMjEyNjk=,Time::Seconds wasn't added to core until perl 5.18,CLOSED,2019-03-22T17:29:02Z,2019-04-01T23:32:47Z,2019-04-01T23:32:46Z,Suggest adding `use 5.18` to your perl script.  Otherwise you get an error that `pretty` is not exported by `Time::Seconds`.  ,lskatz,https://github.com/tseemann/snippy/issues/277
MDU6SXNzdWU0MjUwNzY3NzI=,snippy-core dies if no snps,OPEN,2019-03-25T19:27:19Z,2019-10-29T22:44:01Z,,"I had a run of 801 genomes, where if there were no SNPs in an individual genome, snippy-core would die.",lskatz,https://github.com/tseemann/snippy/issues/278
MDU6SXNzdWU0MjcwNTAwMTk=,snippy-multi can't read files ,CLOSED,2019-03-29T15:40:59Z,2024-05-09T15:20:35Z,2019-07-17T22:42:34Z,"I am new to snippy and am trying to run snippy-multi with the following command: 

snippy-multi input_tab_test.txt --ref JKS2530_q7_canu_1.7.1_test.contigs.fasta --cpus 16 > runme.sh

I get the following error: 

Reading: input_tab_test.txt
'RROR: [JKS2554] unreadable file 'assemblies/JKS2554_unicycler_v4.8.assembly.fasta

I am not sure where I am going wrong. See attached tab file. I checked the fasta for each of my assemblies and they all start with the appropriate "">"" and have no whitespace. 
[input_tab_test.txt](https://github.com/tseemann/snippy/files/3023364/input_tab_test.txt)

",sgl07007,https://github.com/tseemann/snippy/issues/279
MDU6SXNzdWU0Mjc5MTU0NTY=,"snippy-core ""No SNPs were detected""",CLOSED,2019-04-01T21:14:57Z,2019-04-01T23:22:07Z,2019-04-01T23:04:31Z,"I have been running `snippy-core` for months with no problems. However, with the new data set I started using today, I'm getting the following warning and error:

> Warning: No SNPs were detected so there is nothing to output.
> ERROR: Could not run: snp-sites -c -o core.aln core.full.aln

All 45 of my _snps.tab_ files have variants listed (between 200 and 20,000). I do get all of the `snippy-core` output files minus the output file _core.aln_ from `snp-sites`. Additionally, the _core.tab_ is empty and in _core.txt_ only about the first 1/4 of samples listed have counts >0 in the VARIANT column. I am totally at a loss as to what is going on here.

Snippy was installed using Bioconda: Snippy version 4.3.6 and snp-sites version 2.4.1. Below is my code and the entire output. Any help would be very much appreciated.

`snippy-core --ref GCF_003344465.1_ASM334446v1_genomic.fna --prefix core RS*_snippy`

> This is snippy-core 4.3.6
> Obtained from http://github.com/tseemann/snippy
> Enabling bundled tools.
> Found any2fasta - /panfs/roc/groups/1/johnsont/millere/.conda/envs/snippy/binaries/noarch/any2fasta
> Found samtools - /home/johnsont/millere/.conda/envs/snippy/bin/samtools
> Found minimap2 - /home/johnsont/millere/.conda/envs/snippy/bin/minimap2
> Found bedtools - /home/johnsont/millere/.conda/envs/snippy/bin/bedtools
> Found snp-sites - /home/johnsont/millere/.conda/envs/snippy/bin/snp-sites
> Saving reference FASTA: core.ref.fa
> This is any2fasta 0.4.2
> Opening 'GCF_003344465.1_ASM334446v1_genomic.fna'
> Detected FASTA format
> Read 63041 lines from 'GCF_003344465.1_ASM334446v1_genomic.fna'
> Wrote 6 sequences from FASTA file.
> Processed 1 files.
> Done.
> Loaded 6 sequences totalling 5042521 bp.
> Will mask 0 regions totalling 0 bp ~ 0.00%
> 0	RS775_S1_snippy	snp=514	del=30	ins=15	het=47	unaligned=103286
> 1	RS776_S2_snippy	snp=7709	del=61	ins=32	het=25	unaligned=4160628
> 2	RS777_S3_snippy	snp=490	del=29	ins=14	het=22	unaligned=109762
> 3	RS778_S4_snippy	snp=506	del=43	ins=5	het=16	unaligned=114017
> 4	RS779_S5_snippy	snp=542	del=45	ins=15	het=57	unaligned=92868
> 5	RS780_S6_snippy	snp=481	del=24	ins=5	het=18	unaligned=127453
> 6	RS781_S7_snippy	snp=463	del=18	ins=15	het=37	unaligned=122072
> 7	RS782_S8_snippy	snp=5110	del=30	ins=23	het=15	unaligned=4199463
> 8	RS783_S9_snippy	snp=9624	del=52	ins=38	het=77	unaligned=1142005
> 9	RS784_S10_snippy	snp=11605	del=100	ins=45	het=88	unaligned=1160033
> 10	RS785_S11_snippy	snp=13734	del=54	ins=67	het=91	unaligned=4112515
> 11	RS786_S12_snippy	snp=8188	del=40	ins=55	het=11	unaligned=4158363
> 12	RS787_S13_snippy	snp=489	del=42	ins=5	het=74	unaligned=110907
> 13	RS788_S14_snippy	snp=487	del=27	ins=14	het=37	unaligned=106314
> 14	RS789_S15_snippy	snp=484	del=25	ins=15	het=13	unaligned=122179
> 15	RS790_S16_snippy	snp=503	del=49	ins=5	het=60	unaligned=104724
> 16	RS791_S17_snippy	snp=517	del=25	ins=5	het=26	unaligned=109372
> 17	RS792_S18_snippy	snp=498	del=40	ins=5	het=23	unaligned=107839
> 18	RS793_S19_snippy	snp=526	del=25	ins=15	het=88	unaligned=107489
> 19	RS794_S20_snippy	snp=511	del=39	ins=5	het=28	unaligned=112726
> 20	RS795_S21_snippy	snp=486	del=25	ins=4	het=56	unaligned=107964
> 21	RS796_S22_snippy	snp=7203	del=33	ins=44	het=5511	unaligned=2398124
> 22	RS797_S23_snippy	snp=6437	del=17	ins=20	het=115	unaligned=4141658
> 23	RS798_S24_snippy	snp=494	del=25	ins=5	het=14	unaligned=114275
> 24	RS799_S25_snippy	snp=489	del=43	ins=5	het=5	unaligned=114279
> 25	RS800_S26_snippy	snp=550	del=45	ins=15	het=73	unaligned=99047
> 26	RS801_S27_snippy	snp=540	del=45	ins=15	het=22	unaligned=104577
> 27	RS802_S28_snippy	snp=526	del=30	ins=17	het=34	unaligned=139526
> 28	RS803_S29_snippy	snp=488	del=46	ins=15	het=33	unaligned=107619
> 29	RS804_S30_snippy	snp=543	del=41	ins=8	het=117	unaligned=127738
> 30	RS805_S31_snippy	snp=566	del=46	ins=16	het=157	unaligned=89592
> 31	RS806_S32_snippy	snp=505	del=24	ins=15	het=85	unaligned=96192
> 32	RS807_S33_snippy	snp=8505	del=44	ins=62	het=95	unaligned=4133264
> 33	RS808_S34_snippy	snp=14284	del=68	ins=59	het=71	unaligned=4089801
> 34	RS809_S35_snippy	snp=504	del=44	ins=4	het=48	unaligned=102777
> 35	RS810_S36_snippy	snp=465	del=39	ins=5	het=27	unaligned=121538
> 36	RS811_S37_snippy	snp=532	del=46	ins=6	het=25	unaligned=95703
> 37	RS812_S38_snippy	snp=483	del=25	ins=5	het=0	unaligned=140587
> 38	RS813_S39_snippy	snp=531	del=40	ins=7	het=22	unaligned=140048
> 39	RS814_S40_snippy	snp=434	del=23	ins=4	het=33	unaligned=170791
> 40	RS815_S41_snippy	snp=492	del=17	ins=6	het=23	unaligned=146678
> 41	RS816_S42_snippy	snp=30563	del=197	ins=161	het=67	unaligned=4006634
> 42	RS817_S43_snippy	snp=6751	del=23	ins=20	het=25	unaligned=4159698
> 43	RS818_S44_snippy	snp=8497	del=40	ins=48	het=26	unaligned=4153394
> 44	RS819_S45_snippy	snp=7078	del=39	ins=54	het=24	unaligned=4158072
> Opening: core.tab
> Opening: core.vcf
> Processing contig: NZ_CP030111.1
> Processing contig: NZ_CP030112.1
> Processing contig: NZ_CP030113.1
> Processing contig: NZ_CP030114.1
> Processing contig: NZ_CP030115.1
> Processing contig: NZ_CP030116.1
> Generating core.full.aln
> Creating TSV file: core.txt
> Running: snp-sites -c -o core.aln core.full.aln
> Warning: No SNPs were detected so there is nothing to output.
> ERROR: Could not run: snp-sites -c -o core.aln core.full.aln",eam12,https://github.com/tseemann/snippy/issues/280
MDU6SXNzdWU0Mjk1ODExNDU=,snippy fails at freebayes-parallel ,CLOSED,2019-04-05T04:46:00Z,2019-04-16T04:40:23Z,2019-04-16T04:16:13Z,"Hi Torsten,
Am trying to run snippy to target sites on th E.coli K12 reference. However, the pipeline keeps failing at the freebayes step with this error:
""""### freebayes-parallel reference/ref.txt 4 -p 2 -P 0.5 -q 13 -m 60 --min-repeat-entropy 1.0-t 'ecoli_amr.bed' -f reference/ref.fa snps.bam > snps.raw.vcf
could not parse --min-repeat-entropy""""
From first glance, I think it's because of a missing space at << --min-repeat-entropy 1.0-t>> but am not sure. Perhaps it is something you could help me with?
My command is: """"snippy --cpu 4 --targets ecoli_amr.bed --outdir snippy_AMR/28D10/ --ref Escherichia_coli_k12_MG1655.gbff --R1 fastq_files/28D10_R1.fastq.gz --R2 fastq_files/28D10_R2.fastq.gz"""" also tried ""snippy --cpu 4 --targets ecoli_amr.bed --outdir snippy_AMR/28D10/ --ref Escherichia_coli_k12_MG1655.gbff --ctgs 28D10_contigs.fna""
the reference is ""wget -O  Escherichia_coli_k12_MG1655.gbff.gz ftp://ftp.ncbi.nlm.nih.gov/genomes/all/GCA/000/005/845/GCA_000005845.2_ASM584v2/GCA_000005845.2_ASM584v2_genomic.gbff.gz""

Thanks,
Fredrick 
[ecoli_amr.bed.txt](https://github.com/tseemann/snippy/files/3046369/ecoli_amr.bed.txt)
[28D10_contigs.fna.txt](https://github.com/tseemann/snippy/files/3046370/28D10_contigs.fna.txt)







",fmobegi,https://github.com/tseemann/snippy/issues/281
MDU6SXNzdWU0MzMzMDMzNjU=,maximum number of contigs for snippy-multi,CLOSED,2019-04-15T14:09:00Z,2019-08-16T12:53:49Z,2019-07-17T22:40:32Z,"Hello,

I was wondering if perhaps there's a limit on the number of isolates for snippy-multi to generate core snps. The maximum I've been able to analyze at one is 6 contigs. Anything more than that and it says it can't generate core snps. Is 6 the limit?

Thank you",pneumowidow,https://github.com/tseemann/snippy/issues/282
MDU6SXNzdWU0MzQzNDcxOTU=,.aligned.fa result's file,OPEN,2019-04-17T15:28:50Z,2019-10-03T22:32:01Z,,"Hello, 
I've got a question concerning the .aligned.fa file. In the README, it's written that the aligned.fa file contain a ""version of the reference but with - at position with depth=0 and N for 0 < depth < --mincov **(does not have variants)** ""

When i took a quikly look in your code, I guess you are using the reference with SNPs applied which come from the .consensus.subs.fa file.

So if I understand well, the  .aligned.fa would contains a version of the reference with SNPs, and not the reference you give to snippy at the beggining.

Is that true ? ",madeleinevlt,https://github.com/tseemann/snippy/issues/283
MDU6SXNzdWU0Mzg2MjMwOTM=,SNP filtering in snippy-core,CLOSED,2019-04-30T06:36:56Z,2019-07-17T22:40:01Z,2019-07-17T22:40:01Z,"![AC dist default snippy](https://user-images.githubusercontent.com/50131630/56944163-57d84f80-6af0-11e9-9448-3bd9f4a668ec.png)
![AC dist no snippy](https://user-images.githubusercontent.com/50131630/56944164-59097c80-6af0-11e9-9e8f-d0652a8fb0df.png)
I wonder if there's any filtering of the SNPs (besides getting rid of all the indels and complex variants) when snippy-core generates core.vcf and core.full.aln? Shown above are the distributions of allele counts of SNPs after snippy-core and of allele counts of SNPs by unique positions (which is likely a lower estimate of unique # snps called in all the samples merged in snippy-core, due to the presence of multiallelic snps).
Thank you in advance!",ElainW,https://github.com/tseemann/snippy/issues/284
MDU6SXNzdWU0NDA0MjczNzk=,“n” character in *.tab generated by snippy-core,CLOSED,2019-05-05T10:13:00Z,2019-07-17T22:43:24Z,2019-07-17T22:43:24Z,"Hi, 
I have some questions when using snippy, could you please help me?
(1) Why there are ""n"" character in .tab generated by snippy-core?
A ""core site"" is a genomic position that is present in all the samples, what means ""present""? It  include [ATCGn], or others, such as ""N"","" -""? 
(2) About the filter process
I could got the following 4 *.vcf files, I'm not sure about the filter process for each of vcf:
 snps.raw.vcf snps.filt.vcf  snps.subs.vcf  snps.vcf
a) the raw.vcf is under the parameters (--mapqual --basequal...) ?
b) the filt.vcf was filtered by Freebayes with parameters : --mincov and --minfrac ?
c) .vcf should add the annotation for filt.vcf ?
d) what about the subs.vcf?
Thanks in advance!
",zhaoxvwahaha,https://github.com/tseemann/snippy/issues/285
MDU6SXNzdWU0NDI2NTU4OTc=,Not getting the complete files,CLOSED,2019-05-10T10:44:32Z,2019-07-17T22:39:08Z,2019-07-17T22:39:08Z,"When I run snippy , instead of the 16 files specified i get 9 files. I am using snippy version  4.3.6
",vappiah,https://github.com/tseemann/snippy/issues/286
MDU6SXNzdWU0NTI1Mjg4Mzc=,"what the ""."" character in core.snp.nway.tab means",CLOSED,2019-06-05T14:19:28Z,2019-06-10T10:22:54Z,2019-06-10T00:41:17Z,"Hi,

I have 2 questions about the tab file generated by snippy-core, anyone could help me, thanks in advance
(1) what's the ""."" character in core.snp.nway.tab?
(2) How many kinds of characters will be included in the *.tab file generated by snippy-core at most? Are the following 9 charaters right:    [ATCGNn.X-] ?

Best Wishes",zhaoxvwahaha,https://github.com/tseemann/snippy/issues/288
MDU6SXNzdWU0NTI4MDA0MzI=,The position outside of snps.raw.vcf,CLOSED,2019-06-06T02:23:54Z,2019-06-10T00:43:14Z,2019-06-10T00:43:14Z,"Hi,

The snps.raw.vcf only include some reference position, but I need to know the situation of positions which don't be included in the vcf file. So I'm not sure, these positions don't be reported in vcf file are high-quality but same with reference base or  don't pass the freebayes cutoff, or both of them? How can I get a complete vcf file which include all reference position?

Thanks in advance.",zhaoxvwahaha,https://github.com/tseemann/snippy/issues/289
MDU6SXNzdWU0NTQ5MjAwODg=,Memory use is ~2x expected,CLOSED,2019-06-11T21:51:30Z,2019-06-13T14:49:46Z,2019-06-13T08:14:44Z,"With snippy 4.3.3:
```
snippy --outdir 6710_6_17 --cpus 1 --ram 2 --cleanup --reference D39V.gb --pe1 6710_6#17_1.fastq.gz --pe2 6710_6#17_2.fastq.gz
```
This is a *S. pneumoniae* genome with ~1Gb of sequence in the reads. Although I have specified 2Gb of RAM in the command the max used was 4.1Gb.

I think this occurs when the following command is run
```
bwa mem  -Y -M -R '@RG\tID:6710_6_17\tSM:6710_6_17' -t 1 reference/ref.fa /lustre/scratch118/infgen/team81/jl11/pdoc/transmissibility/D39V_map/pf_lanes/6710_6#17_1.fastq.gz /lustre/scratch118/infgen/team81/jl11/pdoc/transmissibility/D39V_map/pf_lanes/6710_6#17_2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.1057. --threads 1 -m 2000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.1057. --threads 1 -m 2000M | samtools markdup -T /tmp/snippy.1057. -r -s - - > snps.bam 2>> snps.log
```

A relevant message from this phase:
```
[bam_sort_core] merging from 1 files and 1 in-memory blocks...
[E::hts_open_format] Failed to open file /tmp/snippy.1057..0000.bam
samtools sort: failed to create temporary file ""/tmp/snippy.1057..0000.bam"": File exists
```

I also tried setting `--tmpdir` to the cwd (which definitely has sufficient space), which did not fix this issue.

My guess is that as this uses pipes, the two sort commands are run concurrently as data is available, each taking up to `-m` memory. I tracked the memory use over the run and it starts to exceed the threshold when the `bwa mem` and first `samtools sort` are both running, then reaches double during the sort > fixmate > sort phase, after `bwa mem` has finished.
I think this is also leading to the above error/warning, as eventually two sort commands are running concurrently and trying to use the same tmp files.

A solution could be to halve the input value from `--ram` to give the `-m` for these commands in the pipe, and give each one separate `-T` arguments.",johnlees,https://github.com/tseemann/snippy/issues/290
MDU6SXNzdWU0NTQ5MjY5NzE=,Error in tempfile() using template <tmpdir>/parXXXXX.par,CLOSED,2019-06-11T22:13:58Z,2019-06-18T02:08:23Z,2019-06-18T02:08:23Z,"I'm trying to run snippy for a publication but I'm getting an error with `freebayes-parallel`

```bash
snippy --version
snippy 4.3.6
```

```bash

### /usr/local/devel/ANNOTATION/jespinoz/anaconda/envs/assembly_env/bin/snippy --force --cpus 4 --tmpdir jw270_output/6-JW-270-TN5_S181/tmp --reference /usr/local/scratch/METAGENOMICS/jespinoz/SCV/References/GCA_004123025.1_ASM412302v1/GCA_004123025.1_ASM412302v1_genomic.gbff --outdir jw270_output/6-JW-270-TN5_S181/intermediate/snippy_output --ctgs jw270_output/6-JW-270-TN5_S181/intermediate/spades_output/scaffolds.fasta

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.14 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.81 seconds elapse.
[bwa_index] Update BWT... 0.05 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.74 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 3.850 sec; CPU: 3.775 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:snippy_output\tSM:snippy_output' -t 4 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T jw270_output/6-JW-270-TN5_S181/tmp/snippy.48886. --threads 4 -m 2000M | samtools fixmate -m - - | samtools sort -l 0 -T jw270_output/6-JW-270-TN5_S181/tmp/snippy.48886. --threads 4 -m 2000M | samtools markdup -T jw270_output/6-JW-270-TN5_S181/tmp/snippy.48886. -r -s - - > snps.bam

READ 584685 WRITTEN 574764
EXCLUDED 4390 EXAMINED 580295
PAIRED 0 SINGLE 580295
DULPICATE PAIR 0 DUPLICATE SINGLE 9921
DUPLICATE TOTAL 9921

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 1041916 > reference/ref.txt


### freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf

Error in tempfile() using template jw270_output/6-JW-270-TN5_S181/tmp/parXXXXX.par: Parent directory (jw270_output/6-JW-270-TN5_S181/tmp/) does not exist at /usr/local/devel/ANNOTATION/jespinoz/anaconda/envs/assembly_env/bin/parallel line 5017.
```",jolespin,https://github.com/tseemann/snippy/issues/291
MDU6SXNzdWU0NTUxMzMyMTQ=,why many site are - in my aligned fa file while it's coverage > mincov,CLOSED,2019-06-12T10:25:58Z,2019-06-13T03:35:45Z,2019-06-13T03:35:45Z,"Hi, Dr. tseemann, 
I set the mincov of 10 (others setting are default ) and the file depth.gz shows many sites are more than 60 , could you tell me why these many sites still - in my aligned file ? 
thank you .
  ",wanyingsun,https://github.com/tseemann/snippy/issues/292
MDU6SXNzdWU0NTc3MDkxMDU=,How does this use samtools+freebayes combination?,CLOSED,2019-06-18T21:40:23Z,2019-06-18T21:59:58Z,2019-06-18T21:59:58Z,"First of all, great work on this!  I built this pipeline myself basically before finding this and it's an order of magnitude slower... Not sure how you made it so fast, but great that you did!

I was just wondering how you were using both samtools/freebayes in the variant calling portion?  When I run it it seems to be using both even though the README just says it uses freebayes.  Does it use the output of both to get a consensus?",Buuntu,https://github.com/tseemann/snippy/issues/293
MDU6SXNzdWU0NjAyMTk2NTU=,freebayes call params,CLOSED,2019-06-25T05:39:17Z,2019-06-26T08:26:26Z,2019-06-25T22:36:21Z,"Hi and thank you for this awesome piece of software!

I ran snippy w/ default params and got curious when it printed the call to freebayes:

```

freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
```

Why is the ploidy param set to `-p 2` when the main use case of snippy are haploid genomes? Maybe I am missing something very basic here.

Also, when I set `--minfrac` to e.g. 0.5, the call to freebayes still says `-F 0.05` -- does that mean snippy filters the SNVs after they have been called w/ 0.05?

Thank you very much,
Adrian",phiweger,https://github.com/tseemann/snippy/issues/294
MDU6SXNzdWU0NjA1MjAwMjY=,Samtools sort clobbreing files,CLOSED,2019-06-25T16:20:18Z,2019-06-25T22:33:29Z,2019-06-25T19:52:40Z,"Hi Torsten

Runninng `snippy 4.3.8`, I noticed that the `snps.log` file included a line that looks like:

```sh
samtools view -h -O SAM /path/to/in.bam \
| samclip --max 10 --ref reference/ref.fa.fai \
| samtools sort -n -l 0 -T $TMPDIR/snippy.385970. --threads 6 -m 1333M \
| samtools fixmate -m - - \
| samtools sort -l 0 -T $TMPDIR/snippy.385970. --threads 6 -m 1333M \
| samtools markdup -T $TMPDIR/snippy.385970. -r -s - - > snps.bam
```

Both invocations of `samtools sort` use the same `-T` temporary file prefix. They are being run in parallel, so I think that they both try to read and write to the same locations. In my stderr, I get lines like:

```
[samclip] Processed 31600000 records...
[samclip] Total SAM records 31620220, removed 850589, allowed 261193, passed 30769631
[samclip] Header contained 4 lines
[samclip] Done.
[bam_sort_core] merging from 6 files and 6 in-memory blocks...
[E::hts_open_format] Failed to open file /lb/scratch/jobs/8039413/snippy.385970..0002.bam
[E::hts_open_format] Failed to open file /lb/scratch/jobs/8039413/snippy.385970..0001.bam
[E::hts_open_format] Failed to open file /lb/scratch/jobs/8039413/snippy.385970..0000.bam
samtools sort: failed to create temporary file ""/lb/scratch/jobs/8039413/snippy.385970..0000.bam"": File exists
samtools sort: failed to create temporary file ""/lb/scratch/jobs/8039413/snippy.385970..0001.bam"": File exists
samtools sort: failed to create temporary file ""/lb/scratch/jobs/8039413/snippy.385970..0002.bam"": File exists
[E::hts_open_format] Failed to open file /lb/scratch/jobs/8039413/snippy.385970..0005.bam
[E::hts_open_format] Failed to open file /lb/scratch/jobs/8039413/snippy.385970..0003.bam
samtools sort: failed to create temporary file ""/lb/scratch/jobs/8039413/snippy.385970..0003.bam"": File exists
[E::hts_open_format] Failed to open file /lb/scratch/jobs/8039413/snippy.385970..0004.bam
samtools sort: failed to create temporary file ""/lb/scratch/jobs/8039413/snippy.385970..0004.bam"": File exists
samtools sort: failed to create temporary file ""/lb/scratch/jobs/8039413/snippy.385970..0005.bam"": File exists
[E::bgzf_flush] File write failed (wrong size)
samtools fixmate: Couldn't write to output file: Broken pipe
[E::bgzf_close] File write failed
[bam_mating] error while closing output file
```

Which looks to me like the `samtools sort` processes are clobbering each others files. 

If snippy gave slightly different temp file prefixes to each process, the files wouldn't be overwritten.

Please let me know if I'm just doing something dumb with snippy.",robsyme,https://github.com/tseemann/snippy/issues/295
MDU6SXNzdWU0NjQxNzU3NDc=,SNPs from metagenomics data,CLOSED,2019-07-04T09:54:33Z,2019-07-09T09:57:12Z,2019-07-09T09:57:12Z,"Hi, 
firstly, thanks for introducing such great tool for identifying snps in isolates.

I am trying to use the metagenomes-assembled genome (>300 coverage) to map back to the original reads, but the output has >2000 snps, and most of them with ref occurrence =0 , and alternative nucleotide >300, I am thinking that the error correcting steps while assembly actually correct the reads, and produce a bin with ""snps"", do you think if there is any other way to detect snps in metagenome assembled genomes?

![snippy](https://user-images.githubusercontent.com/47613707/60657838-1b392380-9ea6-11e9-88d2-bda03df5b0a6.PNG)


Thanks,
Sze",HweeSze,https://github.com/tseemann/snippy/issues/296
MDU6SXNzdWU0NjQyMjkyMjc=,Variant's visualization,OPEN,2019-07-04T12:02:01Z,2019-07-10T16:06:03Z,,"Hi,

I am using Snippy for studying the variants between two or more isolates. When I check the variants that appear in the vcf file from Snippy in IGV, I do not see those variants in the BAM files. I have realized that the correspondence is better when I compare a greater number of isolates. Could anybody help me?

Thank you very much!!!


",iremug,https://github.com/tseemann/snippy/issues/297
MDU6SXNzdWU0NjUwMTA4NTM=,Is it possible to provide more than one forward and one reverse read files for each sample?,CLOSED,2019-07-08T00:35:54Z,2019-07-09T09:52:34Z,2019-07-09T09:52:24Z,"Hi @tseemann,

In the documentation for `snippy-multi` you provide an example of multiple read files for the same sample (Isolate1, Isolate1b, Isolate1c in this case):
```
# input.tab = ID R1 [R2]
Isolate1	/path/to/R1.fq.gz	/path/to/R2.fq.gz
Isolate1b	/path/to/R1.fastq.gz	/path/to/R2.fastq.gz
Isolate1c	/path/to/R1.fa		/path/to/R2.fa
```
However, running it this way, they will appear in the VCF as separate ""samples"". 
Is there a way to consolidate all the reads (without concatenating the files)?
Like the following:
```
# input.tab = ID R1 [R2]
Isolate1	/path/to/R1.fq.gz,/path/to/R1.fastq.gz,/path/to/R1.fa	/path/to/R2.fq.gz,/path/to/R2.fastq.gz,/path/to/R2.fa
```

If it's not possible or recommended, how would you suggest to make a ""consensus"" VCF column from the 3 replicates?

Thanks, Ido",IdoBar,https://github.com/tseemann/snippy/issues/298
MDU6SXNzdWU0NjYyOTUwMDM=,"WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.",CLOSED,2019-07-10T12:59:10Z,2019-07-22T22:08:38Z,2019-07-22T15:55:27Z,"Hi, I am using snippy 4.4 and a newly downloaded reference genome in gbk and/or fasta (cds from genomic). I have installed snippy using conda. 
my command looks like this:
snippy --cpus 8 --outdir ./snippy2/contigs/GB1_11 --ref ./c.jejuni_NCTC11168.gbk--ctgs . /sorted2/GB1_11_contigs_sorted.fa --mincov 1

the only warning I get from the run is the following 
 ### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
and this results in an empty .csv file

I am using Python 2.7.8. 

can you help me in understanding what I am doing wrong? I attach the snps.log and the csv. 
can i use the other files to run ""snippy-core""?

Thanks 
[snps.log](https://github.com/tseemann/snippy/files/3377545/snps.log)

",nadiaandreani,https://github.com/tseemann/snippy/issues/299
MDU6SXNzdWU0Njc4NDU0MTg=,Update instruction reverts to older version of Snippy,CLOSED,2019-07-14T14:21:33Z,2019-08-04T09:44:25Z,2019-07-17T23:49:43Z,"I had Snippy v 4.6.11 installed and used conda update -n base -c defaults conda to attempt update to 4.7.5.

Although the screen advice was ""The following packages will be UPDATED: conda 4.6.11-py37_0 --> 4.7.5-py37_0"", after completion of the update, the Snippy version is 4.3.5.

As per ""Conda installation"" issue #261, i tried using
conda create -n snippy -c conda-forge -c bioconda snippy

But the Snippy version is still 4.3.5 and 

""conda update snippy"" returns

PackageNotInstalledError: Package is not installed in prefix.
  prefix: /home/sharb/anaconda3
  package name: snippy

If I try conda install Snippy=4.7.5, will this create 'environment' or duplication issues?",sharbie88,https://github.com/tseemann/snippy/issues/300
MDU6SXNzdWU0NjkwNjUyNTk=,How do,CLOSED,2019-07-17T08:47:18Z,2019-07-17T21:55:49Z,2019-07-17T21:55:49Z,"Hello，
I want to use the software in my paper.  Did the paper about this software publish?

Thanks",Tiredbird,https://github.com/tseemann/snippy/issues/301
MDU6SXNzdWU0Njk1MjkzNDk=,problem of bwa version(Version: 0.7.8-r455),CLOSED,2019-07-18T01:39:00Z,2019-07-19T01:50:48Z,2019-07-19T01:50:48Z,"My bwa was installed by conda, Version: 0.7.8-r455, and there do not have the  options ""**-Y**"" in bwa's usage. However, ""**-Y**"" was used in snippy 4.3.8 :
$bwaopt .= qq{  **-Y** -M -R '\@RG\\tID:$rgid\\tSM:$rgid'};

so, bwa's version maybe required in: snippy --check.

Usage: bwa mem [options] <idxbase> <in1.fq> [in2.fq]
Algorithm options:
       -t INT        number of threads [1]
       -k INT        minimum seed length [19]
       -w INT        band width for banded alignment [100]
       -d INT        off-diagonal X-dropoff [100]
       -r FLOAT      look for internal seeds inside a seed longer than {-k} * FLOAT [1.5]
       -c INT        skip seeds with more than INT occurrences [10000]
       -D FLOAT      drop chains shorter than FLOAT fraction of the longest overlapping chain [0.50]
       -m INT        perform at most INT rounds of mate rescues for each read [100]
       -S            skip mate rescue
       -P            skip pairing; mate rescue performed unless -S also in use
       -e            discard full-length exact matches
       -A INT        score for a sequence match, which scales [-TdBOELU] unless overridden [1]
       -B INT        penalty for a mismatch [4]
       -O INT[,INT]  gap open penalties for deletions and insertions [6,6]
       -E INT[,INT]  gap extension penalty; a gap of size k cost '{-O} + {-E}*k' [1,1]
       -L INT[,INT]  penalty for 5'- and 3'-end clipping [5,5]
       -U INT        penalty for an unpaired read pair [17]
Input/output options:
       -p            first query file consists of interleaved paired-end sequences
       -R STR        read group header line such as '@RG\tID:foo\tSM:bar' [null]
       -v INT        verbose level: 1=error, 2=warning, 3=message, 4+=debugging [3]
       -T INT        minimum score to output [30]
       -a            output all alignments for SE or unpaired PE
       -C            append FASTA/FASTQ comment to SAM output
       -M            mark shorter split hits as secondary
       -I FLOAT[,FLOAT[,INT[,INT]]]
                     specify the mean, standard deviation (10% of the mean if absent), max
                     (4 sigma from the mean if absent) and min of the insert size distribution.
                     FR orientation only. [inferred]

",flyant2,https://github.com/tseemann/snippy/issues/302
MDU6SXNzdWU0Njk2MzMyNTg=,problem with snippy-core ,CLOSED,2019-07-18T08:21:25Z,2019-07-19T01:57:44Z,2019-07-19T01:57:19Z,"**Q1: about help document.**
snippy-core (4.4.0) must provide  '--ref', and it is not consistent with the help:
--ref=s         Reference in FASTA or GENBANK (default '').

The help document should be update.
**Q2:  No annotation of in snippy-core(4.4.0) output, but snippy-core(4.0-dev2) .** 
**$ head coreSNP.ab.run4.tab (snippy-core(4.4.0))**
CHR     POS     REF     snps.AB_CP018664.vs.49239       snps.AB_CP018664.vs.49242       snps.AB_CP018664.vs.49307
NZ_CP018664     179     T       A       A       A
NZ_CP018664     264     T       C       C       C
NZ_CP018664     276     C       T       T       T
NZ_CP018664     279     A       C       C       C

**$ head coreSNP.ab.run4.tab (snippy-core(4.0-dev2))**
### CHR     POS     Reference       snps.AB_CP018664.vs.49239       snps.AB_CP018664.vs.49242       snps.AB_CP018664.vs.49307       LOCUS_TAG       GENE    PRODUCT EFFECT
NZ_CP018664     179     T       A       A       A       AUO97_RS00005           alpha/beta fold hydrolase       missense_variant c.209T>A p.Ile70Asn
NZ_CP018664     264     T       C       C       C       AUO97_RS00005           alpha/beta fold hydrolase       synonymous_variant c.294T>C p.Phe98Phe
NZ_CP018664     276     C       T       T       T       AUO97_RS00005           alpha/beta fold hydrolase       synonymous_variant c.306_309delCCTAinsTCTC p.104
NZ_CP018664     279     A       C       C       C       AUO97_RS00005           alpha/beta fold hydrolase       synonymous_variant c.306_309delCCTAinsTCTC p.104
NZ_CP018664     285     C       T       T       T       AUO97_RS00005           alpha/beta fold hydrolase       synonymous_variant c.315C>T p.Arg105Arg
NZ_CP018664     303     T       C       C       C       AUO97_RS00005           alpha/beta fold hydrolase       synonymous_variant c.333T>C p.Gly111Gly
NZ_CP018664     309     G       A       A       A       AUO97_RS00005           alpha/beta fold hydrolase       synonymous_variant c.339G>A p.Glu113Glu





",flyant2,https://github.com/tseemann/snippy/issues/303
MDU6SXNzdWU0Njk2ODU0MzA=,problem with Snippy,CLOSED,2019-07-18T10:12:46Z,2023-06-19T13:23:37Z,2019-08-24T23:14:27Z,,buihoangphuc412,https://github.com/tseemann/snippy/issues/304
MDU6SXNzdWU0NzI3MDAyNjE=,typo in first example usage line in snippy 4.4.1,CLOSED,2019-07-25T07:05:48Z,2019-08-06T05:24:59Z,2019-08-06T05:24:59Z,"USAGE
  snippy [options] --outdir <dir> --ref <ref> --R1 <R1.fq.gz> --R**1** <R2.fq.gz>

second read input ==> --R2",Koen-vdl,https://github.com/tseemann/snippy/issues/305
MDU6SXNzdWU0NzQ1OTI2NDk=,more SNPs with higher mincov,CLOSED,2019-07-30T13:41:49Z,2019-07-30T22:50:32Z,2019-07-30T22:50:32Z,"Hello, 

I tested different mincoverages (from 1 to 9) for two samples. Bizarrely, I detected more SNPs with higher coverages for the same input data and settings except for --mincov parameter. Is there an explaination for this? Because I would expect less SNPs with higher coverages, but I see a higher number of SNPs at mincoverage of 3 and 4 than with mincoverage 1. Here is what I got: 

  | Mincov 1 | Mincov 2 | Mincov 3 | Mincov 4 | Mincov 5 | Mincov 7 | Mincov 9
-- | -- | -- | -- | -- | -- | -- | --
sample1 | 159 | 177 | 179 | 177 | 148 | 68 | 17
sample2 | 159 | 183 | 190 | 190 | 163 | 78 | 26

Thank you for your explanaition!",Jgruetzke,https://github.com/tseemann/snippy/issues/306
MDU6SXNzdWU0NzY0MTcyMzM=,snippy no output - Identified 0 variants,CLOSED,2019-08-03T05:16:58Z,2019-08-04T06:33:25Z,2019-08-04T06:33:25Z,"Hi,
I am trying to use snippy in an Ubuntu 14.04 LTS OS. The command I have used is:
./snippy --cpus 4 --ram 3 --ref /home/icar/retting_bac_raw_seq/prokka_annot/B.safensis_FO-36b/B.safensis_FO-36b.gbk --outdir /home/icar/retting_bac_raw_seq/PJRB1-snps --R1 /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R1.fastq.gz --R2 /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R2.fastq.gz

The snp.log file and run log details are:

icar@icar-crijaf:~/Programs/snippy-master/bin$ ./snippy --cpus 4 --ram 3 --ref /home/icar/retting_bac_raw_seq/prokka_annot/B.safensis_FO-36b/B.safensis_FO-36b.gbk --outdir /home/icar/retting_bac_raw_seq/PJRB1-snps --R1 /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R1.fastq.gz --R2 /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R2.fastq.gz
[10:23:18] This is snippy 4.4.1
[10:23:18] Written by Torsten Seemann
[10:23:18] Obtained from https://github.com/tseemann/snippy
[10:23:18] Detected operating system: linux
[10:23:18] Enabling bundled linux tools.
[10:23:18] Found bwa - /usr/bin/bwa
[10:23:18] Found bcftools - /home/icar/Programs/snippy-master/binaries/linux/bcftools
[10:23:18] Found samtools - /usr/local/bin/samtools
[10:23:18] Found java - /usr/bin/java
[10:23:18] Found snpEff - /home/icar/Programs/snippy-master/binaries/noarch/snpEff
[10:23:18] Found samclip - /home/icar/Programs/snippy-master/binaries/noarch/samclip
[10:23:18] Found seqtk - /usr/local/bin/seqtk
[10:23:18] Found parallel - /usr/bin/parallel
[10:23:18] Found freebayes - /usr/local/bin/freebayes
[10:23:18] Found freebayes-parallel - /home/icar/Programs/snippy-master/binaries/noarch/freebayes-parallel
[10:23:18] Found fasta_generate_regions.py - /home/icar/Programs/snippy-master/binaries/noarch/fasta_generate_regions.py
[10:23:18] Found vcfstreamsort - /home/icar/Programs/snippy-master/binaries/linux/vcfstreamsort
[10:23:18] Found vcfuniq - /home/icar/Programs/snippy-master/binaries/linux/vcfuniq
[10:23:18] Found vcffirstheader - /home/icar/Programs/snippy-master/binaries/noarch/vcffirstheader
[10:23:18] Found gzip - /bin/gzip
[10:23:18] Found vt - /usr/bin/vt
[10:23:18] Found snippy-vcf_to_tab - /home/icar/Programs/snippy-master/bin/snippy-vcf_to_tab
[10:23:18] Found snippy-vcf_report - /home/icar/Programs/snippy-master/bin/snippy-vcf_report
[10:23:18] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[10:23:18] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[10:23:18] Checking version: freebayes --version is >= 1.1 - ok, have 1.3
[10:23:18] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[10:23:19] Checking version: bwa is >= 7.12 - ok, have 7.5
[10:23:19] Using reference: /home/icar/retting_bac_raw_seq/prokka_annot/B.safensis_FO-36b/B.safensis_FO-36b.gbk
[10:23:19] Treating reference as 'genbank' format.
[10:23:19] Will use 4 CPU cores.
[10:23:19] Using read file: /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R1.fastq.gz
[10:23:19] Using read file: /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R2.fastq.gz
[10:23:19] Creating folder: /home/icar/retting_bac_raw_seq/PJRB1-snps
[10:23:19] Changing working directory: /home/icar/retting_bac_raw_seq/PJRB1-snps
[10:23:19] Creating reference folder: reference
[10:23:19] Extracting FASTA and GFF from reference.
[10:23:21] Wrote 1 sequences to ref.fa
[10:23:21] Wrote 3883 features to ref.gff
[10:23:21] Creating reference/snpeff.config
[10:23:21] Freebayes will process 7 chunks of 547069 bp, 4 chunks at a time.
[10:23:21] Using BAM RG (Read Group) ID: PJRB1-snps
[10:23:21] Running: samtools faidx reference/ref.fa 2>> snps.log
[10:23:21] Running: bwa index reference/ref.fa 2>> snps.log
[10:23:23] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[10:23:23] Running: ln -sf reference/ref.fa . 2>> snps.log
[10:23:23] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[10:23:23] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[10:23:23] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[10:23:29] Running: bwa mem  -Y -M -R '@RG\tID:PJRB1-snps\tSM:PJRB1-snps' -t 4 reference/ref.fa /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R1.fastq.gz /home/icar/retting_bac_raw_seq/retting_bac_raw_seq/B3_R2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 4 -m 375M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp --threads 4 -m 375M | samtools markdup -T /tmp -r -s - - > snps.bam 2>> snps.log
mem: invalid option -- 'Y'
[samclip] samclip 0.2 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[samclip] Total SAM records 0, removed 0, allowed 0, passed 0
[samclip] Header contained 0 lines
[samclip] Done.
[10:23:30] Running: samtools index snps.bam 2>> snps.log
[10:23:30] Running: fasta_generate_regions.py reference/ref.fa.fai 547069 > reference/ref.txt 2>> snps.log
[10:23:30] Running: freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[10:23:30] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [m] no fail on masked reference inconsistency       false
         [n] no fail on reference inconsistency              false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa


stats: biallelic
          no. left trimmed                      : 0
          no. right trimmed                     : 0
          no. left and right trimmed            : 0
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. biallelic normalized           : 0

       multiallelic
          no. left trimmed                      : 0
          no. right trimmed                     : 0
          no. left and right trimmed            : 0
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. multiallelic normalized        : 0

       total no. variants normalized            : 0
       total no. variants observed              : 0
       total no. reference observed             : 0

Time elapsed: 0.00s

[10:23:30] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[10:23:32] Running: /home/icar/Programs/snippy-master/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab 2>> snps.log
[10:23:35] Running: /home/icar/Programs/snippy-master/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf 2>> snps.log
[10:23:35] Running: bcftools convert -Oz -o snps.vcf.gz snps.vcf 2>> snps.log
[10:23:36] Running: bcftools index -f snps.vcf.gz 2>> snps.log
[10:23:36] Running: bcftools consensus -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz 2>> snps.log
[10:23:36] Running: bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf 2>> snps.log
[10:23:36] Running: bcftools index -f snps.subs.vcf.gz 2>> snps.log
[10:23:36] Running: bcftools consensus -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz 2>> snps.log
[10:23:36] Running: rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi 2>> snps.log
[10:23:36] Generating reference aligned/masked FASTA relative to reference: snps.aligned.fa
[10:23:36] Marked 0 heterozygous sites with 'n'
[10:23:36] Creating extra output files: BED GFF CSV TXT HTML
[10:23:36] Identified 0 variants.
[10:23:36] Result folder: /home/icar/retting_bac_raw_seq/PJRB1-snps
[10:23:36] Result files:
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.aligned.fa
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.bam
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.bam.bai
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.bed
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.consensus.fa
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.consensus.subs.fa
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.csv
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.filt.vcf
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.gff
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.html
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.log
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.raw.vcf
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.subs.vcf
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.tab
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.txt
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.vcf
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.vcf.gz
[10:23:36] * /home/icar/retting_bac_raw_seq/PJRB1-snps/snps.vcf.gz.csi
[10:23:36] Walltime used: 18 seconds
[10:23:36] Questionable SNP? Try the --report option to see the alignments.
[10:23:36] Done.


Dependency check, Java version, and RAM details are below:

icar@icar-crijaf:~/Programs/snippy-master/bin$ ./snippy --check
[10:25:38] This is snippy 4.4.1
[10:25:38] Written by Torsten Seemann
[10:25:38] Obtained from https://github.com/tseemann/snippy
[10:25:38] Detected operating system: linux
[10:25:38] Enabling bundled linux tools.
[10:25:38] Found bwa - /usr/bin/bwa
[10:25:38] Found bcftools - /home/icar/Programs/snippy-master/binaries/linux/bcftools
[10:25:38] Found samtools - /usr/local/bin/samtools
[10:25:38] Found java - /usr/bin/java
[10:25:38] Found snpEff - /home/icar/Programs/snippy-master/binaries/noarch/snpEff
[10:25:38] Found samclip - /home/icar/Programs/snippy-master/binaries/noarch/samclip
[10:25:38] Found seqtk - /usr/local/bin/seqtk
[10:25:38] Found parallel - /usr/bin/parallel
[10:25:38] Found freebayes - /usr/local/bin/freebayes
[10:25:38] Found freebayes-parallel - /home/icar/Programs/snippy-master/binaries/noarch/freebayes-parallel
[10:25:38] Found fasta_generate_regions.py - /home/icar/Programs/snippy-master/binaries/noarch/fasta_generate_regions.py
[10:25:38] Found vcfstreamsort - /home/icar/Programs/snippy-master/binaries/linux/vcfstreamsort
[10:25:38] Found vcfuniq - /home/icar/Programs/snippy-master/binaries/linux/vcfuniq
[10:25:38] Found vcffirstheader - /home/icar/Programs/snippy-master/binaries/noarch/vcffirstheader
[10:25:38] Found gzip - /bin/gzip
[10:25:38] Found vt - /usr/bin/vt
[10:25:38] Found snippy-vcf_to_tab - /home/icar/Programs/snippy-master/bin/snippy-vcf_to_tab
[10:25:38] Found snippy-vcf_report - /home/icar/Programs/snippy-master/bin/snippy-vcf_report
[10:25:38] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[10:25:38] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[10:25:38] Checking version: freebayes --version is >= 1.1 - ok, have 1.3
[10:25:38] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[10:25:38] Checking version: bwa is >= 7.12 - ok, have 7.5
[10:25:38] Dependences look good!

Java version:

icar@icar-crijaf:~/Programs/snippy-master/bin$ java -version
java version ""1.8.0_201""
Java(TM) SE Runtime Environment (build 1.8.0_201-b09)
Java HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)

RAM:
icar@icar-crijaf:~$ free -h
             total       used       free     shared    buffers     cached
Mem:           62G        26G        36G        64M       485M        23G
-/+ buffers/cache:       2.4G        60G
Swap:          63G         0B        63G

PLEASE HELP ME TO SORT THE PROBLEM ASAP. 
-Dip",dipsaha,https://github.com/tseemann/snippy/issues/307
MDU6SXNzdWU0NzY3NTk0OTQ=,no VCF header and syntax error near unexpected token `if',CLOSED,2019-08-05T09:43:07Z,2019-08-08T03:54:22Z,2019-08-08T03:54:22Z,"**> Hello Torsten,
> I have run snippy and then I got errors. I checked the snps.log and the file shows below:**

echo snippy 4.4.0
### cd /home/ubuntu/Anh

### /home/ubuntu/miniconda3/bin/snippy --outdir SNP10 --ref H37Rv/GCF_000195955.2_ASM19595v2/GCF_000195955.2_ASM19595v2_genomic.gbff -R1 Sequences/WTCHG_689876_70045076_1.fastq.gz -R2 Sequences/WTCHG_689876_70045076_2.fastq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.05 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 3.01 seconds elapse.
[bwa_index] Update BWT... 0.05 sec
[bwa_index] Pack forward-only FASTA... 0.05 sec
[bwa_index] Construct SA from BWT and Occ... 0.66 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 4.053 sec; CPU: 3.822 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz

### echo snippy 4.4.0
### cd /home/ubuntu/Anh

### /home/ubuntu/miniconda3/bin/snippy --outdir SNP10 -force --ref H37Rv/GCF_000195955.2_ASM19595v2/GCF_000195955.2_ASM19595v2_genomic.fna -R1 Sequences/WTCHG_689876_70045076_1.fastq.gz -R2 Sequences/WTCHG_689876_70045076_2.fastq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.07 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.91 seconds elapse.
[bwa_index] Update BWT... 0.04 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.72 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 5.341 sec; CPU: 3.766 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:SNP10\tSM:SNP10' -t 8 reference/ref.fa /home/ubuntu/Anh/Sequences/WTCHG_689876_70045076_1.fastq.gz /home/ubuntu/Anh/Sequences/WTCHG_689876_70045076_2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 8 -m 500M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp --threads 8 -m 500M | samtools markdup -T /tmp -r -s - - > snps.bam

READ 1531521 WRITTEN 1470487
EXCLUDED 6621 EXAMINED 1524900
PAIRED 1491758 SINGLE 33142
DULPICATE PAIR 53488 DUPLICATE SINGLE 7546
DUPLICATE TOTAL 61034

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 299008 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf

import: delegate library support not built-in `' (X11) @ error/import.c/ImportImageCommand/1297.
error: no VCF header
/home/ubuntu/miniconda3/bin/vcffirstheader: line 7: syntax error near unexpected token `if'
/home/ubuntu/miniconda3/bin/vcffirstheader: line 7: `    if line.startswith('##'):'
.

> Then I check the vcffirstheader file:

        #!/usr/bin/env python

import sys

header=True
for line in sys.stdin:
    if line.startswith('##'):
        if header:
           print line.strip()
        continue
    elif line.startswith('#'):
        if header:
           print line.strip()
           header=False
        continue
    print line.strip()

> `Could you help me, pl? What should I do now?`
",maingoclanmaingoclan,https://github.com/tseemann/snippy/issues/308
MDU6SXNzdWU0ODA0NjI4NDE=,snippy-core,CLOSED,2019-08-14T03:26:18Z,2019-08-14T03:53:54Z,2019-08-14T03:53:23Z,"Hello Torsten,
I have used snippy-multi or snippy-core to find out the differences between isolates. However, when I check the core.tab and core.vcf file, there is only snp TYPE in INFO column, there is no other type of substitutions (insertion, deletions).
Can snippy-core do this? If yes, what can I add in the command line to get it?
Thank you.
Anh",maingoclanmaingoclan,https://github.com/tseemann/snippy/issues/310
MDU6SXNzdWU0ODQyMjU4MTY=,Freebayes --pooled-continuous option?,CLOSED,2019-08-22T21:28:05Z,2019-11-27T04:34:52Z,2019-08-24T23:14:07Z,"Is there an option to run freebayes with the `--pooled-continuous` option, and if not, would it be doable/easy to add in a newer version?",Buuntu,https://github.com/tseemann/snippy/issues/311
MDU6SXNzdWU0ODgzMzU3OTQ=,Bed targets file not open,CLOSED,2019-09-02T23:21:05Z,2019-10-03T22:30:59Z,2019-10-03T22:30:59Z,"Hello, 

I am trying to run Snippy restricting my analysis only to one contig in my reference genome. When I use the --targets flag and the bed file (tab file) I made my log file looks like this: 

```
### /usr/local/bin/snippy --outdir JKH2554_snippy_SUHP_2x_contig_2 --ref JKS2530_SUHP_2X.gbk --targets contig_2.bed --R1 J
KS2554/JKS2554_TruSeq_output_R1_concat_paired.fastq --R2 JKS2554/JKS2554_TruSeq_output_R2_concat_paired.fastq --report --u
nmapped

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.07 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 3.44 seconds elapse.
[bwa_index] Update BWT... 0.06 sec
[bwa_index] Pack forward-only FASTA... 0.05 sec
[bwa_index] Construct SA from BWT and Occ... 1.02 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 5.142 sec; CPU: 4.643 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurat
e.

### bwa mem  -Y -M -R '@RG\tID:JKH2554_snippy_SUHP_2x_contig_2\tSM:JKH2554_snippy_SUHP_2x_contig_2' -t 8 reference/ref.fa 
/home/sgoldstein/Documents/Paper_2/JKS2554/JKS2554_TruSeq_output_R1_concat_paired.fastq /home/sgoldstein/Documents/Paper_2
/JKS2554/JKS2554_TruSeq_output_R2_concat_paired.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 
0 -T /tmp/snippy.22886. --threads 8 -m 1000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.22886. --thread
s 8 -m 1000M | samtools markdup -T /tmp/snippy.22886. -r -s - - > snps.bam

READ 1618797 WRITTEN 1615445 
EXCLUDED 22434 EXAMINED 1596363
PAIRED 1588708 SINGLE 7655
DULPICATE PAIR 1728 DUPLICATE SINGLE 1624
DUPLICATE TOTAL 3352

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 457471 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverag
e 10 -F 0.05 -t 'contig_2.bed' -f reference/ref.fa snps.bam > snps.raw.vcf

bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open
bed targets file is not open


Why is the bed targets file not being found? 

Bed file looks like this: 

c_000000000002_pilon	1	101865
```",sgl07007,https://github.com/tseemann/snippy/issues/312
MDU6SXNzdWU0ODg0MDEyMzc=,Error in the effect inference,CLOSED,2019-09-03T05:37:50Z,2019-09-03T06:21:18Z,2019-09-03T06:11:34Z,"Hi Tseemann, 
I am currently running snippy (v4.0.2) for an evolutionary study for our lab bacterial strain (Illumina 150bp -PE). I am using a well-annotated genome as the reference. The program seems to identify correctly the single mutation present in the evolved clones (at the NT_POS - according to the SANGER confirmation), but the effect reported is incorrect (both AA_POS and EFFECT). For instance, I am getting ""stop_gained"" effect in the middle of an essential gene, and when I analyzed the gene separately, the mutation does not cause such effect but a missense AA substitution. 
I went to the reference genome file (.gb) to check any issues in the gene translation, but there were no issues at all. 

So in summary: the program reports the SNP NT_pos correctly but miss-interpreting the effect. 

Any idea what can be causing this issue?

Thanks, 
Ricardo
",RicardoGCCR,https://github.com/tseemann/snippy/issues/313
MDU6SXNzdWU0OTEwMDI1NTg=,Unknown option mask,CLOSED,2019-09-09T10:05:48Z,2019-09-13T07:26:07Z,2019-09-13T07:26:07Z,"Hello Torsten,
I have created a bed file named ""gene"" to exclude specific regions in Mycobacterium tuberculosis.
The content of bed file is:

NC_000962       105324  106715  Rv0096  PPE1
NC_000962       131382  132872  Rv0109  PE-PGRS1

When I run the command line:
snippy --outdir 218T0 -R1 WTCHG_689876_72885264_1.fastq -R2 WTCHG_689876_72885264_2.fastq --mask auto gene

The error is: Unknown option mask
Do you know what is the problem?
I look forward to hear from you.
Thank you.
Anh",maingoclanmaingoclan,https://github.com/tseemann/snippy/issues/314
MDU6SXNzdWU0OTIzNDgwMzQ=,error using .gbk reference,CLOSED,2019-09-11T16:41:33Z,2019-09-13T07:25:25Z,2019-09-13T07:25:25Z,"Hi, im trying to using snippy, it work with a fasta reference but I need the extra columns given by a GenBank Format, when using a .gbk reference but I get this msg

```
[12:36:03] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[12:36:05] Error running command, check prueba_gbk/snps.log

log :

### cd /Users/bastianbrauer/Documents/Pasantia/SNPs/prueba

### /Users/bastianbrauer/miniconda3/bin/snippy --cpus 4 --outdir prueba_gbk --ref BBH18.gbk --R1 S22N_S12_MC_reads.fastq.1 --R2 S22N_S12_MC_reads.fastq.2

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.03 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.57 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.16 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.829 sec; CPU: 0.808 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:prueba_gbk\tSM:prueba_gbk' -t 4 reference/ref.fa /Users/bastianbrauer/Documents/Pasantia/SNPs/prueba/S22N_S12_MC_reads.fastq.1 /Users/bastianbrauer/Documents/Pasantia/SNPs/prueba/S22N_S12_MC_reads.fastq.2 | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /var/folders/nf/dd8t0trd5c78jrq2wnpqvj_00000gn/T//snippy.56945. --threads 4 -m 2000M | samtools fixmate -m - - | samtools sort -l 0 -T /var/folders/nf/dd8t0trd5c78jrq2wnpqvj_00000gn/T//snippy.56945. --threads 4 -m 2000M | samtools markdup -T /var/folders/nf/dd8t0trd5c78jrq2wnpqvj_00000gn/T//snippy.56945. -r -s - - > snps.bam

READ 168262 WRITTEN 164874 
EXCLUDED 15905 EXAMINED 152357
PAIRED 148972 SINGLE 3385
DULPICATE PAIR 3058 DUPLICATE SINGLE 330
DUPLICATE TOTAL 3388

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 270626 > reference/ref.txt


### freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf

Hope you can help me
Greetings from Chile
```",BastianBrauer,https://github.com/tseemann/snippy/issues/315
MDU6SXNzdWU0OTUyNjk0Nzk=,All frames are zero!,CLOSED,2019-09-18T14:38:29Z,2019-09-28T09:36:45Z,2019-09-28T09:36:37Z,"Hello,

I try to run snippy (installed with LinuxBrew). the reference is one i created myself with RAST.
`### /home/linuxbrew/.linuxbrew/bin/snippy --cpus 16 --outdir test --ref genome_data/T_0-references/DTK_01.gbk --R1 genome_data/trimReads/DTK_03_48485-A03_R1.fastq.gz --R2 genome_data/trimReads/DTK_03_48485-A03_R2.fastq.gz`

All dependencies are installed and checken with snippy --check.
The following warning is displayed twice in the snps.log
```
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref
WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
```
Do you have any idea how I can fix this warning, I only found one other issue where conda was used. the packages seem up-to-date.

Kind regards,
Yob


",yob1997,https://github.com/tseemann/snippy/issues/316
MDU6SXNzdWU0OTYxNDU1NTA=,Display %aligned bases in snippy-core core.txt file,OPEN,2019-09-20T04:58:02Z,2019-09-28T09:37:16Z,,"Hi Torsten,

it would be great if you could add to the core.txt file generated by snippy-core a column displaying the breadth of coverage (% aligned bases) for each individual sequence. The current version provides the number of bases aligned but not the percentage.
The % aligned bases used to be shown in previous versions of snippy-core. Here, for example, with snippy-core v3.1:

> ID                            Aligned Bases                 Reference bases               % Aligned Bases
2014-21162                    2710254                       2902619                       93.37
2014-21163                    2678265                       2902619                       92.27
2014-21164                    2656446                       2902619                       91.52
2014-21165                    2752788                       2902619                       94.84
2014-23506                    2739979                       2902619                       94.40

Thank you!

Stefano",stefanogg,https://github.com/tseemann/snippy/issues/317
MDU6SXNzdWU0OTgwMTgxNzA=,How to merge indels,OPEN,2019-09-25T02:51:04Z,2021-11-05T15:35:12Z,,"I'm calling variants from 10 samples using one reference fasta for all. The samples are from the same strain. One sample is WT and the others were under different stress selection. The purpose is to find out whether the stress brought any mutations and what they are.

In order to do this, I need to merge the variant calling results from all samples. For example, if a position is 0/0 in the WT sample, but 1/1 in one of the stressed samples this would be of our interest. 

Ideally I would want to do a joint calling from all samples together. But Snippy can only call each sample individually and it only outputs variants so all 0/0 sites are lost. I know I can use snippy-core to merge SNPs to get those 0/0 sites back, but it does not handle indels. 

My questions are:
(1) Is it possible to let snippy output all callable sites including 0/0? Or
(2) Is it possible to let snippy-core output all variants including indels?

Any other solution?

Thanks,",weishwu,https://github.com/tseemann/snippy/issues/318
MDU6SXNzdWU1MDIyNzA4NTQ=,Snippy-multi input format,CLOSED,2019-10-03T20:06:18Z,2019-10-03T21:53:00Z,2019-10-03T21:53:00Z,"I'm trying to test out the core SNP genome step described on the Snippy front page from a directory containing multiple snippy output folders, all fasta contigs run against the same reference genome. 

The input.tab tsv file was created with below layout 

AssemblyName1     /snippyoutput1/AssemblyName1.aligned.fa
AssemblyName2     /snippyoutput2/AssemblyName2.aligned.fa
.
.
.

When the snippy-multi script is run from the parent directory it gives an error message

ERROR: [AssemblyName1] unreadable file '/snippyoutput1/AssemblyName1.aligned.fa'

I tried running the same process with just the initial assembly fasta files (rather than the snippy outputs) as well, and encountered the same error message. 

I'm pretty sure I'm making a silly mistake somewhere- would you mind telling me what could be wrong? 

Thank you! 
",naturepoker,https://github.com/tseemann/snippy/issues/319
MDU6SXNzdWU1MDIzMzQwMTc=,Hard-coded  samtools fastq -@ 3 for --unmapped,CLOSED,2019-10-03T22:40:41Z,2019-10-03T23:11:38Z,2019-10-03T23:11:38Z,"Need to review the unmapped command too.
",tseemann,https://github.com/tseemann/snippy/issues/320
MDU6SXNzdWU1MDQ3MzY5MjI=,Snippy error with gbk from ncbi,CLOSED,2019-10-09T15:45:18Z,2019-10-12T22:15:57Z,2019-10-12T22:15:57Z,"Hi @tseemann 
I am running snippy with two chromosome bacteria. I got an error when using gb reference file that I downloaded from ncbi. The gb reference was generated from two chromosome using cat command. I found error as .log file here:
``` 
### echo snippy 4.4.0
### cd /home/nc-lab/Rathanin/test

### /home/nc-lab/anaconda3/envs/rathanin/bin/snippy --outdir snippynm/10-001 --ref k9.gb --ctgs 10-001.fa

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.08 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 3.31 seconds elapse.
[bwa_index] Update BWT... 0.04 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 1.65 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 5.437 sec; CPU: 5.109 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:10-001\tSM:10-001' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 8 -m 500M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp --threads 8 -m 500M | samtools markdup -T /tmp -r -s - - > snps.bam

READ 0 WRITTEN 0 
EXCLUDED 0 EXAMINED 0
PAIRED 0 SINGLE 0
DULPICATE PAIR 0 DUPLICATE SINGLE 0
DUPLICATE TOTAL 0

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 491233 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf

Error: Failed to set region: -1:0-491,233(*)
ERROR(freebayes): Could not SetRegion to NC_006351:0..491233
Error: Failed to set region: -1:491,233-982,466(*)
ERROR(freebayes): Could not SetRegion to NC_006351:491233..982466
Error: Failed to set region: -1:982,466-1,473,699(*)
ERROR(freebayes): Could not SetRegion to NC_006351:982466..1473699
Error: Failed to set region: -1:1,473,699-1,964,932(*)
ERROR(freebayes): Could not SetRegion to NC_006351:1473699..1964932
Error: Failed to set region: -1:1,964,932-2,456,165(*)
ERROR(freebayes): Could not SetRegion to NC_006351:1964932..2456165
Error: Failed to set region: -1:2,456,165-2,947,398(*)
ERROR(freebayes): Could not SetRegion to NC_006351:2456165..2947398
Error: Failed to set region: -1:2,947,398-3,173,005(*)
ERROR(freebayes): Could not SetRegion to NC_006351:2947398..3173005
Error: Failed to set region: -1:0-491,233(*)
ERROR(freebayes): Could not SetRegion to NC_006350:0..491233
Error: Failed to set region: -1:491,233-982,466(*)
ERROR(freebayes): Could not SetRegion to NC_006350:491233..982466
Error: Failed to set region: -1:982,466-1,473,699(*)
ERROR(freebayes): Could not SetRegion to NC_006350:982466..1473699
Error: Failed to set region: -1:1,473,699-1,964,932(*)
ERROR(freebayes): Could not SetRegion to NC_006350:1473699..1964932
Error: Failed to set region: -1:1,964,932-2,456,165(*)
ERROR(freebayes): Could not SetRegion to NC_006350:1964932..2456165
Error: Failed to set region: -1:2,456,165-2,947,398(*)
ERROR(freebayes): Could not SetRegion to NC_006350:2456165..2947398
Error: Failed to set region: -1:2,947,398-3,438,631(*)
ERROR(freebayes): Could not SetRegion to NC_006350:2947398..3438631
Error: Failed to set region: -1:3,438,631-3,929,864(*)
ERROR(freebayes): Could not SetRegion to NC_006350:3438631..3929864
Error: Failed to set region: -1:3,929,864-4,074,542(*)
ERROR(freebayes): Could not SetRegion to NC_006350:3929864..4074542

### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf
```
Could you please give me the suggestion to fix this? Thanks in advance!",Rathanin-github,https://github.com/tseemann/snippy/issues/321
MDU6SXNzdWU1MDU1NzYwMjE=,BAM header error - failing every time,CLOSED,2019-10-11T00:33:00Z,2019-10-29T20:51:53Z,2019-10-14T11:01:31Z,"Hello @tseemann 

I'm trying to use Snippy with some fastqs downloaded from the SRA, along with a reference gbff also downloaded from NCBI. 

Everything goes smoothly during the intial bwa memming, but something seems to be going wrong immediately after that (possibly during conversion from sam to bam?). After that, the script does run to completion, but always with 0 variants (there definitely should be some!). 

Here's the output just before and after where I'm seeing the error message:

`[samclip] Processed 7200000 records...
[main] Version: 0.7.15-r1140
[main] CMD: bwa mem -Y -M[samclip] Total SAM records 7291398, removed 350755, allowed 134488, passed 6940643
[samclip] Header contained 3 lines
[samclip] Done.
 -R @RG\tID:snippy_test\tSM:snippy_test -t 16 reference/ref.fa /home/ubuntu/FHA/post2000/I429_1.fastq.gz /home/ubuntu/FHA/post2000/I429_2.fastq.gz
[main] Real time: 431.538 sec; CPU: 3105.016 sec
[bam_sort_core] merging from 0 files and 15 in-memory blocks...
[E::bgzf_read] Read block operation failed with error 33 after 0 of 4 bytes
[E::bam_hdr_read] Invalid BAM binary header
[bam_mating_core] ERROR: Couldn't read header
[00:09:49] Running: samtools index snps.bam 2>> snps.log
[00:09:49] Running: fasta_generate_regions.py reference/ref.fa.fai 134011 > reference/ref.txt 2>> snps.log
[00:09:49] Running: freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 10 --min -repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log`

And the command I'm using to run Snippy is:
`snippy --cpus 16 --outdir snippy_test --ref BP_Tohama1_genomic.gbff --R1 I429_1.fastq.gz --R2 I429_2.fastq.gz
`

I've tried various different reference files from NCBI, made sure all my tools were up-to-date (including Snippy itself), and Googled  the error messages to see if I could fix it myself, but I'm coming up blank. 

Any ideas what's going wrong, and how I can fix it please?

Thanks for your help,
Nat",nataliering,https://github.com/tseemann/snippy/issues/322
MDU6SXNzdWU1MDc4NjA5NDM=,Snippy pipe error at freebayes-parallel,CLOSED,2019-10-16T13:42:28Z,2020-03-31T02:31:09Z,2020-03-31T02:31:09Z,"Hi Torsten,
I am running snippy to target sites on an S. Venezuelae reference with an interleaved sequencing file, however the pipeline is failing at the freebayes-parallel step. 
""### freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf
dyld: Symbol not found: __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE13find_first_ofEPKcmm""

My command is:
""snippy --cpus 4 --outdir mysnps --ref SVEN.gbk --peil combined.fastq""

The reference was obtained from NCBI:
""https://www.ncbi.nlm.nih.gov/nuccore/NZ_CP018074.1?report=gbwithparts&log$=seqview""

[snps.log](https://github.com/tseemann/snippy/files/3734614/snps.log)

Cheers",feardley,https://github.com/tseemann/snippy/issues/323
MDU6SXNzdWU1MTExOTU5MjE=,Insertion support on core.full.aln,OPEN,2019-10-23T09:29:55Z,2019-10-23T09:32:56Z,,"Hello! 
snippy-core alignments do not contain insertions (i.e. sites missing in the reference), but in theory my samples may have a polymorphic  insertion. Would it be possible to have snippy-core report this ""extended"" (full) alignment? It would be something like aligning all `snps.consensus.fa`, but I believe snippy-core is very close to that...

thank you! ",leomrtns,https://github.com/tseemann/snippy/issues/324
MDU6SXNzdWU1MTM4MjAzMDg=,Looping a script,CLOSED,2019-10-29T10:22:45Z,2019-11-26T09:17:12Z,2019-11-03T05:55:09Z,"Hi,

I have quite a few file I want to run through Snippy. I made a file that I made executable using chmod u+x and then ran ./MyFile

However it seems to have failed saying ""unknown option: mask""   I have copied my executable below. It would be great if someone could tell me what I'm doing wrong.

Cheers.


#/bin/bash

sampleLoc=/home/linux-biostation/Documents/Peter_F_Work/IMRL_Clusters_Snippy/Fastq
sampleName=( ""IMRL28"" ""IMRL29"" ""IMRL30"" ""IMRL137"" ""IMRL138"" ""IMRL39"" ""IMRL140"" ""IMRL141"" ""IMRL142"" ""MABC143"" ""IMRL144"" ""IMRL145"" ""IMRL146"" ""IMRL147"" ""IMRL148"" ""IMRL149"" ""IMRL150"" ""IMRL151"" ""IMRL152"" ""IMRL153"" ""IMRL154"" ""IMRL156"" ""IMRL157"" ""IMRL158"" ""IMRL159"" ""IMRL160"" ""IMRL161"" ""IMRL162"" ""IMRL163"" ""IMRL164"" ""IMRL165"" ""IMRL167"" ""IMRL168"" ""IMRL169"" ""IMRL170"" ""IMRL171"" ""IMRL172"" ""IMRL173"" ""IMRL174"" ""IMRL175"" ""IMRL176"" ""IMRL177"" ""IMRL178"" ""IMRL179"" ""IMRL180"" ""IMRL181"" ""IMRL182"" ""IMRL183"" ""IMRL184"" ""IMRL185"" ""IMRL186"" ""IMRL187"" ""IMRL188"" ""IMRL189"" ""IMRL190"" ""IMRL190"" ""IMRL191"" ""IMRL192"" ""IMRL193"" ""IMRL194"" ""IMRL194"" ""IMRL195"" ""IMRL196"" ""IMRL197"" ""IMRL198"" ""IMRL199"" ""IMRL200"" ""IMRL201"" ""IMRL202"" ""IMRL203"" ""IMRL204"" ""IMRL205"" ""IMRL206"" ""IMRL207"" ""IMRL208"" ""IMRL209"" ""IMRL210"" ""IMRL211"" ""IMRL212"" ""IMRL213"" ""IMRL214"" ""IMRL215"" ""IMRL216"" ""IMRL217"" ""IMRL219"" ""IMRL220"" ""IMRL221"" ""IMRL222"" ""IMRL223"" ""IMRL225"" ""IMRL226"" ""IMRL228"" ""IMRL232"" ""IMRL233"" ""IMRL234"" ""IMRL235"" ""IMRL236"" ""IMRL237"" ""IMRL238"" ""IMRL239"" ""IMRL241"" ""IMRL243"" ""IMRL244"" ""IMRL251"" ""IMRL252"" ""IMRL253"" ""IMRL254"" )

for sample in ${sampleName[*]}

do

snippy --outdir /home/linux-biostation/Documents/Peter_F_Work/IMRL_Clusters_Snippy/Snippy_Output/ --ref /home/linux-biostation/Documents/Peter_F_Work/H37rv_Ref3.fasta --mask /home/linux-biostation/Documents/Peter_F_Work/Mtb_NC_000962.3_mask.bed   --R1 $sampleLoc/${sample}*R1*.fastq.gz --R2 $sampleLoc/${sample}*R2*.fastq.gz

done",peflanag,https://github.com/tseemann/snippy/issues/325
MDU6SXNzdWU1MTQwMjk4MTM=,Could not run snp-sites,CLOSED,2019-10-29T15:56:03Z,2019-10-29T21:06:32Z,2019-10-29T20:54:50Z,"Hi,

I ran snippy and now I want to run snippy-core. I have cd into the directory where all the files have been generated and ran the following 

snippy-core --mask Path/to/file --ref Path/to/file --prefix Core_SNPs ""IMRL28"" etc etc for each of the files.

The program starts to work and goes through all the files but when it gets to snp-sites it fails. Any thoughts?

Cheers,

P


![Screenshot 2019-10-29 at 15 51 22](https://user-images.githubusercontent.com/32863969/67784996-84036780-fa64-11e9-8e4f-cb80de7dc972.png)
",peflanag,https://github.com/tseemann/snippy/issues/326
MDU6SXNzdWU1MTQyMjM2MDY=,snippy-core: check aligned% of samples and remove dodgy ones,OPEN,2019-10-29T21:05:29Z,2019-10-29T21:05:29Z,,"If one sample is mostly unaligned it will wipe out the whole core
Resulting in 'no SNPS found'",tseemann,https://github.com/tseemann/snippy/issues/327
MDU6SXNzdWU1MTU3NDA1NTM=,Support GFF as well as BED for --mask (from gubbins),OPEN,2019-10-31T20:56:54Z,2019-10-31T20:56:54Z,,"`paftools gff2bed` might work too.

See https://github.com/sanger-pathogens/gubbins/issues/249",tseemann,https://github.com/tseemann/snippy/issues/328
MDU6SXNzdWU1MTY5MzUxMDU=,core snp annotation different with prokka,CLOSED,2019-11-04T02:40:41Z,2019-11-05T02:15:47Z,2019-11-05T02:15:47Z,"Hi, Dr. tseemann, I used snppy-core to get the tab file with annotation at the last few lines. I also use prokka to note snps in reference sequence. Why the snp annotation are different from the two methods ?  Can I just use the snppiy-core file as my result ? Thanks.   ",wanyingsun,https://github.com/tseemann/snippy/issues/329
MDU6SXNzdWU1MTkyMzI5Mjc=,"snippy-core, variants in .full.aln lost in .vcf",CLOSED,2019-11-07T12:20:11Z,2024-02-12T03:03:18Z,2019-11-11T13:33:33Z,"Hello,
I observed that some variants present in the .full.aln obtained from snippy-core are not present in the .vcf. 
Those variants are present both in the samplename/snps.vcf and samplename/snps.filt.vcf so they should have passed the quality check.
 I also noticed that in the .full.aln, for some isolates, the variants not found in the .vcf from snippy-core are written in uppercase instead of lowercase. What does it mean?
Thank you very much for your help!",MartinaTamb,https://github.com/tseemann/snippy/issues/330
MDU6SXNzdWU1MjE2MzE5NTA=,Deletions in core.full.aln,OPEN,2019-11-12T15:46:39Z,2023-08-24T08:26:35Z,,"Hello,

I ran snippy-multi on a set of 24 samples. According to the log output and the snps.tab file for each sample, 13 of them had a deletion at the same site. However, in the core.full.aln file, only 1 has a ""-"" at that position while the other 12 are the same as the reference. Any idea why this might be happening?
",pkmitchell,https://github.com/tseemann/snippy/issues/331
MDU6SXNzdWU1MjI0ODM0NTQ=,snpEFF ANN gene names with Genbank reference ,CLOSED,2019-11-13T21:29:10Z,2020-02-29T23:56:14Z,2020-02-29T23:56:14Z,"When using a Genbank reference ([this one](https://zenodo.org/record/3531703/files/Mycobacterium_tuberculosis_ancestral_reference.gbk?download=1)), the ANN fields provided by snpEff have details from the ID field in the GFF3 that snpEff creates.

I.e. while `snpEff` can handle a Genbank reference directly `snippy` [creates](https://github.com/tseemann/snippy/blob/master/bin/snippy#L197) a GFF3 reference with the ID as the locus tag. If `snpEff` is called with the Genbank file it generates a database with gene names not locus tags.

This is rambling, but since the gene names are what I want is there a way to get then by either doing something with the GFF3 or using the Genbank file directly?",pvanheus,https://github.com/tseemann/snippy/issues/332
MDU6SXNzdWU1MjMzMjE2NjQ=,indels and snps in core.aln,CLOSED,2019-11-15T08:18:55Z,2019-11-16T04:14:39Z,2019-11-16T04:14:14Z,"Greetings!
Snippy generates output files containig both substitusions and indels. Does core.aln generated by the snippy-core also contains both of them, or it contains only snp's?",a-lapin,https://github.com/tseemann/snippy/issues/333
MDU6SXNzdWU1MjQwODc3MjM=,Symbolic link  then hard link issues,CLOSED,2019-11-18T01:39:41Z,2019-11-24T04:21:16Z,2019-11-24T04:21:16Z,"Hi,

I had an issue with symbolic links giving a operation no permitted termination, i followed the advice on a previous issue relating to this, and now i get a failed to create hard link './ref.fa' => 'reference/ref.fa': operation not permitted message for this operation.

Any hints on how i could work around this?

Cheers,
",Tahausix,https://github.com/tseemann/snippy/issues/334
MDU6SXNzdWU1MjY4NTc0MzQ=,INDELs and depth mask on same consensus sequence,OPEN,2019-11-21T21:42:07Z,2019-11-24T04:17:40Z,,"Hi there! It would be great to merge the information encoded in the snps.consensus.fa and snps.aligned.fa file, such that both indels and low coverage regions are visible on a consensus sequence. I'm not sure I see an obvious way of merging them after they are generated, but what are your thoughts on revisiting the consensus generation step?",donutbrew,https://github.com/tseemann/snippy/issues/335
MDU6SXNzdWU1MjcwMDQ1MDA=,snippy-multi has error: Bad ID?,CLOSED,2019-11-22T05:59:35Z,2019-11-24T23:08:28Z,2019-11-24T03:56:32Z,"I am new to snippy and am trying to run snippy-multi with the following command:

snippy-multi input_1.tab --ref 452_H1N1_HA.fa --cpus 16 > runme.sh

However, I got the error:
Reading: input_1.tab
ERROR: Bad ID: 

I checked the input_1.tab file (see attached) but have no idea where it going wrong. Any help will be appreciated!
[input_1.tab.txt](https://github.com/tseemann/snippy/files/3878129/input_1.tab.txt)

 ",Chongli-90,https://github.com/tseemann/snippy/issues/336
MDU6SXNzdWU1Mjc0MDY0MjI=,Can not mix read file types,CLOSED,2019-11-22T20:45:18Z,2019-11-24T01:39:48Z,2019-11-24T01:39:47Z,"Elementary OS 5.0
Snippy 4.4.5

I intended to align the small test fasta with the human reference genome and coll SNPs.

snippy --cpus 4 --outdir /path_to_folder --ref /path_to_folder/Homo_sapiens.GRCh38.dna.primary_assembly.fa --R1 /path_to_folder/seq1.fa

[20:05:06] This is snippy 4.4.5
[20:05:06] Written by Torsten Seemann
[20:05:06] Obtained from https://github.com/tseemann/snippy
[20:05:06] Detected operating system: linux
[20:05:06] Enabling bundled linux tools.
[20:05:06] Found bwa - /home/platon/miniconda3/bin/bwa
[20:05:06] Found bcftools - /home/platon/miniconda3/bin/bcftools
[20:05:06] Found samtools - /home/platon/miniconda3/bin/samtools
[20:05:06] Found java - /home/platon/miniconda3/bin/java
[20:05:06] Found snpEff - /home/platon/miniconda3/bin/snpEff
[20:05:06] Found samclip - /home/platon/miniconda3/bin/samclip
[20:05:06] Found seqtk - /home/platon/miniconda3/bin/seqtk
[20:05:06] Found parallel - /home/platon/miniconda3/bin/parallel
[20:05:06] Found freebayes - /home/platon/miniconda3/bin/freebayes
[20:05:06] Found freebayes-parallel - /home/platon/miniconda3/bin/freebayes-parallel
[20:05:06] Found fasta_generate_regions.py - /home/platon/miniconda3/bin/fasta_generate_regions.py
[20:05:06] Found vcfstreamsort - /home/platon/miniconda3/bin/vcfstreamsort
[20:05:06] Found vcfuniq - /home/platon/miniconda3/bin/vcfuniq
[20:05:06] Found vcffirstheader - /home/platon/miniconda3/bin/vcffirstheader
[20:05:06] Found gzip - /bin/gzip
[20:05:06] Found vt - /home/platon/miniconda3/bin/vt
[20:05:06] Found snippy-vcf_to_tab - /home/platon/miniconda3/bin/snippy-vcf_to_tab
[20:05:06] Found snippy-vcf_report - /home/platon/miniconda3/bin/snippy-vcf_report
[20:05:06] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[20:05:06] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[20:05:06] Checking version: freebayes --version is >= 1.1 - ok, have 1.3
[20:05:06] Checking version: java -version is >= 1.8 - ok, have 1.8
[20:05:06] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[20:05:06] Checking version: bwa is >= 7.12 - ok, have 7.17
[20:05:06] Using reference: /home/platon/_0_Диссертация/Exp/seq1/Snippy/Homo_sapiens.GRCh38.dna.primary_assembly.fa
[20:08:33] Treating reference as 'fasta' format.
[20:08:33] Will use 4 CPU cores.
[20:08:33] Can not mix read file types. Either (1) --R1 (2) --se (3) --peil (4) --ctgs (5) --bam

How to interpret the received error message?

Source files:
- R1: simple fasta with .fa extension (renamed to .txt for the ability to attach here);
- ref: Homo_sapiens.GRCh38.dna.primary_assembly.fa from Ensembl's FTP.

P.S. The program took up all 8 GB of RAM and part of SWAP. Is there a way to reduce memory consumption?

[seq1.txt](https://github.com/tseemann/snippy/files/3881271/seq1.txt)",PlatonB,https://github.com/tseemann/snippy/issues/337
MDU6SXNzdWU1MjgyODk1MTY=,How does Snippy create 'core.full.aln' from a draft assembly reference?,CLOSED,2019-11-25T19:26:59Z,2019-11-26T06:01:23Z,2019-11-26T02:27:13Z,"How does Snippy create its pseudo-whole genome alignment (core.full.aln) when the reference provided consists of contigs (i.e. is a draft assembly)?

Are contigs stitched together, separated by 'N's or something along those lines? I have tried searching in the code but am either looking in the wrong place or misunderstanding something (Perl is not my strong suit). I also have not been able to find any previous questions that may have answered this (but I may have just missed it!).

Any help in understanding is greatly appreciated!

Thank you,
Conrad",cizydorczyk,https://github.com/tseemann/snippy/issues/338
MDU6SXNzdWU1Mjg2OTIwNjQ=,snippy-core issue,CLOSED,2019-11-26T12:26:18Z,2019-11-27T04:40:35Z,2019-11-27T04:40:01Z,"Hi,

I'm just wondering if this has actually worked? It says theres a warring and an error at the end but it seems to have made an .aln file that when I run through snp-dists gives me my snps. Could anyone tell me if it is correct or not? I have also attached the snp-dists output

Cheers

This is snippy-core 4.4.5
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools.
Found any2fasta - /Users/peterflanagan/miniconda3/envs/snippy/binaries/noarch/any2fasta
Found samtools - /Users/peterflanagan/miniconda3/envs/snippy/bin/samtools
Found minimap2 - /Users/peterflanagan/miniconda3/envs/snippy/bin/minimap2
Found bedtools - /Users/peterflanagan/miniconda3/envs/snippy/bin/bedtools
Found snp-sites - /Users/peterflanagan/miniconda3/envs/snippy/bin/snp-sites
Saving reference FASTA: Core_IMRL_All_Runs.ref.fa
This is any2fasta 0.4.2
Opening '/Users/peterflanagan/IMRL_Sequencing/Illumina/Clusters_Snippy/H37rv_Ref3.fasta'
Detected FASTA format
Read 63024 lines from '/Users/peterflanagan/IMRL_Sequencing/Illumina/Clusters_Snippy/H37rv_Ref3.fasta'
Wrote 1 sequences from FASTA file.
Processed 1 files.
Done.
Loaded 1 sequences totalling 4411532 bp.
Loading mask bed file: /Users/peterflanagan/IMRL_Sequencing/Illumina/Clusters_Snippy/Mtb_NC_000962.3_mask.bed
Will mask 731 regions totalling 341952 bp ~ 7.75%
0	IMRL28	snp=558	del=188	ins=134	het=382	unaligned=90162
1	IMRL29	snp=535	del=87	ins=63	het=110	unaligned=91731
2	IMRL30	snp=566	del=111	ins=94	het=271	unaligned=88527
3	IMRL137	snp=984	del=315	ins=235	het=1459	unaligned=78547
4	IMRL138	snp=980	del=312	ins=192	het=1747	unaligned=78892
5	IMRL139	snp=320	del=65	ins=41	het=959	unaligned=74117
6	IMRL140	snp=2407	del=466	ins=443	het=1257	unaligned=105106
7	IMRL141	snp=2400	del=439	ins=444	het=1841	unaligned=140664
8	IMRL142	snp=945	del=130	ins=149	het=631	unaligned=83485
9	IMRL143	snp=969	del=188	ins=216	het=2367	unaligned=89927
10	IMRL144	snp=1477	del=308	ins=302	het=1357	unaligned=103326
11	IMRL145	snp=1454	del=262	ins=266	het=1182	unaligned=104055
12	IMRL146	snp=1478	del=362	ins=322	het=2125	unaligned=102433
13	IMRL147	snp=1461	del=299	ins=226	het=1444	unaligned=104031
14	IMRL148	snp=1466	del=343	ins=309	het=691	unaligned=103705
15	IMRL149	snp=1481	del=362	ins=312	het=1508	unaligned=102803
16	IMRL150	snp=980	del=313	ins=193	het=1140	unaligned=79709
17	IMRL151	snp=944	del=310	ins=173	het=575	unaligned=84734
18	IMRL152	snp=967	del=306	ins=191	het=803	unaligned=84369
19	IMRL153	snp=809	del=275	ins=188	het=784	unaligned=101382
20	IMRL154	snp=798	del=284	ins=179	het=893	unaligned=101154
21	IMRL156	snp=804	del=282	ins=170	het=496	unaligned=102359
22	IMRL157	snp=805	del=284	ins=164	het=380	unaligned=102387
23	IMRL158	snp=801	del=282	ins=173	het=329	unaligned=102308
24	IMRL159	snp=818	del=305	ins=197	het=408	unaligned=101030
25	IMRL160	snp=804	del=296	ins=170	het=356	unaligned=101736
26	IMRL161	snp=801	del=273	ins=178	het=429	unaligned=103195
27	IMRL162	snp=806	del=296	ins=187	het=509	unaligned=102527
28	IMRL163	snp=802	del=246	ins=164	het=470	unaligned=102574
29	IMRL164	snp=796	del=282	ins=161	het=471	unaligned=104545
30	IMRL165	snp=794	del=297	ins=145	het=410	unaligned=102582
31	IMRL167	snp=902	del=298	ins=127	het=153	unaligned=86322
32	IMRL168	snp=939	del=300	ins=134	het=198	unaligned=81512
33	IMRL169	snp=949	del=255	ins=176	het=164	unaligned=81489
34	IMRL170	snp=949	del=307	ins=129	het=367	unaligned=81907
35	IMRL171	snp=965	del=311	ins=184	het=477	unaligned=79697
36	IMRL172	snp=963	del=310	ins=161	het=735	unaligned=81216
37	IMRL173	snp=973	del=324	ins=131	het=395	unaligned=79398
38	IMRL174	snp=955	del=311	ins=197	het=731	unaligned=79851
39	IMRL175	snp=883	del=211	ins=102	het=85	unaligned=85493
40	IMRL176	snp=949	del=302	ins=129	het=551	unaligned=81190
41	IMRL177	snp=978	del=319	ins=188	het=844	unaligned=80187
42	IMRL178	snp=974	del=327	ins=164	het=372	unaligned=80674
43	IMRL179	snp=973	del=310	ins=213	het=970	unaligned=79183
44	IMRL180	snp=965	del=302	ins=165	het=467	unaligned=80636
45	IMRL181	snp=964	del=296	ins=124	het=652	unaligned=80965
46	IMRL182	snp=986	del=326	ins=190	het=1832	unaligned=78463
47	IMRL183	snp=919	del=256	ins=123	het=285	unaligned=88878
48	IMRL184	snp=922	del=262	ins=107	het=209	unaligned=89807
49	IMRL185	snp=945	del=257	ins=134	het=358	unaligned=84465
50	IMRL186	snp=942	del=256	ins=166	het=341	unaligned=85016
51	IMRL187	snp=1398	del=238	ins=189	het=184	unaligned=109577
52	IMRL188	snp=821	del=122	ins=129	het=73	unaligned=103098
53	IMRL189	snp=863	del=153	ins=125	het=162	unaligned=90089
54	IMRL190	snp=875	del=154	ins=185	het=328	unaligned=87254
55	IMRL191	snp=818	del=153	ins=143	het=95	unaligned=105083
56	IMRL192	snp=861	del=192	ins=112	het=208	unaligned=88924
57	IMRL193	snp=802	del=105	ins=132	het=40	unaligned=107206
58	IMRL194	snp=855	del=178	ins=127	het=195	unaligned=88497
59	IMRL195	snp=871	del=163	ins=160	het=191	unaligned=87786
60	IMRL196	snp=903	del=190	ins=188	het=566	unaligned=85372
61	IMRL197	snp=887	del=204	ins=179	het=605	unaligned=85836
62	IMRL198	snp=843	del=182	ins=140	het=108	unaligned=94407
63	IMRL199	snp=935	del=134	ins=140	het=351	unaligned=91786
64	IMRL200	snp=925	del=136	ins=101	het=282	unaligned=94114
65	IMRL201	snp=904	del=131	ins=113	het=145	unaligned=106814
66	IMRL202	snp=944	del=196	ins=138	het=340	unaligned=84271
67	IMRL203	snp=772	del=110	ins=123	het=399	unaligned=91393
68	IMRL204	snp=948	del=122	ins=121	het=342	unaligned=88470
69	IMRL205	snp=891	del=136	ins=106	het=115	unaligned=102085
70	IMRL206	snp=993	del=292	ins=184	het=1015	unaligned=78843
71	IMRL207	snp=986	del=206	ins=174	het=505	unaligned=79616
72	IMRL208	snp=996	del=310	ins=128	het=677	unaligned=78786
73	IMRL209	snp=994	del=283	ins=180	het=554	unaligned=78412
74	IMRL210	snp=985	del=251	ins=162	het=425	unaligned=78897
75	IMRL211	snp=1002	del=269	ins=155	het=627	unaligned=78641
76	IMRL212	snp=996	del=251	ins=197	het=647	unaligned=78262
77	IMRL213	snp=517	del=23	ins=30	het=26	unaligned=130127
78	IMRL214	snp=0	del=0	ins=0	het=0	unaligned=4406927
79	IMRL215	snp=867	del=191	ins=181	het=255	unaligned=87835
80	IMRL216	snp=874	del=163	ins=126	het=258	unaligned=86813
81	IMRL217	snp=874	del=181	ins=167	het=305	unaligned=86637
82	IMRL219	snp=730	del=35	ins=52	het=20	unaligned=113618
83	IMRL220	snp=862	del=145	ins=115	het=226	unaligned=88071
84	IMRL221	snp=875	del=168	ins=138	het=184	unaligned=87288
85	IMRL222	snp=881	del=172	ins=142	het=348	unaligned=86336
86	IMRL223	snp=871	del=154	ins=121	het=263	unaligned=87801
87	IMRL225	snp=872	del=187	ins=168	het=436	unaligned=87495
88	IMRL226	snp=874	del=168	ins=138	het=353	unaligned=90618
89	IMRL228	snp=873	del=163	ins=174	het=62522	unaligned=87295
90	IMRL232	snp=889	del=240	ins=206	het=440	unaligned=85426
91	IMRL233	snp=825	del=39	ins=82	het=230	unaligned=89004
92	IMRL234	snp=890	del=276	ins=172	het=294	unaligned=85332
93	IMRL235	snp=897	del=238	ins=197	het=304	unaligned=85912
94	IMRL236	snp=602	del=22	ins=40	het=200	unaligned=98437
95	IMRL237	snp=905	del=309	ins=204	het=729	unaligned=85474
96	IMRL238	snp=890	del=220	ins=188	het=278	unaligned=86027
97	IMRL239	snp=899	del=177	ins=203	het=405	unaligned=85534
98	IMRL241	snp=898	del=238	ins=225	het=287	unaligned=85669
99	IMRL243	snp=0	del=0	ins=0	het=0	unaligned=4405795
100	IMRL244	snp=755	del=45	ins=68	het=219	unaligned=129805
101	IMRL251	snp=576	del=201	ins=121	het=471	unaligned=89593
102	IMRL252	snp=571	del=171	ins=132	het=477	unaligned=89817
103	IMRL253	snp=561	del=175	ins=122	het=460	unaligned=88240
104	IMRL254	snp=559	del=96	ins=131	het=281	unaligned=88298
Opening: Core_IMRL_All_Runs.tab
Opening: Core_IMRL_All_Runs.vcf
Processing contig: NC_000962.3
Masking alignment at 731 regions
Generating Core_IMRL_All_Runs.full.aln
Creating TSV file: Core_IMRL_All_Runs.txt
Running: snp-sites -c -o Core_IMRL_All_Runs.aln Core_IMRL_All_Runs.full.aln
Warning: No SNPs were detected so there is nothing to output.
ERROR: Could not run: snp-sites -c -o Core_IMRL_All_Runs.aln Core_IMRL_All_Runs.full.aln
(snippy) peterflanagan@med176028 Clusters_Snippy % 




[Core.xlsx](https://github.com/tseemann/snippy/files/3891802/Core.xlsx)
",peflanag,https://github.com/tseemann/snippy/issues/339
MDU6SXNzdWU1MzAzMTI5MzA=,annotations in core files,CLOSED,2019-11-29T12:06:56Z,2020-05-09T19:32:51Z,2019-12-01T08:10:17Z,"Hi, I have used snippy-multi with several multi-fasta inputfiles and a .gbk file as a ref using the commands:

$snippy-multi CAS-NAD_input.tab --ref CAS-NAD-13-1.gbk --cpus 16 > runme.sh
$sh ./runme.sh

I found that each inputfile got annotations in its own snp output files, but there was no annotations in the core output files. I checked the runme.sh file and found that the command for snippy-core used a fasta file as a reference:

$snippy-core --ref 'CAS-NAD-13-2/ref.fa' CAS-NAD-13-2 CAS-NAD-13-3 CAS-NAD-13-4 CAS-NAD-13-5 CAS-NAD-21-1 CAS-NAD-21-2 CAS-NAD-21-3 CAS-NAD-21-4 CAS-NAD-21-5 CAS-NAD-53-1 CAS-NAD-53-2 CAS-NAD-53-3 CAS-NAD-53-4 CAS-NAD-53-5

Thus I reran snippy-core specifying that the same .gbk ref file was to be used as the one for snippy-multi:

$snippy-core --ref 'CAS-NAD-13-1.gbk' CAS-NAD-13-2 CAS-NAD-13-3 CAS-NAD-13-4 CAS-NAD-13-5 CAS-NAD-21-1 CAS-NAD-21-2 CAS-NAD-21-3 CAS-NAD-21-4 CAS-NAD-21-5 CAS-NAD-53-1 CAS-NAD-53-2 CAS-NAD-53-3 CAS-NAD-53-4 CAS-NAD-53-5

However, I still have no annotations in the core files. 
How can I fix this please?

Thanks a lot!

",marieleoz,https://github.com/tseemann/snippy/issues/340
MDU6SXNzdWU1MzI2NTA2NzA=,"How does snippy deal with ""Intra-species"" contaminated sample?",CLOSED,2019-12-04T12:22:59Z,2019-12-04T21:25:05Z,2019-12-04T21:25:04Z,"Hi Torsten, 
I was wondering how snippy deals with ""Intra-species"" contaminated sample.
Sometimes unintentionally we sequence a mixed culture of isolates from the same species.  
Mapping the reads to a reference may gives multiple possible variants at a single position. 
Does snippy choose the one with the higher coverage? 
Can snippy help us to detect these contaminations?

Thanks and best regards
 ",MostafaYA,https://github.com/tseemann/snippy/issues/341
MDU6SXNzdWU1MzM0NzI5MzE=,View bam file on Tablet,CLOSED,2019-12-05T16:52:54Z,2020-02-24T04:35:13Z,2020-02-24T04:35:13Z,"Hello Torsten,
I have used reference genome with the file type .gbff to get SNP with the gene information in snippy results. However, when I want to view the snps.bam file in Tablet, it does not work. 
If I use the reference genome with the file type .fna, I can not get the SNP with the gene name in .csv file but I could view the SNPs on Tablet.
So If I want to get the gene information and to view the SNP on graph, I have to run snippy twice. 
Is there any way that I just need to run once and get both?
Thank you.",maingoclanmaingoclan,https://github.com/tseemann/snippy/issues/342
MDU6SXNzdWU1MzM2NDIyMTQ=,--minfrac 0?,CLOSED,2019-12-05T22:46:04Z,2023-06-01T21:32:53Z,2023-06-01T21:32:53Z,"Hi Torsten,

Just out of curiosity, what does `--minfrac 0` do? That is, what does setting --minfrac to AUTO do? I tested it vs. `--minfrac 0.9` and got slightly different results, so I'm assuming it's not just setting this value to 0.9? (Snippy v4.4.3)

Any response is greatly appreciated!

Thank you,
Conrad",cizydorczyk,https://github.com/tseemann/snippy/issues/343
MDU6SXNzdWU1MzU1NTkzNzg=,Problems with samtools versions (1.10),CLOSED,2019-12-10T08:00:15Z,2020-02-21T01:33:00Z,2020-02-21T01:33:00Z,"Hi, I've recently upgraded samtools to version 1.10 via linuxbrew. Since this update snippy is broken, probably it presumes that v.1.10 < v.1.7
```

[11:40:06] Found vt - /home/linuxbrew/.linuxbrew/bin/vt
[11:40:06] Found snippy-vcf_to_tab - /home/linuxbrew/.linuxbrew/Cellar/snippy/4.4.5/bin/snippy-vcf_to_tab
[11:40:06] Found snippy-vcf_report - /home/linuxbrew/.linuxbrew/Cellar/snippy/4.4.5/bin/snippy-vcf_report
[11:40:06] Need samtools --version >= 1.7 but you have 1.10 - please upgrade it.
```",a-lapin,https://github.com/tseemann/snippy/issues/344
MDU6SXNzdWU1NDAzOTMyMzI=,Using --bam,CLOSED,2019-12-19T15:42:17Z,2019-12-20T07:49:36Z,2019-12-20T02:06:31Z,"Hi,

We have .bam files that collaborators sent to us that we want to analysis. Due to the way they generated their bam files we cannot convert back to fastq in the R1 and R2 format as one sample contains two .bam files mixed with the R1 and R2 reads. We have merged these into one .bam file and ran snippy. However we have gotten this error and I was wondering if you could tell me what it means? Do I need to edit the .py file?

Thanks



### echo snippy 4.4.5
### cd /Users/peterflanagan

### /usr/local/bin/snippy --cpus 16 --outdir /Users/peterflanagan/IMRL_Sequencing/Illumina/Test_fastq/Output --ref /Users/peterflanagan/IMRL_Sequencing/Illumina/Test_fastq/H37rv_Ref3.fasta --bam /Users/peterflanagan/IMRL_Sequencing/Illumina/Test_fastq/Fastq/IMRLH83.bam

### samtools faidx reference/ref.fa


### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### samtools view -h -O SAM \/Users\/peterflanagan\/IMRL_Sequencing\/Illumina\/Test_fastq\/Fastq\/IMRLH83\.bam | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/yw/9tmv96yx73ld2r712hclgjv00000gn/T --threads 15 -m 266M | samtools fixmate -m - - | samtools sort -l 0 -T /private/var/folders/yw/9tmv96yx73ld2r712hclgjv00000gn/T --threads 15 -m 266M | samtools markdup -T /private/var/folders/yw/9tmv96yx73ld2r712hclgjv00000gn/T -r -s - - > snps.bam

READ 2277016 WRITTEN 1059809 
EXCLUDED 12194 EXAMINED 2264822
PAIRED 2260500 SINGLE 4322
DULPICATE PAIR 1214644 DUPLICATE SINGLE 2563
DUPLICATE TOTAL 1217207

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 144681 > reference/ref.txt

  File ""/usr/local/bin/fasta_generate_regions.py"", line 7
    print ""usage: "", sys.argv[0], "" <fasta file or index file> <region size>""
                  ^
SyntaxError: Missing parentheses in call to 'print'. Did you mean print(""usage: "", sys.argv[0], "" <fasta file or index file> <region size>"")?
",peflanag,https://github.com/tseemann/snippy/issues/345
MDU6SXNzdWU1NDE3MTk3OTg=,snippy-core issue from snippy using .bam as input,CLOSED,2019-12-23T11:46:27Z,2020-03-27T21:09:51Z,2020-03-27T21:09:50Z,"Hi,

I have a selection of .bam files that I ran snippy on. After it ran, I tried to run snippy-core but it failed with the following error:

ERROR: Could not find .aligned.fa/.vcf in /path/to/folder

Does snippy-core not work with the output of .bam inputs? I also have converted the .bam into fastq but its a single fastq file that cannot be split into R1 and R2. Can i use the single fastq file to run snippy and snippy-core?",peflanag,https://github.com/tseemann/snippy/issues/346
MDU6SXNzdWU1NDI1NzA1OTM=,RNA-seq through snippy,CLOSED,2019-12-26T14:28:56Z,2020-02-21T01:07:37Z,2020-02-21T01:07:37Z,"Hi @tseemann! I'm updating some old code from graduate school for pipelining RNA-seq processing and wanted to add a variant calling layer. Do you think there would be some significant ""gotchas"" for feeding snippy bacterial RNA-seq fastq or BAM files to call variants?

Thanks so much for your time!",biobenkj,https://github.com/tseemann/snippy/issues/347
MDU6SXNzdWU1NDU5MjY0NDQ=,"if nothing is aligning, check your installation version",CLOSED,2020-01-06T20:34:10Z,2020-02-26T04:22:09Z,2020-01-06T20:34:16Z,"Running `conda install -c conda-forge -c bioconda -c defaults snippy` on my machine gave me `3.1`. I had to specifically add `=4.4.5` to the end to get a version that would bother aligning my reads at all. 

just in case anyone else runs into this, I figured i'd leave a note here. ",karoraw1,https://github.com/tseemann/snippy/issues/348
MDU6SXNzdWU1NDg3ODE1Njk=,Old snippy vs new snippy,CLOSED,2020-01-13T08:39:10Z,2020-02-21T01:06:25Z,2020-02-21T01:06:24Z,"I have two versions of snippy, both were installed together with nullarbor, one was via brew (nullarbor v1) and the other via conda (nullarbor v2).

When I analysed the same set of data using both, I got two different results. It seems that snippy in nullarbor v2 is more stringent than the one implemented in nullarbor v1 (higher support for indels in nullarbor v1). May I please find out what modifications that make nullarbor v2 more stringent?

Thank you.",labrat9,https://github.com/tseemann/snippy/issues/349
MDU6SXNzdWU1NDkxNTE1Mzc=,Discrepancy in #SNPs reported among different variant callers,CLOSED,2020-01-13T20:04:54Z,2020-02-21T01:08:50Z,2020-02-21T01:08:38Z,"Hi Torsten, 
This is on the same lines as issue #160 , maybe I'm missing this in the documentation, but is there a way to use previously mapped-sam files from another pipeline (like samtools/bbmap) as input and then use snippy for variant filtering, consensus and downstream alignment?

The reason I ask is because I used bbmap for calling variants and bcftools for downstream filtering, but the results are much more comprehensive than when I re-did the analysis using snippy for the same purpose. There are a lot of vcfs reported in the bbmap results that don't show up in the snippy results, and I was wondering if that was because of the stringency of parameters. So, I thought it would be great if I could use the SNPs previously detected and do the downstream parsing and core phylogenetic analysis with snippy?

Thanks,
Drishti",drish91,https://github.com/tseemann/snippy/issues/350
MDU6SXNzdWU1NTE0NTU3Mzc=,SNIPPY using using genbank with --ref,CLOSED,2020-01-17T14:46:24Z,2020-02-21T01:05:21Z,2020-02-21T01:05:21Z,"Hi Torsten,

I'm currently attempting to run SNIPPY using a genbank file for --ref.  Using all the same data and the equivalent FASTA file for --ref works nicely.  I used the genbank (full) for S. coelicolor downloaded from NCBI:

https://www.ncbi.nlm.nih.gov/nuccore/NC_003888.3

The snps.log file has this warning in it:

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

It fails to generate the usual complement of files giving only:

drwxrwxr-x 4 ubuntu ubuntu       204 Jan 17 12:36 reference
lrwxrwxrwx 1 ubuntu ubuntu        16 Jan 17 12:30 ref.fa -> reference/ref.fa
lrwxrwxrwx 1 ubuntu ubuntu        20 Jan 17 12:30 ref.fa.fai -> reference/ref.fa.fai
-rw-rw-r-- 1 ubuntu ubuntu 687553403 Jan 17 12:36 snps.bam
-rw-rw-r-- 1 ubuntu ubuntu     30624 Jan 17 12:36 snps.bam.bai
-rw-rw-r-- 1 ubuntu ubuntu     17840 Jan 17 12:38 snps.filt.vcf
-rw-rw-r-- 1 ubuntu ubuntu      2731 Jan 17 12:38 snps.log
-rw-rw-r-- 1 ubuntu ubuntu     92317 Jan 17 12:38 snps.raw.vcf
-rw-rw-r-- 1 ubuntu ubuntu         0 Jan 17 12:38 snps.vcf

Any help would be appreciated.
John.

",Munnj90,https://github.com/tseemann/snippy/issues/351
MDU6SXNzdWU1NTI3NjIxNjc=,Snippy-Core --ref,CLOSED,2020-01-21T09:49:15Z,2020-02-21T06:58:02Z,2020-02-21T01:03:45Z,"Hi @tseemann how are you? I'm just wondering, do you have to specify --ref when running snippy-core? I use to because I got this error when I'd leave it out;

<img width=""631"" alt=""Screenshot 2020-01-21 at 09 46 24"" src=""https://user-images.githubusercontent.com/32863969/72793857-e8ccf900-3c32-11ea-937b-0b32825184e1.png"">

But now I am comparing my Snippy.aln file with the output from MTBseq and when I look at the tress using RAxML they are different which I assume is down to the fact of the --ref option?

<img width=""796"" alt=""Screenshot 2020-01-21 at 09 48 02"" src=""https://user-images.githubusercontent.com/32863969/72794023-334e7580-3c33-11ea-8750-179d3c2a676c.png"">
<img width=""963"" alt=""Screenshot 2020-01-21 at 09 48 19"" src=""https://user-images.githubusercontent.com/32863969/72794025-334e7580-3c33-11ea-8695-56b86c6410e5.png"">


I suppose my question is can I remove the reference somehow in snippy?

Cheers.",peflanag,https://github.com/tseemann/snippy/issues/352
MDU6SXNzdWU1NTQzMTcyNjk=,"Error running command, check - BCFtools error?",CLOSED,2020-01-23T18:05:13Z,2020-02-21T01:32:20Z,2020-02-21T01:32:19Z,"Hello, 

I am running snippy 4.4.5. Most of the time everything works perfectly, but for a few samples I get the following output/error: 

snippy --outdir JKS2176_snippy_reads_chromosome --ref JKS2530_chrom.gbk --R1 JKS2176_TruSeq_output_R1_paired.fastq --R2 JKS2176_TruSeq_output_R2_paired.fastq --report --unmapped

[11:55:11] This is snippy 4.4.5
[11:55:11] Written by Torsten Seemann
[11:55:11] Obtained from https://github.com/tseemann/snippy
[11:55:11] Detected operating system: linux
[11:55:11] Enabling bundled linux tools.
[11:55:11] Found bwa - /isg/shared/apps/snippy/4.4.5/bin/bwa
[11:55:11] Found bcftools - /isg/shared/apps/snippy/4.4.5/bin/bcftools
[11:55:11] Found samtools - /isg/shared/apps/snippy/4.4.5/bin/samtools
[11:55:11] Found java - /isg/shared/apps/snippy/4.4.5/bin/java
[11:55:11] Found snpEff - /isg/shared/apps/snippy/4.4.5/bin/snpEff
[11:55:11] Found samclip - /isg/shared/apps/snippy/4.4.5/bin/samclip
[11:55:11] Found seqtk - /isg/shared/apps/snippy/4.4.5/bin/seqtk
[11:55:11] Found parallel - /isg/shared/apps/snippy/4.4.5/bin/parallel
[11:55:11] Found freebayes - /isg/shared/apps/snippy/4.4.5/bin/freebayes
[11:55:11] Found freebayes-parallel - /isg/shared/apps/snippy/4.4.5/bin/freebayes-parallel
[11:55:11] Found fasta_generate_regions.py - /isg/shared/apps/snippy/4.4.5/bin/fasta_generate_regions.py
[11:55:11] Found vcfstreamsort - /isg/shared/apps/snippy/4.4.5/bin/vcfstreamsort
[11:55:11] Found vcfuniq - /isg/shared/apps/snippy/4.4.5/bin/vcfuniq
[11:55:11] Found vcffirstheader - /isg/shared/apps/snippy/4.4.5/bin/vcffirstheader
[11:55:11] Found gzip - /usr/bin/gzip
[11:55:11] Found vt - /isg/shared/apps/snippy/4.4.5/bin/vt
[11:55:11] Found snippy-vcf_to_tab - /isg/shared/apps/snippy/4.4.5/bin/snippy-vcf_to_tab
[11:55:11] Found snippy-vcf_report - /isg/shared/apps/snippy/4.4.5/bin/snippy-vcf_report
[11:55:11] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[11:55:11] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[11:55:11] Checking version: freebayes --version is >= 1.1 - ok, have 1.3
[11:55:12] Checking version: java -version is >= 1.8 - ok, have 1.8
[11:55:12] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[11:55:12] Checking version: bwa is >= 7.12 - ok, have 7.17
[11:55:12] Using reference: /home/CAM/sgoldstein/Paper_3/GATK/JKS2530_chrom.gbk
[11:55:12] Treating reference as 'genbank' format.
[11:55:12] Will use 8 CPU cores.
[11:55:12] Using read file: /home/CAM/sgoldstein/Paper_3/GATK/JKS2176_TruSeq_output_R1_paired.fastq
[11:55:12] Using read file: /home/CAM/sgoldstein/Paper_3/GATK/JKS2176_TruSeq_output_R2_paired.fastq
[11:55:12] Creating folder: JKS2176_snippy_reads_chromosome
[11:55:12] Changing working directory: JKS2176_snippy_reads_chromosome
[11:55:12] Creating reference folder: reference
[11:55:12] Extracting FASTA and GFF from reference.
[11:55:18] Wrote 1 sequences to ref.fa
[11:55:18] Wrote 9804 features to ref.gff
[11:55:18] Creating reference/snpeff.config
[11:55:18] Freebayes will process 15 chunks of 408455 bp, 8 chunks at a time.
[11:55:18] Using BAM RG (Read Group) ID: JKS2176_snippy_reads_chromosome
[11:55:18] Running: samtools faidx reference/ref.fa 2>> snps.log
[11:55:18] Running: bwa index reference/ref.fa 2>> snps.log
[11:55:24] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[11:55:24] Running: ln -sf reference/ref.fa . 2>> snps.log
[11:55:24] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[11:55:24] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[11:55:24] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[11:55:31] Running: bwa mem  -Y -M -R '@RG\tID:JKS2176_snippy_reads_chromosome\tSM:JKS2176_snippy_reads_chromosome' -t 8 reference/ref.fa /home/CAM/sgoldstein/Paper_3/GATK/JKS2176_TruSeq_output_R1_paired.fast
q /home/CAM/sgoldstein/Paper_3/GATK/JKS2176_TruSeq_output_R2_paired.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 7 -m 571M | samtools fixmate -m - - | samtools
 sort -l 0 -T /tmp --threads 7 -m 571M | samtools markdup -T /tmp -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.2 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 539246 sequences (80000087 bp)...
[M::process] read 537702 sequences (80000364 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (61, 228758, 11, 10)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (243, 389, 567)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1215)
[M::mem_pestat] mean and std.dev: (387.36, 218.62)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1539)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (452, 540, 638)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (80, 1010)
[M::mem_pestat] mean and std.dev: (549.15, 137.63)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1196)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (418, 986, 4296)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 12052)
[M::mem_pestat] mean and std.dev: (2106.00, 1929.72)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 15930)
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (548, 1129, 1682)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3950)
[M::mem_pestat] mean and std.dev: (1046.50, 571.63)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 5084)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_pestat] skip orientation RR
[M::mem_process_seqs] Processed 539246 reads in 113.682 CPU sec, 14.375 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[samclip] Processed 300000 records...
[samclip] Processed 400000 records...
[samclip] Processed 500000 records...
[M::process] read 293206 sequences (41854620 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (76, 227657, 3, 12)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (251, 365, 524)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1070)
[M::mem_pestat] mean and std.dev: (371.56, 186.88)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1343)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (455, 544, 643)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (79, 1019)
[M::mem_pestat] mean and std.dev: (553.20, 139.20)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1207)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation RR...
[M::mem_pestat] (25, 50, 75) percentile: (568, 1703, 5552)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 15520)
[M::mem_pestat] mean and std.dev: (2856.08, 2449.58)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 20504)
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RR
[M::mem_process_seqs] Processed 537702 reads in 114.396 CPU sec, 14.331 real sec
[samclip] Processed 600000 records...
[samclip] Processed 700000 records...
[samclip] Processed 800000 records...
[samclip] Processed 900000 records...
[samclip] Processed 1000000 records...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (49, 123429, 1, 1)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (209, 339, 527)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1163)
[M::mem_pestat] mean and std.dev: (356.30, 189.47)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1481)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (459, 547, 648)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (81, 1026)
[M::mem_pestat] mean and std.dev: (557.21, 140.71)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1215)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_process_seqs] Processed 293206 reads in 65.243 CPU sec, 7.987 real sec
[samclip] Processed 1100000 records...
[samclip] Processed 1200000 records...
[samclip] Processed 1300000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @RG\tID:JKS2176_snippy_reads_chromosome\tSM:JKS2176_snippy_reads_chromosome -t 8 reference/ref.fa /home/CAM/sgoldstein/Paper_3/GATK/JKS2176_TruSeq_output_R1_paired.fastq /home/CAM
/sgoldstein/Paper_3/GATK/JKS2176_TruSeq_output_R2_paired.fastq
[main] Real time: 40.336 sec; CPU: 295.372 sec
[samclip] Total SAM records 1376388, removed 42628, allowed 52031, passed 1333760
[samclip] Header contained 3 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 7 in-memory blocks...
[bam_sort_core] merging from 0 files and 7 in-memory blocks...
[11:56:50] Running: samtools index snps.bam 2>> snps.log
[11:56:52] Running: fasta_generate_regions.py reference/ref.fa.fai 408455 > reference/ref.txt 2>> snps.log
[11:56:52] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[11:57:28] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/
DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [n] no fail on reference inconsistency for non SNPs false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa


stats: biallelic
          no. left trimmed                      : 1300
          no. right trimmed                     : 22047
          no. left and right trimmed            : 1773
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. biallelic normalized           : 25120

       multiallelic
          no. left trimmed                      : 0
          no. right trimmed                     : 0
          no. left and right trimmed            : 0
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. multiallelic normalized        : 0

       total no. variants normalized            : 25120
       total no. variants observed              : 48598
       total no. reference observed             : 0

Time elapsed: 2.09s

[11:57:30] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[11:57:42] Running: /isg/shared/apps/snippy/4.4.5/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab 2>> snps.log
[11:57:53] Running: /isg/shared/apps/snippy/4.4.5/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf 2>> snps.log
[11:57:55] Running: bcftools convert -Oz -o snps.vcf.gz snps.vcf 2>> snps.log
[11:57:56] Running: bcftools index -f snps.vcf.gz 2>> snps.log
[11:57:56] Running: bcftools consensus -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz 2>> snps.log
[11:57:57] Error running command, check JKS2176_snippy_reads_chromosome/snps.log

When I check the log file it looks like a BCF tools issue?
[snps.log](https://github.com/tseemann/snippy/files/4104736/snps.log)

Any help getting around this would be great!",sgl07007,https://github.com/tseemann/snippy/issues/353
MDU6SXNzdWU1NjIyNDg4NDU=,Snippy SNP density filtering as an approximation to recombinant SNP removal,OPEN,2020-02-09T22:16:32Z,2020-04-15T19:06:07Z,,"Hello,

I was wondering if Snippy could benefit from having a built-in density filter, such as that employed by SNVPhyl (https://snvphyl.readthedocs.io/en/latest/) and CF-SAN (https://snp-pipeline.readthedocs.io/en/latest/).

One of the major advantages of Snippy in my own use is that it produces (through snippy-core) a pseudo-whole genome alignment (""core.full.aln""), which serves as convenient input to recombination-detection software such as Gubbins and ClonalFrameML -- something that most other pipelines do not. (They focus only on ""core"" SNP alignments)

However, in cases where I have very few samples (e.g. 3) or very many samples (e.g. 500), running Gubbins/ClonalFrameML becomes less practical (time-wise, computational-resource wise, etc.). In such cases, it would be nice to have the option of simply filtering out SNPs in ""dense"" regions -- for example, more than 2 SNPs in a window of 500 bp -- as an approximation of removing SNPs due to recombination using a more sophisticated approach.

I currently use some modified scripts from the CF-SAN pipeline, but it might be nice to have similar functionality built-in to Snippy.

Conrad",cizydorczyk,https://github.com/tseemann/snippy/issues/354
MDU6SXNzdWU1NjIyOTI4Nzc=,Snippy at Galaxy server fails to find SNPs from Fasta contigs,OPEN,2020-02-10T02:43:24Z,2023-10-19T15:50:26Z,,"Hi,

I am trying to find SNPs from WGS contigs dowloaded from NCBI by using snippy available at Galaxy server (https://usegalaxy.org/). However, an error is presented: ""Fatal error: Exit code 2 ()""

I appreciate any help with this problem.


Tool generated the following standard error:
[20:25:49] This is snippy 4.4.5
[20:25:49] Written by Torsten Seemann
[20:25:49] Obtained from https://github.com/tseemann/snippy
[20:25:49] Detected operating system: linux
[20:25:49] Enabling bundled linux tools.
[20:25:49] Found bwa - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/bwa
[20:25:49] Found bcftools - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/bcftools
[20:25:49] Found samtools - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/samtools
[20:25:49] Found java - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/java
[20:25:49] Found snpEff - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/snpEff
[20:25:49] Found samclip - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/samclip
[20:25:49] Found seqtk - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/seqtk
[20:25:49] Found parallel - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/parallel
[20:25:49] Found freebayes - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/freebayes
[20:25:49] Found freebayes-parallel - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/freebayes-parallel
[20:25:49] Found fasta_generate_regions.py - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/fasta_generate_regions.py
[20:25:49] Found vcfstreamsort - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/vcfstreamsort
[20:25:49] Found vcfuniq - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/vcfuniq
[20:25:49] Found vcffirstheader - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/vcffirstheader
[20:25:49] Found gzip - /bin/gzip
[20:25:49] Found vt - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/vt
[20:25:49] Found snippy-vcf_to_tab - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/snippy-vcf_to_tab
[20:25:49] Found snippy-vcf_report - /cvmfs/main.galaxyproject.org/deps/_conda/envs/mulled-v1-8b12e3c0ffd8bb115bc7f1ba98dc3e6f2437163780e6bedf407dfe51c8fc8d1e/bin/snippy-vcf_report
[20:25:50] Need samtools --version >= 1.7 but you have 1.10 - please upgrade it.

",davitero,https://github.com/tseemann/snippy/issues/355
MDU6SXNzdWU1NjMxMDQ0MTI=,paired end and single end,CLOSED,2020-02-11T10:23:19Z,2022-01-10T20:23:43Z,2020-02-16T01:22:15Z,"Dear all,
I have one question, is it possible run snippy at same time with fastq from two different sequence techniques (illumina and iontorrent), that ones are paired end and others are single end??

Thank you for your attention to this matter


Alberto Cebollada",acebollada,https://github.com/tseemann/snippy/issues/356
MDU6SXNzdWU1NjQyMzY1NzQ=,snippy-v4.4.5 compatibility with Samtools-v1.10,CLOSED,2020-02-12T20:01:33Z,2020-02-24T15:57:45Z,2020-02-12T20:48:59Z,"Hello, 

I just noted that there is a new release of Samtools from December. I note that the parse_version function checks for samtools >= 1.7 and notes 1.10 as too low. 

Before I try to manually fix the code locally, just wanted to know if you are aware of any issues with compatibility with this new version of samtools? Similarly, would this be a problem with bcftools-v1.10.2. If so, I'll just use the older versions. 

Best, 

Will",wshropshire,https://github.com/tseemann/snippy/issues/357
MDU6SXNzdWU1Njk0NDY1MDU=,--version should print to STDOUT not STDERR ,CLOSED,2020-02-23T06:32:48Z,2020-02-23T06:38:53Z,2020-02-23T06:38:53Z,https://github.com/bioconda/bioconda-recipes/pull/20448,tseemann,https://github.com/tseemann/snippy/issues/358
MDU6SXNzdWU1NzEwNDE0MDY=,Consider -@ threads for samtools fixmate,CLOSED,2020-02-26T03:17:40Z,2020-03-09T02:56:02Z,2020-03-09T02:56:02Z,Seems to be a single threaded bottleneck,tseemann,https://github.com/tseemann/snippy/issues/359
MDU6SXNzdWU1NzEzMTUyNjA=,Referencing Snippy,CLOSED,2020-02-26T12:30:41Z,2020-02-28T00:01:16Z,2020-02-28T00:01:16Z,"hey @tseemann just wondering how you would like snippy referenced/cited in publications? I cant seem to find anything. 

Cheers.
",peflanag,https://github.com/tseemann/snippy/issues/360
MDU6SXNzdWU1NzIzNTQzNDk=,Question: Multiple Snippy Outputs for Snippy-core,CLOSED,2020-02-27T20:56:14Z,2020-03-02T23:56:25Z,2020-03-02T23:56:25Z,"Hi,

I have a number of folders where I have grouped samples according to clusters and ran snippy followed by snippy-core and generated a newick file in RaxML and then made an MLT. This has resulted in 20 different MLTs. 

However, now I want to make one big tree with all the clusters merged. I assumed I could just take the outputs of snippy and run them all together in snippy-core to get one core.aln file to use in RAxML online to make a newick file and then my MLT in GrapeTree. 

This doesn't seem to have worked in the sense that the output snippy-core file just seems to be identical and doesn't show the different clusters all on one tree. 

Can anyone tell me what I am doing wrong? Hopefully I have made clear what I am trying to do! I basically want a way that if I want to compare different clusters quickly on an MLT I can.

Cheers,

Peter",peflanag,https://github.com/tseemann/snippy/issues/361
MDU6SXNzdWU1NzI3MDg5MTM=,Question: is it ok to use the core.aln file for raxml?,CLOSED,2020-02-28T11:52:02Z,2020-03-04T18:51:15Z,2020-02-29T22:28:25Z,"Hi there,

Very basic question (new to bioinformatics!)

As I understand it, the core.aln file produced by core snippy is a concatenated alignment of your core SNPs, i.e. if I'm working with 200 staph aureus (2.8 MB) isolates, the core.aln file might only be about 8,000 nt long. 

My question is: is it ok to use this file to make a ML tree using raxml? Specifically, does it matter that the scaling on the branches (substitutions per site) won't actually relate to the size of the staph aureus genome?

Thanks,

Megan",mearls999,https://github.com/tseemann/snippy/issues/362
MDU6SXNzdWU1NzM1MTgyMDU=,huge number of variants,CLOSED,2020-03-01T09:59:41Z,2020-03-01T19:50:09Z,2020-03-01T19:29:52Z,"Hi,

I'm kinda new on using **snippy**. I have some WGS bacterial samples that I try to do variant analysis onto.
I use the following dependencies:
**samtools --version is >= 1.7 - ok, have 1.9
bcftools --version is >= 1.7 - ok, have 1.9
freebayes --version is >= 1.1 - ok, have 1.3
java -version is >= 1.8 - ok, have 1.8
snpEff -version is >= 4.3 - ok, have 4.3
bwa is >= 7.12 - ok, have 7.17**

When running snippy on one _Acinetobacter baumannii_ sample I use the following command:
**snippy --cpus 16 --report --outdir sample1_snippy --ref Ab.gbff --contigs sample1/contigs.fa &**

This is a part of the output that I'm getting:
_options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [m] no fail on masked reference inconsistency       false
         [n] no fail on reference inconsistency              false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa


stats: biallelic
          no. left trimmed                      : 85
          no. right trimmed                     : 486
          no. left and right trimmed            : 69
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. biallelic normalized           : 640

       multiallelic
          no. left trimmed                      : 0
          no. right trimmed                     : 0
          no. left and right trimmed            : 0
          no. right trimmed and left aligned    : 0
          no. left aligned                      : 0

       total no. multiallelic normalized        : 0

       total no. variants normalized            : 640
       total no. variants observed              : 46626
       total no. reference observed             : 0_

Therefore, I have some questions I haven't found an answer yet:
1. Why do I get this huge number of variants? 
2. What is the difference between normalized and observed variants? Should I take into account only the normalized ones?
3. How do I select only the normalized ones?

P.S. I use the contigs file as the output from shovill assembly. On the other hand, when using the PE raw reads, I get the same huge number of variants.

Hope you could help me clear these problems.

Thank you so much!

Regards,
Marius",marsurro,https://github.com/tseemann/snippy/issues/363
MDU6SXNzdWU1NzQyNzE3MDE=,min samtools version requirement?,CLOSED,2020-03-02T21:50:39Z,2020-03-09T02:58:07Z,2020-03-09T02:58:07Z,"Hi Torsten,

Is the minimum samtools version now 1.10 for snippy? I'm making a docker image for snippy 4.5.0

The [README](https://github.com/tseemann/snippy#requirements) lists that the min samtools version is >= 1.7, however I received this output upon checking:
```
root@c6e722a63ccf:/data# snippy --check
[21:01:48] This is snippy 4.5.0
[21:01:48] Written by Torsten Seemann
[21:01:48] Obtained from https://github.com/tseemann/snippy
[21:01:48] Detected operating system: linux
[21:01:48] Enabling bundled linux tools.
[21:01:48] Found bwa - /snippy-4.5.0/binaries/linux/bwa
[21:01:48] Found bcftools - /snippy-4.5.0/binaries/linux/bcftools
[21:01:48] Found samtools - /snippy-4.5.0/binaries/linux/samtools
[21:01:48] Found java - /usr/bin/java
[21:01:48] Found snpEff - /snpEff/scripts/snpEff
[21:01:48] Found samclip - /samclip/samclip
[21:01:48] Found seqtk - /usr/local/bin/seqtk
[21:01:48] Found parallel - /usr/bin/parallel
[21:01:48] Found freebayes - /snippy-4.5.0/binaries/linux/freebayes
[21:01:48] Found freebayes-parallel - /snippy-4.5.0/binaries/noarch/freebayes-parallel
[21:01:48] Found fasta_generate_regions.py - /snippy-4.5.0/binaries/noarch/fasta_generate_regions.py
[21:01:48] Found vcfstreamsort - /snippy-4.5.0/binaries/linux/vcfstreamsort
[21:01:48] Found vcfuniq - /snippy-4.5.0/binaries/linux/vcfuniq
[21:01:48] Found vcffirstheader - /snippy-4.5.0/binaries/noarch/vcffirstheader
[21:01:48] Found gzip - /bin/gzip
[21:01:48] Found vt - /vt-0.57721//vt
[21:01:48] Found snippy-vcf_to_tab - /snippy-4.5.0/bin/snippy-vcf_to_tab
[21:01:48] Found snippy-vcf_report - /snippy-4.5.0/bin/snippy-vcf_report
[21:01:48] Need samtools --version >= 1.10 but you have 1.9 - please upgrade it.
root@c6e722a63ccf:/data# samtools --version
samtools 1.9
Using htslib 1.9
Copyright (C) 2018 Genome Research Ltd.
```
If so - could you please update the README :)

Thanks,
Curtis",kapsakcj,https://github.com/tseemann/snippy/issues/364
MDU6SXNzdWU1Nzc2MTE3Nzg=,"--force doesn't delete old snps.log, appends to it",CLOSED,2020-03-09T01:45:24Z,2020-03-09T02:56:08Z,2020-03-09T02:56:08Z,,tseemann,https://github.com/tseemann/snippy/issues/365
MDU6SXNzdWU1ODAwMzUzNjU=,Update taxa name in .consensus.fa and .consensus.subs.fa based on base name of mapped reads,CLOSED,2020-03-12T15:50:32Z,2020-03-15T01:16:54Z,2020-03-15T01:16:46Z,"I noticed that the .consensus.subs.fa and .consensus.fa use the reference name as taxon name in the fasta file preventing a simple *.fasta > msa.fasta operation.  This is relatively easy to address in post analysis, but if it is of general agreement that the base name of the mapped reads file is appropriate, than perhaps this could be included with future updates.  Again... super small, not even an issue, just cleans up the workflow.  Thanks again! ",EpiDemos82,https://github.com/tseemann/snippy/issues/366
MDU6SXNzdWU1ODM2MDQ5ODI=,Core genome snp number and phylogenetic tree,CLOSED,2020-03-18T09:53:10Z,2020-03-27T21:12:42Z,2020-03-27T21:12:42Z,"Hi,
I have run snippy and snippy-core on 30 isolates and generated .aln , .tab, .txt, .vcf files. now, I am interested to know the core genome snp numbers and  generate Phylogenetic tree.
I am sorry if it is naive question as i am new to this.
Thanks in advance!",Galib009,https://github.com/tseemann/snippy/issues/368
MDU6SXNzdWU1ODM2MzU5NDU=,how to know the Number of core genome SNPs,CLOSED,2020-03-18T10:44:40Z,2020-03-20T04:57:59Z,2020-03-20T04:56:01Z,"Hi! 
i used snippy and snippy-core on 30 isolates and generated .aln , .tab , .vcf files.  i just want to know the number of core genome snps.
Thanks in advance.",Galib009,https://github.com/tseemann/snippy/issues/369
MDU6SXNzdWU1ODQ4MTQ2NzU=,"Error running command, check GCF_001622945.1_ASM162294v1_genomic.fna/snps.log",CLOSED,2020-03-20T03:09:18Z,2021-12-23T02:21:57Z,2020-03-20T04:22:38Z,"Please can you help me? I run snippy on bash and on env and I got the same error: 

### echo snippy 4.4.5
### cd /Users/moh

### /Users/moh/anaconda2/envs/snippy_env/bin/snippy --outdir GCF_000189495.1_ASM18949v1_genomic.fna --se /Users/moh/Downloads/genome_assemblies_NCBI_all/ncbi-genomes-2020-03-16 --ref Downloads/06_3228.gb --cpus 6

### samtools faidx reference/ref.fa

[faidx] Could not build fai index reference/ref.fa.fai
",mabouelk,https://github.com/tseemann/snippy/issues/370
MDU6SXNzdWU1ODU5ODk5ODU=,SNP difference between isolates,CLOSED,2020-03-23T07:27:42Z,2020-03-27T21:08:22Z,2020-03-23T10:21:20Z,"Hi,
how to generate the SNP difference between isolates after snippy and snippy-core run like the sample picture ?  
Thanks for this awesome tool! This information will help me describe the difference between two isolates in a clade of phylogeny.

![snp_difference_between_isolates](https://user-images.githubusercontent.com/57619312/77291803-24567300-6d09-11ea-9614-e2b6b7b5ca24.png)

",Galib009,https://github.com/tseemann/snippy/issues/371
MDU6SXNzdWU1ODYzMzE0NTM=,Unable to run snippy-core,CLOSED,2020-03-23T16:16:13Z,2020-09-17T18:21:42Z,2020-09-17T18:21:42Z,"This is snippy-core 4.4.5
Obtained from http://github.com/tseemann/snippy
I tried to merge all samples snps into one using snippy-core with the following command:
```
snippy-core --ref ref.gbff S1 S16 S18 S21 S22 S23 S31 S32 S33 S34 S35 S36 S37 S38 S39 S40 S6 S7
```

Got the following error can you please help me with this?


> /usr/local/bin/any2fasta: 8: /usr/local/bin/any2fasta: Syntax error: newline unexpected
> ERROR: Could not convert ref.gbff to FASTA format",SafinaAr,https://github.com/tseemann/snippy/issues/372
MDU6SXNzdWU1ODg1NTQ5MDU=,snippy-multi unreadable input files,CLOSED,2020-03-26T16:30:48Z,2024-03-05T00:09:05Z,2020-06-11T22:45:50Z,"This is a follow up to issue #279.

https://github.com/tseemann/snippy/issues/279

Hello, I'm encountering this problem today and the above solutions are not working for me. I've tried several strategies of creating the tab file, including om9055's suggestion to make the csv file in MS Word and convert to tab using sed, as well as manually writing the input file using nano in terminal. I was thinking the issue could be with recognizing the full path, but working both on my local cpu and in a supercomputer, the path seems to be found properly but the file is still unreadable. I've also run the --check on snippy and see the dependencies are installed. Any further suggestions for this issue? Thanks!

running the command:
$ snippy-multi input-test7.tab
Reading: input-test7.tab
ERROR: [BS0336] unreadable file '/storage/home/err5/scratch/0336_S1_L001_R1_001_paired.fastq'",emrosenthal17,https://github.com/tseemann/snippy/issues/373
MDU6SXNzdWU1ODk3NDg1MDg=,Using snippy on yeast data?,CLOSED,2020-03-29T08:55:43Z,2020-03-29T23:33:42Z,2020-03-29T23:33:42Z,,sn0001,https://github.com/tseemann/snippy/issues/374
MDU6SXNzdWU1OTA0MDA5ODM=,run snpEFF on core_genome.vcf from fasta by giving genbank,CLOSED,2020-03-30T15:53:46Z,2020-03-31T02:33:05Z,2020-03-31T02:33:05Z,"Hi Torsten,

I was just wondering if there was a way to run snpEFF on core_genome.vcf that was generated from a fasta reference and is therfore unannotated, by giving a genbank reference?

Thanks,

Matt",mattbawn,https://github.com/tseemann/snippy/issues/375
MDU6SXNzdWU1OTQ0Mzg4Mzg=,how to use two gbk files as reference?,CLOSED,2020-04-05T12:47:10Z,2020-04-05T19:21:06Z,2020-04-05T19:21:05Z,"Hi, for Brucella, there are two circular sequences in the cell. How can i merge the two gbk files as one in snippy? Thanks!",mingjuhao,https://github.com/tseemann/snippy/issues/376
MDU6SXNzdWU1OTQ1NTMyODM=,Need samtools --version >= 1.7 but you have 1.10 - please upgrade it.,CLOSED,2020-04-05T16:53:20Z,2020-04-05T19:21:49Z,2020-04-05T16:57:56Z,"when I run snippy, this problem happened. It seems contradictory as the version 1.10 is newer than 1.7, which is needed for snippy. ",mingjuhao,https://github.com/tseemann/snippy/issues/377
MDU6SXNzdWU1OTcxOTA3OTA=,How to input snippy result to PHYLOviz to view the tree?,CLOSED,2020-04-09T10:40:32Z,2020-04-09T22:45:44Z,2020-04-09T22:45:20Z,"I followed every step to the last. However, i can't get a beautiful tree as published in the paper. PHYLOviz is a good viewer and it has the functin to do the snp tree. But the format is different from snippy result. So i am wondering if I can get a tree in PHYLOviz from snippy report? If not, then what software is suitable for snippy? Thanks!",mingjuhao,https://github.com/tseemann/snippy/issues/378
MDU6SXNzdWU1OTc0MDYwODk=,Core genome alignment on a large number of isolates?,OPEN,2020-04-09T16:33:47Z,2020-04-10T09:59:49Z,,"Hello Torsten, 

I wanted to see how much difference does it make to use different alignment strategies for my generated phylogeny (I've used core gene alignment from Roary before). However, default settings on a set of ~ 3000 Salmonella Enteritidis genomes generated core alignment of exactly 2 (out of ~ 4.6M) positions. 

Is this normal? If you include non-AGCT characters (Ns and ""-""s), you get about 50k, which is similar to what I've seen from Roary/mafft, but a lot higher per-sample ""missing"" element then in Roary (I guess that's what happens if you have a reference-based strategy, right)?  Otherwise, what would you say should be the best way to generate core genome alignment for thousands of sequences? 

Thank you, as always.",apredeus,https://github.com/tseemann/snippy/issues/379
MDU6SXNzdWU2MDIyMjYwMjk=,Mask char in snippy-core stats,OPEN,2020-04-17T20:50:49Z,2020-04-17T20:50:49Z,,"I typically run snippy-core with ```--mask-char N``` as my ambiguous character of choice and have been confused about why it always comes back as 0 MASKED positions. And why I have so many LOWCOV positions.

| ID                                  | LENGTH  | ALIGNED | UNALIGNED | VARIANT | HET | MASKED | LOWCOV |
|-------------------------------------|---------|---------|-----------|---------|-----|--------|--------|
| GCA_009295965.1_ASM929596v1_genomic | 4829855 | 4436126 | 23672     | 195     | 377 | 0      | 369680 |
| GCA_009296005.1_ASM929600v1_genomic | 4829855 | 4265802 | 194728    | 213     | 474 | 0      | 368851 |
| GCA_009363195.1_ASM936319v1_genomic | 4829855 | 4433173 | 29291     | 152     | 230 | 0      | 367161 |
| Reference                           | 4829855 | 4472083 | 0         | 0       | 0   | 0      | 357772 |


And then I saw this in snippy-core and suddenly realized my mistake! 
```
# PREFIX.txt file
my @stats = ([ qw(ID LENGTH ALIGNED UNALIGNED VARIANT HET MASKED LOWCOV) ]);
for my $id (@id) {
 push @stats, [
   $id,
   length($out{$id}),
   $out{$id} =~ tr/[AGCTagct]/[AGCTagct]/,
   $out{$id} =~ tr/-/-/,
   $out{$id} =~ tr/[agct]/[agct]/,
   $out{$id} =~ tr/n/n/,
-->$out{$id} =~ tr/X/X/,
-->$out{$id} =~ tr/N/N/,
 ];
}
matrix_to_tsv(""$out_prefix.txt"", \@stats);
```

I'm interpreting this as the stats file counts 'X' char for the MASKED count, and 'N' char for the LOWCOV count? Now running snippy-core with ```--mask-char X```,  I get much more expected counts:

| ID                                  | LENGTH  | ALIGNED | UNALIGNED | VARIANT | HET | MASKED | LOWCOV |
|-------------------------------------|---------|---------|-----------|---------|-----|--------|--------|
| GCA_009295965.1_ASM929596v1_genomic | 4829855 | 4436126 | 23672     | 195     | 377 | 357772 | 11908  |
| GCA_009296005.1_ASM929600v1_genomic | 4829855 | 4265802 | 194728    | 213     | 474 | 357772 | 11079  |
| GCA_009363195.1_ASM936319v1_genomic | 4829855 | 4433173 | 29291     | 152     | 230 | 357772 | 9389   |
| Reference                           | 4829855 | 4472083 | 0         | 0       | 0   | 357772 | 0      |

* Could the stats file counter be read from the variable $mask_char instead of a hard-coded 'X'? (Although I'm now going to use 'X' for masking)
* This happened because I didn't read the documentation fully, and just went on autopilot (""masking"" therefore I want ""N""). Since 'n' and 'N' are reserved characters for het and lowcov sites, could there be a warning if the user tries to use a reserved character for masking? 

Thanks!",ktmeaton,https://github.com/tseemann/snippy/issues/380
MDU6SXNzdWU2MDI5NDA1OTY=,effect of each isolate on snippy-core,OPEN,2020-04-20T04:59:45Z,2020-04-20T05:05:51Z,,"Hi Torsten,

Is there a way to see how each isolate in snippy core effects the size of the core genome? 

Thanks,

Matt",mattbawn,https://github.com/tseemann/snippy/issues/381
MDU6SXNzdWU2MDMwNzg0NTc=,read quality and multiple replicons for input,OPEN,2020-04-20T09:17:50Z,2020-04-22T04:41:51Z,,"Hi, I have looked through the manual and the tutorial but cannot find the answers to my questions. Firstly, how can I input a bacterial genome with multiple large plasmids; do I simply concatenate genbank files of all the replicons? 
[edit: OK, found where you stated the reference file ""can be in multiple contigs"", and I then tested out concatenating 3 genbank entries - and it worked!] 
Secondly, do the input reads need to go through QC and trimming before use in snippy, or can I just throw the raw reads at it and it does the quality assessments for me?
[edit: checked it out, and raw reads seem to work fine - alignments are clean]
Thanks, Mike",mikeds211,https://github.com/tseemann/snippy/issues/382
MDU6SXNzdWU2MDM4NTk5MzA=,"Snippy install ""Can't locate Bio/SeqIO.pm in @INC on version 4.6 conda install",OPEN,2020-04-21T09:44:12Z,2021-08-15T13:37:54Z,,I know this has been a issue previously but it has poped up again on the conda install of version 4.6. Is there a stable version that curently works through conda install?,Rob-murphys,https://github.com/tseemann/snippy/issues/383
MDU6SXNzdWU2MDQ2NTg4NDI=,Combination of gubbins + snps-sites + FastTree for tree calculation,CLOSED,2020-04-22T10:52:27Z,2020-06-08T04:30:20Z,2020-06-04T09:02:54Z,"Hi everyone!
My question relates to the suggested workflow after using snippy-core:
for the detection of recombination in the full length alignment the tool gubbins is suggested. 
this step produces a Max Likelihood phylogenetic tree (by default a with raxML) in the last step which does not contain recombinant regions.
What is the advandage of using snp-sites and FastTree additionally over the ""gubbins tree""?
",Lneffe,https://github.com/tseemann/snippy/issues/384
MDU6SXNzdWU2MDU1MDQ2NzU=,Snippy pipe error at freebayes-parallel,CLOSED,2020-04-23T12:48:09Z,2020-04-23T20:25:25Z,2020-04-23T20:25:25Z,"Hi Torsten,
I am running snippy to target sites on SARS-COV-2 reads with an interleaved sequencing file, however, the pipeline is failing at the freebayes-parallel step.
below is the log file 
### echo snippy 4.6.0
### cd covid

### /shared/software/snippy-4.6.0/bin/snippy --outdir 077 --R1 covid/fastp_report/077_R1.fastq.gz --R2 covid/fastp_report/077_R2.fastq.gz --ref fasta/NC_045512_2_covid_Ref.fasta --cpu 32 --force

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.00 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.01 seconds elapse.
[bwa_index] Update BWT... 0.00 sec
[bwa_index] Pack forward-only FASTA... 0.00 sec
[bwa_index] Construct SA from BWT and Occ... 0.01 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.048 sec; CPU: 0.026 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:077\tSM:077' -t 32 reference/ref.fa /home/mrc.gm/aworwui/covid/fastp_report/077_R1.fastq.gz /home/mrc.gm/aworwui/covid/fastp_report/077_R2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 15 -m 500M | samtools fixmate -m --threads 15 - - | samtools sort -l 0 -T /tmp --threads 15 -m 500M | samtools markdup -T /tmp --threads 15 -r -s - - > snps.bam

READ 1925083 WRITTEN 87184 
EXCLUDED 59465 EXAMINED 1865618
PAIRED 1846948 SINGLE 18670
DULPICATE PAIR 1819264 DUPLICATE SINGLE 18635
DUPLICATE TOTAL 1837899

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 1000 > reference/ref.txt


### freebayes-parallel reference/ref.txt 32 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f6e406ce3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f6e4130ad5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7fea8c5193f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7fea8d155d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f2cc7b233f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f2cc875fd5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7fcd5bb903f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7fcd5c7ccd5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f9a1c1373f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f9a1cd73d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f66206683f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f66212a4d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7feda82683f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7feda8ea4d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f7b6788f3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f7b684cbd5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f915d10d3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f915dd49d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7fc83dbac3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7fc83e7e8d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f7a3edb93f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f7a3f9f5d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7fddcd22b3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7fddcde67d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f176b02e3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f176bc6ad5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f81cfa4a3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f81d0686d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f308d2f43f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f308df30d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f29975453f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f2998181d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f28c183d3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f28c2479d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f280bfe43f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f280cc20d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7fb2c8dc53f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7fb2c9a01d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f002a5ce3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f002b20ad5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f6e05c173f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f6e06853d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f0b36a523f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f0b3768ed5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f22e95dc3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f22ea218d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f513cbce3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f513d80ad5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f0cffa383f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f0d00674d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f18d145b3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f18d2097d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f9af99eb3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f9afa627d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7fb9b74e83f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7fb9b8124d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f5ab279e3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f5ab33dad5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]
Error: signal 11:
freebayes[0x4b91c5]
/lib64/libc.so.6(+0x363f0)[0x7f49bf01a3f0]
/lib64/libpthread.so.0(pthread_mutex_lock+0x5d)[0x7f49bfc56d5d]
freebayes[0x515746]
freebayes[0x51589f]
freebayes[0x4f96f5]
freebayes[0x5022e1]
freebayes[0x4e14e1]
freebayes[0x4dfe01]
freebayes[0x4df955]",Aworwui,https://github.com/tseemann/snippy/issues/385
MDU6SXNzdWU2MDY5NDAyNzg=,How many core SNPs I obtained?,CLOSED,2020-04-26T07:05:48Z,2020-04-26T07:20:10Z,2020-04-26T07:20:10Z,"How many core SNPs I obtained?

Hello, can you to suggest to me, how I can check how many core SNPs I obtained through analysis, for used in phylogenetic tree...
I think, that I can to count nucleotides in core.aln or core.tab files. Is it right?",Asylulan,https://github.com/tseemann/snippy/issues/386
MDU6SXNzdWU2MDgxMDE5NzI=,Parameters for SNPs,CLOSED,2020-04-28T07:50:00Z,2021-02-16T10:42:31Z,2021-02-16T10:42:31Z,,Katharina19,https://github.com/tseemann/snippy/issues/387
MDU6SXNzdWU2MTMxMjcyMTE=,Snippy core VCF / alignment,CLOSED,2020-05-06T08:03:58Z,2020-06-06T09:16:07Z,2020-05-12T03:48:17Z,"Hey all, are the number of sites in the `VCF` output from `snippy-core` always the same as the number of sites in the output alignment, (`core.aln`) or can there be a difference? I process some things downstream and just want to make sure that it works from the `VCF` directly.

Thanks so much, always a pleasure to use `Snippy` :)",esteinig,https://github.com/tseemann/snippy/issues/388
MDU6SXNzdWU2MTM2OTI2ODQ=,Core SNP phylogeny,CLOSED,2020-05-07T00:27:14Z,2020-05-20T19:50:26Z,2020-05-07T01:09:42Z,"

I have run the following command and got an issue. How can I solve it?

$ '/home/genomic-lab/anaconda3/envs/pyppi/bin/run_gubbins.py' -p gubbins clean.full.aln

--- Gubbins 2.4.1 ---

Croucher N. J., Page A. J., Connor T. R., Delaney A. J., Keane J. A., Bentley S. D., Parkhill J., Harris S.R. ""Rapid phylogenetic analysis of large samples of recombinant bacterial whole genome sequences using Gubbins"". Nucleic Acids Res. 2015 Feb 18;43(3):e15. doi: 10.1093/nar/gku1196.

Checking dependencies...
...done. Run time: 0.02 s

Checking input files...
Error with input FASTA file: you need more than 3 sequences to build a meaningful tree
Each sequence must have a name and some genomic data
There input alignment file does not exist or has an invalid format

Best,
Hussain",hjafar,https://github.com/tseemann/snippy/issues/389
MDU6SXNzdWU2MTUyNzIxMjI=,how to parse all of the variants for specific gene/product in over than 2000 viral genomes sequences,CLOSED,2020-05-09T22:27:10Z,2020-05-18T02:09:02Z,2020-05-18T02:09:02Z,"Hi, 

I got the output for each viral genome with the annotation but I am interested in one gene and I need to know all of the Variant for this specific gene/product among all of the samples. 

",mabouelk,https://github.com/tseemann/snippy/issues/390
MDU6SXNzdWU2MTU2MDE3NDY=,Error running command,CLOSED,2020-05-11T05:36:10Z,2020-05-11T07:37:52Z,2020-05-11T07:37:52Z,"Hi, tseemann, thanks for your great snippy!
It all worked well several days ago. However, it stopped here today. Even i ran the same sequences as before. It also happened.
[13:25:00] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[13:25:02] Error running command, check yujiaosnp/snps.log
the snps.log said this:
### cd /home/hao/hao/Sequencingdata/cleanfq/yujiao

### /home/hao/anaconda3/bin/snippy --cpus 16 --outdir yujiaosnp --ref pseudomonas_aeruginosa.gbk --R1 CRPA-011_1.fq.gz --R2 CRPA-011_2.fq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.07 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.11 seconds elapse.
[bwa_index] Update BWT... 0.05 sec
[bwa_index] Pack forward-only FASTA... 0.04 sec
[bwa_index] Construct SA from BWT and Occ... 0.82 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 3.499 sec; CPU: 3.088 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:yujiaosnp\tSM:yujiaosnp' -t 16 reference/ref.fa /home/hao/hao/Sequencingdata/cleanfq/yujiao/CRPA-011_1.fq.gz /home/hao/hao/Sequencingdata/cleanfq/yujiao/CRPA-011_2.fq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/s
nippy.9632. --threads 16 -m 500M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.9632. --threads 16 -m 500M | samtools markdup -T /tmp/snippy.9632. -r -s - - > snps.bam

READ 6562203 WRITTEN 6185685 
EXCLUDED 874360 EXAMINED 5687843
PAIRED 5620138 SINGLE 67705
DULPICATE PAIR 346866 DUPLICATE SINGLE 29652
DUPLICATE TOTAL 376518

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 205447 > reference/ref.txt


### freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf

Thanks for your response!

",mingjuhao,https://github.com/tseemann/snippy/issues/391
MDU6SXNzdWU2MTYyOTYwOTQ=,The fasta sequence does not match the REF allele,OPEN,2020-05-12T01:43:20Z,2020-05-15T00:32:23Z,,"Hi Torsten,

I am trying to run snippy-core. However, the whole pipeline is breaking because of one sample: ""ERROR: Could not find .aligned.fa/.vcf in ATGCGCAG_AGAGGATA"" 

I have uploaded the logfile for the entire run and the snp.log file for the problematic sample:
https://gist.github.com/annasimonsen/f662306d49cd5aa5eb081556248639fd

Inspection of the snp.log file shows that there appears to be a snp variant at the exact same location as an insertion, which seems to be changing the reference allele in the vcf file and causing discordance: 
The fasta sequence does not match the REF allele at 1:3749549:
   .vcf: [A]
   .vcf: [AGC] <- (ALT)
   .fa:  [C]TGACGGAGCCCCGATGAGTGCCCGCTGCTCGTGCGGCGGCCGGAATGCCGGTGACCGAATAGGCCGCGCAGGCCCGCCAGTCGACCTCTC

I know that this has been an error message with pipelines that use bcf tools in general. Can you make any recommendations on how to make snippy-core run to completion?   ",annasimonsen,https://github.com/tseemann/snippy/issues/392
MDU6SXNzdWU2MjEwNzk3MDY=,Error: Failed to set region: ; ERROR(freebayes): Could not SetRegion,CLOSED,2020-05-19T15:35:15Z,2020-05-20T14:26:05Z,2020-05-20T04:23:52Z,"Here are the details of my error. My command was ""snippy --outdir mysnps --ref test.gbk --ctgs sequence.fna""

### cd /home/shaminur/snippy/novoSNP

### /home/shaminur/miniconda3/bin/snippy --outdir mysnps --ref test.gbk --ctgs sequence.fna

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.00 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.07 seconds elapse.
[bwa_index] Update BWT... 0.00 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.05 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.466 sec; CPU: 0.140 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:mysnps\tSM:mysnps' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/snippy.15123. --threads 8 -m 1000M | samtools fixmate -m - - | samtools sort -l 0 -T /tmp/snippy.15123. --threads 8 -m 1000M | samtools markdup -T /tmp/snippy.15123. -r -s - - > snps.bam

READ 0 WRITTEN 0 
EXCLUDED 0 EXAMINED 0
PAIRED 0 SINGLE 0
DULPICATE PAIR 0 DUPLICATE SINGLE 0
DUPLICATE TOTAL 0

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 11878 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 10 --min-repeat-entropy 1.5 --strict-vcf -q 13 -m 60 --min-coverage 10 -F 0.05  -f reference/ref.fa snps.bam > snps.raw.vcf

Error: Failed to set region: -1:0-11,878(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:0..11878
Error: Failed to set region: -1:11,878-23,756(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:11878..23756
Error: Failed to set region: -1:23,756-35,634(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:23756..35634
Error: Failed to set region: -1:35,634-47,512(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:35634..47512
Error: Failed to set region: -1:47,512-59,390(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:47512..59390
Error: Failed to set region: -1:59,390-71,268(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:59390..71268
Error: Failed to set region: -1:71,268-83,146(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:71268..83146
Error: Failed to set region: -1:83,146-95,024(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:83146..95024
Error: Failed to set region: -1:95,024-106,902(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:95024..106902
Error: Failed to set region: -1:106,902-118,780(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:106902..118780
Error: Failed to set region: -1:118,780-130,658(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:118780..130658
Error: Failed to set region: -1:130,658-142,536(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:130658..142536
Error: Failed to set region: -1:142,536-154,414(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:142536..154414
Error: Failed to set region: -1:154,414-166,292(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:154414..166292
Error: Failed to set region: -1:166,292-175,210(*)
ERROR(freebayes): Could not SetRegion to LBB_contig000001:166292..175210

### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -t -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf

Error: Multi-threaded opton not supported in this version!

SnpEff version SnpEff 4.5covid19 (build 2020-04-15 22:26), by Pablo Cingolani
Usage: snpEff [command] [options] [files]

Run 'java -jar snpEff.jar command' for help on each specific command

Available commands: 
	[eff|ann]                    : Annotate variants / calculate effects (you can use either 'ann' or 'eff', they mean the same). Default: ann (no command or 'ann').
	build                        : Build a SnpEff database.
	buildNextProt                : Build a SnpEff for NextProt (using NextProt's XML files).
	cds                          : Compare CDS sequences calculated form a SnpEff database to the one in a FASTA file. Used for checking databases correctness.
	closest                      : Annotate the closest genomic region.
	count                        : Count how many intervals (from a BAM, BED or VCF file) overlap with each genomic interval.
	databases                    : Show currently available databases (from local config file).
	download                     : Download a SnpEff database.
	dump                         : Dump to STDOUT a SnpEff database (mostly used for debugging).
	genes2bed                    : Create a bed file from a genes list.
	len                          : Calculate total genomic length for each marker type.
	pdb                          : Build interaction database (based on PDB data).
	protein                      : Compare protein sequences calculated form a SnpEff database to the one in a FASTA file. Used for checking databases correctness.
	seq                          : Show sequence (from command line) translation.
	show                         : Show a text representation of genes or transcripts coordiantes, DNA sequence and protein sequence.
	translocReport               : Create a translocations report (from VCF file).

Generic options:
	-c , -config                 : Specify config file
	-configOption name=value     : Override a config file option
	-d , -debug                  : Debug mode (very verbose).
	-dataDir <path>              : Override data_dir parameter from config file.
	-download                    : Download a SnpEff database, if not available locally. Default: true
	-nodownload                  : Do not download a SnpEff database, if not available locally.
	-h , -help                   : Show this help and exit
	-noLog                       : Do not report usage statistics to server
	-q , -quiet                  : Quiet mode (do not show any messages or errors)
	-v , -verbose                : Verbose mode
	-version                     : Show version number and exit

Database options:
	-canon                       : Only use canonical transcripts.
	-canonList <file>            : Only use canonical transcripts, replace some transcripts using the 'gene_id 	 transcript_id' entries in <file>.
	-interaction                 : Annotate using inteactions (requires interaciton database). Default: true
	-interval <file>             : Use a custom intervals in TXT/BED/BigBed/VCF/GFF file (you may use this option many times)
	-maxTSL <TSL_number>         : Only use transcripts having Transcript Support Level lower than <TSL_number>.
	-motif                       : Annotate using motifs (requires Motif database). Default: true
	-nextProt                    : Annotate using NextProt (requires NextProt database).
	-noGenome                    : Do not load any genomic database (e.g. annotate using custom files).
	-noExpandIUB                 : Disable IUB code expansion in input variants
	-noInteraction               : Disable inteaction annotations
	-noMotif                     : Disable motif annotations.
	-noNextProt                  : Disable NextProt annotations.
	-onlyReg                     : Only use regulation tracks.
	-onlyProtein                 : Only use protein coding transcripts. Default: false
	-onlyTr <file.txt>           : Only use the transcripts in this file. Format: One transcript ID per line.
	-reg <name>                  : Regulation track to use (this option can be used add several times).
	-ss , -spliceSiteSize <int>  : Set size for splice sites (donor and acceptor) in bases. Default: 2
	-spliceRegionExonSize <int>  : Set size for splice site region within exons. Default: 3 bases
	-spliceRegionIntronMin <int> : Set minimum number of bases for splice site region within intron. Default: 3 bases
	-spliceRegionIntronMax <int> : Set maximum number of bases for splice site region within intron. Default: 8 bases
	-strict                      : Only use 'validated' transcripts (i.e. sequence has been checked). Default: false
	-ud , -upDownStreamLen <int> : Set upstream downstream interval length (in bases)",SShaminur,https://github.com/tseemann/snippy/issues/393
MDU6SXNzdWU2MjIzNDg4ODY=,snippy --check samtools,CLOSED,2020-05-21T08:45:47Z,2020-05-21T09:17:42Z,2020-05-21T09:17:34Z,May I ask where is the path for calling samtools and other software limited?,ytao0210,https://github.com/tseemann/snippy/issues/394
MDU6SXNzdWU2MjMwMTg4NzU=,snippy --check ,CLOSED,2020-05-22T07:39:21Z,2020-06-04T07:26:59Z,2020-06-04T07:26:59Z,"$snippy --check

Found freebayes - /hwfssz5/ST_MCHRI/BIGDATA/USER/taoye1/snippy_HP/snippy-master/binaries/linux/freebayes

FATAL: kernel too old
Could not read output of 'freebayes --version'

Installed low version of freebayes
file freebayes
freebayes: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, not stripped

The kernel version of linux meets the requirements.

Why is there the same problem as above?
",ytao0210,https://github.com/tseemann/snippy/issues/395
MDU6SXNzdWU2MjgwMDQ5OTA=,Strain(s)-specific SNPs from snippy output files,CLOSED,2020-05-31T17:17:44Z,2020-05-31T21:49:08Z,2020-05-31T21:49:08Z,"Hi Torsten, 
I was wondering how it is possible to parse snippy output files to identify strain(s)-specific SNPs?
I am looking for SNPs which are unique in one strain (or a group of strains) and different in all other strains.   
Thanks and regards, ",MostafaYA,https://github.com/tseemann/snippy/issues/396
MDU6SXNzdWU2MzEyODY1MjU=,is snippy suitable for RNA-seq,CLOSED,2020-06-05T03:36:53Z,2020-06-05T04:11:17Z,2020-06-05T04:11:17Z,is snippy suitable for RNA-seq,huangl07,https://github.com/tseemann/snippy/issues/397
MDU6SXNzdWU2MzI0MDgyMzQ=,real reads versus simulated reads ,OPEN,2020-06-06T11:53:00Z,2020-06-08T00:44:17Z,,"Hi Torsten,

Lots of bacterial genomes are lacking SRA data, preventing us from performing several reads-based analysis. I think you mentioned somewhere that ""best reads are contigs"", and do you reckon simulated reads generated from the assembly (perfect reads, no error, perfectly even coverage) should be used in Snippy even if we do have the real reads. 

I've run some tests to see if they are significantly different (simulated reads were generated from Shovill-assembled genome with the same read length and coverage as that of the real reads) and the answer is ""yes"". I found more variants including SNP were detected by Snippy using simulated reads compared with using the real reads. So it makes me wondering which one is closer to the truth.

Thanks

Yu",fengyuchengdu,https://github.com/tseemann/snippy/issues/398
MDU6SXNzdWU2MzMzNzc3MjY=,Error: Multi-threaded opton not supported in this version!,CLOSED,2020-06-07T12:38:09Z,2020-06-07T22:15:16Z,2020-06-07T22:14:41Z,"Snippy failed with this error message: [Sample_snippy_log.log](https://github.com/tseemann/snippy/files/4741987/Sample_snippy_log.log). Something happened with this snpEff version: `SnpEff version SnpEff 4.3t (build 2017-11-24 10:18), by Pablo Cingolani`

This is my java version: 
```
openjdk version ""1.8.0_192""
OpenJDK Runtime Environment (Zulu 8.33.0.1-linux64) (build 1.8.0_192-b01)
OpenJDK 64-Bit Server VM (Zulu 8.33.0.1-linux64) (build 25.192-b01, mixed mode)
```

I followed previous issues and couldn't solve it. What should I do? Thanks for your response!
",ireneortega,https://github.com/tseemann/snippy/issues/399
MDU6SXNzdWU2Mzg2MDE5MjQ=,ERROR: Could not run: snp-sites -c -o core.aln core.full.aln,CLOSED,2020-06-15T07:08:33Z,2020-09-03T09:20:33Z,2020-06-15T07:30:33Z,"Hello,

I ran a snippy job with the 4.4.0 version and got the following messages at the end:
Opening: core.tab
Opening: core.vcf
Processing contig: CP028357.1
Generating core.full.aln
Creating TSV file: core.txt
Running: snp-sites -c -o core.aln core.full.aln
Warning: No SNPs were detected so there is nothing to output.
ERROR: Could not run: snp-sites -c -o core.aln core.full.aln

I know there should be some SNPs as I ran the 4.1.0 version few months ago on the same dataset minus 5 genomes. 

tried to relaunch the snp-sites -c -o core.aln core.full.aln alone but got the same error. 

Is there a trick to avoid launching the entire analysis on the dataset (125 genomes) or do I have to redo the whole thing ?

options used:
snippy-multi ../listesnippy_120620.txt --ref ../ref201001922.fasta --mapqual 60 --basequal 13 --mincov 4 --minfrac 0.75 --cpus=12 > multi.sh

Thanx for your help !",letQOD,https://github.com/tseemann/snippy/issues/400
MDU6SXNzdWU2Mzg4NTE2OTA=,full.aln or .aln for newick/tree building,CLOSED,2020-06-15T13:24:48Z,2020-06-16T08:21:15Z,2020-06-15T19:52:25Z,"Hi,

I am trying to run snippy-core on a couple of Staph sequences. I have the sequences grouped by ST and ran snippy on them all and now I am running snippy-core. The only issue is whit some, the SNPs=0.

I know I have been told before to remove them and run again cause SNPs aren't called with them but how do i represent this on a tree? Is there a way to force snippy to lave them there so they are also on a tree? otherwise how to I represent the fact that there is no SNPs and they are identical? Should I use the full.aln file to make a newick rather than the .aln file?

I'm kind of at a loss and maybe I am not asking the right question! Any help would be great, cheers!

<img width=""711"" alt=""Screenshot 2020-06-15 at 14 02 15"" src=""https://user-images.githubusercontent.com/32863969/84662636-fd789900-af13-11ea-9985-98cf6fbf5c53.png"">",peflanag,https://github.com/tseemann/snippy/issues/401
MDU6SXNzdWU2NTA3ODE4MjQ=,Snippy without reference (suggestion),OPEN,2020-07-03T22:21:40Z,2020-07-03T22:22:14Z,,"I've been looking for a SNP-caller that does not depend on a reference genome.

How hard would it be make snippy work on the core genome of a set of microbial isolates? We can probably assume that the most common variants are ancestral.

This might be useful, if a reference is not representative of a isolate set.

Do you think it would make any sense?

Cheers, Carl.
",cmkobel,https://github.com/tseemann/snippy/issues/402
MDU6SXNzdWU2NTE0MjE0MzE=,Missing SNP,OPEN,2020-07-06T10:16:25Z,2020-07-07T01:49:31Z,,"I ran snippy and found that one of the samples did not call the target SNP. Upon performing samtools mpileup, I found that the missing SNP had the following flag:

DP=981;VDB=2.15032e-10;SGB=-0.693147;RPB=0.968173;MQB=0.321974;MQSB=0.397088;BQB=0.0320424;MQ0F=0;AC=2;AN=2;DP4=7,0,447,123;MQ=57   GT:PL   1/1:255,255,0

I have added the --mapqual 30 flag in my snippy command but still cannot rescue the SNP.

Would you be able to help please? Thank you!",labrat9,https://github.com/tseemann/snippy/issues/403
MDU6SXNzdWU2NTU0NjE5MTc=,Minimum set of files to calculate core?,CLOSED,2020-07-12T19:30:50Z,2020-07-24T15:39:43Z,2020-07-24T15:39:42Z,"Hi!
Has the requirement of only keeping snps.aligned.fa and snps.tab changed? I was just going to calculate the core genome of a very large number of genomes so I removed all what I thought were unnecessary files so that the guys hosting our HPC would not be angry at me for creating a gzillion files. But now when I ran snippy-core I got ""ERROR: Could not read VCF 'VIB_AA0002AA_AS/snps.vcf'"". Do I also need to save the vcf files and are there other files that are required as well?
Best wishes,
Kaisa

_Originally posted by @thorellk in https://github.com/tseemann/snippy/issues/114#issuecomment-657265085_",thorellk,https://github.com/tseemann/snippy/issues/404
MDU6SXNzdWU2NTg2NDk1ODY=,snippy-core replacing variant bases with reference in some cases but not others,OPEN,2020-07-16T23:08:08Z,2020-07-17T17:50:14Z,,"So this one is a bit of a weird and long one. I am using snippy v. 4.6.0 installed through conda in a centos based system. The datasets I am using here are quite large so if you want them I can package them up and send them separately.  I am performing a population level SNP analysis for a low diversity Salmonella serotype with about 4800 samples. As part of this analysis I want to identify duplicate and highly similar sequences for removal to establish the population structure. I have mapped all of the samples against a common reference and called variants using snippy v. 4.6.0 and then ran snippy-core to produce the core alignment. Since there are poor quality sequences in this set I end up with a cor of 0 which is fine for my purposes since I want to run snp-sites on core.full.aln without the -c parameter to identify sequence which are disruptive by looking at how many times a given sequence introduces a gap in an otherwise good position. I would then remove the worst offenders, rinse and repeat. I noticed an issue that 2500 of my samples formed a 0 snp cluster with no variability between them.

So I began testing some subsets of the data and noticed new positions pop up as variant in the vcf files produced by snp-sites which were not in the original set.  To generate a subset, I would run snippy-core on the specific samples I was interested in. I use the same --ref and --mask parameters between runs, the only difference is the samples included. It would make sense to loose variants but not to gain them since snp-sites should report all variant sites regardless of how many sequences were missing a base, as long as there was variation at that site. I tested snp-sites with a synthetic reference sequence which had all of the bases swapped A=>T, T=>A, C=> G, G=> C to produce a sequence where 100% of the sites were variable compared to the reference. When I add this synthetic sequence to the ~4800 sample snippy-core core.full.aln, I indeed get a vcf with all positions as variant. So snp-sites is behaving as expected

I ran snippy-core on just the set of samples which formed a 0 snp cluster with the reference sequence. I looked at the variant positions in my smaller subset and tested one position which was variant in the subset but not in the 4800 snippy-core. In the 4800 set it has a reference base  T and in the subset snippy-core it has a base C for position 598. So the snippy-core produced on the complete set was actually different from the subset one.

I then tested that one sample that had the non-reference base and put it with the other sequences which did not form a 0 snp cluster with the reference. When I ran snippy-core in this case, then the sample had the reference base instead of the variant one.

I whittled down the comparison to two samples from the sra. When SRR1996191 is run with SRR5574766 in snippy-core, it causes SRR5574766 to have the reference base instead of its variant base at position 598 of NZ_CP012921. 

snippy-core --ref NZ_CP012921. fasta --mask=Heidelberg.reference.mask.bed SRR1996191/ SRR5574766/

-- The mask file starts at position 57813 so I wouldn't expect it to be the cause of the issue and I tested not including the mask file and it didn't affect the results.

I looked at the individual vcf for SRR5574766 
NZ_CP012921.1	598	.	G	T	1845.38	.	AB=0;ABP=0;AC=2;AF=1;AN=2;AO=60;CIGAR=1X;DP=60;DPB=60;DPRA=0;EPP=5.32654;EPPR=0;GTI=0;LEN=1;MEANALT=1;MQM=60;MQMR=0;NS=1;NUMALT=1;ODDS=87.7828;PAIRED=0.833333;PAIREDR=0;PAO=0;PQA=0;PQR=0;PRO=0;QA=2118;QR=0;RO=0;RPL=34;RPP=5.32654;RPPR=0;RPR=26;RUN=1;SAF=16;SAP=31.3842;SAR=44;SRF=0;SRP=0;SRR=0;TYPE=snp	GT:DP:AD:RO:QR:AO:QA:GL	1/1:60:0,60:0:0:60:2118:-190.86,-18.0618,0

and SRR1996191 there is nothing in the vcf until position 57605

When I look at the aligned.fa for SRR1996191 there is reference bases 565 and 566 but then N's until 603. So I am not sure why snippy-core is changing the variant base call for sequences to the reference base when it is run with this sequence.

This is only a single example but there were thousands of bases affected in the original set.  ",jrober84,https://github.com/tseemann/snippy/issues/405
MDU6SXNzdWU2NTg4MzQwMjg=,Get bug with  snippy-core ,OPEN,2020-07-17T04:14:59Z,2020-07-17T04:14:59Z,,"Hi @tseemann 
I use my previous command that worked well with my previous ubuntu and conda environment. The command is   snippy-core --ref K96243.gb 10-*

When use this command with snippy version 3.2, I got a bug like this. 

[11:00:29] Loading Snippy folders
[11:00:29] Using ID '10-001' for 10-001 
[11:00:29] 10-001: found 20359 variants totalling 23606 bp in 10-001/snps.tab
[11:00:29] Using provided reference: K96243.gb

------------- EXCEPTION -------------
MSG: The sequence does not appear to be FASTA format (lacks a descriptor line '>')
STACK Bio::SeqIO::fasta::next_seq /home/nc-bioinfo/anaconda3/lib/perl5/site_perl/5.22.0/Bio/SeqIO/fasta.pm:136
STACK toplevel /home/nc-bioinfo/anaconda3/bin/snippy-core:44
-------------------------------------


Thanks in advance",Rathanin-github,https://github.com/tseemann/snippy/issues/406
MDU6SXNzdWU2NjE5MjgwNDc=,ploidy set to 2? And failing at bcftools consensus ,OPEN,2020-07-20T15:04:05Z,2022-07-21T07:03:29Z,,"Hey, I have 2 inquiries. I am running snippy to detect variance between multiple copies of the same part of a bacterial genome.
1. I saw the log (attached) of snippy and noticed the following command is being executed for freebayes-parallel:
`freebayes-parallel reference/ref.txt 35 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf`
the key thing is the `-p 2` since snippy is for haploid genomes shouldn't this be `-p 1` or is `-p 2` is being used intentionally and the pipeline has been modified according to that? 
2. While running snippy, it is failing at bcftools consensus step (log and std error attached). For some reason, snippy is taking the specified `outdir` as an input for the `--sample` flag.

Command used:
`snippy --cpus 35 --ram 100  --outdir trial5_with_bam_BQRS_tmp_deleted_snippy_4.6 --ref ~/ext_project/NP_pathway.fasta --bam ~/ext_project/SNP_calculation/trial_2/NP_seq_aligned_sorted_markedDup_BQSR.bam
`

[snps.log](https://github.com/tseemann/snippy/files/4948446/snps.log)
[snippyerr.txt](https://github.com/tseemann/snippy/files/4948448/snippyerr.txt)
[dependencies.txt](https://github.com/tseemann/snippy/files/4948490/dependencies.txt)

Thanks :smile: ",Sidduppal,https://github.com/tseemann/snippy/issues/407
MDU6SXNzdWU2NjIwNDY3MjM=,"""Variant is not consistent: U00096.3:965-968 - TGCT(REF) vs (FASTA)"" error",OPEN,2020-07-20T17:02:29Z,2021-03-23T10:39:35Z,,"Hello @tseemann and all users,

I am running snippy with basic configurations and keep getting the following error (even when change the reference from FASTA to GenBank):

[variant_manip.cpp:75 is_ref_consistent] Variant is not consistent: U00096.3:965-968 - TGCT(REF) vs (FASTA)
[normalize.cpp:178 normalize] Normalization not performed due to inconsistent reference sequences. (use -n option to relax this)
[main_vcfview] Error: cannot write to (null)

The result is always ""Identified 0 variants"", needless to say that the target species is present in high abundance in the sample. 
I might be missing something, any help is much appreciated.


Thank you very for the assistance,
Best regards
Vadim",VadimDu,https://github.com/tseemann/snippy/issues/408
MDU6SXNzdWU2NjI2OTc2MTU=,Trim reads for Snippy?,OPEN,2020-07-21T07:34:52Z,2020-07-21T07:34:52Z,,"I trimmed the reads using trimmomatic first and tried to run Snippy. However, I am surprised  to find out the snippy does not take both paired-end reads and unpaired ones together. It says
""Can not mix read file types. Either (1) --R1 (2) --se (3) --peil (4) --ctgs (5) --bam""
However, I do not want to discard the un-paired reads because there are quite a lot. 
(See the trimmomatic resut:  Input Read Pairs: 687438 Both Surviving: 509184 (74.07%) Forward Only Surviving: 157556 (22.92%) Reverse Only Surviving: 5313 (0.77%) Dropped: 15385 (2.24%))
Is it a better way that I try to merge the paired end reads and do the trim  and supply them as --se for snippy?
I did not find similar question posted before.... Did you guys not trim raw reads before supply to snippy?
Please kindly suggest,
Xianghui


Here is the error messge.
/gpfs0/scratch/xianghui/software/snippy-4.6.0/bin/snippy --outdir acrA_S15_mysnps --reference GCA_004355105.1_ASM435510v1_genomic.fasta --R1 acrA_S15_R1_paired.fq.gz  --R2 acrA_S15_R2_paired.fq.gz --se acrA_S15_R1_unpaired.fq.gz, acrA_S15_R2_unpaired.fq.gz
[14:58:17] This is snippy 4.6.0
[14:58:17] Written by Torsten Seemann
[14:58:17] Obtained from https://github.com/tseemann/snippy
[14:58:17] Detected operating system: linux
[14:58:17] Enabling bundled linux tools.
[14:58:17] Found bwa - /home/xianghui/anaconda3/bin/bwa
[14:58:17] Found bcftools - /gpfs0/scratch/xianghui/software/bcftools-1.9/bcftools
[14:58:17] Found samtools - /gpfs0/scratch/xianghui/software/samtools-1.9/samtools
[14:58:17] Found java - /home/xianghui/anaconda3/bin/java
[14:58:17] Found snpEff - /gpfs0/scratch/xianghui/software/snippy-4.6.0/binaries/noarch/snpEff
[14:58:17] Found samclip - /gpfs0/scratch/xianghui/software/snippy-4.6.0/binaries/noarch/samclip
[14:58:17] Found seqtk - /home/xianghui/software/bin/seqtk
[14:58:17] Found parallel - /home/xianghui/anaconda3/bin/parallel
[14:58:17] Found freebayes - /home/xianghui/anaconda3/bin/freebayes
[14:58:17] Found freebayes-parallel - /home/xianghui/anaconda3/bin/freebayes-parallel
[14:58:17] Found fasta_generate_regions.py - /home/xianghui/anaconda3/bin/fasta_generate_regions.py
[14:58:17] Found vcfstreamsort - /home/xianghui/anaconda3/bin/vcfstreamsort
[14:58:17] Found vcfuniq - /home/xianghui/anaconda3/bin/vcfuniq
[14:58:17] Found vcffirstheader - /home/xianghui/anaconda3/bin/vcffirstheader
[14:58:17] Found gzip - /usr/bin/gzip
[14:58:17] Found vt - /gpfs0/scratch/xianghui/software/snippy-4.6.0/binaries/linux/vt
[14:58:17] Found snippy-vcf_to_tab - /gpfs0/scratch/xianghui/software/snippy-4.6.0/bin/snippy-vcf_to_tab
[14:58:18] Found snippy-vcf_report - /gpfs0/scratch/xianghui/software/snippy-4.6.0/bin/snippy-vcf_report
[14:58:18] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[14:58:18] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[14:58:18] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.2
[14:58:18] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[14:58:18] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[14:58:18] Using reference: /gpfs0/scratch/xianghui/software/Oishi/GCA_004355105.1_ASM435510v1_genomic.fasta
[14:58:18] Treating reference as 'fasta' format.
[14:58:18] Will use 8 CPU cores.
[14:58:18] Can not mix read file types. Either (1) --R1 (2) --se (3) --peil (4) --ctgs (5) --bam
",liuxianghui,https://github.com/tseemann/snippy/issues/409
MDU6SXNzdWU2NjQ5NDMwNDM=,get 0 variant after snippy,OPEN,2020-07-24T06:14:57Z,2021-07-06T23:01:35Z,,"Hi @tseemann 
When I update my snippy to 4.6.0, I got 0 varaint after runing. snps.csv contain nothing. Please see my snps.log below
Your response is greatly apriciate !

### echo snippy 4.6.0
### cd /mnt/e/test4/17A

### /home/nc-bioinfo/anaconda3/envs/snippy/bin/snippy --outdir mysnps17A.fa --ref K96243.fasta -R1 60-101_S1_L001_R1_001.fastq.gz -R2 60-101_S1_L001_R2_001.fastq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.05 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.41 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.02 sec
[bwa_index] Construct SA from BWT and Occ... 0.50 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 4.973 sec; CPU: 2.000 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:mysnps17A.fa\tSM:mysnps17A.fa' -t 8 reference/ref.fa /mnt/e/test4/17A/60-101_S1_L001_R1_001.fastq.gz /mnt/e/test4/17A/60-101_S1_L001_R2_001.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools
sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam

COMMAND: samtools markdup -T /tmp --threads 3 -r -s - -
READ: 3462693
WRITTEN: 3370831
EXCLUDED: 87497
EXAMINED: 3375196
PAIRED: 3318838
SINGLE: 56358
DUPLICATE PAIR: 57848
DUPLICATE SINGLE: 34014
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 91862
DUPLICATE TOTAL: 91862
ESTIMATED_LIBRARY_SIZE: 47047081

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 491233 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument
sleep: cannot read realtime clock: Invalid argument

### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FOR
MAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### cp snps.filt.vcf snps.vcf


### /home/nc-bioinfo/anaconda3/envs/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 2 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 0 SNPs to TAB format.

### /home/nc-bioinfo/anaconda3/envs/snippy/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf


### bcftools convert -Oz -o snps.vcf.gz snps.vcf


### bcftools index -f snps.vcf.gz


### bcftools consensus --sample mysnps17A.fa -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz

Applied 0 variants

### bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf


### bcftools index -f snps.subs.vcf.gz


### bcftools consensus --sample mysnps17A.fa -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz

Applied 0 variants

### rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi

",Rathanin-github,https://github.com/tseemann/snippy/issues/410
MDU6SXNzdWU2NjUwMjM2MTA=,snippy-core fails to find .aligned.fa/.vcf files if special chars are in the directory path (for ex: +),OPEN,2020-07-24T08:54:36Z,2020-07-24T08:54:36Z,,,coolmaksat,https://github.com/tseemann/snippy/issues/411
MDU6SXNzdWU2NzE2NjE2NjQ=,samtolls faidx,OPEN,2020-08-02T17:59:38Z,2020-08-02T17:59:38Z,,"Hello,

I am having issues. And below is the log file. Thanks


### samtools faidx reference/ref.fa

dyld: Library not loaded: @rpath/libcrypto.1.0.0.dylib
  Referenced from: /Users/User/miniconda3/bin/samtools
  Reason: image not found
",rsingh22m,https://github.com/tseemann/snippy/issues/413
MDU6SXNzdWU2NzE3MDMwODY=,Maximum number of samples?,CLOSED,2020-08-02T22:36:34Z,2020-08-03T16:19:55Z,2020-08-03T16:19:55Z,"I have a massive dataset with over 8000 samples. When I try to run `snippy-core`, the command is killed after 4272 samples.  Is this something to do with my computer or does snippy have a max number of samples it can work with? Thank you!",eam12,https://github.com/tseemann/snippy/issues/414
MDU6SXNzdWU2NzI5NjI4MDI=,snippy_multi fails to load reads,OPEN,2020-08-04T17:39:31Z,2021-10-15T10:12:15Z,,"Running one sample at a time works OK, can't create runme.sh

$snippy-multi input.tab --report --html --cpus 7 --ref /home/shawndy/Biomatics/snippy/C01_assembly.fasta > runme.sh

causes:
ERROR: [C01_/home/shawndy/Biomatics/snippy/C01/Sample1.R1.fastq_/home/shawndy/Biomatics/snippy/C01/Sample1.R2.fastq] missing read/contig data: C01 /home/shawndy/Biomatics/snippy/C01/Sample1.R1.fastq /home/shawndy/Biomatics/snippy/C01/Sample1.R2.fastq

input.tab = 
# input.tab = ID R1 [R2]
C01 /home/shawndy/Biomatics/snippy/C01/Sample1.R1.fastq /home/shawndy/Biomatics/snippy/C01/Sample1.R2.fastq
C02 /home/shawndy/Biomatics/snippy/C02/Sample2.R1.fastq /home/shawndy/Biomatics/snippy/C02/Sample2.R2.fastq

(etc. for seven samples, no hard return at end, crated in text editor, all separators are tabs)

I tried with the .gz compressed versions as well, same error.  Mint linux. Snippy 4.6.0.




",shawndy,https://github.com/tseemann/snippy/issues/416
MDU6SXNzdWU2NzM5Nzc3OTA=,snippy_multi fails to contigs,OPEN,2020-08-06T03:03:22Z,2020-08-06T03:03:22Z,,"the script  ""snippy-multi"" is not a effctive order, and I make a folder contained the 100 genomic contigs as input.tab, is it right?",zhangzengfeng,https://github.com/tseemann/snippy/issues/417
MDU6SXNzdWU2ODMzMzYyMzc=,Phylogenetic tree for covid-19,OPEN,2020-08-21T06:37:05Z,2020-08-23T18:10:59Z,,"Can we use Snippy for phylogenetic tree construction for COVID-19 from Fastq reads. If not, Can you suggest some tool to work with fastq reads",karthick1087,https://github.com/tseemann/snippy/issues/418
MDU6SXNzdWU2ODM4MjYwNzk=,deletion appears in the reference and in the mutant,OPEN,2020-08-21T21:02:16Z,2020-08-21T21:02:16Z,,"Hello, I am using snippy 4.6.0. I got a deletion described as 28 base pairs. However, when I did the alignment of the reference with the file snps.consensus.fa, the sequences are the same, showing only the sites in the reference. If I aligned the snps.consesus.subs.fa, all the variations describes in the snps.report.txt are there except the 28 base pairs deletion that it is present. Do I miss something? Deletions are not removed from the snps.consensus.fa and snps.consensus.subs.fa? How can I produce an alignment that shows the region that is deleted?
Many thanks!",maculatus,https://github.com/tseemann/snippy/issues/419
MDU6SXNzdWU2ODQyMjQ0NzE=,cann't get the result of snps.filt.vcf and snps.vcf,OPEN,2020-08-23T17:34:30Z,2020-11-09T18:22:49Z,,"hi:
     when I use snippy now , I  only can get the result of snps.raw.vcf, The result of snps.filt.vcf shows only the table's title.The snps.log is as follows:
### echo snippy 4.6.0
### cd /disk1/cau/cvmfbx

### /disk1/cau/cvmfbx/miniconda3/bin/snippy --cpus 16 --ref /disk1/cau/cvmfbx/sct_modle/genemates/cgsnp/tmexCD_pos_my_158+ncbi_17/GCF_000240185.1_ASM24018v2_genomic.fasta --ctgs /disk1/cau/cvmfbx/sct_modle/genemates/cgsnp/tmexCD_pos_my_158+ncbi_17/16MN2.fasta --outdir /disk1/cau/cvmfbx/sct_modle/genemates/cgsnp/snippy/16MN2.fasta_tab

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.03 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.03 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.02 sec
[bwa_index] Construct SA from BWT and Occ... 0.51 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 1.654 sec; CPU: 1.617 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:16MN2.fasta_tab\tSM:16MN2.fasta_tab' -t 16 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp/61836.1.all.q --threads 7 -m 1000M | samtools fixmate -m --threads 7 - - | samtools sort -l 0 -T /tmp/61836.1.all.q --threads 7 -m 1000M | samtools markdup -T /tmp/61836.1.all.q --threads 7 -r -s - - > snps.bam

[markdup] warning: unable to calculate estimated library size. Read pairs 0 should be greater than duplicate pairs 0, which should both be non zero.
COMMAND: samtools markdup -T /tmp/61836.1.all.q --threads 7 -r -s - -
READ: 452928
WRITTEN: 449688
EXCLUDED: 71104
EXAMINED: 381824
PAIRED: 0
SINGLE: 381824
DUPLICATE PAIR: 0
DUPLICATE SINGLE: 3240
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 3240
DUPLICATE TOTAL: 3240
ESTIMATED_LIBRARY_SIZE: 0

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 186377 > reference/ref.txt


### freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf

[E::vcf_parse_format] FORMAT column with no sample columns starting at NC_016845.1:13582

### cp snps.filt.vcf snps.vcf


### /disk1/cau/cvmfbx/miniconda3/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 7 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 41 SNPs to TAB format.

### /disk1/cau/cvmfbx/miniconda3/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf


### bcftools convert -Oz -o snps.vcf.gz snps.vcf


### bcftools index -f snps.vcf.gz


### bcftools consensus --sample 16MN2.fasta_tab -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz

Applied 41 variants

### bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf


### bcftools index -f snps.subs.vcf.gz


### bcftools consensus --sample 16MN2.fasta_tab -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz

Applied 41 variants

### rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi


### rm -f fake_reads\.fq

",richfubo,https://github.com/tseemann/snippy/issues/420
MDU6SXNzdWU2ODUwNzI4ODU=,bam file as snippy input,CLOSED,2020-08-25T00:40:43Z,2020-10-28T14:02:49Z,2020-10-27T19:59:30Z,"Hello!

I saw in https://github.com/tseemann/snippy/issues/269 that it's possible to run snippy with --bam, but when I do, snippy doesn't report snps. Why is freebayes not running correctly? I could not find any more information in the readme about --bam.

The input bam is analysis-ready, trimmed, filtered, and duplicates removed. I've attached the .log here:
[snps.log](https://github.com/tseemann/snippy/files/5120810/snps.log)

Thanks!
Kelly

",Kelzor,https://github.com/tseemann/snippy/issues/421
MDU6SXNzdWU2ODUyOTMwMDU=,Snippy output interpretation!,CLOSED,2020-08-25T08:43:08Z,2020-09-05T06:55:23Z,2020-09-05T06:55:23Z,"I have questions regarding snippy output (added at the end of the comment).

**1) REF; ALT and EFFECT**
Could you please explain REF, ALT and EFFECT using the row beginning with _NODE_4..._, i have read README.md explanation but I am a bit confused?

**2) Additional information using Genbank file as reference**
I used Genbank as reference and the last row beginning with _NODE_1..._ does not have this additional information. What could be the problem?

CHROM|POS|TYPE|REF|ALT|EVIDENCE|FTYPE|STRAND|NT_POS|AA_POS|EFFECT|LOCUS_TAG|GENE|PRODUCT
-----|---|----|---|---|--------|-----|------|------|------|------|---------|----|-------
NODE_4_length_425732_cov_48.486853|181980|snp|C|T|T:22 C:0|CDS|-|16/510|6/169|missense_variant c.16G>A p.Val6Ile|||hypothetical protein
NODE_6_length_201546_cov_44.355597|2286|snp|T|A|A:149 T:0|CDS|-|1029/1311|343/436|missense_variant c.1029A>T p.Glu343Asp|||CBS-domain-containing protein
NODE_5_length_217505_cov_37.518516|70702|snp|T|C|C:162 T:0|CDS|+|721/759|241/252|missense_variant c.721T>C p.Ser241Pro|||Indole-3-glycerol phosphate synthase (EC 4.1.1.48)
NODE_3_length_579564_cov_40.280807|264413|snp|C|T|T:145 C:0|CDS|-|757/1476|253/491|missense_variant c.757G>A p.Ala253Thr|||UDP-N-acetylmuramoyl-dipeptide--2,6- diaminopimelate ligase (EC 6.3.2.13)
NODE_1_length_700534_cov_38.930152|694342|del|GA|G|G:77 GA:0||||||||
						
",nbawe,https://github.com/tseemann/snippy/issues/422
MDU6SXNzdWU2ODc5NDk0NTY=,phylip format using snippy-core with --noref and --aformat=phylip,OPEN,2020-08-28T09:42:19Z,2020-08-28T09:42:19Z,,"Hi, I am following this tutorial to produce phylogenetic trees: https://aschuerch.github.io/MolecularEpidemiology_AnalysisWGS/09-SNPphylo/index.html

I used the fastq files of my bacterial isolates using the fast of the original one as a reference genome (fast). I get the tab files, but when I try to perform snippy-core with noref and aformat=phylip I get errors. 
The first error is saying that I need a reference file. If I try to add the same reference genome I used before, but still wanted to get the phylip format, I get another error saying the fasta is not compatible with the option aformat=phylip. 

How can I get the phylip format using snippy-core?

Thank you for your help!
Regards",FrAoJm,https://github.com/tseemann/snippy/issues/423
MDU6SXNzdWU2ODk3NzM4MTI=,error snippy-core can not work,CLOSED,2020-09-01T03:21:14Z,2020-09-04T02:45:08Z,2020-09-04T02:45:08Z,"the lest code is 
>snippy-core --ref 'ATCC13311.fasta' S-13-10-1r-2-I4512i S-13-10-1r-Derby S-13-100-1r-Derby S-13-103-1r-Derby S-13-106-1r-Wandsworth
and its not work
Derby: command not found
Thompson: command not found
Kintambo: command not found
Llandoff: command not found
Budapest: command not found
Corvallis: command not found
This is snippy-core 4.4.5
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools.
Found any2fasta - /software/snippy/binaries/noarch/any2fasta
Corvallis: command not found
Found samtools - /usr/bin/samtools
Yeerongpilly: command not found
Found minimap2 - /software/minimap2/minimap2
Found bedtools - /usr/bin/bedtools
Found snp-sites - /usr/bin/snp-sites
ERROR: Can't open --ref ATCC13311.fasta
Yeerongpilly: command not found
Washington: command not found
",senjoro,https://github.com/tseemann/snippy/issues/424
MDU6SXNzdWU2ODk5NjUwMzg=,Is snippy blind to regions that have no annotation from Prokka? ,OPEN,2020-09-01T09:03:18Z,2020-09-01T09:03:18Z,,"Ie. does Snippy consider non-annotated, non-coding regions at all? I assume they don't appear in the .gbk reference and are thus not considered, correct?

Thanks for clarifying this,
Kind regards",phiweger,https://github.com/tseemann/snippy/issues/425
MDU6SXNzdWU2OTE4MDQ2NDI=,Suggested way to detect outliers,CLOSED,2020-09-03T09:28:21Z,2020-09-17T18:20:34Z,2020-09-17T18:20:34Z,"I've got >900 Mtb genomes and am having the same issue as #400 (and #372 ) where you suggested `Use the core.txt file to figure out which one are the ""bad"" outliers and don't include them.` 

Can you suggest a heuristic to filter out outliers based on core.txt? I've tried filtering out those with low number of ALIGNED or low fraction of ALIGNED to UNALIGNED but end up with lots of excluded samples and still a very short core genome. ",pgcudahy,https://github.com/tseemann/snippy/issues/426
MDU6SXNzdWU3MDA3MjE4Mjc=,snippy-multi is not exported,OPEN,2020-09-14T03:01:52Z,2022-12-07T00:05:01Z,,"Hello,
I have already used snippy and snippy-multi in my previous work. I have recently installed snippy into a new PC but I think snippy-multi is not exported. Whenever I am running the following command.
`root@hon-pc:/home/fan/monas# snippy-multi /home/fan/monas/input.tab --ref /home/fan/monas/GCF_genomic.fna --cpus 8 > runme.sh`
`snippy-multi: command not found`

I have checked the miniconda bin directory. snippy and snippy-core are there but there is no snippy-multi.
What do you suggest in this issue? should I re-install or is there any other problem?",furqan915,https://github.com/tseemann/snippy/issues/427
MDU6SXNzdWU3MDI0NTEyNDI=,snippy multi prompting unreadable file,OPEN,2020-09-16T04:59:24Z,2020-09-17T07:35:03Z,,"Hi,

I have tried generating tab file by pasting all the filenames and paths in excel and later converted that CSV file using this command.

`sed -e 's/,/\t/g' input.csv > input2.tab`

and then ran the following command and this message showed up:

`
root@honey-pc:/home/fan/monas/fna# snippy-multi input2.tab --ref /home/fan/monas/fna/GCF_genomic.fna --cpus 4 > runme.sh
Reading: input2.tab
`
`ERROR: [GCF_genomic.fna ] unreadable file '/home/fan/monas/fna/GCF_genomic.fna`


Could you please guide me on how to create input.tab file in Linux command line (without using excel and csv format if there is a problem with formatting the file)? 

Secondly, I have already checked .fna format is acceptable and properly working with snippy. But this unreadable shows up in snippy-multi.

Regards

",furqan915,https://github.com/tseemann/snippy/issues/428
MDU6SXNzdWU3MDMyMTgwMzI=,"Error reading header -- snpEff build with zero frames, and bwa mem subsequently fails",CLOSED,2020-09-17T02:36:52Z,2020-09-20T23:44:31Z,2020-09-20T23:44:31Z,"Hi Torsten,
Thanks for a great programme and all the helpful answers that got me to this point so far!

I am trying to run on the test data (started with my data but will try get test running maybe easier first) available from the galaxy tutorial:

https://doi.org/10.5281/zenodo.582600

I am getting a fail that looks like this:
 `### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:testSNPS\tSM:testSNPS' -t 4 reference/ref.fa /Users/z3494810/OneDrive/OneDrive - UNSW/Documents/Genomics/testData/mutant_R1.fastq /Users/z3494810/OneDrive/OneDrive - UNSW/Documents/Genomics/testData/mutant_R2.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/29/9yfg2zms5pz3hfbpykzsw_d00000gn/T --threads 1 -m 4000M | samtools fixmate -m --threads 1 - - | samtools sort -l 0 -T /private/var/folders/29/9yfg2zms5pz3hfbpykzsw_d00000gn/T --threads 1 -m 4000M | samtools markdup -T /private/var/folders/29/9yfg2zms5pz3hfbpykzsw_d00000gn/T --threads 1 -r -s - - > snps.bam

[markdup] error reading header`

My config is:

`nippy --check
[12:34:10] This is snippy 4.6.0
[12:34:10] Written by Torsten Seemann
[12:34:10] Obtained from https://github.com/tseemann/snippy
[12:34:10] Detected operating system: darwin
[12:34:10] Enabling bundled darwin tools.
[12:34:10] Found bwa - /Users/z3494810/miniconda2/envs/snippy_env/bin/bwa
[12:34:10] Found bcftools - /Users/z3494810/miniconda2/envs/snippy_env/bin/bcftools
[12:34:10] Found samtools - /Users/z3494810/miniconda2/envs/snippy_env/bin/samtools
[12:34:10] Found java - /Users/z3494810/miniconda2/envs/snippy_env/bin/java
[12:34:10] Found snpEff - /Users/z3494810/miniconda2/envs/snippy_env/bin/snpEff
[12:34:10] Found samclip - /Users/z3494810/miniconda2/envs/snippy_env/bin/samclip
[12:34:10] Found seqtk - /Users/z3494810/miniconda2/envs/snippy_env/bin/seqtk
[12:34:10] Found parallel - /Users/z3494810/miniconda2/envs/snippy_env/bin/parallel
[12:34:10] Found freebayes - /Users/z3494810/miniconda2/envs/snippy_env/bin/freebayes
[12:34:10] Found freebayes-parallel - /Users/z3494810/miniconda2/envs/snippy_env/bin/freebayes-parallel
[12:34:10] Found fasta_generate_regions.py - /Users/z3494810/miniconda2/envs/snippy_env/bin/fasta_generate_regions.py
[12:34:10] Found vcfstreamsort - /Users/z3494810/miniconda2/envs/snippy_env/bin/vcfstreamsort
[12:34:10] Found vcfuniq - /Users/z3494810/miniconda2/envs/snippy_env/bin/vcfuniq
[12:34:10] Found vcffirstheader - /Users/z3494810/miniconda2/envs/snippy_env/bin/vcffirstheader
[12:34:10] Found gzip - /usr/bin/gzip
[12:34:10] Found vt - /Users/z3494810/miniconda2/envs/snippy_env/bin/vt
[12:34:10] Found snippy-vcf_to_tab - /Users/z3494810/miniconda2/envs/snippy_env/bin/snippy-vcf_to_tab
[12:34:10] Found snippy-vcf_report - /Users/z3494810/miniconda2/envs/snippy_env/bin/snippy-vcf_report
[12:34:10] Checking version: samtools --version is >= 1.7 - ok, have 1.10
[12:34:10] Checking version: bcftools --version is >= 1.7 - ok, have 1.10
[12:34:10] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.2
[12:34:11] Checking version: snpEff -version is >= 4.3 - ok, have 5.0
[12:34:11] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[12:34:11] Dependences look good!`

I am running:

`snippy --cpus 4 --outdir testSNPS --ref wildtype.gbk --R1 mutant_R1.fastq --R2 mutant_R2.fastq`

Thanks for any advice.

I installed using a conda environment and through conda.

Matt.
",phatmattbaker,https://github.com/tseemann/snippy/issues/429
MDU6SXNzdWU3MDU0NTIwODY=,vcf_parse header fail,OPEN,2020-09-21T09:56:00Z,2024-10-22T00:30:02Z,,"I just installed a fresh version of snippy on linux with conda, I get the following error in snps.log when I'm calling with reads:
```
### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf

[W::vcf_parse] INFO 'A' is not defined in the header, assuming Type=String
Encountered an error, cannot proceed. Please check the error output above.
If feeling adventurous, use the --force option. (At your own risk!)
```

I don't get the error when I use contigs.
 
Has anybody observed something alike?
Kind regards, Carl",cmkobel,https://github.com/tseemann/snippy/issues/430
MDU6SXNzdWU3MTExMzEwMDU=,Option for Zero Coverage Symbol,OPEN,2020-09-29T13:48:15Z,2020-09-29T13:48:15Z,,"Hi!
it would be great to have an option to set the zero coverage symbol at execution to easily distinguish between uncovered regions and genuine deletions. Of course, we can easily do that in the perl script, but as we use Snippy from conda within Snakemake pipelines, this simple command line option would make life much easier.

Thanks!

Sandro",andreott,https://github.com/tseemann/snippy/issues/431
MDU6SXNzdWU3MTI5NTYzNTY=,Extract the genes with variants,OPEN,2020-10-01T15:34:46Z,2020-10-02T07:50:52Z,,"I have a question not an issue about Snippy.
Could we extract the genes that are affected by snp/indels from the query genomes?
",SolayMane,https://github.com/tseemann/snippy/issues/432
MDU6SXNzdWU3MTQwOTY3Nzc=,All frames are zero! ,OPEN,2020-10-03T14:01:18Z,2023-04-02T18:44:31Z,,"Hi,
After update snippy, I  used snippy again, the error happened.

the error information:

### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:New\tSM:New' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools
 sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | sam
tools markdup -T /tmp --threads 3 -r -s - - > d5BvsDSM.bam

[markdup] warning: unable to calculate estimated library size. Read pairs 0 should be greater than duplicate pairs 0, which should both be non zero.

can anyone help me deal with the error?
Thanks
 yzhzhu
",yzhzu,https://github.com/tseemann/snippy/issues/433
MDU6SXNzdWU3MTgwNjk5Mzg=,ERROR: Could not run: snp-sites -c -o core.aln core.full.aln,OPEN,2020-10-09T11:26:20Z,2024-03-15T18:18:09Z,,"I'm getting the could not run snp-sites error even though like others who have had this issue (e.g. #326) I don't have the warning  that I have no SNPs.  However, I can successfully run snp-sites outside of the snippy script directly on the output that snippy had produced before it failed.  

```
....
18	AF-21-00169-20	snp=4358589	del=5	ins=58	het=0	unaligned=0
19	AF-21-07705-19	snp=4350978	del=4	ins=72	het=0	unaligned=0
20	AF-21-06823-19	snp=4354593	del=7	ins=59	het=0	unaligned=0
Opening: core.tab
Opening: core.vcf
Processing contig: LT708304-Mycobacteriumbovis-AF2122-97
Generating core.full.aln
Creating TSV file: core.txt
Running: snp-sites -c -o core.aln core.full.aln
ERROR: Could not run: snp-sites -c -o core.aln core.full.aln
```
Any ideas why snippy causes the error with snp-sites?",ellisrichardj,https://github.com/tseemann/snippy/issues/434
MDU6SXNzdWU3MTgwNzA5MDQ=,VCF output,OPEN,2020-10-09T11:28:03Z,2020-10-09T11:28:03Z,,"I want to calculate nucleotide diversity using vcftools based on vcf output as bellow without success:
vcftools --vcf snps.vcf  --window-pi 1000 --window-pi-step 200 --out pi-out
the out pt is empty

Can you help in this.
Sincerely",SolayMane,https://github.com/tseemann/snippy/issues/435
MDU6SXNzdWU3MzI4NDA0MTg=,samtools version1.11,OPEN,2020-10-30T02:53:40Z,2020-11-10T01:32:49Z,,"Hi, 

When I tested snippy, it showed this warning and exited,

> Need samtools --version >= 1.7 but you have 1.11 - please upgrade it

But the latest version of samtools is v1.11, which was installed by conda. Should I only use samtools v1.7 to v1.9?

Best regards,
Xiaojun",Xiaojun928,https://github.com/tseemann/snippy/issues/436
MDU6SXNzdWU3MzcwMzk5NjM=,snp detection on target regions,OPEN,2020-11-05T15:37:28Z,2020-11-05T15:37:28Z,,"Hi,
i have used snippy 4.6.0 for calling snps from the targeted region (bed file format). Some of the snps at pos 18100, 19067, 19067 were reported multiple times in the sns.raw.vcf and which is causing error. I understood that this snps were reported by freebayes and i don't know how to fix it. 
At the same time if run snippy without target region everything works properly.

Please find the log, bed file and raw snps vcf file for the reference

[data.zip](https://github.com/tseemann/snippy/files/5495340/data.zip)

",SumeetTiwari07,https://github.com/tseemann/snippy/issues/437
MDU6SXNzdWU3NDAwNjEyMDE=,samtools faidx reference/ref.fa 2>> snps.log,CLOSED,2020-11-10T16:33:10Z,2020-12-04T07:42:33Z,2020-12-04T07:42:33Z,"Hi, I would have been running snippy, everything looks fine till the point it'is going to star running samtools, so it's when this error comes up:

![image](https://user-images.githubusercontent.com/74251140/98701926-b7fcb280-2371-11eb-9d02-bf4fd4d01c88.png)
 when I open the snps.log folder, this is what I find:
![image](https://user-images.githubusercontent.com/74251140/98702413-4113e980-2372-11eb-8a2d-f267447fa2f4.png)
 Has someone had this problem before? would someone mind helping me?
",angeladelvalle,https://github.com/tseemann/snippy/issues/438
MDU6SXNzdWU3NDM5NDY4MTM=,SoftClipped and Unmapped reads,OPEN,2020-11-16T15:50:50Z,2020-11-16T15:50:50Z,,"Hi, 

I am interested in exploring soft-clipped reads from some bam files I produced earlier using snippy, as a mean to identify insertion sequences. However, I'm not sure I can actually do this. Could you please help me figure out:

- what is the default value for --maxsoft? Looking at my bam files I guess it is 10 but the readme doesn't mention it (and I have too little experience with bam files to trust my guess).
- what happens to the reads that have >maxsoft bases that do not align? do they become Unmapped?
- does the bam file include the unmapped reads? The ""Output files"" table indicates that it does, but the ""Unmapped Reads"" section indicates that it doesn't. I am wondering whether the last reads in my bam file could be the unmapped ones, because the headers look like this:
NB501755:180:HJLVNBGXB:4:23612:6187:5311	148	*	0	0	(then the sequence then 2 fields)
instead of
NB501755:180:HJLVNBGXB:1:13210:16123:16837	163	ctg.s1.000000F.arrow	1	60	7S144M	=	140	290	(then the sequence, then 8 fields)

Thanks a lot!
Marie",marieleoz,https://github.com/tseemann/snippy/issues/439
MDU6SXNzdWU3NjA2Mjg4NTk=,BCFtools command reads read group as sample ID,OPEN,2020-12-09T20:00:11Z,2020-12-09T20:00:11Z,,"Hi Torsten, 

My snippy analysis progresses well creating the expected output files using $sample as prefix, but errors when the BCFtools 'consensus' command is run, as the read group specified by '--rgid' snippy flag is mistakenly used as the value for BCFtools '--sample' flag:

- Tail of the log:

```
$ tail 7346.log

### bcftools convert -Oz -o 7346.vcf.gz 7346.vcf


### bcftools index -f 7346.vcf.gz


### bcftools consensus --sample 000000000-C56FR.1_7346_1\tPL:illumina\tPU:000000000-C56FR.1\tSM:7346\tLB:7346_1\tCN:AGRF -f reference/ref.fa -o 7346.consensus.fa 7346.vcf.gz

No such sample: 000000000-C56FR.1_7346_1tPL:illuminatPU:000000000-C56FR.1tSM:7346tLB:7346_1tCN:AGRF
```

- Directory listing for $sample:

```
$ ls -lhtr
total 64M
lrwxrwxrwx 1 cwil2281 RDS-FVS-Microbiome_long-RW   20 Dec 10 06:45 ref.fa.fai -> reference/ref.fa.fai
lrwxrwxrwx 1 cwil2281 RDS-FVS-Microbiome_long-RW   16 Dec 10 06:45 ref.fa -> reference/ref.fa
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW  60M Dec 10 06:45 7346.bam
drwxr-sr-x 4 cwil2281 RDS-FVS-Microbiome_long-RW 4.0K Dec 10 06:45 reference
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 4.5K Dec 10 06:45 7346.bam.bai
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 1.8M Dec 10 06:45 7346.raw.vcf
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 527K Dec 10 06:45 7346.filt.vcf
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 527K Dec 10 06:46 7346.vcf
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 175K Dec 10 06:46 7346.tab
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW  800 Dec 10 06:46 7346.vcf.gz.csi
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 114K Dec 10 06:46 7346.vcf.gz
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 513K Dec 10 06:46 7346.subs.vcf
-rw-r--r-- 1 cwil2281 RDS-FVS-Microbiome_long-RW 3.4K Dec 10 06:46 7346.log
```

- The snippy command:

```
snippy --cpus $NCPUS \
	--ram 47 \
	--reference $ref \
	--R1 $fq1 \
	--R2 $fq2 \
	--outdir ./Variants/${sample} \
	--force \
	--prefix $sample \
	--unmapped \
	--basequal 20 \
	--minqual 200 \
	--rgid ""${flowcell}.${lane}_${sample}_${lib}\tPL:${platform}\tPU:${flowcell}.${lane}\tSM:${sample}\tLB:${sample}_${lib}\tCN:${centre}""
```
 
Thanks a lot,
Cali ",calizilla,https://github.com/tseemann/snippy/issues/440
MDU6SXNzdWU3Nzc1NTkwMzY=,snippy-multi provides error,CLOSED,2021-01-03T02:18:26Z,2021-01-17T21:59:40Z,2021-01-17T21:59:40Z,"Hi! 
I ran individual genome to call SNPs with the same reference genome and it does work well. But when I ran more than 150 genomes that need to align with same reference genome using below code:
snippy-multi input.tab --ref refgenome.fa --cpus 16 > runme.sh
it results the error: 
Reading: /Documents/P1aln/NEW/input.tab
ERROR: [a.fasta] missing read/contig data: a.fasta 

I checked the solution you have in the github, which I already adjusted (input.tab as file3.txt), and checked the fasta file and its contigs and sequences are there. Problem is there with running snippy-mutli. 

While running individual genome for a.fasta it does have 
total no. variants normalized            : 366
       total no. variants observed              : 27709
       total no. reference observed             : 0

Time elapsed: 0.25s
",ShresthaRima,https://github.com/tseemann/snippy/issues/441
MDU6SXNzdWU3OTE5MTgzMDM=,Unable to run snippy,CLOSED,2021-01-22T11:12:16Z,2021-04-06T23:07:18Z,2021-04-06T23:07:18Z,"Dear Tseemann,

Im trying to run snippy usibg snippy --check but it gives the following error:

`Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module) (@INC contains: /home/puser/perl5/lib/perl5 /home/puser/anaconda3/lib/site_perl/5.26.2/x86_64-linux-thread-multi /home/puser/anaconda3/lib/site_perl/5.26.2 /home/puser/anaconda3/lib/5.26.2/x86_64-linux-thread-multi /home/puser/anaconda3/lib/5.26.2 .) at /home/puser/anaconda3/bin/snippy line 11.
BEGIN failed--compilation aborted at /home/puser/anaconda3/bin/snippy line 11.`

However, BIO::SeqIO is already installed. but when i run the same command using sudo ""sudo snippy --check"" it gives new error:

`Can't locate strict.pm in @INC (you may need to install the strict module) (@INC contains: /usr/local/lib/site_perl/5.26.2/x86_64-linux-thread-multi /usr/local/lib/site_perl/5.26.2 /usr/local/lib/5.26.2/x86_64-linux-thread-multi /usr/local/lib/5.26.2 .) at /usr/local/bin/snippy line 2.
BEGIN failed--compilation aborted at /usr/local/bin/snippy line 2.`

where as strict module is installed too

Can you please help me with this i have tried to install snippy using git clone as well as anaconda both but it is showing same errors.
looking forward for your response

Thanks

JIA",Javaria-Ashraf,https://github.com/tseemann/snippy/issues/443
MDU6SXNzdWU4MDA3NDU4NjA=,Can't locate Snippy/Version.pm in @INC (you may need to install the Snippy::Version module),OPEN,2021-02-03T22:17:22Z,2021-02-18T02:52:03Z,,"When i try to use snippy outside the installed PATH, i receive this message:

Can't locate Snippy/Version.pm in @INC (you may need to install the Snippy::Version module) (@INC contains: /usr/local/bin/../perl5 /home/serwy/anaconda3/lib/site_perl/5.26.2/x86_64-linux-thread-multi /home/serwy/anaconda3/lib/site_perl/5.26.2 /home/serwy/anaconda3/lib/5.26.2/x86_64-linux-thread-multi /home/serwy/anaconda3/lib/5.26.2 .) at /usr/local/bin/snippy line 9.
BEGIN failed--compilation aborted at /usr/local/bin/snippy line 9.

It only works in the PATH using ""./""

I've already manually installed other @INC modules, but in this one i'm having issues",danserwy,https://github.com/tseemann/snippy/issues/444
MDU6SXNzdWU4MDI1MzQwMjY=,Different pairwise SNP distances from snippy-core depending on inputs,OPEN,2021-02-05T23:12:03Z,2021-04-06T23:16:02Z,,"Hi,

I am getting strange results from snippy-core: I ran contigs from 100 isolates using snippy-multi (therefore all against the same reference) and then generated a distance matrix from the core.aln file using snp-dists. So far so good. However, I then wanted to construct a phylogenomic tree, so I used snippy on some extra reference strains and outgroups individually, with the same reference as before. I then ran everything through snippy-core again and found that it gave me different pairwise SNP differences to the previous run, so I played around with some other combinations. 

As an example:

1) in my original run, there were 124 SNPs between Sample021 and Sample043.
2) when I added the reference strains and outgroups there were no SNPs between the same two strains. 
3) when I repeated 1) but changed the --ref from 'Sample001/ref.fa' to my original ref.gbk file, the SNP distance between Sample021 and Sample043 was 25.
4) when I only used four of my isolates, including 021 and 043, the number of SNPs was 119.

I know that running different groups of samples will change what is defined as 'core' but why do I get different results by using a subset of the original group and when using the original ref.gbk as opposed to snippy's .fa version of that file?",nthomson50,https://github.com/tseemann/snippy/issues/445
MDU6SXNzdWU4MDMwODgyNzE=,snippy-core outputting few snps ???,CLOSED,2021-02-07T23:27:40Z,2021-04-06T23:06:21Z,2021-04-06T23:06:21Z,"Hello,

I ran 12 isolates through snippy individually and then called snippy-core with the snippy folders and it seemed to work (no error messages) and I got some output but the number of snps generated was way off. Each of those isolates had 8000 - 14000 snps when aligned to a 5 mbp reference genome. How could I get a dozen snps for the core genome? 

Do I have to run it all again with multi?

Any ideas what's going on? Thank You. - Robert

",robertwhbaldwin,https://github.com/tseemann/snippy/issues/446
MDU6SXNzdWU4MDQyNDQzODQ=, Error reading header,OPEN,2021-02-09T06:11:46Z,2024-01-23T12:03:31Z,,"Dear everyone,
I used snippy to check SNP compared to reference H, pylori 26695. However, I got this error. Does anyone get same problem with me?
Thank you
### echo snippy 4.6.0
### cd /data/Phuc/Antibiotic/Vietnam strains/Snippy

### /data/Phuc/miniconda3/envs/test/bin/snippy --cpus 16 --ram 8 --R1 VN0498_1_paired.qf.fastq.gz --R2 VN0498_2_paired.qf.fastq.gz --outdir VN0498 --ref 26695.fasta

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.02 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.38 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.23 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.681 sec; CPU: 0.681 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:VN0498\tSM:VN0498' -t 16 reference/ref.fa /data/Phuc/Antibiotic/Vietnam strains/Snippy/VN0498_1_paired.qf.fastq.gz /data/Phuc/Antibiotic/Vietnam strains/Snippy/VN0498_2_paired.qf.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 7 -m 1000M | samtools fixmate -m --threads 7 - - | samtools sort -l 0 -T /tmp --threads 7 -m 1000M | samtools markdup -T /tmp --threads 7 -r -s - - > snps.bam

[markdup] error reading header
",buihoangphuc412,https://github.com/tseemann/snippy/issues/447
MDU6SXNzdWU4MDc0NzM4MTA=,Any recommendation for a pathogenicity island finder software available in github?,CLOSED,2021-02-12T18:59:59Z,2021-04-06T23:05:32Z,2021-04-06T23:05:32Z,"Hi, I am studying the virulence of some bacteria samples, and I would have heard about a few software for identifying them.
Any recommendation?",angeladelvalle,https://github.com/tseemann/snippy/issues/448
MDU6SXNzdWU4MDkxOTYyNzI=,snippy filter,OPEN,2021-02-16T10:41:00Z,2021-02-16T10:41:00Z,,"Hello all,

can someone tell me more about the filters which snippy/freebayes use please?
We have to do a SNP call without utilize SNPs in these regions: repetitive sequences and RNAs. The SNPs should have at least 8 bp distance to each other as well. 
Does snippy/freebayes consider these SNP filters described above in the default settings?
Thanks.
",Katharina19,https://github.com/tseemann/snippy/issues/449
MDU6SXNzdWU4MTU5MjEwOTA=,Samtools version naming issue,CLOSED,2021-02-24T23:09:46Z,2021-04-06T23:02:59Z,2021-04-06T23:02:43Z,"Hi,

Snippy requires samtools version 1.7. Samtools is now on version 1.11. 

My experience with having samtools/1.10 loaded and running snippy is that it says that my samtools version is too low, which makes sense in a 1.7 > 1.11 way, but does not work with the numbering system of samtools releases.
",mish-su,https://github.com/tseemann/snippy/issues/450
MDU6SXNzdWU4MTk3NDUyNTE=,Can not read sequence file,OPEN,2021-03-02T07:52:31Z,2024-05-16T17:24:39Z,,"Hi,

I'm trying to run snippy but I get the error: ""Can not read sequence file"" and I don't know how to solve it. My input files are reads in FASTQ format, gz compressed. 

Best regards",JoleinLaumen,https://github.com/tseemann/snippy/issues/451
MDU6SXNzdWU4MzQ2MDgxNDk=,Technical Question: Is it possible to use Snippy for RNAseq (Fastq) + Trinity transcriptome assembly (Fasta) data? ,CLOSED,2021-03-18T10:08:46Z,2021-04-08T17:56:17Z,2021-04-08T17:56:17Z,I want to do SNP discovery using RNASeq fastq files as input and a Trinity transcriptome assembly fasta as the reference. Will this work? Will the data that will be produced be viable? ,ec-ho-ra-mos,https://github.com/tseemann/snippy/issues/452
MDU6SXNzdWU4MzQ3NDI2Mjg=,Long read support?,OPEN,2021-03-18T12:23:21Z,2024-05-03T08:14:07Z,,"Hi

Any plans to expand snippy with support for pacbio and nanopore reads? Noticed this tutorial demonstrating the cool stuff snippy can do https://training.galaxyproject.org/training-material/topics/variant-analysis/tutorials/microbial-variants/tutorial.html and came here to check it out. However, I could not find  any mention of long reads.

Best regards
Rasmus",Kirk3gaard,https://github.com/tseemann/snippy/issues/453
MDU6SXNzdWU4NDg4ODM5MjA=,"Help with understanding snippy output files, particularly full.clean.aln.gaps.phylip",CLOSED,2021-04-02T00:58:03Z,2021-04-03T02:42:56Z,2021-04-03T02:42:56Z,"@tseemann 

I have been testing a script on github to remove and count invariant sites from a phylip file (raxml_bias) but I cannot determine if I should use this script on my:

1) *.full.clean.aln which is has a length of 2.2 million sites (the approximate size of the bacterial genomes) and that I've converted to phylip using snp-sites
 
OR

2) the *.full.clean.aln.gaps.phylip which has a length of 874817 sites (also not exactly sure what this file is which is why I am asking)

OR should I be running it on both and taking the difference between the two. I really just need some clarity on the difference between these files. 

Thanks",slvrshot,https://github.com/tseemann/snippy/issues/454
MDU6SXNzdWU4NTM3MTUzNjc=,My job has been running for more than 5 days with no update. Can anyone help me?,OPEN,2021-04-08T18:01:13Z,2021-04-08T18:01:13Z,,"Objective: I am trying to use Snippy to generate a .vcf SNP discovery file using (1)  .fasta and (2) .fastq as input files.

Problem: After 5 days (8 cpus), there is no change. I think the run encountered an error?

This is my scripts:
```
snippy \
--subsample 0.01 \
--force \
--report \
--cpus 8 \
--outdir ***/12_snps/ \
--ref ***/f1_trinity_out_dir.Trinity.fasta  \ ##(fasta size = 608 MB)
--R1 ***/F1-1A_S1_R1_001.fastq.gz \  ##(fastq size = 6.05 GB)
--R2 ***/F1-1A_S1_R2_001.fastq.gz  ##(fastq size =6.09GB)
```

This is the output:
```
[18:37:12] This is snippy 4.6.0
[18:37:12] Written by Torsten Seemann
[18:37:12] Obtained from https://github.com/tseemann/snippy
[18:37:12] Detected operating system: linux
[18:37:12] Enabling bundled linux tools.
[18:37:12] Found bwa - /snippy-4.6.0/binaries/linux/bwa
[18:37:12] Found bcftools - /snippy-4.6.0/binaries/linux/bcftools
[18:37:12] Found samtools - /snippy-4.6.0/binaries/linux/samtools
[18:37:12] Found java - /usr/bin/java
[18:37:12] Found snpEff - /snippy-4.6.0/binaries/noarch/snpEff
[18:37:12] Found samclip - /snippy-4.6.0/binaries/noarch/samclip
[18:37:12] Found seqtk - /snippy-4.6.0/binaries/linux/seqtk
[18:37:12] Found parallel - /snippy-4.6.0/binaries/noarch/parallel
[18:37:12] Found freebayes - /snippy-4.6.0/binaries/linux/freebayes
[18:37:12] Found freebayes-parallel - /snippy-4.6.0/binaries/noarch/freebayes-parallel
[18:37:12] Found fasta_generate_regions.py - /snippy-4.6.0/binaries/noarch/fasta_generate_regions.py
[18:37:12] Found vcfstreamsort - /snippy-4.6.0/binaries/linux/vcfstreamsort
[18:37:12] Found vcfuniq - /snippy-4.6.0/binaries/linux/vcfuniq
[18:37:12] Found vcffirstheader - /snippy-4.6.0/binaries/noarch/vcffirstheader
[18:37:12] Found gzip - /bin/gzip
[18:37:12] Found vt - /snippy-4.6.0/binaries/linux/vt
[18:37:12] Found snippy-vcf_to_tab - /snippy-4.6.0/bin/snippy-vcf_to_tab
[18:37:12] Found snippy-vcf_report - /snippy-4.6.0/bin/snippy-vcf_report
[18:37:12] Checking version: samtools --version is >= 1.7 - ok, have 1.10
[18:37:12] Checking version: bcftools --version is >= 1.7 - ok, have 1.10
[18:37:12] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.1
[18:37:13] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[18:37:13] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[18:37:13] Using reference: ***/f1_trinity_out_dir.Trinity.fasta
[18:37:15] Treating reference as 'fasta' format.
[18:37:15] Will use 8 CPU cores.
[18:37:15] Using read file: ***/F1-1A_S1_R1_001.fastq.gz
[18:37:15] Using read file: ***/F1-1A_S1_R2_001.fastq.gz
[18:37:15] Creating folder: ***/12_snps/
[18:37:15] Changing working directory: ***/12_snps/
[18:37:15] Creating reference folder: reference
[18:37:15] Extracting FASTA and GFF from reference.
[18:38:57] Wrote 653007 sequences to ref.fa
[18:38:57] Wrote 0 features to ref.gff
[18:38:57] Sub-sampling reads at rate 0.01
[18:38:57] Freebayes will process 15 chunks of 42164290 bp, 8 chunks at a time.
[18:38:57] Using BAM RG (Read Group) ID: 12_snps
[18:38:57] Running: seqtk sample \***/F1\-1A_S1_R1_001\.fastq\.gz 0.01 > subsampled\.F1\-1A_S1_R1_001\.fastq 2>> snps.log
[18:39:45] Running: seqtk sample \***/F1\-1A_S1_R2_001\.fastq\.gz 0.01 > subsampled\.F1\-1A_S1_R2_001\.fastq 2>> snps.log
[18:40:33] Running: samtools faidx reference/ref.fa 2>> snps.log
[18:40:37] Running: bwa index reference/ref.fa 2>> snps.log
[18:54:54] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[18:54:55] Running: ln -sf reference/ref.fa . 2>> snps.log
[18:54:55] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[18:54:55] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[18:54:56] Running: bwa mem  -Y -M -R '@RG\tID:12_snps\tSM:12_snps' -t 8 reference/ref.fa subsampled.F1-1A_S1_R1_001.fastq subsampled.F1-1A_S1_R2_001.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam 2>> snps.log
[samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 653007 sequences in reference/ref.fa.fai
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[M::process] read 370944 sequences (49760917 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (0, 8898, 1, 0)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (117, 143, 171)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (9, 279)
[M::mem_pestat] mean and std.dev: (145.42, 42.34)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 333)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_process_seqs] Processed 370944 reads in 382.644 CPU sec, 48.752 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[samclip] Processed 300000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R u/RG\tID:12_snps\tSM:12_snps -t 8 reference/ref.fa subsampled.F1-1A_S1_R1_001.fastq subsampled.F1-1A_S1_R2_001.fastq
[main] Real time: 56.097 sec; CPU: 387.107 sec
[samclip] Total SAM records 377055, removed 16221, allowed 17114, passed 360834
[samclip] Header contained 653009 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[18:56:02] Running: samtools index snps.bam 2>> snps.log
[18:56:03] Running: fasta_generate_regions.py reference/ref.fa.fai 42164290 > reference/ref.txt 2>> snps.log
[18:56:06] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
```
It just stays like that for more than 5 days. No change. Do you think it might be that the job run into an error? Can anyone suggest something?",ec-ho-ra-mos,https://github.com/tseemann/snippy/issues/455
MDU6SXNzdWU4NjI1MzIwNTU=,ERROR: Could not find .aligned.fa/.vcf in file_name,CLOSED,2021-04-20T07:56:24Z,2022-03-24T15:39:52Z,2021-04-27T10:53:50Z,"Hi,  I'm not sure if this is the same error as other issues with the same '.aligned.fa/.vcf' error. 
Snippy has been running for 2 days using the command

`snippy-multi '/media/sharb/SharonsHD4/1to401_fastqgz_list.tab' --ref '/media/sharb/SharonsHD4/fastq_trimmedpaired_1_401/nzak3.gbk' --report --cpus 16 > runme.sh`

all 401 isolate folders are present and most contain 22 items but some only have 5 (reference folder, ref.fa, ref.fa.fai, snps.bam, snps.log)
and only the core.ref.fa has been output.

I've run the command using a subset of my isolates and it's worked perfectly.  Do you know what could have caused the issue please?
",sharbie88,https://github.com/tseemann/snippy/issues/456
MDU6SXNzdWU4NjMxMTkyNjU=,variants with low coverage.,OPEN,2021-04-20T18:40:50Z,2021-06-17T11:54:43Z,,"Dear Torsten,

we use snippy in order to align the reads to a reference and to obtain the annotation of the variants. Unfortunately in the results that we obtain we loose some SNPs because of the coverage. Snippy replaced the information in the reads with the reference nucleotides. And also in the vcf file we don't have those variation annotated (and for covid it is really important!)

If we extract the consensus using another method (e.g. ivar setting a low min coverage) we obtain the nucleotides present in the alignment

Is it possible to change the min coverage used in snippy? 

Thank a lot for your help
Iolanda",iolanda-IZSAM,https://github.com/tseemann/snippy/issues/457
MDU6SXNzdWU4NjU5MjEzNjU=,How to install latest release (snippy 4.6.0)?,CLOSED,2021-04-23T09:18:07Z,2021-04-25T04:53:23Z,2021-04-25T04:53:23Z,"I have installed the snippy following the instruction, but the version is snippy 3.1 not 4.6.0. How to install the latest release or update it? Please help, thanks very much!",DerekXP,https://github.com/tseemann/snippy/issues/458
MDU6SXNzdWU4OTY3NDIyMzk=,Question using --peil in snippy-multi,OPEN,2021-05-20T12:20:15Z,2021-05-20T12:20:15Z,,"Hi, just a quick question. I used snippy-multi to generate my script but because I only supplied the one fastq, it automatically added --se . In fact, these are paired end interleaved, is there a way to note that the script should read --peil somehow? I've been using sed to replace but wondered if there was a more straightforward way. Thanks! 
",shamavirani,https://github.com/tseemann/snippy/issues/459
MDU6SXNzdWU4OTc5NjQ5MzA=,Bad ID when running snippy-multi,OPEN,2021-05-21T11:42:23Z,2021-05-21T11:42:23Z,,"Hi, I successfully ran snippy and now want to do some core phylogeny for my SNPs. I created the input.tab file using fastq files and fasta files(some of my samples did not have fastq files for whole genomes). 
When I run snippy-multi input.tab --ref k12.gbk --cpus 8 > runme.sh
I get an error message ""Bad ID""
I tried exploring the help option but I could not pinpoint and resolve the problem. I will really appreciate any help given. 

Below are some random samples from my input.tab file

NT12158	/storage/2021_ecoli_rnaseq/fastq/fastq/NT12158_1.fq.gz	/storage/2021_ecoli_rnaseq/fastq/fastq/NT12158_2.fq.gz

NT12879	/storage/2021_ecoli_rnaseq/fastq/fasta/NT12879_649.fasta",Bamu-d,https://github.com/tseemann/snippy/issues/460
MDU6SXNzdWU5MDY3MzY1ODY=,"Is clean.core.tree file generated by fastTree after running gubbin and snippy, a recombination free core SNP tree file?",OPEN,2021-05-30T12:13:48Z,2021-11-25T07:21:01Z,,"After running snippy on multiple isolates, with command snippy-multi , i have run recombination detection tool as given:

%run_gubbins.py -p gubbins clean.full.aln
% snp-sites -c gubbins.filtered_polymorphic_sites.fasta > clean.core.aln
% FastTree -gtr -nt clean.core.aln > clean.core.tree

I wanted to know whether snp-sites mask recombination detected by gubbins in core full alignment file. Also, tree file generated by fastTree is it a recombination free core SNP phylogeny? if not, how can i get a core SNP alignment file which has SNP in recombination regions masked? 
i am beginner in phylogenomics and programming, if i have understood something wrong, kindly correct.",tanusaroha,https://github.com/tseemann/snippy/issues/461
MDU6SXNzdWU5MTIyNjM0OTU=,Unfixable error in reading files,CLOSED,2021-06-05T13:26:08Z,2021-06-06T15:01:40Z,2021-06-06T14:52:01Z,"Does snippy support Ubuntu windows subsystem WSL? because i always have the same error for all trials. @tseemann.
help would me much appreciated.",mf116,https://github.com/tseemann/snippy/issues/462
MDU6SXNzdWU5MjQwMTY5MTE=,snippy-multi can't open --ref,OPEN,2021-06-17T14:50:32Z,2023-08-04T15:34:00Z,,"I'm trying to run snippy-multi for a few assembled genomes.

I've generated a tab file (input.tab) as follows:

isolate12	/msa/12_PROKKA_06152021.fna
isolate2	/msa/2_PROKKA_06162021.fna
isolate25	/msa/25_PROKKA_06162021.fna
isolate87	/msa/87_PROKKA_06162021.fna
isolate3	/msa/3_PROKKA_06152021.fna
isolate32	/msa/32_PROKKA_06162021.fna
isolate82	/msa/82_PROKKA_06152021.fna
isolate38	/msa/38_PROKKA_06162021.fna
isolate98	/msa/98_PROKKA_06162021.fna
isolate1	/msa/1_PROKKA_06162021.fna

When i run the below commands I get the below error:
snippy-multi input.tab --ref K12MG1655_sequence.gbk --cpus 16 > runme.sh
sh ./runme.sh

ERROR: Can't open --ref isolate12/ref.fa
 

In the snps.log file I also get the errors:
### samtools faidx reference/ref.fa
[faidx] Could not build fai index reference/ref.fa.fai


Do you have any advice please?",a14578,https://github.com/tseemann/snippy/issues/463
MDU6SXNzdWU5MzYzODI3OTE=,samtools faidx reference/ref.fa error,CLOSED,2021-07-04T05:41:08Z,2021-07-06T11:45:56Z,2021-07-06T11:45:56Z,"Hello everyone,

I encountered the problem while using snippy with a reference.fasta and a contig.fasta.

I used following command
`snippy --outdir out --ref reference.fasta --ctgs contig.fasta`

as a result, 
> [14:34:55] Running: samtools faidx reference/ref.fa 2>> snps.log
sh: line 1: 24063 Abort trap: 6           samtools faidx reference/ref.fa 2>> snps.log
[14:34:55] Error running command, check out/snps.log

snps.log include
>  '### samtools faidx reference/ref.fa
dyld: Library not loaded: @rpath/libcrypto.1.0.0.dylib
  Referenced from: /Users/user/opt/miniconda3/bin/samtools
  Reason: image not found

Could you please tell me what should I do?

Thanks, 
",kopelol,https://github.com/tseemann/snippy/issues/464
MDU6SXNzdWU5NDI5NTgyOTQ=,snippy-multi  can't open --ref seq1.fasta/ref.fa,CLOSED,2021-07-13T08:18:21Z,2023-10-05T19:12:26Z,2021-07-28T07:27:12Z,"Hello everyone, I encountered a problem.

I use following snippy-multi command
`snippy-multi  input.txt --ref reference.gb --cpus 16 > runme.sh`
`sh ./runme.sh`

input.txt is like (seq1~29)
seq1    /path/to/seq1.fasta
seq2   /path/to/seq2.fasta
seq3   /path/to/seq2.fasta

after           sh ./runme.sh

> [16:58:37] Creating folder: seq28.fasta
mkdir seq28.fasta: File exists at /Users/user/opt/miniconda3/bin/snippy line 176.
[16:58:37] This is snippy 4.6.0
[16:58:37] Written by Torsten Seemann
[16:58:37] Obtained from https://github.com/tseemann/snippy
[16:58:37] Detected operating system: darwin
[16:58:37] Enabling bundled darwin tools.
[16:58:37] Found bwa - /Users/user/opt/miniconda3/bin/bwa
[16:58:38] Found bcftools - /Users/user/opt/miniconda3/bin/bcftools
[16:58:38] Found samtools - /Users/user/opt/miniconda3/bin/samtools
[16:58:38] Found java - /Users/user/opt/miniconda3/bin/java
[16:58:38] Found snpEff - /Users/user/opt/miniconda3/bin/snpEff
[16:58:38] Found samclip - /Users/user/opt/miniconda3/bin/samclip
[16:58:38] Found seqtk - /Users/user/opt/miniconda3/bin/seqtk
[16:58:38] Found parallel - /Users/user/opt/miniconda3/bin/parallel
[16:58:38] Found freebayes - /Users/user/opt/miniconda3/bin/freebayes
[16:58:38] Found freebayes-parallel - /Users/user/opt/miniconda3/bin/freebayes-parallel
[16:58:38] Found fasta_generate_regions.py - /Users/user/opt/miniconda3/bin/fasta_generate_regions.py
[16:58:38] Found vcfstreamsort - /Users/user/opt/miniconda3/bin/vcfstreamsort
[16:58:38] Found vcfuniq - /Users/user/opt/miniconda3/bin/vcfuniq
[16:58:38] Found vcffirstheader - /Users/user/opt/miniconda3/bin/vcffirstheader
[16:58:38] Found gzip - /usr/bin/gzip
[16:58:38] Found vt - /Users/user/opt/miniconda3/bin/vt
[16:58:38] Found snippy-vcf_to_tab - /Users/user/opt/miniconda3/bin/snippy-vcf_to_tab
[16:58:38] Found snippy-vcf_report - /Users/user/opt/miniconda3/bin/snippy-vcf_report
[16:58:38] Checking version: samtools --version is >= 1.7 - ok, have 1.12
[16:58:38] Checking version: bcftools --version is >= 1.7 - ok, have 1.12
[16:58:38] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.5
[16:58:38] Checking version: snpEff -version is >= 4.3 - ok, have 5.0
[16:58:38] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[16:58:38] Using reference: /Users/user/Documents/univ/data/sequence/reference.gb
[16:58:38] Treating reference as 'genbank' format.
[16:58:38] Will use 16 CPU cores.
[16:58:38] Using read file: /Users/user/Documents/univ/data/sequence/multi-sequence/seq28.fasta
[16:58:38] Creating folder: seq29.fasta
mkdir seq29.fasta: File exists at /Users/user/opt/miniconda3/bin/snippy line 176.
This is snippy-core 4.6.0
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools for darwin
Found any2fasta - /Users/user/opt/miniconda3/bin/any2fasta
Found samtools - /Users/user/opt/miniconda3/bin/samtools
Found minimap2 - /Users/user/opt/miniconda3/bin/minimap2
Found bedtools - /Users/user/opt/miniconda3/bin/bedtools
Found snp-sites - /Users/user/opt/miniconda3/bin/snp-sites
ERROR: Can't open --ref seq1.fasta/ref.fa
 
the last sequence, seq29 was different from other sequence like seq28, and I encountered the error described above.

Could you tell me the way to solve this problem. 

Thanks,",kopelol,https://github.com/tseemann/snippy/issues/465
MDU6SXNzdWU5NDYzOTczNjk=,bcftools consensus: No such sample:,OPEN,2021-07-16T15:32:16Z,2021-07-16T15:55:23Z,,"Hi, I am testing snippy with one bam file and everything runs ok till the last step "" bcftools consensus --sample outdir -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz"". After I get rid of --sample option, it passed through...


### echo snippy 4.6.0
### cd /data/deve/workflows/nf-tb/example/test_paired_end/test_snippy

### /data/software/miniconda3/envs/snippy/bin/snippy --outdir outdir --ref tbdb.fasta --bam ERR036228.sort.bam

### samtools faidx reference/ref.fa


### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### samtools view -h -O SAM \/data\/deve\/workflows\/nf\-tb\/example\/test_paired_end\/test_snippy\/ERR036228\.sort\.bam | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n 
-l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam

COMMAND: samtools markdup -T /tmp --threads 3 -r -s - -
READ: 464372
WRITTEN: 457710
EXCLUDED: 0
EXAMINED: 464372
PAIRED: 456060
SINGLE: 8312
DUPLICATE PAIR: 3834
DUPLICATE SINGLE: 2828
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 6662
DUPLICATE TOTAL: 6662
ESTIMATED_LIBRARY_SIZE: 13486136

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 299004 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,
^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### cp snps.filt.vcf snps.vcf


### /data/software/miniconda3/envs/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 327 SNPs to TAB format.

### /data/software/miniconda3/envs/snippy/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf


### bcftools convert -Oz -o snps.vcf.gz snps.vcf


### bcftools index -f snps.vcf.gz


### bcftools consensus --sample outdir -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz

No such sample: outdir",xiaoli-dong,https://github.com/tseemann/snippy/issues/466
MDU6SXNzdWU5NTc0OTI4MTU=,`--targets` option only works if absolute path is given,OPEN,2021-08-01T13:27:45Z,2022-06-07T12:38:59Z,,"When trying to run snippy with calls to target sites of interest (in the form of a bed file), the freebayes-parallel part of the pipeline only works if the absolute path to the bed file is provide as the argument to the `--targets` option, otherwise snippy creates the path to the bedfile as a subfile within the specified `--outdir`.

For example, 

`snippy --targets my_sites.bed --outdir SAMPLE1 --R1 r1.fq --R2 r2.fq --ref myref.fa`

Will create a freebayes command line with the following `--targets` specification:

`--targets '/path/to/where/snippy/was/run/SAMPLE1/my_sites.bed`

whereas the correct specification should be:

`--targets '/path/to/where/snippy/was/run/my_sites.bed`

I'm not a perl hacker, but the problem seems to be this line in the `snippy` source:

`$fbopt .= sprintf "" --targets '%s'"", abs_path($targets) if $targets;`

I think the fix is for `abs_path` to be called *before* changing to `outdir`.

A temporary work around is for the user or calling script to call snippy with the full path to the target bedfile.",pmagwene,https://github.com/tseemann/snippy/issues/467
MDU6SXNzdWU5NjQyMTIxMTM=,Multiple reference genomes,OPEN,2021-08-09T17:27:15Z,2021-08-09T17:27:15Z,,"Is it possible to call variants for 3 samples against Reference genome 1 and then align a reference genome 2 against reference genome 1, and then finally generate 1 tree including all 5 items like shown below?
<img width=""701"" alt=""Screen Shot 2021-08-09 at 10 25 39 AM"" src=""https://user-images.githubusercontent.com/1850984/128747900-3eebba56-2f2c-4b78-ba9b-d03ee1b37b7a.png"">
",snigdhaAgarwal,https://github.com/tseemann/snippy/issues/468
MDU6SXNzdWU5NzU2MjM2NzM=,Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module),OPEN,2021-08-20T13:42:55Z,2021-08-20T14:25:22Z,,"
$ snippy
Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module) (@INC contains: /home/taobilin/miniconda3/bin/../perl5 /home/taobilin/miniconda3/lib/site_perl/5.26.2/x86_64-linux-thread-multi /home/taobilin/miniconda3/lib/site_perl/5.26.2 /home/taobilin/miniconda3/lib/5.26.2/x86_64-linux-thread-multi /home/taobilin/miniconda3/lib/5.26.2 .) at /home/taobilin/miniconda3/bin/snippy line 15.
BEGIN failed--compilation aborted at /home/taobilin/miniconda3/bin/snippy line 15.


![QA](https://user-images.githubusercontent.com/51879580/130242490-3dc4fe24-acf6-4347-b7f0-bff4d013398e.png)
",Tuberculosis-Public-Health-Lab,https://github.com/tseemann/snippy/issues/469
MDU6SXNzdWU5NzY4NzM4MDE=,Please make a DOI,OPEN,2021-08-23T10:21:16Z,2021-08-23T10:21:16Z,,"Hi,
Please give us a better way to give you credit when we use your tools. 
A DOI would be nice (ex. zenodo).
",evezeyl,https://github.com/tseemann/snippy/issues/470
MDU6SXNzdWU5NzcxNTE1Mzg=,"Snippy --check , Need to upgrade snpEff?? URGENT PLEASE",OPEN,2021-08-23T15:22:24Z,2022-01-01T22:54:54Z,," dear all, 

Im having problems to run snippy 4.6.0 
When I  --check dependencies, I receive the following message:

[11:09:57] This is snippy 4.6.0
[11:09:57] Written by Torsten Seemann
[11:09:57] Obtained from https://github.com/tseemann/snippy
[11:09:57] Detected operating system: linux
[11:09:57] Enabling bundled linux tools.
[11:09:57] Found bwa - /home/fabio/miniconda3/envs/snippy2/bin/bwa
[11:09:57] Found bcftools - /home/fabio/miniconda3/envs/snippy2/bin/bcftools
[11:09:57] Found samtools - /home/fabio/miniconda3/envs/snippy2/bin/samtools
[11:09:57] Found java - /home/fabio/miniconda3/envs/snippy2/bin/java
[11:09:57] Found snpEff - /home/fabio/miniconda3/envs/snippy2/bin/snpEff
[11:09:58] Found samclip - /home/fabio/miniconda3/envs/snippy2/bin/samclip
[11:09:58] Found seqtk - /home/fabio/miniconda3/envs/snippy2/bin/seqtk
[11:09:58] Found parallel - /home/fabio/miniconda3/envs/snippy2/bin/parallel
[11:09:58] Found freebayes - /home/fabio/miniconda3/envs/snippy2/bin/freebayes
[11:09:58] Found freebayes-parallel - /home/fabio/miniconda3/envs/snippy2/bin/freebayes-parallel
[11:09:58] Found fasta_generate_regions.py - /home/fabio/miniconda3/envs/snippy2/bin/fasta_generate_regions.py
[11:09:59] Found vcfstreamsort - /home/fabio/miniconda3/envs/snippy2/bin/vcfstreamsort
[11:09:59] Found vcfuniq - /home/fabio/miniconda3/envs/snippy2/bin/vcfuniq
[11:09:59] Found vcffirstheader - /home/fabio/miniconda3/envs/snippy2/bin/vcffirstheader
[11:09:59] Found gzip - /usr/bin/gzip
[11:09:59] Found vt - /home/fabio/miniconda3/envs/snippy2/bin/vt
[11:10:00] Found snippy-vcf_to_tab - /home/fabio/miniconda3/envs/snippy2/bin/snippy-vcf_to_tab
[11:10:00] Found snippy-vcf_report - /home/fabio/miniconda3/envs/snippy2/bin/snippy-vcf_report
[11:10:00] Checking version: samtools --version is >= 1.7 - ok, have 1.12
[11:10:00] Checking version: bcftools --version is >= 1.7 - ok, have 1.12
[11:10:00] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.5
**[11:10:01] Need snpEff -version >= 4.3 but you have 3.7 - please upgrade it.** 

I have noticed though, that while installing in a conda environment, it appeared [ snpEff--5.0] version. 
So Im not sure why Im receiving this warning. Everything else seems fine.

is there anything I can do to solve this issue? How can I check the current version of snpEff and/or update/upgrade it??

I would really appreciate some help. 

Thanks in advance


",FabioMiglioransa,https://github.com/tseemann/snippy/issues/471
MDU6SXNzdWU5Nzc5MTA0MzI=,Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module),OPEN,2021-08-24T09:43:04Z,2021-08-31T07:02:31Z,,"Installed snippy in conda environment in ubuntu 20.04 LTS. Following message was obtained. Assistance will be greatly appreciated.
![Capture](https://user-images.githubusercontent.com/89452811/130594997-c5ea854b-1a79-494f-a065-d0c86d81c1ed.JPG)
",Jeewan-Thapa,https://github.com/tseemann/snippy/issues/472
MDU6SXNzdWU5ODY2NzU5OTg=,SnpEff filtering problem ,OPEN,2021-09-02T12:46:41Z,2021-09-02T12:46:41Z,,"Is there a way to remove SnpEff filters on the output of the vcf file. I want to include the non-coding regions?
--
##SnpEffCmd=""SnpEff  -noStats -no-downstream -no-upstream -no-utr ref snps.filt.vcf ""

",Farzaana14,https://github.com/tseemann/snippy/issues/473
MDU6SXNzdWU5ODk0MDMzNjU=,snippy: Error running command,OPEN,2021-09-06T19:39:36Z,2021-09-06T19:39:36Z,,"I am trying to run snippy, but i get the following: 

(base) sfb619@SUND35882 snippy % snippy --cpus 4  --outdir mysnips --ref 26B3_contigs.fsa --R1 AL8_S42_L001_R1_001.fastq.gz --R2 AL8_S42_L001_R2_001.fastq.gz --ram 3

[21:37:19] This is snippy 4.6.0
[21:37:19] Written by Torsten Seemann
[21:37:19] Obtained from https://github.com/tseemann/snippy
[21:37:19] Detected operating system: darwin
[21:37:19] Enabling bundled darwin tools.
[21:37:19] Found bwa - /usr/local/bin/bwa
[21:37:19] Found bcftools - /usr/local/bin/bcftools
[21:37:19] Found samtools - /usr/local/bin/samtools
[21:37:19] Found java - /usr/bin/java
[21:37:19] Found snpEff - /usr/local/bin/snpEff
[21:37:19] Found samclip - /usr/local/bin/samclip
[21:37:19] Found seqtk - /usr/local/bin/seqtk
[21:37:19] Found parallel - /usr/local/bin/parallel
[21:37:19] Found freebayes - /usr/local/bin/freebayes
[21:37:19] Found freebayes-parallel - /usr/local/bin/freebayes-parallel
[21:37:19] Found fasta_generate_regions.py - /usr/local/bin/fasta_generate_regions.py
[21:37:19] Found vcfstreamsort - /usr/local/bin/vcfstreamsort
[21:37:19] Found vcfuniq - /usr/local/bin/vcfuniq
[21:37:19] Found vcffirstheader - /usr/local/bin/vcffirstheader
[21:37:19] Found gzip - /usr/bin/gzip
[21:37:19] Found vt - /usr/local/bin/vt
[21:37:19] Found snippy-vcf_to_tab - /usr/local/Cellar/snippy/4.6.0/bin/snippy-vcf_to_tab
[21:37:19] Found snippy-vcf_report - /usr/local/Cellar/snippy/4.6.0/bin/snippy-vcf_report
[21:37:19] Checking version: samtools --version is >= 1.7 - ok, have 1.13
[21:37:19] Checking version: bcftools --version is >= 1.7 - ok, have 1.13
[21:37:19] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.2
[21:37:19] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[21:37:19] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[21:37:19] Using reference: /Users/sfb619/Documents/speciale/snippy/26B3_contigs.fsa
[21:37:19] Treating reference as 'fasta' format.
[21:37:19] Will use 4 CPU cores.
[21:37:19] Using read file: /Users/sfb619/Documents/speciale/snippy/AL8_S42_L001_R1_001.fastq.gz
[21:37:19] Using read file: /Users/sfb619/Documents/speciale/snippy/AL8_S42_L001_R2_001.fastq.gz
[21:37:19] Creating folder: mysnips
[21:37:19] Changing working directory: mysnips
[21:37:19] Creating reference folder: reference
[21:37:19] Extracting FASTA and GFF from reference.
[21:37:20] Wrote 250 sequences to ref.fa
[21:37:20] Wrote 0 features to ref.gff
[21:37:20] Freebayes will process 7 chunks of 694809 bp, 4 chunks at a time.
[21:37:20] Using BAM RG (Read Group) ID: mysnips
[21:37:20] Running: samtools faidx reference/ref.fa 2>> snps.log
[21:37:20] Running: bwa index reference/ref.fa 2>> snps.log
[21:37:21] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[21:37:21] Running: ln -sf reference/ref.fa . 2>> snps.log
[21:37:21] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[21:37:21] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[21:37:21] Running: bwa mem  -Y -M -R '@RG\tID:mysnips\tSM:mysnips' -t 4 reference/ref.fa /Users/sfb619/Documents/speciale/snippy/AL8_S42_L001_R1_001.fastq.gz /Users/sfb619/Documents/speciale/snippy/AL8_S42_L001_R2_001.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/zh/yt6c034s4rv2hl36n49vrtl8h8xs39/T --threads 1 -m 1500M | samtools fixmate -m --threads 1 - - | samtools sort -l 0 -T /private/var/folders/zh/yt6c034s4rv2hl36n49vrtl8h8xs39/T --threads 1 -m 1500M | samtools markdup -T /private/var/folders/zh/yt6c034s4rv2hl36n49vrtl8h8xs39/T --threads 1 -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 250 sequences in reference/ref.fa.fai
[M::process] read 167002 sequences (40000285 bp)...
[M::process] read 167206 sequences (40000239 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (14, 79612, 11, 5)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (266, 371, 599)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1265)
[M::mem_pestat] mean and std.dev: (400.92, 207.32)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1598)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (323, 432, 560)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1034)
[M::mem_pestat] mean and std.dev: (446.19, 185.14)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1271)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (4649, 4817, 4909)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (4129, 5429)
[M::mem_pestat] mean and std.dev: (4856.62, 113.46)
[M::mem_pestat] low and high boundaries for proper pairs: (3869, 5689)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 167002 reads in 13.332 CPU sec, 3.205 real sec
[samclip] Processed 100000 records...
[M::process] read 166864 sequences (40000130 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (14, 79668, 9, 9)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (253, 358, 764)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1786)
[M::mem_pestat] mean and std.dev: (406.92, 267.45)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 2297)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (323, 431, 558)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1028)
[M::mem_pestat] mean and std.dev: (444.49, 184.37)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1263)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_process_seqs] Processed 167206 reads in 13.989 CPU sec, 3.287 real sec
[samclip] Processed 200000 records...
[samclip] Processed 300000 records...
[M::process] read 166698 sequences (40000161 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (19, 79449, 11, 6)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (154, 354, 526)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1270)
[M::mem_pestat] mean and std.dev: (325.65, 194.18)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1642)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (326, 433, 562)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1034)
[M::mem_pestat] mean and std.dev: (447.25, 183.73)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1270)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (4659, 4821, 4892)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (4193, 5358)
[M::mem_pestat] mean and std.dev: (4792.36, 150.14)
[M::mem_pestat] low and high boundaries for proper pairs: (3960, 5591)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 166864 reads in 13.824 CPU sec, 3.255 real sec
[samclip] Processed 400000 records...
[samclip] Processed 500000 records...
[M::process] read 166496 sequences (40000444 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (12, 79429, 6, 4)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (221, 272, 305)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (53, 473)
[M::mem_pestat] mean and std.dev: (235.73, 90.25)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 597)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (329, 438, 575)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1067)
[M::mem_pestat] mean and std.dev: (456.66, 193.17)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1313)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_process_seqs] Processed 166698 reads in 14.708 CPU sec, 3.446 real sec
[samclip] Processed 600000 records...
[M::process] read 87066 sequences (20932223 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (14, 79228, 14, 2)
[M::mem_pestat] analyzing insert size distribution for orientation FF...
[M::mem_pestat] (25, 50, 75) percentile: (128, 345, 1781)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 5087)
[M::mem_pestat] mean and std.dev: (684.14, 722.11)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 6740)
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (329, 439, 574)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1064)
[M::mem_pestat] mean and std.dev: (456.29, 192.22)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1309)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (4442, 4747, 4859)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (3608, 5693)
[M::mem_pestat] mean and std.dev: (4780.64, 170.40)
[M::mem_pestat] low and high boundaries for proper pairs: (3191, 6110)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation FF
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 166496 reads in 14.538 CPU sec, 3.485 real sec
[samclip] Processed 700000 records...
[samclip] Processed 800000 records...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (8, 41451, 8, 6)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (327, 436, 573)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1065)
[M::mem_pestat] mean and std.dev: (455.42, 191.56)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 1311)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_process_seqs] Processed 87066 reads in 8.035 CPU sec, 1.936 real sec
[samclip] Processed 900000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @RG\tID:mysnips\tSM:mysnips -t 4 reference/ref.fa /Users/sfb619/Documents/speciale/snippy/AL8_S42_L001_R1_001.fastq.gz /Users/sfb619/Documents/speciale/snippy/AL8_S42_L001_R2_001.fastq.gz
[main] Real time: 19.594 sec; CPU: 79.090 sec
[samclip] Total SAM records 924966, removed 109993, allowed 48238, passed 814973
[samclip] Header contained 252 lines
[samclip] Done.
[21:38:19] Running: samtools index snps.bam 2>> snps.log
[21:38:20] Running: fasta_generate_regions.py reference/ref.fa.fai 694809 > reference/ref.txt 2>> snps.log
[21:38:20] Running: freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[21:38:22] Error running command, check mysnips/snps.log
(base) sfb619@SUND35882 snippy % 



any suggestions what i can do to make it work? thanks",monicanielsen,https://github.com/tseemann/snippy/issues/474
MDU6SXNzdWU5ODk2OTE3MDg=,snippy-core breaks on bed file symlink,OPEN,2021-09-07T07:44:16Z,2021-09-07T07:48:16Z,,"This file check should have a space between the `!` and `-f` otherwise it breaks in `Nextflow` where the `bed` file is symlinked

```bash
err(""Can't read --bed $bed"") if $bed and $bed ne 'auto' and !-f $bed;
```",esteinig,https://github.com/tseemann/snippy/issues/475
MDU6SXNzdWU5OTExNDg5MjE=,snippy core showing 1 variant only in core.txt,OPEN,2021-09-08T13:36:50Z,2021-09-08T13:36:50Z,,I have run 25 samples on snippy-multi and individually all runs seem ok but in core.txt only shows 1 snp for the last file. ,BettyAC,https://github.com/tseemann/snippy/issues/477
MDU6SXNzdWU5OTMwOTgzMTQ=,Super new to Snippy: How to change the output file instead of the default snps.XXX?,OPEN,2021-09-10T10:21:45Z,2022-01-20T12:37:30Z,,"Hello, I am super new to the world of code/script etc.
I am doing Covid-19 phylogenetic work. 
I used snippy-multi to generate indel profile before confirming using IGV and editing them in Jalview

snippy-multi input.tab --ref ref.fasta --cpus 16 > runme.sh
less runme.sh
sh ./runme.sh

I have 2 questions:
1. The output file is all named as snps.XXX by default and I would like to name them according to my sample ( which is the directory name by default).
2. Once the name has been changed, how could I concatenate all of the .consensus.fa into one multifasta file.
Thank you for your help!",Gracengan327,https://github.com/tseemann/snippy/issues/478
MDU6SXNzdWU5OTM4OTUxMDc=,Issue ,OPEN,2021-09-11T17:56:42Z,2021-09-11T17:56:42Z,,"
Hello, @tseemann  my friends tried to make a loop on output that we got from running bbduk on snippy code example  provided by you but it won't work the output file does not contain anything. 
any suggestions 
#!/bin/bash
source /opt/asn/etc/asn-bash-profiles-special/modules.sh
module load snippy
#input fastq.gz files
mkdir SNP_output
for fq1 in ./*.clean_trim1.fq
do
echo ""working with file $fq1""
base=$(basename $fq1 .clean_trim1.fq)
echo ""base name is $base""
fq1=./${base}.clean_trim1.fq
fq2=./${base}.clean_trim2.fq
snippy --outdir SNP_output --ref GCF_000022165.1_ASM2216v1_genomic.gbk --R1 ${base}.clean_trim1.fq --R2 ${base}.clean_trim2.fq 
done
",Sid1507711,https://github.com/tseemann/snippy/issues/479
I_kwDOAS4qDc47yamU,reference in gbk/gb OR fasta+gtf/gff,OPEN,2021-09-21T18:51:15Z,2021-09-21T18:51:15Z,,"I was using Snippy and I recommend the use of this software. Great Job!
When I ran it with a reference in gbk file format Snippy split it into Fasta+GTF and then proceed, but there is not an option to use fasta+gtf as an input by default.
It would be great to have this option as part of the main options.",aabaricalla,https://github.com/tseemann/snippy/issues/480
I_kwDOAS4qDc48CVo1,"help | what does this ""2"" mean in my Snippy result report???",OPEN,2021-09-26T01:52:00Z,2021-09-26T01:52:00Z,,"![image](https://user-images.githubusercontent.com/91398760/134790469-c70cc153-6a05-4143-8e12-f2def7e19e40.png)
",tjiaa,https://github.com/tseemann/snippy/issues/481
I_kwDOAS4qDc48hcoo,Stuck at solving environment,OPEN,2021-10-04T16:46:16Z,2021-12-04T15:54:37Z,,"Hi,
I am trying to install snippy through conda but it just gets stuck at solving environment. I wonder if there are any suggestions to get it installed.",maguileraf,https://github.com/tseemann/snippy/issues/482
I_kwDOAS4qDc482r0X,citing snippy,OPEN,2021-10-08T10:58:43Z,2021-10-08T10:58:43Z,,How should one cite snippy?,ekg,https://github.com/tseemann/snippy/issues/483
I_kwDOAS4qDc49YCNb,snippy-multi error Can't locate Bio/SeqIO.pm,CLOSED,2021-10-18T23:58:08Z,2021-10-19T00:41:59Z,2021-10-19T00:41:59Z,"Hi,

I've run 

`/home/csri348/snippy/bin/snippy-multi Actb-input.txt --ref ../prokka/TVZ_G3_4.124.contigs.fa.prokka-compliance/TVZ_G3_4.124.contigs.fa.gbk --ram 16 --report   `

and I got this error

`Perl v5.18.0 required--this is only v5.16.3, stopped at /home/csri348/snippy/bin/snippy line 2.
BEGIN failed--compilation aborted at /home/csri348/snippy/bin/snippy line 2.
Can't locate Bio/SeqIO.pm in @INC (@INC contains: /scale_wlg_persistent/filesets/home/csri348/snippy/bin/../perl5 /usr/local/lib64/perl5 /usr/local/share/perl5 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5 .) at /home/csri348/snippy/bin/snippy-core line 8.
BEGIN failed--compilation aborted at /home/csri348/snippy/bin/snippy-core line 8.`

Please help.",kittyshady,https://github.com/tseemann/snippy/issues/484
I_kwDOAS4qDc49qpPm,Question: How to use two reference sequences (i.e. Vibrio cholerae has two chromosomes)?,CLOSED,2021-10-25T01:46:02Z,2021-11-05T02:20:57Z,2021-11-05T02:20:57Z,"Hello.

I'm trying to make a phylogenetic tree for several Vibrio cholerae isolates i have. This reference (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7667034/) used snippy and i want to try it too. But it used two reference accession numbers bc V. cholerae has two chromosomes (one for each chromosome). Please help on how i should input the reference to snippy.

1. should i make a multiple fasta file from the two chromosomes and use it as reference?
2. should i run snippy twice? first using chromosome 1 as ref and the second, using chromosome 2 as reference?
3. or do you have any other suggestion?

Thank you.
",mmfacun,https://github.com/tseemann/snippy/issues/485
I_kwDOAS4qDc49ry0t,Potentially incorrect NT_POS output,OPEN,2021-10-25T09:22:56Z,2021-10-25T13:57:05Z,,"Hi Torsten Seemann,
Thanks a lot for developing and maintaining snippy!

I'm using your tool to study deletions. While investigating the output for deletions I realized that I ether don't understand the NT_POS output or it's incorrect (very well possible that it's and understanding issue on my side).

Interestingly the output is only wrong in my opinion for the + strand.
Here is an example snps.tab (shortened for readability):
```
CHROM	POS	TYPE	REF	ALT	STRAND	NT_POS
AGTU001.0001.c01	251174	del	TC	T	+	1425/1545
```
According to the used reference.gbk this feature has following start and end positions: `249758..251302`

They way I would determine the NT_POS for the + strand is `NT_POS = POS - feature_start_position` so `251174 -249758 =  1416`  
This doesn't match the output of snippy. Am I missing something? I have plenty of other examples that I'm happy to share if this could be a bug. I can also guarantee that the reference.gbk is the same I used for snippy and for doublechecking.

For the - strand I would calculate the NT_POS as `NT_POS = feature_end_position - POS` which matches the snippy output.

I'm using snippy 4.6.0
Thank in advance and best regards,
Eric",nahanoo,https://github.com/tseemann/snippy/issues/486
I_kwDOAS4qDc4_SmzK,invalid reference sequence,OPEN,2021-11-24T00:15:08Z,2021-12-02T03:08:24Z,,"Hi Dr. Torsten Seemann,

Thank you for developing Snippy. I am using it to generate the snp results and alignment for 65 Mtb strain paired fastq SRR data. I need to use the fasta file (https://www.ncbi.nlm.nih.gov/nuccore/NC_000962.3?report=fasta) as a reference sequence. However, I cannot get it work as it showed that this file is invalid. 
![Capture](https://user-images.githubusercontent.com/81097598/143148370-64d37d32-f41d-4dfd-b838-2880ce550ec6.PNG)
Please tell me how to address this.

At the same time, I would like to use the function ""snippy-multi"", but I don't know how to prepare the input file as required. Please see the atatched screenshot and suggest a good way of preparing the input for the function.
![raw files](https://user-images.githubusercontent.com/81097598/143148561-e63a864a-9596-4e1f-bcc5-50ff6919ebd1.PNG)

Best regards,

Qingbo Shu",qingbo11,https://github.com/tseemann/snippy/issues/487
I_kwDOAS4qDc4_YB6A,How to construct a recombination free core SNP phylogenetic tree using snippy and gubbins?,OPEN,2021-11-25T07:59:26Z,2023-07-05T03:28:29Z,,"Hi，
I'm new to this and I want to construct a recombination free core SNP phylogenetic tree using snippy and gubbins. 
I'm confused because core.aln is a core SNP alignment file and core.full.aln is a  whole genome SNP alignment file, while the input of gubbins should be a whole genome alignment file. So what should I do to get a recombination free core SNP phylogenetic tree??
Can I use core.aln as the input of gubbins?

After I got core.full.aln, if I run this:
%snippy-clean_full_aln core.full.aln > clean.full.aln
%run_gubbins.py -p gubbins clean.full.aln
%snp-sites -c gubbins.filtered_polymorphic_sites.fasta > clean.core.aln
%FastTree -gtr -nt clean.core.aln > clean.core.tree

In this case, this clean.core.tree is a  recombination free core SNP phylogetneic tree or a  recombination free whole SNP phylogetneic tree ???

Best wishes
Jessie


",Jessie940409,https://github.com/tseemann/snippy/issues/488
I_kwDOAS4qDc4_YD4a,snippy+gubbins,OPEN,2021-11-25T08:09:42Z,2021-11-25T08:09:42Z,,"Hi there,
When I ran snippy-core.
Snippy includes reference in the alignment file, but I don't want the reference showed in the final tree.
Can I just remove the ref genome in core.full.aln before running gubbins or is there any better way?

Best wishes,
Jessie",Jessie940409,https://github.com/tseemann/snippy/issues/489
I_kwDOAS4qDc4_l-DT,snippy-core --prefix ,OPEN,2021-11-30T08:08:02Z,2023-01-27T04:51:01Z,,"Hello Tseemann, 
I ran the script ""snippy-core --prefix TB0065_S16_L001 TB0207_S6_L001"" and I got the following error. Can you help me? 

This is snippy-core 4.5.0
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools.
Found any2fasta - /home/litbangkes-papua/anaconda3/envs/my_env/bin/any2fasta
Found samtools - /home/litbangkes-papua/anaconda3/envs/my_env/bin/samtools
Found minimap2 - /home/litbangkes-papua/anaconda3/envs/my_env/bin/minimap2
Found bedtools - /home/litbangkes-papua/anaconda3/envs/my_env/bin/bedtools
Found snp-sites - /home/litbangkes-papua/anaconda3/envs/my_env/bin/snp-sites
ERROR: Please provide --ref FASTA/GENBANK",yustinus1,https://github.com/tseemann/snippy/issues/490
I_kwDOAS4qDc4_2KTb,[E::bwa_set_rg] no ID within the read group line,OPEN,2021-12-04T08:58:16Z,2024-03-23T10:26:12Z,,"Dear tseemann,
I m using snippy multi but samples are failing on RG tag. Can you please help me with this error. I have installed snippy using mamba. I think something is wrong with bwa.. 

```
[13:45:22] This is snippy 3.1
[13:45:22] Written by Torsten Seemann <torsten.seemann@gmail.com>
[13:45:22] Obtained from https://github.com/tseemann/snippy
[13:45:22] Detected operating system: linux
[13:45:22] Enabling bundled linux tools.
[13:45:22] Found bwa - /home/sar/miniconda3/envs/snippy/bin/bwa
[13:45:22] Found samtools - /home/sar/miniconda3/envs/snippy/bin/samtools
[13:45:22] Found tabix - /home/sar/miniconda3/envs/snippy/bin/tabix
[13:45:22] Found bgzip - /home/sar/miniconda3/envs/snippy/bin/bgzip
[13:45:22] Found snpEff - /home/sar/miniconda3/envs/snippy/bin/snpEff
[13:45:22] Found java - /home/sar/miniconda3/envs/snippy/bin/java
[13:45:22] Found gzip - /usr/bin/gzip
[13:45:22] Found parallel - /home/sar/miniconda3/envs/snippy/bin/parallel
[13:45:22] Found freebayes - /home/sar/miniconda3/envs/snippy/bin/freebayes
[13:45:22] Found freebayes-parallel - /home/sar/miniconda3/envs/snippy/bin/freebayes-parallel
[13:45:22] Found fasta_generate_regions.py - /home/sar/miniconda3/envs/snippy/bin/fasta_generate_regions.py
[13:45:22] Found vcfstreamsort - /home/sar/miniconda3/envs/snippy/bin/vcfstreamsort
[13:45:22] Found vcfuniq - /home/sar/miniconda3/envs/snippy/bin/vcfuniq
[13:45:22] Found vcffirstheader - /home/sar/miniconda3/envs/snippy/bin/vcffirstheader
[13:45:22] Found vcf-consensus - /home/sar/miniconda3/envs/snippy/bin/../binaries/noarch/vcf-consensus
[13:45:22] Found snippy-vcf_to_tab - /home/sar/miniconda3/envs/snippy/bin/snippy-vcf_to_tab
[13:45:22] Found snippy-vcf_report - /home/sar/miniconda3/envs/snippy/bin/snippy-vcf_report
[13:45:22] Found snippy-vcf_filter - /home/sar/miniconda3/envs/snippy/bin/snippy-vcf_filter
[13:45:22] Using reference: /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/sonnei.gbk
[13:45:22] Treating reference as 'genbank' format.
[13:45:22] Will use 4 CPU cores.
[13:45:22] Using read file: /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/../ERR024095_1.fastq.gz
[13:45:22] Using read file: /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/../ERR024095_2.fastq.gz
[13:45:22] Creating folder: ERR024095
[13:45:22] Changing working directory: ERR024095
[13:45:22] Creating reference folder: reference
[13:45:22] Extracting FASTA and GFF from reference.
[13:45:24] Wrote 1 sequences to ref.fa
[13:45:24] Wrote 4601 features to ref.gff
[13:45:24] Creating reference/snpeff.config
[13:45:24] Freebayes will process 16 chunks of 302639 bp, 4 chunks at a time.
[13:45:24] Using BAM RG (Read Group) ID: ERR024095
[13:45:24] Running: samtools faidx reference/ref.fa 2>> ERR024095.log
[13:45:24] Running: bwa index reference/ref.fa 2>> ERR024095.log
[13:45:28] Running: mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> ERR024095.log
[13:45:28] Running: mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> ERR024095.log
[13:45:28] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> ERR024095.log
[13:45:32] Running: (bwa mem  -v 2 -M -R '@RG   ID:ERR024095    SM:ERR024095' -t 4 reference/ref.fa /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/../ERR024095_1.fastq.gz /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/../ERR024095_2.fastq.gz | samtools view -@ 4 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -O bam -o ERR024095.bam -@ 4 -) 2>> ERR024095.log
[13:45:32] Error running command, check ERR024095/ERR024095.log`
```
The log:

```
### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.03 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.54 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.02 sec
[bwa_index] Construct SA from BWT and Occ... 0.72 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 3.114 sec; CPU: 2.335 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### (bwa mem  -v 2 -M -R '@RG   ID:ERR024095    SM:ERR024095' -t 4 reference/ref.fa /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/../ERR024095_1.fastq.gz /mnt/e/Working/Shigella/Data/shigella_sonnie/asia/snippy_sonn_asia/../ERR024095_2.fastq.gz | samtools view -@ 4 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -O bam -o ERR024095.bam -@ 4 -)

[E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t
[main_samview] fail to read the header from ""-"".
samtools sort: failed to read header from ""-"" 
```

Thanks

SAR",safinaARK,https://github.com/tseemann/snippy/issues/491
I_kwDOAS4qDc5AHw0K,generate a variant table for dnds calculation,OPEN,2021-12-09T16:38:41Z,2022-02-11T22:44:27Z,,"Hello,

I was wondering if there is an easy way to generate a genotype by isolate table for subsequent dnds calculation. I previously used the core.tab file from snippy-core but I think that omits variants if it is not found in all genomes.

Many thanks for your guidance,",smb20200615,https://github.com/tseemann/snippy/issues/492
I_kwDOAS4qDc5Aoz_E,A Problem,OPEN,2021-12-20T07:12:30Z,2021-12-20T07:12:30Z,,"I have some problems. When using snippy,  gbk file and fasta file, are downloaded from NCBI. The code is as follows: 
snippy --outdir test1 --ref test.gbk --ctgs test.fa 
[14:47:23] This is snippy 4.6.0
[14:47:23] Written by Torsten Seemann
[14:47:23] Obtained from https://github.com/tseemann/snippy
[14:47:23] Detected operating system: linux
[14:47:23] Enabling bundled linux tools.
[14:47:23] Found bwa - /gss1/home/chenjf01/a/bin/bwa
[14:47:23] Found bcftools - /gss1/home/chenjf01/a/bin/bcftools
[14:47:23] Found samtools - /gss1/home/chenjf01/a/bin/samtools
[14:47:23] Found java - /gss1/home/chenjf01/a/bin/java
[14:47:23] Found snpEff - /gss1/home/chenjf01/a/bin/snpEff
[14:47:23] Found samclip - /gss1/home/chenjf01/a/bin/samclip
[14:47:23] Found seqtk - /gss1/home/chenjf01/a/bin/seqtk
[14:47:23] Found parallel - /gss1/home/chenjf01/a/bin/parallel
[14:47:23] Found freebayes - /gss1/home/chenjf01/a/bin/freebayes
[14:47:23] Found freebayes-parallel - /gss1/home/chenjf01/a/bin/freebayes-parallel
[14:47:23] Found fasta_generate_regions.py - /gss1/home/chenjf01/a/bin/fasta_generate_regions.py
[14:47:23] Found vcfstreamsort - /gss1/home/chenjf01/a/bin/vcfstreamsort
[14:47:23] Found vcfuniq - /gss1/home/chenjf01/a/bin/vcfuniq
[14:47:23] Found vcffirstheader - /gss1/home/chenjf01/a/bin/vcffirstheader
[14:47:23] Found gzip - /bin/gzip
[14:47:23] Found vt - /gss1/home/chenjf01/a/bin/vt
[14:47:23] Found snippy-vcf_to_tab - /gss1/home/chenjf01/a/bin/snippy-vcf_to_tab
[14:47:23] Found snippy-vcf_report - /gss1/home/chenjf01/a/bin/snippy-vcf_report
[14:47:23] Checking version: bcftools --version is >= 1.7 - ok, have 1.9
[14:47:23] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.2
[14:47:24] Checking version: snpEff -version is >= 4.3 - ok, have 5.0
[14:47:24] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[14:47:24] Using reference: /gss1/home/chenjf01/wh/test.gbk
[14:47:24] Treating reference as 'genbank' format.
[14:47:24] Will use 8 CPU cores.
[14:47:24] Using read file: /gss1/home/chenjf01/wh/test.fa
[14:47:24] Creating folder: test1
[14:47:24] Changing working directory: test1
[14:47:24] Creating reference folder: reference
[14:47:24] Extracting FASTA and GFF from reference.
[14:47:24] Wrote 3 sequences to ref.fa
[14:47:24] Wrote 300 features to ref.gff
[14:47:24] Shredding /gss1/home/chenjf01/wh/test.fa into pseudo-reads
[14:47:24] Wrote 25510 fake 250bp reads (20x, stride 25bp) to fake_reads.fq
[14:47:24] Creating reference/snpeff.config
[14:47:24] Freebayes will process 15 chunks of 21517 bp, 8 chunks at a time.
[14:47:24] Using BAM RG (Read Group) ID: test1
[14:47:24] Running: samtools faidx reference/ref.fa 2>> snps.log
[14:47:24] Running: bwa index reference/ref.fa 2>> snps.log
[14:47:25] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[14:47:25] Running: ln -sf reference/ref.fa . 2>> snps.log
[14:47:25] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[14:47:25] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[14:47:25] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[14:47:28] Running: bwa mem  -Y -M -R '@RG\tID:test1\tSM:test1' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam 2>> snps.log
sort: invalid option -- 'T'
sort: invalid option -- '-'
sort: invalid option -- 't'
sort: invalid option -- 'h'
sort: invalid option -- 'r'
sort: invalid option -- 'e'
sort: invalid option -- 'a'
sort: invalid option -- 'd'
sort: invalid option -- 's'
[bam_header_read] EOF marker is absent. The input is probably truncated.
[bam_header_read] invalid BAM binary header (this is not a BAM file).
sort: invalid option -- 'T'
sort: invalid option -- '-'
sort: invalid option -- 't'
fixmate: invalid option -- 'm'
sort: invalid option -- 'h'
sort: invalid option -- 'r'
fixmate: invalid option -- '-'
sort: invalid option -- 'e'
fixmate: invalid option -- 't'
sort: invalid option -- 'a'
fixmate: invalid option -- 'h'
sort: invalid option -- 'd'
fixmate: invalid option -- 'e'
sort: invalid option -- 's'
fixmate: invalid option -- 'a'
fixmate: invalid option -- 'd'
fixmate: invalid option -- 's'
[bam_header_read] EOF marker is absent. The input is probably truncated.
[bam_header_read] invalid BAM binary header (this is not a BAM file).
open: No such file or directory
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 3 sequences in reference/ref.fa.fai
[M::process] read 25510 sequences (6377500 bp)...
[M::mem_process_seqs] Processed 25510 reads in 2.189 CPU sec, 0.295 real sec
[14:47:28] Error running command, check test1/snps.log
",xialei012,https://github.com/tseemann/snippy/issues/493
I_kwDOAS4qDc5A4JkW,freebayes-parallel,OPEN,2021-12-24T17:28:56Z,2022-03-14T08:01:44Z,,"my command:
```snippy  --outdir test/mysnps --ref test/REF_GCF_904425475.1_MG1655_genomic\(1\).fna --ctgs test/11657_5\#1.fa""```
### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

dyld: Symbol not found: __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE13find_first_ofEPKcmm
  Referenced from: /usr/local/bin/vcfuniq
  Expected in: /usr/lib/libstdc++.6.dylib
 in /usr/local/bin/vcfuniq
dyld: Symbol not found: __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE13find_first_ofEPKcmm
  Referenced from: /usr/local/bin/vcfstreamsort
  Expected in: /usr/lib/libstdc++.6.dylib
 in /usr/local/bin/vcfstreamsort
Traceback (most recent call last):
  File ""/usr/local/bin/vcffirstheader"", line 16, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe
Exception ignored in: <_io.TextIOWrapper name='<stdout>' mode='w' encoding='utf-8'>
BrokenPipeError: [Errno 32] Broken pipe
/usr/local/bin/freebayes-parallel: line 40: 37224 Exit 141                ( cat ""$regionsfile"" | parallel -k -j ""$ncpus"" ""${command[@]}"" --region {} )
     37225 Exit 120                | vcffirstheader
     37226 Abort trap: 6           | vcfstreamsort -w 1000
     37228 Abort trap: 6           | vcfuniq",TheSky222,https://github.com/tseemann/snippy/issues/494
I_kwDOAS4qDc5B9e73,Compare mutations between two samples,OPEN,2022-01-18T08:56:35Z,2022-03-30T14:53:00Z,,"how to compare mutations between two matched samples?

For example: If you want to identify SNPs in one sample relative to another sample (for example, if you sequenced your lab wild-type strain and want to find out mutations relative to this wild-type). ",Tuberculosis-Public-Health-Lab,https://github.com/tseemann/snippy/issues/495
I_kwDOAS4qDc5B-p8v,"Snippy run, error at fasta_generate_regions.py",CLOSED,2022-01-18T14:00:37Z,2022-07-23T23:12:30Z,2022-01-18T15:21:01Z,"Hi all/Torsten,

Command:

snippy --cpus 8 --outdir /home/ubuntu/path/SC2_final/snippy_SC2-SC2_2 --ref /home/ubuntu/path/SC2_final/SC2_genome.fa --R1 /home/ubuntu/path/SC2_R1_combined-3.fastq.gz --R2 /home/ubuntu/path/SC2_R2_combined-3.fastq.gz




I'm running snippy using the above command, everything appears to run correctly (including until the end of ""samtools index snps.bam"", i then get the below error:




 fasta_generate_regions.py reference/ref.fa.fai 555403 > reference/ref.txt

  File ""/home/linuxbrew/.linuxbrew/bin/fasta_generate_regions.py"", line 7
    print ""usage: "", sys.argv[0], "" <fasta file or index file> <region size>""
          ^
SyntaxError: Missing parentheses in call to 'print'. Did you mean print(""usage: "", sys.argv[0], "" <fasta file or index file> <region size>"")?



Any advice on why this would happen would be greatly appreciated.
Cheers,
John.",Munnj90,https://github.com/tseemann/snippy/issues/496
I_kwDOAS4qDc5B_Eah,minfrac,OPEN,2022-01-18T15:35:47Z,2022-01-18T15:35:47Z,,"I've run it on Galaxy server using Minumum proportion for variant evidence with 0.9 or with 0.05 and as expected I got more snps using 0.05.
However, after installation of snippy in my linux machine when I run the command line for the same data, using either --minfrac 0.9, or --minfrac 0.05, or even without --minfrac in the command line, I always get exactly the same output. What do you think is the problem?
Thank you",v888888,https://github.com/tseemann/snippy/issues/497
I_kwDOAS4qDc5C8tan,How to use masking file,OPEN,2022-02-03T15:17:06Z,2022-03-22T05:31:32Z,,"Hi,
I am working to identify hqSNPs using snippy. I used Mummer for masking the repeats in the reference genome. I am trying to understand how to use the output file (Mummer-masked file that contains regions) in the following command at snippy or any way to mask the repeats using snippy.

snippy-multi input.tab --ref Reference.gbk --cpus 16 > runme.sh

Thanks!",sekhwal,https://github.com/tseemann/snippy/issues/498
I_kwDOAS4qDc5DQ_5t,[markdup] error reading header,OPEN,2022-02-09T13:15:20Z,2022-10-24T14:24:43Z,,"I have a simple header reading error from markdup that caused my snippy to fail... I've pasted the log file below.

```### echo snippy 4.6.0
### cd /lustre06/project/6000186/congxu/snippy/A.rubrum

### /home/congxu/0_def-barrett_project_congxu/snippy/bin/snippy --cpus 16 --outdir /home/congxu/scratch/A.rubrum_Aug9_G7_snps --ref GCA_900156265.1_IMG-taxon_2681812815_annotated_assembly_genomic.gbff --ctgs /home/congxu/scratch/Aug9_G7_mapped_contigs.fa

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.03 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.73 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.26 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 2.344 sec; CPU: 1.073 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

Picked up JAVA_TOOL_OPTIONS: -Xmx2g
WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:A.rubrum_Aug9_G7_snps\tSM:A.rubrum_Aug9_G7_snps' -t 16 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 7 -m 1000M | samtools fixmate -m --threads 7 - - | samtools sort -l 0 -T /tmp --threads 7 -m 1000M | samtools markdup -T /tmp --threads 7 -r -s - - > snps.bam

[markdup] error reading header",charlescongxu,https://github.com/tseemann/snippy/issues/499
I_kwDOAS4qDc5EAjo0,snippy-core outputting more snps?,OPEN,2022-02-17T08:03:47Z,2022-02-17T08:03:47Z,,"Hello,

I ran 21 isolates of complete genome (each one >1.5Mb) through snippy and then called ""snippy-core"" with the ""snippy-multi"" command, and it seemed work and no given error message. I got some output but the number of 'core-snps' generated was more among of each isolate-SNPs (e.g., each of those isolate had 35k - 50k SNPs when aligned to a 3.5Mb reference genome, and the 'core' snps had 182K). How could I get least core-snps (least core-snps as compared each of these isolates) for the complete genome?

Any suggestion about that???

Thank You.
Hizbullah",hizbullahkhan,https://github.com/tseemann/snippy/issues/500
I_kwDOAS4qDc5FboFT,"Exception in thread ""main"" java.lang.UnsupportedClassVersionError",OPEN,2022-03-10T07:50:09Z,2022-04-15T06:58:26Z,,"when i train  snippy using the data offered by author,
snippy --outdir mut1 --ref example.gbk --ctgs example.fna
I have the following problem:
Error: A JNI error has occurred, please check your installation and try again
Exception in thread ""main"" java.lang.UnsupportedClassVersionError: org/snpeff/SnpEff has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:757)
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
        at java.net.URLClassLoader.defineClass(URLClassLoader.java:473)
        at java.net.URLClassLoader.access$100(URLClassLoader.java:74)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:369)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:363)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:362)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:419)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:352)
        at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:601)

I check my snippy version:snippy 4.6.0
java version:
java version ""1.8.0_60""
Java(TM) SE Runtime Environment (build 1.8.0_60-b27)
Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)

I'm new to the command line, has anyone else had a similar problem, please help me

",wangyuan1234,https://github.com/tseemann/snippy/issues/501
I_kwDOAS4qDc5Gbec6,Error in running ,OPEN,2022-03-26T09:07:01Z,2022-03-28T18:41:32Z,,"Hello all, I am trying to do vcf through snippy, but I got some errors. I have attached the log file, please help me!!!
[snps.log](https://github.com/tseemann/snippy/files/8355048/snps.log)
[Screenshot from 2022-03-26 14-27-51](https://user-images.githubusercontent.com/92774704/160232658-7da7431d-ab24-4da1-9cea-b304e75816e7.png)
",mtpae,https://github.com/tseemann/snippy/issues/502
I_kwDOAS4qDc5GfYjO,snippy error,OPEN,2022-03-27T19:10:11Z,2022-03-30T14:50:38Z,,"I am running snippy using following command. However, it shows the following error..

snippy --cpus 8 --outdir variants --ref reference.gbk --R1 trimmed_S_010_R1.fastq.gz --R2 trimmed_S_010_R2.fastq.gz 


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

Error: A JNI error has occurred, please check your installation and try again
Exception in thread ""main"" java.lang.UnsupportedClassVersionError: org/snpeff/SnpEff has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:757)
	at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
	at java.net.URLClassLoader.defineClass(URLClassLoader.java:473)
	at java.net.URLClassLoader.access$100(URLClassLoader.java:74)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:369)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:363)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:362)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:419)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:352)
	at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:601)",sekhwal,https://github.com/tseemann/snippy/issues/503
I_kwDOAS4qDc5GlFJm,Output files not complete,OPEN,2022-03-29T00:00:51Z,2022-03-29T00:00:51Z,,"Hi, I've tried uninstalling and installing snippy again, bur I'm still having the same issues. The output files aren't complete and I get this error message (see screenshot). Can anyone help with this? Pleaseeee
![Screenshot 2022-03-29 at 00 59 40](https://user-images.githubusercontent.com/102562314/160506607-2b24aa78-c6f7-4c47-8143-c89426802a61.png)
 ",bisolaa,https://github.com/tseemann/snippy/issues/504
I_kwDOAS4qDc5G5AH4,Installation On Macbook M1,OPEN,2022-04-01T07:09:02Z,2022-05-21T04:46:46Z,,"I'm trying install Snippy on my Macbook with M1 chip. After ""brew install brewsci/bio/snippy"" and running snippy, it says:
Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module)
BEGIN failed--compilation aborted at /opt/anaconda3/bin/snippy line 11.


So how can I solve this error? Pls help me. Thks",wildcatyyf,https://github.com/tseemann/snippy/issues/505
I_kwDOAS4qDc5G5utu,Could not find .aligned.fa/.vcf in 73,OPEN,2022-04-01T09:49:45Z,2024-09-16T14:34:26Z,,"I'm trying to run snippy-multi for a few assembled genomes.
73	/xulie/shiyanshijiyuanfenxi/jiyuanxulie/73.fasta
75	/xulie/shiyanshijiyuanfenxi/jiyuanxulie/75.fasta
95	/xulie/shiyanshijiyuanfenxi/jiyuanxulie/95.fasta
A1	/xulie/shiyanshijiyuanfenxi/jiyuanxulie/A1.fasta
A6	/xulie/shiyanshijiyuanfenxi/jiyuanxulie/A6.fasta
D-3-11	/xulie/shiyanshijiyuanfenxi/jiyuanxulie/D-3-11.fasta
snippy-multi input.tab --reference Reference.gbk > 1.sh
./1.sh

The final result.
This is snippy-core 4.6.0
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools for linux
Found any2fasta - /root/miniconda3/envs/snippy/bin/any2fasta
Found samtools - /root/miniconda3/envs/snippy/bin/samtools
Found minimap2 - /root/miniconda3/envs/snippy/bin/minimap2
Found bedtools - /root/miniconda3/envs/snippy/bin/bedtools
Found snp-sites - /root/miniconda3/envs/snippy/bin/snp-sites
Saving reference FASTA: core.ref.fa
This is any2fasta 0.4.2
Opening '73/ref.fa'
Detected FASTA format
Read 27360 lines from '73/ref.fa'
Wrote 1 sequences from FASTA file.
Processed 1 files.
Done.
Loaded 1 sequences totalling 1641481 bp.
Will mask 0 regions totalling 0 bp ~ 0.00%
ERROR: Could not find .aligned.fa/.vcf in 73

Viewed the log results in each file showing
WARNING_GENE_NOT_FOUND: Too many 'WARNING_GENE_NOT_FOUND' warnings, no further warnings will be shown.
WARNING_FRAMES_ZERO: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
ERROR: CDS check file '/xulie/shiyanshijiyuanfenxi/jiyuanxulie/73/reference/./ref/cds.fa' not found.
ERROR: Protein check file '/xulie/shiyanshijiyuanfenxi/jiyuanxulie/73/reference/./ref/protein.fa' not found.
ERROR: Database check failed.

I don't know what to do can you help me",zhichusun,https://github.com/tseemann/snippy/issues/506
I_kwDOAS4qDc5Hh9Xd,"snippy-multi ""No SNPs were detected",CLOSED,2022-04-11T14:46:20Z,2022-04-19T14:13:40Z,2022-04-13T15:30:42Z,"I have been running snippy-multi with the following command. However, snippy shows following error. However, I used the same datasets previously with snippy and it was no any error that time but I installed new snippy (snippy=4.6.0 with bcftools=1.10), it shows the error.
---
snippy-multi input.tab --ref NC_003197_genomic.gbff --cpus 16 > runme.sh
sh ./runme.sh

--------error-------
Running: snp-sites -c -o core.aln core.full.aln
Warning: No SNPs were detected so there is nothing to output.
ERROR: Could not run: snp-sites -c -o core.aln core.full.aln

-------------
Snippy was installed using Bioconda: Below are the snippy configuration. Any help would be very much appreciated.

snippy --check
[10:42:50] This is snippy 4.6.0
[10:42:50] Written by Torsten Seemann
[10:42:50] Obtained from https://github.com/tseemann/snippy
[10:42:50] Detected operating system: linux
[10:42:50] Enabling bundled linux tools.
[10:42:50] Found bwa - /home/anaconda3/envs/snippy/bin/bwa
[10:42:50] Found bcftools - /home/anaconda3/envs/snippy/bin/bcftools
[10:42:50] Found samtools - /home/anaconda3/envs/snippy/bin/samtools
[10:42:50] Found java - /home/anaconda3/envs/snippy/bin/java
[10:42:50] Found snpEff - /home/anaconda3/envs/snippy/bin/snpEff
[10:42:50] Found samclip - /home/anaconda3/envs/snippy/bin/samclip
[10:42:50] Found seqtk - /home/anaconda3/envs/snippy/bin/seqtk
[10:42:50] Found parallel - /home/anaconda3/envs/snippy/bin/parallel
[10:42:50] Found freebayes - /home/anaconda3/envs/snippy/bin/freebayes
[10:42:50] Found freebayes-parallel - /home/anaconda3/envs/snippy/bin/freebayes-parallel
[10:42:50] Found fasta_generate_regions.py - /home/anaconda3/envs/snippy/bin/fasta_generate_regions.py
[10:42:50] Found vcfstreamsort - /home/anaconda3/envs/snippy/bin/vcfstreamsort
[10:42:50] Found vcfuniq - /home/anaconda3/envs/snippy/bin/vcfuniq
[10:42:50] Found vcffirstheader - /home/anaconda3/envs/snippy/bin/vcffirstheader
[10:42:50] Found gzip - /usr/bin/gzip
[10:42:50] Found vt - /home/anaconda3/envs/snippy/bin/vt
[10:42:50] Found snippy-vcf_to_tab - /home/anaconda3/envs/snippy/bin/snippy-vcf_to_tab
[10:42:50] Found snippy-vcf_report - /home/anaconda3/envs/snippy/bin/snippy-vcf_report
[10:42:50] Checking version: samtools --version is >= 1.7 - ok, have 1.10
[10:42:50] Checking version: bcftools --version is >= 1.7 - ok, have 1.10
[10:42:50] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.5
[10:42:50] Checking version: snpEff -version is >= 4.3 - ok, have 5.0
[10:42:50] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[10:42:50] Dependences look good!
",sekhwal,https://github.com/tseemann/snippy/issues/507
I_kwDOAS4qDc5HjT85,"""ERROR: Database check failed"" with snpEff and possible fix",OPEN,2022-04-11T19:31:46Z,2022-07-14T16:53:12Z,,"Thanks for the nice software! Hopefully this is not duplicated. I got this error when trying to run snippy, installed with mamba, on a gbk reference.

```
WARNING_GENE_NOT_FOUND: Too many 'WARNING_GENE_NOT_FOUND' warnings, no further warnings will be shown.
WARNING_FRAMES_ZERO: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
ERROR: CDS check file '/data/fer/Betsy/mysnps/reference/./ref/cds.fa' not found.
ERROR: Protein check file '/data/fer/Betsy/mysnps/reference/./ref/protein.fa' not found.
ERROR: Database check failed.
```

Fix was forcing conda to use `snpEff` version 4 instead of 5, with `conda install -c bioconda snpEff=4`. Snippy ran to completion and the output seems ok so far.",fpusan,https://github.com/tseemann/snippy/issues/508
I_kwDOAS4qDc5I8KkB,empty Snippy output,OPEN,2022-05-03T06:18:49Z,2024-01-23T13:50:43Z,,"Hi, 
I am running snippy but it is providing empty  .tab and .csv file which means no output.
I am attaching the log file so if anyone can help me.
[snps.log](https://github.com/tseemann/snippy/files/8608539/snps.log)

## echo snippy 4.6.0
### cd /srv/scratch/z5045473/GP

### /apps/snippy/4.6.0/bin/snippy --cpus 16 --outdir mysnps --ref /srv/scratch/z5045473/GP/isolate2/sequence.gb --R1 /srv/scratch/z5045473/GP/isolate2/UJ2_1.fastq.gz --R2 /srv/scratch/z5045473/GP/isolate2/UJ2_2.fastq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.02 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.05 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.50 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 1.759 sec; CPU: 1.627 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:mysnps\tSM:mysnps' -t 16 reference/ref.fa /srv/scratch/z5045473/GP/isolate2/UJ2_1.fastq.gz /srv/scratch/z5045473/GP/isolate2/UJ2_2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /scratch/pbs.2803002.kman.restech.unsw.edu.au --threads 7 -m 1000M | samtools fixmate -m --threads 7 - - | samtools sort -l 0 -T /scratch/pbs.2803002.kman.restech.unsw.edu.au --threads 7 -m 1000M | samtools markdup -T /scratch/pbs.2803002.kman.restech.unsw.edu.au --threads 7 -r -s - - > snps.bam

READ 18098514 WRITTEN 18077493 
EXCLUDED 18074177 EXAMINED 24337
PAIRED 1690 SINGLE 22647
DULPICATE PAIR 282 DUPLICATE SINGLE 20739
DUPLICATE TOTAL 21021

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 172938 > reference/ref.txt


### freebayes-parallel reference/ref.txt 16 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf


### /apps/snippy/4.6.0/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 0 SNPs to TAB format.

### /apps/snippy/4.6.0/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf


### bcftools convert -Oz -o snps.vcf.gz snps.vcf


### bcftools index -f snps.vcf.gz


### bcftools consensus --sample mysnps -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz


### bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf


### bcftools index -f snps.subs.vcf.gz


### bcftools consensus --sample mysnps -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz


### rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi



 ",Mahjabeenkhan58,https://github.com/tseemann/snippy/issues/509
I_kwDOAS4qDc5JZa3d,dyld: Symbol not found: __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE13find_first_ofEPKcm - Failed to read from standard input: unknown file type,OPEN,2022-05-10T16:18:38Z,2022-06-09T09:10:27Z,,"My code and printed output:

> (base) bio-24046:~ jvanderwoude3$ snippy --outdir trial --ref PAO1.gbk --R1 CF1_LeftLower_D12_R1.fastq.gz --R2 CF1_LeftLower_D12_R2.fastq.gz
> [12:13:56] This is snippy 4.6.0
> [12:13:56] Written by Torsten Seemann
> [12:13:56] Obtained from https://github.com/tseemann/snippy
> [12:13:56] Detected operating system: darwin
> [12:13:56] Enabling bundled darwin tools.
> [12:13:56] Found bwa - /usr/local/bin/bwa
> [12:13:56] Found bcftools - /usr/local/bin/bcftools
> [12:13:56] Found samtools - /usr/local/bin/samtools
> [12:13:56] Found java - /usr/bin/java
> [12:13:56] Found snpEff - /usr/local/bin/snpEff
> [12:13:56] Found samclip - /usr/local/bin/samclip
> [12:13:56] Found seqtk - /usr/local/bin/seqtk
> [12:13:56] Found parallel - /usr/local/bin/parallel
> [12:13:56] Found freebayes - /usr/local/bin/freebayes
> [12:13:56] Found freebayes-parallel - /usr/local/Cellar/snippy/4.6.0/binaries/noarch/freebayes-parallel
> [12:13:56] Found fasta_generate_regions.py - /usr/local/Cellar/snippy/4.6.0/binaries/noarch/fasta_generate_regions.py
> [12:13:56] Found vcfstreamsort - /usr/local/bin/vcfstreamsort
> [12:13:56] Found vcfuniq - /usr/local/bin/vcfuniq
> [12:13:56] Found vcffirstheader - /usr/local/bin/vcffirstheader
> [12:13:56] Found gzip - /usr/bin/gzip
> [12:13:56] Found vt - /usr/local/bin/vt
> [12:13:56] Found snippy-vcf_to_tab - /usr/local/Cellar/snippy/4.6.0/bin/snippy-vcf_to_tab
> [12:13:56] Found snippy-vcf_report - /usr/local/Cellar/snippy/4.6.0/bin/snippy-vcf_report
> [12:13:56] Checking version: samtools --version is >= 1.7 - ok, have 1.15
> [12:13:56] Checking version: bcftools --version is >= 1.7 - ok, have 1.15
> [12:13:56] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.6
> [12:13:56] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
> [12:13:56] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
> [12:13:56] Using reference: /Users/jvanderwoude3/PAO1.gbk
> [12:13:56] Treating reference as 'genbank' format.
> [12:13:56] Will use 8 CPU cores.
> [12:13:56] Using read file: /Users/jvanderwoude3/CF1_LeftLower_D12_R1.fastq.gz
> [12:13:56] Using read file: /Users/jvanderwoude3/CF1_LeftLower_D12_R2.fastq.gz
> [12:13:56] Creating folder: trial
> [12:13:56] Changing working directory: trial
> [12:13:56] Creating reference folder: reference
> [12:13:56] Extracting FASTA and GFF from reference.
> [12:13:59] Wrote 1 sequences to ref.fa
> [12:13:59] Wrote 5713 features to ref.gff
> [12:13:59] Creating reference/snpeff.config
> [12:13:59] Freebayes will process 15 chunks of 424592 bp, 8 chunks at a time.
> [12:13:59] Using BAM RG (Read Group) ID: trial
> [12:13:59] Running: samtools faidx reference/ref.fa 2>> snps.log
> [12:13:59] Running: bwa index reference/ref.fa 2>> snps.log
> [12:14:01] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
> [12:14:01] Running: ln -sf reference/ref.fa . 2>> snps.log
> [12:14:01] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
> [12:14:01] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
> [12:14:01] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
> [12:14:05] Running: bwa mem  -Y -M -R '@RG\tID:trial\tSM:trial' -t 8 reference/ref.fa /Users/jvanderwoude3/CF1_LeftLower_D12_R1.fastq.gz /Users/jvanderwoude3/CF1_LeftLower_D12_R2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -m 2000M | samtools markdup -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -r -s - - > snps.bam 2>> snps.log
> [M::bwa_idx_load_from_disk] read 0 ALT contigs
> [samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
> [samclip] Loading: reference/ref.fa.fai
> [samclip] Found 1 sequences in reference/ref.fa.fai
> [M::process] read 828570 sequences (73856120 bp)...
> [M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (132, 297362, 126, 133)
> [M::mem_pestat] analyzing insert size distribution for orientation FF...
> [M::mem_pestat] (25, 50, 75) percentile: (328, 501, 922)
> [M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 2110)
> [M::mem_pestat] mean and std.dev: (486.71, 312.74)
> [M::mem_pestat] low and high boundaries for proper pairs: (1, 2704)
> [M::mem_pestat] analyzing insert size distribution for orientation FR...
> [M::mem_pestat] (25, 50, 75) percentile: (337, 456, 629)
> [M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1213)
> [M::mem_pestat] mean and std.dev: (496.04, 216.49)
> [M::mem_pestat] low and high boundaries for proper pairs: (1, 1505)
> [M::mem_pestat] analyzing insert size distribution for orientation RF...
> [M::mem_pestat] (25, 50, 75) percentile: (133, 1128, 3535)
> [M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 10339)
> [M::mem_pestat] mean and std.dev: (2248.12, 2781.25)
> [M::mem_pestat] low and high boundaries for proper pairs: (1, 13741)
> [M::mem_pestat] analyzing insert size distribution for orientation RR...
> [M::mem_pestat] (25, 50, 75) percentile: (304, 491, 809)
> [M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 1819)
> [M::mem_pestat] mean and std.dev: (452.31, 232.94)
> [M::mem_pestat] low and high boundaries for proper pairs: (1, 2324)
> [M::mem_pestat] skip orientation FF
> [M::mem_pestat] skip orientation RF
> [M::mem_pestat] skip orientation RR
> [M::mem_process_seqs] Processed 828570 reads in 31.228 CPU sec, 3.931 real sec
> [samclip] Processed 100000 records...
> [samclip] Processed 200000 records...
> [samclip] Processed 300000 records...
> [samclip] Processed 400000 records...
> [samclip] Processed 500000 records...
> [samclip] Processed 600000 records...
> [samclip] Processed 700000 records...
> [samclip] Processed 800000 records...
> [main] Version: 0.7.17-r1188
> [main] CMD: bwa mem -Y -M -R @RG\tID:trial\tSM:trial -t 8 reference/ref.fa /Users/jvanderwoude3/CF1_LeftLower_D12_R1.fastq.gz /Users/jvanderwoude3/CF1_LeftLower_D12_R2.fastq.gz
> [main] Real time: 8.213 sec; CPU: 33.380 sec
> [samclip] Total SAM records 838680, removed 36347, allowed 10230, passed 802333
> [samclip] Header contained 3 lines
> [samclip] Done.
> [bam_sort_core] merging from 0 files and 3 in-memory blocks...
> [bam_sort_core] merging from 0 files and 3 in-memory blocks...
> [12:14:19] Running: samtools index snps.bam 2>> snps.log
> [12:14:19] Running: fasta_generate_regions.py reference/ref.fa.fai 424592 > reference/ref.txt 2>> snps.log
> [12:14:20] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
> [12:14:24] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
> dyld: Symbol not found: __ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE13find_first_ofEPKcm
>   Referenced from: /usr/local/bin/vt
>   Expected in: /usr/lib/libstdc++.6.dylib
>  in /usr/local/bin/vt
> [12:14:24] Error running command, check trial/snps.log

trial/snps.log output:

> ### echo snippy 4.6.0
> ### cd /Users/jvanderwoude3
> 
> ### /usr/local/bin/snippy --outdir trial --ref PAO1.gbk --R1 CF1_LeftLower_D12_R1.fastq.gz --R2 CF1_LeftLower_D12_R2.fastq.gz
> 
> ### samtools faidx reference/ref.fa
> 
> 
> ### bwa index reference/ref.fa
> 
> [bwa_index] Pack FASTA... 0.05 sec
> [bwa_index] Construct BWT for the packed sequence...
> [bwa_index] 1.50 seconds elapse.
> [bwa_index] Update BWT... 0.04 sec
> [bwa_index] Pack forward-only FASTA... 0.03 sec
> [bwa_index] Construct SA from BWT and Occ... 0.40 sec
> [main] Version: 0.7.17-r1188
> [main] CMD: bwa index reference/ref.fa
> [main] Real time: 2.020 sec; CPU: 2.016 sec
> 
> ### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa
> 
> 
> ### ln -sf reference/ref.fa .
> 
> 
> ### ln -sf reference/ref.fa.fai .
> 
> 
> ### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz
> 
> 
> ### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref
> 
> WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
> 
> ### bwa mem  -Y -M -R '@RG\tID:trial\tSM:trial' -t 8 reference/ref.fa /Users/jvanderwoude3/CF1_LeftLower_D12_R1.fastq.gz /Users/jvanderwoude3/CF1_LeftLower_D12_R2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -m 2000M | samtools markdup -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -r -s - - > snps.bam
> 
> COMMAND: samtools markdup -T /private/var/folders/qr/bwx01b092d3c1p5yq_4hrrhcz1glm0/T --threads 3 -r -s - -
> READ: 802333
> WRITTEN: 792959
> EXCLUDED: 127697
> EXAMINED: 674636
> PAIRED: 640604
> SINGLE: 34032
> DUPLICATE PAIR: 2956
> DUPLICATE SINGLE: 6418
> DUPLICATE PAIR OPTICAL: 0
> DUPLICATE SINGLE OPTICAL: 0
> DUPLICATE NON PRIMARY: 0
> DUPLICATE NON PRIMARY OPTICAL: 0
> DUPLICATE PRIMARY TOTAL: 9374
> DUPLICATE TOTAL: 9374
> ESTIMATED_LIBRARY_SIZE: 34599974
> 
> ### samtools index snps.bam
> 
> 
> ### fasta_generate_regions.py reference/ref.fa.fai 424592 > reference/ref.txt
> 
> 
> ### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf
> 
> 
> ### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf
> 
> Failed to read from standard input: unknown file type",jellyvanderwoude,https://github.com/tseemann/snippy/issues/510
I_kwDOAS4qDc5Jrwk5,snippy installation was unsuccessful,OPEN,2022-05-15T07:11:02Z,2022-10-18T11:00:37Z,,"[14:55:34] Need samtools --version >= 1.7 but you have 0 - please upgrade it.
How to solve this problem, please?",yimeng2099,https://github.com/tseemann/snippy/issues/511
I_kwDOAS4qDc5MHZAR,snippy-core bioperl error in generating full alignment ,CLOSED,2022-06-20T14:19:17Z,2022-06-20T14:57:01Z,2022-06-20T14:57:01Z,"Hi -- found an unusual bug that seems to do with sequence formatting when running snippy-core. I assume it has to be my sequences being improperly formatted, but I can't figure out where the problem characters are.

Thanks,
Braden

Output is attached, with the relevant portion copied here:

Command:

snippy-core --ref=GCA_000369045.1_Acin_pitt_CIP_70_29_V1_genomic_type-strain.fna --prefix typestrain SRR12197333_type-strain SRR12197334_type-strain SRR12197335_type-strain SRR12197336_type-strain SRR13530701_type-strain SRR13530703_type-strain SRR13530708_type-strain SRR13530709_type-strain SRR13530712_type-strain SRR13530713_type-strain SRR13530716_type-strain SRR13530717_type-strain  SRR13530725_type-strain SRR13530727_type-strain SRR13530728_type-strain SRR13530729_type-strain SRR13530730_type-strain SRR13530731_type-strain SRR5511026_type-strain SRR5519664_type-strain &> snippy_out.txt

Relevant error:

------------- EXCEPTION -------------
MSG: Failed validation of sequence '1'. Invalid characters were: ,,
STACK Bio::PrimarySeq::validate_seq /pbtech_mounts/homes064/btt4001/miniconda3/envs/snippy/lib/perl5/site_perl/Bio/PrimarySeq.pm:338
STACK Bio::PrimarySeq::_set_seq_by_ref /pbtech_mounts/homes064/btt4001/miniconda3/envs/snippy/lib/perl5/site_perl/Bio/PrimarySeq.pm:287
STACK Bio::PrimarySeq::seq /pbtech_mounts/homes064/btt4001/miniconda3/envs/snippy/lib/perl5/site_perl/Bio/PrimarySeq.pm:272
STACK Bio::PrimarySeq::new /pbtech_mounts/homes064/btt4001/miniconda3/envs/snippy/lib/perl5/site_perl/Bio/PrimarySeq.pm:229
STACK Bio::Seq::new /pbtech_mounts/homes064/btt4001/miniconda3/envs/snippy/lib/perl5/site_perl/Bio/Seq.pm:499
STACK main::save_fasta_hash /home/btt4001/miniconda3/envs/snippy/bin/snippy-core:412
STACK toplevel /home/btt4001/miniconda3/envs/snippy/bin/snippy-core:321
-------------------------------------
[snippy_out.txt](https://github.com/tseemann/snippy/files/8941384/snippy_out.txt)

",b-tierney,https://github.com/tseemann/snippy/issues/512
I_kwDOAS4qDc5MV59Y,Solved ,CLOSED,2022-06-22T20:07:31Z,2022-06-23T17:44:34Z,2022-06-23T17:44:34Z,I managed to solve the error.,miraalchaar,https://github.com/tseemann/snippy/issues/513
I_kwDOAS4qDc5MvLls,Process to produce mapping quality mask,OPEN,2022-06-28T14:27:31Z,2022-06-28T14:27:31Z,,"Hi,

I had encounter a case with a SNP not detected by Snippy on a strain (call it 'toto'). After running Snippy-core (with ""toto""), the resulting "".vcf"" show for this SNP on ""toto"" the reference base (logical).

But why, the SNP is not detected in Snippy ?

After few try, i spot that freebayes ""mapping quality"" parameter is essential (**-m** in Freebayes). I change it of 60 (default) to 50 and the SNP is detect !

So...
In my use of Snippy-core, i had already produce a bed mask of minimum coverage but, now, i am looking on a process to produce a mask on minimum mapping quality or (maybe better solution) a process to remove this SNP on the output vcf of Snippy-core.

If someone have an idea to how solve it ?

Thanks in advance for tips and help on this subject.

Have a good day =)",Nilad,https://github.com/tseemann/snippy/issues/514
I_kwDOAS4qDc5Mx7eH,snippy for virus ?,OPEN,2022-06-29T04:28:51Z,2022-06-29T04:28:51Z,,can I use snippy for variants calling in a virus genome ?? ,hafizmtalha,https://github.com/tseemann/snippy/issues/515
I_kwDOAS4qDc5Nkl37,snippy-multi - bed targets file is not open,OPEN,2022-07-12T02:04:21Z,2023-02-03T08:46:34Z,,"Hi! Thanks for this useful program!

This is the first time I use snippy-multi. 
This is my `input.tab` file:

```
PNG84A	/media/koala/Main/mishell/snippy-multi/t1/210.2442.fna
G272	/media/koala/Main/mishell/snippy-multi/t1/210.2712.fna
```

My target proteins in my `virulent_proteins_targets.bed` (tab file)

```
CP003904    806853  808877  fliD
CP003904    445347  448223  23Srna  
```

The commands that I ran were:
`snippy-multi input.tab --ref ncbi_hp_26695.gb --cpus 2 --targets virulent_protein_targets.bed > runme2.sh`
Then:
```
Reading: input.tab
Generating output commands for 2 isolates
Done.
```

And finally:
`bash runme2.sh`

While it was running I noticed this message:

> [20:24:12] Running: freebayes-parallel reference/ref.txt 2 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   --targets '/media/koala/Main/mishell/snippy-multi/t1/PNG84A/virulent_protein_targets.bed' -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[20:24:12] **Error running command**, check PNG84A/snps.log

It kept running but ended with it showed this message:

> [samclip] Total SAM records 128955, removed 17882, allowed 7721, passed 111073
> [samclip] Header contained 3 lines
> [samclip] Done.
> [20:24:41] Running: samtools index snps.bam 2>> snps.log
> [20:24:41] Running: fasta_generate_regions.py reference/ref.fa.fai 565248 > reference/ref.txt 2>> snps.log
> [20:24:41] **Running: freebayes-parallel** reference/ref.txt 2 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   **--targets** '/media/koala/Main/mishell/snippy-multi/t1/G272/**virulent_protein_targets.bed**' -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
> [20:24:41] **Error running command, check G272/snps.log**

I wanted to go and check that `G272/snps.log` but I waited until the program ended.

The program kept running:

> This is snippy-core 4.6.0
> Obtained from http://github.com/tseemann/snippy
> Enabling bundled tools for linux
> Found any2fasta - /home/koala/biotools/snippy/binaries/noarch/any2fasta
> Found samtools - /home/koala/anaconda3/bin/samtools
> Found minimap2 - /home/koala/anaconda3/bin/minimap2
> Found bedtools - /home/koala/anaconda3/bin/bedtools
> Found snp-sites - /home/koala/biotools/bin/snp-sites
> Saving reference FASTA: core.ref.fa
> This is any2fasta 0.4.2
> Opening 'G272/ref.fa'
> Detected FASTA format
> Read 27800 lines from 'G272/ref.fa'
> Wrote 1 sequences from FASTA file.
> Processed 1 files.
> Done.
> Loaded 1 sequences totalling 1667892 bp.
> Will mask 0 regions totalling 0 bp ~ 0.00%
> **ERROR: Could not find .aligned.fa/.vcf in G272**

And it stops there.
The previous message before the end said  `[20:24:41] Error running command, check G272/snps.log`

I wen to check that file, there was a warning:

```
### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.
```

But it kept running until this point:

```
### freebayes-parallel reference/ref.txt 2 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   --targets '/media/koala/Main/mishell/snippy-multi/t1/G272/virulent_protein_targets.bed' -f reference/ref.fa snps.bam > snps.raw.vcf

bed targets file is not open
bed targets file is not open
bed targets file is not open
```

What does it mean by that? I'm uploading here my bed file (changing it to .txt because github doesn't support that type of file (bed):
[virulent_protein_targets.txt](https://github.com/tseemann/snippy/files/9088765/virulent_protein_targets.txt)
.

I will be very grateful if you could help me with this issue. 

Thanks a lot in advance :)",Silverfoxcome,https://github.com/tseemann/snippy/issues/516
I_kwDOAS4qDc5OQkAq,logs_,OPEN,2022-07-21T09:34:02Z,2022-07-21T09:34:02Z,,"Hi, 

Not reporting a problem, just a comment, but perhaps someone might have a better way of going about this:

Regarding the vow: ""wish you a life free of homopolymer errors"" at the end of a run. 
In Catching Exceptions.

Ive found myself deploying runs multiple runs through a manager (python). Besides checking for requested output presence and size, i check stderr for errors when deploying software. Ive found that many software output logs to stderr so i thought to parse these for the string ""error"" in lower case.

this resulted in stopped execution of my runs after snippy deployed. Ive added a specific filter, but am wondering if this could be changed. or if someone could suggest a better way? 

Ty, 
Best, 
Joao",SantosJGND,https://github.com/tseemann/snippy/issues/517
I_kwDOAS4qDc5OaTe_,vcflib error (freebayes-parallel),OPEN,2022-07-23T01:13:16Z,2022-07-23T01:13:16Z,,"Hello
I am trying to run freebayes (as part of snippy) but get this error
I do have vcflib isntalled in my env

/opt/miniconda3/envs/instaflu_env/bin/freebayes-parallel: line 40:  1655 Done                    ( cat ""$regionsfile"" | parallel -k -j ""$ncpus"" ""${command[@]}"" --region {} )
      1656 Exit 1                  | vcffirstheader
      1658 Abort trap: 6           | vcfstreamsort -w 1000
      1660 Abort trap: 6           | vcfuniq

also attached the log file for snippy if it helps

thank you!

[snps.log](https://github.com/tseemann/snippy/files/9172826/snps.log)
",antoine4ucsd,https://github.com/tseemann/snippy/issues/518
I_kwDOAS4qDc5Ok1tP,ERROR: missing read/contig data: ,OPEN,2022-07-26T13:52:58Z,2022-07-26T13:52:58Z,,"Hi, i am trying to run snippy regarding SNP analysis and it give following error, please have a look 

**snippy-multi /home/bvs/Neelam/annotated/fna/input.tab --reference /home/bvs/Neelam/annotated/gbk/P_aeruginosa_PAO1.gbk --cpus 16 > out**
Reading: /home/bvs/Neelam/annotated/fna/input.tab
ERROR: [Isolate1_/home/bvs/Neelam/annotated/fna/P_aeruginosa_DVT419.fna] missing read/contig data: Isolate1 /home/bvs/Neelam/annotated/fna/P_aeruginosa_DVT419.fna


Thank you",neelam19051,https://github.com/tseemann/snippy/issues/519
I_kwDOAS4qDc5OnTTf,freebayes-parallel issue ,OPEN,2022-07-27T01:58:35Z,2022-07-27T01:59:46Z,,"Hello,
snippy was working great - I then ran `brew update` and things went downhill. This is the error (and see log):

```
Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[21:38:58] Error running command, check ./Cneg_ord_REF/A2/snps.log
```

I uninstalled snippy, freebayes and vcflib and run again
`brew install snippy` and got freebayes and vcflib dependences.

`snippy --check` says Dependences look good! Running freebayes alone does not produce an error. Running snippy 4.6 on Linux.

Thanks in advance
[snps.log](https://github.com/tseemann/snippy/files/9194410/snps.log)
",osekulovic,https://github.com/tseemann/snippy/issues/520
I_kwDOAS4qDc5OnePU,ERROR:missing read/contig data: ,OPEN,2022-07-27T03:25:07Z,2022-07-27T03:25:07Z,,"Hi, i am trying to run snippy regarding SNP analysis and it give following error, please have a look 

**snippy-multi /home/bvs/Neelam/annotated/fna/input.tab --reference /home/bvs/Neelam/annotated/gbk/P_aeruginosa_PAO1.gbk --cpus 16 > out**
Reading: /home/bvs/Neelam/annotated/fna/input.tab
ERROR: [Isolate1_/home/bvs/Neelam/annotated/fna/P_aeruginosa_DVT419.fna] missing read/contig data: Isolate1 /home/bvs/Neelam/annotated/fna/P_aeruginosa_DVT419.fna


Thank you",neelam19051,https://github.com/tseemann/snippy/issues/521
I_kwDOAS4qDc5Osrid,FOREVER REPORT:Can't locate Bio/SeqIO.pm in @inc (you may need to install the Bio::SeqIO module,OPEN,2022-07-28T03:15:23Z,2022-07-28T03:15:23Z,,"I try to use miniconda ad create a new environment install SNIPPY ,it still report ""line11""error. 
I change my system from centos to Ubuntu.It stll report...
the only I could use is1 Docker,But I don''t know how to read sequencing data in docker!
help me please!!
thanks a lot!!",Albertzhuo123,https://github.com/tseemann/snippy/issues/522
I_kwDOAS4qDc5Qb6_p,Merging Snippy-core outputs,OPEN,2022-08-24T13:59:48Z,2022-09-15T08:17:52Z,,"Dear all,

 I am running snippy core on a lot of samples (around 1000) but for processing reasons I cannot run snippy and then snippy-core on all samples at once. My question is, if I use the same reference for every snippy and then snippy-core run, would it be valid to then manually merge all the snippy-core outputs into one file?
My guess is that as I used every time the same reference, the SNP sites this would be a valid approach but I don't know how well positions are represented in the final outcome.
Would it be better to compute snippy for every sample with the same reference, then merge these outputs and finally perform a snippy-core analysis?

Thank you!

EDIT: I have been asking around in my workplace and it seems that I have the opportunity to upgrade my VM with an important amount of resources, these need to be justified though. In this case, I would run snippy-multi, my question is how many resources would you suggest for this tool to run smoothly. I don't mind it taking a while as long as it doesn't crash.

Thanks again!",alanxelena,https://github.com/tseemann/snippy/issues/523
I_kwDOAS4qDc5Rpm-u,ln: failed to create symbolic link './ref.fa': Operation not supported,CLOSED,2022-09-12T12:54:29Z,2022-09-12T13:54:52Z,2022-09-12T13:54:52Z,"Hi Torsten (and all):

I'm running Snippy 4.6.0 and I get this error message:

ln: failed to create symbolic link './ref.fa': Operation not supported

This happens while reading .fasta and .gbk files. I've seen that there was a similar problem a while ago with version 4.0, is this still a thing? The answer was to change the main snippy script but I have no idea how to do that. Could you please help me?

Thank you!",alanxelena,https://github.com/tseemann/snippy/issues/524
I_kwDOAS4qDc5SBZRU,Error with dependency version (snpEff) when submitting job using sbatch,OPEN,2022-09-16T15:20:24Z,2022-09-16T15:20:24Z,,"Hi,
I am using snippy and have snpEff 5.1d installed when installing snippy. Test run smoothly locally but error occur when submitting job to HPC using sbatch.

[15:43:07] Found snpEff - /hpc-work/.conda/envs/snippy/bin/snpEff
...
...
[15:43:07] Need snpEff -version >= 4.3 but you have 0.001 - please upgrade it.

However when I check the version of snpEff, it is correct version 5.1d.

Wondering what cuased the error..

Many thanks and best.
Rui",Guan06,https://github.com/tseemann/snippy/issues/525
I_kwDOAS4qDc5SJw-U,"What does the ""het"" say?",OPEN,2022-09-19T17:29:34Z,2022-09-19T17:29:34Z,,"Hi,
When I use snippy-core, it prints out tables like this:
0 plasmid1 snp=314 del=1 ins=4 het=3 unaligned=12667
1 palsmid2 snp=563 del=4 ins=2 het=5 unaligned=16502
2 plasmid3 snp=1261 del=21 ins=8 het=0 unaligned=19473

What does the het means? I see in the code that it refers to heterogenous sites, but the input sequences I use are haploid plasmids.

Thanks!",fredericQC,https://github.com/tseemann/snippy/issues/526
I_kwDOAS4qDc5SNrUQ,Error in running snippy-multi,OPEN,2022-09-20T12:10:16Z,2022-12-07T13:30:02Z,,"I get an error message when running snippy-multi for my .fastq files `ERROR: Could not find .aligned.fa/.vcf in (snippy folder)`. When I open the folder indeed .aligned.fa/.vcf is not found. The snps.log file says `[markdup] error reading header`. The .bam file is empty as well.
I am trying using contigs as input but getting the same error. Is there any solution to this issue?
Thank you",adimascf,https://github.com/tseemann/snippy/issues/527
I_kwDOAS4qDc5ScVBA,Error running snippy ,OPEN,2022-09-23T00:43:24Z,2022-09-23T00:43:24Z,,"bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf
dyld[7336]: Library not loaded: @rpath/libcrypto.3.dylib
  Referenced from: /Users/dhirajchundru/opt/anaconda3/envs/test/bin/vt
  Reason: tried: '/Users/dhirajchundru/opt/anaconda3/envs/test/bin/../lib/libcrypto.3.dylib' (no such file), '/Users/dhirajchundru/opt/anaconda3/envs/test/bin/../lib/libcrypto.3.dylib' (no such file), '/usr/local/lib/libcrypto.3.dylib' (no such file), '/usr/lib/libcrypto.3.dylib' (no such file)
[E::hts_open_format] Failed to open file ""snps.raw.vcf"" : No such file or directory
Failed to read from snps.raw.vcf: No such file or directory
Failed to read from standard input: unknown file type
zsh: exit 255   bcftools view --include  snps.raw.vcf | 
zsh: abort      vt normalize -r reference/ref.fa - | 
",dhiru16,https://github.com/tseemann/snippy/issues/528
I_kwDOAS4qDc5TbzNt,snippy-multi: Core genome length very small for clusters of closely-related intraspecies isolates,OPEN,2022-10-06T14:51:44Z,2022-12-07T08:44:35Z,,"Hello!
I ran snippy-multi on a dataset of about 20 bacterial isolates (*.fasta assemblies) within the same genus (_Enterobacter_ spp.). The core genome length (from core.aln) was around 273,000 base pairs. Based on a tree from this aligned fasta file, I detected two clusters (very closely-related). I re-ran snippy-multi on each of the two clusters (5-6 isolates each). The core genome length (core.aln) were only around 100-200 base pairs for each. However, because they are closely-related, I would expect them to be longer than 273,000. The 100-200 bp core alignment length seems very small and I'm wondering why the tool would not be working as expected.
Thank you.",tkiryuti,https://github.com/tseemann/snippy/issues/529
I_kwDOAS4qDc5UBiyy,Snippy -check issue,OPEN,2022-10-14T18:10:21Z,2022-10-14T18:10:21Z,,"Dear all,
I have an issue when the code 'snippy -check' is performed. Here's the detail. (Below)

snippy -check
[01:54:34] This is snippy 4.6.0
[01:54:34] Written by Torsten Seemann
[01:54:34] Obtained from https://github.com/tseemann/snippy
[01:54:34] Detected operating system: linux
[01:54:34] Enabling bundled linux tools.
[01:54:34] Found bwa - /root/anaconda3/envs/newsnippy/bin/bwa
[01:54:34] Found bcftools - /root/anaconda3/envs/newsnippy/bin/bcftools
[01:54:34] Found samtools - /root/anaconda3/envs/newsnippy/bin/samtools
[01:54:34] Found java - /root/anaconda3/envs/newsnippy/bin/java
[01:54:34] Found snpEff - /root/anaconda3/envs/newsnippy/bin/snpEff
[01:54:34] Found samclip - /root/anaconda3/envs/newsnippy/bin/samclip
[01:54:34] Found seqtk - /root/anaconda3/envs/newsnippy/bin/seqtk
[01:54:34] Found parallel - /root/anaconda3/envs/newsnippy/bin/parallel
[01:54:34] Found freebayes - /root/anaconda3/envs/newsnippy/bin/freebayes
[01:54:34] Found freebayes-parallel - /root/anaconda3/envs/newsnippy/bin/freebayes-parallel
[01:54:34] Found fasta_generate_regions.py - /root/anaconda3/envs/newsnippy/bin/fasta_generate_regions.py
[01:54:34] Found vcfstreamsort - /root/anaconda3/envs/newsnippy/bin/vcfstreamsort
[01:54:34] Found vcfuniq - /root/anaconda3/envs/newsnippy/bin/vcfuniq
[01:54:34] Found vcffirstheader - /root/anaconda3/envs/newsnippy/bin/vcffirstheader
[01:54:34] Found gzip - /bin/gzip
[01:54:34] Found vt - /root/anaconda3/envs/newsnippy/bin/vt
[01:54:34] Found snippy-vcf_to_tab - /root/anaconda3/envs/newsnippy/bin/snippy-vcf_to_tab
[01:54:34] Found snippy-vcf_report - /root/anaconda3/envs/newsnippy/bin/snippy-vcf_report
[01:54:34] Checking version: samtools --version is >= 1.7 - ok, have 1.16
[01:54:34] Checking version: bcftools --version is >= 1.7 - ok, have 1.16
[01:54:34] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.6
[01:54:34] Need snpEff -version >= 4.3 but you have 0.000 - please upgrade it.

However, when I use code `snpEff -version` ,it shows 'SnpEff  5.0e    2021-03-09' in the conda environment. 
I tried the code `conda install -c bioconda snpEff=4.3` mentioned in another issue, but only the version of snpEff is changed into 4.3. The snippy check problem still exists. I wonder if there's a solution to solve this problem and it would be appreciated if anyone can help me with this.

Thanks",MaximeWU,https://github.com/tseemann/snippy/issues/530
I_kwDOAS4qDc5UsXsO,【markdup】error reading header   I've solved,OPEN,2022-10-24T14:21:58Z,2022-10-24T14:23:24Z,,"
Solution: The running memory is greater than 8G
电脑内存大于8G",KEACER,https://github.com/tseemann/snippy/issues/532
I_kwDOAS4qDc5U-DHI,Missing parentheses in call to 'print',OPEN,2022-10-27T12:25:37Z,2022-11-12T23:57:20Z,,"Dear all,
I run the code ""snippy --outdir 'SJ_2016_1531' --R1 '/home/ND140/lm/cgMLST_test/SJ_2016_1531_R1.fastq.gz' --R2 '/home/ND140/lm/cgMLST_test/SJ_2016_1531_R2.fastq.gz' --ref /home/edwin/template/bwa/tb_h37rv.fasta --cpus 16"", it showed ""Error running command, check SJ_2016_1531/snps.log"".

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.07 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.28 seconds elapse.
[bwa_index] Update BWT... 0.07 sec
[bwa_index] Pack forward-only FASTA... 0.05 sec
[bwa_index] Construct SA from BWT and Occ... 0.88 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 3.367 sec; CPU: 3.352 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### (bwa mem  -v 2 -M -R '@RG   ID:snps SM:snps' -t 16 reference/ref.fa /home/ND140/lm/cgMLST_test/SJ_2016_1531_R1.fastq.gz /home/ND140/lm/cgMLST_test/SJ_2016_1531_R2.fastq.gz | samtools view -@ 16 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -o snps.bam -@ 16 -)

[E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t

### samtools index snps.bam

### samtools depth -q 20 snps.bam | bgzip > snps.depth.gz


### tabix -s 1 -b 2 -e 2 snps.depth.gz


### fasta_generate_regions.py reference/ref.fa.fai 70080 > reference/ref.txt

  File ""/home/lm/miniconda3/bin/fasta_generate_regions.py"", line 7
    print ""usage: "", sys.argv[0], "" <fasta file or index file> <region size>""
          ^
SyntaxError: Missing parentheses in call to 'print'. Did you mean print(""usage: "", sys.argv[0], "" <fasta file or index file> <region size>"")?

Someone can help me solve the problem?",limengfdu,https://github.com/tseemann/snippy/issues/533
I_kwDOAS4qDc5Vhh9u,SNIPPY-CORE ERROR: Could not extract base XX_Referenece.1:134 for isolate XXX_out,OPEN,2022-11-03T15:26:13Z,2023-09-24T04:11:24Z,,"Dear Tseemann, 

We got this unusual error when running snippy-core on the snippy output folders where it says: "" ERROR: Could not extract base NZ_CP084351.1:134 for isolate AD_SRR13280317_1.fastq_out""  (with NZ_CP084351 being the reference genome and AD_SRR13280317_1.fastq_out, the output folder of one of the samples.
We have tested different troubleshooting including excluding the sample that encountered the problem but the same error occurred again with another sample and this kept going on as we exclude more samples. 

There was no error with the initial snippy run. Is this a reference issue? or what is causing this problem as this has stopped the run and we could not reach the final steps of obtaining the full.aln file. 

Any suggestions? ",gilmahu,https://github.com/tseemann/snippy/issues/534
I_kwDOAS4qDc5V9W_m,How to interpret the differences of the result among two independently snippy-multi run?,OPEN,2022-11-09T13:54:01Z,2022-11-09T13:54:01Z,,"Hi, I'm using snippy-multi to obtain core-genome alignment and core SNPs among about 500 bacteria strains.

I tried to run twice independently using same dataset and same parameters, but the number of core SNPs between them was slightly different(280498 vs 280479).

How should I interpret this differences?

Thanks, 
",snackens,https://github.com/tseemann/snippy/issues/535
I_kwDOAS4qDc5Wj28C,Warning!: all frames are zero ,OPEN,2022-11-16T20:36:30Z,2022-11-16T20:57:00Z,,"I have installed snippy in mac OX intel 64 using brew. No issues checking dependencies, except that the bcftools version required was 1.7 and the one installed was 1.16. I installed version 1.7 from source into the usr/local and the snippy --check recognised all dependencies as OK. However after running snippy the program is aborted. The log file is below:
=======
### echo snippy 4.6.0
### cd /Users/valvano/Genomes/snippy/AC011/AC011_ref

### /usr/local/bin/snippy --outdir mysnps --force --ref AC011.gbk --R1 9278_AC011CR-1_1_trimmed.unmatched.fastq --R2 9278_AC011CR-1_2_trimmed.unmatched.fastq

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.05 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.23 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.57 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 2.924 sec; CPU: 2.908 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:mysnps\tSM:mysnps' -t 8 reference/ref.fa /Users/valvano/Genomes/snippy/AC011/AC011_ref/9278_AC011CR-1_1_trimmed.unmatched.fastq /Users/valvano/Genomes/snippy/AC011/AC011_ref/9278_AC011CR-1_2_trimmed.unmatched.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/jz/j4h61y_135x8ymlqwvzmp50h0000gp/T --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /private/var/folders/jz/j4h61y_135x8ymlqwvzmp50h0000gp/T --threads 3 -m 2000M | samtools markdup -T /private/var/folders/jz/j4h61y_135x8ymlqwvzmp50h0000gp/T --threads 3 -r -s - - > snps.bam

READ 0 WRITTEN 0 
EXCLUDED 0 EXAMINED 0
PAIRED 0 SINGLE 0
DULPICATE PAIR 0 DUPLICATE SINGLE 0
DUPLICATE TOTAL 0

### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 457247 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf

Failed to open -: unknown file type
=====
Any ideas? Thanks",valvanom,https://github.com/tseemann/snippy/issues/536
I_kwDOAS4qDc5W1EDf,Snippy-multi issue,OPEN,2022-11-20T03:22:01Z,2024-11-21T21:44:14Z,,"~ Hi, it's my first time here. I'm trying to run Snippy for the first time with the following script:

snippy-multi ../pwd_assembly --ref ../sequence.fasta --outdir snippy_analise --cpus 16

~ But the terminal shows me:

Reading: ../pwd_assembly
ERROR: BAD ID

~ the ""pwd_assembly"" is my ""input.tab"" file. The ""SRR19844088"" it's one of my samples ID (i have 192 samples). The ""sequence.fasta"" it's my reference sequence. And the ""snippy_analise"" it's my output directory. I'm showing here bellow an example of my input.tab file:

SRR19844088  /home/vinicarvm/genomas/dados_fastq/SRR19844088_montados/assembly.fasta
SRR19844088  /home/vinicarvm/genomas/dados_fastq/SRR19844088_montados/assembly.fasta
SRR19844089  /home/vinicarvm/genomas/dados_fastq/SRR19844089_montados/assembly.fasta
SRR19844099  /home/vinicarvm/genomas/dados_fastq/SRR19844099_montados/assembly.fasta
SRR19844100  /home/vinicarvm/genomas/dados_fastq/SRR19844100_montados/assembly.fasta
SRR19844102  /home/vinicarvm/genomas/dados_fastq/SRR19844102_montados/assembly.fasta
SRR19844103  /home/vinicarvm/genomas/dados_fastq/SRR19844103_montados/assembly.fasta
SRR19844280  /home/vinicarvm/genomas/dados_fastq/SRR19844280_montados/assembly.fasta
SRR19844282  /home/vinicarvm/genomas/dados_fastq/SRR19844282_montados/assembly.fasta
SRR19844285  /home/vinicarvm/genomas/dados_fastq/SRR19844285_montados/assembly.fasta
SRR19844318  /home/vinicarvm/genomas/dados_fastq/SRR19844318_montados/assembly.fasta
.
.
.

",vinicarvm,https://github.com/tseemann/snippy/issues/537
I_kwDOAS4qDc5XYMj0, Input files,OPEN,2022-11-28T07:47:04Z,2022-11-28T07:47:04Z,,"Hello, I have some questions about the input file of snippy. Can snippy mix the draft genome and the fully assembled genome from Genebank as input files? 
I tried to put the draft genome and Complete genome (Scaffolds level and Complete genome) into a folder, and then used the snippy-multi command to obtain the core gene alignment of these strains to build the phylogenetic tree. Is the result obtained by this method reliable? 
Another question is if I change the reference gene sequence to the sequence of a gene cluster, also using snippy-multi, will I end up with a phylogenetic tree of that cluster across all strains? How do I know the total number of SNPS?
Best wishes！",illusion-a,https://github.com/tseemann/snippy/issues/538
I_kwDOAS4qDc5XflcA,Getting snippy-core results ready for IQTree,OPEN,2022-11-29T11:26:33Z,2022-11-29T11:26:33Z,,"Hi! 

  I have a question regarding how to treat the snippy-core results to feed them into IQTree afterwards. So right now, I have the core.full.aln file, should I first go for the snp-sites and then snippy-clean or the other way round?
  Another question, according to a thread in which Torsten participated (https://bitsandbugs.org/2019/11/06/two-easy-ways-to-run-iq-tree-with-the-correct-number-of-constant-sites/) The best approach to use IQTree on SNP data should be to use the -fconst function but I'm a little confused by this, in the thread Torsten mentions a pretty straightforward method:
  
  `iqtree -fconst $(snp-sites -C core.full.aln) -s <(snp-sites -c core.full.aln)`

In this case, do I need to select a nucleotide substitution model (for example with -m TEST)? Or will this overrun the -fconst option?

Thank you very much!",alanxelena,https://github.com/tseemann/snippy/issues/539
I_kwDOAS4qDc5Xo6X-,Bioconda only installs Snippy v3.1,OPEN,2022-11-30T23:09:33Z,2023-04-10T02:07:10Z,,"Hello,
I've noticed this issue in a previous post, but what worked for that individual does not seem to be working for me. I am running macOS Monterey v12.5 on a 2022 MacBook Pro

I created a new conda environment, then used the conda command from the installation instructions:
`conda install -c conda-forge -c bioconda -c defaults snippy`
but conda will only install version 3.1, which results in the error
`[E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t` 
when I try to run Snippy
When I attempt to force conda to install a new version of snippy via 
`snippy>=3.2`
I get an error that no such version exists

I've also attempted to install via curl, but that results in the error:
`Can't locate Bio/SeqIO.pm in @INC (you may need to install the Bio::SeqIO module)`
during installation, which I have also been unable to resolve.

Any advice would be much appreciated, thanks.

EDIT:
I alternatively tried to install snippy via brew, but it failed with this error:
`ld: Assertion failed: (_file->_atomsArrayCount == computedAtomCount && ""more atoms allocated than expected""), function parse, file macho_relocatable_file.cpp, line 2061.
collect2: error: ld returned 1 exit status
make: *** [vt] Error 1`",ERBringHorvath,https://github.com/tseemann/snippy/issues/540
I_kwDOAS4qDc5XqFsC,rRNA missing from snps.tab + impact of annotation on variants?,OPEN,2022-12-01T04:22:40Z,2022-12-01T04:22:40Z,,"This might be a duplicate of #111 but I don't think that it was fixed -- I'm not seeing any rRNA variants in my snps.tab I've tried using the original .gbk (NZ_CP071982), and I've tried reannotating it with Prokka (this also seems to change the number of variants in the VCFs quite a bit?). The rRNA features are present in `/reference/ref/ref.gff`, but don't seem to be making it through to the final output. If anyone's run into this issue and had any luck figuring it out, I'd be grateful for any guidance!

Thanks!",SJohnsonMayo,https://github.com/tseemann/snippy/issues/541
I_kwDOAS4qDc5YTAD7,Torsten's opinion would be appreciated: Different tree topologies while using Gubbins and IQ-Tree,OPEN,2022-12-07T08:56:38Z,2022-12-07T08:57:03Z,,"Dear @tseemann,

 I'm running an SNP phylogeny as you suggested here: https://github.com/tseemann/snippy

My problem is that if I compare the nwk tree generated by gubbins and that from IQ-tree I get very different topologies and I can't find the explanation for this. I've had some exchange with nickjcroucher in this thread:

https://github.com/nickjcroucher/gubbins/issues/354

Do you have any opinions on which approach would be the right one?

Any comment would be greatly appreciated.

Alan.",alanxelena,https://github.com/tseemann/snippy/issues/542
I_kwDOAS4qDc5Yyc0j,Snippy annotation issue in final file,OPEN,2022-12-11T07:51:16Z,2022-12-11T07:51:16Z,,"Hello tseemann, 

I am a student, doing small review on snippy. I took fastq files for one sample to compare with reference genome but when I run snippy I got only few columns which are showing snp indel presence but other columns like where the cds, rRNA or the things like effects , gene types should be mentioned did not get those. Those columns are blank. Why is that happening? Can you please help?",Juthy12,https://github.com/tseemann/snippy/issues/543
I_kwDOAS4qDc5aKBNN,Adding indels in `core.vcf`,OPEN,2022-12-28T09:06:11Z,2022-12-28T09:06:11Z,,"## Greetings!
Thank you for developing Snippy! I'm a big fan of it.
I recently noticed some interesting indels in my sequences. Snippy is able to detect them and store them to `snps.vcf`. However I noticed that after running `snippy_core`, `core.vcf` does not contain indel informations anymore. I understand that indels can be hard to (and not useful) incorperate in generating `core.aln`, so I'm wondering if there is a way to summarize all the detected indels using `snippy_core`. 

Sincerely,

***David***

",davidtong28,https://github.com/tseemann/snippy/issues/544
I_kwDOAS4qDc5aLsAb, ERROR: Can't open --ref BJ64/ref.fa,CLOSED,2022-12-28T17:34:30Z,2022-12-28T17:40:57Z,2022-12-28T17:40:57Z,"Dear Tostern team.

I am currently working with snnipy however I am not able to get my *.ref.fa reference file.
 My tabbed file with the PATHs is correct.
My script.sh likewise.

However I get the following error:
 ERROR: Can't open --ref BJ64/ref.fa
it seems to me that it is derived from:
Need samtools --version >= 1.7 but you have 1.16 - please upgrade it.

but my version is 1.16 in samtools, does anyone have a suggestion?",Chris091089,https://github.com/tseemann/snippy/issues/545
I_kwDOAS4qDc5bCuH1,".gb file not working as the reference and with fasta reference,  FTYPE,STRAND,NT_POS, AA_POS , EFFECT,LOCUS_TAG,GENE PRODUCT are empty columns",OPEN,2023-01-10T14:01:32Z,2023-09-10T18:36:17Z,,"I installed snippy v 4.6.0 and snpEff version SnpEff 5.1d (build 2022-04-19 15:49). When the reference file is a .gb file, I encounter the following error
[19:30:07] This is snippy 4.6.0
[19:30:07] Written by Torsten Seemann
[19:30:07] Obtained from https://github.com/tseemann/snippy
[19:30:07] Detected operating system: linux
[19:30:07] Enabling bundled linux tools.
[19:30:07] Found bwa - /home/absar_ubuntu/anaconda3/envs/snippy/bin/bwa
[19:30:07] Found bcftools - /home/absar_ubuntu/anaconda3/envs/snippy/bin/bcftools
[19:30:07] Found samtools - /home/absar_ubuntu/anaconda3/envs/snippy/bin/samtools
[19:30:07] Found java - /home/absar_ubuntu/anaconda3/envs/snippy/bin/java
[19:30:07] Found snpEff - /home/absar_ubuntu/anaconda3/envs/snippy/bin/snpEff
[19:30:07] Found samclip - /home/absar_ubuntu/anaconda3/envs/snippy/bin/samclip
[19:30:07] Found seqtk - /home/absar_ubuntu/anaconda3/envs/snippy/bin/seqtk
[19:30:07] Found parallel - /home/absar_ubuntu/anaconda3/envs/snippy/bin/parallel
[19:30:07] Found freebayes - /home/absar_ubuntu/anaconda3/envs/snippy/bin/freebayes
[19:30:07] Found freebayes-parallel - /home/absar_ubuntu/anaconda3/envs/snippy/bin/freebayes-parallel
[19:30:07] Found fasta_generate_regions.py - /home/absar_ubuntu/anaconda3/envs/snippy/bin/fasta_generate_regions.py
[19:30:07] Found vcfstreamsort - /home/absar_ubuntu/anaconda3/envs/snippy/bin/vcfstreamsort
[19:30:07] Found vcfuniq - /home/absar_ubuntu/anaconda3/envs/snippy/bin/vcfuniq
[19:30:07] Found vcffirstheader - /home/absar_ubuntu/anaconda3/envs/snippy/bin/vcffirstheader
[19:30:07] Found gzip - /usr/bin/gzip
[19:30:07] Found vt - /home/absar_ubuntu/anaconda3/envs/snippy/bin/vt
[19:30:07] Found snippy-vcf_to_tab - /home/absar_ubuntu/anaconda3/envs/snippy/bin/snippy-vcf_to_tab
[19:30:07] Found snippy-vcf_report - /home/absar_ubuntu/anaconda3/envs/snippy/bin/snippy-vcf_report
[19:30:07] Checking version: samtools --version is >= 1.7 - ok, have 1.16
[19:30:07] Checking version: bcftools --version is >= 1.7 - ok, have 1.16
[19:30:07] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.6
[19:30:07] Checking version: snpEff -version is >= 4.3 - ok, have 5.1
[19:30:07] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[19:30:07] Using reference: /home/absar_ubuntu/NZ_CP042858.1.gb
[19:30:07] Treating reference as 'genbank' format.
[19:30:07] Will use 4 CPU cores.
[19:30:07] Using read file: /home/absar_ubuntu/WGS_fasta/1.fna
[19:30:07] Used --force, will overwrite existing SNP_rough1
[19:30:07] Changing working directory: SNP_rough1
[19:30:07] Creating reference folder: reference
[19:30:07] Extracting FASTA and GFF from reference.
[19:30:11] Wrote 1 sequences to ref.fa
[19:30:11] Wrote 5799 features to ref.gff
[19:30:11] Shredding /home/absar_ubuntu/WGS_fasta/1.fna into pseudo-reads
[19:30:14] Wrote 466874 fake 250bp reads (20x, stride 25bp) to fake_reads.fq
[19:30:14] Creating reference/snpeff.config
[19:30:14] Freebayes will process 7 chunks of 842934 bp, 4 chunks at a time.
[19:30:14] Using BAM RG (Read Group) ID: SNP_rough1
[19:30:14] Running: samtools faidx reference/ref.fa 2>> snps.log
[19:30:14] Running: bwa index reference/ref.fa 2>> snps.log
[19:30:16] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[19:30:16] Running: ln -sf reference/ref.fa . 2>> snps.log
[19:30:16] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[19:30:16] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[19:30:16] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[19:30:21] Error running command, check SNP_rough1/snps.log

Using .fasta file as reference gives empty column in the result. ",absartalat,https://github.com/tseemann/snippy/issues/546
I_kwDOAS4qDc5c3hNM,"Error: Please supply a reference FASTA/GBK/EMBL file with --reference , even in the presence of reference file",OPEN,2023-01-26T12:21:18Z,2023-03-23T14:49:19Z,,"Hi, i am trying to run snippy on multiple genomes, however it gives following error like **Please supply a reference FASTA/GBK/EMBL file with **--reference**** even after providing the reference file. i don't understand why it is happen and here is code which i am using-
 

@ #

- [ ] > #!/bin/bash
- [ ] > 
- [ ] > # specify the directory containing the genome files
- [ ] > genome_dir=/home/bvs/Neelam/fna
- [ ] > 
- [ ] > # specify the reference genome
- [ ] > ref=/home/bvs/Neelam/ref_snippy/PAO1.fna
- [ ] > 
- [ ] > # specify the directory for the output files
- [ ] > out_dir=/home/bvs/Neelam/snippy_outdir
- [ ] > 
- [ ] > # specify the contigs files
- [ ] > #contig=/home/bvs/neelam/annotated/fna
- [ ] > 
- [ ] > 
- [ ] > # loop through all the genome files in the directory
- [ ] > for file in $(find $genome_dir -type f -name ""*.fna""); do
- [ ] > 
- [ ] >   # extract the sample name from the file name
- [ ] >   name=$(echo $file | cut -d""/"" -f 2 | cut -d""."" -f1)
- [ ] > 
- [ ] >   # run Snippy with the sample name as the prefix
- [ ] >   snippy --prefix $name $file  --cpus 30  --outdir $out_dir --reference $ref --ctgs $genome_dir
- [ ] > 
- [ ] > done
- [ ] > 
- [ ] > 
- [ ] > 
- [ ] > 








This is snippy 4.6.0
[16:47:05] Written by Torsten Seemann
[16:47:05] Obtained from https://github.com/tseemann/snippy
[16:47:05] Detected operating system: linux
[16:47:05] Enabling bundled linux tools.
[16:47:05] Found bwa - /usr/bin/bwa
[16:47:05] Found bcftools - /home/bvs/Neelam/snippy/binaries/linux/bcftools
[16:47:05] Found samtools - /usr/bin/samtools
[16:47:05] Found java - /usr/bin/java
[16:47:05] Found snpEff - /home/bvs/Neelam/snippy/binaries/noarch/snpEff
[16:47:05] Found samclip - /home/bvs/Neelam/snippy/binaries/noarch/samclip
[16:47:05] Found seqtk - /usr/bin/seqtk
[16:47:05] Found parallel - /usr/bin/parallel
[16:47:05] Found freebayes - /home/bvs/Neelam/snippy/binaries/linux/freebayes
[16:47:05] Found freebayes-parallel - /home/bvs/Neelam/snippy/binaries/noarch/freebayes-parallel
[16:47:05] Found fasta_generate_regions.py - /home/bvs/Neelam/snippy/binaries/noarch/fasta_generate_regions.py
[16:47:05] Found vcfstreamsort - /home/bvs/Neelam/snippy/binaries/linux/vcfstreamsort
[16:47:05] Found vcfuniq - /home/bvs/Neelam/snippy/binaries/linux/vcfuniq
[16:47:05] Found vcffirstheader - /home/bvs/Neelam/snippy/binaries/noarch/vcffirstheader
[16:47:05] Found gzip - /usr/bin/gzip
[16:47:05] Found vt - /home/bvs/Neelam/snippy/binaries/linux/vt
[16:47:05] Found snippy-vcf_to_tab - /home/bvs/Neelam/snippy/bin/snippy-vcf_to_tab
[16:47:05] Found snippy-vcf_report - /home/bvs/Neelam/snippy/bin/snippy-vcf_report
[16:47:05] Checking version: samtools --version is >= 1.7 - ok, have 1.9
[16:47:05] Checking version: bcftools --version is >= 1.7 - ok, have 1.10
[16:47:05] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.1
[16:47:06] Checking version: snpEff -version is >= 4.3 - ok, have 4.3
[16:47:06] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
**[16:47:06] Please supply a reference FASTA/GBK/EMBL file with --reference**







Thank you!",neelam19051,https://github.com/tseemann/snippy/issues/547
I_kwDOAS4qDc5dhacz,"snippy-core ignore ""snps"" of some fragments, although they exists in snps.vcf of individual genome.",CLOSED,2023-02-03T01:28:13Z,2023-02-13T08:23:31Z,2023-02-13T08:22:53Z,"As mentioned by issue #330 

I have met the same problem. And Indeed some ""snps"" in snps.vcf are not included in core.vcf, so this may be not the case of ""ins or indel"" mentioned in #330
I installed Snippy 2.6.0 by conda.
I found that, a plenty of SNPs(the type column in snps.vcf is ""snp"" or ""complex"") does exists in Snippy output of individual genome, and as #330  mentioned, they should have passed the quailty check. But they were not exists in snippy-core output,  and this occur often by a fragment of reference genome. For example, all snps located before the position 2540 of reference were not included in core.vcf:


here I copyed some snps from snps.vcf of a sample:
8-911   52  .   CT  GG  6319.61 .   AB=0;AO=232;DP=232;QA=8529;QR=0;RO=0;TYPE=mnp   GT:DP:RO:QR:AO:QA:GL    1/1:232:0:0:232:8529:-767.536,-69.839,0                                                                                             
8-911   60  .   G   C   6786.77 .   AB=0;AO=225;DP=225;QA=8216;QR=0;RO=0;TYPE=snp   GT:DP:RO:QR:AO:QA:GL    1/1:225:0:0:225:8216:-739.382,-67.7318,0                                                                                            
8-911   67  .   AG  A   5667.43 .   AB=0;AO=218;DP=219;QA=7934;QR=0;RO=0;TYPE=del   GT:DP:RO:QR:AO:QA:GL    1/1:219:0:0:218:7934:-713.767,-65.6245,0                                                                                            
8-911   2201    .   C   G   3976.54 .   AB=0;AO=160;DP=162;QA=5862;QR=0;RO=0;TYPE=snp   GT:DP:RO:QR:AO:QA:GL    1/1:162:0:0:160:5862:-527.308,-48.1648,0                                                                                        
8-911   2216    .   T   C   32570.8 .   AB=0;AO=1302;DP=1302;QA=47873;QR=0;RO=0;TYPE=snp    GT:DP:RO:QR:AO:QA:GL    1/1:1302:0:0:1302:47873:-4306.44,-391.941,0                                                                                 
8-911   2225    .   TCG CCT 40421.4 .   AB=0;AO=1614;DP=1615;QA=59118;QR=0;RO=0;TYPE=complex    GT:DP:RO:QR:AO:QA:GL    1/1:1615:0:0:1614:59118:-5317.6,-485.862,0                                                                             
8-911   2237    .   CAGG    TAGA    52621.1 .   AB=0;AO=2107;DP=2114;QA=76844;QR=0;RO=0;TYPE=complex    GT:DP:RO:QR:AO:QA:GL    1/1:2114:0:0:2107:76844:-6912.2,-634.27,0                                                                                                                              
....
.... (after 2540, the snps were included in core.vcf)
8-911   2540    .   TGATTG  CGACTC  230134  .   AB=0;AO=7027;DP=7058;QA=256264;QR=0;RO=0;TYPE=complex   GT:DP:RO:QR:AO:QA:GL    1/1:7058:0:0:7027:256264:-23051.1,-2115.34,0                                                                    
8-911   2600    .   C   T   141227  .   AB=0;AO=4581;DP=4596;QA=165216;QR=296;RO=8;TYPE=snp GT:DP:RO:QR:AO:QA:GL    1/1:4596:8:296:4581:165216:-14834.6,-1354.72,0                                                                              
8-911   2609    .   C   G   126308  .   AB=0;AO=4049;DP=4052;QA=146861;QR=25;RO=1;TYPE=snp  GT:DP:RO:QR:AO:QA:GL    1/1:4052:1:25:4049:146861:-13207.9,-1216.94,0                                                                               
8-911   2615    .   A   G   115443  .   AB=0;AO=3668;DP=3668;QA=133747;QR=0;RO=0;TYPE=snp   GT:DP:RO:QR:AO:QA:GL    1/1:3668:0:0:3668:133747:-12030.7,-1104.18,0                                                                                
8-911   2621    .   T   G   103267  .   AB=0;AO=3264;DP=3264;QA=119159;QR=0;RO=0;TYPE=snp   GT:DP:RO:QR:AO:QA:GL    1/1:3264:0:0:3264:119159:-10718.6,-982.562,0                                                                                
8-911   2643    .   TTG CTA 22990.1 .   AB=0;AO=725;DP=730;QA=25959;QR=0;RO=0;TYPE=complex  GT:DP:RO:QR:AO:QA:GL    1/1:730:0:0:725:25959:-2335.17,-218.247,0                                                                                   
8-911   2651    .   TTC GGG 14544.7 .   AB=0;AO=495;DP=495;QA=18045;QR=0;RO=0;TYPE=complex  GT:DP:RO:QR:AO:QA:GL    1/1:495:0:0:495:18045:-1623.51,-149.01,0 
                                                                                                                                                 
I copyed the start point of the core.vcf, 
it start from 2540:
8-911   2540    .   T   C   .   PASS    TYPE=snp    GT  1   0   1   0   1   1   1   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0                                                                                           
8-911   2543    .   T   C   .   PASS    TYPE=snp    GT  1   1   1   0   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0                                                                                           
8-911   2545    .   G   C,T .   PASS    TYPE=snp    GT  1   0   1   0   2   2   2   1   0   0   0   0   0   1   0   0   0   0   1   0   0   0   0   0                                                                                           
8-911   2549    .   C   T   .   PASS    TYPE=snp    GT  0   0   0   0   1   1   1   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0   0                                                                                           
8-911   2561    .   A   G   .   PASS    TYPE=snp    GT  0   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0   0   0   1   1                                                                                           
8-911   2569    .   T   C   .   PASS    TYPE=snp    GT  0   0   0   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0                                                                                           
8-911   2580    .   C   T   .   PASS    TYPE=snp    GT  0   0   0   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0   0                                                                                           
8-911   2594    .   G   A   .   PASS    TYPE=snp    GT  0   0   0   0   1   1   1   1   0   0   1   0   0   0   0   0   0   1   1   0   0   0   0   0                                                                                           
8-911   2600    .   C   T   .   PASS    TYPE=snp    GT  1   0   0   0   0   0   0   0   0   0   0   0   0   1   0   0   0   0   0   0   0   0   0   0                                                                                           
8-911   2609    .   C   A,G,T   .   PASS    TYPE=snp    GT  2   0   0   1   2   2   2   3   0   0   2   0   1   2   0   0   0   2   1   0   0   0   0   0

So...  I can't figured out, why a whole fragment snps are ignored, even if they exist in the snps.vcf of a single sample.

And this also occured at other locations in the core.vcf as well.



Thank you very much.",actledge,https://github.com/tseemann/snippy/issues/548
I_kwDOAS4qDc5d1Pbw,freebayes Error: signal 11: when using --targets,OPEN,2023-02-07T12:26:01Z,2023-02-07T12:26:01Z,,"Dear all,
I'm having some problems with the --targets argument and I don't know how to solve it:
```
Error: signal 11:
freebayes(+0xbd51b)[0x7f7c18fe551b]
/lib64/libc.so.6(+0x35670)[0x7f7c182a6670]
/mnt/data-netapp/users/mlara/envs/snippy/bin/../lib/libstdc++.so.6(+0xd7ce7)[0x7f7c18a0bce7]
/mnt/data-netapp/users/mlara/envs/snippy/bin/../lib/libstdc++.so.6(_ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE17find_first_not_ofEPKcmm+0x33)[0x7f7c18a3b913]
freebayes(+0x7f1ab)[0x7f7c18fa71ab]
freebayes(+0x1cede)[0x7f7c18f44ede]
freebayes(+0x5f706)[0x7f7c18f87706]
freebayes(+0x69103)[0x7f7c18f91103]
freebayes(+0xa1cb)[0x7f7c18f321cb]
/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f7c18292b15]
Error: signal 11:
freebayes(+0xbd51b)[0x7f6faaedc51b]
/lib64/libc.so.6(+0x35670)[0x7f6faa19d670]
/mnt/data-netapp/users/mlara/envs/snippy/bin/../lib/libstdc++.so.6(+0xd7ce7)[0x7f6faa902ce7]
/mnt/data-netapp/users/mlara/envs/snippy/bin/../lib/libstdc++.so.6(_ZNKSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEE17find_first_not_ofEPKcmm+0x33)[0x7f6faa932913]
freebayes(+0x7f1ab)[0x7f6faae9e1ab]
freebayes(+0x1cede)[0x7f6faae3bede]
freebayes(+0x5f706)[0x7f6faae7e706]
freebayes(+0x69103)[0x7f6faae88103]
freebayes(+0xa1cb)[0x7f6faae291cb]
/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f6faa189b15]
```
snippy (v4.4.5) is installed in a conda environment. Later versions fail too. 
Freebayes version is 1.3.2. If I run freebayes --targets it works perfectly, and freebayes-parallel (without --targets argument) too.

Thank you in advance!


",mlarjim,https://github.com/tseemann/snippy/issues/549
I_kwDOAS4qDc5e_J4X,Debian and Guix support for snippy,OPEN,2023-02-21T14:49:03Z,2023-03-14T08:30:01Z,,"snippy looks unmaintained. Even so, it is used and we want it in Debian and GNU Guix. This issue is to track patching the software for these distros.",pjotrp,https://github.com/tseemann/snippy/issues/550
I_kwDOAS4qDc5lEOjW,"""Snepff problem because of java version""",OPEN,2023-05-04T09:18:10Z,2023-05-04T09:18:10Z,,"Hello, just trying to install snippy, but there is a problem. When I check snps.log, told me this: 

### echo snippy 4.5.0
### cd /home/carlosfreytas

### /home/carlosfreytas/miniconda3/envs/snippy_env/bin/snippy --cpus 8 --outdir variants --ref Agyy99.gb --R1 trimmed_R1.fastq.gz --R2 trimmed_R2.fastq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.03 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 1.11 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.27 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 1.472 sec; CPU: 1.440 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

Error: A JNI error has occurred, please check your installation and try again
Exception in thread ""main"" java.lang.UnsupportedClassVersionError: org/snpeff/SnpEff has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:757)
	at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)
	at java.net.URLClassLoader.defineClass(URLClassLoader.java:473)
	at java.net.URLClassLoader.access$100(URLClassLoader.java:74)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:369)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:363)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:362)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:419)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:352)
	at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:601)



FIRST I WAS THINKING THAT I NEED A CURRENT VERSION OF JAVA, But reading another issues, I see that maybe is totally the opposite, i need java version <1.8, can you told me if I am right?
",carlosfreytas,https://github.com/tseemann/snippy/issues/551
I_kwDOAS4qDc5mEgso,snps.tab file not created,OPEN,2023-05-16T17:42:27Z,2023-05-16T17:42:27Z,,"Hello, 
I am trying to run snippy-multi on a MacBook Pro M2 and am running into an error. Here is the snps log output:
### cd /Users/jennifercalawa/Desktop/FASTAforRoary/FNAonly

### /Users/jennifercalawa/anaconda3/envs/snippyenv/bin/snippy --outdir CM1.1 --ctgs /Users/jennifercalawa/Desktop/FASTAforRoary/FNAonly/ncbi_dataset/CM1.1/CM1.1.fna --ref Vfischeri_ES114.all.gbk --cpus 6

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.04 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.93 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.30 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 1.329 sec; CPU: 1.330 sec

### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### (bwa mem  -v 2 -M -R '@RG\tID:snps\tSM:snps' -t 6 reference/ref.fa fake_reads.fq | samtools view -u -T reference/ref.fa -F 3844 -q 60 | samtools sort --reference reference/ref.fa > snps.bam)

[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -v 2 -M -R @RG\tID:snps\tSM:snps -t 6 reference/ref.fa fake_reads.fq
[main] Real time: 16.675 sec; CPU: 92.473 sec

### samtools index snps.bam


### samtools depth -aa -q 20 snps.bam | bgzip > snps.depth.gz


### tabix -s 1 -b 2 -e 2 snps.depth.gz


### fasta_generate_regions.py reference/ref.fa.fai 181047 > reference/ref.txt


### freebayes-parallel reference/ref.txt 6 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf

env: python: No such file or directory


And the terminal output says there is no .tab file (what I think is meant to be snps.tab) in my output folder. From what I can tell, all the other output files are being made, but the snps VCF is empty. Any help is greatly appreciated!",jennifercalawa,https://github.com/tseemann/snippy/issues/552
I_kwDOAS4qDc5nulPz,Unknown option: mask on snippy-clean_full_aln,OPEN,2023-06-04T09:34:29Z,2023-06-05T09:56:02Z,,"Hi, Torsten, 
I am trying to use --mask option on snippy-clean_full_aln core.full.aln > clean.full.aln step for masking phage regions:
snippy-clean_full_aln core.full.aln --mask PHASTER/phaster.bed> clean.full.aln
and getting a following  error: Unknown option: mask

My .bed file looks like this (no spaces, only tabs):
Reference	368458	408984
Reference	1094858	1142017
Reference	1958166	1972101
Reference	2079346	2134623
Reference	2771858	2817833

Would be glad to your help",KatyaArnold,https://github.com/tseemann/snippy/issues/553
I_kwDOAS4qDc5pfnAY,no. variants normalized,OPEN,2023-06-22T15:08:14Z,2024-09-16T14:11:55Z,,"I use snippy 4.6.0 to calling my bacteria snp,but there are no result ,I wonder what to do next ,thanks.
snippy --outdir 135080RSH2439 --ref 175001_wt/175001R1qc_shovill.fasta --ctgs 135080RSH2439.fasta
[21:19:19] This is snippy 4.6.0
[21:19:19] Written by Torsten Seemann
[21:19:19] Obtained from https://github.com/tseemann/snippy
[21:19:19] Detected operating system: linux
[21:19:19] Enabling bundled linux tools.
[21:19:19] Found bwa - /home/lj_cpp/miniconda3/bin/bwa
[21:19:19] Found bcftools - /home/lj_cpp/miniconda3/bin/bcftools
[21:19:19] Found samtools - /home/lj_cpp/miniconda3/bin/samtools
[21:19:19] Found java - /home/lj_cpp/miniconda3/bin/java
[21:19:19] Found snpEff - /home/lj_cpp/miniconda3/bin/snpEff
[21:19:19] Found samclip - /home/lj_cpp/miniconda3/bin/samclip
[21:19:19] Found seqtk - /home/lj_cpp/miniconda3/bin/seqtk
[21:19:19] Found parallel - /home/lj_cpp/miniconda3/bin/parallel
[21:19:19] Found freebayes - /home/lj_cpp/miniconda3/bin/freebayes
[21:19:19] Found freebayes-parallel - /home/lj_cpp/miniconda3/bin/freebayes-parallel
[21:19:19] Found fasta_generate_regions.py - /home/lj_cpp/miniconda3/bin/fasta_generate_regions.py
[21:19:19] Found vcfstreamsort - /home/lj_cpp/miniconda3/bin/vcfstreamsort
[21:19:19] Found vcfuniq - /home/lj_cpp/miniconda3/bin/vcfuniq
[21:19:19] Found vcffirstheader - /home/lj_cpp/miniconda3/bin/vcffirstheader
[21:19:19] Found gzip - /usr/bin/gzip
[21:19:19] Found vt - /home/lj_cpp/miniconda3/bin/vt
[21:19:19] Found snippy-vcf_to_tab - /home/lj_cpp/miniconda3/bin/snippy-vcf_to_tab
[21:19:19] Found snippy-vcf_report - /home/lj_cpp/miniconda3/bin/snippy-vcf_report
[21:19:19] Checking version: samtools --version is >= 1.7 - ok, have 1.17
[21:19:19] Checking version: bcftools --version is >= 1.7 - ok, have 1.17
[21:19:19] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.6
[21:19:20] Checking version: snpEff -version is >= 4.3 - ok, have 5.1
[21:19:20] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[21:19:20] Using reference: /home/lj_cpp/data/bacterial/175001_wt/175001R1qc_shovill.fasta
[21:19:20] Treating reference as 'fasta' format.
[21:19:20] Will use 8 CPU cores.
[21:19:20] Using read file: /home/lj_cpp/data/bacterial/snippy_result/135080RSH2439.fasta
[21:19:20] Creating folder: 135080RSH2439
[21:19:20] Changing working directory: 135080RSH2439
[21:19:20] Creating reference folder: reference
[21:19:20] Extracting FASTA and GFF from reference.
[21:19:20] Wrote 1 sequences to ref.fa
[21:19:20] Wrote 0 features to ref.gff
[21:19:20] Shredding /home/lj_cpp/data/bacterial/snippy_result/135080RSH2439.fasta into pseudo-reads
[21:19:26] Wrote 464230 fake 250bp reads (20x, stride 25bp) to fake_reads.fq
[21:19:26] Freebayes will process 15 chunks of 10770 bp, 8 chunks at a time.
[21:19:26] Using BAM RG (Read Group) ID: 135080RSH2439
[21:19:26] Running: samtools faidx reference/ref.fa 2>> snps.log
[21:19:26] Running: bwa index reference/ref.fa 2>> snps.log
[21:19:27] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[21:19:27] Running: ln -sf reference/ref.fa . 2>> snps.log
[21:19:27] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[21:19:27] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[21:19:27] Running: bwa mem -Y -M -R '@rg\tID:135080RSH2439\tSM:135080RSH2439' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam 2>> snps.log
samtools: /home/lj_cpp/miniconda3/bin/../lib/libtinfow.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
[M::bwa_idx_load_from_disk] read 0 ALT contigs
samtools: /home/lj_cpp/miniconda3/bin/../lib/libtinfow.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libtinfow.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
[samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 320000 sequences (80000000 bp)...
[M::process] read 144230 sequences (36042376 bp)...
[M::mem_process_seqs] Processed 320000 reads in 54.641 CPU sec, 10.488 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[M::mem_process_seqs] Processed 144230 reads in 30.053 CPU sec, 4.559 real sec
[samclip] Processed 300000 records...
[samclip] Processed 400000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @rg\tID:135080RSH2439\tSM:135080RSH2439 -t 8 reference/ref.fa fake_reads.fq
[main] Real time: 18.439 sec; CPU: 85.693 sec
[samclip] Total SAM records 464230, removed 71, allowed 0, passed 464159
[samclip] Header contained 3 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[21:19:54] Running: samtools index snps.bam 2>> snps.log
[21:19:55] Running: fasta_generate_regions.py reference/ref.fa.fai 10770 > reference/ref.txt 2>> snps.log
[21:19:55] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[21:19:55] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options: input VCF file -
[o] output VCF file -
[w] sorting window size 10000
[n] no fail on reference inconsistency for non SNPs false
[q] quiet false
[d] debug false
[r] reference FASTA file reference/ref.fa

stats: biallelic
no. left trimmed : 0
no. right trimmed : 0
no. left and right trimmed : 0
no. right trimmed and left aligned : 0
no. left aligned : 0

   total no. biallelic normalized           : 0

   multiallelic
      no. left trimmed                      : 0
      no. right trimmed                     : 0
      no. left and right trimmed            : 0
      no. right trimmed and left aligned    : 0
      no. left aligned                      : 0

   total no. multiallelic normalized        : 0

   total no. variants normalized            : 0
   total no. variants observed              : 0
   total no. reference observed             : 0
Time elapsed: 0.00s

[21:19:55] Running: cp snps.filt.vcf snps.vcf 2>> snps.log
[21:19:55] Running: /home/lj_cpp/miniconda3/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab 2>> snps.log
[21:19:56] Running: /home/lj_cpp/miniconda3/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf 2>> snps.log
[21:19:56] Running: bcftools convert -Oz -o snps.vcf.gz snps.vcf 2>> snps.log
[21:19:56] Running: bcftools index -f snps.vcf.gz 2>> snps.log
[21:19:56] Running: bcftools consensus --sample 135080RSH2439 -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz 2>> snps.log
[21:19:56] Running: bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf 2>> snps.log
[21:19:56] Running: bcftools index -f snps.subs.vcf.gz 2>> snps.log
[21:19:56] Running: bcftools consensus --sample 135080RSH2439 -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz 2>> snps.log
[21:19:56] Running: rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi 2>> snps.log
[21:19:56] Running: rm -f fake_reads.fq 2>> snps.log
[21:19:56] Generating reference aligned/masked FASTA relative to reference: snps.aligned.fa
samtools: /home/lj_cpp/miniconda3/bin/../lib/libtinfow.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
samtools: /home/lj_cpp/miniconda3/bin/../lib/libncursesw.so.6: no version information available (required by samtools)
[21:19:57] Marked 0 heterozygous sites with 'n'
[21:19:57] Creating extra output files: BED GFF CSV TXT HTML
[21:19:57] Identified 0 variants.
[21:19:57] Result folder: 135080RSH2439
[21:19:57] Result files:
[21:19:57] * 135080RSH2439/snps.aligned.fa
[21:19:57] * 135080RSH2439/snps.bam
[21:19:57] * 135080RSH2439/snps.bam.bai
[21:19:57] * 135080RSH2439/snps.bed
[21:19:57] * 135080RSH2439/snps.consensus.fa
[21:19:57] * 135080RSH2439/snps.consensus.subs.fa
[21:19:57] * 135080RSH2439/snps.csv
[21:19:57] * 135080RSH2439/snps.filt.vcf
[21:19:57] * 135080RSH2439/snps.gff
[21:19:57] * 135080RSH2439/snps.html
[21:19:57] * 135080RSH2439/snps.log
[21:19:57] * 135080RSH2439/snps.raw.vcf
[21:19:57] * 135080RSH2439/snps.subs.vcf
[21:19:57] * 135080RSH2439/snps.tab
[21:19:57] * 135080RSH2439/snps.txt
[21:19:57] * 135080RSH2439/snps.vcf
[21:19:57] * 135080RSH2439/snps.vcf.gz
[21:19:57] * 135080RSH2439/snps.vcf.gz.csi
[21:19:57] Walltime used: 38 seconds
[21:19:57] Have a suggestion? Tell me at https://github.com/tseemann/snippy/issues
[21:19:57] Done.",cpplyqz,https://github.com/tseemann/snippy/issues/554
I_kwDOAS4qDc5p_jta,snippy -Loaded 1 sequences totalling 0 bp,OPEN,2023-06-28T06:06:55Z,2023-06-28T06:06:55Z,,"hello,i have a question i cannot deal.
here is my code:
snippy-multi snp.txt --ref sequence.gb --cpus 40 > sy.sh
sh sy.sh 
output:
[11:08:18] Using read file: /home/data/zzz/China-pig-309/GCA_003310565.1_ASM331056v1_genomic.fasta
[11:08:18] Output folder GCA_003310565.1_ASM331056v1_genomic already exists. Remove or use --force.
[11:08:18] This is snippy 4.3.6
[11:08:18] Written by Torsten Seemann
[11:08:18] Obtained from https://github.com/tseemann/snippy
[11:08:18] Detected operating system: linux
[11:08:18] Enabling bundled linux tools.
[11:08:18] Found bwa - /home/anaconda/envs/snippy/bin/bwa
[11:08:18] Found bcftools - /home/anaconda/envs/snippy/bin/bcftools
[11:08:18] Found samtools - /home/anaconda/envs/snippy/bin/samtools
[11:08:18] Found java - /home/anaconda/envs/snippy/bin/java
[11:08:18] Found snpEff - /home/anaconda/envs/snippy/bin/snpEff
[11:08:18] Found samclip - /home/anaconda/envs/snippy/bin/samclip
[11:08:18] Found seqtk - /home/anaconda/envs/snippy/bin/seqtk
[11:08:18] Found parallel - /home/anaconda/envs/snippy/bin/paralle
####repeat#####
This is snippy-core 4.3.6
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools.
Found any2fasta - /home/anaconda/envs/snippy/binaries/noarch/any2fasta
Found samtools - /home/anaconda/envs/snippy/bin/samtools
Found minimap2 - /home/anaconda/envs/snippy/bin/minimap2
Found bedtools - /home/anaconda/envs/snippy/bin/bedtools
Found snp-sites - /home/anaconda/envs/snippy/bin/snp-sites
Saving reference FASTA: core.ref.fa
This is any2fasta 0.4.2
Opening 'GCA_003309105.1_ASM330910v1_genomic/ref.fa'
Detected FASTA format
Read 2 lines from 'GCA_003309105.1_ASM330910v1_genomic/ref.fa'
Wrote 1 sequences from FASTA file.
Processed 1 files.
Done.
Use of uninitialized value in uc at /home/anaconda/envs/snippy/bin/snippy-core line 392, <GEN0> line 1.
Loaded 1 sequences totalling 0 bp.
Illegal division by zero at /home/anaconda/envs/snippy/bin/snippy-core line 145.

can you teach me solve the problem
Appreciate very much
have a nice day",hooohw,https://github.com/tseemann/snippy/issues/555
I_kwDOAS4qDc5rOYaI,vcfuniq: symbol lookup error: lib/libvcflib.so.1: undefined symbol: wavefront_align,OPEN,2023-07-11T13:20:08Z,2023-07-18T18:31:49Z,,"When I typed ""mamba install snippy=4.6.0"" and got it successfully I used this software to run my data.But I met an question about this vcfuniq: symbol lookup error: lib/libvcflib.so.1: undefined symbol: wavefront_align.I dont konw how to deal with it .could there anybody help me ?",cpplyqz,https://github.com/tseemann/snippy/issues/556
I_kwDOAS4qDc5rih6D,"can anyone explain, what is mean by evidence column in SNIPPY?",OPEN,2023-07-14T05:43:27Z,2023-09-01T12:50:24Z,,"Hi, Does anyone tell me how the evidence column is calculated in the SNIPPY tool? Similarly, there is the term stop gained and conservative inframe deletion and insertion.


Thank you!

",neelam19051,https://github.com/tseemann/snippy/issues/557
I_kwDOAS4qDc5rn5fz,snippy-multi returns 0 SNPs,OPEN,2023-07-14T21:44:17Z,2023-07-14T21:44:17Z,,"Hi everyone,

I am facing an issue while using snippy-multi. It returns 0 SNPs. I have tried one of my genome individually with the snippy command and it returns 22 SNPs. However, when I use the same file in .tab file and use the snippy-multi, it says no SNPs found. Please help me",asad-869,https://github.com/tseemann/snippy/issues/558
I_kwDOAS4qDc5r-HhJ,bad ID for snippy-multi tab file,OPEN,2023-07-19T08:32:13Z,2023-07-19T08:32:13Z,,"Hi Snippy moderators
Could you help me review this ? I keep getting Bad ID error
NexGen:~$ snippy-multi input2.tab  --ref home/medp8144/test/1.fasta  --cpus 2 > runme.sh
Reading: input2.tab
ERROR: Bad ID:

[input2.xlsx](https://github.com/tseemann/snippy/files/12092783/input2.xlsx)
",medp8144,https://github.com/tseemann/snippy/issues/559
I_kwDOAS4qDc5uw7b-,Snippy-multi returns 0 SNPs while snippy finds multiple,OPEN,2023-08-21T00:11:21Z,2023-08-21T00:11:21Z,,"Hi everyone,

I am facing an issue while using snippy-multi. It returns 0 SNPs. I have tried one of my genome individually with the snippy command and it returns 22 SNPs. However, when I use the same file in .tab file and use the snippy-multi, it says no SNPs found.
Moreover, the snippy returns 272700 sam records, while the snippy-multi returns only 350 sam records.
Please help me ",asad-869,https://github.com/tseemann/snippy/issues/560
I_kwDOAS4qDc5u81ky,Got broken pipeline when running  freebayes-parallel ,OPEN,2023-08-22T13:13:53Z,2024-06-27T02:05:51Z,,"I got this error like this. Does anyone can help to fix??
I run command on HPC:
 snippy --R1 $p_trim/VN0467_1_paired.fastq.gz --R2 $p_trim/VN0467_2_paired.fastq.gz --outdir /lustre7/home/buihoangphuc412/Projects/GWAS/variant/VN0467 --prefix VN0467 --ref $p_ref/genome/CHC97.fasta --report --cpus 4 --ram 2 --basequal 15
[VN0467.log](https://github.com/tseemann/snippy/files/12408967/VN0467.log)

### echo snippy 4.6.0
### cd /lustre7/home/buihoangphuc412

### /home/buihoangphuc412/miniconda3/envs/pyseer/bin/snippy --R1 /lustre7/home/buihoangphuc412/Projects/GWAS/trim/VN0467_1_paired.fastq.gz --R2 /lustre7/home/buihoangphuc412/Projects/GWAS/trim/VN0467_2_paired.fastq.gz --outdir /lustre7/home/buihoangphuc412/Projects/GWAS/variant/VN0467 --prefix VN0467 --ref /lustre7/home/buihoangphuc412/Projects/GWAS/ref/genome/CHC97.fasta --report --cpus 4 --ram 2 --basequal 15

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.00 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.25 seconds elapse.
[bwa_index] Update BWT... 0.02 sec
[bwa_index] Pack forward-only FASTA... 0.00 sec
[bwa_index] Construct SA from BWT and Occ... 0.09 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.420 sec; CPU: 0.368 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:VN0467\tSM:VN0467' -t 4 reference/ref.fa /lustre7/home/buihoangphuc412/Projects/GWAS/trim/VN0467_1_paired.fastq.gz /lustre7/home/buihoangphuc412/Projects/GWAS/trim/VN0467_2_paired.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 1 -m 1000M | samtools fixmate -m --threads 1 - - | samtools sort -l 0 -T /tmp --threads 1 -m 1000M | samtools markdup -T /tmp --threads 1 -r -s - - > VN0467.bam

COMMAND: samtools markdup -T /tmp --threads 1 -r -s - -
READ: 907222
WRITTEN: 895475
EXCLUDED: 106405
EXAMINED: 800817
PAIRED: 752182
SINGLE: 48635
DUPLICATE PAIR: 1168
DUPLICATE SINGLE: 10579
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 11747
DUPLICATE TOTAL: 11747
ESTIMATED_LIBRARY_SIZE: 120974295


### samtools index VN0467.bam


### fasta_generate_regions.py reference/ref.fa.fai 237553 > reference/ref.txt


### freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 15 -m 60 --strict-vcf   -f reference/ref.fa VN0467.bam > VN0467.raw.vcf

vcfstreamsort: symbol lookup error: /lustre7/home/buihoangphuc412/miniconda3/envs/pyseer/bin/../lib/libvcflib.so.1: undefined symbol: wavefront_align
vcfuniq: symbol lookup error: /lustre7/home/buihoangphuc412/miniconda3/envs/pyseer/bin/../lib/libvcflib.so.1: undefined symbol: wavefront_align
Traceback (most recent call last):
  File ""/lustre7/home/buihoangphuc412/miniconda3/envs/pyseer/bin/vcffirstheader"", line 17, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe
",buihoangphuc412,https://github.com/tseemann/snippy/issues/561
I_kwDOAS4qDc5vt1Md,Are SNPs quality filtered previous to snippy-core?,OPEN,2023-08-30T19:58:52Z,2023-08-30T19:58:52Z,,"Hi! I have a big question. When running snippy-core are the low quality SNPs called with snippy filtered out? I'm running snippy+snippy-core on 386 E. coli isolates and I'm getting around 86000 core SNPs while publications (with less isolates) talk about 2000 SNPs so I'm wondering if low quality SNPs are actually filtered.
Many manu thanks.",alanxelena,https://github.com/tseemann/snippy/issues/562
I_kwDOAS4qDc5wAwlg,snippy core took isolate as ref,OPEN,2023-09-03T21:56:53Z,2023-10-19T14:55:23Z,,"Hi Seeman
I ran snippy on mutliple isolates with the input.tab

snippy-multi input.tab --ref ../gubbins_dir/ref_seq_dir/GCF_001600975_1_ASM160097v1.fasta --cpus 16 > runme.sh

When checked the file runme.sh, I noticed one of my isolates written as ref. 

snippy-core --ref  'isol19001326/ref.fa' isol19001326 ...

Any idea?
Should the reference sequence be in the input.tab as well?
Thanks,
TJ",tbazilegith,https://github.com/tseemann/snippy/issues/563
I_kwDOAS4qDc5xCWxF,bug: contig mode does not find all snps,OPEN,2023-09-14T12:14:30Z,2023-09-14T12:49:23Z,,"Hi,
I'm using snippy v4.6.0 in the --ctg contig mode. It does not detect snps at the ends of the contigs.
Something seems to be wrong with the uniform coverage of the pseudo reads. The coverage is rather in a mountain shape. Therefore at the ends, where the coverage is <10 the variants are not called by freebayes. If I set --mincov 1 it conflicts with the default -C 2 (min alternate count) option of freebayes. The option --fbopt ""-C 1"" is not parsed to freebayes correctly, the -C flag occurs two times in the command then (freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 2 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf  -C 1 -f reference/ref.fa AS164896.1_foptC1.bam > AS164896.1_foptC1.raw.vcf). If I set --mincov higher than 1, the actual coverage sometimes is smaller then the --mincov, so at this sites the variants are not called.

My ""contigs"" are gene sequences of ~1000bp, one sequence per separate fasta. I use it the following: $ snippy --prefix xxx --outdir xxx --ref x.gb --ctgs genex.fasta

regards, Sara",Saarkie,https://github.com/tseemann/snippy/issues/564
I_kwDOAS4qDc5x0F81,Missing build items in conda OR freebayes-parrallel problem,OPEN,2023-09-22T20:26:33Z,2023-10-19T14:51:50Z,,"Hello,

I hope you're well. I am struggling to get any install of Snippy working.

I've followed all instructions using either Conda or Brew, and both result in errors. I've even re-installed conda and all my environments from scratch.

### Conda install

conda list
packages in environment at /Users/hughgifford/miniconda3/envs/snippy:
Name                    Version                   Build  Channel
any2fasta                 0.4.2                hdfd78af_3    bioconda
argtable2                 2.13              h1de35cc_1001    conda-forge
bcftools                  1.17                 h3bbda8f_1    bioconda
bedtools                  2.31.0               h6372da2_3    bioconda
blast                     2.14.1          pl5321h91c44f7_0    bioconda
bwa                       0.7.17              h45fc8d7_11    bioconda
bzip2                     1.0.8                h0d85af4_4    conda-forge
c-ares                    1.19.1               h0dc2134_0    conda-forge
ca-certificates           2023.7.22            h8857fd0_0    conda-forge
clustalo                  1.2.4                h7133b54_7    bioconda
clustalw                  2.1                  h85dcccf_9    bioconda
curl                      8.3.0                h5f667d7_0    conda-forge
entrez-direct             16.2                 h193322a_1    bioconda
expat                     2.5.0                hf0c8a7f_1    conda-forge
freebayes                 1.3.6                hd0edb90_5    bioconda
gettext                   0.21.1               h8a4c099_0    conda-forge
gsl                       2.7                  h93259b0_0    conda-forge
htslib                    1.18                 h365c357_0    bioconda
k8                        0.2.5                hdf58011_4    bioconda
krb5                      1.21.2               hb884880_0    conda-forge
libblas                   3.9.0           18_osx64_openblas    conda-forge
libcblas                  3.9.0           18_osx64_openblas    conda-forge
libcurl                   8.3.0                h5f667d7_0    conda-forge
libcxx                    16.0.6               hd57cbcb_0    conda-forge
libdb                     6.2.32               he49afe7_0    conda-forge
libdeflate                1.18                 hac1461d_0    conda-forge
libedit                   3.1.20191231         h0678c8f_2    conda-forge
libev                     4.33                 haf1e3a3_1    conda-forge
libexpat                  2.5.0                hf0c8a7f_1    conda-forge
libffi                    3.4.2                h0d85af4_5    conda-forge
libgfortran               5.0.0           13_2_0_h97931a8_1    conda-forge
libgfortran5              13.2.0               h2873a65_1    conda-forge
libiconv                  1.17                 hac89ed1_0    conda-forge
libidn2                   2.3.4                hb7f2c08_0    conda-forge
libnghttp2                1.52.0               he2ab024_0    conda-forge
libopenblas               0.3.24          openmp_h48a4ad5_0    conda-forge
libsqlite                 3.43.0               h58db7d2_0    conda-forge
libssh2                   1.11.0               hd019ec5_0    conda-forge
libunistring              0.9.10               h0d85af4_0    conda-forge
libzlib                   1.2.13               h8a1eda9_5    conda-forge
llvm-openmp               16.0.6               hff08bdf_0    conda-forge
mafft                     7.520                h2413b67_2    bioconda
minimap2                  2.26                 h45fc8d7_1    bioconda
muscle                    5.1                  h7d747a2_3    bioconda
ncbi-vdb                  3.0.0           pl5321h9722bc1_0    bioconda
ncurses                   6.4                  hf0c8a7f_0    conda-forge
openjdk                   20.0.2               h7d26f99_1    conda-forge
openssl                   3.1.3                h8a1eda9_0    conda-forge
paml                      4.10.6               h2413b67_2    bioconda
parallel                  20230722             h694c41f_0    conda-forge
pcre                      8.45                 he49afe7_0    conda-forge
perl                      5.32.1          4_h0dc2134_perl5    conda-forge
perl-algorithm-diff       1.201           pl5321hd8ed1ab_0    conda-forge
perl-archive-tar          2.40            pl5321hdfd78af_0    bioconda
perl-base                 2.23            pl5321hd8ed1ab_0    conda-forge
perl-bio-asn1-entrezgene  1.73            pl5321hdfd78af_3    bioconda
perl-bio-coordinate       1.007001        pl5321hdfd78af_3    bioconda
perl-bio-featureio        1.6.905         pl5321hdfd78af_4    bioconda
perl-bio-samtools         1.43            pl5321h1f540d2_3    bioconda
perl-bio-searchio-hmmer   1.7.3           pl5321hdfd78af_0    bioconda
perl-bio-tools-phylo-paml 1.7.3           pl5321hdfd78af_3    bioconda
perl-bio-tools-run-alignment-clustalw 1.7.4           pl5321hdfd78af_3    bioconda
perl-bio-tools-run-alignment-tcoffee 1.7.4           pl5321hdfd78af_5    bioconda
perl-bioperl              1.7.8                hdfd78af_1    bioconda
perl-bioperl-core         1.7.8           pl5321hdfd78af_1    bioconda
perl-bioperl-run          1.007003        pl5321hdfd78af_0    bioconda
perl-business-isbn        3.007           pl5321hd8ed1ab_0    conda-forge
perl-business-isbn-data   20210112.006    pl5321hd8ed1ab_0    conda-forge
perl-carp                 1.50            pl5321hd8ed1ab_0    conda-forge
perl-class-data-inheritable 0.09            pl5321h694c41f_0    conda-forge
perl-common-sense         3.75            pl5321hd8ed1ab_0    conda-forge
perl-compress-raw-bzip2   2.201           pl5321h775f41a_0    conda-forge
perl-compress-raw-zlib    2.202           pl5321h775f41a_0    conda-forge
perl-constant             1.33            pl5321hd8ed1ab_0    conda-forge
perl-data-dumper          2.183           pl5321h775f41a_0    conda-forge
perl-db_file              1.858           pl5321hac89ed1_0    conda-forge
perl-devel-stacktrace     2.04            pl5321h694c41f_0    conda-forge
perl-digest-hmac          1.04            pl5321hdfd78af_0    bioconda
perl-digest-md5           2.58            pl5321hb7f2c08_0    conda-forge
perl-encode               3.19            pl5321hb7f2c08_0    conda-forge
perl-encode-locale        1.05            pl5321hdfd78af_7    bioconda
perl-exception-class      1.45            pl5321hdfd78af_0    bioconda
perl-exporter             5.74            pl5321hd8ed1ab_0    conda-forge
perl-exporter-tiny        1.002002        pl5321hd8ed1ab_0    conda-forge
perl-extutils-makemaker   7.70            pl5321hd8ed1ab_0    conda-forge
perl-file-listing         6.16            pl5321hdfd78af_0    bioconda
perl-file-slurp-tiny      0.004           pl5321hdfd78af_2    bioconda
perl-file-sort            1.01            pl5321hdfd78af_3    bioconda
perl-file-spec            3.48_01         pl5321hdfd78af_2    bioconda
perl-getopt-long          2.54            pl5321hdfd78af_0    bioconda
perl-html-parser          3.81            pl5321hb3ea9af_0    bioconda
perl-html-tagset          3.20            pl5321hdfd78af_4    bioconda
perl-http-cookies         6.10            pl5321hdfd78af_0    bioconda
perl-http-daemon          6.16            pl5321hdfd78af_0    bioconda
perl-http-date            6.06            pl5321hdfd78af_0    bioconda
perl-http-message         6.36            pl5321hdfd78af_0    bioconda
perl-http-negotiate       6.01            pl5321hdfd78af_4    bioconda
perl-io-compress          2.201           pl5321h7133b54_2    bioconda
perl-io-html              1.004           pl5321hdfd78af_0    bioconda
perl-io-socket-ssl        2.075           pl5321hd8ed1ab_0    conda-forge
perl-io-string            1.08            pl5321hdfd78af_4    bioconda
perl-io-tty               1.16            pl5321h775f41a_0    conda-forge
perl-io-zlib              1.14            pl5321hdfd78af_0    bioconda
perl-ipc-run              20200505.0      pl5321hdfd78af_0    bioconda
perl-json                 4.10            pl5321hdfd78af_0    bioconda
perl-json-xs              2.34            pl5321hcd10b59_5    bioconda
perl-libwww-perl          6.67            pl5321hdfd78af_0    bioconda
perl-libxml-perl          0.08            pl5321hdfd78af_3    bioconda
perl-list-moreutils       0.430           pl5321hdfd78af_0    bioconda
perl-list-moreutils-xs    0.430           pl5321ha5712d3_1    bioconda
perl-lwp-mediatypes       6.04            pl5321hdfd78af_1    bioconda
perl-mime-base64          3.16            pl5321h775f41a_0    conda-forge
perl-net-http             6.22            pl5321hdfd78af_0    bioconda
perl-net-ssleay           1.92            pl5321h278ddf8_1    conda-forge
perl-ntlm                 1.09            pl5321hdfd78af_5    bioconda
perl-parent               0.241           pl5321hd8ed1ab_0    conda-forge
perl-pathtools            3.75            pl5321h775f41a_0    conda-forge
perl-scalar-list-utils    1.63            pl5321h775f41a_0    conda-forge
perl-socket               2.027           pl5321ha5712d3_3    bioconda
perl-storable             3.15            pl5321h775f41a_0    conda-forge
perl-sub-uplevel          0.2800          pl5321h775f41a_0    conda-forge
perl-test-deep            1.130           pl5321hd8ed1ab_0    conda-forge
perl-test-differences     0.70            pl5321h694c41f_0    conda-forge
perl-test-exception       0.43            pl5321hd8ed1ab_0    conda-forge
perl-test-fatal           0.016           pl5321h694c41f_0    conda-forge
perl-test-most            0.38            pl5321hdfd78af_0    bioconda
perl-test-warn            0.37            pl5321hd8ed1ab_0    conda-forge
perl-test-warnings        0.031           pl5321h694c41f_0    conda-forge
perl-text-diff            1.45            pl5321hd8ed1ab_0    conda-forge
perl-time-local           1.35            pl5321hdfd78af_0    bioconda
perl-timedate             2.33            pl5321hdfd78af_2    bioconda
perl-tree-dag_node        1.32            pl5321hdfd78af_0    bioconda
perl-try-tiny             0.31            pl5321h694c41f_0    conda-forge
perl-types-serialiser     1.01            pl5321hdfd78af_0    bioconda
perl-uri                  5.17            pl5321h694c41f_0    conda-forge
perl-url-encode           0.03            pl5321h527b516_0    bioconda
perl-www-robotrules       6.02            pl5321hdfd78af_4    bioconda
perl-xml-dom              1.46            pl5321hdfd78af_1    bioconda
perl-xml-dom-xpath        0.14            pl5321hdfd78af_2    bioconda
perl-xml-parser           2.44_01         pl5321h06ef574_1003    conda-forge
perl-xml-regexp           0.04            pl5321hdfd78af_3    bioconda
perl-xml-xpathengine      0.14            pl5321hdfd78af_3    bioconda
pip                       23.2.1             pyhd8ed1ab_0    conda-forge
python                    3.11.5          h30d4d87_0_cpython    conda-forge
readline                  8.2                  h9e318b2_1    conda-forge
samclip                   0.4.0                hdfd78af_1    bioconda
samtools                  1.17                 h25dfcfb_1    bioconda
seqtk                     1.4                  h45fc8d7_1    bioconda
setuptools                68.2.2             pyhd8ed1ab_0    conda-forge
snippy                    4.6.0                hdfd78af_3    bioconda
snp-sites                 2.5.1                h45fc8d7_4    bioconda
snpeff                    5.0                  hdfd78af_1    bioconda
t-coffee                  12.00.7fb08c2        h26a2512_0    bioconda
tabixpp                   1.1.2                hdc9e95e_1    bioconda
tk                        8.6.12               h5dbffcc_0    conda-forge
tzdata                    2023c                h71feb2d_0    conda-forge
vcflib                    1.0.2                h819f6dc_6    bioconda
viennarna                 2.4.7                h470a237_4    bioconda
vt                        0.57721              hfd6c91b_9    bioconda
wget                      1.20.3               hd3787cc_1    conda-forge
wheel                     0.41.2             pyhd8ed1ab_0    conda-forge
xz                        5.2.6                h775f41a_0    conda-forge
zlib                      1.2.13               h8a1eda9_5    conda-forge
zstd                      1.5.5                h829000d_0    conda-forge

### Conda output snps.log 

dyld[14593]: Library not loaded: @rpath/libtabixpp.0.dylib
  Referenced from: <CC39E3FB-E880-3379-9A2C-B8EF798A32A3> /Users/hughgifford/miniconda3/envs/snippy/bin/vcfuniq
  Reason: tried: '/Users/hughgifford/miniconda3/envs/snippy/bin/../lib/libtabixpp.0.dylib' (no such file), '/Users/hughgifford/miniconda3/envs/snippy/bin/../lib/libtabixpp.0.dylib' (no such file), '/usr/local/lib/libtabixpp.0.dylib' (no such file), '/usr/lib/libtabixpp.0.dylib' (no such file, not in dyld cache)
dyld[14591]: Library not loaded: @rpath/libtabixpp.0.dylib
  Referenced from: <020BDE82-37AD-3A5B-A97B-B1AC787C020D> /Users/hughgifford/miniconda3/envs/snippy/bin/vcfstreamsort
  Reason: tried: '/Users/hughgifford/miniconda3/envs/snippy/bin/../lib/libtabixpp.0.dylib' (no such file), '/Users/hughgifford/miniconda3/envs/snippy/bin/../lib/libtabixpp.0.dylib' (no such file), '/usr/local/lib/libtabixpp.0.dylib' (no such file), '/usr/lib/libtabixpp.0.dylib' (no such file, not in dyld cache)
Traceback (most recent call last):
  File ""/Users/hughgifford/miniconda3/envs/snippy/bin/vcffirstheader"", line 17, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe
Exception ignored in: <_io.TextIOWrapper name='<stdout>' mode='w' encoding='utf-8'>
BrokenPipeError: [Errno 32] Broken pipe
/Users/hughgifford/miniconda3/envs/snippy/bin/freebayes-parallel: line 39: 14589 Exit 141                ( cat ""$regionsfile"" | parallel -k -j ""$ncpus"" ""${command[@]}"" --region {} )
     14590 Exit 120                | vcffirstheader
     14591 Abort trap: 6           | vcfstreamsort -w 1000
     14593 Abort trap: 6           | vcfuniq


### Brew install snps.log

dyld[10799]: Library not loaded: @rpath/libcrypto.1.1.dylib
  Referenced from: <EF7BDB2C-8AE7-3333-A9DA-7076233B266D> /Users/hughgifford/miniconda3/bin/vt
  Reason: tried: '/Users/hughgifford/miniconda3/bin/../lib/libcrypto.1.1.dylib' (no such file), '/Users/hughgifford/miniconda3/bin/../lib/libcrypto.1.1.dylib' (no such file), '/usr/local/lib/libcrypto.1.1.dylib' (no such file), '/usr/lib/libcrypto.1.1.dylib' (no such file, not in dyld cache)

In this case, I was able to find this file (/Users/hughgifford/miniconda3/pkgs/openssl-1.1.1w-h8a1eda9_0/lib/libcrypto.1.1.dylib) and created a sym link in /usr/lib/. However, the number of bases called was extremely low (well under 1 % of reference genome) compared to other callers.

### Plea

I would like to get this working in conda so that it can be implemented across an hpc cluster - please would you advise as to how to get a reliable install of snippy working without these build issues? Thank you again.

I note a similar build issue at
- https://github.com/tseemann/snippy/issues/528
- https://github.com/tseemann/snippy/issues/413
And a similar fault at
- https://github.com/tseemann/snippy/issues/494",hughgifford,https://github.com/tseemann/snippy/issues/565
I_kwDOAS4qDc5zGpkB,error,OPEN,2023-10-07T01:54:06Z,2023-10-19T16:22:13Z,,"I am trying Snippy with contigs genomes, but after running for a while it shows the following error. Please suggest how to improve it. Also, I tried snippy-multi but it also did not generate any data in .vcf file.

snippy --outdir P2225824 --ctgs P2225824.fasta --ref Reference.gbk --cpus 8

error..log file
### echo snippy 4.6.0
### cd /Dropbox/p_multocida_genomes/genomes

### /anaconda3/envs/snippy_env/bin/snippy --outdir P2225824 --ctgs P2225824.fasta --ref Reference.gbk --cpus 8

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.01 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.31 seconds elapse.
[bwa_index] Update BWT... 0.01 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.11 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.505 sec; CPU: 0.456 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:P2225824\tSM:P2225824' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam

samtools markdup: warning, unable to calculate estimated library size. Read pairs 0 should be greater than duplicate pairs 0, which should both be non zero.

COMMAND: samtools markdup -T /tmp --threads 3 -r -s - -
READ: 170782
WRITTEN: 170078
EXCLUDED: 13726
EXAMINED: 157056
PAIRED: 0
SINGLE: 157056
DUPLICATE PAIR: 0
DUPLICATE SINGLE: 704
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 704
DUPLICATE TOTAL: 704
ESTIMATED_LIBRARY_SIZE: 0


### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 172121 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

vcfuniq: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
vcfstreamsort: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
Traceback (most recent call last):
  File ""/anaconda3/envs/snippy_env/bin/vcffirstheader"", line 17, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe",sekhwal,https://github.com/tseemann/snippy/issues/566
I_kwDOAS4qDc50YLJG,Can't run snippy-core with more than 1 CPU,OPEN,2023-10-19T15:08:12Z,2023-10-19T15:08:12Z,,"Hi!
I was calling SNPs with 30 CPUs. However, I noticed that after SNP calling, when snippy-core started, the CPU usage was of only one. Is there a way to fix this?

Thanks!
Alejandro",Alejandro-PI,https://github.com/tseemann/snippy/issues/569
I_kwDOAS4qDc50ejhb,libtabixpp.so.0: cannot open shared object file,OPEN,2023-10-20T12:14:27Z,2024-01-29T19:57:43Z,,"Hi,

I have this error that seemed to be coming from freebayes, I have googled but still have no idea of how to solve it.

### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

vcfstreamsort: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
vcfuniq: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
Traceback (most recent call last):
  File ""/home/ubuntu/mambaforge/bin/vcffirstheader"", line 17, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe

Also, can I say that the mapping is completed without any error and I can use the bam file?

Please see the complete log file below.

Thanks,
Dorothy

### echo snippy 4.6.0
### cd /home/ubuntu/Dorothy/assembly_analysis

### /home/ubuntu/snippy/bin/snippy --outdir SRR7209059_snippy --ref Ssonnei_Ss046_genome.fasta --R1 SRR7209059_1_trimmed.fastq.gz --R2 SRR7209059_2_trimmed.fastq.gz

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.06 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 2.67 seconds elapse.
[bwa_index] Update BWT... 0.03 sec
[bwa_index] Pack forward-only FASTA... 0.03 sec
[bwa_index] Construct SA from BWT and Occ... 0.80 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 3.772 sec; CPU: 3.600 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:SRR7209059_snippy\tSM:SRR7209059_snippy' -t 8 reference/ref.fa /home/ubuntu/Dorothy/assembly_analysis/SRR7209059_1_trimmed.fastq.gz /home/ubuntu/Dorothy/assembly_analysis/SRR7209059_2_trimmed.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam

COMMAND: samtools markdup -T /tmp --threads 3 -r -s - -
READ: 4820320
WRITTEN: 4716270
EXCLUDED: 697874
EXAMINED: 4122446
PAIRED: 4094516
SINGLE: 27930
DUPLICATE PAIR: 83648
DUPLICATE SINGLE: 20402
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 104050
DUPLICATE TOTAL: 104050
ESTIMATED_LIBRARY_SIZE: 49421215


### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 327049 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

vcfstreamsort: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
vcfuniq: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
Traceback (most recent call last):
  File ""/home/ubuntu/mambaforge/bin/vcffirstheader"", line 17, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe
",DorothyTamYiLing,https://github.com/tseemann/snippy/issues/570
I_kwDOAS4qDc53Gebm,Using Snippy to identify the delete which is about 1kb to 5kb,OPEN,2023-11-17T03:08:00Z,2023-11-17T03:08:00Z,,"Hi！Torsten
",TaoCheng98,https://github.com/tseemann/snippy/issues/571
I_kwDOAS4qDc53O4bk,snippy-multi ERROR: Could not find .aligned.fa/.vcf in 100AEA1,OPEN,2023-11-18T11:54:43Z,2024-03-06T10:24:52Z,,"Running in WSL2Ubuntu. Have 227 assemblies in contigs in .fna.
commands:
snippy-multi files.txt --ref ../prokka227/SA1.gbk --cpus 16 > runme.sh
sh ./runme.sh 
symptoms:
completes all the calls to snippy but then gets the error in the call to snippy-core:
snippy-core --ref '100AEA1/ref.fa' 100AEA1 108EA1 1212-11909 1415 1552 1675 170AEA1 1710s23 1711s24 1749 1750 1751 1752 1753 1754 1755 1756 1757 1758 197EA2 215EA1 2D5_DIV0622 ARS16 ARS48 ARS57 ARS60 ARS62 ARS64 ARS65 ARS71 ARS9 AS21 ATCC43198a ATCC43198b An144 An483 An69 B05581 BB-66 BRZ_PB__bin29 CB-32 CE1 CE2 CE3 CHD112EN CHD121EN CHD139EN CHD140EN CHD141EN CHD158EN CHD161EN CHD182EN CHD192EN CHD1EN CHD222EN CHD259EN CHD261EN CHD263EN CHD265EN CHD26EN CHD270EN CHD278EN CHD285EN CHD288EN CHD293EN CHD319EN CHD341EN CHD347EN CHD37EN CHD49EN CHD62EN CHD78EN CHD83EN CHD94EN CHD96EN CIRMBP-1195 CIRMBP-1196 CIRMBP-1197 CIRMBP-1205 CIRMBP-1206 CIRMBP-1207 CIRMBP-1208 CIRMBP-1209 CIRMBP-1210 CIRMBP-1211 CIRMBP-1212 CIRMBP-1213 CIRMBP-1214 CIRMBP-1215 CIRMBP-1216 CIRMBP-1217 CIRMBP-1218 CIRMBP-1219 CIRMBP-1220 CIRMBP-1221 CIRMBP-1222 CIRMBP-1223 CIRMBP-1224 CIRMBP-1225 CIRMBP-1226 CIRMBP-1227 CIRMBP-1228 CIRMBP-1229 CIRMBP-1230 CIRMBP-1231 CIRMBP-1232 CIRMBP-1233 CIRMBP-1234 CIRMBP-1235 CIRMBP-1236 CIRMBP-1237 CIRMBP-1238 CIRMBP-1239 CIRMBP-1240 CIRMBP-1241 CIRMBP-1242 CIRMBP-1243 CIRMBP-1244 CIRMBP-1245 CIRMBP-1246 CIRMBP-1247 CIRMBP-1248 CIRMBP-1249 CIRMBP-1250 CIRMBP-1251 CIRMBP-1252 CIRMBP-1253 CIRMBP-1254 CIRMBP-1255 CIRMBP-1256 CIRMBP-1257 CIRMBP-1258 CIRMBP-1259 CIRMBP-1260 CIRMBP-1261 CIRMBP-1262 CIRMBP-1263 CIRMBP-1264 CIRMBP-1265 CIRMBP-1266 CIRMBP-1267 CIRMBP-1268 CIRMBP-1269 CIRMBP-1270 CIRMBP-1271 CIRMBP-1272 CIRMBP-1273 CIRMBP-1274 CIRMBP-1275 CIRMBP-1276 CIRMBP-1277 CIRMBP-1278 CIRMBP-1279 CIRMBP-1280 CIRMBP-1281 CIRMBP-1282 CIRMBP-1283 CIRMBP-1284 CIRMBP-1285 CIRMBP-1286 CIRMBP-1287 CIRMBP-1288 CIRMBP-1289 CIRMBP-1290 CIRMBP-1291 CIRMBP-1292 CIRMBP-1293 CIRMBP-1294 CIRMBP-1295 CIRMBP-1296 CIRMBP-1297 CIRMBP-1298 CIRMBP-1299 CIRMBP-1300 CIRMBP-1301 CIRMBP-1302 CIRMBP-1303 CIRMBP-1304 CL-1 D-104 DSM20682a DSM20682b E1062 ERR3414584 ESM13AIC1 ESM13C1 ESM877AIC1 G-29 LB5753 LB5754 LB5756 LB5759 LB5800 LB5836 LB5840 LB5843 LB5856 LB5857 LB5860 LB5864 LB5872 LB5876 LB5880 LB5916 LB5922 LB5923 LB5924 LB5925 LB5926 LB5927 LBV_466 NCTC12421 NCTC12422 PS1 PS10 PS11 PS2 PS3 PS5 PS6 PS7 PS8 SA1 SA2 SA3 WCA-380 mag_170


Last of outptu:
This is snippy-core 4.6.0
Obtained from http://github.com/tseemann/snippy
Enabling bundled tools for linux
Found any2fasta - /home/drhoads/miniconda3/envs/r-ldweaver/bin/any2fasta
Found samtools - /home/drhoads/miniconda3/envs/r-ldweaver/bin/samtools
Found minimap2 - /home/drhoads/miniconda3/envs/r-ldweaver/bin/minimap2
Found bedtools - /home/drhoads/miniconda3/envs/r-ldweaver/bin/bedtools
Found snp-sites - /home/drhoads/miniconda3/envs/r-ldweaver/bin/snp-sites
Saving reference FASTA: core.ref.fa
This is any2fasta 0.4.2
Opening '100AEA1/ref.fa'
Detected FASTA format
Read 37690 lines from '100AEA1/ref.fa'
Wrote 1 sequences from FASTA file.
Processed 1 files.
Done.
Loaded 1 sequences totalling 2261297 bp.
Will mask 0 regions totalling 0 bp ~ 0.00%
ERROR: Could not find .aligned.fa/.vcf in 100AEA1

The snippy output created a folder for 100AEA1 that contains:
.:
total 97272
92148 fake_reads.fq
    0 files.txt
    0 ref.fa
    0 ref.fa.fai
    0 reference
 5116 snps.bam
    4 snps.bam.bai
    4 snps.log
    0 snps.raw.vcf

./reference:
total 7376
   0 genomes
   0 ref
2248 ref.fa
   4 ref.fa.amb
   0 ref.fa.ann
2212 ref.fa.bwt
   0 ref.fa.fai
 556 ref.fa.pac
1108 ref.fa.sa
1232 ref.gff
   4 ref.txt
  12 snpeff.config

./reference/genomes:
total 2248
2248 ref.fa

./reference/ref:
total 1296
500 genes.gff.gz
796 snpEffectPredictor.bin

Seems there are a couple of times this issue has come up in these archives but has been closed without a clear resolution.
",drhoads,https://github.com/tseemann/snippy/issues/572
I_kwDOAS4qDc53WhV2,Possible to set %identity of reads mapping to ref?,OPEN,2023-11-20T14:58:48Z,2023-11-20T14:58:48Z,,"Hi there! I would love to use snippy for ""mixed"" datasets with multiple bacterial genomes in. At the moment I am getting mixed mapping to the rRNA operons. Is there a way of setting this in the bwa part (I'm not sure that --mapqual does what I want?). Or would masking the rRNA operons be a better method? Thanks!",appliedmicrobiologyresearch,https://github.com/tseemann/snippy/issues/573
I_kwDOAS4qDc53ZkQE,samtools excluded most reads,OPEN,2023-11-20T23:35:20Z,2024-05-31T14:06:41Z,,"Hi tseemann, 

I am use snippy 4.6.0, and I am wondering why samtools excluded most of the reads. In the end, I got no variant (I am expecting variant), and when I calculate the read depth per position (using samtools depth), I only have about 1-2 read per position (I am expecting at least 50+ reads). There is a samtools markdup warning but I am not sure if it is related.

Thanks,
Dorothy

Here is the complete log file:

### echo snippy 4.6.0
### cd /Users/tyl205/Documents/Ssonnei_read_download_fastq_18

### /Users/tyl205/snippy/bin/snippy --outdir SRR10874279_ctg1_metG_snippy --ref /Users/tyl205/Documents/plasmids/SRR5024067_2034_1251_Bottom_ctg1_metG_2652578to2654612.fasta --R1 SRR10874279_1_trimmed.fastq.gz --R2 SRR10874279_2_trimmed.fastq.gz

### samtools faidx reference/ref.fa

### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.00 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.00 seconds elapse.
[bwa_index] Update BWT... 0.00 sec
[bwa_index] Pack forward-only FASTA... 0.00 sec
[bwa_index] Construct SA from BWT and Occ... 0.00 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.006 sec; CPU: 0.003 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:SRR10874279_ctg1_metG_snippy\tSM:SRR10874279_ctg1_metG_snippy' -t 8 reference/ref.fa /Users/tyl205/Documents/Ssonnei_read_download_fastq_18/SRR10874279_1_trimmed.fastq.gz /Users/tyl205/Documents/Ssonnei_read_download_fastq_18/SRR10874279_2_trimmed.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /private/var/folders/5j/6qfs2qpx3s777t4pc0yntz380000gq/T --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /private/var/folders/5j/6qfs2qpx3s777t4pc0yntz380000gq/T --threads 3 -m 2000M | samtools markdup -T /private/var/folders/5j/6qfs2qpx3s777t4pc0yntz380000gq/T --threads 3 -r -s - - > snps.bam

samtools markdup: warning, unable to calculate estimated library size. Read pairs 12 should be greater than duplicate pairs 0, which should both be non zero.

**COMMAND: samtools markdup -T /private/var/folders/5j/6qfs2qpx3s777t4pc0yntz380000gq/T --threads 3 -r -s - -
READ: 34700
WRITTEN: 34700
EXCLUDED: 34670
EXAMINED: 30
PAIRED: 24
SINGLE: 6
DUPLICATE PAIR: 0
DUPLICATE SINGLE: 0
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 0
DUPLICATE TOTAL: 0
ESTIMATED_LIBRARY_SIZE: 0**


### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 1000 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### cp snps.filt.vcf snps.vcf


### /Users/tyl205/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 0 SNPs to TAB format.

### /Users/tyl205/snippy/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf


### bcftools convert -Oz -o snps.vcf.gz snps.vcf


### bcftools index -f snps.vcf.gz


### bcftools consensus --sample SRR10874279_ctg1_metG_snippy -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz

Applied 0 variants

### bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf


### bcftools index -f snps.subs.vcf.gz


### bcftools consensus --sample SRR10874279_ctg1_metG_snippy -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz

Applied 0 variants

### rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi

",DorothyTamYiLing,https://github.com/tseemann/snippy/issues/574
I_kwDOAS4qDc53p87g,Number of contigs mismatch when generated from gbk file,CLOSED,2023-11-23T04:54:32Z,2023-11-23T04:57:45Z,2023-11-23T04:57:45Z,"I have an issue with variant calling using the gbk file as reference. Before annotation, the number of contigs was 460, but when snippy extracts contigs and write them to a reference file, the number changes to 2565. Because of this many SVs are annotated as BND. Is this a normal behaviour? I would like to use the snippy generated bam file for SV detection.",sreerampeela,https://github.com/tseemann/snippy/issues/575
I_kwDOAS4qDc54rB1o,Files to test an installation,OPEN,2023-12-04T19:17:58Z,2023-12-04T19:17:58Z,,I suspect there might be something wrong with my installation.  Do you have a read set that I can use to test the installation?,jolespin,https://github.com/tseemann/snippy/issues/576
I_kwDOAS4qDc55uxX3,Error running snippy ,OPEN,2023-12-14T19:05:15Z,2023-12-14T19:05:15Z,,"Hello everyone, 

I am running snippy typing:

snippy --cpus 5 --outdir var --ref sequence.gb --pe1 R1_trimmed.fastq.gz --pe2 R2_trimmed.fastq.gz

Receiving this error: Error running command, check var/snps.log

When I check this file:

### samtools faidx reference/ref.fa
### bwa index reference/ref.fa
[bwa_index] Pack FASTA... 0.00 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.00 seconds elapse.
[bwa_index] Update BWT... 0.00 sec
[bwa_index] Pack forward-only FASTA... 0.00 sec
[bwa_index] Construct SA from BWT and Occ... 0.00 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.009 sec; CPU: 0.002 sec
### mkdir reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa
### mkdir reference/ref && bgzip -c reference/ref.gff > reference/ref/genes.gff.gz
### (bwa mem  -v 2 -M -R '@RG   ID:snps SM:snps' -t 5 reference/ref.fa fake_reads.fq | samtools view -@ 5 -F 3844 -q 60 -S -b -u -T reference/ref.fa - | samtools sort -O bam -o snps.bam -@ 5 -)
[E::bwa_set_rg] the read group line contained literal <tab> characters -- replace with escaped tabs: \t
### samtools index snps.bam
### samtools depth -q 20 snps.bam | bgzip > snps.depth.gz
### tabix -s 1 -b 2 -e 2 snps.depth.gz
### fasta_generate_regions.py reference/ref.fa.fai 1000 > reference/ref.txt
### freebayes-parallel reference/ref.txt 5 -p 1 -q 20 -m 60 --min-coverage 10 -V -f reference/ref.fa snps.bam > snps.raw.vcf

Does someone know how to solve? I guess there is something wrong with the installation of snippy, but typing snippy --check and snippy --help, everything seems to be ok.

Thank you very much,

Regards,

Alba",AlbaMunozSanta,https://github.com/tseemann/snippy/issues/577
I_kwDOAS4qDc55wKOq,Which alignment file can be used to create SNP matrix for clonal studies,OPEN,2023-12-14T23:47:04Z,2023-12-19T22:07:17Z,,"Hi everyone!

Snippy generates two different sized alignment files core.aln and core.full.aln. which alignment file will be used to create SNP matrix to study clonal samples? Whether Core.full.aln contains core plus accessory genomes as it is multiple times greater in size than core.aln

Thank You
Firdoos",Firdoos071,https://github.com/tseemann/snippy/issues/578
I_kwDOAS4qDc58AtHR,How to use snippy with pre-indexed reference,OPEN,2024-01-14T03:03:59Z,2024-01-14T03:03:59Z,,"Thanks for create snippy. It is very useful tools, it help me very much when working. During working, I must work with one reference (human genome) many times. Can i use pre-indexed reference genome to reduce time running of snippy? ",minhdz09,https://github.com/tseemann/snippy/issues/579
I_kwDOAS4qDc59Oz6S,Snippy: no output - identification of 0 variants and empty csv file,OPEN,2024-01-25T19:32:10Z,2024-08-11T23:19:05Z,,"Hello,
I am trying to use snippy 4.6.0 via miniconda3 on Linux and the output given indicates my samples have 0 variants compared to the reference genome. 
The created snps.csv has no data in it and is empty.
Does anyone know what to do? 
Thank you if you're able to help!!

I've attached the run log and the snps.log file:
--- Run log file:
[11:46:25] This is snippy 4.6.0
[11:46:25] Written by Torsten Seemann
[11:46:25] Obtained from https://github.com/tseemann/snippy
[11:46:25] Detected operating system: linux
[11:46:25] Enabling bundled linux tools.
[11:46:25] Found bwa - /old_Users/[--]/miniconda3/envs/snippy/bin/bwa
[11:46:25] Found bcftools - /old_Users/[--]/miniconda3/envs/snippy/bin/bcftools
[11:46:25] Found samtools - /old_Users/[--]/miniconda3/envs/snippy/bin/samtools
[11:46:25] Found java - /old_Users/[--]/miniconda3/envs/snippy/bin/java
[11:46:25] Found snpEff - /old_Users/[--]/miniconda3/envs/snippy/bin/snpEff
[11:46:25] Found samclip - /old_Users/[--]/miniconda3/envs/snippy/bin/samclip
[11:46:25] Found seqtk - /old_Users/[--]/miniconda3/envs/snippy/bin/seqtk
[11:46:25] Found parallel - /old_Users/[--]/miniconda3/envs/snippy/bin/parallel
[11:46:25] Found freebayes - /old_Users/[--]/miniconda3/envs/snippy/bin/freebayes
[11:46:25] Found freebayes-parallel - /old_Users/[--]/miniconda3/envs/snippy/bin/freebayes-parallel
[11:46:25] Found fasta_generate_regions.py - /old_Users/[--]/miniconda3/envs/snippy/bin/fasta_generate_regions.py
[11:46:25] Found vcfstreamsort - /old_Users/[--]/miniconda3/envs/snippy/bin/vcfstreamsort
[11:46:25] Found vcfuniq - /old_Users/[--]/miniconda3/envs/snippy/bin/vcfuniq
[11:46:25] Found vcffirstheader - /old_Users/[--]/miniconda3/envs/snippy/bin/vcffirstheader
[11:46:25] Found gzip - /usr/bin/gzip
[11:46:25] Found vt - /old_Users/[--]/miniconda3/envs/snippy/bin/vt
[11:46:25] Found snippy-vcf_to_tab - /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_to_tab
[11:46:25] Found snippy-vcf_report - /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_report
[11:46:27] Checking version: samtools --version is >= 1.7 - ok, have 1.19
[11:46:29] Checking version: bcftools --version is >= 1.7 - ok, have 1.19
[11:46:30] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.6
[11:46:36] Checking version: snpEff -version is >= 4.3 - ok, have 5.0
[11:46:37] Checking version: bwa is >= 0.7.12 - ok, have 0.7.17
[11:46:37] Using reference: /old_Users/[--]/downgraded_Snippy_version/NC_007795_NCTC8325.gb
[11:46:37] Treating reference as 'genbank' format.
[11:46:37] Will use 8 CPU cores.
[11:46:37] Using read file: /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R1_001.fastq
[11:46:37] Using read file: /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R2_001.fastq
[11:46:37] Creating folder: snp_test
[11:46:37] Changing working directory: snp_test
[11:46:37] Creating reference folder: reference
[11:46:37] Extracting FASTA and GFF from reference.
[11:46:39] Wrote 1 sequences to ref.fa
[11:46:39] Wrote 2844 features to ref.gff
[11:46:39] Creating reference/snpeff.config
[11:46:39] Freebayes will process 15 chunks of 191231 bp, 8 chunks at a time.
[11:46:39] Using BAM RG (Read Group) ID: snp_test
[11:46:39] Running: samtools faidx reference/ref.fa 2>> snps.log
[11:46:39] Running: bwa index reference/ref.fa 2>> snps.log
[11:46:40] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[11:46:40] Running: ln -sf reference/ref.fa . 2>> snps.log
[11:46:40] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[11:46:40] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[11:46:40] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[11:46:44] Running: bwa mem  -Y -M -R '@RG\tID:snp_test\tSM:snp_test' -t 8 reference/ref.fa /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R1_001.fastq /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R2_001.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /localscratch/583419.1.[-] --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /localscratch/583419.1.[-] --threads 3 -m 2000M | samtools markdup -T /localscratch/583419.1.[-] --threads 3 -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 1 sequences in reference/ref.fa.fai
[M::process] read 289906 sequences (80000551 bp)...
[M::process] read 289176 sequences (80000175 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (0, 132467, 31, 0)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (268, 342, 430)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 754)
[M::mem_pestat] mean and std.dev: (351.22, 126.79)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 916)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (939, 1593, 3844)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 9654)
[M::mem_pestat] mean and std.dev: (1935.81, 1451.15)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 12559)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 289906 reads in 36.382 CPU sec, 4.595 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[M::process] read 288790 sequences (80000471 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (0, 131816, 24, 0)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (269, 342, 429)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 749)
[M::mem_pestat] mean and std.dev: (351.39, 125.60)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 909)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (391, 1048, 1415)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 3463)
[M::mem_pestat] mean and std.dev: (862.41, 546.18)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 4487)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 289176 reads in 38.864 CPU sec, 5.133 real sec
[samclip] Processed 300000 records...
[samclip] Processed 400000 records...
[samclip] Processed 500000 records...
[M::process] read 53090 sequences (14767427 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (0, 131644, 21, 0)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (270, 344, 433)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 759)
[M::mem_pestat] mean and std.dev: (354.05, 127.24)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 922)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (403, 1075, 2134)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 5596)
[M::mem_pestat] mean and std.dev: (1531.71, 1386.03)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 7327)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 288790 reads in 39.789 CPU sec, 5.230 real sec
[samclip] Processed 600000 records...
[samclip] Processed 700000 records...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (0, 24204, 2, 0)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (272, 345, 433)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 755)
[M::mem_pestat] mean and std.dev: (354.67, 125.71)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 916)
[M::mem_pestat] skip orientation RF as there are not enough pairs
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_process_seqs] Processed 53090 reads in 8.279 CPU sec, 1.163 real sec
[samclip] Processed 800000 records...
[samclip] Processed 900000 records...
[main] Version: 0.7.17-r1188
[main] CMD: bwa mem -Y -M -R @RG\tID:snp_test\tSM:snp_test -t 8 reference/ref.fa /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R1_001.fastq /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R2_001.fastq[samclip] Total SAM records 922936, removed 46250, allowed 17108, passed 876686
[samclip] Header contained 3 lines
[samclip] Done.

[main] Real time: 18.665 sec; CPU: 124.138 sec
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[11:47:13] Running: samtools index snps.bam 2>> snps.log
[11:47:13] Running: fasta_generate_regions.py reference/ref.fa.fai 191231 > reference/ref.txt 2>> snps.log
[11:47:14] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[11:47:23] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [n] no fail on reference inconsistency for non SNPs false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa

[variant_manip.cpp:75 is_ref_consistent] Variant is not consistent: NC_007795:20306-20325 - TTAAAGGTAAAGGTAAAGGT(REF) vs (FASTA)
[normalize.cpp:178 normalize] Normalization not performed due to inconsistent reference sequences. (use -n option to relax this)
[11:47:24] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[11:47:26] Running: /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab 2>> snps.log
[11:47:30] Running: /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf 2>> snps.log
[11:47:31] Running: bcftools convert -Oz -o snps.vcf.gz snps.vcf 2>> snps.log
[11:47:31] Running: bcftools index -f snps.vcf.gz 2>> snps.log
[11:47:31] Running: bcftools consensus --sample snp_test -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz 2>> snps.log
[11:47:31] Running: bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf 2>> snps.log
[11:47:31] Running: bcftools index -f snps.subs.vcf.gz 2>> snps.log
[11:47:31] Running: bcftools consensus --sample snp_test -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz 2>> snps.log
[11:47:31] Running: rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi 2>> snps.log
[11:47:31] Running: samtools view -h -q 60 snps.bam | samtools sort -l 0 -T /localscratch/583419.1.[-] --threads 3 -m 2000M > /localscratch/583419.1.[-]/snippy.41947.Q60.bam 2>> snps.log
[11:47:34] Running: samtools index /localscratch/583419.1.[-]/snippy.41947.Q60.bam 2>> snps.log
[11:47:35] Running: /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_report --cpus 8 --bam /localscratch/583419.1.[-]/snippy.41947.Q60.bam --ref reference/ref.fa --vcf snps.vcf > snps.report.txt 2>> snps.log
[11:47:35] Running: rm -f /localscratch/583419.1.[-]/snippy.41947.Q60.bam /localscratch/583419.1.[-]/snippy.41947.Q60.bam.bai 2>> snps.log
[11:47:35] Generating reference aligned/masked FASTA relative to reference: snps.aligned.fa
[11:47:39] Marked 1552 heterozygous sites with 'n'
[11:47:39] Creating extra output files: BED GFF CSV TXT HTML
[11:47:39] Identified 0 variants.
[11:47:39] Result folder: snp_test
[11:47:39] Result files:
[11:47:39] * snp_test/snps.aligned.fa
[11:47:39] * snp_test/snps.bam
[11:47:39] * snp_test/snps.bam.bai
[11:47:39] * snp_test/snps.bed
[11:47:39] * snp_test/snps.consensus.fa
[11:47:39] * snp_test/snps.consensus.subs.fa
[11:47:39] * snp_test/snps.csv
[11:47:39] * snp_test/snps.filt.vcf
[11:47:39] * snp_test/snps.gff
[11:47:39] * snp_test/snps.html
[11:47:39] * snp_test/snps.log
[11:47:39] * snp_test/snps.raw.vcf
[11:47:39] * snp_test/snps.report.txt
[11:47:39] * snp_test/snps.subs.vcf
[11:47:39] * snp_test/snps.tab
[11:47:39] * snp_test/snps.txt
[11:47:39] * snp_test/snps.vcf
[11:47:39] * snp_test/snps.vcf.gz
[11:47:39] * snp_test/snps.vcf.gz.csi
[11:47:39] Walltime used: 1 minute, 14 seconds
[11:47:39] Have a suggestion? Tell me at https://github.com/tseemann/snippy/issues
[11:47:39] Done.

--- snp.log file:
### echo snippy 4.6.0
### cd /old_Users/[--]/downgraded_Snippy_version

### /Users/[--]/miniconda3/envs/snippy/bin/snippy --outdir snp_test -report --ref NC_007795_NCTC8325.gb --R1 [sample]-IA-M06434-210331_S30_L001_R1_001.fastq --R2 [sample]-IA-M06434-210331_S30_L001_R2_001.fastq

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.04 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.59 seconds elapse.
[bwa_index] Update BWT... 0.01 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.31 sec
[main] Version: 0.7.17-r1188
[main] CMD: bwa index reference/ref.fa
[main] Real time: 1.057 sec; CPU: 0.972 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### snpEff build -c reference/snpeff.config -dataDir . -gff3 ref

WARNING: All frames are zero! This seems rather odd, please check that 'frame' information in your 'genes' file is accurate.

### bwa mem  -Y -M -R '@RG\tID:snp_test\tSM:snp_test' -t 8 reference/ref.fa /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R1_001.fastq /old_Users/[--]/downgraded_Snippy_version/[sample]-IA-M06434-210331_S30_L001_R2_001.fastq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /localscratch/583419.1.[-] --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /localscratch/583419.1.[-] --threads 3 -m 2000M | samtools markdup -T /localscratch/583419.1.[-] --threads 3 -r -s - - > snps.bam

COMMAND: samtools markdup -T /localscratch/583419.1.[-] --threads 3 -r -s - -
READ: 876686
WRITTEN: 854971
EXCLUDED: 49845
EXAMINED: 826841
PAIRED: 805794
SINGLE: 21047
DUPLICATE PAIR: 10578
DUPLICATE SINGLE: 11137
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 21715
DUPLICATE TOTAL: 21715
ESTIMATED_LIBRARY_SIZE: 15211027


### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 191231 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf


### bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf


### snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf


### /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab

Loading reference: reference/ref.fa
Loaded 1 sequences.
Loading features: reference/ref.gff
Parsing variants: snps.vcf
Converted 0 SNPs to TAB format.

### /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf


### bcftools convert -Oz -o snps.vcf.gz snps.vcf


### bcftools index -f snps.vcf.gz


### bcftools consensus --sample snp_test -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz

Applied 0 variants

### bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf


### bcftools index -f snps.subs.vcf.gz


### bcftools consensus --sample snp_test -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz

Applied 0 variants

### rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi


### samtools view -h -q 60 snps.bam | samtools sort -l 0 -T /localscratch/583419.1.[-] --threads 3 -m 2000M > /localscratch/583419.1.[-]/snippy.41947.Q60.bam

[bam_sort_core] merging from 0 files and 3 in-memory blocks...

### samtools index /localscratch/583419.1.[-]/snippy.41947.Q60.bam


### /old_Users/[--]/miniconda3/envs/snippy/bin/snippy-vcf_report --cpus 8 --bam /localscratch/583419.1.[-]/snippy.41947.Q60.bam --ref reference/ref.fa --vcf snps.vcf > snps.report.txt

Parsing: snps.vcf
Running: parallel -j 8 -k -a /localscratch/583419.1.[-]/lPSTn1wTLR

### rm -f /localscratch/583419.1.[-]/snippy.41947.Q60.bam /localscratch/583419.1.[-]/snippy.41947.Q60.bam.bai



",ZoseJapata,https://github.com/tseemann/snippy/issues/580
I_kwDOAS4qDc59goAk,Snippy fails with genbank file,OPEN,2024-01-29T15:03:56Z,2024-07-05T17:56:07Z,,"I tried to run snippy with the following genbank file:
https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/008/632/635/GCF_008632635.1_ASM863263v1/GCF_008632635.1_ASM863263v1_genomic.gbff.gz
However, the pipeline failed for me when snpEff started.
My snpEff version is SnpEff 5.2a (build 2023-10-24 14:24)

The I command called was:
snippy --cpus 60 --outdir outdir --ref GCF_008632635.1_ASM863263v1_genomic.gbff --R1 forward.fastq.gz --R2 reverse.fastq.gz

I also tried replacing gbff with gbk, but unsuccessfully.
I'd appreciate your help",mesti90,https://github.com/tseemann/snippy/issues/581
I_kwDOAS4qDc5-mswI,"™ BrokenPipeError: [Errno 32] Broken pipe, can you please assist for this error",OPEN,2024-02-07T23:21:58Z,2024-02-12T21:56:42Z,,"
### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 637096 > reference/ref.txt


### freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf

vcfstreamsort: symbol lookup error: /home/p0129674/anaconda3/envs/my_pro/bin/../lib/libvcflib.so.1: undefined symbol: wavefront_align
vcfuniq: symbol lookup error: /home/p0129674/anaconda3/envs/my_pro/bin/../lib/libvcflib.so.1: undefined symbol: wavefront_align
Traceback (most recent call last):
  File ""/home/p0129674/anaconda3/envs/my_pro/bin/vcffirstheader"", line 17, in <module>
    print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe
",EtienneNtumba,https://github.com/tseemann/snippy/issues/582
I_kwDOAS4qDc6AD9nM,Cannot install snippy due to bcftools? ,CLOSED,2024-02-22T08:40:44Z,2024-02-23T05:35:42Z,2024-02-23T05:35:42Z,"(base) C:\Users\dxq>conda install -c conda-forge -c bioconda -c defaults snippy
Channels:
 - conda-forge
 - bioconda
 - defaults
Platform: win-64
Collecting package metadata (repodata.json): done
Solving environment: failed

LibMambaUnsatisfiableError: Encountered problems while solving:
  - nothing provides bcftools >=1.8 needed by snippy-4.4.0-0

Could not solve for environment specs
The following packages are incompatible
└─ snippy is not installable because there are no viable options
   ├─ snippy [4.4.0|4.4.1|4.4.3] would require
   │  └─ bcftools >=1.8 , which does not exist (perhaps a missing channel);
   ├─ snippy [4.4.3|4.4.5] would require
   │  └─ bcftools >=1.9 , which does not exist (perhaps a missing channel);
   ├─ snippy 4.4.5 would require
   │  └─ bcftools >=1.9,<1.10 , which does not exist (perhaps a missing channel);
   └─ snippy [4.5.0|4.5.1|4.6.0] would require
      └─ bcftools >=1.10 , which does not exist (perhaps a missing channel).",Xiongqi1114,https://github.com/tseemann/snippy/issues/583
I_kwDOAS4qDc6A7vk0,vcfstreamsort: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory vcfuniq: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory,OPEN,2024-03-01T10:54:47Z,2024-04-12T05:26:09Z,,"Hello,I encountered the following problems when using snippy. Has anyone encountered similar problems? snippy is installed with conda.

vcfstreamsort: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
vcfuniq: error while loading shared libraries: libtabixpp.so.0: cannot open shared object file: No such file or directory
Traceback (most recent call last):
File ""/home/y17319172851/miniconda3/envs/snippy/bin/vcffirstheader"", line 10, in
print(line.strip())
BrokenPipeError: [Errno 32] Broken pipe",shangguan77,https://github.com/tseemann/snippy/issues/584
I_kwDOAS4qDc6BraNx,freebayes-parallel Error,OPEN,2024-03-08T09:31:59Z,2024-05-31T14:01:33Z,,"[snps.log](https://github.com/tseemann/snippy/files/14536244/snps.log)
I met a problem when run snippy. I think it may relate to freebayes, but I don't know how to fix. 

ps：snippy --check show ""Dependences look good!""",xxxxxxsf,https://github.com/tseemann/snippy/issues/585
I_kwDOAS4qDc6D68bs,bcftool error,OPEN,2024-03-28T13:36:52Z,2024-05-31T13:57:54Z,,"I had the error with libtabixpp0, when I fixed this I seemed to loose bcftools. I have forced reinstall (bcftools and snippy) multiple times including downgrading but I keep coming back saying this error:

Need bcftools --version >= 1.7 but you have 0 - please upgrade it.

Any suggestions as to how to do this?

Thanks!",SaraRHenderson,https://github.com/tseemann/snippy/issues/586
I_kwDOAS4qDc6F0hHJ,Unable to calculate estimated library size: samtools markdup,OPEN,2024-04-16T05:42:30Z,2024-04-16T06:26:38Z,,"This is my command:
snippy --outdir snps_output_rep4 --ref GCA_018093105.1_ASM1809310v1_genomic.fna  --ctgs S.aureus_bat3_r3..contigs.fasta

I am getting error while running samtools markdup
I am using contigs and ref genome in fasta format. PLease help me.  

########################################
### echo snippy 4.6.0
### cd /home/ccmb/LV_data/batch5/barcode15/phylogeny/S.aureus/ST_new/ST_new

### /home/ccmb/miniconda3/envs/snippy/bin/snippy --outdir snps_output_repfas --ref GCA_018093105.1_ASM1809310v1_genomic.fna --ctgs S.aureus_bat3_r3..contigs.fasta

### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.02 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.43 seconds elapse.
[bwa_index] Update BWT... 0.01 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.19 sec
[main] Version: 0.7.18-r1243-dirty
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.746 sec; CPU: 0.653 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:snps_output_repfas\tSM:snps_output_repfas' -t 8 reference/ref.fa fake_reads.fq | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam

samtools markdup: warning, unable to calculate estimated library size. Read pairs 0 should be greater than duplicate pairs 0, which should both be non zero.

COMMAND: samtools markdup -T /tmp --threads 3 -r -s - -
READ: 427117
WRITTEN: 416369
EXCLUDED: 103931
EXAMINED: 323186
PAIRED: 0
SINGLE: 323186
DUPLICATE PAIR: 0
DUPLICATE SINGLE: 10748
DUPLICATE PAIR OPTICAL: 0
DUPLICATE SINGLE OPTICAL: 0
DUPLICATE NON PRIMARY: 0
DUPLICATE NON PRIMARY OPTICAL: 0
DUPLICATE PRIMARY TOTAL: 10748
DUPLICATE TOTAL: 10748
ESTIMATED_LIBRARY_SIZE: 0


### samtools index snps.bam


### fasta_generate_regions.py reference/ref.fa.fai 186841 > reference/ref.txt


### freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf
",Shyamili09,https://github.com/tseemann/snippy/issues/587
I_kwDOAS4qDc6IOnXg,Snippy can't read my assembly.fasta files,OPEN,2024-05-08T12:55:12Z,2024-05-08T12:55:12Z,,"Hi, I'm using a script to run Snippy in several assembly.fasta files at the same time so I can proceed to have a core SNP alignment.
However, I am obtaining the following error:
![Screenshot 2024-05-08 at 13 02 23](https://github.com/tseemann/snippy/assets/169266338/c71f0522-a152-43c1-b97e-83d68c04db02)

I believe this is because in each assembly the contigs are separated by a ""|"". 
Is there an easy way around this issue?
Thanks!
",dianaespadinha,https://github.com/tseemann/snippy/issues/588
I_kwDOAS4qDc6JDqZk,Request to troubleshoot bcftools error encountered while installing snippy in macOS Sonoma 14.4.1,OPEN,2024-05-16T06:11:18Z,2024-05-31T13:54:06Z,,"Code used:
conda config --add channels bioconda
conda config --add channels conda-forge
conda create --name snippy snippy

Results:
Channels:
 - conda-forge
 - bioconda
 - defaults
Platform: osx-arm64
Collecting package metadata (repodata.json): done
Solving environment: failed

LibMambaUnsatisfiableError: Encountered problems while solving:
  - nothing provides bcftools >=1.8 needed by snippy-4.4.0-0

Could not solve for environment specs
The following packages are incompatible
└─ snippy is not installable because there are no viable options
   ├─ snippy [4.4.0|4.4.1|4.4.3] would require
   │  └─ bcftools >=1.8 , which does not exist (perhaps a missing channel);
   ├─ snippy [4.4.3|4.4.5] would require
   │  └─ bcftools >=1.9 , which does not exist (perhaps a missing channel);
   ├─ snippy 4.4.5 would require
   │  └─ bcftools >=1.9,<1.10 , which does not exist (perhaps a missing channel);
   └─ snippy [4.5.0|4.5.1|4.6.0] would require
      └─ bcftools >=1.10 , which does not exist (perhaps a missing channel).",Jeewan-Thapa,https://github.com/tseemann/snippy/issues/589
I_kwDOAS4qDc6Ll8wg,why snippy generated variations less than  snp-sites generated from core gene alignment? ,OPEN,2024-06-09T02:22:18Z,2024-06-09T02:22:18Z,,"Hi, 

I have some bacterial NGS reads as well as assemblies. I used two methods to call variations:

1. `mapping-based`: I use clean reads with `snippy` and `reference` genome to call `variation`, and `bcftools merge` to combined the variations from multiple samples.
2. `assembly-based`: I assemblied the sample using `shovill`, annotated them using `prokka`,  got pan-genome results using `Panaroo`, generated a recombination-free core-genes alignment using `ClonalFrameML`. Then I get the core genome `variations` using `snp-sites` by `snp-sites -v -o ours_core_variations.vcf ../PGout_panaroo/core_gene_alignment_filtered.aln`

Here is the statistics for two vcfs:
```
# for merged VCF from individually calling by snippy
1. $ bcftools merge -l Ours_vcf_files.txt -o ../Ours_vcf_merged.vcf.gz -O z       &&     bcftools stats ../Ours_vcf_merged.vcf.gz | grep SN
# SN, Summary numbers:
#   number of SNPs      .. number of rows with a SNP
#   number of multiallelic SNP sites .. number of rows with multiple alternate alleles, all SNPs
#   counter. For example, a row with a SNP and an indel increments both the SNP and
# SN	[2]id	[3]key	[4]value
SN	0	number of samples:	196
SN	0	number of records:	2292
SN	0	number of no-ALTs:	0
SN	0	number of SNPs:	2053
SN	0	number of MNPs:	47
SN	0	number of indels:	180
SN	0	number of others:	13
SN	0	number of multiallelic sites:	13
SN	0	number of multiallelic SNP sites:	1

#for snp-sites results
2. $ snp-sites -v -o ours_core_variations.vcf ../PGout_panaroo/core_gene_alignment_filtered.aln      &&     bcftools stats ours_core_variations.vcf | grep SN
# SN, Summary numbers:
#   number of SNPs      .. number of rows with a SNP
#   number of multiallelic SNP sites .. number of rows with multiple alternate alleles, all SNPs
#   counter. For example, a row with a SNP and an indel increments both the SNP and
# SN	[2]id	[3]key	[4]value
SN	0	number of samples:	196
SN	0	number of records:	5907
SN	0	number of no-ALTs:	0
SN	0	number of SNPs:	5907
SN	0	number of MNPs:	0
SN	0	number of indels:	0
SN	0	number of others:	0
SN	0	number of multiallelic sites:	3408
SN	0	number of multiallelic SNP sites:	34
```

There is a huge difference between the total  `variations` (`2292` vs. `5907`) as well as `SNP`(`2053` vs. `5907`). Is there anything I did wrong? Could you please help me figure it out? 

btw, If I want to perform bacterial GWAS for the SNP/indel vaiations with a binary phenotype, which method will be appropriate? Thanks.",Zjianglin,https://github.com/tseemann/snippy/issues/590
I_kwDOAS4qDc6OWpuC,snippy-multi  ERROR: Can't open --ref BZ100/ref.fa,OPEN,2024-07-03T10:46:02Z,2024-09-19T02:59:15Z,,"Hi,
I have a question for you about snippy-multi:
I tried to run snippy-multi.
I first generated a label file (input.tab) as follows:
BZ93 /home/disk/project/G20240703/genome_analysis/geome/BZ93.fsa
BZ_48_8 /home/disk/project/G20240703/genome_analysis/geome/BZ_48_8.fsa
BZ107 /home/disk/project/G20240703/genome_analysis/geome/BZ107.fsa
BZ85 /home/disk/project/G20240703/genome_analysis/geome/BZ85.fsa
BZ77 /home/disk/project/G20240703/genome_analysis/geome/BZ77.fsa
BZ67 /home/disk/project/G20240703/genome_analysis/geome/BZ67.fsa
BZ79 /home/disk/project/G20240703/genome_analysis/geome/BZ79.fsa
BZ98 /home/disk/project/G20240703/genome_analysis/geome/BZ98.fsa

When I run the following command, I get the following error:
snippy-multi input.tab --ref sequence.fasta --cpus 16 --outdir mysnippy > multi.sh
sh multi.sh
ERROR: Can't open --ref BZ100/ref.fa

I tried to find the answer in the github issue, and the #463 issue is exactly the same as my current situation. But he solved the problem by replacing the GBK file with a fasta file, but my reference genome is a fasta file.
Why does ""ERROR: Can't open --ref BZ100/ref.fa"" still appear now?",makerer5,https://github.com/tseemann/snippy/issues/591
I_kwDOAS4qDc6PfiiP,Need bcftools --version >= 1.7 but you have 0 - please upgrade it,OPEN,2024-07-14T12:19:02Z,2024-07-17T11:22:38Z,,,NoamanJane,https://github.com/tseemann/snippy/issues/592
I_kwDOAS4qDc6ScU8a,homebrew snippy installation finding incorrect perl binaries,OPEN,2024-08-09T00:54:29Z,2024-08-09T00:54:29Z,,"Hi,

Recently had trouble installing snippy via homebrew on macOS Sonoma 14.5:

brew install snippy

Snippy errored with:

Clone.c: loadable library and perl binaries are mismatched (got handshake key 0x10200080, needed 0xfb80080)

The #! line in snippy was:

#!/usr/bin/perl34

Changing this to:

#!/usr/bin/env perl

so that the user's homebrew install perl was being used instead of the system perl fixes the problem.

Maybe this could be changed in the codebase, it seems like it must be a problem generally, although quite possible I've missed something, in which case apologies.",paulsenlab,https://github.com/tseemann/snippy/issues/594
I_kwDOAS4qDc6SnEbW,Snippy not identifying rRNA SNPs (presumably due to conserved region?),OPEN,2024-08-11T18:46:26Z,2024-08-11T18:46:26Z,,"Hello,

We are not identifying known SNPs near the 3' end of rRNA in Flavobacterium johnsoniae - we confirmed that the SNPs were present in every sample/relevant read by examining mapped reads. We assume that snippy doesn't identify SNPs here because the reads will be multimapped to all 16S rRNA copies in the genome - is there a flag or approach that allows multimapped reads to be carried through in SNP analysis? 

Thank you for your efforts and tool!",BGemler,https://github.com/tseemann/snippy/issues/595
I_kwDOAS4qDc6TB7uj,Low variant counts due to poor mapping or low coverage (?),CLOSED,2024-08-14T20:19:26Z,2024-08-15T15:00:44Z,2024-08-15T14:39:07Z,"Dear Tseemann,

I'm truly grateful for all the useful tools you have created and made publicly available. I've been using `snippy` a lot in my work but recently ran into a strange issue that I can't figure out. I don't know if it is a `snippy` specific issue but I'm out of ideas and would love some external input. Sorry in advance for such a long post!

I'm working with a metagenomic sample: I assembled using `metaspades`, performed binning and consolidating with the regular algorithms (`maxbin2`, `metabat2`, `concoct` and `das_tool`). I then used the resultant `contigs.fasta` files as inputs for snippy in various configurations (against an external reference and against other samples etc). Just out of curiosity, I wondered how the SNP results would differ if I used reads instead of contigs. 

To do so, I selected one draft assembly: `Ecoli_01.fa` (an E.coli bin with ~86% completeness). I indexed the assembly using `samtools faidx`, then ran `samtools view` on the original .bam file (derived from mapping reads to the initial `scaffolds.fasta` file produced by `metaspades` as part of the binning process) using the fasta index file as the reference to filter out only reads that mapped to my contigs of interest. After obtaining the filtered .bam file, I sorted it and extracted FASTQ files using `samtools fastq`. I'm telling you all this to give you a sense of my processing steps, happy to provide the actual lines of code if that seems useful.

So now, I have paired end reads (`Ecoli_R1.fastq.gz` and `Ecoli_R2.fastq.gz`) and a draft assembly (`Ecoli_01.fa`). I ran snippy using the draft assembly as a reference and the paired end reads as queries, and got a total variant count of 3. Makes sense, I thought since the reads make up the assembly. I then used a different Ecoli assembly from another sample (`Ecoli_02.fa`, completeness of 99.97%) as my reference and the same reads as queries, and things started getting weird. I had previously ran snippy using `Ecoli_02.fa` as reference and `Ecoli_01.fa` as my query - this yielded a total variant count of 2331. But when I ran the same command but now using `Ecoli_R1.fastq.gz` and `Ecoli_R2.fastq.gz`, I got a total variant count of 20. That's not right.

I looked in the `snps.log` file and saw that 99% of my reads were being excluded by the `samtools markdup` step. So I read the `samtools markdup` manual and saw that reads are excluded if they are marked as secondary, supplementary or unmapped. Okay, seems unlikely that 99% of my reads don't map to the assembly. I checked the `snps.log` file of the contigs run and saw that only 6.7% of ""reads"" were excluded in that round. Then I checked the `snps.log` file of the first run where I compared `Ecoli_01.fa` to the reads `Ecoli_R1.fastq.gz` and `Ecoli_R2.fastq.gz`, and saw that even then, 99% of reads were being excluded! So that explains the low variant count of 3 that I obtained!

Alright now the mystery. I ran bbmap's `pileup.sh` script on the filtered .bam file from earlier and it said 100% mapped and average coverage is 51.1. It seems like my reads are mapping to the contigs with somewhat decent coverage, so why are such a high percentage of reads being excluded? Could there be certain settings that are affecting how the reads are (not) being mapped to the contigs?

Thank you for reading this very long message, I appreciate your time and any input you might have. Best wishes!

Edit: I'm attaching some log files here for your reference. Note that the file names are a little different within the log files as I edited them for brevity in this post.
1. [snps.log](https://github.com/user-attachments/files/16618556/snps.log) is the output from running snippy on `Ecoli_01.fa` as reference and it's associated reads `Ecoli_R1.fastq.gz` and `Ecoli_R2.fastq.gz` as queries
2. [contigs_snps.log](https://github.com/user-attachments/files/16618545/contigs_snps.log) is the output from running snippy on `Ecoli_02.fa` as reference and `Ecoli_01.fa` as query using --ctgs
3. [reads_snps.log](https://github.com/user-attachments/files/16618546/reads_snps.log) is the output from running snippy on `Ecoli_02.fa` as reference and `Ecoli_R1.fastq.gz` and `Ecoli_R2.fastq.gz` as queries
",priscalim00,https://github.com/tseemann/snippy/issues/596
I_kwDOAS4qDc6UY_c9,No variants found,OPEN,2024-08-27T14:38:12Z,2024-11-25T16:47:11Z,,"i want to call snps using the --configs option. The software running well but didn't find any snps. The csv and tab file were aslo empty. 
![image](https://github.com/user-attachments/assets/0b975beb-0838-4484-bc4f-4d4cbc4eb7bd)
[snps.log](https://github.com/user-attachments/files/16763799/snps.log)
",BlackMonolith,https://github.com/tseemann/snippy/issues/597
I_kwDOAS4qDc6XFBJZ,"samtools markdup: error, no ms score tag",OPEN,2024-09-18T20:35:08Z,2024-11-08T13:30:14Z,,"Hello! 
I'm trying to run this:

`snippy --outdir GPSC33 --R1 ERR3261191_1.fastq.gz --R2 ERR3261191_2.fastq.gz --ref Reference_sequence_GPSC33.fa`

but I got this error: 

`### samtools faidx reference/ref.fa


### bwa index reference/ref.fa

[bwa_index] Pack FASTA... 0.01 sec
[bwa_index] Construct BWT for the packed sequence...
[bwa_index] 0.31 seconds elapse.
[bwa_index] Update BWT... 0.01 sec
[bwa_index] Pack forward-only FASTA... 0.01 sec
[bwa_index] Construct SA from BWT and Occ... 0.16 sec
[main] Version: 0.7.18-r1243-dirty
[main] CMD: bwa index reference/ref.fa
[main] Real time: 0.569 sec; CPU: 0.501 sec

### mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa


### ln -sf reference/ref.fa .


### ln -sf reference/ref.fa.fai .


### mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz


### bwa mem  -Y -M -R '@RG\tID:GPSC33_folder\tSM:GPSC33_folder' -t 4 reference/ref.fa /hpcfs/home/ciencias_biologicas/lf.sacristan2215/CABANA/vigilancia/Module_12/ERR2667737_1.fastq.gz /hpcfs/home/ciencias_biologicas/lf.sacristan2215/CABANA/vigilancia/Module_12/ERR2667737_2.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 1 -m 8000M | samtools fixmate -m --threads 1 - - | samtools sort -l 0 -T /tmp --threads 1 -m 8000M | samtools markdup -T /tmp --threads 1 -r -s - - > snps.bam

samtools markdup: error, no ms score tag. Please run samtools fixmate on file first.

samtools markdup: error, no ms score tag. Please run samtools fixmate on file first.
`

I've tried it several times with different files but the error is the same. 

",lusacristan,https://github.com/tseemann/snippy/issues/598
I_kwDOAS4qDc6c_71G,Raw VCF,OPEN,2024-11-04T22:39:55Z,2024-11-04T22:39:55Z,,"I am interested in low frequency/mixed read SNP calls. My understanding is that final VCF only reports fixed SNPs, so I am interested in analyzing the calls from the .raw.vcf file. This VCF has not undergone Freebayes filtering, so I am wondering what processing has been completed to generate the .raw.vcf file so I know what QC should be performed before proceeding. ",sydelstan,https://github.com/tseemann/snippy/issues/599
I_kwDOAS4qDc6dGOHx,Error Installing with linuxbrew,OPEN,2024-11-05T14:39:53Z,2024-11-05T14:39:53Z,,"Hi,
Having this issue when installing with linuxbrew: Error: openssl@1.1 has been disabled because it is not supported upstream! It was disabled on 2024-10-24.

Thanks for the tool!!",joaomatos02,https://github.com/tseemann/snippy/issues/600
I_kwDOAS4qDc6dWkx5,long read sequencing error,CLOSED,2024-11-07T05:37:21Z,2024-11-08T01:11:15Z,2024-11-08T01:11:15Z,"Hi, I'm trying to analyze a sample that has been pacbio sequenced with snippy. However, since it's a long read sample, I put the input as a bam file instead of R1 R2 and I'm getting the following error.

`a@DESKTOP-G3IK25V:/mnt/c/Users/user/Downloads/GAS/FastQ$ snippy --cpus 4 --outdir snp --force ON --prefix 15 --ref GCF_900475035.1_41965_F01_genomic.fna --bam GAS15.hifi_reads.bam`

`[14:19:21] Running: cp 15.filt.vcf 15.vcf 2>> 15.log
[14:19:21] Running: /home/a/miniconda3/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf 15.vcf > 15.tab 2>> 15.log
[14:19:21] Running: /home/a/miniconda3/bin/snippy-vcf_extract_subs 15.filt.vcf > 15.subs.vcf 2>> 15.log
[14:19:21] Running: bcftools convert -Oz -o 15.vcf.gz 15.vcf 2>> 15.log
[14:19:21] Running: bcftools index -f 15.vcf.gz 2>> 15.log
[14:19:21] Running: bcftools consensus --sample snp -f reference/ref.fa -o 15.consensus.fa 15.vcf.gz 2>> 15.log
[14:19:21] Error running command, check snp/15.log`

I checked the log.
### freebayes-parallel reference/ref.txt 4 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa 15.bam > 15.raw.vcf

Error: Failed to set region: -1:0-253,653(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:0..253653
Error: Failed to set region: -1:253,653-507,306(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:253653..507306
Error: Failed to set region: -1:507,306-760,959(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:507306..760959
Error: Failed to set region: -1:760,959-1,014,612(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:760959..1014612
Error: Failed to set region: -1:1,014,612-1,268,265(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:1014612..1268265
Error: Failed to set region: -1:1,268,265-1,521,918(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:1268265..1521918
Error: Failed to set region: -1:1,521,918-1,746,380(*)
ERROR(freebayes): Could not SetRegion to NZ_LS483338.1:1521918..1746380

I used the same reference for analyzing other short read sequencing files, so I don't think it's a reference issue.
What do I need to do to fix this?",been9312,https://github.com/tseemann/snippy/issues/601
I_kwDOAS4qDc6fTYQz,Snippy tool successfully run but no variants identified which expected to be found,OPEN,2024-11-19T15:46:20Z,2024-11-19T15:46:20Z,,"Here is my terminal log:
(myenv) hp@imran:~$ cd /home/hp/Desktop/Snippy
(myenv) hp@imran:~/Desktop/Snippy$ snippy --cpus 8 --outdir kill --ref free.gbk --R1 76_S76_R1_001.fastq.gz --R2 76_S76_R2_001.fastq.gz
[21:32:10] This is snippy 4.6.0
[21:32:10] Written by Torsten Seemann
[21:32:10] Obtained from https://github.com/tseemann/snippy
[21:32:10] Detected operating system: linux
[21:32:10] Enabling bundled linux tools.
[21:32:10] Found bwa - /home/hp/anaconda3/envs/myenv/bin/bwa
[21:32:10] Found bcftools - /home/hp/anaconda3/envs/myenv/bin/bcftools
[21:32:10] Found samtools - /home/hp/anaconda3/envs/myenv/bin/samtools
[21:32:10] Found java - /home/hp/anaconda3/envs/myenv/bin/java
[21:32:10] Found snpEff - /home/hp/anaconda3/envs/myenv/bin/snpEff
[21:32:10] Found samclip - /home/hp/anaconda3/envs/myenv/bin/samclip
[21:32:10] Found seqtk - /home/hp/anaconda3/envs/myenv/bin/seqtk
[21:32:10] Found parallel - /home/hp/anaconda3/envs/myenv/bin/parallel
[21:32:10] Found freebayes - /home/hp/anaconda3/envs/myenv/bin/freebayes
[21:32:10] Found freebayes-parallel - /home/hp/anaconda3/envs/myenv/bin/freebayes-parallel
[21:32:10] Found fasta_generate_regions.py - /home/hp/anaconda3/envs/myenv/bin/fasta_generate_regions.py
[21:32:10] Found vcfstreamsort - /home/hp/anaconda3/envs/myenv/bin/vcfstreamsort
[21:32:10] Found vcfuniq - /home/hp/anaconda3/envs/myenv/bin/vcfuniq
[21:32:10] Found vcffirstheader - /home/hp/anaconda3/envs/myenv/bin/vcffirstheader
[21:32:10] Found gzip - /usr/bin/gzip
[21:32:10] Found vt - /home/hp/anaconda3/envs/myenv/bin/vt
[21:32:10] Found snippy-vcf_to_tab - /home/hp/anaconda3/envs/myenv/bin/snippy-vcf_to_tab
[21:32:10] Found snippy-vcf_report - /home/hp/anaconda3/envs/myenv/bin/snippy-vcf_report
[21:32:10] Checking version: samtools --version is >= 1.7 - ok, have 1.20
[21:32:10] Checking version: bcftools --version is >= 1.7 - ok, have 1.21
[21:32:10] Checking version: freebayes --version is >= 1.1 - ok, have 1.3.6
[21:32:10] Checking version: snpEff -version is >= 4.3 - ok, have 5.0
[21:32:10] Checking version: bwa is >= 0.7.12 - ok, have 0.7.18
[21:32:10] Using reference: /home/hp/Desktop/Snippy/free.gbk
[21:32:10] Treating reference as 'genbank' format.
[21:32:10] Will use 8 CPU cores.
[21:32:10] Using read file: /home/hp/Desktop/Snippy/76_S76_R1_001.fastq.gz
[21:32:10] Using read file: /home/hp/Desktop/Snippy/76_S76_R2_001.fastq.gz
[21:32:10] Creating folder: kill
[21:32:10] Changing working directory: kill
[21:32:10] Creating reference folder: reference
[21:32:10] Extracting FASTA and GFF from reference.
[21:32:11] Wrote 2 sequences to ref.fa
[21:32:11] Wrote 4738 features to ref.gff
[21:32:11] Creating reference/snpeff.config
[21:32:11] Freebayes will process 15 chunks of 350130 bp, 8 chunks at a time.
[21:32:11] Using BAM RG (Read Group) ID: kill
[21:32:11] Running: samtools faidx reference/ref.fa 2>> snps.log
[21:32:11] Running: bwa index reference/ref.fa 2>> snps.log
[21:32:13] Running: mkdir -p reference/genomes && cp -f reference/ref.fa reference/genomes/ref.fa 2>> snps.log
[21:32:13] Running: ln -sf reference/ref.fa . 2>> snps.log
[21:32:13] Running: ln -sf reference/ref.fa.fai . 2>> snps.log
[21:32:13] Running: mkdir -p reference/ref && gzip -c reference/ref.gff > reference/ref/genes.gff.gz 2>> snps.log
[21:32:13] Running: snpEff build -c reference/snpeff.config -dataDir . -gff3 ref 2>> snps.log
[21:32:18] Running: bwa mem  -Y -M -R '@RG\tID:kill\tSM:kill' -t 8 reference/ref.fa /home/hp/Desktop/Snippy/76_S76_R1_001.fastq.gz /home/hp/Desktop/Snippy/76_S76_R2_001.fastq.gz | samclip --max 10 --ref reference/ref.fa.fai | samtools sort -n -l 0 -T /tmp --threads 3 -m 2000M | samtools fixmate -m --threads 3 - - | samtools sort -l 0 -T /tmp --threads 3 -m 2000M | samtools markdup -T /tmp --threads 3 -r -s - - > snps.bam 2>> snps.log
[M::bwa_idx_load_from_disk] read 0 ALT contigs
[samclip] samclip 0.4.0 by Torsten Seemann (@torstenseemann)
[samclip] Loading: reference/ref.fa.fai
[samclip] Found 2 sequences in reference/ref.fa.fai
[M::process] read 556792 sequences (80000187 bp)...
[M::process] read 556588 sequences (80000094 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (2, 249595, 38, 2)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (200, 280, 368)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 704)
[M::mem_pestat] mean and std.dev: (288.83, 130.50)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 872)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (240, 1449, 3692)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 10596)
[M::mem_pestat] mean and std.dev: (1896.63, 1652.53)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 14048)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 556792 reads in 86.218 CPU sec, 10.876 real sec
[samclip] Processed 100000 records...
[samclip] Processed 200000 records...
[samclip] Processed 300000 records...
[samclip] Processed 400000 records...
[samclip] Processed 500000 records...
[M::process] read 556932 sequences (80000027 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (5, 249657, 37, 5)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (200, 280, 369)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 707)
[M::mem_pestat] mean and std.dev: (288.91, 130.63)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 876)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (693, 2139, 3596)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 9402)
[M::mem_pestat] mean and std.dev: (2244.54, 1900.18)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 12305)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 556588 reads in 96.613 CPU sec, 12.732 real sec
[samclip] Processed 600000 records...
[samclip] Processed 700000 records...
[samclip] Processed 800000 records...
[samclip] Processed 900000 records...
[samclip] Processed 1000000 records...
[samclip] Processed 1100000 records...
[M::process] read 559580 sequences (80000154 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (5, 249406, 45, 6)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (199, 278, 367)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 703)
[M::mem_pestat] mean and std.dev: (287.82, 130.46)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 871)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (353, 1200, 3772)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 10610)
[M::mem_pestat] mean and std.dev: (2422.64, 2763.86)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 14029)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 556932 reads in 98.350 CPU sec, 13.000 real sec
[samclip] Processed 1200000 records...
[samclip] Processed 1300000 records...
[samclip] Processed 1400000 records...
[samclip] Processed 1500000 records...
[samclip] Processed 1600000 records...
[M::process] read 559578 sequences (80000168 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (0, 250720, 40, 4)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (194, 272, 357)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 683)
[M::mem_pestat] mean and std.dev: (279.40, 126.16)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 846)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (309, 1027, 3162)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 8868)
[M::mem_pestat] mean and std.dev: (1704.60, 1577.68)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 11721)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 559580 reads in 96.621 CPU sec, 12.767 real sec
[samclip] Processed 1700000 records...
[samclip] Processed 1800000 records...
[samclip] Processed 1900000 records...
[samclip] Processed 2000000 records...
[samclip] Processed 2100000 records...
[samclip] Processed 2200000 records...
[M::process] read 410586 sequences (58696297 bp)...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (5, 251187, 51, 4)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (193, 273, 358)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 688)
[M::mem_pestat] mean and std.dev: (280.27, 126.97)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 853)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (1044, 2564, 3928)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 9696)
[M::mem_pestat] mean and std.dev: (2506.67, 1754.01)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 12580)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 559578 reads in 97.271 CPU sec, 13.004 real sec
[samclip] Processed 2300000 records...
[samclip] Processed 2400000 records...
[samclip] Processed 2500000 records...
[samclip] Processed 2600000 records...
[samclip] Processed 2700000 records...
[M::mem_pestat] # candidate unique pairs for (FF, FR, RF, RR): (2, 183985, 28, 0)
[M::mem_pestat] skip orientation FF as there are not enough pairs
[M::mem_pestat] analyzing insert size distribution for orientation FR...
[M::mem_pestat] (25, 50, 75) percentile: (193, 272, 357)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 685)
[M::mem_pestat] mean and std.dev: (279.56, 126.44)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 849)
[M::mem_pestat] analyzing insert size distribution for orientation RF...
[M::mem_pestat] (25, 50, 75) percentile: (248, 2948, 6154)
[M::mem_pestat] low and high boundaries for computing mean and std.dev: (1, 17966)
[M::mem_pestat] mean and std.dev: (3266.71, 2977.52)
[M::mem_pestat] low and high boundaries for proper pairs: (1, 23872)
[M::mem_pestat] skip orientation RR as there are not enough pairs
[M::mem_pestat] skip orientation RF
[M::mem_process_seqs] Processed 410586 reads in 74.558 CPU sec, 10.055 real sec
[samclip] Processed 2800000 records...
[samclip] Processed 2900000 records...
[samclip] Processed 3000000 records...
[samclip] Processed 3100000 records...
[samclip] Processed 3200000 records...
[main] Version: 0.7.18-r1243-dirty
[main] CMD: bwa mem -Y -M -R @RG\tID:kill\tSM:kill -t 8 reference/ref.fa /home/hp/Desktop/Snippy/76_S76_R1_001.fastq.gz /home/hp/Desktop/Snippy/76_S76_R2_001.fastq.gz
[main] Real time: 74.729 sec; CPU: 550.926 sec
[samclip] Total SAM records 3202790, removed 68965, allowed 45067, passed 3133825
[samclip] Header contained 5 lines
[samclip] Done.
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[bam_sort_core] merging from 0 files and 3 in-memory blocks...
[21:33:53] Running: samtools index snps.bam 2>> snps.log
[21:33:54] Running: fasta_generate_regions.py reference/ref.fa.fai 350130 > reference/ref.txt 2>> snps.log
[21:33:54] Running: freebayes-parallel reference/ref.txt 8 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf   -f reference/ref.fa snps.bam > snps.raw.vcf 2>> snps.log
[21:34:39] Running: bcftools view --include 'FMT/GT=""1/1"" && QUAL>=100 && FMT/DP>=10 && (FMT/AO)/(FMT/DP)>=0' snps.raw.vcf  | vt normalize -r reference/ref.fa - | bcftools annotate --remove '^INFO/TYPE,^INFO/DP,^INFO/RO,^INFO/AO,^INFO/AB,^FORMAT/GT,^FORMAT/DP,^FORMAT/RO,^FORMAT/AO,^FORMAT/QR,^FORMAT/QA,^FORMAT/GL' > snps.filt.vcf 2>> snps.log
normalize v0.5

options:     input VCF file                                  -
         [o] output VCF file                                 -
         [w] sorting window size                             10000
         [n] no fail on reference inconsistency for non SNPs false
         [q] quiet                                           false
         [d] debug                                           false
         [r] reference FASTA file                            reference/ref.fa

[variant_manip.cpp:67 is_ref_consistent] failure to extract base from fasta file: NC_004603.1:558-562
FAQ: http://genome.sph.umich.edu/wiki/Vt#1._vt_cannot_retrieve_sequences_from_my_reference_sequence_file
[21:34:39] Running: snpEff ann -noLog -noStats -no-downstream -no-upstream -no-utr -c reference/snpeff.config -dataDir . ref snps.filt.vcf > snps.vcf 2>> snps.log
[21:34:40] Running: /home/hp/anaconda3/envs/myenv/bin/snippy-vcf_to_tab --gff reference/ref.gff --ref reference/ref.fa --vcf snps.vcf > snps.tab 2>> snps.log
[21:34:42] Running: /home/hp/anaconda3/envs/myenv/bin/snippy-vcf_extract_subs snps.filt.vcf > snps.subs.vcf 2>> snps.log
[21:34:42] Running: bcftools convert -Oz -o snps.vcf.gz snps.vcf 2>> snps.log
[21:34:42] Running: bcftools index -f snps.vcf.gz 2>> snps.log
[21:34:42] Running: bcftools consensus --sample kill -f reference/ref.fa -o snps.consensus.fa snps.vcf.gz 2>> snps.log
[21:34:42] Running: bcftools convert -Oz -o snps.subs.vcf.gz snps.subs.vcf 2>> snps.log
[21:34:42] Running: bcftools index -f snps.subs.vcf.gz 2>> snps.log
[21:34:42] Running: bcftools consensus --sample kill -f reference/ref.fa -o snps.consensus.subs.fa snps.subs.vcf.gz 2>> snps.log
[21:34:42] Running: rm -f snps.subs.vcf.gz snps.subs.vcf.gz.csi snps.subs.vcf.gz.tbi 2>> snps.log
[21:34:42] Generating reference aligned/masked FASTA relative to reference: snps.aligned.fa
[21:34:47] Marked 1690 heterozygous sites with 'n'
[21:34:47] Creating extra output files: BED GFF CSV TXT HTML
[21:34:47] Identified 0 variants.
[21:34:47] Result folder: kill
[21:34:47] Result files:
[21:34:47] * kill/snps.aligned.fa
[21:34:47] * kill/snps.bam
[21:34:47] * kill/snps.bam.bai
[21:34:47] * kill/snps.bed
[21:34:47] * kill/snps.consensus.fa
[21:34:47] * kill/snps.consensus.subs.fa
[21:34:47] * kill/snps.csv
[21:34:47] * kill/snps.filt.vcf
[21:34:47] * kill/snps.gff
[21:34:47] * kill/snps.html
[21:34:47] * kill/snps.log
[21:34:47] * kill/snps.raw.vcf
[21:34:47] * kill/snps.subs.vcf
[21:34:47] * kill/snps.tab
[21:34:47] * kill/snps.txt
[21:34:47] * kill/snps.vcf
[21:34:47] * kill/snps.vcf.gz
[21:34:47] * kill/snps.vcf.gz.csi
[21:34:47] Walltime used: 2 minutes, 37 seconds
[21:34:47] May the SNPs be with yo",imran-24-du,https://github.com/tseemann/snippy/issues/602
I_kwDOAS4qDc6gnc-G,"freebayes option ""--region"" in present in vcf file but not in log file freebayes command",OPEN,2024-11-26T13:34:05Z,2024-11-26T13:34:42Z,,"Hi,

I am seeing different options for the freebayes command in the log file and the vcf

In the log file, I can see the following.

`freebayes-parallel reference/ref.txt 15 -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict
-vcf   -f reference/ref.fa SRR6346204.bam > SRR6346204.raw.vcf`

But in the VCF file this command can be seen

`##commandline=""freebayes -p 2 -P 0 -C 2 -F 0.05 --min-coverage 10 --min-repeat-entropy 1.0 -q 13 -m 60 --strict-vcf -f reference/ref.fa SRR6346204.bam --region CP085200:0-197289""`

I'm just wondering what this refers to since I did not specify any regions.
Although the ""--region CP085200:0-197289"" is present in the VCF, I can see calls from positions larger than 197289.

So, I am a bit confused about what it refers to.

Snippy version is 4.6.0


",sachiwije,https://github.com/tseemann/snippy/issues/603
I_kwDOAS4qDc6jVLSo,No variants found when expected - No warnings ,OPEN,2024-12-15T02:27:48Z,2024-12-15T02:27:48Z,,"I have run Snippy v4.6.0 for many isolates and got the same output as 0 variants. I dont see where the mistake is because I did not get any warnings as well. Kindly help me out on this. Here I am sharing the output just for one.
[snippy_outdir.txt](https://github.com/user-attachments/files/18138624/snippy_outdir.txt)

",suhanyaPrasad,https://github.com/tseemann/snippy/issues/604
