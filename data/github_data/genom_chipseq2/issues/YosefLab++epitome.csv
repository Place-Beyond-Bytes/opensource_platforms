id,title,state,created_at,updated_at,closed_at,body,user,url
MDU6SXNzdWU1NjcwNjY1MjU=,pyranges requires cython to be installed,CLOSED,2020-02-18T18:06:53Z,2020-08-24T15:33:02Z,2020-08-24T15:33:01Z,you have to install cython separately before installing Epitome,akmorrow13,https://github.com/YosefLab/epitome/issues/3
MDU6SXNzdWU1Nzg4MTgzNzU=,eval_vector should accept arrays when just dnase,CLOSED,2020-03-10T19:43:45Z,2020-08-24T16:22:15Z,2020-08-24T16:22:15Z,"```
n <module>
    predictions = model.eval_vector(cellline_all_data, peak_vector_chromatin, cellline_idx)
  File ""/home/eecs/akmorrow/EPITOME/epitome/epitome/models.py"", line 343, in eval_vector
    indices = indices), self.batch_size, 1, self.prefetch_size)
  File ""/home/eecs/akmorrow/EPITOME/epitome/epitome/generators.py"", line 112, in load_data
    ""similarity_matrix is missing data for assays (should have %i rows)"" % (len(similarity_assays))
```",akmorrow13,https://github.com/YosefLab/epitome/issues/4
MDU6SXNzdWU2MDIyOTMyNjE=,pip installation fails,CLOSED,2020-04-17T23:40:15Z,2020-04-23T18:32:11Z,2020-04-23T18:32:11Z,"Running `pip install epitome` or `pip install -e .` results in:
```
ERROR: Could not find a version that satisfies the requirement tf-nightly-2.0-preview==2.0.0.dev20190729 (from epitome==0.0.1a1) (from versions: none)
ERROR: No matching distribution found for tf-nightly-2.0-preview==2.0.0.dev20190729 (from epitome==0.0.1a1)
```
This is likely because the pypi version has `tf-nightly-2.0-preview==2.0.0.dev20190729` in the requirements file, and it should be `tfp-nightly==0.8.0.dev20190729`.

Running `pip install -r requirements.txt` works fine.",RK900,https://github.com/YosefLab/epitome/issues/5
MDU6SXNzdWU2MDI1ODc3OTQ=,download_encode.py ValueError,CLOSED,2020-04-19T00:52:38Z,2020-04-23T18:32:36Z,2020-04-23T18:32:36Z,"sys:1: DtypeWarning: Columns (18) have mixed types.Specify dtype option on import or set low_memory=False.
Processing 868 files...
Completed windowing genome with 0 regions
Traceback (most recent call last):
  File ""data/download_encode.py"", line 270, in <module>
    assert(matrix[:,0].shape[0] == len(filtered_files))
  File ""h5py/_objects.pyx"", line 54, in h5py._objects.with_phil.wrapper
  File ""h5py/_objects.pyx"", line 55, in h5py._objects.with_phil.wrapper
  File ""/Users/rohankoodli/.local/lib/python3.6/site-packages/h5py/_hl/dataset.py"", line 553, in __getitem__
    selection = sel.select(self.shape, args, dsid=self.id)
  File ""/Users/rohankoodli/.local/lib/python3.6/site-packages/h5py/_hl/selections.py"", line 94, in select
    sel[args]
  File ""/Users/rohankoodli/.local/lib/python3.6/site-packages/h5py/_hl/selections.py"", line 261, in __getitem__
    start, count, step, scalar = _handle_simple(self.shape,args)
  File ""/Users/rohankoodli/.local/lib/python3.6/site-packages/h5py/_hl/selections.py"", line 466, in _handle_simple
    x,y,z = _translate_int(int(arg), length)
  File ""/Users/rohankoodli/.local/lib/python3.6/site-packages/h5py/_hl/selections.py"", line 486, in _translate_int
    raise ValueError(""Index (%s) out of range (0-%s)"" % (exp, length-1))
ValueError: Index (0) out of range (0--1)

Occurs with:
`python data/download_encode.py download_path GRCh38 output_path --bigBedToBed ~/Documents/bigBedToBed`",RK900,https://github.com/YosefLab/epitome/issues/7
MDU6SXNzdWU2MDM0Njg5NzM=,Unit tests should run without having to download data from s3,CLOSED,2020-04-20T19:12:27Z,2020-04-22T19:33:03Z,2020-04-22T19:33:03Z,,akmorrow13,https://github.com/YosefLab/epitome/issues/8
MDU6SXNzdWU2MDUwMTE0MDA=,Downloading data fails when directory does not exist,CLOSED,2020-04-22T19:34:00Z,2020-04-23T14:23:05Z,2020-04-23T14:23:04Z,download_and_unzip does not make required directories prior to download,akmorrow13,https://github.com/YosefLab/epitome/issues/11
MDU6SXNzdWU2MDc3NDYzMjg=,Matplotlib error,CLOSED,2020-04-27T18:08:58Z,2020-08-25T18:55:42Z,2020-08-25T18:55:42Z,"ImportError: Python is not installed as a framework. The Mac OS X backend will not be able to function correctly if Python is not installed as a framework. See the Python documentation for more information on installing Python as a framework on Mac OS X. Please either reinstall Python as a framework, or try one of the other backends. If you are using (Ana)Conda please install python.app and replace the use of 'python' with 'pythonw'. See 'Working with Matplotlib on OSX' in the Matplotlib FAQ for more information.",RK900,https://github.com/YosefLab/epitome/issues/17
MDU6SXNzdWU2NjMyNDAwNTA=,Predicting on JUN + JUND when only training on JUND when assaymap is specified,CLOSED,2020-07-21T19:02:25Z,2020-08-24T15:56:56Z,2020-08-24T15:56:56Z,"How to reproduce:
<img width=""702"" alt=""Screen Shot 2020-07-21 at 11 56 59 AM"" src=""https://user-images.githubusercontent.com/23414285/88095007-49d57b00-cb49-11ea-84ed-ede282b15378.png"">
Result:
Results vector should be (10000, 1) for single TF, but is (10000, 2) instead.  
<img width=""292"" alt=""Screen Shot 2020-07-21 at 11 57 15 AM"" src=""https://user-images.githubusercontent.com/23414285/88095031-53f77980-cb49-11ea-84f3-08854f8f792b.png"">

When matrix, assaymap, and cellmap is not specified, a vector of only (10000, 1) is returned:

<img width=""802"" alt=""Screen Shot 2020-07-21 at 12 01 26 PM"" src=""https://user-images.githubusercontent.com/23414285/88095395-e9930900-cb49-11ea-8e95-63455920f4a2.png"">
<img width=""337"" alt=""Screen Shot 2020-07-21 at 12 01 44 PM"" src=""https://user-images.githubusercontent.com/23414285/88095425-f57ecb00-cb49-11ea-96a4-7b198abbc150.png"">
",januusingh,https://github.com/YosefLab/epitome/issues/21
MDU6SXNzdWU2ODAyODA3MjY=,Not sufficient data for SPI1 PAX5,CLOSED,2020-08-17T14:29:52Z,2020-08-24T21:14:06Z,2020-08-24T21:14:06Z,"In list_assays(), SPI1 and PAX5 are listed. However, they cannot be trained on in a full model due to insufficient data.",akmorrow13,https://github.com/YosefLab/epitome/issues/22
MDU6SXNzdWU2ODAyODM1MTA=,assertion for list_assays does not account for similarity edge cases,CLOSED,2020-08-17T14:33:52Z,2020-08-24T21:14:15Z,2020-08-24T21:14:15Z,"`assert len(assays) == len(list(assaymap))-1`
This should only be the case when DNase is not in the list and you only use DNase for similarity. Need to account for other cases:

- DNase is already in the list of assays
- Similarity is computed with more than just DNase
- DNase is not in the list of assays",akmorrow13,https://github.com/YosefLab/epitome/issues/23
MDU6SXNzdWU3ODc4NTU4ODk=,Extra TF function retracing,CLOSED,2021-01-18T01:54:47Z,2021-01-27T03:16:45Z,2021-01-27T03:16:45Z,"(pid=24576) WARNING:tensorflow:9 out of the last 9 calls to <function VariationalPeakModel.run_predictions.<locals>.predict_step at 0x7f4c045efb70> triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has experimental_relax_shapes=True option that relaxes argument shapes that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/tutorials/customization/performance#python_or_tensor_args and https://www.tensorflow.org/api_docs/python/tf/function for  more details.",RK900,https://github.com/YosefLab/epitome/issues/43
MDU6SXNzdWU3ODgzNjgyMzk=,tensorflow INFO only prints for first iteration,CLOSED,2021-01-18T15:40:22Z,2021-01-29T18:11:23Z,2021-01-29T18:11:23Z,"TF info messages will not print for every 1000 iterations. We just see the following message once.
`INFO:tensorflow:Tensor(""args_1:0"", shape=(), dtype=int64) Tensor(""cond/cond/Mean:0"", shape=(), dtype=float32)Tensor(""cond/cond/Mean_1:0"", shape=(), dtype=float32)Tensor(""cond/cond/Mean_2:0"", shape=(), dtype=float32)`",akmorrow13,https://github.com/YosefLab/epitome/issues/44
MDU6SXNzdWU3ODgzNjg5MTk=,remove std from all return results,CLOSED,2021-01-18T15:41:14Z,2021-01-29T18:11:13Z,2021-01-29T18:11:13Z,Remove std dev from all returned dictionaries. We are not using them.,akmorrow13,https://github.com/YosefLab/epitome/issues/45
MDU6SXNzdWU3OTIzNTk4ODc=,Scoping issue with large matrices,OPEN,2021-01-22T23:02:52Z,2021-01-22T23:02:59Z,,"If we put the parallel `score_matrix` code in `name == main`, the code runs for an arbitrarily large matrix.

If parallel `score_matrix` is left as a class function, the code errors out for a large matrix (2350 x 130000)

```
redis.exceptions.ConnectionError: Error 104 while writing to socket. Connection reset by peer.
```",RK900,https://github.com/YosefLab/epitome/issues/47
MDU6SXNzdWU3OTM2MDA1Mzk=,setup does not work with setuptools version 50.0.3,CLOSED,2021-01-25T17:58:31Z,2021-08-31T00:42:33Z,2021-08-31T00:42:33Z,"setuptools version 50.0.3 fails with error:

```
""command class %s must subclass Command"" % cmd_class)
    distutils.errors.DistutilsClassError: command class <class 'setuptools.command.egg_info.egg_info'> must subclass Command
```
It works with setuptools version 51.3.3.post20210118.",akmorrow13,https://github.com/YosefLab/epitome/issues/50
MDU6SXNzdWU3OTM2MjA0NDE=,Loss is not printed,CLOSED,2021-01-25T18:25:19Z,2021-01-29T18:11:00Z,2021-01-29T18:11:00Z,"Loss is not printed because print statement is in tf.function. 

`INFO:tensorflow:100 Tensor(""Mean_3:0"", shape=(), dtype=float32)Tensor(""Mean_4:0"", shape=(), dtype=float32)Tensor(""Mean_5:0"", shape=(), dtype=float32)`

We need to evaluate
",akmorrow13,https://github.com/YosefLab/epitome/issues/51
MDU6SXNzdWU3OTM4ODYyMzg=,cannot update pyranges to 0.0.92,CLOSED,2021-01-26T03:00:10Z,2021-01-27T03:17:15Z,2021-01-27T03:17:09Z,"Fails with error:

ValueError: Buffer dtype mismatch, expected 'const int64_t' but got 'int'

Issue is in pyranges, loading bed files
",akmorrow13,https://github.com/YosefLab/epitome/issues/52
MDU6SXNzdWU3OTcwODI3OTg=,Rebase score_peak_file to not duplicate code,OPEN,2021-01-29T18:12:32Z,2021-01-29T18:12:32Z,,"`score_peak_file()` function in models.py should use `_group_preds_by_region()` to aggregate scores together, instead of using custom code",akmorrow13,https://github.com/YosefLab/epitome/issues/58
MDU6SXNzdWU3OTg4NjYzMDc=,New VLP model cannot be created,CLOSED,2021-02-02T02:24:23Z,2021-02-02T18:18:34Z,2021-02-02T18:18:34Z,"<img width=""702"" alt=""Screen Shot 2021-02-01 at 6 17 28 PM"" src=""https://user-images.githubusercontent.com/16495330/106543019-c9111780-64b9-11eb-85aa-18845914e98b.png"">

Using the new way of initializing VLPs, the code hangs whenever making a new VLP, unable to ^C out",RK900,https://github.com/YosefLab/epitome/issues/59
MDU6SXNzdWU4OTIwODYxNDg=,Does not build with setuptools>52.0.0,CLOSED,2021-05-14T16:55:55Z,2021-08-31T00:42:33Z,2021-08-31T00:42:33Z,"Does not work with 56.2.0.

Some issue with `get_license()`, being parsed as a list instead of a string:
```
      File ""/opt/hostedtoolcache/Python/3.6.13/x64/lib/python3.6/site-packages/setuptools/dist.py"", line 172, in write_pkg_file
        license = rfc822_escape(self.get_license())
      File ""/opt/hostedtoolcache/Python/3.6.13/x64/lib/python3.6/distutils/util.py"", line 474, in rfc822_escape
        lines = header.split('\n')
    AttributeError: 'list' object has no attribute 'split'
```",akmorrow13,https://github.com/YosefLab/epitome/issues/82
I_kwDODmPXHs5MwG5e,pip installation fails for epitome,CLOSED,2022-06-28T17:39:30Z,2022-06-30T23:45:43Z,2022-06-30T23:45:43Z,"Hey,

Thanks for a great approach with some really great documentation. Noticed an issue though when trying to pip install it:

```
pip install epitome
Collecting epitome
  Using cached epitome-0.0.1.tar.gz (40 kB)
Collecting pytest==5.3.2
  Using cached pytest-5.3.2-py3-none-any.whl (234 kB)
Collecting pyyaml
  Using cached PyYAML-6.0-cp36-cp36m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (603 kB)
Collecting seaborn>=0.11.2
  Using cached seaborn-0.11.2-py3-none-any.whl (292 kB)
ERROR: Could not find a version that satisfies the requirement matplotlib>=3.4.3 (from epitome) (from versions: 0.86, 0.86.1, 0.86.2, 0.91.0, 0.91.1, 1.0.1, 1.1.0, 1.1.1, 1.2.0, 1.2.1, 1.3.0, 1.3.1, 1.4.0, 1.4.1rc1, 1.4.1, 1.4.2, 1.4.3, 1.5.0, 1.5.1, 1.5.2, 1.5.3, 2.0.0b1, 2.0.0b2, 2.0.0b3, 2.0.0b4, 2.0.0rc1, 2.0.0rc2, 2.0.0, 2.0.1, 2.0.2, 2.1.0rc1, 2.1.0, 2.1.1, 2.1.2, 2.2.0rc1, 2.2.0, 2.2.2, 2.2.3, 2.2.4, 2.2.5, 3.0.0rc2, 3.0.0, 3.0.1, 3.0.2, 3.0.3, 3.1.0rc1, 3.1.0rc2, 3.1.0, 3.1.1, 3.1.2, 3.1.3, 3.2.0rc1, 3.2.0rc3, 3.2.0, 3.2.1, 3.2.2, 3.3.0rc1, 3.3.0, 3.3.1, 3.3.2, 3.3.3, 3.3.4)
```
",Al-Murphy,https://github.com/YosefLab/epitome/issues/91
I_kwDODmPXHs5M3waj,Pre-trained version of Epitome available,CLOSED,2022-06-30T06:56:30Z,2022-07-01T00:46:12Z,2022-07-01T00:46:11Z,"Hi,

Is there a pre-trained version of Epitome available for the model used to get the performance described in the paper? I would like to apply it to my own data without retraining.

Thanks,
Alan.",Al-Murphy,https://github.com/YosefLab/epitome/issues/92
I_kwDODmPXHs5M-7lX,Error loading checkpoint Epitome model,CLOSED,2022-07-01T15:44:41Z,2022-07-04T08:41:57Z,2022-07-04T08:41:57Z,"I get an error when trying to load the weight for Epitome. I have tried two approaches but get the same error (see below):

Approach 1:
```
from epitome.models import *
model = EpitomeModel(checkpoint=""./model/"")
```

Approach 2:
```
from epitome.dataset import *

targets = [""H3K4me1"",
""H3K4me3"",
""H3K27me3"",
""H3K36me3"",
""H3K9me3"",
""H3K27ac"",""DNase""]
celltypes = ['Panc1', 'PC-9', 'OCI-LY7', 'MCF-7', 'Karpas-422', 
             'IMR-90', 'HepG2', 'HeLa-S3', 'HCT116', 'H9', 'H1', 
             'GM23338', 'GM23248', 'GM12878', 'A549']
e_ds = EpitomeDataset(targets=targets,cells=celltypes)

#load weights
from epitome.models import *
model = EpitomeModel(e_ds,test_celltypes = [""K562""],checkpoint=""./model/"")
```

Both give the following error:
```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
/tmp/ipykernel_1110816/892683426.py in <module>
      1 #load weights
      2 from epitome.models import *
----> 3 model = EpitomeModel(e_ds,test_celltypes = [""K562""],checkpoint=""./model/"")

~/RDS/project/celltypeai/live/Projects/epitome/epitome/models.py in __init__(self, *args, **kwargs)
    689 
    690             # reconstruct dataset and delete unused parameters
--> 691             dataset = EpitomeDataset(**metadata['dataset_params'])
    692             metadata['dataset'] = dataset
    693             del metadata['dataset_params']

~/RDS/project/celltypeai/live/Projects/epitome/epitome/dataset.py in __init__(self, data_dir, targets, cells, min_cells_per_target, min_targets_per_cell, similarity_targets, assembly)
     97             self.assembly = assembly
     98         # get directory where h5 file is stored
---> 99         self.data_dir = EpitomeDataset.download_data_dir(data_dir, assembly)
    100         self.h5_path = os.path.join(self.data_dir, EPITOME_H5_FILE)
    101 

~/RDS/project/celltypeai/live/Projects/epitome/epitome/dataset.py in download_data_dir(data_dir, assembly)
    330         if not EpitomeDataset.contains_required_files(epitome_data_dir):
    331             # Grab data directory and download it from S3 if it doesn't have the required files
--> 332             assert assembly is not None, ""Specify assembly to download.""
    333             assert assembly in EPITOME_GENOME_ASSEMBLIES, ""assembly %s data is not in the S3 cluster. Must be either in %s"" % (assembly, EpitomeDataset.list_genome_assemblies())
    334             url_path = os.path.join(S3_DATA_PATH, assembly + "".zip"")

AssertionError: Specify assembly to download.
```

I think tried setting the assembly manually by editing epitome/dataset.py on line 332 to set assembly to 'hg19' but then I get an error stating permission denied when trying to create a folder in my home directory, not sure what it was doing there.

Cheers,
Alan.",Al-Murphy,https://github.com/YosefLab/epitome/issues/93
I_kwDODmPXHs5M-7q3,Error loading weights for Epitome model,CLOSED,2022-07-01T15:45:08Z,2022-07-01T17:52:25Z,2022-07-01T17:52:24Z,"I get an error when trying to load the weight for Epitome. I have tried two approaches but get the same error (see below):

Approach 1:
```
from epitome.models import *
model = EpitomeModel(checkpoint=""./model/"")
```

Approach 2:
```
from epitome.dataset import *

targets = [""H3K4me1"",
""H3K4me3"",
""H3K27me3"",
""H3K36me3"",
""H3K9me3"",
""H3K27ac"",""DNase""]
celltypes = ['Panc1', 'PC-9', 'OCI-LY7', 'MCF-7', 'Karpas-422', 
             'IMR-90', 'HepG2', 'HeLa-S3', 'HCT116', 'H9', 'H1', 
             'GM23338', 'GM23248', 'GM12878', 'A549']
e_ds = EpitomeDataset(targets=targets,cells=celltypes)

#load weights
from epitome.models import *
model = EpitomeModel(e_ds,test_celltypes = [""K562""],checkpoint=""./model/"")
```

Both give the following error:
```
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
/tmp/ipykernel_1110816/892683426.py in <module>
      1 #load weights
      2 from epitome.models import *
----> 3 model = EpitomeModel(e_ds,test_celltypes = [""K562""],checkpoint=""./model/"")

~/RDS/project/celltypeai/live/Projects/epitome/epitome/models.py in __init__(self, *args, **kwargs)
    689 
    690             # reconstruct dataset and delete unused parameters
--> 691             dataset = EpitomeDataset(**metadata['dataset_params'])
    692             metadata['dataset'] = dataset
    693             del metadata['dataset_params']

~/RDS/project/celltypeai/live/Projects/epitome/epitome/dataset.py in __init__(self, data_dir, targets, cells, min_cells_per_target, min_targets_per_cell, similarity_targets, assembly)
     97             self.assembly = assembly
     98         # get directory where h5 file is stored
---> 99         self.data_dir = EpitomeDataset.download_data_dir(data_dir, assembly)
    100         self.h5_path = os.path.join(self.data_dir, EPITOME_H5_FILE)
    101 

~/RDS/project/celltypeai/live/Projects/epitome/epitome/dataset.py in download_data_dir(data_dir, assembly)
    330         if not EpitomeDataset.contains_required_files(epitome_data_dir):
    331             # Grab data directory and download it from S3 if it doesn't have the required files
--> 332             assert assembly is not None, ""Specify assembly to download.""
    333             assert assembly in EPITOME_GENOME_ASSEMBLIES, ""assembly %s data is not in the S3 cluster. Must be either in %s"" % (assembly, EpitomeDataset.list_genome_assemblies())
    334             url_path = os.path.join(S3_DATA_PATH, assembly + "".zip"")

AssertionError: Specify assembly to download.
```

I think tried setting the assembly manually by editing epitome/dataset.py on line 332 to set assembly to 'hg19' but then I get an error stating permission denied when trying to create a folder in my home directory, not sure what it was doing there.

Cheers,
Alan.",Al-Murphy,https://github.com/YosefLab/epitome/issues/94
I_kwDODmPXHs5Qpyet,Bug in parallel_download.py,CLOSED,2022-08-27T19:59:48Z,2022-08-30T16:00:31Z,2022-08-30T16:00:31Z,"Hi folks,

There's a bug in parallel_download.py that is triggered if files that are targeted for downloading already exist. The command
`h5_file.close()`
should probably be indented so its in scope with the else condition. As written, it can also executed after the first part of the if condition:
`if os.path.exists(matrix_path_all):`
This execution path produces an error because in that case, the h5_file variable is created with:
`h5_file = h5py.File(matrix_path_all, ""r"")['data']`
and is therefore is a Dataset object. Executing this way produces an error because there is no _close()_ function for that variable.

Best regards,
David
",DavidQuigley,https://github.com/YosefLab/epitome/issues/95
