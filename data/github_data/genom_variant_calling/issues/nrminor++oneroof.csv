id,title,state,created_at,updated_at,closed_at,body,user,url
I_kwDOMFR3U86N6eMQ,Coverage Plot improvements,CLOSED,2024-06-28T17:58:52Z,2024-07-08T20:08:15Z,2024-07-08T20:08:15Z,"A few suggestions to improve the coverage plot outputs:

- Adding a line across the coverage plots at a given depth cutoff
- Adding a calculation of how much coverage there is at a given depth cutoff
- Shading areas on the coverage map that are not up to the depth cutoff

It would also be nice to have the ability to let the y axis vary freely in coverage plots for when the input gene segments had uneven concentrations.",ajlail98,https://github.com/nrminor/oneroof/issues/2
I_kwDOMFR3U86N6sW7,ARM compatibility,OPEN,2024-06-28T18:40:11Z,2024-07-10T15:53:45Z,,"Currently the pipeline doesn't work with ARM, but it would be very helpful to be able to use this on Apple Silicon computers.",ajlail98,https://github.com/nrminor/oneroof/issues/3
I_kwDOMFR3U86N7CgP,Barcode sample id lookup,OPEN,2024-06-28T19:38:52Z,2024-09-25T16:27:56Z,,"Users should be able to supply a sample ID lookup, which can be a two column TSV or something similarly simple, that will replace Nanopore barcode names and/or Illumina FASTQ names with sample IDs. A process is written that will do this, but it just needs to be integrated.",nrminor,https://github.com/nrminor/oneroof/issues/4
I_kwDOMFR3U86N7Cwt,Primer resplicing improvements,CLOSED,2024-06-28T19:39:32Z,2024-11-15T15:38:33Z,2024-11-15T15:38:33Z,Primer resplicing should be more configurable and robust to various primer naming schemes.,nrminor,https://github.com/nrminor/oneroof/issues/5
I_kwDOMFR3U86N7DQi,Primer name normalization,CLOSED,2024-06-28T19:41:00Z,2024-10-07T13:34:07Z,2024-10-07T13:34:07Z,A process should be added that will validate the user-provided primer BED and notify the user if an unnormalized primer BED will not be respliceable.,nrminor,https://github.com/nrminor/oneroof/issues/6
I_kwDOMFR3U86N7DpT,Add optional vsearch deduplication,CLOSED,2024-06-28T19:42:20Z,2024-08-27T18:07:17Z,2024-08-27T18:07:17Z,"If amplicons span entire segments, users should be able to deduplicate amplicon reads into their respective haplotypes, sorted by frequency in the original dataset, with vsearch.",nrminor,https://github.com/nrminor/oneroof/issues/7
I_kwDOMFR3U86N7ESH,Fix amplicon counting to enable grouping by sample when using .watchPath(),OPEN,2024-06-28T19:44:40Z,2024-07-10T14:51:37Z,,"This will probably need to be solved in Groovy, as extracting values from dataflow objects is not currently possible in the Nextflow DSL. This may also be a good use case for the new `eval()` process output in the latest Nextflow version.",nrminor,https://github.com/nrminor/oneroof/issues/8
I_kwDOMFR3U86OIuOq,Output fixed y-scale and free y-scale versions of the coverage plot for multi-segment references,CLOSED,2024-07-01T20:11:16Z,2024-07-08T18:40:21Z,2024-07-08T18:40:21Z,,nrminor,https://github.com/nrminor/oneroof/issues/9
I_kwDOMFR3U86PHFjK,Complete developer guide,OPEN,2024-07-10T14:53:27Z,2024-07-10T14:53:33Z,,"The bones of the developer guide are built out, but most of the details on file layout and purpose are yet to be written.",nrminor,https://github.com/nrminor/oneroof/issues/10
I_kwDOMFR3U86PHF84,Add more exhaustive setup instructions for local and HPC execution (and eventually cloud?),OPEN,2024-07-10T14:54:12Z,2024-07-10T14:54:23Z,,,nrminor,https://github.com/nrminor/oneroof/issues/11
I_kwDOMFR3U86UawY3,Builds fail on some systems because of cffi wheel invalid gzip header,CLOSED,2024-08-27T18:14:02Z,2024-08-27T19:25:04Z,2024-08-27T19:25:04Z,"On some systems, including in our Docker builds, `pixi install` fails when the `setuptools` build system tries to extract the latest `cffi` wheel archive.",nrminor,https://github.com/nrminor/oneroof/issues/12
I_kwDOMFR3U86VGA3m,Add `--help` parameter to list pipeline-specific configuration settings in the command line,CLOSED,2024-09-02T17:35:32Z,2024-09-12T20:32:02Z,2024-09-12T20:32:02Z,See a great example here: [https://github.com/isugifNF/blast/blob/master/main.nf](https://github.com/isugifNF/blast/blob/master/main.nf).,nrminor,https://github.com/nrminor/oneroof/issues/13
I_kwDOMFR3U86VifVq,Add final variant long- and pivot-table for assessing amino acid variants across samples,OPEN,2024-09-05T22:02:41Z,2024-09-09T17:49:29Z,,,nrminor,https://github.com/nrminor/oneroof/issues/14
I_kwDOMFR3U86Vif0k,Add reference-free branch of the pipeline that takes primer sequences alone rather than required a reference and a bed file,OPEN,2024-09-05T22:03:19Z,2024-09-30T18:22:46Z,,,nrminor,https://github.com/nrminor/oneroof/issues/15
I_kwDOMFR3U86VpWOc,Enable optional email-notification-based workflow reporting,CLOSED,2024-09-06T15:04:45Z,2024-11-19T14:08:52Z,2024-11-19T14:08:52Z,,nrminor,https://github.com/nrminor/oneroof/issues/16
I_kwDOMFR3U86VpW6D,Add a Python executable entrypoint that can be used in place of Nextflow run in the pixi environment or docker container,CLOSED,2024-09-06T15:06:14Z,2024-09-12T20:09:33Z,2024-09-12T20:09:33Z,,nrminor,https://github.com/nrminor/oneroof/issues/17
I_kwDOMFR3U86Xtlnl,Make sure the illumina workflow has remained up to date now that the nanopore workflow has gone through many feature adds,OPEN,2024-09-24T12:46:29Z,2024-09-30T18:22:39Z,,,nrminor,https://github.com/nrminor/oneroof/issues/19
I_kwDOMFR3U86XtrAI,"Add a subworkflow that bundles results for upload to SRA, Genbank, and GISAID",OPEN,2024-09-24T12:55:54Z,2024-09-30T18:22:27Z,,,nrminor,https://github.com/nrminor/oneroof/issues/20
I_kwDOMFR3U86XxSgC,Figure out how to handle malformed bed files like the BED below where all primers are forward strand oriented,CLOSED,2024-09-24T20:06:43Z,2024-10-03T17:11:46Z,2024-10-03T17:11:46Z,"The primer handling in the pipeline currently fails when primer start positions precede primer start positions, like in the primer BED file for the SARS-CoV-2 ""MIDNIGHT"" d1200 ARTIC primers:

```
NC_045512.2	30	54	SARSCoV_1200_1_LEFT	0	+
NC_045512.2	1205	1183	SARSCoV_1200_1_RIGHT	0	+
NC_045512.2	2153	2179	SARSCoV_1200_3_LEFT	0	+
NC_045512.2	3257	3235	SARSCoV_1200_3_RIGHT	0	+
NC_045512.2	4167	4189	SARSCoV_1200_5_LEFT	0	+
NC_045512.2	5359	5337	SARSCoV_1200_5_RIGHT	0	+
NC_045512.2	6283	6307	SARSCoV_1200_7_LEFT	0	+
NC_045512.2	7401	7379	SARSCoV_1200_7_RIGHT	0	+
NC_045512.2	8253	8282	SARSCoV_1200_9_LEFT	0	+
NC_045512.2	9400	9378	SARSCoV_1200_9_RIGHT	0	+
NC_045512.2	10343	10370	SARSCoV_1200_11_LEFT	0	+
NC_045512.2	11469	11447	SARSCoV_1200_11_RIGHT	0	+
NC_045512.2	12450	12473	SARSCoV_1200_13_LEFT	0	+
NC_045512.2	13621	13599	SARSCoV_1200_13_RIGHT	0	+
NC_045512.2	14540	14568	SARSCoV_1200_15_LEFT	0	+
NC_045512.2	15735	15713	SARSCoV_1200_15_RIGHT	0	+
NC_045512.2	16624	16647	SARSCoV_1200_17_LEFT	0	+
NC_045512.2	17754	17732	SARSCoV_1200_17_RIGHT	0	+
NC_045512.2	18596	18618	SARSCoV_1200_19_LEFT	0	+
NC_045512.2	19678	19655	SARSCoV_1200_19_RIGHT	0	+
NC_045512.2	20553	20581	SARSCoV_1200_21_LEFT	0	+
NC_045512.2	21642	21620	SARSCoV_1200_21_RIGHT	0	+
NC_045512.2	22511	22537	SARSCoV_1200_23_LEFT	0	+
NC_045512.2	23631	23609	SARSCoV_1200_23_RIGHT	0	+
NC_045512.2	24633	24658	SARSCoV_1200_25_LEFT	0	+
NC_045512.2	25790	25768	SARSCoV_1200_25_RIGHT	0	+
NC_045512.2	26744	26766	SARSCoV_1200_27_LEFT	0	+
NC_045512.2	27894	27872	SARSCoV_1200_27_RIGHT	0	+
NC_045512.2	28677	28699	SARSCoV_1200_29_LEFT	0	+
NC_045512.2	29790	29768	SARSCoV_1200_29_RIGHT	0	+
NC_045512.2	1100	1128	SARSCoV_1200_2_LEFT	0	+
NC_045512.2	2266	2244	SARSCoV_1200_2_RIGHT	0	+
NC_045512.2	3144	3166	SARSCoV_1200_4_LEFT	0	+
NC_045512.2	4262	4240	SARSCoV_1200_4_RIGHT	0	+
NC_045512.2	5257	5286	SARSCoV_1200_6_LEFT	0	+
NC_045512.2	6380	6358	SARSCoV_1200_6_RIGHT	0	+
NC_045512.2	7298	7328	SARSCoV_1200_8_LEFT	0	+
NC_045512.2	8385	8363	SARSCoV_1200_8_RIGHT	0	+
NC_045512.2	9303	9327	SARSCoV_1200_10_LEFT	0	+
NC_045512.2	10451	10429	SARSCoV_1200_10_RIGHT	0	+
NC_045512.2	11372	11394	SARSCoV_1200_12_LEFT	0	+
NC_045512.2	12560	12538	SARSCoV_1200_12_RIGHT	0	+
NC_045512.2	13509	13532	SARSCoV_1200_14_LEFT	0	+
NC_045512.2	14641	14619	SARSCoV_1200_14_RIGHT	0	+
NC_045512.2	15608	15634	SARSCoV_1200_16_LEFT	0	+
NC_045512.2	16720	16698	SARSCoV_1200_16_RIGHT	0	+
NC_045512.2	17622	17649	SARSCoV_1200_18_LEFT	0	+
NC_045512.2	18706	18684	SARSCoV_1200_18_RIGHT	0	+
NC_045512.2	19574	19604	SARSCoV_1200_20_LEFT	0	+
NC_045512.2	20698	20676	SARSCoV_1200_20_RIGHT	0	+
NC_045512.2	21532	21562	SARSCoV_1200_22_LEFT	0	+
NC_045512.2	22612	22590	SARSCoV_1200_22_RIGHT	0	+
NC_045512.2	23518	23544	SARSCoV_1200_24_LEFT	0	+
NC_045512.2	24736	24714	SARSCoV_1200_24_RIGHT	0	+
NC_045512.2	25690	25712	SARSCoV_1200_26_LEFT	0	+
NC_045512.2	26857	26835	SARSCoV_1200_26_RIGHT	0	+
NC_045512.2	27784	27808	SARSCoV_1200_28_LEFT	0	+
NC_045512.2	29007	28985	SARSCoV_1200_28_RIGHT	0	+
NC_045512.2	22590	22612	nCoV_1200_22_Right		0	-
NC_045512.3	22511	22537	nCoV_1200_23_Left_Omicron	0	+
NC_045512.4	25690	25712	nCoV_1200_26_Left_Omicron	0	+
NC_045512.5	27784	27808	nCoV_1200_28_Left_Omicron	0	+
NC_045512.6	21675	21700	nCov_ARTIC_V4_71_Right	0	-
```

To solve this, we'll need to add a step that scans the input BED file, finds any rows where start preceded stop, flip the two, and set the final column to ""-"". The script written for this step can eventually be expanded to a script that handles all primer BED file validation, which has previously been a sore spot for the pipeline.",nrminor,https://github.com/nrminor/oneroof/issues/21
I_kwDOMFR3U86Xx5yd,Refactor so that one incomplete/unreconciled primer pair does not crash the whole run and instead allows it to proceed with what primer pairs it has,CLOSED,2024-09-24T21:39:22Z,2024-11-19T14:12:19Z,2024-11-19T14:12:19Z,,nrminor,https://github.com/nrminor/oneroof/issues/22
I_kwDOMFR3U86XyGWT,Fix the process that checks the validity of a requested nextclade dataset,OPEN,2024-09-24T22:12:29Z,2024-09-30T18:21:51Z,,"Currently, the process is meant to perform a membership test on an array of supported nextclade datasets, but isn't doing so because of the pretty-printed table returned by `nextclade dataset list`. The process also needs an `errorStrategy` directive so that it doesn't crash the pipeline.",nrminor,https://github.com/nrminor/oneroof/issues/23
I_kwDOMFR3U86X5DPL,Multi-sample coverage plotting never runs,CLOSED,2024-09-25T15:30:44Z,2024-09-30T18:07:55Z,2024-09-30T18:07:55Z,,nrminor,https://github.com/nrminor/oneroof/issues/24
I_kwDOMFR3U86YbkLx,Workaround for iVar not outputting separate reference segments in consensus sequences,OPEN,2024-09-30T18:21:30Z,2024-10-01T14:28:55Z,,"Ivar, which `oneroof` uses for variant- and consensus-calling, [currently doesn't support outputting multiple reference segments in consensus sequences](https://github.com/andersen-lab/ivar/issues/62). This is inconvenient for multi-segment viruses like H5N1 (not to mention for anything with chromosomes). Until the iVar team adds support, it might be worth writing a workaround that separates reads aligned to each segment into its own consensus-calling step and then remerges them afterward.",nrminor,https://github.com/nrminor/oneroof/issues/25
I_kwDOMFR3U86Yt_Qs,Add a few more steps to primer BED file validation that normalize primer names in an opinionated fashion,CLOSED,2024-10-02T16:56:55Z,2024-10-03T16:26:50Z,2024-10-03T16:26:50Z,"Here's a perfect example of the kind of primer scheme that will ultimately break primer resplicing because of missing normalization:

```
NC_045512.2	30	54	SARSCoV_1200_1_LEFT	0	+
NC_045512.2	1205	1183	SARSCoV_1200_1_RIGHT	0	+
NC_045512.2	2153	2179	SARSCoV_1200_3_LEFT	0	+
NC_045512.2	3257	3235	SARSCoV_1200_3_RIGHT	0	+
NC_045512.2	4167	4189	SARSCoV_1200_5_LEFT	0	+
NC_045512.2	5359	5337	SARSCoV_1200_5_RIGHT	0	+
NC_045512.2	6283	6307	SARSCoV_1200_7_LEFT	0	+
NC_045512.2	7401	7379	SARSCoV_1200_7_RIGHT	0	+
NC_045512.2	8253	8282	SARSCoV_1200_9_LEFT	0	+
NC_045512.2	9400	9378	SARSCoV_1200_9_RIGHT	0	+
NC_045512.2	10343	10370	SARSCoV_1200_11_LEFT	0	+
NC_045512.2	11469	11447	SARSCoV_1200_11_RIGHT	0	+
NC_045512.2	12450	12473	SARSCoV_1200_13_LEFT	0	+
NC_045512.2	13621	13599	SARSCoV_1200_13_RIGHT	0	+
NC_045512.2	14540	14568	SARSCoV_1200_15_LEFT	0	+
NC_045512.2	15735	15713	SARSCoV_1200_15_RIGHT	0	+
NC_045512.2	16624	16647	SARSCoV_1200_17_LEFT	0	+
NC_045512.2	17754	17732	SARSCoV_1200_17_RIGHT	0	+
NC_045512.2	18596	18618	SARSCoV_1200_19_LEFT	0	+
NC_045512.2	19678	19655	SARSCoV_1200_19_RIGHT	0	+
NC_045512.2	20553	20581	SARSCoV_1200_21_LEFT	0	+
NC_045512.2	21642	21620	SARSCoV_1200_21_RIGHT	0	+
NC_045512.2	22511	22537	SARSCoV_1200_23_LEFT	0	+
NC_045512.2	23631	23609	SARSCoV_1200_23_RIGHT	0	+
NC_045512.2	24633	24658	SARSCoV_1200_25_LEFT	0	+
NC_045512.2	25790	25768	SARSCoV_1200_25_RIGHT	0	+
NC_045512.2	26744	26766	SARSCoV_1200_27_LEFT	0	+
NC_045512.2	27894	27872	SARSCoV_1200_27_RIGHT	0	+
NC_045512.2	28677	28699	SARSCoV_1200_29_LEFT	0	+
NC_045512.2	29790	29768	SARSCoV_1200_29_RIGHT	0	+
NC_045512.2	1100	1128	SARSCoV_1200_2_LEFT	0	+
NC_045512.2	2266	2244	SARSCoV_1200_2_RIGHT	0	+
NC_045512.2	3144	3166	SARSCoV_1200_4_LEFT	0	+
NC_045512.2	4262	4240	SARSCoV_1200_4_RIGHT	0	+
NC_045512.2	5257	5286	SARSCoV_1200_6_LEFT	0	+
NC_045512.2	6380	6358	SARSCoV_1200_6_RIGHT	0	+
NC_045512.2	7298	7328	SARSCoV_1200_8_LEFT	0	+
NC_045512.2	8385	8363	SARSCoV_1200_8_RIGHT	0	+
NC_045512.2	9303	9327	SARSCoV_1200_10_LEFT	0	+
NC_045512.2	10451	10429	SARSCoV_1200_10_RIGHT	0	+
NC_045512.2	11372	11394	SARSCoV_1200_12_LEFT	0	+
NC_045512.2	12560	12538	SARSCoV_1200_12_RIGHT	0	+
NC_045512.2	13509	13532	SARSCoV_1200_14_LEFT	0	+
NC_045512.2	14641	14619	SARSCoV_1200_14_RIGHT	0	+
NC_045512.2	15608	15634	SARSCoV_1200_16_LEFT	0	+
NC_045512.2	16720	16698	SARSCoV_1200_16_RIGHT	0	+
NC_045512.2	17622	17649	SARSCoV_1200_18_LEFT	0	+
NC_045512.2	18706	18684	SARSCoV_1200_18_RIGHT	0	+
NC_045512.2	19574	19604	SARSCoV_1200_20_LEFT	0	+
NC_045512.2	20698	20676	SARSCoV_1200_20_RIGHT	0	+
NC_045512.2	21532	21562	SARSCoV_1200_22_LEFT	0	+
NC_045512.2	22612	22590	SARSCoV_1200_22_RIGHT	0	+
NC_045512.2	23518	23544	SARSCoV_1200_24_LEFT	0	+
NC_045512.2	24736	24714	SARSCoV_1200_24_RIGHT	0	+
NC_045512.2	25690	25712	SARSCoV_1200_26_LEFT	0	+
NC_045512.2	26857	26835	SARSCoV_1200_26_RIGHT	0	+
NC_045512.2	27784	27808	SARSCoV_1200_28_LEFT	0	+
NC_045512.2	29007	28985	SARSCoV_1200_28_RIGHT	0	+
NC_045512.2	22590	22612	nCoV_1200_22_Right		0	-
NC_045512.3	22511	22537	nCoV_1200_23_Left_Omicron	0	+
NC_045512.4	25690	25712	nCoV_1200_26_Left_Omicron	0	+
NC_045512.5	27784	27808	nCoV_1200_28_Left_Omicron	0	+
NC_045512.6	21675	21700	nCov_ARTIC_V4_71_Right	0	-
```",nrminor,https://github.com/nrminor/oneroof/issues/28
I_kwDOMFR3U86aKpdw,Potentially replace cutadapt with seqkit amplicon to simplify primer processing,OPEN,2024-10-14T16:09:10Z,2024-10-14T16:09:10Z,,"Right now, read trimming up to and including primers is very, very complicated. Here's the script block of the process that performs this task:

```
script:
    amplicon = file(patterns_file).getSimpleName()
    """"""
    FORWARD_PATTERN=\$(head -n 1 ${patterns_file})
    REVERSE_PATTERN=\$(tail -n 1 ${patterns_file})

    echo ""Removing the forward primer: \$FORWARD_PATTERN""
    cutadapt \
    ${untrimmed} \
    -j ${task.cpus} \
    --front \$FORWARD_PATTERN \
    --revcomp \
    --match-read-wildcards \
    --errors ${params.max_mismatch} \
    --untrimmed-output ${barcode}_${amplicon}_fwd.untrimmed.fastq.gz \
    -o tmp.fq

    echo ""Removing the reverse primer: \$REVERSE_PATTERN""
    cutadapt \
    tmp.fq \
    -j ${task.cpus} \
    --adapter \$REVERSE_PATTERN \
    --revcomp \
    --match-read-wildcards \
    --errors ${params.max_mismatch} \
    --minimum-length ${params.min_len} \
    --maximum-length ${params.max_len} \
    --untrimmed-output ${barcode}_${amplicon}_rev.untrimmed.fastq.gz \
    -o ${barcode}.${amplicon}.trimmed.fastq.gz && \
    rm tmp.fq
    """"""
```

Instead, all the above could be replaced with:

```bash
FORWARD_PATTERN=\$(head -n 1 ${patterns_file})
REVERSE_PATTERN=\$(tail -n 1 ${patterns_file})

seqkit amplicon \
-f -r 1:-1 \
--forward \$FORWARD_PATTERN \
--reverse \$REVERSE_PATTERN \
--max-mismatch ${params.max_mismatch} \
--strict-mode \
${barcode}.${amplicon}.trimmed.fastq.gz
```

Docs for `seqkit amplicon` are [here](https://bioinf.shenwei.me/seqkit/usage/#amplicon).",nrminor,https://github.com/nrminor/oneroof/issues/30
I_kwDOMFR3U86h3Ka_,Add stub directives to all processes to enable Nextflow's `-stub` dry-run option,OPEN,2024-12-03T17:21:02Z,2024-12-03T17:21:41Z,,"A user recently requested a Snakemake-like dry run feature to suss out how the pipeline works before supplying large input files. Implementing this in Nextflow is much more involved, as it requires that we write a [stub](https://www.nextflow.io/docs/latest/process.html#stub) directive for every single process. Fortunately, that will be relatively straightforward if tedious in this pipeline because most processes produce a single output file. Given that, a process that looks like this:

```nextflow
process CLUMP_READS {

    /* */

	tag ""${sample_id}""

	errorStrategy { task.attempt < 3 ? 'retry' : 'ignore' }
	maxRetries 2

	cpus 4

	input:
	tuple val(sample_id), path(reads)

	output:
	tuple val(sample_id), path(""${sample_id}.merged.fastq.gz"")

	script:
	""""""
	clumpify.sh in=${reads} out=${sample_id}.merged.fastq.gz t=${task.cpus} reorder
	""""""

}

```

Would become this:

```nextflow
process CLUMP_READS {

    /* */

	tag ""${sample_id}""

	errorStrategy { task.attempt < 3 ? 'retry' : 'ignore' }
	maxRetries 2

	cpus 4

	input:
	tuple val(sample_id), path(reads)

	output:
	tuple val(sample_id), path(""${sample_id}.merged.fastq.gz"")

	script:
	""""""
	clumpify.sh in=${reads} out=${sample_id}.merged.fastq.gz t=${task.cpus} reorder
	""""""
	
	stub:
	""""""
	touch ${sample_id}.merged.fastq.gz
	""""""

}

```",nrminor,https://github.com/nrminor/oneroof/issues/38
I_kwDOMFR3U86iW_IO,Port updates to the multisample plotting script into the per-sample plotting script,OPEN,2024-12-06T21:10:54Z,2024-12-06T21:10:54Z,,,nrminor,https://github.com/nrminor/oneroof/issues/40
I_kwDOMFR3U86iXD9f,Make Multisample coverage plot with barcodes if sample lookup fails,OPEN,2024-12-06T21:25:13Z,2024-12-06T21:25:13Z,,"When running the pipeline with the --sample_lookup flag and a .json provided, the step will fail with 2 retries if the sample names don't match anything. Could this instead print a warning and produce a multisample plot with all the samples and their default names?",ajlail98,https://github.com/nrminor/oneroof/issues/41
