id,title,state,created_at,updated_at,closed_at,body,user,url
MDU6SXNzdWUyNTcxNjQ0NTg=,Support for multiple gene symbols per interval,CLOSED,2017-09-12T20:05:20Z,2017-09-29T19:42:58Z,2017-09-29T19:42:58Z,"If multiple symbol are provided, for example via CNVkit *.cnr files, then this messes up the gene-level copy number CSV file. 

",lima1,https://github.com/lima1/PureCN/issues/1
MDU6SXNzdWUyNTcyMTE2OTU=,Calculate Chromosomal Instability,CLOSED,2017-09-12T23:16:47Z,2019-05-06T15:06:44Z,2019-05-06T15:06:44Z,"- [x] Literature review about common metrics (fraction altered vs metrics that use both focal and broad)

- [x]  Implement callCIN function

- [x] Add to Dx.R script
 
",lima1,https://github.com/lima1/PureCN/issues/2
MDU6SXNzdWUyNTcyMTI1OTg=,LOH Database,CLOSED,2017-09-12T23:21:36Z,2017-12-05T18:30:56Z,2017-12-05T18:30:56Z,"- [ ] Find a good test dataset we are allowed to use, maybe TCGA ABSOLUTE or ASCAT. 

- [ ] Test on ""difficult"" indications like lung

- [ ] Add it as an lohDB runAbsoluteCN argument",lima1,https://github.com/lima1/PureCN/issues/3
MDU6SXNzdWUyNTcyMTMxNzM=,New mapping bias database,CLOSED,2017-09-12T23:24:56Z,2018-01-14T04:50:19Z,2018-01-14T04:50:19Z,"Parsing the normal panel VCF is slow and unnecessary. A BED file with mapping bias and PON counts would be sufficient. Probably no need for HDF5.

- [x] Add function that converts normal panel VCF in BED/tabix format

- [x] Add feature to NormalDB.R script that calls this function

- [x] Support this BED/tabix file format in setMappingBiasVcf",lima1,https://github.com/lima1/PureCN/issues/4
MDU6SXNzdWUyNTcyMTM4OTA=,Eliminate unlikely solutions early,CLOSED,2017-09-12T23:29:12Z,2018-02-04T00:21:08Z,2018-02-04T00:21:08Z,"PureCN still spends a lot of time optimizing unlikely solutions. Ironically, this mostly affects clearly diploid solutions with few somatic events.

- [x] Test for balanced allelic fractions and set max.ploidy to 3 when highly balanced

- [x] Looks at many datasets to find a good cutoff for ""highly balanced"", probably around 80%.",lima1,https://github.com/lima1/PureCN/issues/5
MDU6SXNzdWUyNTcyMTQ5ODc=,Full support for GATK4,CLOSED,2017-09-12T23:35:50Z,2021-02-25T23:54:14Z,2020-07-19T18:19:49Z,"- [x] Parsing coverage

- [x] Parsing log-ratios

- [x] Mutect2 tumor-only

- [x] Mutect2 tumor/normal

- [ ] CallableBases equivalent 

- [x] Parsing segmentations

- [x] PoN VCFs",lima1,https://github.com/lima1/PureCN/issues/6
MDU6SXNzdWUyNTcyMTU1Njk=,More accurate copy numbers for high-level amplifications,CLOSED,2017-09-12T23:39:35Z,2017-12-03T05:36:29Z,2017-12-03T05:36:29Z,"PureCN tests integer copy numbers from 0 to 7. Some high-level amplifications are thus assigned a copy number of 7, not say 9. (very high-level will get accurate numbers, because the ""subclonal"" state fits better than 7.",lima1,https://github.com/lima1/PureCN/issues/7
MDU6SXNzdWUyNTcyMjM3MTc=,Better accuracy in samples with low amounts of input DNA,CLOSED,2017-09-13T00:32:43Z,2019-08-18T02:23:36Z,2019-08-18T02:23:36Z,"- [ ] Collect test dataset based on Picard estimated library sizes

- [ ] Examine duplication rates and correlation with noise/coverage

- [ ] Add to correctCoverageBias and calculateBamCoverageByInterval if necessary",lima1,https://github.com/lima1/PureCN/issues/8
MDU6SXNzdWUyNTcyMjM5Nzg=,Better accuracy in sample of high purity with significant heterogeneity,OPEN,2017-09-13T00:34:54Z,2018-11-19T22:44:54Z,,"In high purity samples, PureCN currently isn't as good as it could be and frequently overestimates ploidy when copy number heterogenity is significant.

- [ ] Find good test samples

- [ ] Improve SNV fitting and sub-clonal CNV calling ",lima1,https://github.com/lima1/PureCN/issues/9
MDU6SXNzdWUyNTgxOTM4OTQ=,"Crash in callLOH with NCBI-style chromosome names (1,2,...X,Y)",CLOSED,2017-09-16T00:22:50Z,2017-09-29T19:42:22Z,2017-09-29T19:42:22Z,"Error message:
Error in `$<-.data.frame`(`*tmp*`, ""arm"", value = ""p"") :
  replacement has 1 row, data has 0
Calls: write.csv ... callLOH -> .getArmLocations -> $<- -> $<-.data.frame
Execution halted

Problem is data(centromeres) is not converted.",lima1,https://github.com/lima1/PureCN/issues/10
MDU6SXNzdWUyNjAwMjkzNzg=,Better flagging of samples,OPEN,2017-09-23T18:31:28Z,2019-08-11T04:41:58Z,,"We currently flag so many samples that this feature becomes rather useless. Need to become better at figuring out if a PureCN run was successful.

- [x] Document flags in main vignette
- [ ] Incorporate noise and fit in a smarter way
- [ ] Lower purity cutoff when sample quality is high and unlikely genome duplication or significant heterogeneity
",lima1,https://github.com/lima1/PureCN/issues/11
MDU6SXNzdWUyNjE4NjI2MDc=,Improve predictSomatic VCF annotation,OPEN,2017-09-30T18:21:25Z,2019-08-11T04:41:58Z,,"- [ ] All sample-specific annotation should go into FORMAT, not INFO.

- [ ] Add all columns in the data.frame version to the VCF

- [ ] Provide option to generate minimal VCF annotation that only provides the most likely state plus posterior probability instead of all states",lima1,https://github.com/lima1/PureCN/issues/12
MDU6SXNzdWUyNjE5NDQ1NjM=,Priors for private germline rate in callMutationBurden,OPEN,2017-10-01T20:39:08Z,2018-11-19T22:46:05Z,,"We currently use flat priors for private variants. This can result in artificially high private germline rates in hyper-mutated samples or low rates in silent genomes, especially in high purity samples. (Thus resulting in under- and overestimating somatic rates, respectively.)

- [ ] Provide function to estimate rate based on callMutationBurden output from many samples

- [ ] Adjust probabilities, probably only in callMutationBurden, not in fitting.",lima1,https://github.com/lima1/PureCN/issues/13
MDU6SXNzdWUyNjQwMjQwOTk=,gene-level calls not working - callAlterations,CLOSED,2017-10-09T20:58:31Z,2017-10-29T01:10:54Z,2017-10-29T01:10:54Z,"Hi,

I am testing the PureCN and it is running fine excepting that the gene calls is not working so I can't identify which genes have CNVs just by checking the result table. 

I added a ""Gene"" column to my interval file so I dont understand why this issue happens. Below is an example of my interval file:

Target	gc_bias	Gene
chr1:2488048-2488227	0.65	TNFRSF14
chr1:2489099-2489338	0.6625	TNFRSF14
chr1:2489725-2489964	0.641666666666667	TNFRSF14
chr1:2491220-2491459	0.691666666666667	TNFRSF14
chr1:2492018-2492197	0.65	TNFRSF14
chr1:2492909-2493302	0.619289340101523	TNFRSF14

Below is the output of the runAbsoluteCN function (this step is okay).

> ret <-runAbsoluteCN(normal.coverage.file=pool, tumor.coverage.file=tumor.coverage.file, genome=""hg19"", sampleid=""HORIZON"", gc.gene.file=intervals, normalDB=normalDB, args.segmentation=list(target.weight.file=target.weight.file), post.optimize=FALSE, plot.cnv=FALSE, verbose=TRUE)
INFO [2017-10-09 17:38:29] ------------------------------------------------------------
INFO [2017-10-09 17:38:29] PureCN 1.6.3
INFO [2017-10-09 17:38:29] ------------------------------------------------------------
INFO [2017-10-09 17:38:29] Arguments: -tumor.coverage.file /home/rramalho/projects/CNV/PURECN/manual/coverage_HORIZON.txt -genome hg19 -args.segmentation target_weights.txt -sampleid HORIZON -gc.gene.file /home/rramalho/projects/CNV/PURECN/gc_file.txt -plot.cnv FALSE -post.optimize FALSE -verbose TRUE -normal.coverage.file <data> -normalDB <data>
INFO [2017-10-09 17:38:29] Loading coverage files...
INFO [2017-10-09 17:38:29] Mean coverages: 1006X (tumor) 1032X (normal).
INFO [2017-10-09 17:38:29] Mean coverages: chrX: 730.57, chrY: 0.00, chr1-22: 1021.39.
WARN [2017-10-09 17:38:29] Allosome coverage missing, cannot determine sex.
WARN [2017-10-09 17:38:29] Sex tumor/normal mismatch: tumor = 
INFO [2017-10-09 17:38:29] Removing 902 targets with low coverage in normalDB.
INFO [2017-10-09 17:38:29] Removing 474 low coverage (< 15X) targets.
INFO [2017-10-09 17:38:29] Using 5959 targets.
INFO [2017-10-09 17:38:29] AT/GC dropout: 0.55 (tumor), 1.11 (normal). 
WARN [2017-10-09 17:38:29] High GC-bias in normal or tumor. Is data GC-normalized?
INFO [2017-10-09 17:38:29] No Gene column in gc.gene.file. You won't get gene-level calls.
INFO [2017-10-09 17:38:29] Sample sex: F
INFO [2017-10-09 17:38:29] Segmenting data...
INFO [2017-10-09 17:38:29] Target weights found, will use weighted CBS.
INFO [2017-10-09 17:38:29] Setting undo.SD parameter to 1.250000.
INFO [2017-10-09 17:38:32] Mean standard deviation of log-ratios: 0.76
INFO [2017-10-09 17:38:32] 2D-grid search of purity and ploidy...
INFO [2017-10-09 17:38:42] Local optima: 0.55/6, 0.82/6, 0.68/6, 0.95/6, 0.68/3.8, 0.72/3.4,
0.75/3, 0.78/2.6, 0.82/2.2, 0.85/1.8, 0.88/1.4, 0.75/2
INFO [2017-10-09 17:38:42] Testing local optimum 1/12 at purity 0.55 and total ploidy 6.00...
INFO [2017-10-09 17:38:42] Recalibrating log-ratios...
INFO [2017-10-09 17:38:42] Testing local optimum 1/12 at purity 0.55 and total ploidy 6.00...
INFO [2017-10-09 17:38:43] Recalibrating log-ratios...
INFO [2017-10-09 17:38:43] Testing local optimum 1/12 at purity 0.55 and total ploidy 6.00...
INFO [2017-10-09 17:38:45] Recalibrating log-ratios...
INFO [2017-10-09 17:38:45] Testing local optimum 1/12 at purity 0.55 and total ploidy 6.00...
INFO [2017-10-09 17:38:46] Testing local optimum 2/12 at purity 0.82 and total ploidy 6.00...
INFO [2017-10-09 17:38:47] Recalibrating log-ratios...
INFO [2017-10-09 17:38:47] Testing local optimum 2/12 at purity 0.82 and total ploidy 6.00...
INFO [2017-10-09 17:38:48] Recalibrating log-ratios...
INFO [2017-10-09 17:38:48] Testing local optimum 2/12 at purity 0.82 and total ploidy 6.00...
INFO [2017-10-09 17:38:50] Recalibrating log-ratios...
INFO [2017-10-09 17:38:50] Testing local optimum 2/12 at purity 0.82 and total ploidy 6.00...
INFO [2017-10-09 17:38:51] Testing local optimum 3/12 at purity 0.68 and total ploidy 6.00...
INFO [2017-10-09 17:38:52] Recalibrating log-ratios...
INFO [2017-10-09 17:38:52] Testing local optimum 3/12 at purity 0.68 and total ploidy 6.00...
INFO [2017-10-09 17:38:53] Recalibrating log-ratios...
INFO [2017-10-09 17:38:53] Testing local optimum 3/12 at purity 0.68 and total ploidy 6.00...
INFO [2017-10-09 17:38:54] Recalibrating log-ratios...
INFO [2017-10-09 17:38:54] Testing local optimum 3/12 at purity 0.68 and total ploidy 6.00...
INFO [2017-10-09 17:38:56] Testing local optimum 4/12 at purity 0.95 and total ploidy 6.00...
INFO [2017-10-09 17:38:57] Recalibrating log-ratios...
INFO [2017-10-09 17:38:57] Testing local optimum 4/12 at purity 0.95 and total ploidy 6.00...
INFO [2017-10-09 17:38:58] Recalibrating log-ratios...
INFO [2017-10-09 17:38:58] Testing local optimum 4/12 at purity 0.95 and total ploidy 6.00...
INFO [2017-10-09 17:38:59] Recalibrating log-ratios...
INFO [2017-10-09 17:38:59] Testing local optimum 4/12 at purity 0.95 and total ploidy 6.00...
INFO [2017-10-09 17:39:01] Testing local optimum 5/12 at purity 0.68 and total ploidy 3.80...
INFO [2017-10-09 17:39:02] Recalibrating log-ratios...
INFO [2017-10-09 17:39:02] Testing local optimum 5/12 at purity 0.68 and total ploidy 3.80...
INFO [2017-10-09 17:39:03] Recalibrating log-ratios...
INFO [2017-10-09 17:39:03] Testing local optimum 5/12 at purity 0.68 and total ploidy 3.80...
INFO [2017-10-09 17:39:05] Recalibrating log-ratios...
INFO [2017-10-09 17:39:05] Testing local optimum 5/12 at purity 0.68 and total ploidy 3.80...
INFO [2017-10-09 17:39:06] Testing local optimum 6/12 at purity 0.72 and total ploidy 3.40...
INFO [2017-10-09 17:39:07] Recalibrating log-ratios...
INFO [2017-10-09 17:39:07] Testing local optimum 6/12 at purity 0.72 and total ploidy 3.40...
INFO [2017-10-09 17:39:08] Recalibrating log-ratios...
INFO [2017-10-09 17:39:08] Testing local optimum 6/12 at purity 0.72 and total ploidy 3.40...
INFO [2017-10-09 17:39:10] Recalibrating log-ratios...
INFO [2017-10-09 17:39:10] Testing local optimum 6/12 at purity 0.72 and total ploidy 3.40...
INFO [2017-10-09 17:39:12] Testing local optimum 7/12 at purity 0.75 and total ploidy 3.00...
INFO [2017-10-09 17:39:12] Recalibrating log-ratios...
INFO [2017-10-09 17:39:12] Testing local optimum 7/12 at purity 0.75 and total ploidy 3.00...
INFO [2017-10-09 17:39:13] Recalibrating log-ratios...
INFO [2017-10-09 17:39:13] Testing local optimum 7/12 at purity 0.75 and total ploidy 3.00...
INFO [2017-10-09 17:39:15] Recalibrating log-ratios...
INFO [2017-10-09 17:39:15] Testing local optimum 7/12 at purity 0.75 and total ploidy 3.00...
INFO [2017-10-09 17:39:17] Testing local optimum 8/12 at purity 0.78 and total ploidy 2.60...
INFO [2017-10-09 17:39:17] Recalibrating log-ratios...
INFO [2017-10-09 17:39:17] Testing local optimum 8/12 at purity 0.78 and total ploidy 2.60...
INFO [2017-10-09 17:39:18] Recalibrating log-ratios...
INFO [2017-10-09 17:39:18] Testing local optimum 8/12 at purity 0.78 and total ploidy 2.60...
INFO [2017-10-09 17:39:20] Recalibrating log-ratios...
INFO [2017-10-09 17:39:20] Testing local optimum 8/12 at purity 0.78 and total ploidy 2.60...
INFO [2017-10-09 17:39:22] Testing local optimum 9/12 at purity 0.82 and total ploidy 2.20...
INFO [2017-10-09 17:39:22] Recalibrating log-ratios...
INFO [2017-10-09 17:39:22] Testing local optimum 9/12 at purity 0.82 and total ploidy 2.20...
INFO [2017-10-09 17:39:24] Recalibrating log-ratios...
INFO [2017-10-09 17:39:24] Testing local optimum 9/12 at purity 0.82 and total ploidy 2.20...
INFO [2017-10-09 17:39:25] Recalibrating log-ratios...
INFO [2017-10-09 17:39:25] Testing local optimum 9/12 at purity 0.82 and total ploidy 2.20...
INFO [2017-10-09 17:39:27] Testing local optimum 10/12 at purity 0.85 and total ploidy 1.80...
INFO [2017-10-09 17:39:28] Recalibrating log-ratios...
INFO [2017-10-09 17:39:28] Testing local optimum 10/12 at purity 0.85 and total ploidy 1.80...
INFO [2017-10-09 17:39:29] Recalibrating log-ratios...
INFO [2017-10-09 17:39:29] Testing local optimum 10/12 at purity 0.85 and total ploidy 1.80...
INFO [2017-10-09 17:39:30] Recalibrating log-ratios...
INFO [2017-10-09 17:39:30] Testing local optimum 10/12 at purity 0.85 and total ploidy 1.80...
INFO [2017-10-09 17:39:32] Testing local optimum 11/12 at purity 0.88 and total ploidy 1.40...
INFO [2017-10-09 17:39:33] Recalibrating log-ratios...
INFO [2017-10-09 17:39:33] Testing local optimum 11/12 at purity 0.88 and total ploidy 1.40...
INFO [2017-10-09 17:39:34] Recalibrating log-ratios...
INFO [2017-10-09 17:39:34] Testing local optimum 11/12 at purity 0.88 and total ploidy 1.40...
INFO [2017-10-09 17:39:35] Recalibrating log-ratios...
INFO [2017-10-09 17:39:35] Testing local optimum 11/12 at purity 0.88 and total ploidy 1.40...
INFO [2017-10-09 17:39:37] Testing local optimum 12/12 at purity 0.75 and total ploidy 2.00...
INFO [2017-10-09 17:39:38] Recalibrating log-ratios...
INFO [2017-10-09 17:39:38] Testing local optimum 12/12 at purity 0.75 and total ploidy 2.00...
INFO [2017-10-09 17:39:39] Recalibrating log-ratios...
INFO [2017-10-09 17:39:39] Testing local optimum 12/12 at purity 0.75 and total ploidy 2.00...
INFO [2017-10-09 17:39:40] Recalibrating log-ratios...
INFO [2017-10-09 17:39:40] Testing local optimum 12/12 at purity 0.75 and total ploidy 2.00...
INFO [2017-10-09 17:39:43] Done.
INFO [2017-10-09 17:39:43] -------------------------

However when I run callAlterations(ret) I had the following error:

> gene.calls <- callAlterations(ret)
FATAL [2017-10-09 17:40:01] This function requires gene-level calls. Please add a column 'Gene' 

FATAL [2017-10-09 17:40:01] containing gene symbols to the gc.gene.file. 

FATAL [2017-10-09 17:40:01]  

FATAL [2017-10-09 17:40:01] This is most likely a user error due to invalid input data or 

FATAL [2017-10-09 17:40:01] parameters (PureCN 1.6.3). 

Erro: This function requires gene-level calls. Please add a column 'Gene' 
containing gene symbols to the gc.gene.file. 
 
This is most likely a user error due to invalid input data or 
parameters (PureCN 1.6.3). 

> sessionInfo()
R version 3.4.1 (2017-06-30)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux 9 (stretch)

Matrix products: default
BLAS: /opt/R-3.4.1/lib/R/lib/libRblas.so
LAPACK: /opt/R-3.4.1/lib/R/lib/libRlapack.so

locale:
 [1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=pt_BR.UTF-8        LC_COLLATE=pt_BR.UTF-8    
 [5] LC_MONETARY=pt_BR.UTF-8    LC_MESSAGES=pt_BR.UTF-8   
 [7] LC_PAPER=pt_BR.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=pt_BR.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    parallel  stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] PureCN_1.6.3               VariantAnnotation_1.22.3  
 [3] Rsamtools_1.28.0           Biostrings_2.44.2         
 [5] XVector_0.16.0             SummarizedExperiment_1.6.5
 [7] DelayedArray_0.2.7         matrixStats_0.52.2        
 [9] Biobase_2.36.2             GenomicRanges_1.28.6      
[11] GenomeInfoDb_1.12.2        IRanges_2.10.4            
[13] S4Vectors_0.14.6           BiocGenerics_0.22.0       
[15] DNAcopy_1.50.1            

loaded via a namespace (and not attached):
 [1] locfit_1.5-9.1           splines_3.4.1            lattice_0.20-35         
 [4] colorspace_1.3-2         rtracklayer_1.36.5       GenomicFeatures_1.28.5  
 [7] blob_1.1.0               XML_3.98-1.9             rlang_0.1.2             
[10] DBI_0.7                  BiocParallel_1.10.1      bit64_0.9-7             
[13] RColorBrewer_1.1-2       lambda.r_1.2             GenomeInfoDbData_0.99.0 
[16] plyr_1.8.4               zlibbioc_1.22.0          munsell_0.4.3           
[19] gtable_0.2.0             futile.logger_1.4.3      VGAM_1.0-4              
[22] memoise_1.1.0            labeling_0.3             biomaRt_2.32.1          
[25] AnnotationDbi_1.38.2     Rcpp_0.12.13             edgeR_3.18.1            
[28] scales_0.5.0             BSgenome_1.44.2          limma_3.32.7            
[31] bit_1.1-12               ggplot2_2.2.1            digest_0.6.12           
[34] grid_3.4.1               tools_3.4.1              bitops_1.0-6            
[37] RCurl_1.95-4.8           lazyeval_0.2.0           tibble_1.3.4            
[40] RSQLite_2.0              futile.options_1.0.0     Matrix_1.2-11           
[43] data.table_1.10.4        GenomicAlignments_1.12.2 compiler_3.4.1          


",rframal,https://github.com/lima1/PureCN/issues/14
MDU6SXNzdWUyNzExOTgyOTE=,Support for phased VCFs,OPEN,2017-11-04T15:02:18Z,2018-11-19T22:44:14Z,,"- [ ] Obtain test samples
- [ ] Jointly infer M for phased SNPs in a segment
- [ ] In predictSomatic VCF export, provide phasing in unbalanced segments.",lima1,https://github.com/lima1/PureCN/issues/15
MDU6SXNzdWUyODA1NzI5NDk=,Crash with multiple gene symbols per target when normalDB is provided,CLOSED,2017-12-08T18:10:52Z,2017-12-09T23:43:02Z,2017-12-09T23:43:02Z,"Error in y$coefficients[rownames(results[[1]]$gene.calls), 2] :
  subscript out of bounds
Calls: runAbsoluteCN -> .addVoomToGeneCalls

This only affects 1.8 since this feature was removed in 1.9.  addVoomToGeneCalls needs to support multiple gene symbols.",lima1,https://github.com/lima1/PureCN/issues/16
MDU6SXNzdWUyODQ5NTM2NDU=,"Instead of removing bad variants, flag and ignore them",OPEN,2017-12-28T17:04:01Z,2018-03-20T14:37:27Z,,"In order to use PureCN's variant annotation in production settings, it would be better to flag filtered variants, not completely remove them. Low priority for now, since users can easily re-annotate the input VCF.",lima1,https://github.com/lima1/PureCN/issues/17
MDU6SXNzdWUyODkzMjgxNTE=,Use male and female samples for coverage normalization of autosomes,CLOSED,2018-01-17T16:26:49Z,2018-01-28T05:21:47Z,2018-01-28T05:21:47Z,"In small pool of normals, which appears to be the case for many users, splitting male and female unnecessarily decreases the pool size. Male samples can be rare in labs focusing on breast cancer and chrX and chrY are ignored for male samples anyways.
 ",lima1,https://github.com/lima1/PureCN/issues/18
MDU6SXNzdWUyOTkwMTE4ODA=,Crash with indels from Mutect2 VCFs,CLOSED,2018-02-21T15:22:39Z,2020-05-26T16:20:33Z,2018-03-01T00:57:49Z,"Error in data.frame(seqnames = as.factor(seqnames(x)), start = start(x),  :
  duplicate row.names: rs147304884, rs774418471, rs72106118
Calls: runAbsoluteCN ... eval -> as.data.frame -> as.data.frame -> data.frame

Happens when indels overlap with segment breakpoints",lima1,https://github.com/lima1/PureCN/issues/19
MDU6SXNzdWUzMDAwMzkxNjY=,Error using PureCN.R,CLOSED,2018-02-25T16:23:46Z,2018-03-20T04:08:45Z,2018-03-20T04:08:45Z,"...
Removing 259 variants outside intervals.
INFO [2018-02-25 11:14:01] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
Error: logical subscript contains NAs
Execution halted
",billnjcn111,https://github.com/lima1/PureCN/issues/20
MDU6SXNzdWUzMDQxNTA1NTg=,error using Mutect2 vcf,CLOSED,2018-03-11T11:28:03Z,2020-05-26T16:20:14Z,2018-03-13T14:28:29Z,"Hi,
I am trying to use PureCN with a vcf generated by Mutect2, but I get an error as follows when I run filterVcfMuTect2(vcf):
`Error in if (fractionContaminated > 0) { :    missing value where TRUE/FALSE needed`

The vcf was obtained in tumour-only mode with the following command for GATK4 (as recommended [here](https://software.broadinstitute.org/gatk/documentation/tooldocs/4.0.0.0/org_broadinstitute_hellbender_tools_walkers_mutect_Mutect2.php) but without the `--panel-of-normals` option:
```
  gatk Mutect2 \
   -R ref_fasta.fa \
   -I tumor.bam \
   -tumor tumor_sample_name \
   --germline-resource af-only-gnomad.vcf.gz \
   -O tumor_unmatched_m2_snvs_indels.vcf.gz
```
It turns out PureCN is looking for a geno(vcf) field named FA, but this field doesn't exist in my vcf. Using GATK3 MuTect2 vcf also gives the same error. I feel like I may be missing something, so apologies for posting this as an issue, any help would be appreciated!",sraorao,https://github.com/lima1/PureCN/issues/21
MDU6SXNzdWUzMDY4OTI1NTM=,Crash in PureCN.R when interval.file contains chrM,CLOSED,2018-03-20T14:35:08Z,2018-03-20T23:22:43Z,2018-03-20T23:22:43Z,"Error in `$<-.data.frame`(`*tmp*`, ""end"", value = 27325) :
  replacement has 1 row, data has 0
Calls: plotAbs -> .plotTypeBAF -> $<- -> $<-.data.frame

Workaround until fix: Don't provide chrM in baits BED files.",lima1,https://github.com/lima1/PureCN/issues/22
MDU6SXNzdWUzMTYyMDM3Njc=,Allow unmatched cols in .annotatePosteriorsVcf,CLOSED,2018-04-20T09:54:47Z,2018-04-20T22:01:57Z,2018-04-20T22:01:57Z,"`.annotatePosteriorsVcf` fails when gene.symbol is missing because [`match` returns NA](https://github.com/lima1/PureCN/blob/bc4259799fb4293318cd2a6bf44de271afdecfaf/R/predictSomatic.R#L118). Allow omission?

```r
idxColsMisc <- match(idxColsMisc, colnames(pp))
idxColsMisc <- na.omit(idxColsMisc)
```

Happy to explain further if unclear

Love your work, Markus, wonderful job with this package.",andrewrech,https://github.com/lima1/PureCN/issues/23
MDU6SXNzdWUzMTg1ODEzNjk=,Minor documentation issue,CLOSED,2018-04-28T00:07:22Z,2018-04-28T01:37:01Z,2018-04-28T01:37:01Z,"In Quick vignette Dx.R description, add "".R"" to:

Rscript $PureCN/FilterCallableLoci --genome hg19
",tedtoal,https://github.com/lima1/PureCN/issues/24
MDU6SXNzdWUzMTg1ODU4NjY=,"Dx.R message ""Loading required package: deconstructSigs""",CLOSED,2018-04-28T00:54:30Z,2018-04-28T01:37:20Z,2018-04-28T01:37:20Z,"When I ran Dx.R without the --signature argument, it nevertheless produced the message:

""Loading required package: deconstructSigs""

(which worked because I do happen to have that package installed, but it should skip the load if not being used).
",tedtoal,https://github.com/lima1/PureCN/issues/25
MDU6SXNzdWUzMTkzNjM3Mzg=,Sex column contents better as FEMALE / MALE,CLOSED,2018-05-01T23:39:36Z,2019-06-28T18:34:27Z,2019-06-28T18:34:27Z,"The PureCN.R output file containing the purity and sex estimation uses ""M"" and ""F"" in the ""Sex"" column.  R reads ""F"" as ""FALSE"" unless you specify the type of each column.  I suggest you change the contents of the column to ""MALE"" and ""FEMALE"".
",tedtoal,https://github.com/lima1/PureCN/issues/26
MDU6SXNzdWUzMTk4OTQ4OTA=,PureCN and WGS data,CLOSED,2018-05-03T12:12:57Z,2019-03-24T17:52:49Z,2019-03-24T17:52:49Z,"Hi,

I am very interesting in applying this program to our data. We are currently working with WGS pairs and I was curious if there are options/modifications that can be applied to test PureCN on this type of data.  

Thanks for your time.

Best, 
 Rob",robrollback,https://github.com/lima1/PureCN/issues/27
MDU6SXNzdWUzMjA2NDcwNjY=,createNormalDatabase returns error if bed has overlapping intervals,CLOSED,2018-05-07T01:17:25Z,2018-05-07T17:38:13Z,2018-05-07T17:38:13Z,"Hello Marcus,

I note that if and only if an input `.bed` file has overlapping intervals:

```
WARN [2018-05-06 21:03:02] Coverage data contains single nucleotide intervals.
WARN [2018-05-06 21:03:02] Found 2 overlapping intervals, starting at line 5352.
WARN [2018-05-06 21:03:03] Coverage data contains single nucleotide intervals.
WARN [2018-05-06 21:03:03] Found 2 overlapping intervals, starting at line 5352.
```

`createNormalDatabase`  returns an error due to 

```r
split(x$average.coverage, as.character(seqnames(x)))
```

in `PureCN:::getSexFromCoverage`:

```
Error in split.default(x$average.coverage, as.character(seqnames(x))) :
  first argument must be a vector
Calls: <Anonymous> -> sapply -> lapply -> FUN -> split -> split.default
```

I am using the latest dev version of the package on the latest R. I have created about 40 normal databases without error if the overlapping intervals message does not appear.

### Minimun reproducible example:

* [coverage file 1](https://s3.amazonaws.com/rech-ul-7/cf7bd1f7-e2cc-42f6-a43d-e54b3cb52a50_Homo_sapiens_assembly38_Exome_v1_hg38_Targets_extra_every_3_line_10c3a27f-484a-4367-b288-2ae95ad75143_TN_M_R_xE_N_dna_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526260481&Signature=nM5Fny2eTjszM1%2F63NTXPvLiiSw%3D)
* [coverage file 2](https://s3.amazonaws.com/rech-ul-7/c5365dd2-6c85-4ac8-a870-56bd99999056_Homo_sapiens_assembly38_Exome_v1_hg38_Targets_extra_every_3_line_20eb6c3f-7f4f-4c94-b3fe-2272fff699be_TN_M_R_xE_N_dna_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526312618&Signature=38ApGLO3S2TZtZLzCQbk2U4iPD8%3D)

```r
PureCN::createNormalDatabase(c(""file1"", ""file2""))
```

Should I pre-filter these, or perhaps add a tryCatch here?

Thank you very much,

Andrew",andrewrech,https://github.com/lima1/PureCN/issues/28
MDU6SXNzdWUzMjA5MDE2ODM=,split.default error is not due to single bp intervals,CLOSED,2018-05-07T18:12:27Z,2018-05-19T15:24:16Z,2018-05-19T15:24:16Z,"Related to #28 

### Intervals 

* [1](https://s3.amazonaws.com/rech-ul-7/28669e4f-2820-4a7e-b41a-c35c6a622fb0_Homo_sapiens_assembly38_Exome_v1_hg38_Targets_extra_every_3_line_13-348_N.sorted_sortn_dna_md_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526321061&Signature=EnyF1URG44JfsHDLw6Y5SLozke0%3D)
* [2](https://s3.amazonaws.com/rech-ul-7/4f19244a-2731-4bdc-9f25-c591d99f11ca_Homo_sapiens_assembly38_Exome_v1_hg38_Targets_extra_every_3_line_13-416_N.sorted_sortn_dna_md_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526321064&Signature=KbzFXNo6KeacipmIlY9hBymPdKE%3D)

```
R:       normalDB <- PureCN::createNormalDatabase(ncovf[5:6])
WARN [2018-05-07 14:03:48] Found 2 overlapping intervals, starting at line 5352.
WARN [2018-05-07 14:03:49] Found 2 overlapping intervals, starting at line 5352.
Error in split.default(x$average.coverage, as.character(seqnames(x))) :
  first argument must be a vector
Calls: <Anonymous> -> sapply -> lapply -> FUN -> split -> split.default
No traceback available
```

```r
	library(data.table)
	dt <- fread(interval.file)
	dt[, c(""chr"", ""interval"") := Target %>% tstrsplit("":"")]
	dt[, c(""start"", ""stop"") := interval %>% tstrsplit(""-"")]
	dt %>% str
```

```
Classes ‘data.table’ and 'data.frame':  78060 obs. of  9 variables:
 $ Target          : chr  ""chr1:931039-931089"" ""chr1:939272-939460"" ""chr1:942410-942488"" ""chr1:943698-944011"" ...
 $ total_coverage  : num  3239 26849 2278 37733 83135 ...
 $ counts          : num  101 489.7 50.9 659.8 1260 ...
 $ on_target       : logi  TRUE TRUE TRUE TRUE TRUE TRUE ...
 $ duplication_rate: num  0.26 0.198 0.154 0.223 0.251 ...
 $ chr             : chr  ""chr1"" ""chr1"" ""chr1"" ""chr1"" ...
 $ interval        : chr  ""931039-931089"" ""939272-939460"" ""942410-942488"" ""943698-944011"" ...
 $ start           : chr  ""931039"" ""939272"" ""942410"" ""943698"" ...
 $ stop            : chr  ""931089"" ""939460"" ""942488"" ""944011"" ...
 - attr(*, "".internal.selfref"")=<externalptr>
```

```r
dt[start == stop] %>% nrow
```

```
[1] 0
```

Perhaps these 1bp regions?

```r
      dt[, start := start %>% as.numeric]
      dt[, stop := stop %>% as.numeric]
      dt[stop-start < 2]
```
```
                      Target total_coverage       counts on_target duplication_rate   chr
 1: chr2:112584648-112584649             NA           NA      TRUE     0.2157894737  chr2
 2: chr2:170178288-170178289             NA           NA      TRUE     0.1917098446  chr2
 3: chr2:179583975-179583976             NA           NA      TRUE     0.2403100775  chr2
 4:   chr3:77646054-77646055  128.295666733 64.147833366      TRUE     0.2560975610  chr3
 5:   chr3:15414374-15414375    6.309622954  3.154811477      TRUE     0.0000000000  chr3
 6:   chr3:50299213-50299214             NA           NA      TRUE     0.2352941176  chr3
 7:   chr7:35801277-35801278  154.585762375 77.818683100      TRUE     0.1395348837  chr7
 8: chr7:150949409-150949410    0.000000000  0.000000000      TRUE               NA  chr7
 9: chr8:143986358-143986359             NA           NA      TRUE     0.2528735632  chr8
10:  chr10:59221683-59221684    0.000000000  0.000000000      TRUE               NA chr10
11:  chr10:76883991-76883992    0.000000000  0.000000000      TRUE               NA chr10
12:  chr14:23421768-23421769             NA           NA      TRUE     0.0000000000 chr14
13:  chr16:66547971-66547972   79.921890752 41.012549202      TRUE     0.2352941176 chr16
               interval     start      stop
 1: 112584648-112584649 112584648 112584649
 2: 170178288-170178289 170178288 170178289
 3: 179583975-179583976 179583975 179583976
 4:   77646054-77646055  77646054  77646055
 5:   15414374-15414375  15414374  15414375
 6:   50299213-50299214  50299213  50299214
 7:   35801277-35801278  35801277  35801278
 8: 150949409-150949410 150949409 150949410
 9: 143986358-143986359 143986358 143986359
10:   59221683-59221684  59221683  59221684
11:   76883991-76883992  76883991  76883992
12:   23421768-23421769  23421768  23421769
13:   66547971-66547972  66547971  66547972

```



",andrewrech,https://github.com/lima1/PureCN/issues/29
MDU6SXNzdWUzMjEzMzc1MDg=,Error when fitting variants (!sum(mapping.bias.ok)),CLOSED,2018-05-08T20:35:36Z,2018-05-09T16:21:10Z,2018-05-09T15:39:29Z,"See #29 for hardware and session info.

Note that this file is aggressively downsampled for testing purposes, which may be contributing to the error. More than 50 other identically pipelined and processed samples completed successfully. This is one of three files that generated errors, all with the same message as indicated below.

Thank you very much for your help, as always.

* [tumor loess](https://s3.amazonaws.com/rech-ul-7/e886eb16-dae4-4329-8b65-c6d018017150_Homo_sapiens_assembly38_FFPEv2_Hg38_10c3a27f-484a-4367-b288-2ae95ad75143_TN_M_R_xE_T_dna_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526415972&Signature=aPJX1QmcNPGLNCm9SDCdpnSYFf8%3D)
* [vcf](https://s3.amazonaws.com/rech-ul-7/e2c99141-95e0-40ac-93b7-f2016b4b7437_12-211_T.sorted_sortn_dna_md_rg_br.vcf?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526416132&Signature=%2BRDhxfAK1xoNUX1svL6phTXIFDc%3D)
* [tw](https://s3.amazonaws.com/rech-ul-7/622da328-9e65-4c7d-a0c8-918bed0648f2_Homo_sapiens_assembly38_FFPEv2_Hg38_tw.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526416209&Signature=oj2Ci%2BAzFZRKqywHSxLas8aWJm4%3D)
* [gc](https://s3.amazonaws.com/rech-ul-7/8aa74c54-68b2-4703-9dd0-e6af4e844890_Homo_sapiens_assembly38_FFPEv2_Hg38_gc_file.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526416238&Signature=X0zUPcuR4JQ1RyKyyrx%2FvK3t0I4%3D)
* [normalDB](https://s3.amazonaws.com/rech-ul-7/95c65fd1-f28c-4ed0-9c3e-b39b14991512_Homo_sapiens_assembly38_FFPEv2_Hg38_normalDB.RDS?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526416330&Signature=npdFmRsorY7%2BKIV5veESZztHQaE%3D)
* [normal loess](https://s3.amazonaws.com/rech-ul-7/6c31fb95-06ea-4997-97c2-305d2e2a4a4f_Homo_sapiens_assembly38_FFPEv2_Hg38_12-211_N.sorted_sortn_dna_md_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1526416449&Signature=XJnkSYzGX8wUul6dMK0i3pJJzAM%3D)

## ERROR

```
Error in if (!sum(mapping.bias.ok)) { :
  missing value where TRUE/FALSE needed
```

## LOGGING

```
WARN [2018-05-08 16:16:44] gc.gene.file was renamed to interval.file.
INFO [2018-05-08 16:16:44] ------------------------------------------------------------
INFO [2018-05-08 16:16:44] PureCN 1.11.1
INFO [2018-05-08 16:16:44] ------------------------------------------------------------
INFO [2018-05-08 16:16:53] Arguments: -tumor.coverage.file Homo_sapiens_assembly38_FFPEv2_Hg38_10c3a27f-484a-4367-b288-2ae95ad75143_TN_M_R_xE_T_dna_rg_br_loess.txt -vcf.file 12-211_T.sorted_sortn_dna_md_rg_br.vcf -genome hg38 -args.segmentation Homo_sapiens_assembly38_FFPEv2_Hg38_tw.txt -max.candidate.solutions 50 -max.non.clonal 0.1 -max.pon 5 -iterations 60 -gc.gene.file Homo_sapiens_assembly38_FFPEv2_Hg38_gc_file.txt -plot.cnv FALSE -cosmic.vcf.file /mnt/ephm/refs//CosmicCodingMuts.vcf.gz -post.optimize TRUE -speedup.heuristics 1 -log.file H_38_FFPE2_H38_2635-69-4552-98-1040040_TN_M_R_E_T_mc-15.ip-50.mbq-25.tp-015.tc-7.mp-6.mnc-01.pcn.log -verbose TRUE -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -args.setMappingBiasVcf <data> -fun.segmentation <data> -max.ploidy <data> -test.num.copy <data> -test.purity <data> -min.coverage <data>
INFO [2018-05-08 16:16:53] Loading coverage files...
INFO [2018-05-08 16:16:53] Mean target coverages: 174X (tumor) 172X (normal).
WARN [2018-05-08 16:16:53] Allosome coverage missing, cannot determine sex.
WARN [2018-05-08 16:16:53] Allosome coverage missing, cannot determine sex.
INFO [2018-05-08 16:16:54] Removing 13 intervals with missing log.ratio.
INFO [2018-05-08 16:16:54] Removing 16 targets excluded in normalDB.
INFO [2018-05-08 16:16:54] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2018-05-08 16:16:54] Removing 232 low coverage (< 0.0015X) targets.
INFO [2018-05-08 16:16:54] Using 2574 intervals (2574 on-target, 0 off-target).
INFO [2018-05-08 16:16:54] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2018-05-08 16:16:54] AT/GC dropout: 1.01 (tumor), 1.01 (normal).
INFO [2018-05-08 16:16:54] Loading VCF...
INFO [2018-05-08 16:17:51] Found 3140875 variants in VCF file.
INFO [2018-05-08 16:17:58] 740586 (23.6%) variants annotated as likely germline (DB INFO flag).
INFO [2018-05-08 16:18:07] 36747998-e48f-436f-a372-827f882cf91b_TN_M_R_xE_T_dna is tumor in VCF file.
INFO [2018-05-08 16:18:19] 928 homozygous and 10440 heterozygous variants on chrX.
INFO [2018-05-08 16:18:19] Sex from VCF: F (Fisher's p-value: < 0.0001, odds-ratio: 1.93).
WARN [2018-05-08 16:18:19] Duplicated arguments in filterVcf
INFO [2018-05-08 16:18:31] Removing 2966776 non heterozygous (in matched normal) germline SNPs.
INFO [2018-05-08 16:18:45] Initial testing for significant sample cross-contamination: maybe
INFO [2018-05-08 16:18:46] Removing 109928 variants with AF < 0.030 or AF >= 1.000 or less than 3 supporting reads or depth < 15.
INFO [2018-05-08 16:18:46] Removing 33977 low quality variants with BQ < 25.
INFO [2018-05-08 16:18:46] Total size of targeted genomic region: 0.45Mb (0.69Mb with 50bp padding).
INFO [2018-05-08 16:18:47] 8.3% of targets contain variants.
INFO [2018-05-08 16:18:47] Removing 29971 variants outside intervals.
INFO [2018-05-08 16:18:47] Reading COSMIC VCF...
INFO [2018-05-08 16:18:49] Found SOMATIC annotation in VCF.
INFO [2018-05-08 16:18:49] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2018-05-08 16:18:49] Found SOMATIC annotation in VCF. Setting mapping bias to 1.021.
INFO [2018-05-08 16:18:49] Scanning artfdet_comb5.vcf.gz...
INFO [2018-05-08 16:18:52] Imputing mapping bias for 97 variants...
INFO [2018-05-08 16:18:55] Sample sex: ?
INFO [2018-05-08 16:18:55] Segmenting data...
INFO [2018-05-08 16:18:55] Target weights found, will use weighted CBS.
INFO [2018-05-08 16:18:55] Loading pre-computed boundaries for DNAcopy...
INFO [2018-05-08 16:18:55] Setting undo.SD parameter to 0.500000.
INFO [2018-05-08 16:18:55] Setting prune.hclust.h parameter to 0.100000.
INFO [2018-05-08 16:18:55] Found 25 segments with median size of 68.28Mb.
INFO [2018-05-08 16:18:55] Using 223 variants.
INFO [2018-05-08 16:18:55] Mean standard deviation of log-ratios: 0.17
INFO [2018-05-08 16:18:55] 2D-grid search of purity and ploidy...
INFO [2018-05-08 16:19:00] Local optima: 0.17/2.8, 0.15/2.4, 0.17/2, 0.29/3.2, 0.19/1.8, 0.48/4.4, 0.45/3.8, 0.31/2.6, 0.33/3, 0.68/5.4, 0.55/4.2, 0.82/6, 0.38/2.4, 0.42/2.8, 0.48/2, 0.78/2.8,
0.58/2.6, 0.52/3, 0.42/1.6, 0.62/1.4, 0.82/1.2, 0.95/3, 0.95/1
INFO [2018-05-08 16:19:00] Testing local optimum 1/23 at purity 0.17 and total ploidy 2.80...
INFO [2018-05-08 16:19:00] Recalibrating log-ratios...
INFO [2018-05-08 16:19:00] Testing local optimum 1/23 at purity 0.17 and total ploidy 2.80...
INFO [2018-05-08 16:19:01] Recalibrating log-ratios...
INFO [2018-05-08 16:19:01] Testing local optimum 1/23 at purity 0.17 and total ploidy 2.80...
INFO [2018-05-08 16:19:01] Recalibrating log-ratios...
INFO [2018-05-08 16:19:01] Testing local optimum 1/23 at purity 0.17 and total ploidy 2.80...
INFO [2018-05-08 16:19:01] Testing local optimum 2/23 at purity 0.15 and total ploidy 2.40...
INFO [2018-05-08 16:19:01] Fitting variants for purity 0.15, tumor ploidy 4.62 and contamination 0.01.
```",andrewrech,https://github.com/lima1/PureCN/issues/30
MDU6SXNzdWUzMjE5NzA0NTM=,Crash in IntervalFile.R,CLOSED,2018-05-10T15:18:15Z,2018-05-19T19:52:49Z,2018-05-19T19:52:49Z,"INFO [2018-05-10 15:33:03] Averaging reptiming into bins of size 100000...
Error in aggregate.data.frame(as.data.frame(x), ...) :
  no rows to aggregate
Calls: <Anonymous> ... aggregate -> aggregate.default -> aggregate.data.frame
In addition: Warning message:
In .Seqinfo.mergexy(x, y) :
  The 2 combined objects have no sequence levels in common. (Use
  suppressWarnings() to suppress this warning.)

Happens when reptiming has different chromosome naming style.",lima1,https://github.com/lima1/PureCN/issues/31
MDU6SXNzdWUzMjIwNDAwNTM=,"Error in sapply(px.rij, sum, na.rm = TRUE) + log(prior.purity.local)",CLOSED,2018-05-10T18:46:42Z,2018-08-08T16:06:18Z,2018-08-08T16:06:18Z,"See #29 for hardware and session info. I am able to consistently reproduce this error without setting a seed.

* [log](https://s3.amazonaws.com/rech-ul-1/ac550750-116a-4ef2-a369-02cf8c1a3561_H_38_GOAL_38_NA_667544-574-462-9644-39231_TN_M_R_E_T_mc-15.ip-50.mbq-25.tp-04.tc-7.mp-6.mnc-01.pcn.log)

### ERROR

```
Error in sapply(px.rij, sum, na.rm = TRUE) + log(prior.purity.local) :
  non-numeric argument to binary operator
```

* [tw (txt)](https://s3.amazonaws.com/rech-ul-1/69487124-e945-48b7-a9b6-d7852a129123_Homo_sapiens_assembly38_GOAL_hg38_probes_chr_NA_removed_tw.txt)
* [tcov (txt)](https://s3.amazonaws.com/rech-ul-1/fd1b4555-3c16-4586-82a8-d95b69237ef5_Homo_sapiens_assembly38_GOAL_hg38_probes_chr_NA_removed_6e6754c4-d574-46a2-9644-dd3f92cd31ec_TN_M_R_xE_T_dna_rg_br_loess.txt)
* [ncov via calculateTangentNormal (rds)](https://s3.amazonaws.com/rech-ul-1/08c66a3b-4ff5-4e97-a1a1-1caca7874bc8_best_nl_error.rds)
* [normal.panel.vcf.file via calculateMappingBiasVcf (rds)](https://s3.amazonaws.com/rech-ul-1/166d6def-3f22-410c-b63b-e59023a4df26_artfdet_comb5.vcf.rds)
* [bed via import (rds)](https://s3.amazonaws.com/rech-ul-1/47f0cdd1-0d40-44c4-bc8c-ab1f2a8d9814_error_bed_example.rds)
* [vcf (rds)](https://s3.amazonaws.com/rech-ul-1/ff8ed56f-af2f-4485-b306-188a080357c9_error_example_vcf.rds)
* [normalDB (rds)](https://s3.amazonaws.com/rech-ul-1/b5c5a19a-28d4-4e1d-88d3-4bc0518020da_normaldb_error_example.rds)

Thanks a lot as always!

Andrew",andrewrech,https://github.com/lima1/PureCN/issues/32
MDU6SXNzdWUzMjI4OTYwOTM=,"Error in .Call2(""solve_user_SEW0"", start, end, width, PACKAGE = ""IRanges"") ",CLOSED,2018-05-14T16:46:08Z,2019-09-01T19:12:17Z,2018-05-19T19:52:20Z,"Hello Marcus,

Here is another reproducible error using input files processed identically to other samples that completed successfully, with no apparent qualitative difference in input files. All files were created using the indicated PureCN version in the log.

```
Error in .Call2(""solve_user_SEW0"", start, end,
width, PACKAGE = ""IRanges"") : 
solving row 9: negative widths are not allowed
```



* [log](https://s3.amazonaws.com/rech-ul-30/70f87babfb0c656a2bbf4d0f4586ec9ec1150f4d85268ec55a1ab93e67928b55_H_38_E_1_38_P_S_12-211_T_mc-15.ip-300.mbq-25.tp-04.tc-7.mp-6.mnc-01.pcn.log?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907553&Signature=OalftOvNXF7Iz22P0d42VyP35LQ%3D)

* [tcov](https://s3.amazonaws.com/rech-ul-30/cfe297df18764f1156ca5045838da4dae8465307f7207677f3d716cd7df5f5fa_Homo_sapiens_assembly38_Exome_v1_hg38_Probes_Standard_10c3a27f-484a-4367-b288-2ae95ad75143_TN_M_R_xE_T_dna_rg_br_loess.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907532&Signature=bVCJH6CW2k%2FSc8R4TAxr%2FbU%2Bz3Q%3D)

* [vcf](https://s3.amazonaws.com/rech-ul-30/da905e3649ff0d61a6a2166b5b496dc0bba2ceb479051c5506a2acbfdce2e1d3_10c3a27f-484a-4367-b288-2ae95ad75143_TN_M_R_xE_T_dna_rg_br.vcf?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907535&Signature=dsXa%2FiFa%2FKHCJQQWxxGZ1pdW2v0%3D)


* [tw](https://s3.amazonaws.com/rech-ul-30/a53ee593fdcf219736a48be46236c80d2c4046d9d73f724b500b153b544bf82f_Homo_sapiens_assembly38_Exome_v1_hg38_Probes_Standard_tw.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907541&Signature=TV9c50E%2B3AHEpQoScF8UkYl788k%3D)

* [gc_file](https://s3.amazonaws.com/rech-ul-30/ce72df0af69de048fad647f183189280531c4c77e18af5a9ebafaf593e25b010_Homo_sapiens_assembly38_Exome_v1_hg38_Probes_Standard_gc_file.txt?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907544&Signature=b%2BblJdihvaGLJ6x0fCrChTV6Grw%3D)

* [normalDB](https://s3.amazonaws.com/rech-ul-30/380ca65c70a476fe73577f1fc5fc229d32e6098cdcbd6570053b21af08491990_Homo_sapiens_assembly38_Exome_v1_hg38_Probes_Standard_normalDB.RDS.zst?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907586&Signature=1axf%2Fu8VAxuP0yP8089BwYWkNng%3D)

* [normal panel vcf](https://s3.amazonaws.com/rech-ul-30/307c1f727cc949de2a1ece66a5c2cd20e1ee521366923c7fe90ea0dac888ffdf_artfdet_comb5.vcf.rds?AWSAccessKeyId=AKIAI6SXE4VOIPIZJI6Q&Expires=1528907591&Signature=iEan3bys0QAyHtwtq4MnoDU2VvI%3D)


",andrewrech,https://github.com/lima1/PureCN/issues/33
MDU6SXNzdWUzMjI4OTk3NzY=,Suggest allowing multiple samples in VCF file.,OPEN,2018-05-14T16:56:57Z,2018-05-15T01:50:39Z,,"Suggestion: add arg to specify normal sample ID also.  Then, allow the VCF file to contain more than two samples.  In my case with multiregional sequencing, the easiest way for me to make an appropriate VCF for PureCN is to make one that has all samples of a person, one normal and multiple tumor samples.  I would run PureCN once for each tumor sample, specifying the same VCF each time, the same normal sample ID, and a different tumor sample ID.
",tedtoal,https://github.com/lima1/PureCN/issues/34
MDU6SXNzdWUzMjQyODAzMDI=,preprocessIntervals failed,CLOSED,2018-05-18T05:59:51Z,2018-05-19T19:50:58Z,2018-05-19T19:50:58Z,"Hi 
I changed all chromosome name to that corresponding to b37, and build the tragte information with `preprocessIntervals` but encounter an error

```
> reference.file
  A DNAStringSet instance of length 86
         width seq                                          names
 [1] 249250621 NNNNNNNNNNNNNNNNNNNNN...NNNNNNNNNNNNNNNNNNNN 1 dna:chromosome ...
 [2] 243199373 NNNNNNNNNNNNNNNNNNNNN...NNNNNNNNNNNNNNNNNNNN 2 dna:chromosome ...
 [3] 198022430 NNNNNNNNNNNNNNNNNNNNN...NNNNNNNNNNNNNNNNNNNN 3 dna:chromosome ...
 [4] 191154276 NNNNNNNNNNNNNNNNNNNNN...NNNNNNNNNNNNNNNNNNNN 4 dna:chromosome ...
 [5] 180915260 NNNNNNNNNNNNNNNNNNNNN...NNNNNNNNNNNNNNNNNNNN 5 dna:chromosome ...
 ...       ... ...
[82]    191469 GATCCCTGCCCTAAAACTTTC...AGAAACACCCAAGAATGATC GL000194.1 dna:su...
[83]    211173 GAATTCTCACATGTCTCTGCA...AGAGTTTTGCTGGTGAATTC GL000225.1 dna:su...
[84]    547496 GAATTCATTCACCATTATTCT...TAGGTGCCTATCAGGAATTC GL000192.1 dna:su...
[85]    171823 AGAATTCGTCTTGCTCTATTC...TCGCCCTTATTGCCCTGTTT NC_007605
[86]  35477943 AAGAAACAGAACAAAACAACT...TGCTTTTCTGTTTTTCCCTG hs37d5
```

```
> intervals
GRanges object with 989595 ranges and 0 metadata columns:
             seqnames           ranges strand
                <Rle>        <IRanges>  <Rle>
       [1]          1   [14426, 14627]      *
       [2]          1   [14426, 14627]      *
       [3]          1   [14568, 14646]      *
       [4]          1   [14638, 14883]      *
       [5]          1   [14896, 14968]      *
       ...        ...              ...    ...
  [989591] GL000228.1 [103932, 104032]      *
  [989592] GL000228.1 [105686, 105805]      *
  [989593] GL000228.1 [107238, 107338]      *
  [989594] GL000228.1 [112298, 112417]      *
  [989595] GL000228.1 [113850, 113950]      *
  -------
  seqinfo: 27 sequences from an unspecified genome; no seqlengths
```

```
> mappability
GRanges object with 21591493 ranges and 1 metadata column:
             seqnames               ranges strand |        name
                <Rle>            <IRanges>  <Rle> | <character>
         [1]        1       [10001, 10014]      * |  0.00277778
         [2]        1       [10015, 10015]      * |    0.333333
         [3]        1       [10016, 10026]      * |         0.5
         [4]        1       [10027, 10031]      * |           1
         [5]        1       [10032, 10036]      * |         0.5
         ...      ...                  ...    ... .         ...
  [21591489]        Y [59363020, 59363314]      * |  0.00277778
  [21591490]        Y [59363315, 59363317]      * |    0.333333
  [21591491]        Y [59363318, 59363318]      * |        0.25
  [21591492]        Y [59363319, 59363320]      * |    0.333333
  [21591493]        Y [59363321, 59363517]      * |         0.5
  -------
  seqinfo: 24 sequences from an unspecified genome; no seqlengths
```

```
preprocessIntervals(intervals, reference.file, mappability=mappability, output.file = ""human_g1k_v37_decoy_gc_file.txt"")
```

I encounter the following error:
> WARN [2018-05-18 12:47:36] Found 2558162 overlapping intervals, starting at line 2.
> INFO [2018-05-18 12:47:50] Splitting 51059 large targets to an average width of 400.
> WARN [2018-05-18 13:26:59] 372106 intervals without mapping score.
> INFO [2018-05-18 13:26:59] Removing 372106 targets with low mappability score (<0.50).
> Error in `[[<-`(`*tmp*`, label, value = NA) :
>   1 elements in value to replace 0 elements
> In addition: There were 50 or more warnings (use warnings() to see the first 50)

> Warning messages:
> 1: In mean.default(X[[i]], ...) :
>   argument is not numeric or logical: returning NA
> 2: In mean.default(X[[i]], ...) :
>   argument is not numeric or logical: returning NA
> 3: In mean.default(X[[i]], ...) :
>   argument is not numeric or logical: returning NA
> 4: In mean.default(X[[i]], ...) :
>   argument is not numeric or logical: returning NA
> 5: In mean.default(X[[i]], ...) :
>   argument is not numeric or logical: returning NA

traceback()
> 6: stop(paste(lv, ""elements in value to replace"", nrx, ""elements""))
> 5: `[[<-`(`*tmp*`, label, value = NA)
> 4: `[[<-`(`*tmp*`, label, value = NA)
> 3: .addScoreToGr(interval.gr, reptiming, ""reptiming"")
> 2: .annotateIntervalsReptiming(interval.gr, reptiming)
> 1: preprocessIntervals(intervals, reference.file, mappability = mappability,
>        output.file = ""human_g1k_v37_decoy_gc_file.txt"")
",ycl6,https://github.com/lima1/PureCN/issues/35
MDU6SXNzdWUzMjc4MzQzNzI=,"Copy ratio raw and adjusted, table column documentation",OPEN,2018-05-30T17:48:42Z,2018-11-19T22:44:34Z,,"The segments, genes, and variants output files all contain columns with log2 coverage ratio values in them, unadjusted for purity and ploidy.  Here are several suggestions related to this:

1. Make the tables describing output file columns easier to find.  Have an entry in the table of contents for them, and perhaps put each one on a separate page.  And, make their titles refer to filename arguments to PureCN R program files, not to PureCN functions (which I think you are no longer recommending the user directly call; in fact, the entire document should be changed to reflect the recommended method of using the PureCN programs rather than internal functions).  
2. Make sure each time a ratio or copy number column appears, the description says whether or not it is adjusted for purity or ploidy (e.g. log.ratio column in variants file), and whether or not it has been rounded to an integer value.  For log ratio, always say log2 in the description.
3. Add a short section to the guide that gives the relationships between raw and adjusted copy number and copy ratio.  Use the equations from the paper you referred me to, Zack, Travis I., et al. ""Pan-cancer patterns of somatic copy number alteration."" Nature genetics 45.10 (2013): 1134, but look into my assertion that his equation for R'(x) is wrong according to his preceding equations.
4. Consider adding additional output file columns containing: (a) raw copy ratio (apply 2^ to log2 ratio); (b) adjusted copy ratio; (c) ploidy; (d) purity (c and d copied from the QC file).  If not, just make sure (3) above makes it clear to user what to do to transform the log2 ratio into an adjusted copy ratio.

",tedtoal,https://github.com/lima1/PureCN/issues/36
MDU6SXNzdWUzMzcwNDE1MzU=,PureCN.R Error,CLOSED,2018-06-29T15:25:49Z,2018-06-29T17:29:35Z,2018-06-29T17:29:35Z,"I'm trying to run PureCN.R after Coverage.R and I'm getting a cryptic error (see at the very bottom) that I can't debug. I notice there's a lot of warnings for low coverage but I'm not sure if this is what is causing the error. Any thoughts?

-todd


INFO [2018-06-29 11:17:15] Loading PureCN 1.11.10...
WARN [2018-06-29 11:17:34] Multiple chromosomes with very low coverage: 1,10,11,12,13,14,15,16,17,18,19,2,20,21,22,3,4,5,6,7,8,9,X,Y
INFO [2018-06-29 11:17:58] Mean coverages: chrX: 0.08, chrY: 0.05, chr1-22: 0.12.
INFO [2018-06-29 11:17:58] Sample sex: M
INFO [2018-06-29 11:18:06] ------------------------------------------------------------
INFO [2018-06-29 11:18:06] PureCN 1.11.10
INFO [2018-06-29 11:18:06] ------------------------------------------------------------
INFO [2018-06-29 11:18:06] Arguments: -tumor.coverage.file /ts18/ngs/studies/ngs_000261/bwa/G04971TB02_S24.sorted_pos.dedup.recal_coverage_loess.txt -seg.file  -vcf.file /ts18/ngs/studies/ngs_000261/bwa/G04971TB02_S24.mutect2_sel.dbsnp.vcf.gz -genome hg19 -sex ? -args.setMappingBiasVcf NULL -args.segmentation NULL,/Biomarker/sih/Databases/PureCN_data/NormalDB/b37/target_weights_SS_v6_b37.txt,0.005,NULL -sampleid G04971TB02_S24 -min.ploidy 1 -max.ploidy 6 -max.non.clonal 0.2 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /Biomarker/ngs/database/pureCN/b37/baits_b37_V6_intervals.txt -max.segments 300 -plot.cnv TRUE -DB.info.flag DB -model beta -post.optimize FALSE -BPPARAM  -log.file /ts18/ngs/studies/ngs_000261/bwa/G04971TB02_S24.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2018-06-29 11:18:06] Loading coverage files...
WARN [2018-06-29 11:18:15] Multiple chromosomes with very low coverage: 1,10,11,12,13,14,15,16,17,18,19,2,20,21,22,3,4,5,6,7,8,9,X,Y
INFO [2018-06-29 11:18:20] Mean target coverages: 0X (tumor) 0X (normal).
WARN [2018-06-29 11:18:20] Large difference in coverage of tumor and normal.
INFO [2018-06-29 11:18:23] Mean coverages: chrX: 0.08, chrY: 0.05, chr1-22: 0.12.
INFO [2018-06-29 11:18:25] Mean coverages: chrX: 0.00, chrY: 0.03, chr1-22: 0.00.
INFO [2018-06-29 11:19:10] Removing 232918 intervals with missing log.ratio.
INFO [2018-06-29 11:19:29] Removing 492 intervals excluded in normalDB.
INFO [2018-06-29 11:19:29] Removing 54020 intervals with low total coverage in normal (< 150.00 reads).
INFO [2018-06-29 11:19:29] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2018-06-29 11:19:29] Using 0 intervals (0 on-target, 0 off-target).
INFO [2018-06-29 11:19:29] No off-target intervals. If this is hybrid-capture data, consider adding them.
Error in sort(abs(diff(genomdat)))[1:n.keep] :
  only 0's may be mixed with negative subscripts
Calls: runAbsoluteCN -> smooth.CNA -> trimmed.variance
Execution halted",N/A,https://github.com/lima1/PureCN/issues/37
MDU6SXNzdWUzNDUxNDI3Mjc=,Pass explicit tab separator when reading CNVkit files,CLOSED,2018-07-27T08:48:11Z,2018-07-27T14:07:57Z,2018-07-27T14:07:57Z,"Some CNVkit files have missing data in the RepeatMasker column (in particular `cnn` files) when the data is not available for that position. 
PureCN uses `read.table` to load them, however it uses the default separator (`sep=""""`) which means that all whitespace is treated as separator. In case of these missing data, there is nothing in the column, so it ends up being as `\t\t`. This is processed by `read.table` as a single field, and thus parsing files (header has 9 fields, the collapsed field makes them 8 in that specific line).
Setting an explicit tab separator (which is what CNVkit outputs to, anyway) should fix this behavior.",lbeltrame,https://github.com/lima1/PureCN/issues/38
MDU6SXNzdWUzNDU2ODk1NzQ=,NormalDB.R has different requirements to its CLI despite what it is written in the documentation,CLOSED,2018-07-30T09:56:43Z,2019-03-24T19:26:38Z,2019-03-24T19:26:38Z,"The docs ( ""Quick.pdf"" from the current Bioconductor release) state:

> See the main vignette for more details and file formats.
> For a production pipeline run we provide again more information about the assay and genome.
> Here an CNVkit example (CNVkit runs without normal reference samples are not recom-
> mended):

```
# Provide a normal panel VCF to remove mapping biases, pre-compute
# position-specific bias for much faster runtimes with large panels
# This needs to be done only once for each assay
Rscript $PURECN/NormalDB.R --outdir $OUT_REF --normal_panel $NORMAL_PANEL \
--assay agilent_v6 --genome hg19 --force
```

But trying to do something similar:

```
Rscript /usr/lib64/R/library/PureCN/extdata/NormalDB.R --normal_panel normals.vcf.gz --assay agilent_oneseq --genome hg19 --outdir purecn
INFO [2018-07-30 11:47:58] Loading PureCN 1.10.0...
INFO [2018-07-30 11:48:11] Creating mapping bias database.
INFO [2018-07-30 11:48:14] Processing variants 1 to 5000...
INFO [2018-07-30 11:48:18] Processing variants 5001 to 10000...
INFO [2018-07-30 11:48:22] Processing variants 10001 to 15000...
INFO [2018-07-30 11:48:27] Processing variants 15001 to 20000...
INFO [2018-07-30 11:48:31] Processing variants 20001 to 25000...
INFO [2018-07-30 11:48:35] Processing variants 25001 to 30000...
INFO [2018-07-30 11:48:40] Processing variants 30001 to 35000...
INFO [2018-07-30 11:48:49] Processing variants 35001 to 40000...
INFO [2018-07-30 11:48:54] Processing variants 40001 to 45000...
INFO [2018-07-30 11:48:58] Processing variants 45001 to 50000...
INFO [2018-07-30 11:48:58] Position chr17:78934088
INFO [2018-07-30 11:49:02] Processing variants 50001 to 55000...
WARN [2018-07-30 11:49:05] No --coveragefiles provided. Cannot generate normal database.
```",lbeltrame,https://github.com/lima1/PureCN/issues/39
MDU6SXNzdWUzNTMxMDQwMjU=,Copy Ratio adjustments for purity/ploidy are incorrect,CLOSED,2018-08-22T20:06:00Z,2022-03-31T07:50:18Z,2019-03-24T19:26:07Z,"In some places in PureCN there are adjustments of copy ratio to account for purity and ploidy, or vice-versa, to take an adjusted value and return it to an unadjusted ""observed"" ratio value.  Marcus Riester gave the following reference for the method used to do this:

https://www.nature.com/articles/ng.2760 (section Impurity-corrected GISTIC)

The equations in that section contain an algebra mistake.  I'm concerned that PureCN might incorporate that mistake in one or more places.  I have verified that it uses the correct equation in at least two places.

Details:

The above reference shows this derivation:

```
  R(x) = (aq(x)+2(1-a))/D
  D = aT + 2(1-a)
  q(x) = DR(x)/a - 2(1-a)/a
  R'(x) = q(x)/T = R(x)/a - 2(1-a)/aT
```

where:

```
  R(x) = raw (observed) coverage ratio (PureCN's seg.mean, gene.mean, etc.)
  R'(x) = adjusted coverage ratio (in tumor cells)
  q(x) = integer copy number in cancer cells
  D = average ploidy across all cells of tumor (of sample)
  a = sample purity
  T = tumor ploidy
```

However, in the last step where q(x) is substituted in q(x)/T, the algebra is wrong.  The correct algebra is:

```
R'(x) = q(x)/T = DR(x)/aT - 2(1-a)/aT = (aT + 2(1-a))R(x)/aT - 2(1-a)/aT
      = R(x) + 2(1-a)R(x)/aT - 2(1-a)/aT
      = [aTR(x) + 2(1-a)R(x) - 2(1-a)]/aT
```

As a test, say that purity=a=0.5, tumor ploidy=T=2, and raw coverage ratio=1.5. Then we expect the adjusted coverage ratio to be 2 (tumor segment is 2X amplify (4 copies) and this becomes raw ratio of 1.5 when purity is 1/2 [0.5*4 + 0.5*2] / 2 = 1.5):

```
Paper:     R'(x) = 1.5/0.5 - 2(0.5)/(0.5 * 2) = 3 - 2(0.5) = 2 (correct)
Corrected: R'(x) = [0.5*2*1.5 + 2(0.5)1.5 - 2(0.5)] / (0.5*2) = 1.5 + 1.5 - 1 = 2 (correct)
```

But now suppose that tumor ploidy=T=4, and we still have purity=a=0.5.  Say raw coverage ratio=1.0, meaning there is no tumor amplification and the number of copies at any locus is the same as the mean number of copies, in both the 2X normal and 4X tumor tissue.  We expect the adjusted coverage ratio to also be 1:

```
Paper:     R'(x) = 1/0.5 - 2(0.5)/(0.5 * 4) = 2 - 2(0.5)/2 = 2 - 1/2 = 1.5 (wrong)
Corrected: R'(x) = [0.5*4*1 + 2(0.5)1 - 2(0.5)] / (0.5 * 4) = [2 + 1 - 1] / 2 = 2 / 2 = 1 (correct)
```

Marcus Riester indicated PureCN uses the following:

```
    rds <- readRDS(""Sampleid.rds"")
    r <- rds$results[[1]]
    r$seg$seg.mean.adjusted <- r$seg$seg.mean/r$purity - 2*(1-r$purity)/(r$purity*r$ploidy)
```

The above equation matches the incorrect one in the paper, so PureCN must be wrong wherever the above appears in the PureCN code, although I haven't found where that is (but I didn't search exhaustively).

The PureCN function .calcExpectedRatio() does the inverse operation, computing R(x) from R'(x), and it is using the correct equation.

PureCN function runAbsoluteCN() has this line:

```
    opt.C <- (2^(seg$seg.mean + log.ratio.offset) *  total.ploidy)/p - ((2 * (1 - p))/p)
```

and since tumor copy number C = tumor coverage ratio * tumor ploidy, this equation at first appears to be the paper's (incorrect) R'(x) * ploidy.  However, ""total.ploidy"" is probably the ploidy in the sample as a whole, which corresponds to the paper's ""D"", and in that case, the above equation is correct.  The algebra error only creeps in in the last derivation, R'(x) = ...

In summary, my concerns are (1) the above equation for seg.mean.adjusted (I don't know where in the code that is); (2) Could there be other places in PureCN where the algebra bug crept in?
",tedtoal,https://github.com/lima1/PureCN/issues/40
MDU6SXNzdWUzNTYxNjAwODk=,PureCN.R --rds option no change in output files,CLOSED,2018-09-01T01:24:39Z,2018-10-01T14:35:56Z,2018-10-01T14:35:56Z,"After running PureCN.R once on a sample, I edited the .csv file that holds the purity/ploidy and Curated flag, and changed the purity and ploidy to a different PureCN solution than the maximum-likelihood solution, and set the Curated flag TRUE.  I used readCurationFile() to read the .rds file so that it would reorder the solutions (but I did not save the new rds object, maybe that's the problem).  Then I moved all PureCN output files except the .rds and curation .csv files to another location and reran PureCN.R, this time specifying the --rds option.  PureCN.R regenerated all the output files.  However, when I compared them to the original files, they were identical (except the curation .csv file was left untouched and still had the curated values in it).

Is this expected???  I expected that some values in some of the output .csv files would be a function of the selected solution's purity and ploidy, and that some plots in the .pdf files would be based on the selected solution's purity and ploidy.  For example, the _segmentation.pdf file I expected to be different, but it wasn't.
",tedtoal,https://github.com/lima1/PureCN/issues/41
MDU6SXNzdWUzNjc3NDYzNjM=,VCF output is not generated,CLOSED,2018-10-08T11:27:51Z,2018-10-10T12:53:51Z,2018-10-10T12:53:51Z,"Hello,

I ran PureCN 1.10 with `--outvcf` parameter but it did not generate any VCF files. I want to know which somatic variants are clonal or subclonal. Here is the script that I use to construct the running command:

> Rscript --vanilla /scratch/users/berguener/bin/PureCN/inst/extdata/PureCN.R \
> 	--out $SAMPLE_NAME \
> 	--tumor ""${SAMPLE_NAME}_realigned_coverage_loess.txt"" \
> 	--sampleid $SAMPLE_NAME \
> 	--vcf mutect1/$SAMPLE_NAME.vcf \
> 	--statsfile mutect1/$SAMPLE_NAME.mutect \
> 	--normaldb ref_bam/purecn_coverage/normalDB_TruSeq_b37.rds \
> 	--normal_panel ref_bam/purecn_coverage/mapping_bias_TruSeq_b37.rds \
> 	--intervals TruSeq_Exome_targeted_regions_b37_intervals_annotated.txt \
> 	--targetweightfile ref_bam/purecn_coverage/target_weights_TruSeq_b37.txt \
> 	--outvcf ""${SAMPLE_NAME}_purecn.vcf"" \
> 	--minpurity 0.75 \
> 	--genome b37 --force --postoptimize --seed 123

Can you please check. 
Best, bekir",berguner,https://github.com/lima1/PureCN/issues/43
MDU6SXNzdWUzNjk1MzkzODM=,BAF segmentation,CLOSED,2018-10-12T12:55:29Z,2018-11-03T17:04:01Z,2018-10-16T14:20:48Z,"Hello,

I am observing erroneous segmentation on the BAF plots. Some of the segments also don't seem to align well with the average BAF values. Is BAF segmentation performed independently from the log2 coverage ratios?

Please see the attached image as an example case. In this image you can also see 2 cnLOH events were missed by the segmentation.

Best,
Bekir
![purecn_baf_segmentation](https://user-images.githubusercontent.com/23213155/46870364-b24cdf80-ce2e-11e8-8801-2b8318e3f34c.PNG)
",berguner,https://github.com/lima1/PureCN/issues/44
MDU6SXNzdWUzNzA1NzY5Nzk=,Overlapping reads,CLOSED,2018-10-16T12:00:20Z,2019-03-24T19:25:09Z,2019-03-24T19:25:09Z,"Thank you for this very well designed and tested software, it is greatly appreciated.

I have a question about PureCN's function for calculating coverage in a bam file - does this function count the overlapping ends of a paired read twice? In FFPE samples, the fragments are often short so the ends of the read overlap.
Reading the source code I can't tell if the coverage function takes this into account or not.
GATK3 DepthOfCoverage apparently does not count overlapping reads twice.

",cloudbroken,https://github.com/lima1/PureCN/issues/45
MDU6SXNzdWUzNzIxMTM3MDM=,Split Simulated Annealing and SNV fit steps,CLOSED,2018-10-19T20:57:57Z,2018-11-04T04:00:00Z,2018-11-04T04:00:00Z,"Right now, for every local optimum, we first do the SA step and then fit variants.

Often multiple local optima converge, so we might fit variants unnecessarily multiple times.

Splitting also benefits the parallel processing since there is then slightly less runtime difference between optima.",lima1,https://github.com/lima1/PureCN/issues/46
MDU6SXNzdWUzNzI3NTQzMTc=,calculateMappingBiasVcf with pool of normals containing duplicate samples,CLOSED,2018-10-23T00:34:46Z,2018-10-25T16:29:47Z,2018-10-25T16:29:47Z,"Dear Markus,

I have a pool of processed matched normals that I am including in a workflow where there are no tumour-normal pairs. Some of these normals are the same sample sequenced in different batches.

My question is - if I am including duplicate samples in the normal panel vcf, should I alter the parameters of  calculateMappingBiasVcf?

Thank you.",cloudbroken,https://github.com/lima1/PureCN/issues/47
MDU6SXNzdWUzNzQxMTEwMTY=,CNV burden and duplication homologous chromosomes,CLOSED,2018-10-25T20:07:04Z,2019-03-24T19:27:06Z,2019-03-24T19:27:06Z,"I want to calculate CNV burden, which is fraction of genome containing a CNV.  However, I realized that in some cases a CNV segment might be present on two homologous chromosomes, so its length would need to be counted twice.  

For example, if  region 10-30 Mbp of one copy of chr1 is duplicated, and region 20-40 Mbp of the OTHER copy of chr1 is duplicated, I presume PureCN would produce 3 CNV segments:

1. 10-20 Mbp at copy number = 3
2. 20-30 Mbp at copy number = 4
3. 30-40 Mbp at copy number = 3

Is there any output from PureCN that would let me distinguish whether a segment is a CNV on both homologous chromosomes?  I would think the germline het SNPs in the region could help distinguish this, although you are already pushing those to find purity and ploidy.  Still, once a purity/ploidy solution is obtained, it should be possible to do this.  Or maybe this is already done?

And of course, clones in the sample further mess with this.
",tedtoal,https://github.com/lima1/PureCN/issues/48
MDU6SXNzdWUzNzQ2OTAyNzM=,Whitelist for homozygous deletions,OPEN,2018-10-27T21:22:29Z,2019-08-11T04:41:57Z,,"The current cutoff for homozygous deletions is large because we rarely see such huge deletions at MTAP/CDKN2A. Might be better to decrease the default and add a whitelist of known deletions.

- [ ] Query TCGA for most common deletions.

- [ ] Provide whitelist for hg19/hg38

- [ ] Use size distribution of whitelist for finding good size cutoffs, understand how SNP6 cutoffs translate to small targets with 150-200kb off-target bins.

- [ ] Do not count known deletions to max.homozygous.loss cutoffs.
",lima1,https://github.com/lima1/PureCN/issues/50
MDU6SXNzdWUzNzQ2OTE1NDY=,Cleanup setPriorVcf,OPEN,2018-10-27T21:39:17Z,2019-08-11T04:41:58Z,,"setPriorVcf grew organically and cutoffs are ad hoc and might not work well for all combinations of germline and somatic databases and their corresponding versions.

- [ ] Use population allele frequencies, PoN counts and COSMIC counts jointly when available (e.g. cases with high allele frequencies are wrongly set to a prior of 0.5 when found in COSMIC with >= 6 counts, despite being also found in the PoN).
 ",lima1,https://github.com/lima1/PureCN/issues/51
MDU6SXNzdWUzNzQ3ODQ3OTg=,Tri-allelic sites in calculateMappingBiasVcf not handled correctly,OPEN,2018-10-28T18:41:46Z,2020-01-09T19:55:18Z,,Tri-allelic sites may be ignored in calculateMappingBiasVcf. This results in a pon.count of 0 and the default mapping bias prior.,lima1,https://github.com/lima1/PureCN/issues/52
MDU6SXNzdWUzNzQ4MzQwMTk=,Using CNVkit files ,CLOSED,2018-10-29T02:28:24Z,2018-12-08T17:01:40Z,2018-12-08T17:01:40Z,"Hi there,

I was trying to run pureCN by using CNVkit segmentation, but I got the following error.
`Error in .Call2(""solve_user_SEW0"", start, end, width, PACKAGE = ""IRanges"") : 
  solving row 9: negative widths are not allowed
Calls: runAbsoluteCN ... GRanges -> new_GRanges -> IRanges -> solveUserSEW0 -> .Call2
Execution halted`

Do you have any inside which file is causing the problem here?

Here is the command I ran.
`$PURECN/PureCN.R --out $output_dir/HCC1143_pureCN/ --sampleid HCC1143 --segfile HCC1143.cnvkit.seg --vcf HCC1143.mutect_1.1.4.vcf --intervals $PURECN/reference_files/baits_hg19_intervals.txt --genome hg19`

Secondly, in the Quick Start page 6, I should include a normal panel VCF in generate a normal DB specific to the assay.  We routinely run GATK3 Haplotypecaller for normal samples.  Is it sufficient to concatenate all the variants from normal samples into one VCF or do I need to remove the duplicated variants?

Lately,  I was trying to run PureCN for coverage analysis, but it couldn't go any further due to X11 display problem when it was generate the png file.  Is it possible to run the coverage analysis without X11 display connection?

Thanks,
Yisu
",yisu-li,https://github.com/lima1/PureCN/issues/53
MDU6SXNzdWUzNzU4MDE1ODU=,Tumor and normal are identical,CLOSED,2018-10-31T05:12:31Z,2018-12-12T15:15:32Z,2018-12-12T15:15:31Z,"Hi,
    When i run the runAbsoluteCN command, the error which is ""
INFO [2018-10-31 13:04:08] Loading coverage files...
WARN [2018-10-31 13:04:08] Found 80 overlapping intervals, starting at line 923.
WARN [2018-10-31 13:04:08] Found 80 overlapping intervals, starting at line 923.
FATAL [2018-10-31 13:04:08] Tumor and normal are identical. This won't give any meaningful results 

FATAL [2018-10-31 13:04:08] and I'm stopping here. 

FATAL [2018-10-31 13:04:08]  

FATAL [2018-10-31 13:04:08] This is most likely a user error due to invalid input data or 

FATAL [2018-10-31 13:04:08] parameters (PureCN 1.10.0). 

Error: Tumor and normal are identical. This won't give any meaningful results 
and I'm stopping here. 
 
This is most likely a user error due to invalid input data or 
parameters (PureCN 1.10.0).
""
 arises.  I don't understand what is identical in detail for tumor and normal.
",WortJohn,https://github.com/lima1/PureCN/issues/54
MDU6SXNzdWUzNzkxNzc4MDE=,BiocParallel error in Coverage.R,CLOSED,2018-11-09T14:14:36Z,2018-11-09T17:38:59Z,2018-11-09T17:38:59Z,"Latest version of BiocParallel does not work with Coverage.R

Error in if (!is.na(bpresultdir(BPPARAM))) BatchJobs:::checkDir(bpresultdir(BPPARAM)) :
  argument is of length zero
Calls: getCoverageBams -> unlist -> bplapply -> bplapply

",lima1,https://github.com/lima1/PureCN/issues/55
MDU6SXNzdWUzNzk4OTU5Mjg=,Support for multiple biopsies in predictSomatic,OPEN,2018-11-12T18:15:23Z,2019-08-11T04:41:58Z,,"It's becoming more common to have multiple biopsies from the same patient available. Together with join segmentation in processMultipleSamples, it would be nice to also support multiple biopsies in predictSomatic. ",lima1,https://github.com/lima1/PureCN/issues/56
MDU6SXNzdWUzODIzNjA1Njk=,"Accuracy of LOH ""WHOLE ARM"" annotation",CLOSED,2018-11-19T19:29:45Z,2023-05-02T01:07:47Z,2023-05-02T01:07:47Z,"The LOH output data (from callLOH) seems to say that a segment is WHOLE ARM when it is nowhere near such.  For example:

chr18 12678487 15460899   p 2 0 WHOLE ARM COPY-NEUTRAL LOH

In this case, chr18 has a length of 80 Mbp with a p arm of 15 Mbp and a q arm of 60 Mbp, allowing 5 Mbp for the centromere region.  This segment is in the p arm, as annotated, and its length is under 3 Mbp, so it spans about 18% of the p arm.  So why is it called WHOLE ARM COPY-NEUTRAL LOH?  I checked and there are no other segments called on that arm.
",tedtoal,https://github.com/lima1/PureCN/issues/57
MDU6SXNzdWUzODIzNzk4NjI=,Purity reliability and the FLAGGED flag,CLOSED,2018-11-19T20:26:18Z,2018-12-08T17:00:49Z,2018-12-08T17:00:49Z,"My samples have rather low purity, because these are gastric cancer tumors and it is typical for the tumor to be diffuse.  Consequently, PureCN makes a lot of calls of purity = 0.15, and many of my samples are FLAGGED (although even those with much higher purity are flagged, not sure why).  Not a single one of the samples is marked FAILED, but I believe you said somewhere in the manual that that flag is for use during manual curation.

Despite the FLAGGED samples, it appears that the CNV results are good for most of them.  However, for some it looks like maybe not.  I have one sample that looks very maginal, and it was called as purity 0.15.  I looked at it in my own experimental algorithm to call copy number and purity, and I see that I kicked it out because it had some problem, probably too few SNVs.

I have two questions.  First, do you think I might be able to lower the lowest purity threshold for PureCN and get better purity estimates for some samples?  Second, is there some way I could get out of PureCN an estimate of how reliable it thinks its purity call is?
",tedtoal,https://github.com/lima1/PureCN/issues/58
MDU6SXNzdWUzODIzODIxODY=,Germline CNV,CLOSED,2018-11-19T20:33:37Z,2019-03-24T18:56:33Z,2019-03-24T18:56:33Z,"I previously asked if PureCN could be used to call CNV in a germline sample, and you suggested use of a different caller, but if I wanted to try PureCN anyway, to be sure to remove the sample from the pool of normals.  Doing this would require that I make a separate pool of normals for testing each normal sample.  Is it really necessary?  Shouldn't the large number of samples in the pool (33 in my case) make the contribution of any one sample fairly small, and its CNVs have a minimal impact?

Further, I would think a good enhancement to PureCN would be for it to use the pool of normals to try to estimate CNV in each normal, which would then provide a BETTER pool of normals for calling CNV in tumor samples.
",tedtoal,https://github.com/lima1/PureCN/issues/59
MDU6SXNzdWUzODIzOTE0NTE=,Multi-sample CNV segmentation and events,CLOSED,2018-11-19T21:02:18Z,2018-12-08T16:59:54Z,2018-12-08T16:59:54Z,"I'm working with multiple samples per person, and want to identify CNV events in common between samples.  I started by just trying to identify CNV segment calls that were in common.  One problem with that is that the segment boundaries might be close but not identical, and I'd really like to use multi-sample segmentation to align boundaries between samples.  However, it is not so easy to do that even though PureCN provides for external segmentation, because I essentially need to run the first part of PureCN on all the samples, then run the multi-sample segmentation, then run the last part of PureCN.  It would be nice if PureCN.R could be broken up into more individual steps so that that would be possible.  I ended up simply adjusting the position of segment edges when they were closer than some distance (I used 500 Kbp) to the midpoint between the two.  Not ideal but I think not too bad of a compromise.

Also, I decided that CNV segments are not good representations of CNV events.  For example, two events, one in the middle of the other, would create 3 segments.  I tried finding software that could analyze PureCN segment calls and produce CNV event calls, but I found nothing.  Then I had an idea that I believe is reasonably sound, but want to run it past you to see if you see any big problems with it.  The idea is that generally one would not expect the edges of two separate CNV events to align, or at least not often.  So, each edge of a CNV segment could be taken as one CNV event, which might overcount CNV events by a factor of 2, but I think that is less of a problem than trying to untangle common CNV segments between samples when other CNV events might intervene in some of those samples.

In addition, I wanted to do a statistical test of the markers on each side of each segment edge, in EACH SAMPLE whether or not a segment edge was called at that position.  So, I took all PureCN markers on each side of each segment edge, up to either the segment boundary on the other side, or 5 Mbp, whichever was smaller, adjusted their copy ratios for purity and ploidy, then tested the two sets of copy ratios for a difference in means greater than 0.1.  I was hoping for a clear separation of each sample into YES edge is present or NO edge is not present, but it seems that there are a lot of cases where the p-value for edge present is not all that small but is small enough to not allow me to say the edge is not present.  This might be because of subclonal presence of the CNV at a small frequency in the samples where it seems to be not present.  I'm working now on examining results of this.  Do you see any big problems with this method?  If the method is reasonable, it would be nice if PureCN had an ""edge"" output, with p-values.

",tedtoal,https://github.com/lima1/PureCN/issues/60
MDU6SXNzdWUzODI4NDE1MzM=,Suggestion for chromosome arm output,CLOSED,2018-11-20T20:46:00Z,2018-12-17T21:11:05Z,2018-12-17T21:11:05Z,"Suggestion: provide output that gives the estimated copy ratio (and minor allele copy number?) for each chromosome arm, whether or not it is detected to vary from the normal.
",tedtoal,https://github.com/lima1/PureCN/issues/61
MDU6SXNzdWUzODgzMjk5NjA=,Support for haplotypecaller-created VCF,CLOSED,2018-12-06T17:59:09Z,2020-07-19T18:33:28Z,2020-07-19T18:33:28Z,"Hi,

I've generated .vcfs for copy number calling from Haplotypecaller, supplying it with normal and a tumour .bams, and running it in genotype mode with the variants from the 1000genome project. Currently this isn't being accepted by PureCN as a valid .vcf (it may not be detecting the tumour sample - defining it by sampleID does not seem to work?), is there any scope to include this? I have found that the germline variant calls produced in this manner (assuming standard filters such as minimum depth etc etc) look ideal for copy number calling.

For clarity, the command used to generate this was: 

```
$java -Xmx4g -jar $gatk4 \
HaplotypeCaller \
-R $assembly \
-I $bamDataDir/$SampleName.tumour.recalibrated.bam \
-I $bamDataDir/$SampleName.normal.recalibrated.bam \
-L $target_intervals \
-ip 200 \
--dbsnp $known_snp \
--alleles $known_snp_hc \
--genotyping-mode GENOTYPE_GIVEN_ALLELES \
-O $gatkDir/VCF/Germline_Calls/Initial/$SampleName.genotyped1000G_bothTN.vcf.gz
```

I've attached an example .vcf (trimmed down substantially)
[example_vcf_trimmed.genotyped1000G_bothTN.vcf.gz](https://github.com/lima1/PureCN/files/2654245/example_vcf_trimmed.genotyped1000G_bothTN.vcf.gz)

My pureCN run was as follows:

```
runAbsoluteCN(tumor.coverage.file  = ""cnvkit_output/example_pattumour.recalibrated.cnr"",
              seg.file = ""cnvkit_output/example_pat.tumour.recalibrated.seg"",
              vcf.file = ""gatk_output/HaplotypeCaller/example_pat.genotyped1000G_bothTN.vcf.gz"",
              genome = ""hg38"",sex = ""M"",
              sampleid = ""example_pat.tumour"",
              args.filterVcf =  list(""tumor.id.in.vcf"" = ""example_pat.tumour""),
              args.segmentation =  list(""tumor.id.in.vcf"" = ""example_pat.tumour"")) 
```

All help gladly appreciated. 
",seedgeorge,https://github.com/lima1/PureCN/issues/62
MDU6SXNzdWUzODkwNDY0MTA=,Crash in GC-normalization with single bp intervals,CLOSED,2018-12-09T17:48:31Z,2018-12-12T15:14:05Z,2018-12-12T15:14:05Z,"2018-12-05T19:21:49.058346007Z Error in predLoess(object$y, object$x, newx = if (is.null(newdata)) object$x else if (is.data.frame(newdata)) as.matrix(model.frame(delete.response(terms(object)),  : 
2018-12-05T19:21:49.058371319Z   NA/NaN/Inf in foreign function call (arg 5)
2018-12-05T19:21:49.058375557Z Calls: .gcNormalize ... eval -> eval -> predict -> predict.loess -> predLoess
",lima1,https://github.com/lima1/PureCN/issues/63
MDU6SXNzdWUzOTAwMzY1MDM=,Missing dependency on optparse,CLOSED,2018-12-12T02:19:35Z,2023-08-16T15:31:02Z,2018-12-12T02:54:01Z,"PureCN has a dependency on optparse which is unstated:

```
$ Rscript PureCN.R
Error in library(optparse) : there is no package called ‘optparse’
```",jbedo,https://github.com/lima1/PureCN/issues/64
MDU6SXNzdWUzOTUwMjUzMDg=,Rescale copy number with provided purity/ploidy,CLOSED,2018-12-31T19:56:06Z,2019-10-02T23:45:35Z,2019-10-02T23:45:35Z,"In cfDNA, samples with purity of 5%-10% are currently not treated optimally. While <10% we cannot infer ploidy reliably anymore, we might be able to call more amplifications. There should be  a way to rescale C in at least the gene-level output. 

Probably requires some refactoring like moving the findFocal function from runAbsoluteCN to callAlterations.",lima1,https://github.com/lima1/PureCN/issues/65
MDU6SXNzdWUzOTYwNzkzMDc=,Add cell fraction confidence intervals,CLOSED,2019-01-04T21:49:31Z,2019-02-03T20:20:35Z,2019-02-03T20:20:35Z,"Some downstream tools need it and in low purity, some users might not be aware of the (expected) poor quality of the estimates.",lima1,https://github.com/lima1/PureCN/issues/66
MDU6SXNzdWU0MDUxMDUxMDg=,Mutect2 out of beta verison,CLOSED,2019-01-31T06:49:30Z,2020-05-26T16:19:44Z,2019-03-24T23:28:08Z,"The new release of GATK 4.1.0.0 comes, also, the mutect2 is out of beta version.  I think we should integrate the mutect2 result with purecn more better now.",xiucz,https://github.com/lima1/PureCN/issues/67
MDU6SXNzdWU0MDg1ODQ2MTE=,Search for POP_AF and POPAF,CLOSED,2019-02-10T21:52:55Z,2019-03-22T20:43:46Z,2019-03-22T20:43:45Z,"POPAF in Mutect2, I will PR this",andrewrech,https://github.com/lima1/PureCN/issues/68
MDU6SXNzdWU0MTEwNzgwMzU=,Flag segments when interval weights are low,OPEN,2019-02-16T14:32:52Z,2019-08-18T01:27:43Z,,"When a segment contains mostly intervals with high variance in the PoN, it should be flagged.

- [x] Flag in results$seg

- [x] Flag in callAlterations

- [ ] Flag in predictSomatic",lima1,https://github.com/lima1/PureCN/issues/72
MDU6SXNzdWU0MTI1NDg2OTc=,Error in correctCoverageBias,CLOSED,2019-02-20T17:41:58Z,2019-11-18T15:24:45Z,2019-11-18T15:24:45Z,"Hi,

I'm getting this error (see below) when running the `correctCoverageBias` function. I tried modifying the correctCoverageBias.R source code in line [257](https://github.com/lima1/PureCN/blob/master/R/correctCoverageBias.R#L257) (in the internal function `.correctCoverageBiasLoess`, where the 'rough' loess prediction is carried out) to increase the span (from 0.03 to 0.10 for example) as the error message suggests and this fixes the issue.

Is this span something that the user should be able to modify through an argument of `correctCoverageBias`? 

I got the same results with both the Bioc release and Github master versions of PureCN.

```
Error in predLoess(object$y, object$x, newx = if (is.null(newdata)) object$x else if (is.data.frame(newdata)) as.matrix(model.frame(delete.response(terms(object)),  : 
  NA/NaN/Inf in foreign function call (arg 5)
In addition: Warning messages:
1: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  zero-width neighborhood. make span bigger
2: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  zero-width neighborhood. make span bigger
3: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  pseudoinverse used at 0.39735
4: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  neighborhood radius 8.4904e-05
5: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  reciprocal condition number  0
6: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  zero-width neighborhood. make span bigger
7: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  zero-width neighborhood. make span bigger
8: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  zero-width neighborhood. make span bigger
9: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  There are other near singularities as well. 4.8025e-09
```

Best,
Keegan",kdkorthauer,https://github.com/lima1/PureCN/issues/73
MDU6SXNzdWU0MTUzNjIzODU=,Error in runAbsoluteCN: ploidy NA,CLOSED,2019-02-27T22:45:30Z,2019-03-01T20:12:51Z,2019-03-01T01:33:30Z,"Hi Markus,

I'm getting the following error running `runAbsoluteCN` (only including seemingly relevant output): 

```
INFO [2019-02-27 17:22:08] Testing local optimum 8/8 at purity 0.21 and total ploidy 2.00...
FATAL [2019-02-27 17:22:16] Could not calculate copy number log-likelihood for purity NA and total 

FATAL [2019-02-27 17:22:16] ploidy NA. 

FATAL [2019-02-27 17:22:16]  

FATAL [2019-02-27 17:22:16] This runtime error might be caused by invalid input data or parameters. 

FATAL [2019-02-27 17:22:16] Please report bug (PureCN 1.13.19). 

Error: Could not calculate copy number log-likelihood for purity NA and total 
ploidy NA. 
 
This runtime error might be caused by invalid input data or parameters. 
Please report bug (PureCN 1.13.19). 
In addition: Warning messages:
1: In max(px.rij.s) : no non-missing arguments to max; returning -Inf
2: In min(which(runif(n = 1, min = 0, max = sum(px.rij.s)) <= cumsum(px.rij.s))) :
  no non-missing arguments to min; returning Inf
Execution halted
```
Any ideas why this might be? Happy to give more details about the files/parameters I'm using that throw the error if needed.

Best,
Keegan",kdkorthauer,https://github.com/lima1/PureCN/issues/74
MDU6SXNzdWU0MjQ0NjgzMzM=,recommendations for matched vs unmatched tumors ,CLOSED,2019-03-23T06:12:04Z,2019-03-24T17:35:04Z,2019-03-24T17:35:04Z,"I have a set of samples, where majority (~40) samples are paired, however, another ~7 are unmatched. As of now, I was thinking of using `FACETS` for matched tumors and `pureCN` for unmatched. However, would ideally like all samples to be processed as consistently as possible. 

I see you have a matched normal mode mentioned in the vignette, but it is highlighted as test case only.

Thanks!",sahilseth,https://github.com/lima1/PureCN/issues/75
MDU6SXNzdWU0MjYxNzk4ODU=,Add support for all species with annotation data in Bioconductor,OPEN,2019-03-27T20:56:47Z,2020-08-11T03:43:23Z,,,lima1,https://github.com/lima1/PureCN/issues/76
MDU6SXNzdWU0Mjk4MTQ0NzI=,Implement pseudo-tangent normalization,OPEN,2019-04-05T15:30:41Z,2019-09-28T14:48:47Z,,"This might be an improvement for difficult FFPE samples, besides the obvious advantage for small PoNs:
https://www.biorxiv.org/content/10.1101/566505v1
",lima1,https://github.com/lima1/PureCN/issues/77
MDU6SXNzdWU0Mjk4MTU5NjI=,Implement test for allelic-imbalance,CLOSED,2019-04-05T15:33:55Z,2019-08-18T01:25:32Z,2019-08-18T01:25:32Z,"Other tools like ASCAT do this. Has the advantage of marking sub-clonal losses with more confidence. Should improve performance, especially in high purity.

By requiring a mapping bias database, this should be fairly trivial to implement.",lima1,https://github.com/lima1/PureCN/issues/78
MDU6SXNzdWU0MzY5MDg5MjY=,Mutect2 VCF error,CLOSED,2019-04-24T21:10:37Z,2020-05-26T16:19:30Z,2019-06-07T15:21:27Z,"Hi,  Markus and PureCN devs!  Could use some help getting around a new bug.

So I'm trying to run PureCN for a tumor sample without a matched normal.  My VCF comes from Mutect2 and I am using a process-matched normal coverage database 'agilent_capture_kit.rds '  generated by PureCN, as well as 'baits_hg38_intervals.txt' also generated by PureCN.

Here's the command I am running, derived from the quick-start tutorial:

```
# Without a matched normal (minimal test run)
Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID \
--tumor $OUT_REF/${SAMPLEID}_tumor-ready_coverage_loess.txt \
--sampleid $SAMPLEID \
--vcf '/data/${SAMPLEID}_tumor/${SAMPLEID}_tumor-mutect2.vcf.gz' \
--normaldb $OUT_REF/agilent_capture_kit.rds \
--intervals $OUT_REF/baits_hg38_intervals.txt \
--genome hg38
```

And here's the error message:

```INFO [2019-04-24 19:07:09] Removing 101587 variants with AF < 0.030 or AF >= 0.970 or less than 3 supporting reads or depth < 15.
Error in which(as.numeric(geno(vcf)$MBQ[, tumor.id.in.vcf]) >= min.base.quality) : 
  (list) object cannot be coerced to type 'double'
Calls: runAbsoluteCN ... filterVcfMuTect2 -> filterVcfBasic -> .filterVcfByBQ -> which
In addition: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Execution halted
```

I appreciate any help!",TylerMclaughlin,https://github.com/lima1/PureCN/issues/79
MDU6SXNzdWU0NDE0NzY4Njg=,"Dx.R error ""Error: subscript contains out-of-bounds indices""",CLOSED,2019-05-07T22:44:45Z,2019-08-28T14:16:59Z,2019-06-28T18:04:42Z,"In PureCN V1.13.21 I get this error from Dx.R:

```Error: subscript contains out-of-bounds indices```

I traced it to function callMutationBurden(), where there are two statements:

```
p <- p[overlapsAny(p, callable)]
and
vcf <- vcf[overlapsAny(vcf, p)]
```

The length of p after above is one less than the length of vcf, and this leads to the error with this statement:

```
p <- p[which(fun.countMutation(vcf))]
```

I believe the error may be caused by the fact that the BED file I provide Dx.R is a SUBSET of the BED file I provided IntervalFile.R, which I presume is allowable (I only want the mutation burden computed on a subset of the regions).  The one locus which is different between vcf and p above is located at the position given by the start column of one row of the Dx.R BED file, so it should be excluded since adding 1 to 0-based start puts it out of range.  And it IS excluded, p doesn't have it, but vcf does have it.  It seems like vcf should also be intersected with ""callable"".

",tedtoal,https://github.com/lima1/PureCN/issues/82
MDU6SXNzdWU0NDQyMjAyMzQ=,could not load data for PreprocessIntervals function,CLOSED,2019-05-15T03:34:16Z,2019-05-17T02:45:37Z,2019-05-17T02:45:37Z,"When I tried to use PreprocessIntervals function as described in the vignette page 4, it uses an 'import' function to import a  bed file and a mappbility file, I assume the import function comes form the package 'rio' but it does not do the job, can you specify where does this import function come from?

```
intervals <- import(bed.file)
mappability <- import(mappability.file)
```
While the R inbuilt function 'read.table' can load the bed file, when running PreprocessIntervals function like this,

`preprocessIntervals(intervals, reference.file)`

it throws out an error message:

`Error in file_ext(file) : could not find function ""file_ext""`

Can you specify where to find this 'file_ext' function?
",nishuai,https://github.com/lima1/PureCN/issues/83
MDU6SXNzdWU0NDUzMTM1MTM=,long flag *** is invalid,CLOSED,2019-05-17T07:57:43Z,2019-05-25T15:16:14Z,2019-05-25T15:16:14Z,"Hi Markus,

When I tried the Coverage.R function form the terminal I got this error message, both with my own files or with the provided example files, 

```
$Rscript Coverage.R --outdir mydir/ --bam ex1.bam --intervals ex1_intervals.txt
Error in getopt(spec) : long flag ""intervals"" is invalid
```
Below is my sessionInfo if it helps.

```
> sessionInfo()
R version 3.4.4 (2018-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.5 LTS

Matrix products: default
BLAS: /usr/lib/libblas/libblas.so.3.6.0
LAPACK: /usr/lib/lapack/liblapack.so.3.6.0

locale:
 [1] LC_CTYPE=zh_CN.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=zh_CN.UTF-8        LC_COLLATE=zh_CN.UTF-8
 [5] LC_MONETARY=zh_CN.UTF-8    LC_MESSAGES=zh_CN.UTF-8
 [7] LC_PAPER=zh_CN.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_3.4.4

```

Thanks in advance.",nishuai,https://github.com/lima1/PureCN/issues/84
MDU6SXNzdWU0NDUzNjIyMTg=,Support for allele-specific copy number in variant results,CLOSED,2019-05-17T09:57:34Z,2019-05-27T14:58:05Z,2019-05-27T14:58:04Z,"Rationale: this allows to feed the variant data from PureCN into other programs like PyClone. Given CN segments with known allele CN one could always intersect the data between variants and CN segments, but if these information are already available, why not make use of them?",lbeltrame,https://github.com/lima1/PureCN/issues/85
MDU6SXNzdWU0NDU5MDY5NzE=,corrected input vcf for PureCN,CLOSED,2019-05-20T03:22:12Z,2019-08-19T21:15:57Z,2019-05-25T15:15:28Z,"Hello,

The input vcf for PureCN should contain both germline and somatic variants. Does this mean both the germline and somatic vcf from variant caller should be combined together into a single one ? Or, just flag the variants recored in germline databases in the somatic vcf ? Or, something else? 

I just want to evaluate tumor purity and ploidy. 
I got vcf files with varscan2. Then, the  high confidence germline and somatic vcf was combined together into a single vcf file, and annotated with dbSNP, marked the INFO with ""DB"" flag to indicate the variant was recored in the dbSNP database. 

Run PureCN with the following command:

Rscript PureCN.R --out Tumor1/Tumor1  \
--normal PureCN_Coverage/Normal1.sort.dedup_coverage_loess.txt \
--tumor PureCN_Coverage/Tumor1.sort.dedup_coverage_loess.txt \
--vcf Tumor1_Normal1.varscan2.combinded.germline.somatic.vcf  \
--parallel  \
--cores  6  \
--sampleid  Patient1 \
--intervals  baits_hg19_intervals.txt \
--segfile  Tumor1.segments  \
--genome hg19

Both the coverage files  and  intervalFile was generated from PureCN. The segment file was generated from  CNVkit. The above command completed without errors.

Is this OK ?",qindan2008,https://github.com/lima1/PureCN/issues/86
MDU6SXNzdWU0NDY3NDgwMzA=,Standardizing output plots,OPEN,2019-05-21T17:52:52Z,2019-05-21T17:52:52Z,,"There are now a couple of third-party copy number visualization libraries available, e.g.
http://bioconductor.org/packages/release/bioc/vignettes/CopyNumberPlots/inst/doc/CopyNumberPlots.html

We should at some point switch to something better than our defaults.
",lima1,https://github.com/lima1/PureCN/issues/87
MDU6SXNzdWU0NTAzODQ1OTQ=,"Getting the ""Please add a column 'Gene'"" to interval file when i have already added it.",CLOSED,2019-05-30T16:10:19Z,2019-06-06T14:22:50Z,2019-06-06T14:22:50Z,"Hi there,

I have been trying to get PureCN running and am having some issues with the interval file. As far as I can tell I'm running the right command for creating the interval file and it seems to work fine ( see below - the Gene column is present). But when I run my test sample it complains that the column is not present in the file. Any thoughts? 

Thanks!
Warren

`head /shared/pipeline-user/tools/extra_files/baits_hg38_intervals.txt
Target  gc_bias mappability     reptiming       Gene    on_target
chr1:36557-62252        0.373949252801993       0.374878172194484       NA      .       FALSE
chr1:65572-65897        0.343558282208589       0.5     NA      .       TRUE
chr1:69181-69526        0.459537572254335       0.583333159486453       NA      OR4F5   TRUE
chr1:70719-111939       0.396399893258291       0.142124789385276       NA      .       FALSE`

Command i used:

`Rscript $PURECN/IntervalFile.R --infile /shared/pipeline-user/bcbio/genomes/Hsapiens/hg38/coverage/capture_regions/Exome-NGv3.bed \
--fasta /shared/pipeline-user/bcbio/genomes/Hsapiens/hg38/seq/hg38.fa --outfile /shared/pipeline-user/tools/extra_files/baits_hg38_intervals.txt \
--offtarget --genome hg38 \
--export  /shared/pipeline-user/tools/extra_files/baits_Exome-NGv3.bed \
--mappability /shared/pipeline-user/tools/extra_files/GCA_000001405.15_GRCh38_no_alt_analysis_set_100.bw `

` Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID --sampleid $SAMPLEID --segfile NA12878-1-somatic-cnvkit-call.seg --vcf /shared/pipeline-user/examples/NA12878-exome-eval_somatic_only/final/2019-05-18_project/NA12878-1-somatic-ensemble-annotated.vcf.gz --intervals /shared/pipeline-user/tools/extra_files/baits_hg38_intervals.txt --genome hg38 --parallel
[1] ""/shared/pipeline-user/examples/NA12878-exome-eval_somatic_only/final/2019-05-18_project/test""
INFO [2019-05-30 15:59:09] Loading PureCN 1.12.2...
INFO [2019-05-30 15:59:10] test/NA12878-1-somatic.rds already exists. Skipping... (--force will overwrite)
INFO [2019-05-30 15:59:10] Reading test/NA12878-1-somatic.rds...
null device
          1
null device
          1
FATAL [2019-05-30 15:59:51] This function requires gene-level calls. Please add a column 'Gene'

FATAL [2019-05-30 15:59:51] containing gene symbols to the interval.file.

FATAL [2019-05-30 15:59:51]

FATAL [2019-05-30 15:59:51] This is most likely a user error due to invalid input data or

FATAL [2019-05-30 15:59:51] parameters (PureCN 1.12.2).

Error: This function requires gene-level calls. Please add a column 'Gene'
containing gene symbols to the interval.file.

This is most likely a user error due to invalid input data or
parameters (PureCN 1.12.2).
Execution halted`


",waemm,https://github.com/lima1/PureCN/issues/88
MDU6SXNzdWU0NTM1MTI4NDg=,Optimum length of regions and positioning of SNPs,CLOSED,2019-06-07T13:25:28Z,2019-06-16T15:02:09Z,2019-06-16T15:02:09Z,"Hi,

I just had two questions about what the minimum region length that PureCN can use? I see in `filterIntervals` you set a default minimum of 5bp - does this imply any size region (as long as it is in the baits) can potentially be used to improve the CNV calling? Is there an optimal size range for this? 

Secondly, for the SNPs, is it more beneficial to cover extra SNPs within the regions you would expect to see CNVs in cancer or is a random shotgun approach more beneficial?

Thanks for a great piece of software!",waemm,https://github.com/lima1/PureCN/issues/89
MDU6SXNzdWU0NTQ4MzE3Nzk=,Improve mapping bias estimates,OPEN,2019-06-11T18:09:51Z,2019-10-23T16:30:36Z,,"Current heuristic simply uses neighboring SNPs. Would be better to train a regression model using database generating that takes distance, number of samples and coverage into account. Simple to benchmark by leave-one-out simulations.",lima1,https://github.com/lima1/PureCN/issues/90
MDU6SXNzdWU0NjMxNjQwNjM=,Ideal purity for PureCN somatic variant identification,CLOSED,2019-07-02T11:03:15Z,2019-07-02T14:48:07Z,2019-07-02T14:48:06Z,"Hi Markus,

I was looking for some guidelines for collaborators on an ideal purity range that will produce best results with PureCN, it seems to me like anywhere between 35-80% ? I am also curious what in your experience the upper and lower limits are for acceptable results. It seems people here are using purity at 15% with good effect so and you mention it can be used upto 95% purity?

So in summary, my guesses are below, would be good to hear what you think is reasonable given we are aiming for around 200x on a whole exome capture.

Ideal range 35% - 80% 
Acceptable range 15% - 95% 

 Thanks!",waemm,https://github.com/lima1/PureCN/issues/92
MDU6SXNzdWU0NzkzNDYxMjA=,"Error in `colnames<-`(`*tmp*`, value = c(paste(""SOMATIC.M"", test.num.copy,  :    attempt to set 'colnames' on an object with less than two dimensions",CLOSED,2019-08-11T08:28:55Z,2019-08-11T08:29:22Z,2019-08-11T08:29:22Z,"Error in `colnames<-`(`*tmp*`, value = c(paste(""SOMATIC.M"", test.num.copy,  : 
  attempt to set 'colnames' on an object with less than two dimensions

",vedellpt,https://github.com/lima1/PureCN/issues/94
MDU6SXNzdWU0ODE3MjMzMTM=,"Error in UseMethod(""callLOH"")",CLOSED,2019-08-16T18:07:24Z,2019-08-16T18:07:41Z,2019-08-16T18:07:41Z,,vedellpt,https://github.com/lima1/PureCN/issues/95
MDU6SXNzdWU0ODY4MDE5MTg=,RFE: Clarify the meaning of the pie charts when using Dx.R,CLOSED,2019-08-29T08:02:20Z,2019-08-31T23:11:44Z,2019-08-31T23:11:44Z,"I ran into this because I wanted to show some results generated by Dx.R to biologists, in particular the COSMIC signatures. I wasn't able to find many information on the topic, however.

The main two questions from the signature results in Dx.R are:

- In the CSV output: what do the numbers mean? Are they the results of cosine similarity like other R packages do when using NMF to calculate signatures?
- What does the pie chart represent? A percentage (and of what)?

These are questions that I expect to be made when trying to interpret the results.",lbeltrame,https://github.com/lima1/PureCN/issues/97
MDU6SXNzdWU0ODY5MzU4Mjc=,Support for COSMIC signatures v3,CLOSED,2019-08-29T12:44:50Z,2019-08-30T18:50:54Z,2019-08-30T18:50:54Z,Latest version of deconstructSigs supports them,lima1,https://github.com/lima1/PureCN/issues/98
MDU6SXNzdWU0ODczNDAxOTA=,Clarify the meaning of the columns for the chromosomal instability scores,CLOSED,2019-08-30T07:48:33Z,2021-05-01T08:05:48Z,2019-08-30T15:04:06Z,"I've looked at the documentation and the repository and I wasn't able to find many information on them, at least on what the measures represent.",lbeltrame,https://github.com/lima1/PureCN/issues/99
MDU6SXNzdWU0OTA4MDYyNzc=,"Make normal_panel,  normalDB and mapping bias database less confusing",CLOSED,2019-09-08T21:05:35Z,2019-09-08T23:10:29Z,2019-09-08T23:10:29Z,The PoN is currently used for examining SNPs and coverage. It's confusing what files and parameters do what.,lima1,https://github.com/lima1/PureCN/issues/100
MDU6SXNzdWU0OTM2MzMzNzY=,Use beta binomial as default when mapping bias database is provided,CLOSED,2019-09-14T15:17:50Z,2020-09-08T02:32:02Z,2020-09-08T02:32:02Z,The current implementation of capping coverage of 300X ignores information available when a sufficiently large PoN mapping bias database is provided. We should use beta binomial as default in this case.,lima1,https://github.com/lima1/PureCN/issues/102
MDU6SXNzdWU1MDAwMzYyMzU=,Non-integer copy number results from PureCN,CLOSED,2019-09-30T03:58:11Z,2019-09-30T13:55:24Z,2019-09-30T13:42:01Z,"Dear Markus,

Hello, I'm using PureCN to analyze the purity, ploidy, and copy number variations in human pancreatic cancer/liver metastases WES data.

When I utilize PureCN results to apply for PyClone to infer clonal population structure, I realized that some of the results have non-integer copy number.

Here is an example.
![image](https://user-images.githubusercontent.com/42195952/65848351-a41a0b00-e380-11e9-8bd8-4f0bfb752512.png)
I just skipped the first column which indicates Sampleid

You could see that there are some non-integer values in C column.

In PureCN manual (http://bioconductor.org/packages/release/bioc/vignettes/PureCN/inst/doc/PureCN.pdf) , C represents Segment integer copy number

There is no error log when I run PureCN.R using normaldb and normal_panel mode

I have attached a log of the program progress.

[run_purecn_with_normal_db_and_normal_panel.PB402-FNA-D.sh.o62523.txt](https://github.com/lima1/PureCN/files/3668778/run_purecn_with_normal_db_and_normal_panel.PB402-FNA-D.sh.o62523.txt)

I don't know why these non-integer copy numbers appear and how I could fix the non-integer copy number.

**Is it okay for me to round the non-integer copy number?**

**I hope I could utilize the PureCN result to infer clonal evolution of my samples.**

Sincerely,

Seung-hoon",hoonghim,https://github.com/lima1/PureCN/issues/103
MDU6SXNzdWU1MDI0NjI4MDU=,Failed preprocessIntervals (IntervalFile.R),CLOSED,2019-10-04T06:53:03Z,2019-10-13T15:01:32Z,2019-10-13T15:01:32Z,"Dear Markus,

Hello, I failed to generate an interval file from a BED file containing baits coordinates.

Could you help me how to solve it?

Below is the code.

library(PureCN)

#To read reference file
reference.file <- ""/BiO/Share/Tools/gatk-bundle/2.8/b37/human_g1k_v37_decoy.chr.fasta""

#The reference file looks like this

![image](https://user-images.githubusercontent.com/42195952/66191208-c08fad80-e6c8-11e9-944d-be60741ef508.png)


#To read bed file specifying the intervals
bed.file <- ""/BiO/Share/Database/agilent/SureSelect_V6_hg19/S07604514_Regions.nochr.bed""

#To read mappability file to annotate intervals with mappability score
mappability.file <- ""/BiO/Share/Tools/gatk-bundle/2.8/b37/wgEncodeCrgMapabilityAlign100mer.bigWig""

#To read replication timing score to annotate intervals with replication timing score
reptiming.file <- ""/BiO/Share/Tools/gatk-bundle/2.8/b37/hg19/wgEncodeUwRepliSeqK562WaveSignalRep1.bigWig""

intervals <- import(bed.file)
mappability <- import(mappability.file)
reptiming <- import(reptiming.file)

![image](https://user-images.githubusercontent.com/42195952/66186832-48bc8580-e6be-11e9-9b04-8b2366dbf1c0.png)

![image](https://user-images.githubusercontent.com/42195952/66186856-55d97480-e6be-11e9-9962-374f1a288267.png)

![image](https://user-images.githubusercontent.com/42195952/66186863-5ffb7300-e6be-11e9-9809-d66b7e6d97b3.png)

preprocessIntervals(intervals, reference.file,
                    mappability=mappability,
                    reptiming=reptiming,
                    output.file = ""/BiO/Share/Tools/gatk-bundle/2.8/b37//baits_agilent_v6_hg19_intervals.txt"")

#################################################################
#This is an error message
![image](https://user-images.githubusercontent.com/42195952/66186928-86211300-e6be-11e9-8a0c-8ee5a093089e.png)



#################################################################

I also tried to follow the quick manual (http://bioconductor.org/packages/release/bioc/vignettes/PureCN/inst/doc/Quick.pdf)
#############
#This is an example

#Generate an interval file from a BED file containing baits coordinates:
#specify path where PureCN should store reference files
$ export OUT_REF=""reference_files""
$ Rscript $PURECN/IntervalFile.R --infile baits_hg19.bed \
--fasta hg19.fa --outfile $OUT_REF/baits_hg19_intervals.txt \
--offtarget --genome hg19 \
--export $OUT_REF/baits_optimized_hg19.bed \
--mappability wgEncodeCrgMapabilityAlign100mer.bigWig \
--reptiming wgEncodeUwRepliSeqK562WaveSignalRep1.bigWig

#############
#This is my trial
Rscript /BiO/Live/seunghoon/.Renv/versions/3.6.0/lib64/R/library/PureCN/extdata/IntervalFile.R --infile /BiO/Share/Database/agilent/SureSelect_V6_hg19/S07604514_Regions.nochr.bed \
--fasta /BiO/Share/Tools/gatk-bundle/2.8/b37/human_g1k_v37_decoy.fasta \
--outfile /BiO/Share/Tools/gatk-bundle/2.8/b37//baits_agilent_v6_hg19_intervals.txt \
--offtarget --genome hg19 \
--export /BiO/Share/Tools/gatk-bundle/2.8/b37//baits_agilent_v6_optimized_hg19.bed \
--mappability /BiO/Share/Tools/gatk-bundle/2.8/b37/wgEncodeCrgMapabilityAlign100mer.bigWig \
--reptiming /BiO/Share/Tools/gatk-bundle/2.8/b37/hg19/wgEncodeUwRepliSeqK562WaveSignalRep1.bigWig

#######################################################################

But the same error occurs: 

![image](https://user-images.githubusercontent.com/42195952/66187079-eadc6d80-e6be-11e9-8d1c-e85fb2591704.png)

#######################################################################
#Plus, I changed the chromosome format: All chr1~chr22, chrX
#Still, there is same error

![image](https://user-images.githubusercontent.com/42195952/66187969-08aad200-e6c1-11e9-87ce-35b38b22dac0.png)



#######################################################################

I appreciate any comments to solve this.

Sincerely,

Seung-hoon

",hoonghim,https://github.com/lima1/PureCN/issues/105
MDU6SXNzdWU1MDMxNjI5MDE=,calculateBamCoverageByInterval and correctCoverageBias should support gzipped output,CLOSED,2019-10-06T21:25:50Z,2019-10-06T21:46:10Z,2019-10-06T21:46:09Z,Coverage.R then produce gzipped coverages by default.,lima1,https://github.com/lima1/PureCN/issues/106
MDU6SXNzdWU1MDQ4ODUxMTQ=,PureCN error,CLOSED,2019-10-09T20:45:16Z,2019-10-14T20:40:48Z,2019-10-14T17:00:03Z,"Hi @lima1 

I'm having an issue running with the latest stable version of PureCN (PureCN_1.14.3).

It looks like to an old issue https://github.com/lima1/PureCN/issues/20#issuecomment-368330032

My error is:
```
INFO [2019-10-09 19:19:30] Fitting variants for local optimum 16/16...
INFO [2019-10-09 19:19:34] Fitting variants for purity 0.39, tumor ploidy 2.87 and contamination 0.01.
INFO [2019-10-09 19:19:50] Poor goodness-of-fit (0.720). Skipping post-optimization.
INFO [2019-10-09 19:19:50] Optimized purity: 0.39
INFO [2019-10-09 19:19:51] Done.
INFO [2019-10-09 19:19:51] ------------------------------------------------------------
Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
null device
          1
null device
          1
null device
          1
[job purecn] Job error:
```
Attached is the log from `PureCN.R`, but it seems it completes the major part, and error is not shown in the log. 
[3b036cbf-b0e7-4fd3-8b22-734ec845e263.log](https://github.com/lima1/PureCN/files/3709242/3b036cbf-b0e7-4fd3-8b22-734ec845e263.log)


Please check the following json to see my inputs and comments.
```
{
    ""thread_num"": 4,
    ""intervalweightfile"": {
        ""path"": ""interval_weights.sureselectxthumanallexonv5.tcga-meso.hg38.txt"",
        ""class"": ""File"",
        ""__comments"": ""This is generated from PureCN/extdata/NormalDB.R with NormalDB.""
    },
    ""normaldb"": {
        ""path"": ""normalDB.sureselectxthumanallexonv5.tcga-meso.hg38.rds"",
        ""class"": ""File"",
        ""__comments"": ""This is generated from PureCN/extdata/NormalDB.R with IntervalWeight.""
    },
    ""genome"": ""hg38"",
    ""fasta"": {
        ""path"": ""GRCh38.d1.vd1.fa"",
        ""class"": ""File"",
        ""__comments"": ""GDC reference.""
    },
    ""bigwig"": {
        ""path"": ""GRCh38.d1.vd1.100.bigWig"",
        ""class"": ""File"",
        ""__comments"": ""Mappability file.""
    },
    ""exclude"": {
        ""path"": ""GRCh38.d1.vd1.centromeres.telomeres.purecn.bed"",
        ""class"": ""File"",
        ""__comments"": ""GRCh38 centromerers and telomeres regions bed file. For IntervalFile.R""
    },
    ""capture_kit"": {
        ""path"": ""S04380110_Covered.bed.gz"",
        ""class"": ""File"",
        ""__comments"": ""Baits bed for SureSelect Human All Exon v5.""
    },
    ""sampleid"": ""3b036cbf-b0e7-4fd3-8b22-734ec845e263"",
    ""bam"": {
        ""path"": ""3b036cbf-b0e7-4fd3-8b22-734ec845e263_gdc_realn.bam"",
        ""class"": ""File""
    },
    ""vcf"": {
        ""path"": ""bb5b9508-7a40-4851-bec8-5d168ca4a07e.wxs.tumor_only.gatk4_mutect2.raw_somatic_mutation.vcf.gz"",
        ""class"": ""File"",
        ""__comments"": ""GATK4.1.2 Mutect2 tumor only calling. Followed by Broad's best practices. https://github.com/broadinstitute/gatk/tree/master/scripts/mutect2_wdl""
    }
}
```
CMD for PureCN.R:
```
Rscript \
/usr/local/lib/R/site-library/PureCN/extdata/PureCN.R \
--cores \
4 \
--force \
--genome \
hg38 \
--intervals \
GRCh38.d1.vd1.S04380110_Covered.hg38.txt \
--normaldb \
normalDB.sureselectxthumanallexonv5.tcga-meso.hg38.rds \
--out \
. \
--outvcf \
--postoptimize \
--sampleid \
3b036cbf-b0e7-4fd3-8b22-734ec845e263 \
--tumor \
3b036cbf-b0e7-4fd3-8b22-734ec845e263_gdc_realn_coverage_loess.txt \
--vcf \
bb5b9508-7a40-4851-bec8-5d168ca4a07e.wxs.tumor_only.gatk4_mutect2.raw_somatic_mutation.vcf.gz
```

The exclude bed was added after I check'ed the old issue #20 , and saw you commenting about the concern on centromere regions. I would get exactly the same error if I ran the purecn w/o this bed file. (It makes sense since the outputs' md5sums from `IntervalFile.R`, w/ or w/o exclude bed, are identical.)

I also tried the debug method in this comment, https://github.com/lima1/PureCN/issues/20#issuecomment-368347755. However, I didn't see the line `""centromeres <- .getCentromeres(res)""` after `PureCN:::.getArmLocations(x)`, so I was just able to press enter until it errors out. The error is: 
```
debug: chromCoords <- suppressWarnings(t(vapply(split(start(x), as.character(seqnames(x))), 
    function(y) c(min(y), max(y)), c(min = double(1), max = double(1)))))
Browse[2]> 
Error in (function (classes, fdef, mtable)  : 
  unable to find an inherited method for function ‘seqnames’ for signature ‘""list""’
```

I also check'ed this issue #79 . So I also tried running the latest PureCN (PureCN_1.15.24). However, I'm still getting the same error. (It seems to me that the GATK4 PRs are merged to the master branch, but I could be wrong.)

More information that I could think of: 
1. The NormalDB was created by 39 bam files. I'm not sure if it is a big enough pool of samples. 
2. I can not run `calculateMappingBiasVcf` now for new GATK4 PON, since the PON VCF now automatically removes all the sample columns, and `calculateMappingBiasVcf` will complain the pon only contains a single sample. I'm not sure if adding a mapping bias rds file could resolve the issue or not.

In summary, I will have the following error, on stable/dev PureCN version (1.14.3, and 1.15.24), w/ or w/o a exclude bed file.

```
Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
null device
          1
null device
          1
null device
          1
```
I also created a `_bestonly.rds` followed by https://github.com/lima1/PureCN/issues/20#issuecomment-368336340 for debug purpose. (It doesn't fail at `callLOH()`, just FYI.) 
[3b036cbf-b0e7-4fd3-8b22-734ec845e263_bestonly.rds.zip](https://github.com/lima1/PureCN/files/3709403/3b036cbf-b0e7-4fd3-8b22-734ec845e263_bestonly.rds.zip)
",Shenglai,https://github.com/lima1/PureCN/issues/107
MDU6SXNzdWU1MDY4Nzk5MTE=,Error in !info(vcf)[[DB.info.flag]] : invalid argument type,CLOSED,2019-10-14T21:19:40Z,2019-10-19T22:24:05Z,2019-10-19T22:24:04Z,"Hi, I am running PureCN on cell line whole exome sequencing data with a pool of process matched normals. I am running into some issues with the .vcf files. 

SKLMS1.VCF <- readVcf('SKLMSI_S3_L007_P0001.MuTect.vcf')
SKLMS1.CN <- runAbsoluteCN(normal.coverage.file = pool,
                           tumor.coverage.file = 'SKLMS1.Coverage', 
                           vcf.file = SKLMS1.VCF,
                           sex = ""?"",
                           genome = ""hg38"",
                           sampleid = ""SKLMS1"",
                           interval.file = 'LMSIntervalsGC.txt', 
                           normalDB = normalDB,
                           model.homozygous = TRUE,
                           #log.ratio = NULL,
                           #seg.file = NULL,
                           plot.cnv = FALSE,
                           fun.filterVcf = filterVcfMuTect(vcf = SKLMS1.VCF, use.somatic.status = FALSE, DB.info.flag = ""SOMATIC""),
                           args.segmentation=list(interval.weight.file=interval.weight.file),
                           args.filterVcf = list(vcf = SKLMS1.VCF, use.somatic.status = FALSE, DB.info.flag = ""SOMATIC""),
                           DB.info.flag = ""SOMATIC"",
                           post.optimize = FALSE,
                           test.purity = seq(0.9,0.99,by=0.01), 
                           verbose=TRUE) 

INFO [2019-10-14 17:05:04] ------------------------------------------------------------
INFO [2019-10-14 17:05:04] PureCN 1.14.3
INFO [2019-10-14 17:05:04] ------------------------------------------------------------
INFO [2019-10-14 17:05:05] Loading coverage files...
INFO [2019-10-14 17:05:05] Mean target coverages: 67X (tumor) 69X (normal).
INFO [2019-10-14 17:05:05] Mean coverages: chrX: 47.49, chrY: 24.12, chr1-22: 64.12.
INFO [2019-10-14 17:05:05] Mean coverages: chrX: 55.36, chrY: 35.18, chr1-22: 68.66.
INFO [2019-10-14 17:05:06] Removing 24 intervals with missing log.ratio.
INFO [2019-10-14 17:05:06] Removing 16 low/high GC targets.
INFO [2019-10-14 17:05:06] Removing 129 intervals excluded in normalDB.
INFO [2019-10-14 17:05:06] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2019-10-14 17:05:06] Removing 567 low coverage (< 0.0015X) intervals.
INFO [2019-10-14 17:05:06] Using 7779 intervals (7779 on-target, 0 off-target).
INFO [2019-10-14 17:05:06] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2019-10-14 17:05:06] AT/GC dropout: 1.10 (tumor), 1.08 (normal). 
INFO [2019-10-14 17:05:06] Loading VCF...
INFO [2019-10-14 17:05:06] Found 1265 variants in VCF file.
INFO [2019-10-14 17:05:06] 1147 (90.7%) variants annotated as likely germline (SOMATIC INFO flag).
INFO [2019-10-14 17:05:06] SKLMSI_S3 is tumor in VCF file.
INFO [2019-10-14 17:05:06] 10 homozygous and 2 heterozygous variants on chrX.
INFO [2019-10-14 17:05:06] Sex from VCF: NA (Fisher's p-value: 0.001, odds-ratio: 9.04).
WARN [2019-10-14 17:05:06] Duplicated arguments in filterVcf
Error in !info(vcf)[[DB.info.flag]] : invalid argument type

It looks as though the DB.info.flag I assigned [[""SOMATIC""]] is not being passed successfully to !info(vcf). Is there a way to fix this?

Thanks!
",stets43,https://github.com/lima1/PureCN/issues/108
MDU6SXNzdWU1MDgxODE4NjU=,No Germline variants error,CLOSED,2019-10-17T01:35:25Z,2019-10-23T01:14:26Z,2019-10-21T13:28:14Z,"Hello lima,

When I use PureCN with a vcf produced by other variant calling software other than Mutect2,
I got this error below, whether it's because the vcf format is not fit, what critical information or format should the vcf be in order to fit PureCN?

ERROR:
INFO [2019-10-17 09:29:09] Loading coverage files...
WARN [2019-10-17 09:29:09] Coverage data contains single nucleotide intervals.
INFO [2019-10-17 09:29:10] Found log2-ratio in tumor coverage data.
WARN [2019-10-17 09:29:10] Allosome coverage missing, cannot determine sex.
WARN [2019-10-17 09:29:10] Allosome coverage missing, cannot determine sex.
INFO [2019-10-17 09:29:10] Using 41174 intervals (12278 on-target, 28896 off-target).
INFO [2019-10-17 09:29:10] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2019-10-17 09:29:10] Mean off-target bin size: 94490
INFO [2019-10-17 09:29:10] Loading VCF...
INFO [2019-10-17 09:29:10] Found 12753 variants in VCF file.
INFO [2019-10-17 09:29:11] 5852 (45.9%) variants annotated as likely germline (DB INFO flag).
INFO [2019-10-17 09:29:11] Sample1 is tumor in VCF file.
INFO [2019-10-17 09:29:12] No germline variants in VCF.
ERROR: logical subscript contains NAs
STOP",DanXu-git,https://github.com/lima1/PureCN/issues/109
MDU6SXNzdWU1MjE4NzEyMTA=,interval_weights.txt File,CLOSED,2019-11-12T23:55:46Z,2019-11-13T15:50:20Z,2019-11-13T15:50:20Z,"Is the interval_weights file that was produced with NormalDB.R in previous builds no longer produced in runs.  When looking in the ""NEWS"" file in PureCN, where you implying that the interval file is now created within another function and no longer produces the interval_weights text file output and only the PNG output?",sbagg,https://github.com/lima1/PureCN/issues/110
MDU6SXNzdWU1MjIzOTgwMDc=,Provide Version Flexibility,CLOSED,2019-11-13T18:32:03Z,2019-11-13T21:48:42Z,2019-11-13T21:48:42Z,"We want to be able to use different versions of PureCN for different projects (e.g. continue using the older version for an older project that has already been established with an older version of PureCN, while using a newer version for a new project).

It is possible in R to install different versions of the same package under different names.  One way is to use the lib argument to install.packages, so for example, instead of:

`install.packages(""PureCN"")`

you can do:

`install.packages(""PureCN"", lib=file.path(.libPaths(), ""PureCN_1.15.27""))`

Then, to use that package:

`library(""PureCN"", lib.loc=file.path(.libPaths(), ""PureCN_1.15.27"")`

The problem we have is that some of the .R programs within PureCN contain `library(""PureCN"")`, causing them to access the wrong library.

I'd like to see some mechanism to allow the PureCN package version to be selected by the user.  One way would be to add arguments to specify the lib.loc to be used for the PureCN package, to be used in any ""library()"" calls.  Or, perhaps there is already a well-established way to do this.  Ideally, the .R program would look to see what directory it is running out of, and infer the lib.loc from that.  For example, if PureCN.R detected that it was file `xxxx/library/PureCN_1.15.27/PureCN/extdata/PureCN.R`, it would use `lib.loc=PureCN_1.15.27`.
",tedtoal,https://github.com/lima1/PureCN/issues/111
MDU6SXNzdWU1MjI1MjA1OTU=,_genes.csv seg.mean for wrong segment,CLOSED,2019-11-13T22:55:39Z,2019-11-18T21:14:33Z,2019-11-18T21:14:33Z,"In PureCN version 1.13.21 (haven't yet been able to test it in later versions), I have a case where the _genes.csv file shows a seg.mean value that is for segment ID 103 even though the seg.id column contains value 104.  In this case, the gene, DDX5, overlaps both segments 103 and 104.  In that case I would think that maybe the _genes.csv file would have two entries for that gene, but if it only has one entry, I would expect consistency between the seg.mean value and the seg.id value. ",tedtoal,https://github.com/lima1/PureCN/issues/112
MDU6SXNzdWU1MjYyNDg2NTA=,PureCN.pdf filenames,OPEN,2019-11-20T22:20:11Z,2019-11-22T02:53:52Z,,"On the Bioconductor PureCN page under the Documentation heading are two links named ""PDF"" to the PureCN reference document and PureCN user guide.  Both links have target filename PureCN.pdf (although different directories), and clicking on them downloads both under the same name (one getting a ""(2)"" in its name on my Mac to distinguish it).  I suggest that you rename one of these files, e.g. ""PureCN_Ref.pdf"" for the reference manual.
",tedtoal,https://github.com/lima1/PureCN/issues/113
MDU6SXNzdWU1NDExOTI5MTU=,Curation FLAGGED column described incorrectly,CLOSED,2019-12-20T20:48:19Z,2020-01-14T18:49:50Z,2020-01-14T18:49:50Z,"In section 7 of the PureCN overview pdf file, on Curation, it says:

> PureCN currently only flags samples with warnings, it does not mark any samples as failed. The Failed column in the curation file can be used to manually flag samples for exclusion in downstream analyses. See Table 5 for an explanation of all flags.

First, I see that many of my samples have TRUE in the FAILED column, which I would interpret as PureCN having marked it as failed.

Second, even though this column has TRUE in it, as far as I can tell PureCN did not exclude it from any analyses.  By ""downsteam analyses"" do you mean ""downstream analyses performed after PureCN analysis""?  (Because I thought it referred to subsequent PureCN analyses such as Dx.R).

Third, Table 5 does not have the FAILED column in it.
 ",tedtoal,https://github.com/lima1/PureCN/issues/114
MDU6SXNzdWU1NDI0MTMxOTY=,Error : PURECN.R,CLOSED,2019-12-26T02:44:59Z,2019-12-29T15:07:55Z,2019-12-29T15:07:55Z,"This is a log file. I don't know why I got the error message for only one sample of over 1000 samples. 
Please check the below error message.


INFO [2019-12-26 10:42:52] ------------------------------------------------------------
INFO [2019-12-26 10:42:52] PureCN 1.14.3
INFO [2019-12-26 10:42:52] ------------------------------------------------------------
INFO [2019-12-26 10:42:52] Loading coverage files...
INFO [2019-12-26 10:42:53] Mean target coverages: 62X (tumor) 59X (normal).
WARN [2019-12-26 10:42:53] Allosome coverage missing, cannot determine sex.
WARN [2019-12-26 10:42:53] Allosome coverage missing, cannot determine sex.
INFO [2019-12-26 10:42:54] Removing 487 intervals with missing log.ratio.
INFO [2019-12-26 10:42:54] Removing 19 low/high GC targets.
INFO [2019-12-26 10:42:54] Removing 3933 intervals excluded in normalDB.
INFO [2019-12-26 10:42:54] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2019-12-26 10:42:54] Removing 954 low coverage (< 0.0015X) intervals.
INFO [2019-12-26 10:42:54] Using 18041 intervals (4587 on-target, 13454 off-target).
INFO [2019-12-26 10:42:54] Ratio of mean on-target vs. off-target read counts: 1.71
INFO [2019-12-26 10:42:54] Mean off-target bin size: 194685
INFO [2019-12-26 10:42:54] AT/GC dropout: 0.99 (tumor), 0.98 (normal). 
INFO [2019-12-26 10:42:54] Loading VCF...
INFO [2019-12-26 10:42:54] Found 5762 variants in VCF file.
INFO [2019-12-26 10:42:55] 2235 (38.8%) variants annotated as likely germline (DB INFO flag).
INFO [2019-12-26 10:42:55] $sampleID is tumor in VCF file.
INFO [2019-12-26 10:42:55] 2 homozygous and 28 heterozygous variants on chrX.
INFO [2019-12-26 10:42:55] Sex from VCF: F (Fisher's p-value: 0.422, odds-ratio: 0.43).
INFO [2019-12-26 10:42:56] Initial testing for significant sample cross-contamination: maybe
INFO [2019-12-26 10:42:56] Removing 2062 variants with AF < 0.030 or AF >= 0.970 or less than 3 supporting reads or depth < 15.
INFO [2019-12-26 10:42:56] Removing 0 low quality variants with BQ < 25.
INFO [2019-12-26 10:42:56] Total size of targeted genomic region: 0.99Mb (1.38Mb with 50bp padding).
INFO [2019-12-26 10:42:57] 34.3% of targets contain variants.
INFO [2019-12-26 10:42:57] Removing 1405 variants outside intervals.
WARN [2019-12-26 10:42:57] Less than half of variants in dbSNP. Make sure that VCF contains both germline and somatic variants.
INFO [2019-12-26 10:42:57] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2019-12-26 10:42:57] VCF does not contain somatic status. For best results, consider providing normal.panel.vcf.file when matched normals are not available.
INFO [2019-12-26 10:42:57] Excluding 1424 novel or poor quality variants from segmentation.
INFO [2019-12-26 10:42:57] Sample sex: ?
INFO [2019-12-26 10:42:57] Segmenting data...
INFO [2019-12-26 10:42:57] Loading pre-computed boundaries for DNAcopy...
INFO [2019-12-26 10:42:57] Setting undo.SD parameter to 1.250000.
INFO [2019-12-26 10:42:59] Setting prune.hclust.h parameter to 0.100000.
INFO [2019-12-26 10:42:59] Found 56 segments with median size of 29.56Mb.
INFO [2019-12-26 10:42:59] Removing 2 variants outside segments.
INFO [2019-12-26 10:42:59] Using 2293 variants.
INFO [2019-12-26 10:42:59] Mean standard deviation of log-ratios: 0.92
INFO [2019-12-26 10:42:59] 2D-grid search of purity and ploidy...
FATAL [2019-12-26 10:43:34] Cannot find valid purity/ploidy solution. This happens when input 

FATAL [2019-12-26 10:43:34] segmentations are garbage, most likely due to a catastrophic sample QC 

FATAL [2019-12-26 10:43:34] failure. Re-check standard QC metrics for this sample. 

FATAL [2019-12-26 10:43:34]  

FATAL [2019-12-26 10:43:34] This is most likely a user error due to invalid input data or 

FATAL [2019-12-26 10:43:34] parameters (PureCN 1.14.3).",2yuna710,https://github.com/lima1/PureCN/issues/115
MDU6SXNzdWU1NTY2MDcxMjc=,default ignored types for filterVcfMuTect2,CLOSED,2020-01-29T02:57:17Z,2020-06-04T13:41:21Z,2020-06-04T13:41:20Z,"ignore = c(""clustered_events"", ""t_lod"", ""str_contraction"", ""read_position"", ""fragment_length"", ""multiallelic"", ""clipping"", ""strand_artifact"")

for these types ignored by default for filterVcfMuTect2, does that mean items with any of these types from Mutect-2 are less likely to be sequencing artifact?",liuxq0707,https://github.com/lima1/PureCN/issues/116
MDU6SXNzdWU1ODMzNjYzNzY=,Panel of Normal VCF file and Mutect2 POPAF,CLOSED,2020-03-17T23:43:40Z,2020-07-07T15:17:40Z,2020-05-20T14:40:41Z,"Hello, 

I've been searching through all the threads for choosing correct VCF file. I have 23 Process matched  controls and 3 Tumor samples , where I want to investigate allele specific copy number , LOH and Purity.  I am using PureCN 1.17.1 (Also tried PureCN 1.16)

Using the 23 process matched normal I ran CNVkit and generated necessary *seg and *cnr files 
 
Then, I created Panel of Normal with Mutect2 using GATK's most recent version 4.1.4.1, using that I detected Somatic variants in each of the Tumor samples.  I followed GATK tutorial [here](https://gatkforums.broadinstitute.org/gatk/discussion/24057/how-to-call-somatic-mutations-using-gatk4-mutect2#latest)

These will be my VCFs to be used with PureCN.R correct ? (FYI A quick note for others who might get an error, the VCF created by mutect2 will cause error, unless you split and remove all sites with alternate allele ""*"")

As per PureCN's vignettes, it is suggested to create a mappingbiasfile  using Panel of Normal , but I can not use the VCF file created using Mutect2's Panel of Normal as  the version does not output any AD field in the VCF. So I ran haplotype caller to create the Panel of Normal to be used in NormalDB step. 

Everything went fine till the last step and when I looked the log file (attached )I found below line 

> vcf.file has no DB info field for membership in germline databases. Found and used valid **population allele frequency > 0.001000 **

The population allle frequency is the POPAF field of of the Mutect2 VCF file ,when I looked at the VCF file I found that POPAF is always very high (almost always > 1) and that is because it's -log10 of the AF found in normal.  
> ##INFO=<ID=POPAF,Number=A,Type=Float,Description=""negative log 10 population allele frequencies of alt alleles"">

So my question is, dose PureCN is applying the filter based on log value or raw AF ? Is it OK to create panel of normal VCF using haplotype caller ? 

Best,
Nick
[SampleA1.PureCN.log](https://github.com/lima1/PureCN/files/4346260/SampleA1.PureCN.log)




 ",npatel22526,https://github.com/lima1/PureCN/issues/117
MDU6SXNzdWU2MTI4NjcwNzY=,Can processMultipleSamples be used for hg38-aligned data by using the centromeres paramter? ,CLOSED,2020-05-05T20:15:15Z,2020-07-11T21:09:16Z,2020-07-11T21:09:16Z,"Hi. I am wondering if processMultipleSamples can be used for hg38-aligned data by using the centromeres parameter. In the documentation, there is an indication that the genome parameter is used to get centromere positions. I tried using processMultipleSamples using hg38 as the value for the genome but an empty result was returned. I noticed that the copynumber package multipcf function upon which I understand that processMultipleSamples depends has the statement that only  ""hg19"", ""hg18"", ""hg17"" and ""hg16"" are allowed options for its assembly parameter. I noticed that multipcf has an arms parameter which can be used to override arms as determined by its assembly parameter. Might  the centromeres parameter of processMultipleSamples be used to appropriately populate the arms parameter of multipcf, thereby allowing for use for hg38-algned data? Thanks for your consideration of this inquiry. 

",vedellpt,https://github.com/lima1/PureCN/issues/118
MDU6SXNzdWU2MTUwNTQwODY=,behavior of undo.SD for PSCBS segmentation,CLOSED,2020-05-09T00:43:10Z,2020-05-14T15:18:41Z,2020-05-14T15:06:56Z,"Hi,

I have a question with regard to the ""--undosd"" parameter for the PureCN.R script when used in combination with ""--funsegmentation=PSCBS"". When I populate this by, for example, ""--undosd=1.125"", I have noticed, from the log file, that the undo.SD parameter can still be changed within the algorithm. I think it is nice to have this as a way to set the initial undo.SD as the current behavior is, but sometimes it would be nice to fix the undo.SD parameter. For example, I am wanting to compare results across a set of values for undo.SD. Is there a way to force the value of undo.SD to stay the same? Thanks.

",vedellpt,https://github.com/lima1/PureCN/issues/119
MDU6SXNzdWU2MTY3NTgzNDE=,Mutect2 Matched samples purity estimates fails,CLOSED,2020-05-12T15:39:32Z,2023-10-30T22:50:24Z,2023-10-30T22:50:24Z,"Hello Team, 

I am trying to use PureCN with a matched tumor and normal samples, however, it's throwing an error. I am attaching the log file here. I have used CNVkit for segmentation and Mutect2 (GATK 4.1.7.0) for variant detection. 
[Tumor01.PureCN.log](https://github.com/lima1/PureCN/files/4616588/Tumor01.PureCN.log)

I tried a few things to troubleshoot, none seems to be working. 

1. First, I ran it without the ""dbinfoflag"" flag but it produced below error. Note that I did provide the ""popafinfofield""  flag. 
```
WARN [2020-05-12 15:28:37] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2020-05-12 15:28:38] 0 (0.0%) variants annotated as likely germline (DB INFO flag).
```

2. So then I annotated VCF file with common SNPs (1kg AF > 1%) and used the COMMON as db flag and then got another error as shown in the log file. 
3. Also, I tried different option for fun segmentation (PBCBS isn't working) 
4. And Changed thresholds for --minpurity 0.05 and --maxpurity 0.99. 

```
Rscript $PURECN_DIR/PureCN.R 
        --out PureCN_Analysis/$TUMOR_ID \
	--sampleid $TUMOR_ID \
	--tumor TumorCNN/$TUMOR_ID.cnr \
	--segfile TumorCNN/$TUMOR_ID.seg \
	--vcf ${TUMOR_ID}.filtered.anno.vcf \
	--snpblacklist hg19_simpleRepeats.bed \
	--genome hg19 \
	--popafinfofield gnomAD_exomes_controls_AF \
	--dbinfoflag COMMON \
	--force --postoptimize --seed 123 \
	--outvcf \
	--cores 12 \
	--funsegmentation Hclust \
	--parallel >& $TUMOR_ID.PureCN.log

```
Any suggestion to resolve the error is appreciated. If there is an issue with samples itself as stated in log file,  what would be an alternative way to confirm the behavior?
 
A note, I don't have normal samples to run NormalDB. 

Best,
nihir",npatel-ah,https://github.com/lima1/PureCN/issues/120
MDU6SXNzdWU2MjEzNjUwMzY=,any plan for amplicon sequencing data?,CLOSED,2020-05-20T00:09:59Z,2020-05-23T04:18:39Z,2020-05-23T04:18:39Z,"Hello,
I have been exploring and testing PureCN for our amplicon based targeted WES data for cancer patients data.  While I was quite impressed by the clear documentations and implementations, I also hoped PureCN may work for our data; however, I've lost my hope in the end. :(  

I am working on predicting somatic/germline mutations from tumor only samples although we have matched tumor/normal (T/N) samples, which we consider as a gold standard, to leverage a performance of programs.  We have enough normal samples to create panel of normals, but when looking at posterior somatic probability after PureCN the expected somatic mutations identified from T/N were all over the places.  I understand PureCN acknowledges that it's intended to use for hybrid capture, but was wondering if there were any plans to implement further the PureCN for the amplicon data.

Best,
Segun ",dauss75,https://github.com/lima1/PureCN/issues/121
MDU6SXNzdWU2MjE1ODkxNjU=,Coverage.R script ignores multiple read groups,CLOSED,2020-05-20T09:00:57Z,2020-05-20T09:08:08Z,2020-05-20T09:08:07Z,"Hello,

I realized that PureCN was reporting only a fraction of the mean target coverage that our latest batch of samples actually had. The main difference with these samples was that each sample was sequenced on multiple lanes and the reads group IDs (`@RG ID`) in the BAM files were set to reflect their lanes with single sample name tags (`@RG SM`) . So, my best guess is that only one of the `@RG ID`s was counted and the rest of them were ignored/missed. Could this be true? If so, what should I do to count all of the reads?

Thanks,
Bekir",berguner,https://github.com/lima1/PureCN/issues/122
MDU6SXNzdWU2MjE4ODA3MjQ=,Using PureCN in the bcbio workflow,CLOSED,2020-05-20T16:02:22Z,2020-06-03T13:48:38Z,2020-06-03T13:14:23Z,"Hi Markus,

I just wanted to get your opinion of using PureCN as part of the bcbio workflow. From my understanding this is going to produce suboptimal results as no mapping bias file / PON data is added. I saw another thread talking about off target reads I assume with enough off target reads you can maybe increase the number of SNPs you detect? 

1) I am just curious if you think this is a viable workflow (given it is very convenient) and 2) what conditions you would require for acceptable results ie. higher depth of off-target coverage etc.

3) If I was to use a custom panel with tiling of SNPs would this make the bcbio workflow version more viable?

Ultimately, I would still want to use the full workflow you describe in your package but it would be great to have an idea of how much worse off I'll be and how I can minimise this. 

",waemm,https://github.com/lima1/PureCN/issues/123
MDU6SXNzdWU2MjUwNDk2MDk=,"arguments imply differing number of rows: 0, 1",CLOSED,2020-05-26T17:18:57Z,2020-06-04T13:40:05Z,2020-06-04T13:40:05Z,"Dear all:
when I run PureCN.R with a matched normal sample, there was a error：
Error in data.frame(bias = tmp, shape1 = NA, shape2 = NA) :
arguments imply differing number of rows: 0, 1
Calls: runAbsoluteCN -> do.call -> <Anonymous> -> data.frame
my cmd:
Rscript PureCN.R --out C1905659-r1TB --tumor C1905659-r1TB/C1905659-r1TB.cons_coverage_loess.txt.gz --normal C1905659-r1TB/C1905659-F1WB.cnv_coverage_loess.txt.gz --sampleid C1905659-r1TB --vcf C1905659-r1TB.vcf --normaldb C1905659-r1TB/normalDB_hg19.rds --intervals baits_hg19_intervals.txt --genome hg19

its log:
INFO [2020-05-27 01:06:42] Loading coverage files...
INFO [2020-05-27 01:06:44] Mean target coverages: 2481X (tumor) 1090X (normal).
WARN [2020-05-27 01:06:45] Allosome coverage missing, cannot determine sex.
WARN [2020-05-27 01:06:45] Allosome coverage missing, cannot determine sex.
INFO [2020-05-27 01:06:46] Removing 127 intervals with missing log.ratio.
INFO [2020-05-27 01:06:46] Removing 31 low/high GC targets.
INFO [2020-05-27 01:06:46] Removing 366 intervals excluded in normalDB.
INFO [2020-05-27 01:06:46] Removing 2 intervals with low total coverage in normal (< 150.00 reads).
INFO [2020-05-27 01:06:46] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2020-05-27 01:06:46] Removing 1291 low coverage (< 0.0015X) intervals.
INFO [2020-05-27 01:06:46] Using 22629 intervals (9151 on-target, 13478 off-target).
INFO [2020-05-27 01:06:47] Ratio of mean on-target vs. off-target read counts: 5.03
INFO [2020-05-27 01:06:47] Mean off-target bin size: 192856
INFO [2020-05-27 01:06:48] AT/GC dropout: 1.00 (tumor), 1.00 (normal). 
INFO [2020-05-27 01:06:48] Loading VCF...
INFO [2020-05-27 01:06:48] Found 3887 variants in VCF file.
INFO [2020-05-27 01:06:48] 3550 (91.3%) variants annotated as likely germline (DB INFO flag).
INFO [2020-05-27 01:06:49] C1905659-r1TB is tumor in VCF file.
INFO [2020-05-27 01:06:49] 75 homozygous and 22 heterozygous variants on chrX.
INFO [2020-05-27 01:06:49] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 7.32).
INFO [2020-05-27 01:06:49] Removing 3541 non heterozygous (in matched normal) germline SNPs.
INFO [2020-05-27 01:06:50] Initial testing for significant sample cross-contamination: unlikely
INFO [2020-05-27 01:06:50] Removing 1 variants with AF < 0.030 or AF >= 1.000 or less than 6 supporting reads or depth < 15.
INFO [2020-05-27 01:06:50] Removing 0 low quality variants with BQ < 25.
INFO [2020-05-27 01:06:50] Total size of targeted genomic region: 1.82Mb (2.61Mb with 50bp padding).
INFO [2020-05-27 01:06:50] 0.0% of targets contain variants.
INFO [2020-05-27 01:06:50] Removing 345 variants outside intervals.
INFO [2020-05-27 01:06:50] Found SOMATIC annotation in VCF.
INFO [2020-05-27 01:06:50] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2020-05-27 01:06:50] Found SOMATIC annotation in VCF. Setting mapping bias to NaN.
Error in data.frame(bias = tmp, shape1 = NA, shape2 = NA) : 
  arguments imply differing number of rows: 0, 1
Calls: runAbsoluteCN -> do.call -> <Anonymous> -> data.frame
Execution halted


yours 
milk
",milkcookie,https://github.com/lima1/PureCN/issues/124
MDU6SXNzdWU2MjY2MDI3OTM=,tumor.coverage.file and normalDB do not align.,CLOSED,2020-05-28T15:27:31Z,2020-06-03T15:59:26Z,2020-06-03T15:59:26Z,"Hi,

I have created normalDB with PureCN 1.14.3, and was trying to proceed with the GATK4 tumor only VCF.

```
    Rscript \
    /usr/local/lib/R/site-library/PureCN/extdata/PureCN.R \
    --cores \
    8 \
    --force \
    --genome \
    hg38 \
    --intervals \
    /var/lib/cwl/stg04036b18-89e0-459b-8b47-ad66d5ed54f6/GRCh38.d1.vd1.S04380110_Covered.hg38.txt \
    --normaldb \
    /var/lib/cwl/stgd62d1ce3-86d2-4daf-aef9-ff409aa61ad6/normalDB.sureselectxthumanallexonv5.tcga-meso.hg38.rds \
    --out \
    . \
    --outvcf \
    --postoptimize \
    --vcf \
    /var/lib/cwl/stg78adfe65-14c9-4984-b083-e7eadc80e38d/ba299f88-ab40-402e-afe5-7753dea249ba.wxs.tumor_only.gatk4_mutect2.raw_somatic_mutation.vcf.gz \
    --sampleid \
    c40c577a-e52d-4dc9-9b2c-327c70400b6b \
    --seed \
    150 \
    --tumor \
    /var/lib/cwl/stg304644f5-59dd-4ee0-a74b-21cc7afe6b43/c40c577a-e52d-4dc9-9b2c-327c70400b6b_gdc_realn_coverage_loess.txt
[1] ""/var/spool/cwl""
INFO [2020-05-28 05:20:03] Loading PureCN 1.14.3...
FATAL [2020-05-28 05:20:12] tumor.coverage.file and normalDB do not align.

FATAL [2020-05-28 05:20:12]

FATAL [2020-05-28 05:20:12] This is most likely a user error due to invalid input data or

FATAL [2020-05-28 05:20:12] parameters (PureCN 1.14.3).

Error: tumor.coverage.file and normalDB do not align.

This is most likely a user error due to invalid input data or
parameters (PureCN 1.14.3).
```

It seems there is something wrong in the normalDB, so I'm wondering how I can debug in this situation.

Sorry if it's a repetitive issue.

Thanks.",Shenglai,https://github.com/lima1/PureCN/issues/125
MDU6SXNzdWU2MzEwNzQxNDc=,PureCN Input for Clonality Analysis,CLOSED,2020-06-04T18:59:32Z,2020-06-22T13:04:25Z,2020-06-22T13:04:25Z,"There is the ability to get purity, ploidy, and major and minor copy numbers with this software, which sets it up perfectly to use output for subclonal clustering.  However, I have not been able to easily figure out how to format the data properly for input into TitanCNA, phylowgs, etc.  This would be particularly helpful for cases that do not have matched normal that can still be analysed with PureCN or for using CNVKit segmentation through PureCN.  Do you have any scripts or pipelines that are available to assist with this?  

SuperFreq has come out recently that claims to be able to use tumor only or matched samples and conduct CNV calling, subclonal clustering, and clonality calls.  I have not used that yet but would like to compare the different toolkits and was hoping to use PureCN in my analysis. 

Thanks.",mgfield,https://github.com/lima1/PureCN/issues/126
MDU6SXNzdWU2NDMzMDI3ODQ=,Cannot find valid purity/ploidy solution,CLOSED,2020-06-22T19:15:43Z,2020-06-25T17:55:57Z,2020-06-25T17:55:57Z,"Hello, 

For many samples, PureCN worked well but for one of the samples, it's throwing error. I have attached log file here [Sample_1-DNA.PureCN2.log](https://github.com/lima1/PureCN/files/4815108/Sample_1-DNA.PureCN2.log)
 
This is a tumor only sample for panel of ~400 genes. 

The segmentation seems fine from CNVkit's plot, also attached. 
[Scatter.pdf](https://github.com/lima1/PureCN/files/4815137/Scatter.pdf)

I also tried to use PSCBS algorithm but got below error. 

```
INFO [2020-06-22 19:11:50] Re-centering provided segment means (offset -0.0535).
INFO [2020-06-22 19:11:50] Using unweighted PSCBS.
INFO [2020-06-22 19:11:50] Setting undo.SD parameter to 0.750000.
INFO [2020-06-22 19:12:06] Setting prune.hclust.h parameter to 0.150000.
Error in hclust(dist(dx), method = method) :
  NA/NaN/Inf in foreign function call (arg 10)
Calls: runAbsoluteCN -> do.call -> <Anonymous> -> .pruneByHclust -> hclust

```
What can be done to obtain Plodiy/Purity estimation? 

Thanks,
Nihir",npatel-ah,https://github.com/lima1/PureCN/issues/127
MDU6SXNzdWU2NTUyMzA4ODE=,Conda package outdated,CLOSED,2020-07-11T15:44:19Z,2020-07-12T18:25:13Z,2020-07-12T17:33:29Z,Please update this package https://anaconda.org/bioconda/bioconductor-purecn,slavnycoder,https://github.com/lima1/PureCN/issues/128
MDU6SXNzdWU2NTY3NjEzNTk=,error running Rscript PureCN.R,CLOSED,2020-07-14T16:59:22Z,2020-07-15T03:48:19Z,2020-07-15T03:48:19Z,"Hi, I started using PureCN recently and run into a problem.  When running the following command:
Rscript ~/R4.0.0/lib/R/library/PureCN/extdata/PureCN.R -i sampleid
            --tumor tumor.normcov.file
            --vcf vcf.file
            --normaldb, normdb
            --genome hg19
            --snpblacklist ../hg19_simpleRepeats.bed
            --mappingbiasfile ../mapping_bias.rds
            --out sampleid
            --postoptimize TRUE
            --intervals targets.filter.txt

It run to step of ""Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise."", then the following error:
""Error in mergeNamedAtomicVectors(genome(x), genome(y), what = c(""sequence"",  : 
  sequences 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, X, Y, MT, GL000207.1, GL000226.1, GL000229.1, GL000231.1, GL000210.1, GL000239.1, GL000235.1, GL000201.1, GL000247.1, GL000245.1, GL000197.1, GL000203.1, GL000246.1, GL000249.1, GL000196.1, GL000248.1, GL000244.1, GL000238.1, GL000202.1, GL000234.1, GL000232.1, GL000206.1, GL000240.1, GL000236.1, GL000241.1, GL000243.1, GL000242.1, GL000230.1, GL000237.1, GL000233.1, GL000204.1, GL000198.1, GL000208.1, GL000191.1, GL000227.1, GL000228.1, GL000214.1, GL000221.1, GL000209.1, GL000218.1, GL000220.1, GL000213.1, GL000211.1, GL000199.1, GL000217.1, GL000216.1, GL000215.1, GL000205.1, GL000219.1, GL000224.1, GL000223.1, GL000195.1, GL000212.1, GL000222.1, GL000200.1, GL000193.1, GL000194.1, GL000225.1, GL000192.1 have incompatible genomes:
  - in 'x': hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, hg19, h
Calls: runAbsoluteCN ... .Seqinfo.merge -> .Seqinfo.mergexy -> mergeNamedAtomicVectors
Execution halted""

I understand PureCN uses library(VariantAnnotation) to read the VCF file.  could you let me know what are the x and y in genome(x), genome(y)?  I guess one of them is vcf, not sure about the other one.  

Thanks a lot for your help.",bosmont,https://github.com/lima1/PureCN/issues/129
MDU6SXNzdWU2NjcxMDcyNjQ=,Functionality to create segment blacklist,OPEN,2020-07-28T14:11:52Z,2020-07-28T14:11:52Z,,There should be an easy way to ignore recurrent artifactual segments directly in the segmentation instead of doing those things downstream.,lima1,https://github.com/lima1/PureCN/issues/130
MDU6SXNzdWU2Njk5ODE3ODk=,Error: logical subscript contains NAs,CLOSED,2020-07-31T16:19:38Z,2020-08-03T17:05:48Z,2020-08-03T17:05:47Z,"I'm getting the errror - 'logical subscript contains NAs'. I know the problem is with my VCF, but I don't understand why my VCF is not compatible. Please help me understand where my VCF is failing.

INFO [2020-07-31 16:10:44] Loading PureCN 1.18.0...
INFO [2020-07-31 16:10:46] Mean coverages: chrX: 1972.98, chrY: 1488.86, chr1-22: 3972.70.
INFO [2020-07-31 16:10:46] Sample sex: M
INFO [2020-07-31 16:10:46] ------------------------------------------------------------
INFO [2020-07-31 16:10:46] PureCN 1.18.0
INFO [2020-07-31 16:10:46] ------------------------------------------------------------
INFO [2020-07-31 16:10:46] Arguments: -tumor.coverage.file ~/$SAMPID_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file ~/$SAMPID_SmallVariants.genome.dbsnp.vcf.gz -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.segmentation NULL,0.005,NULL -sampleid TMB-31_L2.UP04 -min.ploidy 1 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file ~/baits_hg19_intervals.txt -max.segments 300 -plot.cnv TRUE -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize FALSE -BPPARAM  -log.file ~/$SAMPID.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2020-07-31 16:10:46] Loading coverage files...
INFO [2020-07-31 16:10:47] Mean target coverages: 3892X (tumor) 3893X (normal).
INFO [2020-07-31 16:10:47] Mean coverages: chrX: 1972.98, chrY: 1488.86, chr1-22: 3972.70.
INFO [2020-07-31 16:10:47] Mean coverages: chrX: 1973.71, chrY: 1488.75, chr1-22: 3976.02.
INFO [2020-07-31 16:10:49] Removing 70 intervals with missing log.ratio.
INFO [2020-07-31 16:10:49] Removing 27 low/high GC targets.
INFO [2020-07-31 16:10:49] Removing 482 intervals excluded in normalDB.
INFO [2020-07-31 16:10:49] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2020-07-31 16:10:49] Removing 1419 low coverage (< 0.0015X) intervals.
INFO [2020-07-31 16:10:49] Using 23766 intervals (10002 on-target, 13764 off-target).
INFO [2020-07-31 16:10:49] Ratio of mean on-target vs. off-target read counts: 6.97
INFO [2020-07-31 16:10:49] Mean off-target bin size: 193706
INFO [2020-07-31 16:10:49] AT/GC dropout: 1.02 (tumor), 1.02 (normal).
INFO [2020-07-31 16:10:49] Loading VCF...
INFO [2020-07-31 16:11:12] Found 1983575 variants in VCF file.
WARN [2020-07-31 16:11:14] vcf.file has no DB or POP_AF info field for membership in germline databases. Guessing it based on available dbSNP ID.
INFO [2020-07-31 16:11:15] 3356 (0.2%) variants annotated as likely germline (DB INFO flag).
INFO [2020-07-31 16:12:08] Sample.stitched.bam is tumor in VCF file.
INFO [2020-07-31 16:12:18] 7 homozygous and 2 heterozygous variants on chrX.
INFO [2020-07-31 16:12:18] Sex from VCF: NA (Fisher's p-value: 0.009, odds-ratio: 6.82).
INFO [2020-07-31 16:13:56] Initial testing for significant sample cross-contamination: unlikely
Error: logical subscript contains NAs
Execution halted
",srhvng,https://github.com/lima1/PureCN/issues/131
MDU6SXNzdWU2NzI4Nzc0OTg=,Threshold for supporting reads,CLOSED,2020-08-04T15:22:43Z,2020-08-04T16:17:48Z,2020-08-04T16:11:50Z,"Hello Markus, 

I am running PureCN with Pisces VCF and with tumor only mode, and I observed that the supporting reads threshold is varied across the samples, I am curious to know if there is a way to control that or what goes into the calculation for setting the threshold. The reason I am bringing this up is that we have a known true positive somatic variant (very critical one) that is being filtered out due to the ""supporting reads"" threshold and I was hoping to rescue it by adjusting parameters. 


Best, 
Nihir",npatel-ah,https://github.com/lima1/PureCN/issues/133
MDU6SXNzdWU2NzMwNTE1MjA=,Error in PredictSomatic,CLOSED,2020-08-04T20:10:20Z,2020-08-04T22:07:06Z,2020-08-04T22:07:06Z,"Hello Markus, 

I think I have hit the blocker. I am getting the below error, that I didn't see till 1.19.10. 
```
Error in predictSomatic(ret, return.vcf = TRUE, vcf.field.prefix = ""PureCN."") :
  unused argument (vcf.field.prefix = ""PureCN."")
Execution halted

```
Best, 
Nihir


Sounds good. There were some rather extensive code cleanups after 1.19.9 that so far didn't seem to break anything, but let me know if something is weird - probably not your fault.

_Originally posted by @lima1 in https://github.com/lima1/PureCN/issues/133#issuecomment-668690397_",npatel-ah,https://github.com/lima1/PureCN/issues/134
MDU6SXNzdWU2NzU3ODgyNTM=,Resizing small target regions: IRanges 'width(x)' cannot contain negative integers,CLOSED,2020-08-09T23:02:48Z,2020-08-10T01:15:27Z,2020-08-10T01:15:27Z,"Hello,

I have installed PureCN from the master branch and am running into following error when running `IntervalFile.R`:
```
WARN [2020-08-09 18:49:10] Coverage data contains single nucleotide intervals.
WARN [2020-08-09 18:49:11] Found small target regions (< 100bp). Will resize them.
Error in validObject(x) : invalid class “IRanges” object:
    'width(x)' cannot contain negative integers
Calls: preprocessIntervals ... end<- -> end<- -> end<- -> .set_IRanges_end -> validObject
```
This seems to be caused by input target region `.bed` file for `--infile` option. After removing the target regions of length < 100bp, it seemed to run okay. However, it does throw out a decent number of lines in the `.bed` file and I was wondering if resizing process can be modified to avoid omitting them.

As a reference, I'm trying to use Agilent SureSelect V7 target regions.",djb17,https://github.com/lima1/PureCN/issues/135
MDU6SXNzdWU2NzYxNDk1MzE=,Testing using PureCN,CLOSED,2020-08-10T13:46:07Z,2020-08-14T15:27:27Z,2020-08-14T15:01:42Z,"Hi Markus,

I am trying to create a minimal ""system test"" dataset for PureCN, I am having some issues doing this at present, selecting small regions of the genome just seem to decrease the number of SNPs too much or does not provide enough informative intervals. Just curious if you have a simple example or a bit of guidance here, I have found some test files in PureCN/inst/extdata but I assume these are mostly for your unit tests.

Thanks!
Warren",waemm,https://github.com/lima1/PureCN/issues/136
MDU6SXNzdWU2NzkzNDMzMTM=,Unavailability of baits .bed file,CLOSED,2020-08-14T18:53:26Z,2020-08-17T16:05:13Z,2020-08-16T14:49:56Z,"Is there a recommended approach for processing files when baits are unknown or unavailable?

For TCGA data, many of WXS BAMs are generated using a custom exome capture kit which I believe is proprietary and not publicly available.

Edit: For those that are wondering, I was also able to retrieve `.bed` files for SureSelect Human All Exon 38Mb v2. You can do this by emailing Agilent informatics support and they will send you the link to download them.",djb17,https://github.com/lima1/PureCN/issues/137
MDU6SXNzdWU2ODgxNzQ0NTU=,Manual curation using flags,CLOSED,2020-08-28T15:56:31Z,2020-09-09T20:02:45Z,2020-09-03T17:25:15Z,"Hello again,

My samples (whole-exome sequencing; >100x; ovarian cancer) are have been flagged with the following (ordered from most occurring):

- NOISY LOG-RATIO (~95% of the samples)
- HIGH AT- OR LOW GC-DROPOUT (~65% of the samples)
  - Per sequence GC-content is > 60% for normal samples, deviating from the expected %.
  - Downloaded normal samples (males) from SRA to match the exome kit used (Agilent Sureselect v7).
- POOR GOF (~13% of the samples)
  - Fit % values range from 65-75%
- NOISY SEGMENTATION (~10% of the samples)
  - Followed vignette using Coverage.R
- RARE KARYOTYPE

I've gone through the FAQ section in the user manual including ""Questions related to manual curation"" and haven't been able to come to a good conclusion for a 1st-pass filtering. I think the noisy signals could be due to the apparent genomic instability observed in ovarian cancer, but any advice would be greatly appreciated.

Thanks!",djb17,https://github.com/lima1/PureCN/issues/138
MDU6SXNzdWU2OTE3NjMzMDA=,Attempted adding gene symbols to intervals. Heuristics have been used to pick symbols for overlapping genes.,CLOSED,2020-09-03T08:32:21Z,2020-09-03T13:25:50Z,2020-09-03T13:25:50Z,"Hello, I use 'pureCN/IntervalFile.R' for my geneset for research

There's an error message.

Attempted adding gene symbols to intervals. Heuristics have been used to pick symbols for overlapping genes.

Let me know the reason.

thank you.",starz77,https://github.com/lima1/PureCN/issues/139
MDU6SXNzdWU2OTI4OTYxMTg=,"Error in pdf(paste0(out, ""_segmentation.pdf""), width = 10, height = 11)",CLOSED,2020-09-04T08:34:05Z,2020-09-04T15:39:15Z,2020-09-04T15:39:15Z,"Hello,

there's an error message while running pureCN.R

Error in pdf(paste0(out, ""_segmentation.pdf""), width = 10, height = 11) :
  cannot open file '/P16_segmentation.pdf'
Execution halted

P16 is one of our sample names.

I haven't seen '.pdf' file in pureCN best practices.

why are these errors came from?

Thank you.",starz77,https://github.com/lima1/PureCN/issues/140
MDU6SXNzdWU2OTQ2MjI4NDg=,FATAL: Only tiny segments,CLOSED,2020-09-07T01:55:39Z,2020-09-08T02:32:44Z,2020-09-08T02:32:44Z,"Hello,

I'll report an error.

I wonder what 'tiny segments' means.

Error:

FATAL [2020-09-07 10:25:16] Only tiny segments.

FATAL [2020-09-07 10:25:16]

FATAL [2020-09-07 10:25:16] This runtime error might be caused by invalid input data or parameters.

FATAL [2020-09-07 10:25:16] Please report bug (PureCN 1.16.0).

Error: Only tiny segments.

This runtime error might be caused by invalid input data or parameters.
Please report bug (PureCN 1.16.0).
Execution halted

Thank you.",starz77,https://github.com/lima1/PureCN/issues/141
MDU6SXNzdWU2OTY5NTM2NDA=,Bug: segmentationPSCBS,CLOSED,2020-09-09T16:17:23Z,2020-09-15T15:32:07Z,2020-09-15T15:32:07Z,"Dear lima1, thank you for developing this fantastic package! 

I believe there may be an issue with segmentationPSCBS(). When running the example, a number of errors occur:

`normal.coverage.file <- system.file(""extdata"", ""example_normal_tiny.txt"",
     package=""PureCN"");
 tumor.coverage.file <- system.file(""extdata"", ""example_tumor_tiny.txt"",
     package=""PureCN"");
 vcf.file <- system.file(""extdata"", ""example.vcf.gz"",
     package=""PureCN"");
  ret <-runAbsoluteCN(normal.coverage.file=normal.coverage.file,
      tumor.coverage.file=tumor.coverage.file, vcf.file=vcf.file,
      sampleid=""Sample1"",  genome=""hg19"",
      fun.segmentation=segmentationPSCBS, max.ploidy=4,
      test.purity=seq(0.3,0.7,by=0.05), max.candidate.solutions=1)
`

`
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chr17,length=81195210,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chr17,length=81195210,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chr18,length=78077248,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chr18,length=78077248,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chr19,length=59128983,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chr19,length=59128983,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chr20,length=63025520,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chr20,length=63025520,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chr21,length=48129895,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chr21,length=48129895,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chr22,length=51304566,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chr22,length=51304566,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chrX,length=155270560,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chrX,length=155270560,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chrY,length=59373566,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chrY,length=59373566,assembly=""""hg19"""">
[E::bcf_hdr_parse_line] Could not parse the header line: ""##contig=<ID=chrM,length=16571,assembly=""""hg19"""">""
[W::bcf_hdr_parse] Could not parse header line: ##contig=<ID=chrM,length=16571,assembly=""""hg19"""">
...
`

Moreover, when running with real data but only specifying `log.ratio`, leads to the following error:

`
Error in h(simpleError(msg, call)) :
  error in evaluating the argument 'x' in selecting a method for function 'unique': error in evaluating the argument 'x' in selecting a method for function 'seqlevels': argument ""tumor"" is missing, with no default
`

I've traced this down to the following line in the code:

`if (is.null(chr.hash)) chr.hash <- .getChrHash(seqlevels(tumor))`


Session info below:

`
> sessionInfo()
R version 4.0.2 (2020-06-22)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-openmp/libopenblasp-r0.3.8.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] parallel  stats4    stats     graphics  grDevices utils     datasets
[8] methods   base

other attached packages:
 [1] PureCN_1.18.1                     VariantAnnotation_1.34.0
 [3] Rsamtools_2.4.0                   SummarizedExperiment_1.18.2
 [5] DelayedArray_0.14.1               matrixStats_0.56.0
 [7] Biobase_2.48.0                    DNAcopy_1.62.0
 [9] PSCBS_0.65.0                      ggplot2_3.3.2
[11] BSgenome.Hsapiens.UCSC.hg19_1.4.3 BSgenome_1.56.0
[13] rtracklayer_1.48.0                Biostrings_2.56.0
[15] XVector_0.28.0                    GenomicRanges_1.40.0
[17] GenomeInfoDb_1.24.2               IRanges_2.22.2
[19] S4Vectors_0.26.1                  BiocGenerics_0.34.0
[21] glue_1.4.1                        checkmate_2.0.0
[23] dplyr_1.0.0                       magrittr_1.5
[25] futile.logger_1.4.3               R.utils_2.9.2
[27] R.oo_1.23.0                       R.methodsS3_1.8.0
[29] argparse_2.0.1

loaded via a namespace (and not attached):
 [1] bitops_1.0-6             bit64_4.0.5              RColorBrewer_1.1-2
 [4] progress_1.2.2           httr_1.4.1               R.cache_0.14.0
 [7] tools_4.0.2              backports_1.1.8          R6_2.4.1
[10] DBI_1.1.0                colorspace_1.4-1         withr_2.2.0
[13] gridExtra_2.3            tidyselect_1.1.0         prettyunits_1.1.1
[16] bit_4.0.4                curl_4.3                 compiler_4.0.2
[19] formatR_1.7              scales_1.1.1             readr_1.3.1
[22] askpass_1.1              rappdirs_0.3.1           stringr_1.4.0
[25] digest_0.6.25            pkgconfig_2.0.3          dbplyr_1.4.4
[28] rlang_0.4.6              VGAM_1.1-3               RSQLite_2.2.0
[31] generics_0.0.2           jsonlite_1.7.0           BiocParallel_1.22.0
[34] RCurl_1.98-1.2           GenomeInfoDbData_1.2.3   Matrix_1.2-18
[37] Rhdf5lib_1.10.1          Rcpp_1.0.4.6             munsell_0.5.0
[40] lifecycle_0.2.0          stringi_1.4.6            zlibbioc_1.34.0
[43] rhdf5_2.32.2             BiocFileCache_1.12.1     grid_4.0.2
[46] blob_1.2.1               listenv_0.8.0            crayon_1.3.4
[49] lattice_0.20-41          splines_4.0.2            GenomicFeatures_1.40.1
[52] findpython_1.0.5         hms_0.5.3                pillar_1.4.4
[55] codetools_0.2-16         biomaRt_2.44.1           futile.options_1.0.1
[58] XML_3.99-0.3             data.table_1.12.8        lambda.r_1.2.4
[61] vctrs_0.3.1              gtable_0.3.0             openssl_1.4.2
[64] purrr_0.3.4              future_1.18.0            assertthat_0.2.1
[67] aroma.light_3.18.0       tibble_3.0.1             GenomicAlignments_1.24.0
[70] AnnotationDbi_1.50.3     memoise_1.1.0            globals_0.12.5
[73] ellipsis_0.3.1
>

`

Thanks you, and looking forward to hearing from you!",MaxSalm,https://github.com/lima1/PureCN/issues/143
MDU6SXNzdWU2OTc2Mjk0NjM=,Determining sample quality,CLOSED,2020-09-10T08:47:29Z,2020-09-14T16:30:01Z,2020-09-14T16:08:35Z,"Hi Markus,

I recently analysed a tumour sample that has very few somatic variants this is strange given that in similar tumour samples we get ample variants. When I run this sample through PureCN I get very few predicted somatic variants and I include the first segmentation results below. From what I can see the log ratio changes are minimal and it looks like there is very little change across the genome. Is it likely we're just looking at normal tissue here? Are there other values/plots I'm missing that could help me make an assessment here? 

sample info:
""Sampleid"",""Purity"",""Ploidy"",""Sex"",""Contamination"",""Flagged"",""Failed"",""Curated"",""Comment""
""HNO.6338375_30001813"",0.36,2.98304674298337,""M"",0,TRUE,FALSE,FALSE,""NOISY SEGMENTATION""

![image](https://user-images.githubusercontent.com/71687/92701923-7c7d4200-f348-11ea-9b5c-2786e6c79110.png)

![image](https://user-images.githubusercontent.com/71687/92701949-83a45000-f348-11ea-9df3-2f649c1b29f1.png)

![image](https://user-images.githubusercontent.com/71687/92703103-d6323c00-f349-11ea-88da-7094af60424f.png)

",waemm,https://github.com/lima1/PureCN/issues/144
MDU6SXNzdWU3MDI1ODU3ODg=,trying to set metadata columns of length,CLOSED,2020-09-16T08:58:15Z,2020-09-17T04:33:12Z,2020-09-17T03:59:47Z,"Hello,

I want to make a new interval for pureCN.

there's an error
: Error in S4Vectors:::normarg_mcols(mcols, Class, ans_len) :
  trying to set metadata columns of length 462471 on an object of length
  0
Calls: preprocessIntervals ... .readCoverageGatk3 -> GRanges -> new_GRanges -> <Anonymous>
Execution halted

when I use the previous bed file there's no error.

why is this happening?

Thank you.",starz77,https://github.com/lima1/PureCN/issues/145
MDU6SXNzdWU3MDMzNjE2ODI=,RFE: Provide a function to plot only segmentation results,CLOSED,2020-09-17T08:00:51Z,2020-09-17T14:23:21Z,2020-09-17T14:23:21Z,"PureCN.R produces, as part of the `RunAbsoluteCN` call, plots of segments with total copy number, without BAF and the other plots, the one that are saved with the name `<sampleid>_segmentation.pdf`. <strike>As far as my cursory look in the code suggests, there is no way to plot them otherwise.</strike>

It would be useful to have a function to plot the segments and the individual copy number bins.  Use case: produce some of the plots as part of reports/figures, when you're not interested in the BAF but you are interested in the copy number and segments alone, especially if you have PureCN handle the segmentation (otherwise you could use CNVkit or the GATK to do the plots).",lbeltrame,https://github.com/lima1/PureCN/issues/146
MDU6SXNzdWU3MDM0OTM0MDQ=,% SNP using bcbio mutect2 pipeline,CLOSED,2020-09-17T11:14:20Z,2020-09-21T08:00:28Z,2020-09-19T14:39:55Z,"Hi MArkus,

I am now running using a padded exome bed, ive included both a PON for mutect and for purecn. It looks like this resolved the off target SD issues but the known germline are lower:

extracts from a few logs:

INFO [2020-09-16 16:45:33] Mean standard deviation of log-ratios: 0.34
INFO [2020-09-16 16:45:33] Mean standard deviation of on-target log-ratios only: 0.32
INFO [2020-09-16 16:45:33] Mean standard deviation of off-target log-ratios only: 0.70
INFO [2020-09-16 16:52:11] Mean standard deviation of log-ratios: 0.30
INFO [2020-09-16 16:52:11] Mean standard deviation of on-target log-ratios only: 0.28
INFO [2020-09-16 16:52:11] Mean standard deviation of off-target log-ratios only: 0.66
INFO [2020-09-16 16:52:46] Mean standard deviation of log-ratios: 0.33
INFO [2020-09-16 16:52:46] Mean standard deviation of on-target log-ratios only: 0.32
INFO [2020-09-16 16:52:46] Mean standard deviation of off-target log-ratios only: 0.55

For germline:

INFO [2020-09-16 16:50:54] 45063 (52.1%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:44:13] 50029 (37.7%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:52:08] 46201 (55.9%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:51:10] 47388 (53.2%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:50:55] 47164 (54.5%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:51:10] 47518 (51.8%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:50:55] 48162 (55.1%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:51:09] 47762 (55.3%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:51:10] 47584 (53.2%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:51:09] 46565 (56.6%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:44:10] 47370 (51.6%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:50:54] 47146 (57.7%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-16 16:51:10] 47319 (54.0%) variants annotated as likely germline (DB INFO flag).

Could this be because I'm using bcbio mutect version? ",waemm,https://github.com/lima1/PureCN/issues/147
MDU6SXNzdWU3MDUyNDYwODA=,Only tiny segments.,CLOSED,2020-09-21T02:41:43Z,2020-09-23T16:27:18Z,2020-09-23T16:27:18Z,"Hello,

I already posted about this issue before.

The previous issue was due to low coverage.

So I changed the '.bed' file and checked the coverage of '.bam' file

but the same error happened.

Here's my log.

INFO [2020-09-21 10:32:01] PureCN 1.16.0
INFO [2020-09-21 10:32:01] ------------------------------------------------------------
INFO [2020-09-21 10:32:01] Arguments: -normal.coverage.file /bio/scratch/starz77/sylee/pureCN/pureCN_Result/P42/P42_N/P42_N.bwamem.sorted.dedup.realn.recal.dedup_coverage_loess.txt.gz -tumor.coverage.file /bio/scratch/starz77/sylee/pureCN/pureCN_Result/P42/P42_T/P42_T.bwamem.sorted.dedup.realn.recal.dedup_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /bio/scratch/starz77/sylee/Mutect2_result/P42/P42.somatic.mutect2.vcf -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.segmentation NULL,0.005,NULL -sampleid P42 -min.ploidy 1 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /bio/scratch/starz77/sylee/pureCN/pureCN_Ref/S04380110_AllTracks.interval.txt -max.segments 300 -plot.cnv TRUE -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize FALSE -BPPARAM  -log.file /bio/scratch/starz77/sylee/pureCN/pureCN_Result/P42/P42.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2020-09-21 10:32:01] Loading coverage files...
INFO [2020-09-21 10:32:17] Mean target coverages: 143X (tumor) 69X (normal).
INFO [2020-09-21 10:32:18] Mean coverages: chrX: 72.67, chrY: 5.83, chr1-22: 134.52.
INFO [2020-09-21 10:32:18] Mean coverages: chrX: 34.95, chrY: 35.31, chr1-22: 66.01.
INFO [2020-09-21 10:32:38] Removing 690 intervals with missing log.ratio.
INFO [2020-09-21 10:32:38] Removing 84 intervals with low total coverage in normal (< 150.00 reads).
WARN [2020-09-21 10:32:38] No normalDB provided. Provide one for better results.
INFO [2020-09-21 10:32:38] Removing 36845 low coverage (< 15.0000X) intervals.
INFO [2020-09-21 10:32:38] Using 235197 intervals (235190 on-target, 7 off-target).
INFO [2020-09-21 10:32:38] Ratio of mean on-target vs. off-target read counts: 0.03
INFO [2020-09-21 10:32:38] Mean off-target bin size: 91089
INFO [2020-09-21 10:32:39] AT/GC dropout: 0.99 (tumor), 0.98 (normal).
INFO [2020-09-21 10:32:39] Loading VCF...
INFO [2020-09-21 10:34:02] Found 2331555 variants in VCF file.
INFO [2020-09-21 10:34:11] Removing 7779 triallelic sites.
WARN [2020-09-21 10:34:54] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2020-09-21 10:35:04] 2323776 (100.0%) variants annotated as likely germline (DB INFO flag).
INFO [2020-09-21 10:37:19] P42_T is tumor in VCF file.
INFO [2020-09-21 10:37:46] 1115 homozygous and 511 heterozygous variants on chrX.
INFO [2020-09-21 10:37:46] Sex from VCF: NA (Fisher's p-value: < 0.0001, odds-ratio: 3.99).
INFO [2020-09-21 10:38:03] Removing 2259762 non heterozygous (in matched normal) germline SNPs.
INFO [2020-09-21 10:38:14] Initial testing for significant sample cross-contamination: unlikely
INFO [2020-09-21 10:38:16] Removing 17040 variants with AF < 0.030 or AF >= 1.000 or less than 4 supporting reads or depth < 15.
INFO [2020-09-21 10:38:16] Removing 0 low quality variants with BQ < 25.
INFO [2020-09-21 10:38:16] Total size of targeted genomic region: 47.77Mb (66.82Mb with 50bp padding).
INFO [2020-09-21 10:38:17] 11.4% of targets contain variants.
INFO [2020-09-21 10:38:17] Removing 15801 variants outside intervals.
INFO [2020-09-21 10:38:18] Found SOMATIC annotation in VCF.
INFO [2020-09-21 10:38:18] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2020-09-21 10:38:18] Found SOMATIC annotation in VCF. Setting mapping bias to 0.978.
INFO [2020-09-21 10:38:18] Excluding 0 novel or poor quality variants from segmentation.
INFO [2020-09-21 10:38:18] Sample sex: M
INFO [2020-09-21 10:38:18] Segmenting data...
INFO [2020-09-21 10:38:18] Loading pre-computed boundaries for DNAcopy...
INFO [2020-09-21 10:38:18] Setting undo.SD parameter to 1.000000.
INFO [2020-09-21 10:39:01] Setting undo.SD parameter to 1.500000.
Setting multi-figure configuration
INFO [2020-09-21 10:40:01] Setting prune.hclust.h parameter to 0.200000.
INFO [2020-09-21 10:40:02] Found 271 segments with median size of 0.90Mb.
INFO [2020-09-21 10:40:02] Removing 20 variants outside segments.
INFO [2020-09-21 10:40:02] Using 31153 variants.
FATAL [2020-09-21 10:40:04] Only tiny segments.

FATAL [2020-09-21 10:40:04]

FATAL [2020-09-21 10:40:04] This runtime error might be caused by invalid input data or parameters.

FATAL [2020-09-21 10:40:04] Please report bug (PureCN 1.16.0).

Error: Only tiny segments.

This runtime error might be caused by invalid input data or parameters.
Please report bug (PureCN 1.16.0).
Execution halted

--------------------------------------------------------------------------------------------------------------------

Mean target coverages: 143X (tumor) 69X (normal).

I think the coverage is high enough, is it still low for pureCN?

Thank you",starz77,https://github.com/lima1/PureCN/issues/148
MDU6SXNzdWU3MDc4NDk0NTE=,different row counts implied by arguments,CLOSED,2020-09-24T04:45:46Z,2021-04-06T21:26:02Z,2021-04-06T21:26:01Z,"Hello,

I got an error.
Error in DataFrame(..., check.names = FALSE) :
  different row counts implied by arguments

what does 'different row counts' means?

Here's my script

i=$sample_id
Rscript $PURECN/PureCN.R --out $OUTPUT/$i \
    --tumor $OUTPUT/$i/$i""_T""/$i""_T.bwamem.sorted.dedup.realn.recal.dedup_coverage_loess.txt.gz"" \
    --normal $OUTPUT/$i/$i""_N""/$i""_N.bwamem.sorted.dedup.realn.recal.dedup_coverage_loess.txt.gz"" \
    --sampleid $i \
    --normaldb $OUT_REF/normalDB_hg19.rds \
    --vcf /bio/scratch/starz77/sylee/Mutect2_result/$i/$i"".somatic.mutect2.vcf"" \
    --intervals $OUT_REF/SureSelect.V5.Covered.interval.txt \
    --genome hg19

Thank you.",starz77,https://github.com/lima1/PureCN/issues/149
MDU6SXNzdWU3MjE5MjEwNjc=,Error in ecdf_chr[[calls$chr[i]]] : subscript out of bounds ,CLOSED,2020-10-15T02:30:09Z,2020-10-20T03:43:44Z,2020-10-19T18:48:35Z,"Hello:
    I got an error when running `PureCN.R` according to the **PureCN best practices**, as shown below.
Could you help me how to solve it?

```
# Without a matched normal (minimal test run)
$ Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID \
    --tumor $OUT/$SAMPLEID/${SAMPLEID}_coverage_loess.txt.gz \
    --sampleid $SAMPLEID \
    --vcf ${SAMPLEID}_mutect.vcf \
    --normaldb $OUT_REF/normalDB_hg19.rds \
    --intervals $OUT_REF/baits_hg19_intervals.txt \
    --genome hg19 
```
vcf files generate from gatk4 Mutect2, below is code:
```
gatk Mutect2 \
-R /workdir/fasta/hg19/hg19.fa \
-L /workdir/bed/62gene_20200427.bed \
-I 0920-cs-10_.bqsr.bam \
-O 0920-cs-10_.purecn.vcf.gz \
--germline-resource /workdir/gatk/hg19.gnomad.vcf.gz \
-pon /workdir/pon/PoN_hg19_62gene/pon/pon.vcf.gz \
--genotype-germline-sites true
```

And this is the log:
```
[1] ""/workdir/62gene/202009/20200923/purecn/tumor""
INFO [2020-10-15 10:05:53] Loading PureCN 1.18.1...
INFO [2020-10-15 10:05:55] ------------------------------------------------------------
INFO [2020-10-15 10:05:55] PureCN 1.18.1
INFO [2020-10-15 10:05:55] ------------------------------------------------------------
INFO [2020-10-15 10:05:56] Arguments: -tumor.coverage.file /workdir/62gene/202009/20200923/purecn/tumor/0920-cs-11_.bqsr_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file 0920-cs-11_.purecn.vcf.gz -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.segmentation NULL,0.005,NULL -sampleid 0920-cs-11_ -min.ploidy 1 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /workdir/purecn_ref/62gene_20200427_baits_hg19_intervals.txt -max.segments 300 -plot.cnv TRUE -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize FALSE -BPPARAM  -log.file .//0920-cs-11_.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2020-10-15 10:05:56] Loading coverage files...
INFO [2020-10-15 10:05:56] Mean target coverages: 2454X (tumor) 2389X (normal).
WARN [2020-10-15 10:05:56] Allosome coverage missing, cannot determine sex.
WARN [2020-10-15 10:05:56] Allosome coverage missing, cannot determine sex.
INFO [2020-10-15 10:05:57] Removing 58 intervals with missing log.ratio.
INFO [2020-10-15 10:05:57] Removing 23 low/high GC targets.
INFO [2020-10-15 10:05:57] Removing 31 intervals excluded in normalDB.
INFO [2020-10-15 10:05:57] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2020-10-15 10:05:57] Using 13623 intervals (685 on-target, 12938 off-target).
INFO [2020-10-15 10:05:57] Ratio of mean on-target vs. off-target read counts: 55.76
INFO [2020-10-15 10:05:57] Mean off-target bin size: 197702
INFO [2020-10-15 10:05:57] AT/GC dropout: 1.03 (tumor), 1.02 (normal). 
INFO [2020-10-15 10:05:57] Loading VCF...
INFO [2020-10-15 10:05:57] Found 532 variants in VCF file.
INFO [2020-10-15 10:05:57] Removing 30 triallelic sites.
WARN [2020-10-15 10:05:58] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2020-10-15 10:05:58] 499 (99.4%) variants annotated as likely germline (DB INFO flag).
INFO [2020-10-15 10:05:58] 0920-cs-11_ is tumor in VCF file.
INFO [2020-10-15 10:05:58] No variants on chrX in VCF.
INFO [2020-10-15 10:05:59] Initial testing for significant sample cross-contamination: maybe
INFO [2020-10-15 10:06:00] Removing 126 variants with AF < 0.030 or AF >= 0.970 or less than 9 supporting reads or depth < 15.
INFO [2020-10-15 10:06:00] Removing 0 low quality variants with BQ < 25.
INFO [2020-10-15 10:06:00] Total size of targeted genomic region: 0.16Mb (0.21Mb with 50bp padding).
INFO [2020-10-15 10:06:00] 41.2% of targets contain variants.
INFO [2020-10-15 10:06:00] Removing 8 variants outside intervals.
INFO [2020-10-15 10:06:00] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2020-10-15 10:06:00] VCF does not contain somatic status. For best results, consider providing mapping.bias.file when matched normals are not available.
INFO [2020-10-15 10:06:00] Excluding 1 novel or poor quality variants from segmentation.
INFO [2020-10-15 10:06:00] Sample sex: ?
INFO [2020-10-15 10:06:00] Segmenting data...
INFO [2020-10-15 10:06:00] Interval weights found, will use weighted CBS.
INFO [2020-10-15 10:06:00] Loading pre-computed boundaries for DNAcopy...
INFO [2020-10-15 10:06:00] Setting undo.SD parameter to 1.000000.
Setting multi-figure configuration
INFO [2020-10-15 10:06:01] Setting prune.hclust.h parameter to 0.100000.
INFO [2020-10-15 10:06:01] Found 26 segments with median size of 90.39Mb.
INFO [2020-10-15 10:06:01] Using 368 variants.
INFO [2020-10-15 10:06:02] Mean standard deviation of log-ratios: 0.44
INFO [2020-10-15 10:06:02] Mean standard deviation of on-target log-ratios only: 0.12
INFO [2020-10-15 10:06:02] Mean standard deviation of off-target log-ratios only: 0.46
INFO [2020-10-15 10:06:02] 2D-grid search of purity and ploidy...
INFO [2020-10-15 10:06:26] Local optima: 0.15/2.2, 0.15/1.9, 0.17/2, 0.27/2.6, 0.27/2, 0.35/2.4,
0.31/3, 0.48/3, 0.52/2.6, 0.55/4.2, 0.92/5.8, 0.68/4.8, 0.68/2.8,
0.45/1.6, 0.85/3, 0.52/2, 0.78/2, 0.62/1.4, 0.82/1.2, 0.95/1
INFO [2020-10-15 10:06:26] Testing local optimum 1/20 at purity 0.15 and total ploidy 2.20...
INFO [2020-10-15 10:06:29] Testing local optimum 2/20 at purity 0.15 and total ploidy 1.90...
INFO [2020-10-15 10:06:31] Testing local optimum 3/20 at purity 0.17 and total ploidy 2.00...
INFO [2020-10-15 10:06:34] Testing local optimum 4/20 at purity 0.27 and total ploidy 2.60...
INFO [2020-10-15 10:06:36] Testing local optimum 5/20 at purity 0.27 and total ploidy 2.00...
INFO [2020-10-15 10:06:41] Testing local optimum 6/20 at purity 0.35 and total ploidy 2.40...
INFO [2020-10-15 10:06:43] Testing local optimum 7/20 at purity 0.31 and total ploidy 3.00...
INFO [2020-10-15 10:06:45] Testing local optimum 8/20 at purity 0.48 and total ploidy 3.00...
INFO [2020-10-15 10:06:47] Testing local optimum 9/20 at purity 0.52 and total ploidy 2.60...
INFO [2020-10-15 10:06:50] Testing local optimum 10/20 at purity 0.55 and total ploidy 4.20...
INFO [2020-10-15 10:06:51] Testing local optimum 11/20 at purity 0.92 and total ploidy 5.80...
INFO [2020-10-15 10:06:53] Testing local optimum 12/20 at purity 0.68 and total ploidy 4.80...
INFO [2020-10-15 10:06:55] Testing local optimum 13/20 at purity 0.68 and total ploidy 2.80...
INFO [2020-10-15 10:06:58] Testing local optimum 14/20 at purity 0.45 and total ploidy 1.60...
INFO [2020-10-15 10:07:01] Testing local optimum 15/20 at purity 0.85 and total ploidy 3.00...
INFO [2020-10-15 10:07:04] Testing local optimum 16/20 at purity 0.52 and total ploidy 2.00...
INFO [2020-10-15 10:07:06] Testing local optimum 17/20 at purity 0.78 and total ploidy 2.00...
INFO [2020-10-15 10:07:07] Testing local optimum 18/20 at purity 0.62 and total ploidy 1.40...
INFO [2020-10-15 10:07:09] Testing local optimum 19/20 at purity 0.82 and total ploidy 1.20...
INFO [2020-10-15 10:07:10] Testing local optimum 20/20 at purity 0.95 and total ploidy 1.00...
INFO [2020-10-15 10:07:11] Skipping 1 solutions that converged to the same optima.
INFO [2020-10-15 10:07:11] Fitting variants for local optimum 1/20...
INFO [2020-10-15 10:07:11] Fitting variants for purity 0.15, tumor ploidy 3.37 and contamination 0.01.
INFO [2020-10-15 10:07:14] Optimized purity: 0.15
INFO [2020-10-15 10:07:14] Fitting variants for local optimum 2/20...
INFO [2020-10-15 10:07:14] Fitting variants for purity 0.15, tumor ploidy 1.58 and contamination 0.01.
INFO [2020-10-15 10:07:17] Optimized purity: 0.15
INFO [2020-10-15 10:07:17] Fitting variants for local optimum 4/20...
INFO [2020-10-15 10:07:17] Fitting variants for purity 0.26, tumor ploidy 4.18 and contamination 0.01.
INFO [2020-10-15 10:07:19] Optimized purity: 0.26
INFO [2020-10-15 10:07:19] Fitting variants for local optimum 5/20...
INFO [2020-10-15 10:07:19] Fitting variants for purity 0.18, tumor ploidy 2.17 and contamination 0.01.
INFO [2020-10-15 10:07:22] Optimized purity: 0.18
INFO [2020-10-15 10:07:22] Fitting variants for local optimum 6/20...
INFO [2020-10-15 10:07:22] Fitting variants for purity 0.32, tumor ploidy 3.09 and contamination 0.01.
INFO [2020-10-15 10:07:24] Optimized purity: 0.32
INFO [2020-10-15 10:07:24] Fitting variants for local optimum 7/20...
INFO [2020-10-15 10:07:24] Fitting variants for purity 0.29, tumor ploidy 5.18 and contamination 0.01.
INFO [2020-10-15 10:07:27] Optimized purity: 0.29
INFO [2020-10-15 10:07:27] Fitting variants for local optimum 8/20...
INFO [2020-10-15 10:07:27] Fitting variants for purity 0.49, tumor ploidy 4.12 and contamination 0.01.
INFO [2020-10-15 10:07:30] Optimized purity: 0.49
INFO [2020-10-15 10:07:30] Fitting variants for local optimum 9/20...
INFO [2020-10-15 10:07:30] Fitting variants for purity 0.40, tumor ploidy 3.12 and contamination 0.01.
INFO [2020-10-15 10:07:32] Optimized purity: 0.40
INFO [2020-10-15 10:07:32] Fitting variants for local optimum 10/20...
INFO [2020-10-15 10:07:32] Fitting variants for purity 0.55, tumor ploidy 5.93 and contamination 0.01.
INFO [2020-10-15 10:07:35] Optimized purity: 0.55
INFO [2020-10-15 10:07:35] Fitting variants for local optimum 11/20...
INFO [2020-10-15 10:07:35] Fitting variants for purity 0.87, tumor ploidy 5.96 and contamination 0.01.
INFO [2020-10-15 10:07:37] Optimized purity: 0.87
INFO [2020-10-15 10:07:37] Fitting variants for local optimum 12/20...
INFO [2020-10-15 10:07:37] Fitting variants for purity 0.66, tumor ploidy 5.95 and contamination 0.01.
INFO [2020-10-15 10:07:41] Optimized purity: 0.66
INFO [2020-10-15 10:07:41] Fitting variants for local optimum 13/20...
INFO [2020-10-15 10:07:41] Fitting variants for purity 0.49, tumor ploidy 3.13 and contamination 0.01.
INFO [2020-10-15 10:07:44] Optimized purity: 0.49
INFO [2020-10-15 10:07:44] Fitting variants for local optimum 14/20...
INFO [2020-10-15 10:07:44] Fitting variants for purity 0.32, tumor ploidy 1.16 and contamination 0.01.
INFO [2020-10-15 10:07:47] Optimized purity: 0.32
INFO [2020-10-15 10:07:47] Fitting variants for local optimum 15/20...
INFO [2020-10-15 10:07:47] Fitting variants for purity 0.65, tumor ploidy 3.16 and contamination 0.01.
INFO [2020-10-15 10:07:51] Optimized purity: 0.65
INFO [2020-10-15 10:07:51] Fitting variants for local optimum 16/20...
INFO [2020-10-15 10:07:51] Fitting variants for purity 0.32, tumor ploidy 2.12 and contamination 0.01.
INFO [2020-10-15 10:07:54] Optimized purity: 0.32
INFO [2020-10-15 10:07:54] Fitting variants for local optimum 17/20...
INFO [2020-10-15 10:07:54] Fitting variants for purity 0.59, tumor ploidy 2.16 and contamination 0.01.
INFO [2020-10-15 10:07:57] Optimized purity: 0.59
INFO [2020-10-15 10:07:57] Fitting variants for local optimum 18/20...
INFO [2020-10-15 10:07:57] Fitting variants for purity 0.64, tumor ploidy 1.01 and contamination 0.01.
INFO [2020-10-15 10:08:00] Optimized purity: 0.64
INFO [2020-10-15 10:08:00] Fitting variants for local optimum 19/20...
INFO [2020-10-15 10:08:00] Fitting variants for purity 0.84, tumor ploidy 1.00 and contamination 0.01.
INFO [2020-10-15 10:08:03] Optimized purity: 0.84
INFO [2020-10-15 10:08:03] Fitting variants for local optimum 20/20...
INFO [2020-10-15 10:08:03] Fitting variants for purity 0.93, tumor ploidy 1.00 and contamination 0.01.
INFO [2020-10-15 10:08:06] Optimized purity: 0.93
INFO [2020-10-15 10:08:06] Done.
INFO [2020-10-15 10:08:06] ------------------------------------------------------------
INFO [2020-10-15 10:08:06] Generating output files...
INFO [2020-10-15 10:08:09] Tumor/normal noise ratio: 38.496
WARN [2020-10-15 10:08:09] Extensive noise in tumor compared to normals.
Error in ecdf_chr[[calls$chr[i]]] : subscript out of bounds 
Calls: callAmplificationsInLowPurity -> sapply -> lapply -> FUN

```",axiba053,https://github.com/lima1/PureCN/issues/150
MDU6SXNzdWU3MjQ1OTM2NDY=,No intervals left after coverage checks. - from NormalDB.R,CLOSED,2020-10-19T13:08:04Z,2020-10-20T17:39:50Z,2020-10-20T17:39:50Z,"I've attached my code and output log file below, would highly appreciate any guidance I can get on this please!

Output log file:
INFO [2020-10-19 17:22:49] Loading PureCN 1.18.1...
INFO [2020-10-19 17:23:08] Creating mapping bias database.
INFO [2020-10-19 17:23:09] Processing variants 1 to 5000...
INFO [2020-10-19 17:29:33] Processing variants 5001 to 10000...
INFO [2020-10-19 17:37:13] Processing variants 10001 to 15000...
INFO [2020-10-19 17:41:08] Creating normalDB. Assuming coverage files are GC-normalized.
INFO [2020-10-19 17:41:52] 26 on-target bins with low coverage in all samples.
WARN [2020-10-19 17:41:52] Allosome coverage missing, cannot determine sex.
.
. (the same lines occur for a while)
.
WARN [2020-10-19 17:41:52] Allosome coverage missing, cannot determine sex.
INFO [2020-10-19 17:41:52] Processing on-target regions...
INFO [2020-10-19 17:41:53] Removing 904 intervals with low coverage in normalDB.
INFO [2020-10-19 17:41:53] Removing 1 intervals with zero coverage in more than 3% of normalDB.
INFO [2020-10-19 17:41:54] Processing off-target regions...
INFO [2020-10-19 17:41:54] Removing 14802 intervals with low coverage in normalDB.
**FATAL [2020-10-19 17:41:54] No intervals left after coverage checks.

FATAL [2020-10-19 17:41:54]

FATAL [2020-10-19 17:41:54] This is most likely a user error due to invalid input data or

FATAL [2020-10-19 17:41:54] parameters (PureCN 1.18.1).**

My questions here are:
1) For the on-target regions, how can I find out what the 904 intervals with low coverage are?
2) How are low coverage reads defined?
3) I've tried a quite a few variations (with and without a normal-panel), but I keep getting the same error - how do I troubleshoot from here?

```
DIR=/software/R/4.0.2/bin
PURECN=/home/nicolesawyl/R/x86_64-pc-linux-gnu-library/4.0/PureCN/extdata
OUT_DIR=/home/nicolesawyl/PureCN
PON=/home/nicolesawyl/PureCN/MuTect2_PON.vcf.gz

#creates interval file
$DIR/Rscript $PURECN/IntervalFile.R \
--infile /home/nicolesawyl/PureCN/targetbed.sorted.bed.gz \
--fasta /resources/fdb/GRCh38_HPV/Sequence/BWAIndex/GCA_000001405.15_GRCh38_no_alt_analysis_set_HPV.fa \
--outfile $OUT_DIR/2_baits_hg38_intervals.txt \
--offtarget --genome hg38 --mintargetwidth 10 \
--export $OUT_DIR/2_baits_optimized_hg38.bed \
--mappability $OUT_DIR/GCA_000001405.15_GRCh38_no_alt_analysis_set_100.bw

#calculate and GC-normalize coverage from a list of BAM files 
$DIR/Rscript $PURECN/Coverage.R \
--outdir $OUT_DIR/Tumors \
--bam $OUT_DIR/tumors.list \
--intervals $OUT_DIR/2_baits_hg38_intervals.txt \
--cores 4

$DIR/Rscript $PURECN/Coverage.R \
--outdir $OUT_DIR/Normals \
--bam $OUT_DIR/normals.list \
--intervals $OUT_DIR/2_baits_hg38_intervals.txt \
--cores 4

#build a normal database for coverage normalization
$DIR/Rscript $PURECN/NormalDB.R \
--outdir $OUT_DIR \
--coveragefiles /home/nicolesawyl/PureCN/normal.loess.list \
--genome hg38 --normal_panel $PON
```
",yls2g13,https://github.com/lima1/PureCN/issues/151
MDU6SXNzdWU3NDA0Njg2MjA=,Question about gender prediction,CLOSED,2020-11-11T05:15:48Z,2020-12-03T05:16:46Z,2020-11-18T21:34:18Z,"Hi,
I am running a sample with high purity in WGS result but low in pureCN.  I noticed that for the Sex column, it has ""Coverage: M VCF: F"".  For the analysis, I used the seg file from cnvkit, and VCF was generated using Mutect1.1.4 with matched tumour-normal pair without additional filtering.    Reading the readme, I assume I don't need to filter the VCF generated by Mutect.  Is it correct?  Thanks in advance for your help.

",yisu-li,https://github.com/lima1/PureCN/issues/152
MDU6SXNzdWU3NDcwNTUwMjg=,error on make interval file,CLOSED,2020-11-20T01:04:06Z,2020-11-20T01:23:13Z,2020-11-20T01:23:05Z,"
Hello, 

I got the error during ""preprocessIntervals"" step.
I'm running on R version 4.0.2

Here is the error message.
> preprocessIntervals(intervals, reference.file, mappability = mappability, output.file = ""GC_information.txt"")
INFO [2020-11-20 09:54:48] Splitting 51376 large targets to an average width of 400.
INFO [2020-11-20 09:54:56] Removing 11919 intervals with low mappability score (<0.50).
WARN [2020-11-20 09:54:56] No reptiming scores provided.
INFO [2020-11-20 09:54:56] Calculating GC-content...
Error in value[[3L]](cond) : 
   record 236027 (chr13:20593654-20593919) failed
  file: D:/reference/hg19/GATKbundle/ucsc.hg19.fasta


How can i get the interval file?

Thank you",deryu,https://github.com/lima1/PureCN/issues/153
MDU6SXNzdWU3NTAwODU5NDA=,Normal tissue vs. normal blood,CLOSED,2020-11-24T21:36:38Z,2020-12-01T17:34:38Z,2020-12-01T17:34:38Z,"Hello again,

I was testing PureCN on TCGA samples and noticed some glaring difference in tumor purity that was previously reported in [this](https://doi.org/10.1038/ncomms9971) paper (figures 1, 2; supp. figures 2, 3). In short, ovarian cohort I examined via PureCN was roughly around 40% purity whereas previously reported consensus was around 80-90%.

To provide a little bit of detail, I used matching blood normal samples to generate coverages, making sure kits are consistent. I ran the recommended production pipeline (without providing normal coverage).

Now I'm wondering if I should be generating the coverages using the tissue normal to see if changing the normal reference significantly affects tumor purity estimation.

Thank you.",djb17,https://github.com/lima1/PureCN/issues/154
MDU6SXNzdWU3NTU4NjgxNTI=,Question about using cnvKit output,CLOSED,2020-12-03T05:26:58Z,2020-12-08T16:30:59Z,2020-12-08T16:30:59Z,"Hi Markus, 

I have a few questions with regards to using CNVkit output. 
1) I would like to make a normal panel of VCF.  How many samples will you recommend to include for the VCF generation?  Do they have to be all in one VCF or each sample has a separate VCF?
2) Should we use CNVKit result run against its matched germline or a panel of normal?  Which method is preferred?

Thanks,
Yisu",yisu-li,https://github.com/lima1/PureCN/issues/155
MDU6SXNzdWU3NTk1MzQ3NTg=,Issues with on/off target log ratios,CLOSED,2020-12-08T15:21:49Z,2021-04-06T21:25:23Z,2021-04-06T21:25:23Z,"Hi Markus,

I've had some strange results out of a recent batch of samples. It appears 3/5 samples have 

Mean standard deviation of on-target log-ratios only: 0.0
Mean standard deviation of off-target log-ratios only: 0.0

I include two example log files. One of these samples performs pretty poorly, having very few believable somatic variants - several of these are also flagged by PureCN. 

Some questions.
1. Have you seen this before, what could be causing this?
2. Are there any avenues I should investigate regarding the raw data to ensure something hasn't gone wrong during processing?
3. With flagged variants, I believe in my case this can only be due to potential presence in the mapping bias file as I don't use a normalDB (as this is already done in cnvkit), is it worth attempting to recover some of these variants or are they very likely to be spurious?

Thanks,
Warren
[sample1.log](https://github.com/lima1/PureCN/files/5660076/sample1.log)
[sample2.log](https://github.com/lima1/PureCN/files/5660077/sample2.log)

",waemm,https://github.com/lima1/PureCN/issues/156
MDU6SXNzdWU3NjA3NzcxMDE=,some errors occur,CLOSED,2020-12-10T00:26:13Z,2020-12-11T06:33:13Z,2020-12-11T06:33:13Z,"Hi, 

using PureCN, i want to analyze WES data.

but when i try installing it and running, it makes error.
i use **cnvkit output!** and **Mutect 1.1.7**

first
i have installed PureCN like below

` Install patched PSCBS:`
`if (!requireNamespace(""BiocManager"", quietly=TRUE))`
`>install.packages(""BiocManager"")`
`BiocManager::install(""lima1/PSCBS"", ref=""add_dnacopy_weighting"")`
`BiocManager::install(""lima1/PureCN"")`

but when i run PureCN. 
returns 
> Error: object 'segmentationHclust' not found

second.

when run without --funsegmentation, it also makes error
> Error: vcf.file has no %s or %s info field for membership in germline
> databases.DBPOP_AF

can you tell me something to fix it?

Best Regards

Jeongmin",jeongmeani,https://github.com/lima1/PureCN/issues/157
MDU6SXNzdWU3Njg0MjM4MDQ=,Re: targeted sequencing with much smaller interval lengths,CLOSED,2020-12-16T03:48:34Z,2020-12-19T18:14:49Z,2020-12-19T18:14:49Z,"Hi Markus,

My objective is to obtain copy number profiles from targeted-sequencing data. Our interval lengths are quite small (between 9-9500bp) and we have high sequencing depths - when I run PureCN, it does not throw any errors, but I believe more optimising can be done.

From the best practices page:
Small panels with high coverage: --padding 100 (or higher), requires running the variant caller with this padding or without interval file. Use the same settings for the panel of normals VCF so that SNPs in the flanking regions have reliable mapping bias estimates. The `--maxhomozygousloss` parameter might also need some adjustment for very small panels with large gaps around captured deletions.

My questions are:
1. Would you have any suggestions on how to optimise the `--maxhomozygousloss` parameter here?
2. Should my target BED file include padding when creating the interval file with IntervalFile.R? 
3. And following question 2, would you recommend that the `--padding` parameter in PureCN.R be set to default or `--padding` 200?

My code is currently as follows:
```
DIR=/software/R/4.0.2/bin
PURECN=~/R/x86_64-pc-linux-gnu-library/4.0/PureCN/extdata
OUT_DIR=~/PureCN
PON=~/PureCN/MuTect2_PON.vcf.gz

#creates interval file
$DIR/Rscript $PURECN/IntervalFile.R \
--infile ~/PureCN/targetbed.sorted.bed.gz \
--fasta /resources/fdb/GRCh38_HPV/Sequence/BWAIndex/GCA_000001405.15_GRCh38_no_alt_analysis_set_HPV.fa \
--outfile $OUT_DIR/2_baits_hg38_intervals.txt \ 
--genome hg38 --mintargetwidth 10 \
--export $OUT_DIR/2_baits_optimized_hg38.bed \
--mappability $OUT_DIR/GCA_000001405.15_GRCh38_no_alt_analysis_set_100.bw

#calculate and GC-normalize coverage from a list of BAM files 
$DIR/Rscript $PURECN/Coverage.R \
--outdir $OUT_DIR/Tumors \
--bam $OUT_DIR/tumors.list \
--intervals $OUT_DIR/2_baits_hg38_intervals.txt \
--cores 4

$DIR/Rscript $PURECN/Coverage.R \
--outdir $OUT_DIR/Normals \
--bam $OUT_DIR/normals.list \
--intervals $OUT_DIR/2_baits_hg38_intervals.txt \
--cores 4

#build a normal database for coverage normalization
$DIR/Rscript $PURECN/NormalDB.R \
--outdir $OUT_DIR \
--coveragefiles ~/PureCN/normal.loess.list \
--genome hg38 --normal_panel $PON

$DIR/Rscript $PURECN/PureCN.R \
    --out $OUT_DIR \
    --sampleid ""$tumorname"" \
    --tumor $OUT_REF/Tumors/""$tumorname"".realign.recal_coverage_loess.txt.gz \
    --normal $OUT_REF/Normals/""$normalname"".realign.recal_coverage_loess.txt.gz \
    --vcf $VCF_DIR/""$foldername""/""$foldername"".HaplotypeCaller.Variants.vcf \
    --intervals $OUT_REF/2_baits_hg38_intervals.txt \
    --mappingbiasfile $OUT_REF/mapping_bias_hg38.rds \
    --normaldb $OUT_REF/normalDB_hg38.rds \
    --genome hg38 --force --postoptimize --cores 4 --padding 200
```",yls2g13,https://github.com/lima1/PureCN/issues/158
MDU6SXNzdWU3NzE0MjY2MTc=,Support for homologous recombination deficiency scores in Dx.R,OPEN,2020-12-19T18:03:53Z,2024-02-29T14:29:50Z,,Probably wrapper around https://github.com/sztup/scarHRD,lima1,https://github.com/lima1/PureCN/issues/159
MDU6SXNzdWU3NzQ0NzY0OTI=,Question. Does NormalDB.R apply minimum genotyped sample filter ?,CLOSED,2020-12-24T14:51:31Z,2020-12-24T20:13:07Z,2020-12-24T20:13:07Z,"Hello Markus, 

I am trying to create NormalDB. I have a fairly small set of normal samples ( n=6), to make things worse they are from adjacent tissues.   So I suspect there will be some somatic mutation contamination in them. But they should be private to the sample. Curious, what NormalDB would do if a ""real somatic"" mutation is found in a ""single"" sample.  Should I filter out calls that are found in say two or fewer individuals before feed in VCF to NormalDB or is this something taken care of by NormalDB? 

I appreciate it if you came across (if at all) any obvious issues with Adjacent Tissue normal besides this? 
",npatel-ah,https://github.com/lima1/PureCN/issues/160
MDU6SXNzdWU3NzQ5MzM3ODM=,low purity estimate for what should be a highly pure sample,CLOSED,2020-12-26T21:12:35Z,2020-12-27T16:59:16Z,2020-12-27T16:59:16Z,"I was curious about how much trust we should put into the tumor purity estimates, and so I ran what should be a highly pure normal sample through PureCN to examine the purity result.

Below is the local optima plot for ploidy ~ purity.

<img width=""632"" alt=""Screen Shot 2020-12-26 at 3 58 44 PM"" src=""https://user-images.githubusercontent.com/56320955/103159141-b6594380-4793-11eb-96a3-160507211231.png"">

The optimal purity estimate was reported at 27%:

<img width=""566"" alt=""Screen Shot 2020-12-26 at 4 02 56 PM"" src=""https://user-images.githubusercontent.com/56320955/103159160-e9033c00-4793-11eb-907c-664efdff880e.png"">

However, based on this local optimal plot, you can see that any candidate purity value at the ploidy=2 provides a very high likelihood, and so there is really little support for low vs. high purity at this ploidy level.   

I'm wondering if there's another way we should be extracting the purity estimates from the 2D-grid search rather than relying on the single value reported in the .csv output file as the max likelihood solution.

Thx in advance for any advice.",briandiamondage-sema4,https://github.com/lima1/PureCN/issues/161
MDU6SXNzdWU3Nzc3MzY4OTc=,Tumor purity of Normal Sample,CLOSED,2021-01-03T23:29:10Z,2021-01-04T21:14:16Z,2021-01-04T21:14:16Z,"Hi,

i have normal wes data from tissue, blood and tumor paired wes data of this normal sample.
and i guess that normal tissue samples have some tumor part.
so using tumor-purity analysis, i want to check this.
does it make sense?

actually, i have already analysed this, but even blood normal sample get high score of tumor purity.

Best Regards and Happy new year!

Jeongmin",jeongmeani,https://github.com/lima1/PureCN/issues/162
MDU6SXNzdWU3ODIxNTY5MzQ=,PureCN local optima plot disagrees with optimum solution,CLOSED,2021-01-08T14:28:35Z,2021-01-13T08:51:12Z,2021-01-12T19:18:10Z,"I generated PureCN analysis using CNVkit result files as input in a batch analysis. The local optima result for estimating ploidy and purity of the sample gives a result of 

> sample$results[[1]]$purity
[1] 0.62
> sample$results[[1]]$ploidy
[1] 5.867521

In the local optima plot the optimum seems to be in the ploidy = 2, and purity = 0.5 area and not where the label ""1"" is.
![image](https://user-images.githubusercontent.com/18532193/104025399-dd1c6e80-51c4-11eb-82c8-41cd8f192d72.png)

The plot seems to disagree with the proposed optimum or in other words: why is the found optimum not in the red part of the plot?

Thank you for feedback.",ThomasGro,https://github.com/lima1/PureCN/issues/163
MDU6SXNzdWU4MDA1NTM2ODY=,validation: can't detect deletions confirmed by ddPCR,CLOSED,2021-02-03T17:42:01Z,2021-02-05T16:24:05Z,2021-02-05T16:24:05Z,"Hi Markus!

Thanks for supporting PureCN!

We are trying to validate a deletion detection in a series of cfDNA samples. 
We have confirmed the deletion by ddPCR and can't pick it up by PureCN 
(native segmentation, PON of 50 process matched samples).

I've tried the default workflow (with mutect2) and also tried to add 
`--minpurity 0.1 --minaf 0.01 --error 0.0005` suggested for cfDNA samples - that did not help.

The purity of the two samples where we are quite confident about the deletion is 0.32 and 0.12.
They have 3-4 variants called in a gene, and none of the variants in PASS mutect filters somatic
(one sample has 3 germline variants, and the other 3 germline + 1 multiallelic/slippage/weak_evidence somatic).

Do you have any suggestions on how to improve sensitivity in that case, or 
there is a principal limitation here - if we have not gotten any trustworthy marker somatic variants in a gene,
then we don't have a chance to pick up a CNV?

Sergey",naumenko-sa,https://github.com/lima1/PureCN/issues/164
MDU6SXNzdWU4MjMyMDcyMTk=,Troubleshooting the reason for poor purity estimate of high purity samples with clonal CNV loss segments,CLOSED,2021-03-05T15:48:19Z,2021-03-17T19:35:18Z,2021-03-06T16:11:38Z,"Hi, 

Recently I tried PureCN on a couple of samples for estimating tumor purity using the tumor only mode. Below is the code that I used, with the input files attached here.

[PureCN_test.zip](https://github.com/lima1/PureCN/files/6091620/PureCN_test.zip)


```
Rscript $PURECN/PureCN.R \
--out OUTDIR/Run999_Pair045_Tumor_tumorNormal_gatk4cnv \
--tumor input_gatk4seg/tumorNormal/Run999_Pair045_Tumor.dedup.recal.counts.hdf5 \
--sampleid Run999_Pair045_tnVcf_tumorNormal_gatk4ncv \
--logratiofile input_gatk4seg/tumorNormal/Run999_Pair045_Tumor.dedup.recal.denoisedCR.tsv \
--segfile input_gatk4seg/tumorNormal/Run999_Pair045_Tumor.dedup.recal.modelFinal.seg \
--mappingbiasfile reference_files/mapping_bias_TwistExomeAll152_hg19.rds \
--vcf vcfs_PureCN/tumorVcf/Run999_Pair045_Tumor.Run999_Pair045_Normal.mutect2.twicefiltered.hg19.vcf_wDB.vcf \
--genome hg19 \
--funsegmentation Hclust \
--force --postoptimize --seed 123
```

Here the segmentation data is from GATK4 via tumor normal mode, which clearly shows clonal CNV loss segment and purity should be 100%, which is expected given this is a tumor cell line sample. And the vcf file is mutect2 with minimal post-processing to make it compatible with PureCN. However, PureCN is estimating purity of only 0.45. 

[Run999_Pair045_toVcf_tumorNormal_gatk4ncv_local_optima.pdf](https://github.com/lima1/PureCN/files/6091574/Run999_Pair045_toVcf_tumorNormal_gatk4ncv_local_optima.pdf)

Could you please help out here and figure out how to improve it?

Thanks

Huan




 
",Huan-Wang-S4,https://github.com/lima1/PureCN/issues/165
MDU6SXNzdWU4MzE4MjY3MzE=,Issue Running with cnvkit Data,CLOSED,2021-03-15T13:45:23Z,2021-03-19T18:42:28Z,2021-03-19T18:42:28Z,"I've tried to follow the use guide for inputting cnvkit segmentation files, but keep running into the following error:

```
Error in if (is.na(posterior) || posterior < 0.5) flag <- TRUE :
  missing value where TRUE/FALSE needed
Calls: runAbsoluteCN ... .calcMsSegment -> lapply -> lapply -> FUN -> .calcMsSegmentC
Execution halted
```

The full log is [here](https://gist.github.com/drmrgd/c2c2c8eacedaf0a598606f7fc35b199b)

I really have no idea where to start troubleshooting this as I don't know what data might be missing and what is expected at this step.  Any help pointing me in the right direction is most appreciated!",drmrgd,https://github.com/lima1/PureCN/issues/166
MDU6SXNzdWU4MzYyNzE3Mjc=,error with vcf from gatk mutect2 + FilterMutectCalls (v4.2.0.0) on custom reference sequence,CLOSED,2021-03-19T18:49:15Z,2021-03-25T16:50:41Z,2021-03-25T16:50:41Z,"Hi,

I'm trying to use PureCN 1.20.0 from conda (I installed the missing package r-optparse from conda).
My vcf file is the output of gatk FilterMutectCalls on gatk Mutect2 (--genotype-germline-sites true) output.
I skip the Normal.DB step because the pon from mutect2 is empty.

I use the recommended CNVkit usage without --snpblacklist and --mappingbiasfile because i am working with a custom reference sequence  : 

```
# Export the segmentation in DNAcopy format
cnvkit.py export seg $OUT/$SAMPLEID/${SAMPLEID}_cnvkit.cns \
    -o $OUT/$SAMPLEID/${SAMPLEID}_cnvkit.seg

# Run PureCN by providing the *.cnr and *.seg files 
Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID  \
    --sampleid $SAMPLEID \
    --tumor $OUT/$SAMPLEID/${SAMPLEID}_cnvkit.cnr \
    --segfile $OUT/$SAMPLEID/${SAMPLEID}_cnvkit.seg \
    --vcf ${SAMPLEID}_mutect.vcf \
    --statsfile ${SAMPLEID}_mutect_stats.txt \
    --genome hg38 \
    --funsegmentation Hclust \
    --force --postoptimize --seed 123
```

but i have this error : 

```
INFO [2021-03-19 19:08:43] ------------------------------------------------------------
INFO [2021-03-19 19:08:43] PureCN 1.20.0
INFO [2021-03-19 19:08:43] ------------------------------------------------------------
INFO [2021-03-19 19:08:43] Arguments: -normal.coverage.file  -tumor.coverage.file result/3_cnvkit/llc151721nmlsr.cnr -log.ratio  -seg.file result/3_cnvkit/llc151721nmlsr.seg -vcf.file result/2_mutect2/llc151721nmlsr_filtered.vcf -normalDB  -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.segmentation 0.005,NULL -sampleid llc151721nmlsr -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM  -log.file result/4_purecn/llc151721nmlsr.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2021-03-19 19:08:43] Loading coverage files...
INFO [2021-03-19 19:08:45] Provided log2-ratio looks too noisy, using segmentation only.
WARN [2021-03-19 19:08:45] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
WARN [2021-03-19 19:08:45] Allosome coverage missing, cannot determine sex.
WARN [2021-03-19 19:08:45] Allosome coverage missing, cannot determine sex.
INFO [2021-03-19 19:08:45] Using 12 intervals (12 on-target, 0 off-target).
INFO [2021-03-19 19:08:45] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2021-03-19 19:08:45] Loading VCF...
INFO [2021-03-19 19:08:48] Found 39 variants in VCF file.
INFO [2021-03-19 19:08:48] Removing 1 triallelic sites.
INFO [2021-03-19 19:08:49] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2021-03-19 19:08:49] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2021-03-19 19:08:49] 0 (0.0%) variants annotated as likely germline (DB INFO flag).
FATAL [2021-03-19 19:08:49] VCF either contains no germline variants or variants are not properly 

FATAL [2021-03-19 19:08:49] annotated. 

FATAL [2021-03-19 19:08:49]  

FATAL [2021-03-19 19:08:49] This is most likely a user error due to invalid input data or 

FATAL [2021-03-19 19:08:49] parameters (PureCN 1.20.0). 

```

header + one record of the vcf from gatk FilterMutectCalls (gatk version 4.2.0.0) annotated as germline in FILTER fields:

```
##fileformat=VCFv4.2
##FILTER=<ID=FAIL,Description=""Fail the site if all alleles fail but for different reasons."">
##FILTER=<ID=PASS,Description=""Site contains at least one allele that passes filters"">
##FILTER=<ID=base_qual,Description=""alt median base quality"">
##FILTER=<ID=clustered_events,Description=""Clustered events observed in the tumor"">
##FILTER=<ID=contamination,Description=""contamination"">
##FILTER=<ID=duplicate,Description=""evidence for alt allele is overrepresented by apparent duplicates"">
##FILTER=<ID=fragment,Description=""abs(ref - alt) median fragment length"">
##FILTER=<ID=germline,Description=""Evidence indicates this site is germline, not somatic"">
##FILTER=<ID=haplotype,Description=""Variant near filtered variant on same haplotype."">
##FILTER=<ID=low_allele_frac,Description=""Allele fraction is below specified threshold"">
##FILTER=<ID=map_qual,Description=""ref - alt median mapping quality"">
##FILTER=<ID=multiallelic,Description=""Site filtered because too many alt alleles pass tumor LOD"">
##FILTER=<ID=n_ratio,Description=""Ratio of N to alt exceeds specified ratio"">
##FILTER=<ID=normal_artifact,Description=""artifact_in_normal"">
##FILTER=<ID=orientation,Description=""orientation bias detected by the orientation bias mixture model"">
##FILTER=<ID=panel_of_normals,Description=""Blacklisted site in panel of normals"">
##FILTER=<ID=position,Description=""median distance of alt variants from end of reads"">
##FILTER=<ID=possible_numt,Description=""Allele depth is below expected coverage of NuMT in autosome"">
##FILTER=<ID=slippage,Description=""Site filtered due to contraction of short tandem repeat region"">
##FILTER=<ID=strand_bias,Description=""Evidence for alt allele comes from one read direction only"">
##FILTER=<ID=strict_strand,Description=""Evidence for alt allele is not represented in both directions"">
##FILTER=<ID=weak_evidence,Description=""Mutation does not meet likelihood threshold"">
##FORMAT=<ID=AD,Number=R,Type=Integer,Description=""Allelic depths for the ref and alt alleles in the order listed"">
##FORMAT=<ID=AF,Number=A,Type=Float,Description=""Allele fractions of alternate alleles in the tumor"">
##FORMAT=<ID=DP,Number=1,Type=Integer,Description=""Approximate read depth (reads with MQ=255 or with bad mates are filtered)"">
##FORMAT=<ID=F1R2,Number=R,Type=Integer,Description=""Count of reads in F1R2 pair orientation supporting each allele"">
##FORMAT=<ID=F2R1,Number=R,Type=Integer,Description=""Count of reads in F2R1 pair orientation supporting each allele"">
##FORMAT=<ID=GQ,Number=1,Type=Integer,Description=""Genotype Quality"">
##FORMAT=<ID=GT,Number=1,Type=String,Description=""Genotype"">
##FORMAT=<ID=PGT,Number=1,Type=String,Description=""Physical phasing haplotype information, describing how the alternate alleles are phased in relation to one another; will always be heterozygous and is not intended to describe called alleles"">
##FORMAT=<ID=PID,Number=1,Type=String,Description=""Physical phasing ID information, where each unique ID within a given sample (but not across samples) connects records within a phasing group"">
##FORMAT=<ID=PL,Number=G,Type=Integer,Description=""Normalized, Phred-scaled likelihoods for genotypes as defined in the VCF specification"">
##FORMAT=<ID=PS,Number=1,Type=Integer,Description=""Phasing set (typically the position of the first variant in the set)"">
##FORMAT=<ID=SB,Number=4,Type=Integer,Description=""Per-sample component statistics which comprise the Fisher's Exact Test to detect strand bias."">
##GATKCommandLine=<ID=FilterMutectCalls,CommandLine=""FilterMutectCalls --output result/2_mutect2/llc151721nmlsr_filtered.vcf.gz --stats merged_lsr.stats --variant result/2_mutect2/llc151721nmlsr.vcf.gz --reference data/ighh/IgHHuman_smu.fasta --threshold-strategy OPTIMAL_F_SCORE --f-score-beta 1.0 --false-discovery-rate 0.05 --initial-threshold 0.1 --mitochondria-mode false --max-events-in-region 2 --max-alt-allele-count 1 --unique-alt-read-count 0 --min-median-mapping-quality 30 --min-median-base-quality 20 --max-median-fragment-length-difference 10000 --min-median-read-position 1 --max-n-ratio Infinity --min-reads-per-strand 0 --min-allele-fraction 0.0 --contamination-estimate 0.0 --log-snv-prior -13.815510557964275 --log-indel-prior -16.11809565095832 --log-artifact-prior -2.302585092994046 --normal-p-value-threshold 0.001 --min-slippage-length 8 --pcr-slippage-rate 0.1 --distance-on-haplotype 100 --long-indel-length 5 --interval-set-rule UNION --interval-padding 0 --interval-exclusion-padding 0 --interval-merging-rule ALL --read-validation-stringency SILENT --seconds-between-progress-updates 10.0 --disable-sequence-dictionary-validation false --create-output-bam-index true --create-output-bam-md5 false --create-output-variant-index true --create-output-variant-md5 false --lenient false --add-output-sam-program-record true --add-output-vcf-command-line true --cloud-prefetch-buffer 40 --cloud-index-prefetch-buffer -1 --disable-bam-index-caching false --sites-only-vcf-output false --help false --version false --showHidden false --verbosity INFO --QUIET false --use-jdk-deflater false --use-jdk-inflater false --gcs-max-retries 20 --gcs-project-for-requester-pays  --disable-tool-default-read-filters false"",Version=""4.2.0.0"",Date=""March 19, 2021 2:03:28 PM CET"">
##GATKCommandLine=<ID=Mutect2,CommandLine=""Mutect2 --panel-of-normals /scratch/jpollet/LSR/result/2_mutect2/pon_lsr.vcf.gz --genotype-germline-sites true --output result/2_mutect2/llc151721nmlsr.vcf.gz --input result/1_bwa/llc151721nmlsr_bbtrim.sorted.rg.bam --reference data/ighh/IgHHuman_smu.fasta --f1r2-median-mq 50 --f1r2-min-bq 20 --f1r2-max-depth 200 --genotype-pon-sites false --af-of-alleles-not-in-resource -1.0 --mitochondria-mode false --tumor-lod-to-emit 3.0 --initial-tumor-lod 2.0 --pcr-snv-qual 40 --pcr-indel-qual 40 --max-population-af 0.01 --downsampling-stride 1 --callable-depth 10 --max-suspicious-reads-per-alignment-start 0 --normal-lod 2.2 --ignore-itr-artifacts false --gvcf-lod-band -2.5 --gvcf-lod-band -2.0 --gvcf-lod-band -1.5 --gvcf-lod-band -1.0 --gvcf-lod-band -0.5 --gvcf-lod-band 0.0 --gvcf-lod-band 0.5 --gvcf-lod-band 1.0 --minimum-allele-fraction 0.0 --independent-mates false --disable-adaptive-pruning false --kmer-size 10 --kmer-size 25 --dont-increase-kmer-sizes-for-cycles false --allow-non-unique-kmers-in-ref false --num-pruning-samples 1 --min-dangling-branch-length 4 --recover-all-dangling-branches false --max-num-haplotypes-in-population 128 --min-pruning 2 --adaptive-pruning-initial-error-rate 0.001 --pruning-lod-threshold 2.302585092994046 --pruning-seeding-lod-threshold 9.210340371976184 --max-unpruned-variants 100 --linked-de-bruijn-graph false --disable-artificial-haplotype-recovery false --enable-legacy-graph-cycle-detection false --debug-assembly false --debug-graph-transformations false --capture-assembly-failure-bam false --num-matching-bases-in-dangling-end-to-recover -1 --error-correction-log-odds -Infinity --error-correct-reads false --kmer-length-for-read-error-correction 25 --min-observations-for-kmer-to-be-solid 20 --base-quality-score-threshold 18 --dragstr-het-hom-ratio 2 --dont-use-dragstr-pair-hmm-scores false --pair-hmm-gap-continuation-penalty 10 --expected-mismatch-rate-for-read-disqualification 0.02 --pair-hmm-implementation FASTEST_AVAILABLE --pcr-indel-model CONSERVATIVE --phred-scaled-global-read-mismapping-rate 45 --disable-symmetric-hmm-normalizing false --disable-cap-base-qualities-to-map-quality false --enable-dynamic-read-disqualification-for-genotyping false --dynamic-read-disqualification-threshold 1.0 --native-pair-hmm-threads 4 --native-pair-hmm-use-double-precision false --bam-writer-type CALLED_HAPLOTYPES --dont-use-soft-clipped-bases false --min-base-quality-score 10 --smith-waterman JAVA --emit-ref-confidence NONE --max-mnp-distance 1 --force-call-filtered-alleles false --soft-clip-low-quality-ends false --allele-informative-reads-overlap-margin 2 --min-assembly-region-size 50 --max-assembly-region-size 300 --active-probability-threshold 0.002 --max-prob-propagation-distance 50 --force-active false --assembly-region-padding 100 --padding-around-indels 75 --padding-around-snps 20 --padding-around-strs 75 --max-extension-into-assembly-region-padding-legacy 25 --max-reads-per-alignment-start 50 --enable-legacy-assembly-region-trimming false --interval-set-rule UNION --interval-padding 0 --interval-exclusion-padding 0 --interval-merging-rule ALL --read-validation-stringency SILENT --seconds-between-progress-updates 10.0 --disable-sequence-dictionary-validation false --create-output-bam-index true --create-output-bam-md5 false --create-output-variant-index true --create-output-variant-md5 false --lenient false --add-output-sam-program-record true --add-output-vcf-command-line true --cloud-prefetch-buffer 40 --cloud-index-prefetch-buffer -1 --disable-bam-index-caching false --sites-only-vcf-output false --help false --version false --showHidden false --verbosity INFO --QUIET false --use-jdk-deflater false --use-jdk-inflater false --gcs-max-retries 20 --gcs-project-for-requester-pays  --disable-tool-default-read-filters false --max-read-length 2147483647 --min-read-length 30 --minimum-mapping-quality 20 --disable-tool-default-annotations false --enable-all-annotations false"",Version=""4.2.0.0"",Date=""March 19, 2021 1:59:18 PM CET"">
##INFO=<ID=AS_FilterStatus,Number=A,Type=String,Description=""Filter status for each allele, as assessed by ApplyVQSR. Note that the VCF filter field will reflect the most lenient/sensitive status across all alleles."">
##INFO=<ID=AS_SB_TABLE,Number=1,Type=String,Description=""Allele-specific forward/reverse read counts for strand bias tests. Includes the reference and alleles separated by |."">
##INFO=<ID=AS_UNIQ_ALT_READ_COUNT,Number=A,Type=Integer,Description=""Number of reads with unique start and mate end positions for each alt at a variant site"">
##INFO=<ID=CONTQ,Number=1,Type=Float,Description=""Phred-scaled qualities that alt allele are not due to contamination"">
##INFO=<ID=DP,Number=1,Type=Integer,Description=""Approximate read depth; some reads may have been filtered"">
##INFO=<ID=ECNT,Number=1,Type=Integer,Description=""Number of events in this haplotype"">
##INFO=<ID=GERMQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles are not germline variants"">
##INFO=<ID=MBQ,Number=R,Type=Integer,Description=""median base quality"">
##INFO=<ID=MFRL,Number=R,Type=Integer,Description=""median fragment length"">
##INFO=<ID=MMQ,Number=R,Type=Integer,Description=""median mapping quality"">
##INFO=<ID=MPOS,Number=A,Type=Integer,Description=""median distance from end of read"">
##INFO=<ID=NALOD,Number=A,Type=Float,Description=""Negative log 10 odds of artifact in normal with same allele fraction as tumor"">
##INFO=<ID=NCount,Number=1,Type=Integer,Description=""Count of N bases in the pileup"">
##INFO=<ID=NLOD,Number=A,Type=Float,Description=""Normal log 10 likelihood ratio of diploid het or hom alt genotypes"">
##INFO=<ID=OCM,Number=1,Type=Integer,Description=""Number of alt reads whose original alignment doesn't match the current contig."">
##INFO=<ID=PON,Number=0,Type=Flag,Description=""site found in panel of normals"">
##INFO=<ID=POPAF,Number=A,Type=Float,Description=""negative log 10 population allele frequencies of alt alleles"">
##INFO=<ID=ROQ,Number=1,Type=Float,Description=""Phred-scaled qualities that alt allele are not due to read orientation artifact"">
##INFO=<ID=RPA,Number=R,Type=Integer,Description=""Number of times tandem repeat unit is repeated, for each allele (including reference)"">
##INFO=<ID=RU,Number=1,Type=String,Description=""Tandem repeat unit (bases)"">
##INFO=<ID=SEQQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles are not sequencing errors"">
##INFO=<ID=STR,Number=0,Type=Flag,Description=""Variant is a short tandem repeat"">
##INFO=<ID=STRANDQ,Number=1,Type=Integer,Description=""Phred-scaled quality of strand bias artifact"">
##INFO=<ID=STRQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles in STRs are not polymerase slippage errors"">
##INFO=<ID=TLOD,Number=A,Type=Float,Description=""Log 10 likelihood ratio score of variant existing versus not existing"">
##MutectVersion=2.2
##contig=<ID=smu,length=4529>
##filtering_status=These calls have been filtered by FilterMutectCalls to label false positives with a list of failed filters and true positives with PASS.
##source=FilterMutectCalls
##source=Mutect2
##tumor_sample=llc151721nmlsr
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	llc151721nmlsr
smu	2686	.	C	T	.	clustered_events;germline	AS_FilterStatus=SITE;AS_SB_TABLE=51,52|54,45;DP=249;ECNT=3;GERMQ=5;MBQ=24,23;MFRL=0,0;MMQ=60,60;MPOS=20;POPAF=7.30;TLOD=188.78	GT:AD:AF:DP:F1R2:F2R1:SB	0/1:103,99:0.483:202:51,2:47,53:51,52,54,45
```

seg file :
````
ID	chrom	loc.start	loc.end	num.mark	seg.mean
llc151721nmlsr	smu	267	4529	12	-0.131475
````
cnr file :
```
chromosome	start	end	gene	depth	log2	weight
smu	266	532	SMU	253.376	0.747959	0.190888
smu	532	799	SMU	181.64	0.169248	0.0342295
smu	799	1065	SMU	26.6992	-1.17278	0.0001
smu	1598	1864	SMU	15.3346	2.51879	0.0119792
smu	1864	2131	SMU	3.58052	-3.18721	0.0217088
smu	2397	2664	SMU	169.476	-0.169248	0.0001
smu	2930	3196	SMU	299.229	3.34499	0.156584
smu	3196	3463	SMU	67.7154	3.87191	0.0075058
smu	3463	3729	SMU	0.195489	-6.19039	0.0976755
smu	3729	3996	SMU	1.22472	-1.94301	0.0001
smu	3996	4262	SMU	3133.14	-1.19368	0.235508
smu	4262	4529	SMU	2858.29	0.350737	0.257705
```

Thanks in advance for your help.",Just08,https://github.com/lima1/PureCN/issues/167
MDU6SXNzdWU4Mzc0Mjk2MTk=,correct use of PureCN,CLOSED,2021-03-22T07:49:53Z,2021-03-27T06:22:45Z,2021-03-25T16:50:28Z,"Hello,
I would like to use PureCN for my targeted sequencing data.
I generated bam and VCF files by using commercial software, Sophia Genetics; so my doubt is: is it possible to use these VCF files in PureCN or it is necessary to apply MuTect?

Kind Regards


Vera",veramazzara,https://github.com/lima1/PureCN/issues/168
MDU6SXNzdWU4NDE1OTY3Nzk=,Version error ,CLOSED,2021-03-26T05:15:11Z,2021-03-30T12:50:49Z,2021-03-30T12:50:49Z,"Hi Markus,

I'm struggling to use PureCN.R with cnvkit. I have used PureCN 1.18 before the advanced versions were out and had no problem running with it. 
Recently, I downloaded PureCN 1.20.0.tar.gz from bioconductor page and ran PureCN.R in linux command line with the same code and got the following error. 

INFO [2021-03-26 13:55:06] Loading PureCN 1.18.1...
Error in runAbsoluteCN(normal.coverage.file = normal.coverage.file, tumor.coverage.file = tumor.coverage.file,  : 
  unused argument (vcf.field.prefix = ""PureCN."")

Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID  \
    --sampleid $SAMPLEID \
    --tumor $OUT/$SAMPLEID/${SAMPLEID}_cnvkit.cnr \
    --segfile $OUT/$SAMPLEID/${SAMPLEID}_cnvkit.seg \
    --vcf ${SAMPLEID}_mutect.vcf \
    --statsfile ${SAMPLEID}_mutect_stats.txt \
    --genome hg19 \
    --funsegmentation Hclust \
    --force --postoptimize --seed 123


As you can see even though I have downloaded 1.20.0, it's loading PureCN 1.18.1. I have erased PureCN 1.18 before I downloaded the new one. I read that the ""unused argument"" in the error was moved to runAbsoluteCN since version 1.20.

Thank in advance for any advice.   ",jennyp76,https://github.com/lima1/PureCN/issues/169
MDU6SXNzdWU4NTUxMjc2Nzg=,Reading Filtering when doing Mutect2Reading Filtering when doing Mutect2,CLOSED,2021-04-10T18:23:11Z,2021-04-14T20:26:39Z,2021-04-14T20:26:39Z,"Hi, I tried PureCN for calling CNV and tumor purity estimation for WES of cfDNA. I have cfDNA from patients with buffycoat control but they use different capture kit version. So I selected ~20 cfDNA from those samples to create normalDB. 

I run Mutect2 tumor-only mode with extra read-filtering option like following for getting vcf for both creating Normal DB and running individual cfDNA.
 `gatk Mutect2 -R hs37d5_PhiX.fa -I ${bamfile} -max-mnp-distance 0 --min-base-quality-score 20 --read-filter MappingQualityReadFilter --read-filter OverclippedReadFilter --minimum-mapping-quality 30 --read-filter FragmentLengthReadFilter --min-fragment-length 30 -O ${output_dir}/${filename}.vcf.gz""`

I would like to ask whether these params (e.g. minimum-mapping-quality 30) would fit or be necessary for downstream PureCN process e.g. mapping bias estimation? 

Possibly another question.  Would it be better to run Mutect2 given that buffycoat control rather than tumor-only mode?/
Thanks
Pitithat",Pitithat-pu,https://github.com/lima1/PureCN/issues/170
MDU6SXNzdWU4NTYwNTc5OTA=,Crash While Generating Output Files,CLOSED,2021-04-12T14:50:51Z,2021-04-18T19:06:12Z,2021-04-18T04:24:51Z,"I'm running PureCN version `1.20.0` on segmentation files generated with cnvkit.  Although it's taken several days to generate the output, everything seems OK.  However, during the ""Generating output files..."" phase, I'm getting the following error (similar to issue #10 ):

```
INFO [2021-04-12 10:37:52] Generating output files...
Error in `$<-.data.frame`(`*tmp*`, ""arm"", value = ""p"") :
  replacement has 1 row, data has 0
Calls: write.csv ... <Anonymous> -> .getArmLocations -> $<- -> $<-.data.frame
Execution halted
```

The log only contains a few warnings, which seem innocuous enough (though I can't be sure!):

```
WARN [2021-04-09 15:20:39] log2-ratio contains outliers < -8, ignoring them...
WARN [2021-04-09 15:20:42] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2021-04-09 15:20:42] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
WARN [2021-04-09 15:20:43] Found 88 variants with missing allelic fraction starting with 1:13669008_A/C. Removing them.
WARN [2021-04-09 15:20:44] MuTect stats file lacks contig and position columns.
WARN [2021-04-09 15:20:45] Variant ids contain NAs at filter step BQ.
WARN [2021-04-09 15:20:46] Provided sampleid (MATCH-B44A) does not match MATCH-Z1D-B44A found in segmentation.
```

Many of the output files have been generated, but it does seem that I'm missing:

1. *.vcf.gz
2. *_loh.csv
3. *_chromosomes.pdf

I really have no idea what may be causing this error or how to dig into it much deeper.  I'm happy to provide any information that may help uncover the problem with my data.  Please let me know.   ",drmrgd,https://github.com/lima1/PureCN/issues/171
MDU6SXNzdWU4NjM0ODQ1OTk=,error in Coverage.R,CLOSED,2021-04-21T06:10:31Z,2024-07-29T03:42:25Z,2021-04-30T23:42:37Z,"Hello,

When I ran the Coverage.R, I got the error:

Error in predLoess(object$y, object$x, newx = if (is.null(newdata)) object$x else if (is.data.frame(newdata)) as.matrix(model.frame(delete.response(terms(object)),  :
  NA/NaN/Inf in foreign function call (arg 5)
Calls: .gcNormalize ... eval -> eval -> predict -> predict.loess -> predLoess
In addition: Warning messages:
1: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  zero-width neighborhood. make span bigger
2: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  pseudoinverse used at 0.4
3: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  neighborhood radius 0.0042553
4: In simpleLoess(y, x, w, span, degree = degree, parametric = parametric,  :
  reciprocal condition number  2.0397e-16
Execution halted

I ran the IntervalFile.R with hg38, so I did not provide the --reptiming because I cannot find the file on UCSC genome browser.
If that's the reason for the error,  where I can download the reptiming file.

Thanks",Josephhungyi,https://github.com/lima1/PureCN/issues/172
MDU6SXNzdWU4NjQ4NTE1NzY=,Ranked Solutions do not match up with log-likelihood values,CLOSED,2021-04-22T11:44:37Z,2021-04-26T15:33:25Z,2021-04-26T15:33:25Z,"I've got a strange scenario where the ranking of the solutions don't appear to match up with the reported log-likelihood values. Here is the output overview plot when you take the PureCN output directly:

![purecn_overview_1](https://user-images.githubusercontent.com/3268173/115708881-72083980-a368-11eb-9dd1-a71f9628bd3b.png)

When you extract the log-likelihood values extracted from the output (`ret`) of the `runAbsoluteCN` function:

```r
#' Get PureCN candidate solutions dataframe
#'
#' @param purecn_output
get_purecn_candidate_solutions_df <- function(purecn_output) {

  out_df <-
    purrr::map_dbl(purecn_output$results, purrr::pluck, ""purity"") %>%
    tibble::enframe(name = ""solution_id"", value = ""purity"") %>%
    dplyr::left_join(
      purrr::map_dbl(purecn_output$results, purrr::pluck, ""ploidy"") %>%
        tibble::enframe(name = ""solution_id"", value = ""ploidy""),
      by = ""solution_id""
    ) %>%
    dplyr::left_join(
      purrr::map_dbl(purecn_output$results, purrr::pluck, ""log.likelihood"") %>%
        tibble::enframe(name = ""solution_id"", value = ""cn_llik""),
      by = ""solution_id""
    ) %>%
    dplyr::left_join(
      purrr::map_dbl(
        purecn_output$results, purrr::pluck, ""total.log.likelihood""
      ) %>%
        tibble::enframe(name = ""solution_id"", value = ""total_llik""),
      by = ""solution_id""
    ) %>%
    dplyr::left_join(
      purrr::map(purecn_output$results, purrr::pluck, ""SNV.posterior"") %>%
        purrr::map_dbl(purrr::pluck, ""llik"") %>%
        tibble::enframe(name = ""solution_id"", value = ""snv_llik""),
      by = ""solution_id""
    )

  return(out_df)
}

get_purecn_candidate_solutions_df(ret)
```
```r
# A tibble: 10 x 6
   solution_id purity ploidy cn_llik total_llik  snv_llik
         <int>  <dbl>  <dbl>   <dbl>      <dbl>     <dbl>
 1           1   0.11   2.09  52660.   -284239.  -310521.
 2           2   0.28   2.06  51248.   -284150.  -309749.
 3           3   0.55   2.00  45660.   -280050.  -302880.
 4           4   0.36   4.07  51693.   -312928.  -338738.
 5           5   0.42   6.00  51211.   -340828.  -366398.
 6           6   0.24   5.13  52710.   -387899.  -414205.
 7           7   0.28   3.06  51431.   -442310.  -468001.
 8           8   0.27   1.08  51837.   -544194.  -570089.
 9           9   0.48   3.06  50170.   -695980.  -721041.
10          10   0.42   1.05  46749.  -1108316. -1131678.
```

Here the top ranked solution (i.e. 1) doesn't actually have the highest `total_llik`. In fact, it's the 3rd ranked solution that actually has the highest `total_llik`.

Based on the code, there appears to be a `.rankResults` function that should be run in the `runAbsoluteCN` function. When you do this:

```r
ret$results <- PureCN:::.rankResults(ret$results)
get_purecn_candidate_solutions_df(ret)
```
```r
# A tibble: 10 x 6
   solution_id purity ploidy cn_llik total_llik  snv_llik
         <int>  <dbl>  <dbl>   <dbl>      <dbl>     <dbl>
 1           1   0.55   2.00  45660.   -280050.  -302880.
 2           2   0.28   2.06  51248.   -284150.  -309749.
 3           3   0.11   2.09  52660.   -284239.  -310521.
 4           4   0.36   4.07  51693.   -312928.  -338738.
 5           5   0.42   6.00  51211.   -340828.  -366398.
 6           6   0.24   5.13  52710.   -387899.  -414205.
 7           7   0.28   3.06  51431.   -442310.  -468001.
 8           8   0.27   1.08  51837.   -544194.  -570089.
 9           9   0.48   3.06  50170.   -695980.  -721041.
10          10   0.42   1.05  46749.  -1108316. -1131678.
```

And then plot the overview:

```r
PureCN:::plotAbs(ret, type = ""overview"")
```

![purecn_overview_2](https://user-images.githubusercontent.com/3268173/115708900-7896b100-a368-11eb-8c73-c3ab98c474d6.png)

You get a overview plot that has the solutions ranked correctly according to the log-likelihood values

Any idea what could explain what happened here? This is based on Pure CN 1.20.0.
",tinyheero,https://github.com/lima1/PureCN/issues/173
MDU6SXNzdWU4NjY3NDUxODM=,better pureCN estimates when not using the M1 stats as input,CLOSED,2021-04-24T13:21:12Z,2021-05-04T20:46:16Z,2021-05-04T17:34:09Z,"Hi,

In our evaluations of tumor purity estimates using vs. not using the Mutect1 stats file as input, we're seeing much better agreement when not using the stats file as opposed to including it - which is in contrast to the usage recommendations.
<img width=""1185"" alt=""Screen Shot 2021-04-24 at 9 16 00 AM"" src=""https://user-images.githubusercontent.com/56320955/115960161-c7b22280-a4dd-11eb-9e57-2322e2e93bbe.png"">

(the magenta line is the identity line, slope=1, intercept=0)

I was curious about your thoughts here and whether we should just continue not using the M1 stats file as input.

Many thanks!

(tagging collaborator @Huan-Wang-S4)
",briandiamondage-sema4,https://github.com/lima1/PureCN/issues/174
MDU6SXNzdWU4NjY3NDY0ODU=,clarification on Tumor-only vs. Tumor/Normal-paired PureCN execution,CLOSED,2021-04-24T13:28:12Z,2021-04-24T15:13:04Z,2021-04-24T15:13:04Z,"Hi,

I just wanted to confirm that the difference between tumor-only PureCN vs. matched T/Normal execution is restricted to the Mutect1 vcf file being used - in the former, it's T-only M1 vcf and in T/N-paired it's the M1 T/N-paired vcf.  The other input parameters are essentially the same, and in the T/N-paired situation, the matched normal coverage information isn't being used. Instead, both T-only and T/N-paired both rely on the panel of normals.

When we've run PureCN in T-only and T/N-paired modes this way, the PureCN purity estimates are virtually identical (plot below)
<img width=""693"" alt=""Screen Shot 2021-04-24 at 9 26 19 AM"" src=""https://user-images.githubusercontent.com/56320955/115960405-38a60a00-a4df-11eb-8fe5-d7f419cef718.png"">
.

Thx in advance for your guidance.

(tagging collaborator @Huan-Wang-S4)",briandiamondage-sema4,https://github.com/lima1/PureCN/issues/175
MDU6SXNzdWU4Njk4MDkzMzg=,Filtering input Mutect2 variant files for low AF artefacts,CLOSED,2021-04-28T10:49:37Z,2021-04-30T08:43:44Z,2021-04-30T08:43:43Z,"Hi Markus,

We have recently seen some samples  with poor quality input material and this and other factors seem to generate lots of artefacts around 0 - 0.1 AF. As expected I guess PureCN believes many of these to be somatic. I was considering just making a hard cutoff to remove all variants below ~0.1 in these cases. From your perspective could this improve identification of somatic variants ? Would it be better to be more selective in attempted removal of these artefacts?

Thanks again for a great tool!
Warren",waemm,https://github.com/lima1/PureCN/issues/176
MDU6SXNzdWU4NzkwODQyNTA=,Purity and ploidy values plot accuracy?,CLOSED,2021-05-07T14:14:48Z,2021-05-11T17:04:04Z,2021-05-11T17:04:04Z,"Hi,

I ran PureCN using the best practices document on an in-house simulated WES sample Tumor-only mode with a panel of normals containing 5 samples from same assay as input sample. The tool ran several iterations of ploidy but reported only 1 in the .csv file. On what basis, this is chosen? This is a simulated sample and I am aware of the right purity and ploidy which is 0.9 and ploidy 2. In my case but the tool chose 0.56 purity and ploidy 4.2 instead when it did have the closest truth (#7 iteration) according to the attached plot. I used a mutect2 tumor-only VCF here. How to interpret this?

Thanks for your help!

[vcfrate0.9_T_local_optima.pdf](https://github.com/lima1/PureCN/files/6442118/vcfrate0.9_T_local_optima.pdf)
[vcfrate0.9_T.pdf](https://github.com/lima1/PureCN/files/6442189/vcfrate0.9_T.pdf)
",dhsamp,https://github.com/lima1/PureCN/issues/177
MDU6SXNzdWU4OTA0NDI2NDI=,Create a Docker image,CLOSED,2021-05-12T20:05:40Z,2021-09-22T19:12:57Z,2021-09-22T14:38:21Z,"Would be nice to have a custom docker image with everything needed to run PureCN. Some implementation suggestions:
* Could use https://github.com/seandavi/BuildABiocWorkshop/blob/master/Dockerfile as a template, but:
    + don't need to set CRAN repo
    + may want to start from a rocker image rather than bioconductor/bioconductor_docker (which can install all Bioconductor packages but has a lot of unnecessary system dependencies installed as a result and is a big image)
* See https://github.com/seandavi/BuildABiocWorkshop/blob/master/.github/workflows/basic_checks.yaml for auto-updating GitHub Action
    + again skip setting CRAN repo
    + maybe better to do `usethis::use_github_action()` et al and just add the Docker push action, will be more up-to-date",lwaldron,https://github.com/lima1/PureCN/issues/178
MDU6SXNzdWU4OTI3NjIxNzQ=,Flag difficult genes in callAmplifications,OPEN,2021-05-16T21:19:14Z,2021-05-16T23:25:21Z,,"Latest versions seem to have reduced artifacts quite a bit, but some are very difficult to get rid off. 

Flag genes with GC-content outliers, low mappability, small number of targets (<3?).
",lima1,https://github.com/lima1/PureCN/issues/179
MDU6SXNzdWU4OTUxNTczMzU=,"Error arguments imply differing number of rows: 0, 1 but seemingly different than previously reported issue",CLOSED,2021-05-19T08:37:04Z,2021-05-21T20:09:59Z,2021-05-21T20:09:59Z,"**Describe the issue**
I am getting this message in my error log:

$ cat -n  $logsFldr/PCN_TmrPnl_Smpl042_Tumor.e845058
     1  Error in data.frame(..., check.names = FALSE) : 
     2    arguments imply differing number of rows: 0, 1
     3  Calls: runAbsoluteCN ... eval -> eval -> eval -> cbind -> cbind -> data.frame
     4  Execution halted

It seems like it might be a different problem than was reported previously at https://github.com/lima1/PureCN/issues/124 because there are 4 more lines in the output log file before getting the error. There are the 4 additional lines:

INFO [2021-05-19 02:08:44] Excluding 0 novel or poor quality variants from segmentation.
INFO [2021-05-19 02:08:44] Sample sex: F
INFO [2021-05-19 02:08:44] Segmenting data...
INFO [2021-05-19 02:08:45] Interval weights found, will use weighted PSCBS.

**To Reproduce**
I was using version 1.18.1. Here are the command line arguments: -tumor.coverage.file 
/research/bsi/projects/prjct001/Smpl042_Tumor_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /research/bsi/projects/prjct001/Smpl042_Tumor_mutect.vcf -genome hg38 -sex F -args.setPriorVcf 6 -args.setMappingBiasVcf /research/bsi/projects/prjct001/NormalDB4_adjusted_for_NormalPanel_xTunion/mapping_bias_xTv4_hg38.rds -args.segmentation NULL,0.001,1.25 -sampleid Smpl042_Tumor -min.ploidy 1 -max.ploidy 6 -max.coverage.vcf 1150 -max.non.clonal 0.4 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 1.1 -model.homozygous FALSE -error 0.001 -interval.file /research/bsi/projects/intervals_PCN_formatted_ParameterSet003_plusGene__xTv4.txt -max.segments 20000 -plot.cnv TRUE -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM  -log.file /research/bsi/projects/PureCN_Productionprjct001/Smpl042_Tumor_mode0.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>

**Expected behavior**
I did not expect to get this error. 

**Log file**
The error log is shown above. The output log is shown below:
$ cat -n  $logsFldr/prjct001/Smpl042_Tumor_mode0_13.o8450588
     1  [1] ""/research/bsi/projects/prjct001""
     2  INFO [2021-05-19 02:08:32] Loading PureCN 1.18.1...
     3  INFO [2021-05-19 02:08:35] Mean coverages: chrX: 817.63, chrY: 0.00, chr1-22: 664.26.
     4  INFO [2021-05-19 02:08:35] Sample sex: F
     5  INFO [2021-05-19 02:08:36] ------------------------------------------------------------
     6  INFO [2021-05-19 02:08:36] PureCN 1.18.1
     7  INFO [2021-05-19 02:08:36] ------------------------------------------------------------
     8  INFO [2021-05-19 02:08:36] Arguments: -tumor.coverage.file 
/research/bsi/projects/prjct001/Smpl042_Tumor_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /research/bsi/projects/prjct001/Smpl042_Tumor_mutect.vcf -genome hg38 -sex F -args.setPriorVcf 6 -args.setMappingBiasVcf /research/bsi/projects/prjct001/NormalDB4_adjusted_for_NormalPanel_xTunion/mapping_bias_xTv4_hg38.rds -args.segmentation NULL,0.001,1.25 -sampleid Smpl042_Tumor -min.ploidy 1 -max.ploidy 6 -max.coverage.vcf 1150 -max.non.clonal 0.4 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 1.1 -model.homozygous FALSE -error 0.001 -interval.file /research/bsi/projects/intervals_PCN_formatted_ParameterSet003_plusGene__xTv4.txt -max.segments 20000 -plot.cnv TRUE -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM  -log.file /research/bsi/projects/PureCN_Productionprjct001/Smpl042_Tumor_mode0.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
     9  INFO [2021-05-19 02:08:36] Loading coverage files...
    10  INFO [2021-05-19 02:08:38] Mean target coverages: 709X (tumor) 669X (normal).
    11  WARN [2021-05-19 02:08:39] Intervals in coverage and interval.file have conflicting on/off-target annotation.
    12  INFO [2021-05-19 02:08:41] Removing 5567 intervals with missing log.ratio.
    13  INFO [2021-05-19 02:08:41] Removing 7 low/high GC targets.
    14  INFO [2021-05-19 02:08:41] Removing 2534 intervals excluded in normalDB.
    15  INFO [2021-05-19 02:08:41] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
    16  INFO [2021-05-19 02:08:41] Using 27529 intervals (13468 on-target, 14061 off-target).
    17  INFO [2021-05-19 02:08:41] Ratio of mean on-target vs. off-target read counts: 5.04
    18  INFO [2021-05-19 02:08:41] Mean off-target bin size: 192564
    19  INFO [2021-05-19 02:08:41] AT/GC dropout: 1.11 (tumor), 1.09 (normal). 
    20  WARN [2021-05-19 02:08:41] High GC-bias in normal or tumor. Is data GC-normalized?
    21  INFO [2021-05-19 02:08:41] Loading VCF...
    22  INFO [2021-05-19 02:08:41] Found 5507 variants in VCF file.
    23  INFO [2021-05-19 02:08:42] 2891 (52.5%) variants annotated as likely germline (DB INFO flag).
    24  INFO [2021-05-19 02:08:42] Smpl042_Tumor is tumor in VCF file.
    25  INFO [2021-05-19 02:08:42] 8 homozygous and 82 heterozygous variants on chrX.
    26  INFO [2021-05-19 02:08:42] Sex from VCF: F (Fisher's p-value: 0.005, odds-ratio: 0.38).
    27  INFO [2021-05-19 02:08:42] Removing 2835 MuTect calls due to blacklisted failure reasons.
    28  INFO [2021-05-19 02:08:43] Removing 1603 non heterozygous (in matched normal) germline SNPs.
    29  INFO [2021-05-19 02:08:43] Initial testing for significant sample cross-contamination: unlikely
    30  INFO [2021-05-19 02:08:43] Removing 22 variants with AF < 0.030 or AF >= 1.000 or less than 6 supporting reads or depth < 15.
    31  INFO [2021-05-19 02:08:43] Removing 0 low quality variants with BQ < 25.
    32  INFO [2021-05-19 02:08:43] Total size of targeted genomic region: 3.41Mb (4.36Mb with 50bp padding).
    33  INFO [2021-05-19 02:08:44] 7.5% of targets contain variants.
    34  INFO [2021-05-19 02:08:44] Removing 14 variants outside intervals.
    35  INFO [2021-05-19 02:08:44] Found SOMATIC annotation in VCF.
    36  INFO [2021-05-19 02:08:44] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
    37  INFO [2021-05-19 02:08:44] Found SOMATIC annotation in VCF. Setting mapping bias to 0.971.
    38  INFO [2021-05-19 02:08:44] Imputing mapping bias for 1033 variants...
    39  INFO [2021-05-19 02:08:44] Excluding 0 novel or poor quality variants from segmentation.
    40  INFO [2021-05-19 02:08:44] Sample sex: F
    41  INFO [2021-05-19 02:08:44] Segmenting data...
    42  INFO [2021-05-19 02:08:45] Interval weights found, will use weighted PSCBS.
$ 



",vedellpt,https://github.com/lima1/PureCN/issues/180
MDU6SXNzdWU4OTYxMDk4Mjg=,Questions about 3 columns in PureCN output,CLOSED,2021-05-20T00:41:15Z,2021-05-20T15:49:56Z,2021-05-20T13:28:17Z,"[PoN.ISM259430-2_gatk4cnv.csv](https://github.com/lima1/PureCN/files/6512144/PoN.ISM259430-2_gatk4cnv.csv)

Hi, Markus

I have a silly question regarding the interpretation of 3 fields in PureCN output file `$sampleName.csv` (example attached), namely ""Flagged"", ""Failed"", and ""Curated"". I have gone through the document here (https://www.bioconductor.org/packages/release/bioc/vignettes/PureCN/inst/doc/PureCN.pdf ), but I'm still a bit unclear. For example it says ""Curated"" field shall be set as TRUE, yet in my example output I got ""FALSE"" from PureCN run. 

Could you please clarify more how to interpret each field here?

Thanks

Huan

",Huan-Wang-S4,https://github.com/lima1/PureCN/issues/181
MDU6SXNzdWU5MDM3ODQwMjM=,FilterCallableLoci Error with seqlevelsStyle ,CLOSED,2021-05-27T13:48:29Z,2021-05-27T21:32:04Z,2021-05-27T21:32:04Z,"**Describe the issue**
When running FilterCallableLoci, I get the following error:
```
$ Rscript $PURECN/FilterCallableLoci.R --genome hg19 --infile callable_fixed.bed  --outfile callable_fixed_cds.bed  --exclude '^HLA'
INFO [2021-05-27 09:05:05] Loading TxDb.Hsapiens.UCSC.hg19.knownGene...
Error in seqlevelsStyle(sl) :
  The style does not have a compatible entry for the species supported by
  Seqname. Please see genomeStyles() for supported species/style
Calls: <Anonymous> -> seqlevelsStyle -> seqlevelsStyle
Execution halted
```
It seems like a possible mismatch between the chromosome names in TxDb.Hsapiens.UCSC.hg19.knownGene, but I looked at the internals and it seems like the names should match:

```
# From FilterCallableLoci.R
INFO [2021-05-27 09:02:49] Loading TxDb.Hsapiens.UCSC.hg19.knownGene...
 [1] chr1                  chr2                  chr3
 [4] chr4                  chr5                  chr6
 [7] chr7                  chr8                  chr9
[10] chr10                 chr11                 chr12
[13] chr13                 chr14                 chr15
[16] chr16                 chr17                 chr18
[19] chr19                 chr20                 chr21
[22] chr22                 chrX                  chrY
[25] chr1_gl000191_random  chr1_gl000192_random  chr4_ctg9_hap1
[28] chr4_gl000194_random  chr6_apd_hap1         chr6_cox_hap2
[31] chr6_dbb_hap3         chr6_mann_hap4        chr6_mcf_hap5
[34] chr6_qbl_hap6         chr6_ssto_hap7        chr7_gl000195_random
[37] chr9_gl000201_random  chr17_ctg5_hap1       chr17_gl000204_random
[40] chr19_gl000209_random chrUn_gl000212        chrUn_gl000213
[43] chrUn_gl000218        chrUn_gl000219        chrUn_gl000222
[46] chrUn_gl000223        chrUn_gl000228
93 Levels: chr1 chr2 chr3 chr4 chr5 chr6 chr7 chr8 chr9 chr10 chr11 ... chrUn_gl000249
Error:
Execution halted

# From my input file
$ cut -f1 callable_fixed.bed | sort -Vu
chr1
chr2
chr3
chr4
chr5
chr6
chr7
chr8
chr9
chr10
chr11
chr12
chr13
chr14
chr15
chr16
chr17
chr18
chr19
chr20
chr21
chr22
chrX
chrY
#chrom
```

I've also tried it with and without the header, but keep getting the same error.  

**To Reproduce**
I used the '[Callstate](https://github.com/Luobiny/Callstate)' package to generate the callable regions BED file (this is a replacement for GATK CallableLoci since it is no longer available in GATK4), and then ran `FilterCallableLoci.R` according to the manual:

```
Rscript $PURECN/FilterCallableLoci.R --genome hg19 --infile callable_fixed.bed  --outfile callable_fixed_cds.bed  --exclude '^HLA'
```
I've attached a copy of the input BED file in case it's helpful.
[callable_fixed.bed.gz](https://github.com/lima1/PureCN/files/6554467/callable_fixed.bed.gz)

I don't have any other logs or anything to provide.  Also, the version I'm running is the latest dev version (v1.23.1). I did try with v1.21.(?) and got the same error, so I upgraded and tried again hoping it was a bug that was fixed.  However that does not seem to change things.  
",drmrgd,https://github.com/lima1/PureCN/issues/182
MDU6SXNzdWU5MjYyNTQxNDg=,Issue running normalDB,CLOSED,2021-06-21T14:05:00Z,2021-06-23T13:21:25Z,2021-06-21T15:08:13Z,"Hello Markus,

I've been running PureCN without error for a long time. Recently started working on a new dataset and got stuck on the NormaDB step. I didn't see an error before neither could find any similar issues reported. The data that I am working on includes about 340 genes with ~80X-200X coverage. 

I tried running without GC corrected coverage and got the same error. 
Here are my commands
```
ls PureCN_Coverage_Control/*loess.txt.gz > normal_coverages.list
Rscript $PURECN_DIR/NormalDB.R --outdir purecn_reference_files_hg38_344Genes --coveragefiles normal_coverages.list --genome hg38 --assay SeqCap_VCRome --normal_panel Combined_PON_Filter_AC3.vcf.gz 

```

Here is the error I am getting. 
```
INFO [2021-06-21 09:52:12] Loading PureCN 1.22.1...
INFO [2021-06-21 09:52:26] Creating mapping bias database.
INFO [2021-06-21 09:52:27] Processing variants 1 to 5000...
WARN [2021-06-21 09:53:36] Found 4238 variants in mapping bias database.
INFO [2021-06-21 09:53:36] Creating normalDB...
Error in (function (fmt, ...)  :
  invalid format '%i'; use format %f, %e, %g or %a for numeric objects
Calls: createNormalDatabase ... flog.info -> .log_level -> layout -> do.call -> <Anonymous>
Execution halted
```

Thanks, 
Nihir",npatel-ah,https://github.com/lima1/PureCN/issues/183
MDU6SXNzdWU5MjgzMDcyMzg=,Error getting tumor ID in VCF,CLOSED,2021-06-23T14:13:44Z,2021-06-30T20:42:55Z,2021-06-23T18:19:07Z,"I'm getting an error that seems to stem from .getTumorId. Here's the error log:
```
[1] ""/mnt/disk005/data/projects/wood-pdac/PanIN-het/results/purecn/TC_098_1.2""
INFO [2021-06-23 10:11:52] Loading PureCN 1.23.3...
INFO [2021-06-23 10:11:55] ------------------------------------------------------------
INFO [2021-06-23 10:11:55] PureCN 1.23.3
INFO [2021-06-23 10:11:55] ------------------------------------------------------------
INFO [2021-06-23 10:11:55] Arguments: -tumor.coverage.file /mnt/disk005/data/projects/wood-pdac/PanIN-het/results/purecn/TC_098_1.2/TC_098_1.2.hg38_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /mnt/disk005/data/projects/wood-pdac/PanIN-het/results/strelka-somatic-germline-vcfs/TC_098_1.2_germline_somatic.vcf.gz -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100 -args.segmentation 0.005,NULL, -sampleid TC_098_1.2 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /mnt/disk005/data/projects/wood-pdac/PanIN-het/results/purecn/reference_files/baits_hg38_intervals.txt -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM  -log.file /mnt/disk005/data/projects/wood-pdac/PanIN-het/results/purecn/TC_098_1.2/TC_098_1.2.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2021-06-23 10:11:55] Loading coverage files...
INFO [2021-06-23 10:11:56] Mean target coverages: 427X (tumor) 435X (normal).
WARN [2021-06-23 10:11:56] Allosome coverage missing, cannot determine sex.
WARN [2021-06-23 10:11:56] Allosome coverage missing, cannot determine sex.
INFO [2021-06-23 10:11:58] Removing 83 intervals with missing log.ratio.
INFO [2021-06-23 10:11:58] Removing 14 low/high GC targets.
INFO [2021-06-23 10:11:58] Removing 405 intervals excluded in normalDB.
INFO [2021-06-23 10:11:58] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2021-06-23 10:11:58] Removing 929 low coverage (< 0.0015X) intervals.
INFO [2021-06-23 10:11:58] Removing 1711 low count (< 100 total reads) intervals.
INFO [2021-06-23 10:11:58] Removing 31 low mappability intervals.
INFO [2021-06-23 10:11:58] Using 15292 intervals (3426 on-target, 11866 off-target).
INFO [2021-06-23 10:11:58] Ratio of mean on-target vs. off-target read counts: 8.35
INFO [2021-06-23 10:11:58] Mean off-target bin size: 197441
INFO [2021-06-23 10:11:58] AT/GC dropout: 1.01 (tumor), 0.98 (normal), 0.99 (coverage log-ratio). 
INFO [2021-06-23 10:11:58] Loading VCF...
INFO [2021-06-23 10:11:59] Found 1452 variants in VCF file.
INFO [2021-06-23 10:12:00] Removing 97 triallelic sites.
WARN [2021-06-23 10:12:00] DP FORMAT field contains NAs. Removing 249 variants.
WARN [2021-06-23 10:12:01] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2021-06-23 10:12:01] 1102 (99.6%) variants annotated as likely germline (DB INFO flag).
WARN [2021-06-23 10:12:01] Found 5 variants with missing allelic fraction starting with chr2:231160570_G/A. Removing them.
Error in if (max(cs) > 0) return(which.min(cs)) : 
  missing value where TRUE/FALSE needed
Calls: runAbsoluteCN -> .getTumorIdInVcf -> .getTumorId
Execution halted
```
I made a combined VCF from Strelka somatic and germline mutation calls, and added the AD field. I'm not sure if the issue is with my formatting and how to fix. I checked the end of the header, and the tumor sample and normal are correctly labeled: 
```#CHROM  POS ID  REF ALT QUAL    FILTER  INFO    FORMAT  TC_098_1.2  TC_098_Normal```

Thanks!
",llyzhng,https://github.com/lima1/PureCN/issues/184
MDU6SXNzdWU5Mjk1NzA3OTY=,Using gnomAD PON for Tumor-Only Analysis Pipeline,CLOSED,2021-06-24T20:03:45Z,2021-06-26T00:15:36Z,2021-06-25T13:49:44Z,"I was interested in using the gnomAD panel of normals to run the tumor-only analysis pipeline described here: https://bcbio-nextgen.readthedocs.io/en/latest/contents/purecn.html#create-project-structure

The pon vcf is found here https://console.cloud.google.com/storage/browser/gatk-best-practices/somatic-hg38?pageState=(%22StorageObjectListTable%22:(%22f%22:%22%255B%255D%22))&prefix=&forceOnObjectsSortingFiltering=false

However going through the workflow, in describing the creation of the panel of normals, through that process bcbio produces mapping_bias_hg38.rds and normalDB_hg38.rds which are used in the project structure of the tumor-only analysis.

In order to produce those files, the workflow says to use the BAM and BED files used to create that PON but I do not have those files. It is not possible to extract a list of samples either from that VCF file.

My question was, given these constraints is it possible to use the gnomAD panel of normals for PureCN's tumor-only analysis workflow?
",ntbeileh,https://github.com/lima1/PureCN/issues/185
MDU6SXNzdWU5MzE4NDM0ODI=,Tumor purity estimation,CLOSED,2021-06-28T18:24:05Z,2021-07-03T14:50:55Z,2021-06-29T15:21:03Z,"Hi!

Is there a way to estimate tumor purity on Tumor-only exome samples using PureCN? I mean without having matched normals.",kokyriakidis,https://github.com/lima1/PureCN/issues/186
MDU6SXNzdWU5Mzc4MTA1Mjc=,PureCN run failed,CLOSED,2021-07-06T11:45:22Z,2021-07-06T15:50:28Z,2021-07-06T15:50:28Z,"Dear @lima1 ,

I tried to run PureCN through bcbio but I got the following error:

```
INFO [2021-07-06 14:18:28] ------------------------------------------------------------
INFO [2021-07-06 14:18:28] PureCN 1.22.1
INFO [2021-07-06 14:18:28] ------------------------------------------------------------
INFO [2021-07-06 14:18:28] Arguments: -tumor.coverage.file /media/kokyriakidis/PRODUCTION/TMBFDA/NORMALS/ton/work/structural/A/purecn/A_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /media/kokyriakidis/PRODUCTION/TMBFDA/NORMALS/ton/work/mutect2/A-batch-effects-annotated.vcf.gz -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /media/kokyriakidis/PRODUCTION/TMBFDA/NORMALS/pon/final/2021-07-04_pon/mapping_bias_hg19.rds -args.filterIntervals 100 -args.segmentation 0.005,NULL, -sampleid A -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /media/kokyriakidis/PRODUCTION/TMBFDA/NORMALS/ton/work/bedprep/cleaned-panel.padded100bp.merged.txt -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -log.file /media/kokyriakidis/PRODUCTION/TMBFDA/NORMALS/ton/work/structural/A/purecn/A.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2021-07-06 14:18:28] Using BiocParallel for parallel optimization.
INFO [2021-07-06 14:18:28] Loading coverage files...
INFO [2021-07-06 14:18:34] Mean target coverages: 271X (tumor) 259X (normal).
INFO [2021-07-06 14:18:34] Mean coverages: chrX: 163.01, chrY: 303.08, chr1-22: 233.20.
INFO [2021-07-06 14:18:34] Mean coverages: chrX: 184.35, chrY: 141.75, chr1-22: 233.16.
INFO [2021-07-06 14:18:48] Removing 904 intervals with missing log.ratio.
INFO [2021-07-06 14:18:48] Removing 6 low/high GC targets.
INFO [2021-07-06 14:18:48] Removing 15753 intervals excluded in normalDB.
INFO [2021-07-06 14:18:49] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2021-07-06 14:18:49] Removing 13591 low coverage (< 0.0015X) intervals.
INFO [2021-07-06 14:18:49] Removing 213 low count (< 100 total reads) intervals.
INFO [2021-07-06 14:18:49] Using 376283 intervals (354253 on-target, 22030 off-target).
INFO [2021-07-06 14:18:49] Ratio of mean on-target vs. off-target read counts: 0.08
INFO [2021-07-06 14:18:49] Mean off-target bin size: 89225
INFO [2021-07-06 14:18:50] AT/GC dropout: 1.06 (tumor), 1.03 (normal), 1.04 (coverage log-ratio). 
INFO [2021-07-06 14:18:50] Loading VCF...
INFO [2021-07-06 14:18:58] Found 162541 variants in VCF file.
INFO [2021-07-06 14:18:59] Removing 10330 triallelic sites.
INFO [2021-07-06 14:18:59] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2021-07-06 14:18:59] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2021-07-06 14:18:59] 109900 (72.2%) variants annotated as likely germline (DB INFO flag).
WARN [2021-07-06 14:19:03] Found 1 variants with missing allelic fraction starting with chr17:40490484_TGAGGGAATACTCCTGGACCTGAGGGAATACTCCTTGACCTGAGGGAATACTCCTTGACCTGAGGGAATACTCCTG/T. Removing them.
INFO [2021-07-06 14:19:03] A is tumor in VCF file.
INFO [2021-07-06 14:19:04] 998 homozygous and 854 heterozygous variants on chrX.
INFO [2021-07-06 14:19:04] Sex from VCF: F (Fisher's p-value: < 0.0001, odds-ratio: 0.66).
WARN [2021-07-06 14:19:04] Sex mismatch of coverage and VCF. Could be because of noisy data, contamination, loss of chrY or a mis-alignment of coverage and VCF.
INFO [2021-07-06 14:19:04] Detected MuTect2 VCF.
INFO [2021-07-06 14:19:06] Removing 56842 Mutect2 calls due to blacklisted failure reasons.
INFO [2021-07-06 14:19:10] Initial testing for significant sample cross-contamination: maybe
INFO [2021-07-06 14:19:11] Removing 70619 variants with AF < 0.030 or AF >= 0.970 or less than 5 supporting reads or depth < 15.
INFO [2021-07-06 14:19:12] Removing 1002 blacklisted variants.
WARN [2021-07-06 14:19:12] Variant ids contain NAs at filter step BQ.
INFO [2021-07-06 14:19:12] Removing 0 low quality variants with BQ < 25.
INFO [2021-07-06 14:19:12] Total size of targeted genomic region: 103.60Mb (119.15Mb with 50bp padding).
INFO [2021-07-06 14:19:12] 5.7% of targets contain variants.
INFO [2021-07-06 14:19:12] Removing 2956 variants outside intervals.
INFO [2021-07-06 14:19:12] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2021-07-06 14:19:13] Loading mapping bias file mapping_bias_hg19.rds...
INFO [2021-07-06 14:19:13] Found 18564 variants in mapping bias file.
Error in h(simpleError(msg, call)) : 
  error in evaluating the argument 'x' in selecting a method for function 'nrow': no method for coercing this S4 class to a vector
Calls: runAbsoluteCN ... as.character -> .local -> as.vector -> .handleSimpleError -> h
In addition: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Execution halted
' returned non-zero exit status 1.
[2021-07-06T11:19Z] PureCN failed

```

Do you have any clue what may cause this error?",kokyriakidis,https://github.com/lima1/PureCN/issues/187
MDU6SXNzdWU5NDQ4Mzg4Njg=,Compute time for calculateBamCoverageByInterval,CLOSED,2021-07-14T22:19:09Z,2022-02-02T21:30:46Z,2021-07-18T01:02:48Z,"**Describe the issue**
Compute time issue with calculateBamCoverageByInterval


**To Reproduce**
bam.file <- ""/mnt/data/purecn/reads.bam""

interval.file <- ""/home/ubuntu/purecn/processinterval""
calculateBamCoverageByInterval(bam.file = bam.file,interval.file = interval.file, output.file = ""/home/ubuntu/purecn/coveragebyinterval"")

**Expected behavior**
I was able to run calculatebamcoveragebyinterval function with chr21. However when I use whole transcriptome bam file and interval file it runs for several days and fails. Any suggestion to parallelize the process? 

",venkateshr89,https://github.com/lima1/PureCN/issues/188
MDU6SXNzdWU5NTQwODc4ODc=,Inability to complete PON generation using PureCN,CLOSED,2021-07-27T17:10:08Z,2021-07-29T15:31:02Z,2021-07-29T15:31:02Z,"Inability to complete PON generation using PureCN from the latest bcbio-nexgene toolkit.
Here is the error:
ValueError: Unexpected path for upload: {'path': '/n/scratch3/users/l/lp176/PON/PureCN/pon/work/gemini/mapping_bias_hg38.rds'}
The error file is attached.
[error_34221246.err.zip](https://github.com/lima1/PureCN/files/6887448/error_34221246.err.zip)
 ",larysa-27,https://github.com/lima1/PureCN/issues/189
MDU6SXNzdWU5NTc1Mjk5NjU=,Error in seq_len(nrow(seg)) during segmentation step,CLOSED,2021-08-01T16:14:08Z,2021-08-18T11:37:44Z,2021-08-04T17:00:24Z,"**Describe the issue**
I am encountering an error during the segmentation step when running PureCN. I can finish running PureCN when using the CNVkit coverage and segmentation files, but when I tried to use the PureCN coverage and segmentation, I see this error below,

```
2021-08-01T15:47:15.207558055Z Error in seq_len(nrow(seg)) : 
2021-08-01T15:47:15.207587198Z   argument must be coercible to non-negative integer
2021-08-01T15:47:15.207591973Z Calls: runAbsoluteCN ... do.call -> <Anonymous> -> .pruneByHclust -> sapply -> lapply
2021-08-01T15:47:15.207596841Z In addition: Warning message:
2021-08-01T15:47:15.207600327Z In seq_len(nrow(seg)) : first element used of 'length.out' argument
2021-08-01T15:47:15.207604164Z Execution halted
```

**To Reproduce**
PureCN 1.22.2 (also tried on dev latest PureCN 1.23.6, with same error)

`Rscript $PURECN/PureCN.R --out . --funsegmentation Hclust --genome hg38 --intervals S31285117_Covered_GRCh38_liftover_intervals.txt --normal normal.bam_coverage_loess.txt.gz --tumor tumor.bam_coverage_loess.txt.gz --sampleid tumor_test --vcf mutect.annot.vcf`

Prior to running PureCN.R, I have also done the following, 
- Interval file was created with `$PURECN/IntervalFile.R`
- VCF was created with Mutect2 (v4.2.0.0), further annotated vcfanno (to add flag DB to the INFO column, for presence of dbSNP; as Mutect2 has removed --dbsnp from their tool)
- Coverage files for tumor and normal was created with $PURECN/Coverage.R, as 
`Rscript $PURECN/Coverage.R --outdir . --bam tumor.bam --intervals S31285117_Covered_GRCh38_liftover_intervals.txt`
`Rscript $PURECN/Coverage.R --outdir . --bam normal.bam --intervals S31285117_Covered_GRCh38_liftover_intervals.txt`

**Log file**
Attached is the log file: [tumor_test.log](https://github.com/lima1/PureCN/files/6912954/tumor_test.log)

**Session Info**
```
R version 4.1.0 (2021-05-18)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.2 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] compiler_4.1.0
```
",boyangzhao,https://github.com/lima1/PureCN/issues/190
MDU6SXNzdWU5NjI4MjEyMDE=,low coverage or single chr tests fail on run ,CLOSED,2021-08-06T15:06:42Z,2021-09-04T16:38:53Z,2021-09-04T16:38:53Z,"PureCN version: 1.23.7

This is perhaps not an urgent issue (as it deals with less realistic scenarios) and mostly corner cases. I often have unit tests using either downsampled fastq's or a single chr6 fastq as part of a quick run on entire workflows for quick validation purposes. All these runs (including cnvkit workflows) works fine, except when I use them also on PureCN downstream. PureCN just crashes, I guess whether by design should be left as such or should it fail more gracefully, or still output some results (albeit with a lot of noise). PureCN tested on full input data runs to completion without error.

Both examples below are providing to PureCN CNVkit coverage and segmentation files,

With 1M reads inputs, PureCN generated error while on the fitting step (?), with the following error,

```
Error in apply(C.likelihood[queryHits(ov), ], 1, which.max) : 
  dim(X) must have a positive length
Calls: runAbsoluteCN ... .fitSNV -> lapply -> lapply -> FUN -> .calcSNVLLik -> apply
In addition: Warning messages:
1: In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
2: In (function (fmt, ...)  :
  one argument not used by format 'Fitting variants with %s model for local optimum %i/%i...'
Execution halted
```

With a high coverage chr6-only input, PureCN generated error while on the 2D grid search step, with the following error,

```
Error in if (subclonal.f > max.non.clonal) return(-Inf) : 
  missing value where TRUE/FALSE needed
Calls: runAbsoluteCN ... .optimizeGrid -> lapply -> lapply -> FUN -> lapply -> lapply -> FUN
In addition: Warning messages:
1: In .bcfHeaderAsSimpleList(header) :
 duplicate keys in header will be forced to unique rownames
2: In .Seqinfo.mergexy(x, y) :
 The 2 combined objects have no sequence levels in common. (Use
  suppressWarnings() to suppress this warning.)
3: In .Seqinfo.mergexy(x, y) :
The 2 combined objects have no sequence levels in common. (Use
  suppressWarnings() to suppress this warning.)
4: In .Seqinfo.mergexy(x, y) :
  The 2 combined objects have no sequence levels in common. (Use
  suppressWarnings() to suppress this warning.)
5: In .Seqinfo.mergexy(x, y) :
 The 2 combined objects have no sequence levels in common. (Use
  suppressWarnings() to suppress this warning.)
6: In .Seqinfo.mergexy(x, y) :
  The 2 combined objects have no sequence levels in common. (Use
  suppressWarnings() to suppress this warning.)
Execution halted
```

While I can (and will) have separate unit tests for PureCN that would work, right now the unit tests (and happy flow tests) I use for the whole workflows would crash PureCN. 
",boyangzhao,https://github.com/lima1/PureCN/issues/192
MDU6SXNzdWU5NjI5NDY5NzQ=,Processing noisy FFPE samples,CLOSED,2021-08-06T18:12:10Z,2021-08-09T17:46:05Z,2021-08-09T17:46:05Z,"Hello Markus!

Thanks for your work on PureCN!

**Describe the issue**
I'm trying to get copy numbers for a number of FFPE samples, both control samples and tumors are quite noisy.
Do you have any suggestions for this case, or it is just hopeless and the purity estimation is the only result I could expect to get from this data?

**To Reproduce**
Below is interval_weights_hg19.png from NormalDB.R
![interval_weights_hg19](https://user-images.githubusercontent.com/13981803/128547071-c6c875dd-b539-45d9-9f08-56e2ab9f00ab.png)

For tumors, mean sd of log-ratios ranges from 0.21 to 0.63, with the most samples >0.3.
Purities are from 0.16 to 0.89, with the median of 0.5.

**Expected behavior**
Even for the best Tumor samples with mean sd of LR = 0.21 or the highest purity 0.63, there are no C values in sample_amplification_pvalues.csv. The hope is to calculate them with some parameter tweaking.

**Log file**
INFO [2021-08-06 03:05:50] PureCN 1.23.5
INFO [2021-08-06 03:05:55] Mean target coverages: 121X (tumor) 116X (normal).
INFO [2021-08-06 03:06:14] Using 404944 intervals (382242 on-target, 22702 off-target).
INFO [2021-08-06 03:06:14] Ratio of mean on-target vs. off-target read counts: 0.52
INFO [2021-08-06 03:06:14] Mean off-target bin size: 90852
INFO [2021-08-06 03:06:15] AT/GC dropout: 1.07 (tumor), 1.06 (normal), 1.02 (coverage log-ratio).
INFO [2021-08-06 03:06:48] Total size of targeted genomic region: 116.39Mb (132.64Mb with 50bp padding).
INFO [2021-08-06 03:06:49] 18.2% of targets contain variants.
INFO [2021-08-06 03:30:24] Interval weights found, will use weighted PSCBS.
INFO [2021-08-06 03:30:24] Setting undo.SD parameter to 1.500000.
INFO [2021-08-06 03:32:22] Found 1556 segments, exceeding max.segments threshold of 300.
INFO [2021-08-06 03:32:22] Setting undo.SD parameter to 2.250000.
INFO [2021-08-06 03:33:55] Found 820 segments, exceeding max.segments threshold of 300.
INFO [2021-08-06 03:33:56] Setting prune.hclust.h parameter to 0.150000.
INFO [2021-08-06 03:34:00] Found 820 segments with median size of 0.20Mb.
INFO [2021-08-06 03:34:00] Using 69343 variants.
INFO [2021-08-06 03:34:06] Mean standard deviation of log-ratios: 0.23
INFO [2021-08-06 03:34:06] Mean standard deviation of on-target log-ratios only: 0.22
INFO [2021-08-06 04:09:26] Mean standard deviation of off-target log-ratios only: 0.18
INFO [2021-08-06 05:23:08] Tumor/normal noise ratio: 1.250

So far, I've tried:
- expanding intervals 100bp on both sides
- forcing larger segments with --undosd 1.5

Is there anything that could be one to get C numbers and maybe some deletions (the results are only Amplifications with C=NA).

Thanks!
Sergey",naumenko-sa,https://github.com/lima1/PureCN/issues/193
MDU6SXNzdWU5NzMwNzg4NzA=,VCF from Mutect2.2 tumor-only calling throws error,CLOSED,2021-08-17T21:26:53Z,2021-08-18T13:11:15Z,2021-08-18T07:12:31Z,"I am trying to run PureCN using a VCF from Mutect2's tumor-only variant calling. And I get the following error.

Error: VCF either contains no germline variants or variants are not properly 
annotated. 
 
This is most likely a user error due to invalid input data or 
parameters (PureCN 1.22.2).

I ran Mutect2 using the following parameters:
gatk Mutect2 -R hg38.analysisSet.fa -I tumor.bam -O tumor.vcf.gz --genotype-germline-sites true --genotype-pon-sites true

And this is the header of my vcf file without the contig descriptions: 

##fileformat=VCFv4.2
##FORMAT=<ID=AD,Number=R,Type=Integer,Description=""Allelic   depths for the ref and alt alleles in the order listed"">
##FORMAT=<ID=AF,Number=A,Type=Float,Description=""Allele   fractions of alternate alleles in the tumor""> |  
##FORMAT=<ID=DP,Number=1,Type=Integer,Description=""Approximate   read depth (reads with MQ=255 or with bad mates are filtered)"">
##FORMAT=<ID=F1R2,Number=R,Type=Integer,Description=""Count   of reads in F1R2 pair orientation supporting each allele"">
##FORMAT=<ID=F2R1,Number=R,Type=Integer,Description=""Count   of reads in F2R1 pair orientation supporting each allele"">
##FORMAT=<ID=GQ,Number=1,Type=Integer,Description=""Genotype   Quality""> |   |   |  
##FORMAT=<ID=GT,Number=1,Type=String,Description=""Genotype""> |   |   |   |  
##FORMAT=<ID=PGT,Number=1,Type=String,Description=""Physical   phasing haplotype information, describing how the alternate alleles are   phased in relation to one another; will always be heterozygous and is not   intended to describe called alleles"">
##FORMAT=<ID=PID,Number=1,Type=String,Description=""Physical   phasing ID information, where each unique ID within a given sample (but not   across samples) connects records within a phasing group"">
##FORMAT=<ID=PL,Number=G,Type=Integer,Description=""Normalized,   Phred-scaled likelihoods for genotypes as defined in the VCF   specification"">
##FORMAT=<ID=PS,Number=1,Type=Integer,Description=""Phasing   set (typically the position of the first variant in the set)"">
##FORMAT=<ID=SB,Number=4,Type=Integer,Description=""Per-sample   component statistics which comprise the Fisher's Exact Test to detect strand   bias."">
##GATKCommandLine=<ID=Mutect2,CommandLine=""Mutect2   --genotype-pon-sites true --genotype-germline-sites true --output   CR550mutect.vcf.gz --input ../02.Bam/CR550T.final.bam --reference   /Volumes/workstuff/hg38.analysisSet/hg38.analysisSet.fa --f1r2-median-mq 50   --f1r2-min-bq 20 --f1r2-max-depth 200 --af-of-alleles-not-in-resource -1.0   --mitochondria-mode false --tumor-lod-to-emit 3.0 --initial-tumor-lod 2.0   --pcr-snv-qual 40 --pcr-indel-qual 40 --max-population-af 0.01   --downsampling-stride 1 --callable-depth 10   --max-suspicious-reads-per-alignment-start 0 --normal-lod 2.2   --ignore-itr-artifacts false --gvcf-lod-band -2.5 --gvcf-lod-band -2.0   --gvcf-lod-band -1.5 --gvcf-lod-band -1.0 --gvcf-lod-band -0.5   --gvcf-lod-band 0.0 --gvcf-lod-band 0.5 --gvcf-lod-band 1.0   --minimum-allele-fraction 0.0 --independent-mates false   --disable-adaptive-pruning false --kmer-size 10 --kmer-size 25   --dont-increase-kmer-sizes-for-cycles false --allow-non-unique-kmers-in-ref   false --num-pruning-samples 1 --min-dangling-branch-length 4   --recover-all-dangling-branches false --max-num-haplotypes-in-population 128   --min-pruning 2 --adaptive-pruning-initial-error-rate 0.001   --pruning-lod-threshold 2.302585092994046 --pruning-seeding-lod-threshold   9.210340371976184 --max-unpruned-variants 100 --linked-de-bruijn-graph false   --disable-artificial-haplotype-recovery false   --enable-legacy-graph-cycle-detection false --debug-assembly false   --debug-graph-transformations false --capture-assembly-failure-bam false   --num-matching-bases-in-dangling-end-to-recover -1   --error-correction-log-odds -Infinity --error-correct-reads false   --kmer-length-for-read-error-correction 25   --min-observations-for-kmer-to-be-solid 20 --base-quality-score-threshold 18   --dragstr-het-hom-ratio 2 --dont-use-dragstr-pair-hmm-scores false   --pair-hmm-gap-continuation-penalty 10   --expected-mismatch-rate-for-read-disqualification 0.02   --pair-hmm-implementation FASTEST_AVAILABLE --pcr-indel-model CONSERVATIVE   --phred-scaled-global-read-mismapping-rate 45 --disable-symmetric-hmm-normalizing   false --disable-cap-base-qualities-to-map-quality false   --enable-dynamic-read-disqualification-for-genotyping false   --dynamic-read-disqualification-threshold 1.0 --native-pair-hmm-threads 4   --native-pair-hmm-use-double-precision false --bam-writer-type   CALLED_HAPLOTYPES --dont-use-soft-clipped-bases false   --min-base-quality-score 10 --smith-waterman JAVA --emit-ref-confidence NONE   --max-mnp-distance 1 --force-call-filtered-alleles false   --soft-clip-low-quality-ends false --allele-informative-reads-overlap-margin   2 --min-assembly-region-size 50 --max-assembly-region-size 300   --active-probability-threshold 0.002 --max-prob-propagation-distance 50   --force-active false --assembly-region-padding 100 --padding-around-indels 75   --padding-around-snps 20 --padding-around-strs 75   --max-extension-into-assembly-region-padding-legacy 25   --max-reads-per-alignment-start 50 --enable-legacy-assembly-region-trimming   false --interval-set-rule UNION --interval-padding 0 --interval-exclusion-padding   0 --interval-merging-rule ALL --read-validation-stringency SILENT   --seconds-between-progress-updates 10.0   --disable-sequence-dictionary-validation false --create-output-bam-index true   --create-output-bam-md5 false --create-output-variant-index true   --create-output-variant-md5 false --lenient false   --add-output-sam-program-record true --add-output-vcf-command-line true   --cloud-prefetch-buffer 40 --cloud-index-prefetch-buffer -1   --disable-bam-index-caching false --sites-only-vcf-output false --help false   --version false --showHidden false --verbosity INFO --QUIET false   --use-jdk-deflater false --use-jdk-inflater false --gcs-max-retries 20   --gcs-project-for-requester-pays    --disable-tool-default-read-filters false --max-read-length 2147483647   --min-read-length 30 --minimum-mapping-quality 20   --disable-tool-default-annotations false --enable-all-annotations   false"",Version=""4.2.0.0"",Date=""August 16, 2021 11:31:19   PM PDT"">
##INFO=<ID=AS_SB_TABLE,Number=1,Type=String,Description=""Allele-specific   forward/reverse read counts for strand bias tests. Includes the reference and   alleles separated by \|."">
##INFO=<ID=AS_UNIQ_ALT_READ_COUNT,Number=A,Type=Integer,Description=""Number   of reads with unique start and mate end positions for each alt at a variant   site"">
##INFO=<ID=CONTQ,Number=1,Type=Float,Description=""Phred-scaled   qualities that alt allele are not due to contamination"">
##INFO=<ID=DP,Number=1,Type=Integer,Description=""Approximate   read depth; some reads may have been filtered""> |  
##INFO=<ID=ECNT,Number=1,Type=Integer,Description=""Number   of events in this haplotype""> |   |  
##INFO=<ID=GERMQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles are not germline variants"">
##INFO=<ID=MBQ,Number=R,Type=Integer,Description=""median   base quality""> |   |   |  
##INFO=<ID=MFRL,Number=R,Type=Integer,Description=""median   fragment length""> |   |   |  
##INFO=<ID=MMQ,Number=R,Type=Integer,Description=""median   mapping quality""> |   |   |  
##INFO=<ID=MPOS,Number=A,Type=Integer,Description=""median   distance from end of read""> |   |  
##INFO=<ID=NALOD,Number=A,Type=Float,Description=""Negative   log 10 odds of artifact in normal with same allele fraction as   tumor"">
##INFO=<ID=NCount,Number=1,Type=Integer,Description=""Count   of N bases in the pileup""> |   |   |  
##INFO=<ID=NLOD,Number=A,Type=Float,Description=""Normal   log 10 likelihood ratio of diploid het or hom alt genotypes"">
##INFO=<ID=OCM,Number=1,Type=Integer,Description=""Number   of alt reads whose original alignment doesn't match the current   contig."">
##INFO=<ID=PON,Number=0,Type=Flag,Description=""site   found in panel of normals""> |   |   |  
##INFO=<ID=POPAF,Number=A,Type=Float,Description=""negative   log 10 population allele frequencies of alt alleles""> |  
##INFO=<ID=ROQ,Number=1,Type=Float,Description=""Phred-scaled   qualities that alt allele are not due to read orientation artifact"">
##INFO=<ID=RPA,Number=R,Type=Integer,Description=""Number   of times tandem repeat unit is repeated, for each allele (including   reference)"">
##INFO=<ID=RU,Number=1,Type=String,Description=""Tandem   repeat unit (bases)""> |   |   |  
##INFO=<ID=SEQQ,Number=1,Type=Integer,Description=""Phred-scaled   quality that alt alleles are not sequencing errors"">
##INFO=<ID=STR,Number=0,Type=Flag,Description=""Variant   is a short tandem repeat""> |   |   |  
##INFO=<ID=STRANDQ,Number=1,Type=Integer,Description=""Phred-scaled   quality of strand bias artifact""> |  
##INFO=<ID=STRQ,Number=1,Type=Integer,Description=""Phred-scaled   quality that alt alleles in STRs are not polymerase slippage errors"">
##INFO=<ID=TLOD,Number=A,Type=Float,Description=""Log   10 likelihood ratio score of variant existing versus not existing"">
##MutectVersion=2.2 

I noticed in the example VCF file provided that field that provides germline information is 
##INFO=<ID=P_GERMLINE,Number=A,Type=Float,Description=""Posterior   probability for alt allele to be germline variants"">

while the VCF file I have from Mutect2 has an info field of 
##INFO=<ID=GERMQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles are not germline variants"">

Could this be the problem?",ntbeileh,https://github.com/lima1/PureCN/issues/194
MDU6SXNzdWU5NzQ3MjQ1MTY=,"Errors in callMutationBurden - h(simpleError(msg, call))",CLOSED,2021-08-19T14:28:47Z,2021-08-19T19:10:26Z,2021-08-19T17:18:08Z,"Version: PureCN 1.23.15

With a sample .rds, when I was just testing out Dx.R biomarker tool, I observe the following error

**Command**
```Rscript /usr/local/lib/R/site-library/PureCN/extdata/Dx.R --out ./tumor_test --rds=tumor_test.rds```

**Error**
```
2021-08-19T07:04:12.359925703Z Error in h(simpleError(msg, call)) : 
2021-08-19T07:04:12.359948705Z   error in evaluating the argument 'i' in selecting a method for function '[': invalid argument type
2021-08-19T07:04:12.359952941Z Calls: callMutationBurden -> [ -> .handleSimpleError -> h
2021-08-19T07:04:12.359957179Z Execution halted
```

The files for tumor_test.rds is shared in the same (previously sent) dropbox link, in ""biomarkers"" folder. This was using one of the test samples. Other full test runs seem to be ok.
",boyangzhao,https://github.com/lima1/PureCN/issues/195
MDU6SXNzdWU5NzU1MjU2OTI=,More consistency in output directory for Dx.R?,CLOSED,2021-08-20T11:31:46Z,2021-08-21T11:33:34Z,2021-08-20T16:59:50Z,"(sorry for yet another post, my unit testing ran into another error) For Dx.R, there is the argument `--out` that allows user to specify the location (and prefix) the output files go. However, if the input rds file does not come with a curation .csv file, `createCurationFile` is called to create a csv file, into the same folder directory as where the input rds file is located. This may cause some unexpected behaviors. When this code is run with dockers and in self-contained workflows, the origination folder (where rds is located) is often read-only, so trying to write will cause a write permission error. Also from an expected behavior perspective, I guess you wouldn't expect the method to mess with the origination folders when `--out` is specified. Perhaps either write curation csv file that respect the location of the `--out` or allow user to specify as separate argument to define location of the curation file when calling `Dx.R`?",boyangzhao,https://github.com/lima1/PureCN/issues/196
MDU6SXNzdWU5OTIyNDgxNjA=,Non-sensical error message when using BiocParallel and memory runs out,CLOSED,2021-09-09T13:49:20Z,2021-09-13T16:03:34Z,2021-09-13T16:03:34Z,"INFO [2021-09-08 09:49:45] Skipping 4 solutions exceeding max.non.clonal (0.20): 0.15/1.42, 0.7/6.94, 0.44/1.01, 0.64/1 (purity/tumor ploidy)
Error in result[[njob]] <- value :
  attempt to select less than one element in OneIndex
Calls: runAbsoluteCN ... <Anonymous> -> <Anonymous> -> bploop -> bploop.lapply
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Execution halted",lima1,https://github.com/lima1/PureCN/issues/197
I_kwDOBew4us47cmkz,Error in vglm.fitter,CLOSED,2021-09-15T17:47:22Z,2021-09-19T00:34:45Z,2021-09-19T00:34:45Z,"**Describe the issue**
I'm working with WES data from FFPE samples and have 4 normal samples. I encountered an error when building the normal database: 
```
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
```

**To Reproduce**
Here is the command I ran: 
```
Rscript $PURECN/NormalDB.R --out-dir $OUT_REF \
    --coverage-files $OUT_REF/normal_coverages.list \
    --normal-panel $OUT_REF/normals_merged.vcf.gz \
    --genome hg38 \
    --assay $assayName 
```

`normal_coverages.list` contains `*_loess.txt.gz`
`normals_merged.vcf.gz` contains germline calls from Strelka 

The interval_weights.png doesn't display the Off-Target
![interval_weights_yuchen_WES_hg38](https://user-images.githubusercontent.com/22298135/133482706-29019814-030d-4317-a5c9-33cd70889c90.png)

**Expected behavior**
I'm not sure what these errors mean and how to select the off-target width. 

**Log file**
```
INFO [2021-09-15 12:28:47] Loading PureCN 1.23.29...
INFO [2021-09-15 12:28:48] Creating mapping bias database.
INFO [2021-09-15 12:28:50] Processing variants 1 to 50000...
INFO [2021-09-15 12:28:51] Not enough normal samples (4) for position-specific beta-binomial fits.
INFO [2021-09-15 12:28:51] Lowering min.normals.betafit to min.normals.assign.beta.fit (3) to seed clustering with sufficient fits.
INFO [2021-09-15 12:31:42] Clustering beta binomial fits...
INFO [2021-09-15 12:32:09] Assigning (4640/50000) variants a clustered beta binomal fit.
INFO [2021-09-15 12:32:11] Processing variants 50001 to 100000...
INFO [2021-09-15 12:32:12] Not enough normal samples (4) for position-specific beta-binomial fits.
INFO [2021-09-15 12:32:12] Lowering min.normals.betafit to min.normals.assign.beta.fit (3) to seed clustering with sufficient fits.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
WARN [2021-09-15 12:32:44] Could not fit beta binomial dist for chr5:168431457-168431465 (alt 14,19,10, ref 0,0,0, fa 0.667,0.704,0.5).
INFO [2021-09-15 12:35:15] Clustering beta binomial fits...
INFO [2021-09-15 12:35:43] Assigning (4882/50000) variants a clustered beta binomal fit.
INFO [2021-09-15 12:35:45] Processing variants 100001 to 150000...
INFO [2021-09-15 12:35:46] Not enough normal samples (4) for position-specific beta-binomial fits.
INFO [2021-09-15 12:35:46] Lowering min.normals.betafit to min.normals.assign.beta.fit (3) to seed clustering with sufficient fits.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
WARN [2021-09-15 12:35:57] Could not fit beta binomial dist for chr10:99660526-99660534 (alt 25,19,5, ref 0,0,0, fa 0.735,0.679,0.5).
INFO [2021-09-15 12:38:39] Clustering beta binomial fits...
INFO [2021-09-15 12:39:05] Assigning (4598/50000) variants a clustered beta binomal fit.
INFO [2021-09-15 12:39:06] Processing variants 150001 to 200000...
INFO [2021-09-15 12:39:08] Not enough normal samples (4) for position-specific beta-binomial fits.
INFO [2021-09-15 12:39:08] Lowering min.normals.betafit to min.normals.assign.beta.fit (3) to seed clustering with sufficient fits.
INFO [2021-09-15 12:42:17] Clustering beta binomial fits...
INFO [2021-09-15 12:42:44] Assigning (5015/50000) variants a clustered beta binomal fit.
INFO [2021-09-15 12:42:45] Processing variants 200001 to 250000...
INFO [2021-09-15 12:42:45] Position chrX:38122221
INFO [2021-09-15 12:42:45] Not enough normal samples (4) for position-specific beta-binomial fits.
INFO [2021-09-15 12:42:45] Lowering min.normals.betafit to min.normals.assign.beta.fit (3) to seed clustering with sufficient fits.
INFO [2021-09-15 12:42:55] Clustering beta binomial fits...
INFO [2021-09-15 12:42:56] Assigning (258/3076) variants a clustered beta binomal fit.
WARN [2021-09-15 12:42:58] Found 203076 variants in mapping bias database.
There were 50 or more warnings (use warnings() to see the first 50)
INFO [2021-09-15 12:42:58] Creating normalDB...
INFO [2021-09-15 12:43:23] 1096 on-target bins with low coverage in all samples.
INFO [2021-09-15 12:43:23] Mean coverages: chrX: 103.70, chrY: 36.40, chr1-22: 86.98.
INFO [2021-09-15 12:43:23] Mean coverages: chrX: 94.64, chrY: 28.74, chr1-22: 79.77.
INFO [2021-09-15 12:43:24] Mean coverages: chrX: 95.76, chrY: 32.96, chr1-22: 82.73.
INFO [2021-09-15 12:43:24] Mean coverages: chrX: 104.75, chrY: 30.34, chr1-22: 92.20.
INFO [2021-09-15 12:43:24] Processing on-target regions...
INFO [2021-09-15 12:43:38] Removing 38378 intervals with low coverage in normalDB.
INFO [2021-09-15 12:43:38] Removing 337 intervals with zero coverage in more than 3% of normalDB.
INFO [2021-09-15 12:44:03] Mean coverages: chrX: 103.70, chrY: 36.40, chr1-22: 86.98.
INFO [2021-09-15 12:44:03] Sample sex: M
INFO [2021-09-15 12:44:04] Mean coverages: chrX: 94.64, chrY: 28.74, chr1-22: 79.77.
INFO [2021-09-15 12:44:04] Sample sex: M
INFO [2021-09-15 12:44:06] Mean coverages: chrX: 95.76, chrY: 32.96, chr1-22: 82.73.
INFO [2021-09-15 12:44:06] Sample sex: M
INFO [2021-09-15 12:44:08] Mean coverages: chrX: 104.75, chrY: 30.34, chr1-22: 92.20.
INFO [2021-09-15 12:44:08] Sample sex: M
```

**Session Info**
Please start R, type sessionInfo() and paste the output.
```
R version 4.0.3 (2020-10-10)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /mnt/disk006/home/lzheng/miniconda3/envs/purecn/lib/libopenblasp-r0.3.12.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] compiler_4.0.3
```

Thanks!",llyzhng,https://github.com/lima1/PureCN/issues/198
I_kwDOBew4us47pEK4,Error: ‘nbrOfTCNsAfter >= nbrOfTCNsBefore’,CLOSED,2021-09-20T06:38:38Z,2021-09-28T04:51:30Z,2021-09-28T04:51:30Z,"**Describe the issue**
I'm running PureCN v1.22.2 and following the workflow describe at https://bioconductor.org/packages/release/bioc/vignettes/PureCN/inst/doc/Quick.html. I've built a normal DB with ~400 samples and run PureCN on 46 samples. PureCN fails on 4 of these 46 with the same error message:

```
Error: ‘nbrOfTCNsAfter >= nbrOfTCNsBefore’ is not TRUE but 
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Execution halted
```

I can't find these variables in the PureCN code base, so I assume it's an error message from a dependency. Does anyone know what the cause is, and, more importantly, how to fix it? Thanks.

**To Reproduce**

```
Rscript /usr/local/lib/R/site-library/PureCN/extdata/PureCN.R \
--out cnv \
--tumor tumour_coverage_loess.txt.gz \
--sampleid tumour \
--vcf tumour_mutect.vcf.gz \
--statsfile tumour_mutect_call_stats.txt \
--funsegmentation PSCBS \
--normaldb normalDB_idtxpc2_hg19.rds \
--mappingbiasfile mapping_bias_idtxpc2_hg19.rds \
--intervals baits_hg19_intervals.txt \
--snpblacklist hg19_simpleRepeats.bed \
--genome hg19 \
--force \
--postoptimize \
--seed 123
```

**Expected behavior**
PureCN to complete without errors and produce output files.

**Log file**

```
INFO [2021-09-17 13:21:36] Loading PureCN 1.22.2...
INFO [2021-09-17 13:21:57] Mean coverages: chrX: 41.86, chrY: 4.52, chr1-22: 74.31.
INFO [2021-09-17 13:21:57] Sample sex: M
INFO [2021-09-17 13:21:58] ------------------------------------------------------------
INFO [2021-09-17 13:21:58] PureCN 1.22.2
INFO [2021-09-17 13:21:58] ------------------------------------------------------------
INFO [2021-09-17 13:21:58] Arguments: -tumor.coverage.file tumour_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file tumour_mutect.vcf.gz -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf mapping_bias_idtxpc2_hg19.rds -args.filterIntervals 100 -args.segmentation 0.005,NULL, -sampleid tumour -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file baits_hg19_intervals.txt -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM  -log.file tumour.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2021-09-17 13:21:58] Loading coverage files...
INFO [2021-09-17 13:22:06] Mean target coverages: 93X (tumor) 88X (normal).
INFO [2021-09-17 13:22:06] Mean coverages: chrX: 41.86, chrY: 4.52, chr1-22: 74.31.
INFO [2021-09-17 13:22:07] Mean coverages: chrX: 38.38, chrY: 4.37, chr1-22: 72.78.
INFO [2021-09-17 13:22:20] Removing 977 intervals with missing log.ratio.
INFO [2021-09-17 13:22:20] Removing 17 low/high GC targets.
INFO [2021-09-17 13:22:20] Removing 4339 intervals excluded in normalDB.
INFO [2021-09-17 13:22:20] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2021-09-17 13:22:21] Removing 9626 low coverage (< 0.0015X) intervals.
INFO [2021-09-17 13:22:21] Removing 9639 low count (< 100 total reads) intervals.
INFO [2021-09-17 13:22:21] Removing 2346 low mappability intervals.
INFO [2021-09-17 13:22:21] Using 248800 intervals (238724 on-target, 10076 off-target).
INFO [2021-09-17 13:22:21] Ratio of mean on-target vs. off-target read counts: 0.56
INFO [2021-09-17 13:22:21] Mean off-target bin size: 130395
INFO [2021-09-17 13:22:21] AT/GC dropout: 1.01 (tumor), 1.01 (normal), 1.00 (coverage log-ratio). 
INFO [2021-09-17 13:22:21] Loading VCF...
INFO [2021-09-17 13:22:23] Found 168894 variants in VCF file.
INFO [2021-09-17 13:22:23] 134536 (79.7%) variants annotated as likely germline (DB INFO flag).
INFO [2021-09-17 13:22:25] 20210708-0006-HGGYYDRXY-TruD-IdtXPC2 is tumor in VCF file.
INFO [2021-09-17 13:22:25] 769 homozygous and 88 heterozygous variants on chrX.
INFO [2021-09-17 13:22:25] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 12.73).
WARN [2021-09-17 13:22:29] Excessive seen_in_panel_of_normals, ignoring this flag. Check your data.
INFO [2021-09-17 13:22:29] Removing 76791 MuTect calls due to blacklisted failure reasons.
INFO [2021-09-17 13:22:35] Initial testing for significant sample cross-contamination: maybe
INFO [2021-09-17 13:22:36] Removing 49665 variants with AF < 0.030 or AF >= 0.970 or less than 4 supporting reads or depth < 15.
INFO [2021-09-17 13:22:38] Removing 0 blacklisted variants.
INFO [2021-09-17 13:22:38] Removing 305 low quality variants with BQ < 25.
INFO [2021-09-17 13:22:39] Total size of targeted genomic region: 72.45Mb (88.64Mb with 50bp padding).
INFO [2021-09-17 13:22:39] 12.3% of targets contain variants.
INFO [2021-09-17 13:22:39] Removing 9004 variants outside intervals.
INFO [2021-09-17 13:22:39] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2021-09-17 13:22:40] Loading mapping bias file mapping_bias_idtxpc2_hg19.rds...
INFO [2021-09-17 13:22:41] Found 672418 variants in mapping bias file.
INFO [2021-09-17 13:22:42] Imputing mapping bias for 2743 variants...
INFO [2021-09-17 13:23:55] Excluding 2119 novel or poor quality variants from segmentation.
INFO [2021-09-17 13:23:55] Excluding 2743 variants not in pool of normals from segmentation.
INFO [2021-09-17 13:23:55] Sample sex: M
INFO [2021-09-17 13:23:55] Segmenting data...
INFO [2021-09-17 13:23:56] Interval weights found, will use weighted PSCBS.
INFO [2021-09-17 13:23:56] Setting undo.SD parameter to 1.000000.
INFO [2021-09-17 13:23:57] On-target much cleaner than off-target, finding on-target breakpoints first...
INFO [2021-09-17 13:23:57] Using 178299 high quality (out of 243706) on-target intervals for initial breakpoint calculation.
INFO [2021-09-17 13:24:44] Setting prune.hclust.h parameter to 0.150000.
Error: ‘nbrOfTCNsAfter >= nbrOfTCNsBefore’ is not TRUE but 
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Execution halted
```

Output of `Coverage.R`:
```
INFO [2021-09-17 11:45:29] Loading PureCN 1.22.2...
INFO [2021-09-17 11:45:30] Processing tumour_coverage.txt.gz...
Warning messages:
1: stat_contour(): Zero contours were generated 
2: In min(x) : no non-missing arguments to min; returning Inf
3: In max(x) : no non-missing arguments to max; returning -Inf
4: stat_contour(): Zero contours were generated 
5: In min(x) : no non-missing arguments to min; returning Inf
6: In max(x) : no non-missing arguments to max; returning -Inf
7: Removed 870 rows containing non-finite values (stat_density2d). 
```

**B-allele frequency plot**
No output is produced.

**Session Info**

```
R version 4.1.1 (2021-08-10)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux bookworm/sid

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.17.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8       
 [4] LC_COLLATE=en_US.UTF-8     LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
[10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    parallel  stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] PureCN_1.22.2               VariantAnnotation_1.38.0    Rsamtools_2.8.0            
 [4] Biostrings_2.60.2           XVector_0.32.0              SummarizedExperiment_1.22.0
 [7] Biobase_2.52.0              GenomicRanges_1.44.0        GenomeInfoDb_1.28.4        
[10] IRanges_2.26.0              S4Vectors_0.30.0            MatrixGenerics_1.4.3       
[13] matrixStats_0.60.1          BiocGenerics_0.38.0         DNAcopy_1.66.0             

loaded via a namespace (and not attached):
 [1] bitops_1.0-7             bit64_4.0.5              filelock_1.0.2           RColorBrewer_1.1-2      
 [5] progress_1.2.2           httr_1.4.2               tools_4.1.1              utf8_1.2.2              
 [9] R6_2.5.1                 DBI_1.1.1                colorspace_2.0-2         rhdf5filters_1.4.0      
[13] tidyselect_1.1.1         gridExtra_2.3            prettyunits_1.1.1        bit_4.0.4               
[17] curl_4.3.2               compiler_4.1.1           formatR_1.11             xml2_1.3.2              
[21] DelayedArray_0.18.0      rtracklayer_1.52.1       scales_1.1.1             rappdirs_0.3.3          
[25] stringr_1.4.0            digest_0.6.27            pkgconfig_2.0.3          dbplyr_2.1.1            
[29] fastmap_1.1.0            BSgenome_1.60.0          rlang_0.4.11             rstudioapi_0.13         
[33] RSQLite_2.2.8            VGAM_1.1-5               BiocIO_1.2.0             generics_0.1.0          
[37] BiocParallel_1.26.2      dplyr_1.0.7              RCurl_1.98-1.4           magrittr_2.0.1          
[41] GenomeInfoDbData_1.2.6   futile.logger_1.4.3      Matrix_1.3-4             Rcpp_1.0.7              
[45] munsell_0.5.0            Rhdf5lib_1.14.2          fansi_0.5.0              lifecycle_1.0.0         
[49] stringi_1.7.4            yaml_2.2.1               zlibbioc_1.38.0          rhdf5_2.36.0            
[53] BiocFileCache_2.0.0      grid_4.1.1               blob_1.2.2               crayon_1.4.1            
[57] lattice_0.20-44          splines_4.1.1            GenomicFeatures_1.44.2   hms_1.1.0               
[61] KEGGREST_1.32.0          pillar_1.6.2             rjson_0.2.20             biomaRt_2.48.3          [65] futile.options_1.0.1     XML_3.99-0.7             glue_1.4.2               lambda.r_1.2.4          [69] data.table_1.14.0        png_0.1-7                vctrs_0.3.8              gtable_0.3.0            
[73] purrr_0.3.4              assertthat_0.2.1         cachem_1.0.6             ggplot2_3.3.5           
[77] restfulr_0.0.13          tibble_3.1.4             GenomicAlignments_1.28.0 AnnotationDbi_1.54.1    
[81] memoise_2.0.0            ellipsis_0.3.2   
```
",jje42,https://github.com/lima1/PureCN/issues/199
I_kwDOBew4us473oJW,PureCN fails with segments too short,CLOSED,2021-09-22T15:31:28Z,2021-09-28T21:43:32Z,2021-09-28T21:43:32Z,"Hi Markus, 

I have two problematic samples I was hoping to get some advice on. Not sure if you have seen this before or if there is some way to salvage either of these cases?

1. 
I have been trying to analyse a tumor only sample which looks like it has some serious issues with regard to its CNV data - strangely the general metrics look great - 300x+ coverage, multiqc metrics are all nominal but the CNV data looks horrendous.

I was wondering if there is anyway to save this sample to get something out of it or infact if you've seen something like this before and have any idea what happened.

I processed initially with CNVKIT and then provided the SEG file to PureCN. 

CNV plot chr1 (with good sample on left)
![image](https://user-images.githubusercontent.com/71687/134372441-7afb7baa-d2d5-45d8-aac3-52754a4a6910.png)


Is it possible this is close to 100% purity and that is why it looks so messy? 

2. I have a different issue with another tumor only sample, this one at least produces a segmentation plot but it looks like there are no CNV alterations accross the entire sample ( I just plot chr1 but all of them look the same). This sample also has  good coverage and general qc metrics. To me this looks like the purity is much lower than the estimated 0.28, is it possible the purity here is really much lower ? The pathology estimate was around 0.4 but don't have much faith in that. 

![image](https://user-images.githubusercontent.com/71687/134373096-c15e3123-2795-4e89-802f-11f0b2db6bb1.png)

Thanks!
",waemm,https://github.com/lima1/PureCN/issues/200
I_kwDOBew4us474kiT,Invalid Format Crash in runAbsoluteCN,CLOSED,2021-09-22T19:28:39Z,2021-09-23T12:16:23Z,2021-09-23T00:09:38Z,"Hi Markus, 
Over the last two days I've been getting a strange error on our cluster:

```
INFO [2021-09-21 20:27:15] MAPD of 11095 allelic fractions: 0.04 (0.03 adjusted).
Error in (function (fmt, ...)  :
  invalid format '%f'; use format %s for character objects
Calls: runAbsoluteCN ... flog.info -> .log_level -> layout -> do.call -> <Anonymous>
In addition: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Execution halted
```
At first I thought it was related to the latest dev version 1.99.31, to which I upgraded yesterday while trying to optimize some oversegmentation issues I'm having.  However, I've tried with v1.23.27, the previous version I was using, which worked OK, version 1.22.2, which is the default version our cluster maintainer has installed, and v1.20.0, which is the default version that out cluster maintainer has installed for R version 4.0.5.  Speaking of which, the version of R under which I was running PureCN v1.23.27 and v1.99.31 was R v4.1.0.

This is failing right before the call to PSCBS in runAbsoluteCN from the last message to the log file I think, but I can't quite figure out the call and offending line in code.  I did attempt to run with CSB segmentation instead, just in case PSCBS was the one sending the message to the logger and causing the crash, but that didn't seem to solve it.

My guess is that there was some collateral package that was upgraded at some point, which has changed the way string formatting is working or something, but it's really hard for me to figure out.   In case this serves as some kind of breadcrumb, here is the sessionInfo for the 1.99.31 attempt:

```
> sessionInfo()
R version 4.1.0 (2021-05-18)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /usr/local/intel/compilers_and_libraries_2020.2.254/linux/mkl/lib/intel64_lin/libmkl_rt.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats4    parallel  stats     graphics  grDevices utils     datasets
[8] methods   base

other attached packages:
 [1] PureCN_1.99.31              VariantAnnotation_1.38.0
 [3] Rsamtools_2.8.0             Biostrings_2.60.2
 [5] XVector_0.32.0              SummarizedExperiment_1.22.0
 [7] Biobase_2.52.0              GenomicRanges_1.44.0
 [9] GenomeInfoDb_1.28.4         IRanges_2.26.0
[11] S4Vectors_0.30.0            MatrixGenerics_1.4.3
[13] matrixStats_0.61.0          BiocGenerics_0.38.0
[15] DNAcopy_1.66.0

loaded via a namespace (and not attached):
 [1] bitops_1.0-7             bit64_4.0.5              filelock_1.0.2
 [4] RColorBrewer_1.1-2       progress_1.2.2           httr_1.4.2
 [7] tools_4.1.0              utf8_1.2.2               R6_2.5.1
[10] DBI_1.1.1                colorspace_2.0-2         rhdf5filters_1.4.0
[13] tidyselect_1.1.1         gridExtra_2.3            prettyunits_1.1.1
[16] bit_4.0.4                curl_4.3.2               compiler_4.1.0
[19] formatR_1.11             xml2_1.3.2               DelayedArray_0.18.0
[22] rtracklayer_1.52.1       scales_1.1.1             rappdirs_0.3.3
[25] stringr_1.4.0            digest_0.6.27            pkgconfig_2.0.3
[28] dbplyr_2.1.1             fastmap_1.1.0            BSgenome_1.60.0
[31] rlang_0.4.11             rstudioapi_0.13          RSQLite_2.2.8
[34] VGAM_1.1-5               BiocIO_1.2.0             generics_0.1.0
[37] mclust_5.4.7             BiocParallel_1.26.2      dplyr_1.0.7
[40] RCurl_1.98-1.5           magrittr_2.0.1           GenomeInfoDbData_1.2.6
[43] futile.logger_1.4.3      Matrix_1.3-4             Rcpp_1.0.7
[46] munsell_0.5.0            Rhdf5lib_1.14.2          fansi_0.5.0
[49] lifecycle_1.0.0          stringi_1.7.4            yaml_2.2.1
[52] zlibbioc_1.38.0          rhdf5_2.36.0             BiocFileCache_2.0.0
[55] grid_4.1.0               blob_1.2.2               crayon_1.4.1
[58] lattice_0.20-45          splines_4.1.0            GenomicFeatures_1.44.2
[61] hms_1.1.0                KEGGREST_1.32.0          pillar_1.6.2
[64] rjson_0.2.20             biomaRt_2.48.3           futile.options_1.0.1
[67] XML_3.99-0.8             glue_1.4.2               lambda.r_1.2.4
[70] data.table_1.14.0        png_0.1-7                vctrs_0.3.8
[73] gtable_0.3.0             purrr_0.3.4              assertthat_0.2.1
[76] cachem_1.0.6             ggplot2_3.3.5            restfulr_0.0.13
[79] tibble_3.1.4             GenomicAlignments_1.28.0 AnnotationDbi_1.54.1
[82] memoise_2.0.0            ellipsis_0.3.2
```

Do you have a suggestion for what's throwing this error and how I might fix it?  Thanks in advance!",drmrgd,https://github.com/lima1/PureCN/issues/201
I_kwDOBew4us486zTn,Seqlevels missing in provided segmentation error,CLOSED,2021-10-10T17:46:18Z,2024-11-19T06:57:43Z,2021-10-14T12:48:30Z,"Hi Markus,

I encountered an error from PureCN `Seqlevels missing in provided segmentation: Y`. I'm not sure if this has to do with these samples being female, and somehow it's looking for Y chr?

Bo

```
INFO [2021-10-03 07:35:24] ------------------------------------------------------------
INFO [2021-10-03 07:35:24] PureCN 1.99.32
INFO [2021-10-03 07:35:24] ------------------------------------------------------------
INFO [2021-10-03 07:35:24] Arguments: -normal.coverage.file  -tumor.coverage.file tumor.cnr -log.ratio  -seg.file tumor.seg -vcf.file mutect.vcf.gz -normalDB  -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid Tumor -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize FALSE -BPPARAM  -log.file ./purecn.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2021-10-03 07:35:24] Loading coverage files...
INFO [2021-10-03 07:35:28] Found log2-ratio in tumor coverage data.
WARN [2021-10-03 07:35:28] log2-ratio contains outliers < -8, ignoring them...
INFO [2021-10-03 07:35:30] Mean coverages: chrX: 468.76, chrY: 11.34, chr1-22: 391.84.
INFO [2021-10-03 07:35:30] Mean coverages: chrX: 468.76, chrY: 11.34, chr1-22: 391.84.
INFO [2021-10-03 07:35:30] Removing 979 intervals with missing log.ratio.
INFO [2021-10-03 07:35:30] Using 236196 intervals (198747 on-target, 37449 off-target).
INFO [2021-10-03 07:35:30] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2021-10-03 07:35:30] Mean off-target bin size: 59748
INFO [2021-10-03 07:35:30] Loading VCF...
INFO [2021-10-03 07:35:38] Found 179162 variants in VCF file.
INFO [2021-10-03 07:35:39] Removing 18893 triallelic sites.
WARN [2021-10-03 07:35:39] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2021-10-03 07:35:40] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2021-10-03 07:35:40] 137343 (85.7%) variants annotated as likely germline (DB INFO flag).
WARN [2021-10-03 07:35:44] Found 16699 variants with missing allelic fraction starting with 1:15903_G/GC. Removing them.
INFO [2021-10-03 07:35:46] Tumor is tumor in VCF file.
INFO [2021-10-03 07:35:48] 709 homozygous and 1141 heterozygous variants on chrX.
INFO [2021-10-03 07:35:48] Sex from VCF: F (Fisher's p-value: 0.24, odds-ratio: 0.94).
INFO [2021-10-03 07:35:48] Detected MuTect2 VCF.
INFO [2021-10-03 07:35:49] Removing 52221 Mutect2 calls due to blacklisted failure reasons.
INFO [2021-10-03 07:35:49] Removing 47560 non heterozygous (in matched normal) germline SNPs.
INFO [2021-10-03 07:35:52] Initial testing for significant sample cross-contamination: unlikely
INFO [2021-10-03 07:35:53] Removing 586 variants with AF < 0.030 or AF >= 1.000 or less than 5 supporting reads or depth < 15.
WARN [2021-10-03 07:35:53] Variant ids contain NAs at filter step BQ.
INFO [2021-10-03 07:35:53] Removing 0 low quality variants with BQ < 25.
INFO [2021-10-03 07:35:53] Total size of targeted genomic region: 43.81Mb (61.03Mb with 50bp padding).
INFO [2021-10-03 07:35:54] 11.4% of targets contain variants.
INFO [2021-10-03 07:35:54] Removing 18285 variants outside intervals.
INFO [2021-10-03 07:35:54] Found SOMATIC annotation in VCF.
INFO [2021-10-03 07:35:54] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2021-10-03 07:35:55] Found SOMATIC annotation in VCF. Setting mapping bias to 0.985.
INFO [2021-10-03 07:35:55] Excluding 449 novel or poor quality variants from segmentation.
INFO [2021-10-03 07:35:55] Sample sex: F
INFO [2021-10-03 07:35:55] Segmenting data...
INFO [2021-10-03 07:35:55] Loaded provided segmentation file tumor.seg (format DNAcopy).
WARN [2021-10-03 07:35:55] Provided sampleid (Tumor) does not match tumor found in segmentation.
INFO [2021-10-03 07:35:55] Re-centering provided segment means (offset -0.1515).
INFO [2021-10-03 07:35:55] Setting prune.hclust.h parameter to 0.150000.
FATAL [2021-10-03 07:35:55] Seqlevels missing in provided segmentation: Y 

FATAL [2021-10-03 07:35:55]  

FATAL [2021-10-03 07:35:55] This is most likely a user error due to invalid input data or 

FATAL [2021-10-03 07:35:55] parameters (PureCN 1.99.32). 
```",boyangzhao,https://github.com/lima1/PureCN/issues/203
I_kwDOBew4us4-C0bc,VCF failing when looking at the results?,CLOSED,2021-11-01T08:52:24Z,2021-11-24T14:56:00Z,2021-11-03T14:28:49Z,"Hi,
I am a pretty new user of PureCN, I have managed to get it to work and generate results files, but I am not sure if it is working correctly. I have installed and used PureCN 2.1.0 version and have WES data matched germline/tumor samples also I have run without NormalDB. I am thinking that the format of my VCF might be the problem, it is from Mutect 2.2 I have one VCF from germline which data is sequenced on 100x  (well filtered 26 000 SNPs) and tumor VCF with data sequenced 150x (512 somatic mutations) (below are examples first is germline VCF second somatic VCF)
![image](https://user-images.githubusercontent.com/92018021/139644668-10fbd473-7c5a-475f-a53a-6cd638209936.png)

![image](https://user-images.githubusercontent.com/92018021/139644970-de2e2aa4-b6ef-4781-b6eb-7ae1f2282c06.png)
From these two VCFs, I made one VCF by renaming sample in germline into tumor sample same as in somatic VCF and merged them afterward using GATK MergeVCFs (example below)
![image](https://user-images.githubusercontent.com/92018021/139645530-eaa35306-fedb-494a-a8b7-49d34c5b79af.png)
Here is also a log from PureCN

[1737_merged.log](https://github.com/lima1/PureCN/files/7451833/1737_merged.log)
And these are the results:

[1737_merged.pdf](https://github.com/lima1/PureCN/files/7451840/1737_merged.pdf)
I am not sure for the graph showing germline and somatic mutations if should look like that, and also it has lof GoF 78,5%, and when shows average coverage is 66x.
Could you help me to understand better this? I am sorry for the long post. 
Thank you.
Marijana
",maxanes,https://github.com/lima1/PureCN/issues/204
I_kwDOBew4us4-Qy-U,Error in Coverage.R with WGS samples,CLOSED,2021-11-04T10:32:28Z,2022-03-09T08:31:01Z,2021-11-05T18:18:22Z,"I'm trying to run PureCN with a family WGS samples( Mum, Dad and 2 children). 
Since, purecn doesn't require a matched normal, I was planning to use mum and dad's coverage data to run normalDB with the joint_germline.vcf (only mum&dad) to input as normal panel. 
So, it would be child1 vs normalDB(Mum&Dad) , child2 vs normalDB(Mum&Dad).

But I happen to face different errors when running Coverage.R with the children and parents. Since,  I had no problem running it with WES samples before, I probably think it has something to do with  WGS samples but I couldn't solve it by myself.  Just in case, the code I  used to calculate coverage is the same for all 4 wgs datas. 

What would be the problem here? Also, if there are suggestion about running trio samples. please let me know. 
 Thank you 

[Children]
Rscript $PURECN/Coverage.R \
        --out-dir $PureCN_Path/ \
        --bam $Aligned_Path/$INPUT \
        --intervals $INTERVAL
<Log File>

![image](https://user-images.githubusercontent.com/77954045/140299074-6095f38c-c4a6-4a84-ae68-6461890f917f.png)

<Error File>

![image](https://user-images.githubusercontent.com/77954045/140299118-16537af0-8cde-468b-ad55-3d5608a9d21a.png)

[Parents as Normal]
Rscript $PURECN/Coverage.R \
        --out-dir $PureCN_Path/normals \
        --bam $Aligned_Path/$INPUT \
        --intervals $INTERVAL
<Log File>

![image](https://user-images.githubusercontent.com/77954045/140318327-dcaa10bd-29f2-4250-84bf-4bd745db4f17.png)

<Error File>

![image](https://user-images.githubusercontent.com/77954045/140318370-d0592879-cb07-4183-bc9a-835f97eb0c3a.png)


**Session Info**
Please start R, type sessionInfo() and paste the output.
![image](https://user-images.githubusercontent.com/77954045/140298446-6d71d088-ffb2-4271-86f7-9b199366049c.png)
",jennyp76,https://github.com/lima1/PureCN/issues/205
I_kwDOBew4us4-ltsp,Use base quality scores instead of global error rate,CLOSED,2021-11-10T16:52:34Z,2021-12-12T23:17:45Z,2021-12-12T23:17:45Z,"If high quality base quality scores are available, especially for UMI barcoded data, we should use them.

Likely use min(BQS, bqs.percentile.cutoff) as position error. That way the user can add some padding to allow for too optimistically calibrated error rates. Use conservative default of 0.1-0.15.",lima1,https://github.com/lima1/PureCN/issues/206
I_kwDOBew4us4_ZrCI,Question related to reading results,CLOSED,2021-11-25T15:03:41Z,2021-11-26T15:12:28Z,2021-11-26T15:12:28Z,"Hi,
Could you please help me to correctly read the result file?
I am not sure what is the meaning of 2m1 or 4m2 on this graph below, is the first number, number of copies and if so what is m (multiplicity?) and the second number (number of chromosomes harboring the mutations)?
![image](https://user-images.githubusercontent.com/92018021/143460650-5e98774b-f3e7-4529-96b4-ff83541a2f08.png)

and for sex I get this but not predicted as XY or XX
INFO [2021-11-24 11:14:48] 1720 homozygous and 1093 heterozygous variants on chrX.
INFO [2021-11-24 11:14:48] Sex from VCF: NA (Fisher's p-value: < 0.0001, odds-ratio: 3.57).

This Is the final .csv file saying, how should I curate that?
Sampleid	 Purity       Ploidy    Sex   Contamination	 Flagged	    Failed	   Curated	Comment
X1737	0.62	     2,12739	M	           0            FALSE	      FALSE	      FALSE        NA

Thank you.
",maxanes,https://github.com/lima1/PureCN/issues/207
I_kwDOBew4us4_zBYX,Conda installation for hg38 with dependencies,CLOSED,2021-12-03T08:28:24Z,2021-12-07T18:39:52Z,2021-12-07T18:39:37Z,"Hi,

I am trying to install PureCN with conda (`conda install -c bioconda bioconductor-purecn=2.0.1`), but I have some concerns:
- Is this for hg38? If not, how is this possible with conda?
- Is this the latest version? I know it is currently the latest version available with conda
- Is it possible to install with dependencies (e.g. optparse) since I use the CLI?

## Solution
```
conda install -c bioconda bioconductor-purecn=2.0.1
conda install -c conda-forge r-optparse
conda install -c bioconda bioconductor-txdb.hsapiens.ucsc.hg38.knowngene
conda install -c conda-forge r-r.utils
```",DanielAndreasen,https://github.com/lima1/PureCN/issues/208
I_kwDOBew4us4__byc,Invalid format error when creating NormalDB in 2.0.1 but not in 1.20.0,CLOSED,2021-12-07T17:21:10Z,2021-12-08T16:33:29Z,2021-12-08T16:06:14Z,"**Describe the issue**

Hi Markus @lima1 ! Thanks for you continuing commitment to PureCN!
I am experiencing an issue similar to https://github.com/lima1/PureCN/issues/183 (which was for PureCN 1.22.1)

**To Reproduce**
```bash
Rscript NormalDB.R \
--outdir out \
--coveragefiles purecn_coverage_files.txt \
--normal_panel pon_build-mutect2.vcf.gz \
--genome hg19 \
--force
```

**Expected behavior**
NormalDB is created

**Log file = PureCN 2.0.1 - failure**
```
INFO [2021-12-07 15:08:49] Loading PureCN 2.0.1...
INFO [2021-12-07 15:08:49] Creating mapping bias database.
INFO [2021-12-07 15:08:50] Processing variants 1 to 50000...
INFO [2021-12-07 15:13:58] Clustering beta binomial fits...
INFO [2021-12-07 15:14:52] Assigning (2867/14615) variants a clustered beta binomal fit.
WARN [2021-12-07 15:14:52] Found 14615 variants in mapping bias database.
There were 50 or more warnings (use warnings() to see the first 50)
INFO [2021-12-07 15:14:53] Creating normalDB...
Error in (function (fmt, ...)  :
  invalid format '%i'; use format %f, %e, %g or %a for numeric objects
Calls: createNormalDatabase ... flog.info -> .log_level -> layout -> do.call -> <Anonymous>
Execution halted
```

**Log file = PureCN 1.2.0 - success**
```
INFO [2021-12-07 16:38:44] Loading PureCN 1.20.0...
INFO [2021-12-07 16:38:56] Creating mapping bias database.
INFO [2021-12-07 16:38:56] Processing variants 1 to 5000...
INFO [2021-12-07 16:40:43] Processing variants 5001 to 10000...
INFO [2021-12-07 16:42:26] Processing variants 10001 to 15000...
INFO [2021-12-07 16:44:01] Creating normalDB. Assuming coverage files are GC-normalized.
INFO [2021-12-07 16:45:44] 66 on-target bins with low coverage in all samples.
INFO [2021-12-07 16:45:44] Mean coverages: chrX: 108.74, chrY: 54.36, chr1-22: 130.33.
INFO [2021-12-07 16:45:44] Mean coverages: chrX: 95.86, chrY: 67.44, chr1-22: 156.83.
INFO [2021-12-07 16:45:44] Mean coverages: chrX: 167.09, chrY: 174.21, chr1-22: 270.29.
INFO [2021-12-07 16:45:44] Mean coverages: chrX: 103.94, chrY: 111.42, chr1-22: 176.29.
INFO [2021-12-07 16:45:45] Mean coverages: chrX: 89.96, chrY: 98.28, chr1-22: 147.71.
INFO [2021-12-07 16:45:45] Mean coverages: chrX: 147.95, chrY: 1.36, chr1-22: 125.14.
INFO [2021-12-07 16:45:45] Mean coverages: chrX: 205.73, chrY: 2.00, chr1-22: 169.95.
INFO [2021-12-07 16:45:45] Mean coverages: chrX: 74.68, chrY: 62.94, chr1-22: 130.07.
INFO [2021-12-07 16:45:45] Mean coverages: chrX: 94.25, chrY: 104.08, chr1-22: 153.83.
INFO [2021-12-07 16:45:45] Mean coverages: chrX: 282.35, chrY: 2.86, chr1-22: 233.06.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 176.93, chrY: 1.72, chr1-22: 145.16.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 187.43, chrY: 1.88, chr1-22: 154.81.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 160.93, chrY: 170.92, chr1-22: 264.06.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 116.32, chrY: 131.19, chr1-22: 189.08.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 194.41, chrY: 1.95, chr1-22: 164.88.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 158.59, chrY: 1.69, chr1-22: 135.54.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 204.83, chrY: 2.11, chr1-22: 167.60.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 55.86, chrY: 20.23, chr1-22: 100.86.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 116.98, chrY: 1.40, chr1-22: 98.75.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 151.77, chrY: 154.54, chr1-22: 249.14.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 97.02, chrY: 104.10, chr1-22: 162.49.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 93.93, chrY: 112.87, chr1-22: 157.53.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 108.69, chrY: 120.07, chr1-22: 176.78.
INFO [2021-12-07 16:45:46] Mean coverages: chrX: 73.74, chrY: 81.98, chr1-22: 123.54.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 48.10, chrY: 50.34, chr1-22: 81.55.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 108.53, chrY: 115.50, chr1-22: 176.43.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 88.38, chrY: 96.32, chr1-22: 144.52.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 106.72, chrY: 114.68, chr1-22: 174.52.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 122.15, chrY: 81.86, chr1-22: 198.53.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 110.31, chrY: 123.93, chr1-22: 179.92.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 93.02, chrY: 100.16, chr1-22: 151.37.
INFO [2021-12-07 16:45:47] Mean coverages: chrX: 98.64, chrY: 103.46, chr1-22: 160.02.
INFO [2021-12-07 16:45:47] Processing on-target regions...
INFO [2021-12-07 16:45:56] Removing 2315 intervals with low coverage in normalDB.
INFO [2021-12-07 16:45:56] Removing 276 intervals with zero coverage in more than 3% of normalDB.
INFO [2021-12-07 16:46:25] Processing off-target regions...
INFO [2021-12-07 16:46:26] Removing 7600 intervals with low coverage in normalDB.
INFO [2021-12-07 16:46:26] Removing 15648 intervals with zero coverage in more than 3% of normalDB.
INFO [2021-12-07 16:46:28] Mean coverages: chrX: 108.74, chrY: 54.36, chr1-22: 130.33.
INFO [2021-12-07 16:46:28] Sample sex: M
INFO [2021-12-07 16:46:29] Mean coverages: chrX: 95.86, chrY: 67.44, chr1-22: 156.83.
INFO [2021-12-07 16:46:29] Sample sex: M
INFO [2021-12-07 16:46:30] Mean coverages: chrX: 167.09, chrY: 174.21, chr1-22: 270.29.
INFO [2021-12-07 16:46:30] Sample sex: M
INFO [2021-12-07 16:46:32] Mean coverages: chrX: 103.94, chrY: 111.42, chr1-22: 176.29.
INFO [2021-12-07 16:46:32] Sample sex: M
INFO [2021-12-07 16:46:33] Mean coverages: chrX: 89.96, chrY: 98.28, chr1-22: 147.71.
INFO [2021-12-07 16:46:33] Sample sex: M
INFO [2021-12-07 16:46:34] Mean coverages: chrX: 147.95, chrY: 1.36, chr1-22: 125.14.
INFO [2021-12-07 16:46:34] Sample sex: F
INFO [2021-12-07 16:46:35] Mean coverages: chrX: 205.73, chrY: 2.00, chr1-22: 169.95.
INFO [2021-12-07 16:46:35] Sample sex: F
INFO [2021-12-07 16:46:36] Mean coverages: chrX: 74.68, chrY: 62.94, chr1-22: 130.07.
INFO [2021-12-07 16:46:36] Sample sex: M
INFO [2021-12-07 16:46:37] Mean coverages: chrX: 94.25, chrY: 104.08, chr1-22: 153.83.
INFO [2021-12-07 16:46:37] Sample sex: M
INFO [2021-12-07 16:46:38] Mean coverages: chrX: 282.35, chrY: 2.86, chr1-22: 233.06.
INFO [2021-12-07 16:46:38] Sample sex: F
INFO [2021-12-07 16:46:40] Mean coverages: chrX: 176.93, chrY: 1.72, chr1-22: 145.16.
INFO [2021-12-07 16:46:40] Sample sex: F
INFO [2021-12-07 16:46:40] Mean coverages: chrX: 187.43, chrY: 1.88, chr1-22: 154.81.
INFO [2021-12-07 16:46:40] Sample sex: F
INFO [2021-12-07 16:46:41] Mean coverages: chrX: 160.93, chrY: 170.92, chr1-22: 264.06.
INFO [2021-12-07 16:46:41] Sample sex: M
INFO [2021-12-07 16:46:42] Mean coverages: chrX: 116.32, chrY: 131.19, chr1-22: 189.08.
INFO [2021-12-07 16:46:42] Sample sex: M
INFO [2021-12-07 16:46:43] Mean coverages: chrX: 194.41, chrY: 1.95, chr1-22: 164.88.
INFO [2021-12-07 16:46:43] Sample sex: F
INFO [2021-12-07 16:46:44] Mean coverages: chrX: 158.59, chrY: 1.69, chr1-22: 135.54.
INFO [2021-12-07 16:46:44] Sample sex: F
INFO [2021-12-07 16:46:45] Mean coverages: chrX: 204.83, chrY: 2.11, chr1-22: 167.60.
INFO [2021-12-07 16:46:45] Sample sex: F
INFO [2021-12-07 16:46:46] Mean coverages: chrX: 55.86, chrY: 20.23, chr1-22: 100.86.
INFO [2021-12-07 16:46:46] Sample sex: M
INFO [2021-12-07 16:46:47] Mean coverages: chrX: 116.98, chrY: 1.40, chr1-22: 98.75.
INFO [2021-12-07 16:46:47] Sample sex: F
INFO [2021-12-07 16:46:48] Mean coverages: chrX: 151.77, chrY: 154.54, chr1-22: 249.14.
INFO [2021-12-07 16:46:48] Sample sex: M
INFO [2021-12-07 16:46:49] Mean coverages: chrX: 97.02, chrY: 104.10, chr1-22: 162.49.
INFO [2021-12-07 16:46:49] Sample sex: M
INFO [2021-12-07 16:46:50] Mean coverages: chrX: 93.93, chrY: 112.87, chr1-22: 157.53.
INFO [2021-12-07 16:46:50] Sample sex: M
INFO [2021-12-07 16:46:51] Mean coverages: chrX: 108.69, chrY: 120.07, chr1-22: 176.78.
INFO [2021-12-07 16:46:51] Sample sex: M
INFO [2021-12-07 16:46:51] Mean coverages: chrX: 73.74, chrY: 81.98, chr1-22: 123.54.
INFO [2021-12-07 16:46:51] Sample sex: M
INFO [2021-12-07 16:46:52] Mean coverages: chrX: 48.10, chrY: 50.34, chr1-22: 81.55.
INFO [2021-12-07 16:46:52] Sample sex: M
INFO [2021-12-07 16:46:53] Mean coverages: chrX: 108.53, chrY: 115.50, chr1-22: 176.43.
INFO [2021-12-07 16:46:53] Sample sex: M
INFO [2021-12-07 16:46:54] Mean coverages: chrX: 88.38, chrY: 96.32, chr1-22: 144.52.
INFO [2021-12-07 16:46:54] Sample sex: M
INFO [2021-12-07 16:46:55] Mean coverages: chrX: 106.72, chrY: 114.68, chr1-22: 174.52.
INFO [2021-12-07 16:46:55] Sample sex: M
INFO [2021-12-07 16:46:56] Mean coverages: chrX: 122.15, chrY: 81.86, chr1-22: 198.53.
INFO [2021-12-07 16:46:56] Sample sex: M
INFO [2021-12-07 16:46:57] Mean coverages: chrX: 110.31, chrY: 123.93, chr1-22: 179.92.
INFO [2021-12-07 16:46:57] Sample sex: M
INFO [2021-12-07 16:46:58] Mean coverages: chrX: 93.02, chrY: 100.16, chr1-22: 151.37.
INFO [2021-12-07 16:46:58] Sample sex: M
INFO [2021-12-07 16:46:59] Mean coverages: chrX: 98.64, chrY: 103.46, chr1-22: 160.02.
INFO [2021-12-07 16:46:59] Sample sex: M
```

**Session Info - PureCN 2.0.1 - failure**
```
R version 4.1.1 (2021-08-10)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /path/to/bcbio/anaconda/lib/libopenblasp-r0.3.18.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
 [1] PureCN_2.0.1                VariantAnnotation_1.40.0
 [3] Rsamtools_2.10.0            Biostrings_2.62.0
 [5] XVector_0.34.0              SummarizedExperiment_1.24.0
 [7] Biobase_2.54.0              GenomicRanges_1.46.0
 [9] GenomeInfoDb_1.30.0         IRanges_2.28.0
[11] S4Vectors_0.32.0            MatrixGenerics_1.6.0
[13] matrixStats_0.61.0          BiocGenerics_0.40.0
[15] DNAcopy_1.68.0

loaded via a namespace (and not attached):
 [1] httr_1.4.2               VGAM_1.1-5               bit64_4.0.5
 [4] splines_4.1.1            assertthat_0.2.1         BiocFileCache_2.2.0
 [7] blob_1.2.2               BSgenome_1.62.0          GenomeInfoDbData_1.2.7
[10] yaml_2.2.1               progress_1.2.2           pillar_1.6.4
[13] RSQLite_2.2.8            lattice_0.20-45          glue_1.5.0
[16] digest_0.6.28            RColorBrewer_1.1-2       colorspace_2.0-2
[19] Matrix_1.3-4             XML_3.99-0.8             pkgconfig_2.0.3
[22] biomaRt_2.50.0           zlibbioc_1.40.0          purrr_0.3.4
[25] scales_1.1.1             BiocParallel_1.28.0      tibble_3.1.6
[28] KEGGREST_1.34.0          ggplot2_3.3.5            generics_0.1.1
[31] ellipsis_0.3.2           cachem_1.0.6             GenomicFeatures_1.46.1
[34] mclust_5.4.8             magrittr_2.0.1           crayon_1.4.2
[37] memoise_2.0.0            fansi_0.4.2              xml2_1.3.2
[40] data.table_1.14.2        tools_4.1.1              prettyunits_1.1.1
[43] hms_1.1.1                formatR_1.11             BiocIO_1.4.0
[46] lifecycle_1.0.1          stringr_1.4.0            Rhdf5lib_1.16.0
[49] munsell_0.5.0            DelayedArray_0.20.0      lambda.r_1.2.4
[52] AnnotationDbi_1.56.1     compiler_4.1.1           rlang_0.4.12
[55] rhdf5_2.38.0             futile.logger_1.4.3      grid_4.1.1
[58] RCurl_1.98-1.5           rhdf5filters_1.6.0       rjson_0.2.20
[61] rappdirs_0.3.3           bitops_1.0-7             gtable_0.3.0
[64] restfulr_0.0.13          DBI_1.1.1                curl_4.3.2
[67] R6_2.5.1                 gridExtra_2.3            GenomicAlignments_1.30.0
[70] dplyr_1.0.7              rtracklayer_1.54.0       fastmap_1.1.0
[73] bit_4.0.4                utf8_1.2.2               filelock_1.0.2
[76] futile.options_1.0.1     stringi_1.7.5            parallel_4.1.1
[79] Rcpp_1.0.7               vctrs_0.3.8              png_0.1-7
[82] dbplyr_2.1.1             tidyselect_1.1.1
```

**Session Info - PureCN 1.20.0 - success**

(I am not sure why it reports here PureCN_2.0.1 rather than 1.20.0, in mamba it is 
```
# Name                    Version                   Build  Channel
bioconductor-purecn       1.20.0                    r40_0    bioconda
```

```
R version 4.0.3 (2020-10-10)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /path/to/bcbio/anaconda/envs/r36/lib/libopenblasp-r0.3.10.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods
[8] base

other attached packages:
 [1] PureCN_2.0.1                VariantAnnotation_1.40.0
 [3] Rsamtools_2.10.0            Biostrings_2.62.0
 [5] XVector_0.34.0              SummarizedExperiment_1.24.0
 [7] Biobase_2.54.0              GenomicRanges_1.46.0
 [9] GenomeInfoDb_1.30.0         IRanges_2.28.0
[11] S4Vectors_0.32.0            MatrixGenerics_1.6.0
[13] matrixStats_0.61.0          BiocGenerics_0.40.0
[15] DNAcopy_1.68.0

loaded via a namespace (and not attached):
 [1] httr_1.4.2               VGAM_1.1-5               bit64_4.0.5
 [4] splines_4.0.3            assertthat_0.2.1         BiocFileCache_2.2.0
 [7] blob_1.2.2               BSgenome_1.62.0          GenomeInfoDbData_1.2.7
[10] yaml_2.2.1               progress_1.2.2           pillar_1.6.4
[13] RSQLite_2.2.8            lattice_0.20-45          glue_1.5.0
[16] digest_0.6.28            RColorBrewer_1.1-2       colorspace_2.0-2
[19] Matrix_1.3-4             XML_3.99-0.8             pkgconfig_2.0.3
[22] biomaRt_2.50.0           zlibbioc_1.40.0          purrr_0.3.4
[25] scales_1.1.1             BiocParallel_1.28.0      tibble_3.1.6
[28] KEGGREST_1.34.0          ggplot2_3.3.5            generics_0.1.1
[31] ellipsis_0.3.2           cachem_1.0.6             GenomicFeatures_1.46.1
[34] mclust_5.4.8             magrittr_2.0.1           crayon_1.4.2
[37] memoise_2.0.0            fansi_0.4.2              xml2_1.3.2
[40] data.table_1.14.2        tools_4.0.3              prettyunits_1.1.1
[43] hms_1.1.1                formatR_1.11             BiocIO_1.4.0
[46] lifecycle_1.0.1          stringr_1.4.0            Rhdf5lib_1.16.0
[49] munsell_0.5.0            DelayedArray_0.20.0      lambda.r_1.2.4
[52] AnnotationDbi_1.56.1     compiler_4.0.3           rlang_0.4.12
[55] rhdf5_2.38.0             futile.logger_1.4.3      grid_4.0.3
[58] RCurl_1.98-1.5           rhdf5filters_1.6.0       rjson_0.2.20
[61] rappdirs_0.3.3           bitops_1.0-7             gtable_0.3.0
[64] restfulr_0.0.13          DBI_1.1.1                curl_4.3.2
[67] R6_2.5.1                 gridExtra_2.3            GenomicAlignments_1.30.0
[70] dplyr_1.0.7              rtracklayer_1.54.0       fastmap_1.1.0
[73] bit_4.0.4                utf8_1.2.2               filelock_1.0.2
[76] futile.options_1.0.1     stringi_1.7.5            parallel_4.0.3
[79] Rcpp_1.0.7               vctrs_0.3.8              png_0.1-7
[82] dbplyr_2.1.1             tidyselect_1.1.1
```

Let me know if there are any debugging suggestions. 

Sergey",naumenko-sa,https://github.com/lima1/PureCN/issues/209
I_kwDOBew4us5ACB4R,NormalDB ussage question,CLOSED,2021-12-08T10:52:07Z,2021-12-17T23:49:13Z,2021-12-08T18:55:20Z,"Hi,
I have a question regarding NormalDB, when I run PureCN with  --normaldb I get the comment below, which means that is using only --normal or --normaldb, however, results are different than when I use only --normal? Should then I provide --normal in that run?
![image](https://user-images.githubusercontent.com/92018021/145194963-7c3cf3bc-9cbd-4eed-972b-76d0224266f6.png)

Results
![image](https://user-images.githubusercontent.com/92018021/145195973-b1e5b56a-2a22-4f16-840a-00cceba4ca42.png)

Thank you for your help.
Marijana",maxanes,https://github.com/lima1/PureCN/issues/210
I_kwDOBew4us5AfDaS,callAlterations() - type column,CLOSED,2021-12-16T08:00:25Z,2021-12-17T01:06:05Z,2021-12-17T01:06:05Z,"Hi Markus! I was wondering, for `callAlterations(ret)`, it generates an object with a `type` column.
In the manual, it only explains that the column is either AMPLIFICATION or DELETION.
https://bioconductor.org/packages/release/bioc/vignettes/PureCN/inst/doc/PureCN.pdf

What does NA mean for this column? I've included a screenshot as well.

[screenshot.pdf](https://github.com/lima1/PureCN/files/7725448/screenshot.pdf)
",yls2g13,https://github.com/lima1/PureCN/issues/212
I_kwDOBew4us5An7gl,allele-specific copy numbers,CLOSED,2021-12-19T22:41:35Z,2022-01-14T23:45:36Z,2022-01-14T23:45:36Z,"Hi, would there be a way to know the allele-specific copy number of other regions beside predictSomatic() results(variants.csv) and LOH regions(loh.csv). 
I mean the major and minor copy number for each segment or maybe gene-level .
Thank you for your advice in advance. 

Jen",jennyp76,https://github.com/lima1/PureCN/issues/213
I_kwDOBew4us5AxIC1,Update package on conda,CLOSED,2021-12-22T09:20:31Z,2021-12-22T20:47:46Z,2021-12-22T20:47:46Z,"It seems only version 2.0.1 is available to install through conda. Can this be updated?

I've naively tried to create a PR here: https://github.com/bioconda/bioconda-recipes/pull/32130
which did not pass the tests.",DanielAndreasen,https://github.com/lima1/PureCN/issues/214
I_kwDOBew4us5Bxy7A,"Question regarding output """,CLOSED,2022-01-14T12:31:32Z,2022-01-28T15:24:12Z,2022-01-28T15:24:11Z,"Hi Markus,
I have run some FFPE samples where I got summary results like below:
![image](https://user-images.githubusercontent.com/92018021/149495188-67f1e2ee-ad56-41f3-9de2-2988e1222811.png)
Done by WES  mean target coverages for this sample: 388X (tumor) 90X (normal). And the mean standard deviation of log-ratios: 0.61 (MAPD: 0.35) looks quite high? 
Can you help to understand why it has such output? Is it because it has a big difference between T and N? Also, I have seen  in guide that might be if exieeds the max. segments, but how do I check that?
![image](https://user-images.githubusercontent.com/92018021/149514956-e34ff941-ed9f-495b-a3b1-8784fcd26ffd.png)
![image](https://user-images.githubusercontent.com/92018021/149515193-017e4b92-034c-4c8c-903e-e66e9c0a4915.png)

Thank you



























































",maxanes,https://github.com/lima1/PureCN/issues/215
I_kwDOBew4us5CLgNF,Use PureCN in combination with HRDetect,CLOSED,2022-01-21T10:32:54Z,2022-03-05T23:43:39Z,2022-03-05T23:43:39Z,"**Describe the issue**
Missing information in output/question about possibility to create output to be used in HRDetect

I am using PureCN for all my tumor WES analyses and now would like to apply the HRDetect pipeline https://github.com/eyzhao/hrdetect-pipeline and work out HRD scores. However, HRDetect requires the input as described here

https://github.com/eyzhao/hrdetect-pipeline#example-pipeline

so, for instance for LOH the LOH type is required. Is it possible to generate the LOH-types using the categories?

ASCNA: Allele-specific copy number amplification
BCNA: Balanced copy number amplification
HET: Heterozygous (normal)
NLOH: Neutral LOH (loss of heterozygosity, but 2 copies present)
DLOH: Deletion LOH
ALOH: Amplification LOH

Any help would be appreciated!",kristianunger,https://github.com/lima1/PureCN/issues/216
I_kwDOBew4us5CMScc,missing DB info field,CLOSED,2022-01-21T14:16:08Z,2022-01-22T16:58:52Z,2022-01-22T16:58:52Z,"When calling variants using Mutect2 using the following code as part of a snakemake pipeline on paired tumor/normal mouse data

gatk --java-options '-Xmx32G' Mutect2 \
        -reference {params.reference_genome} \
        -L /home/zyto/unger/MoCaSeq/ref/GRCm38.p6/GRCm38.SureSelect_Mouse_All_Exon_V1.bed \
        -ip 75 \
        -input {input.tumor_filepath} \
        -input {input.normal_filepath} \
        --f1r2-tar-gz {output.tar} \
        --native-pair-hmm-threads 1 \
        --tmp-dir /home/zyto/unger/tmp \
        --genotype-germline-sites true \
        --genotype-pon-sites true \
        -output {output.vcf}) 2> {log}""

followed by annotation with VEP and I try to use the resulting vcf in PureCN I get the error/messages:

""WARN [2022-01-21 15:06:24] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2022-01-21 15:06:24] 0 (0.0%) variants annotated as likely germline (DB INFO flag).
FATAL [2022-01-21 15:06:24] VCF either contains no germline variants or variants are not properly 

FATAL [2022-01-21 15:06:24] annotated. 

FATAL [2022-01-21 15:06:24]  

FATAL [2022-01-21 15:06:24] This is most likely a user error due to invalid input data or 

FATAL [2022-01-21 15:06:24] parameters (PureCN 1.22.2). 

Error: VCF either contains no germline variants or variants are not properly 
annotated.""

Any ideas what could go wrong here?
",kristianunger,https://github.com/lima1/PureCN/issues/217
I_kwDOBew4us5C4o7h,Reduce memory usage of Coverage.R,CLOSED,2022-02-02T16:33:03Z,2022-02-06T23:06:22Z,2022-02-06T23:06:22Z,"Split intervals into _n_ chunks.
https://github.com/lima1/PureCN/blob/master/R/calculateBamCoverageByInterval.R
",lima1,https://github.com/lima1/PureCN/issues/218
I_kwDOBew4us5DG1Rv,making panel of normal,CLOSED,2022-02-07T11:32:10Z,2022-02-17T01:51:48Z,2022-02-10T15:04:56Z,"**Describe the issue**

Hi, 
I'm struggling understanding how to make a panel of normal for NormalDB.R. 
I have 7 tumor and 7 matched normal WES(hg38). I understood that I could use my matched normal samples for PoN.
To make a panel of normal which caller should I use? Germline caller(ex.Haplotypecaller) or mutect or mutect2 ? 
Just in  case, is it better to use matched normal rather than panel of normal made from 1000genome etc..??
Could you give a brief instruction of how I could make a panel of normal??
I would really appreciate your help

Thank you 
Jen

",jennyp76,https://github.com/lima1/PureCN/issues/220
I_kwDOBew4us5DY2T1,C.flagged interpretation,CLOSED,2022-02-10T18:06:20Z,2022-02-10T21:48:51Z,2022-02-10T21:48:51Z,"Hi Markus @lima1 !

Could you please clarify the interpretation of C.flagged column in gene-level CNA output?

The documentation says: ""C.flagged - Flagged when segment interval weights are low.   RequiresnormalDB. In case multiple segments overlap, C.flagged will be TRUE when any segment is flagged.""

What does it mean for interpretation? In the case under review, some genes are C.flagged in some samples, some genes are not, and they have similar seg.mean, number.targets, gene.mean, the only feature that differs is breakpoints (>0), meaning that there are overlapping segments.

Could these C.flagged events be reported along with non-flagged or should they be removed?

Thanks!
Sergey",naumenko-sa,https://github.com/lima1/PureCN/issues/221
I_kwDOBew4us5EQv_G,Result interpretation,CLOSED,2022-02-21T02:21:56Z,2022-02-22T17:11:31Z,2022-02-22T17:11:31Z,"Thanks to your help, I'm now trying to interpreate the results, but I have a basic question to ask regarding it.
You made a criteraia to define non-focal amplification when the copy number >= 7.
Would this mean that don't you see copy-netural LOH(2-0) or LOH(1-0) damaging???or are these two totally different concept?",jennyp76,https://github.com/lima1/PureCN/issues/222
I_kwDOBew4us5ESTmn,Question regarding CCF output interpretation,CLOSED,2022-02-21T11:06:34Z,2022-02-22T17:14:50Z,2022-02-22T17:14:50Z,"Hi,
I am looking at CCFs of mutations and today I got a bit of strange output for mutations in this sample where purity is 0.84, ploidy 3.49 estimated by PureCN. The mean coverage of the normal sample is 79, and the tumor sample is 251. I have attached screenshoots from pdf.result file as well. Does it mean that this sample is contaminated, because it also has 0,01 contamination detected by PureCN?
Thank you.

<html xmlns:v=""urn:schemas-microsoft-com:vml""
xmlns:o=""urn:schemas-microsoft-com:office:office""
xmlns:x=""urn:schemas-microsoft-com:office:excel""
xmlns=""http://www.w3.org/TR/REC-html40"">

<head>

<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content=""Microsoft Excel 15"">
<link id=Main-File rel=Main-File
href=""file:///C:/Users/au599785/AppData/Local/Temp/msohtmlclip1/01/clip.htm"">
<link rel=File-List
href=""file:///C:/Users/au599785/AppData/Local/Temp/msohtmlclip1/01/clip_filelist.xml"">
<style>
<!--table
	{mso-displayed-decimal-separator:""\,"";
	mso-displayed-thousand-separator:""\."";}
@page
	{margin:.75in .7in .75in .7in;
	mso-header-margin:.3in;
	mso-footer-margin:.3in;}
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
td
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:black;
	font-size:11.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Calibri, sans-serif;
	mso-font-charset:0;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;}
.xl65
	{font-weight:700;
	text-align:center;}
.xl66
	{background:yellow;
	mso-pattern:black none;}
-->
</style>
</head>

<body link=blue vlink=purple>



Sampleid | chr | start | end | ID | REF | ALT | SOMATIC.M0 | SOMATIC.M1 | SOMATIC.M2 | SOMATIC.M3 | SOMATIC.M4 | SOMATIC.M5 | SOMATIC.M6 | SOMATIC.M7 | GERMLINE.M0 | GERMLINE.M1 | GERMLINE.M2 | GERMLINE.M3 | GERMLINE.M4 | GERMLINE.M5 | GERMLINE.M6 | GERMLINE.M7 | GERMLINE.CONTHIGH | GERMLINE.CONTLOW | GERMLINE.HOMOZYGOUS | ML.SOMATIC | POSTERIOR.SOMATIC | ML.M | ML.C | ML.M.SEGMENT | M.SEGMENT.POSTERIOR | M.SEGMENT.FLAGGED | ML.AR | AR | AR.ADJUSTED | MAPPING.BIAS | ML.LOH | CN.SUBCLONAL | CELLFRACTION | CELLFRACTION.95.LOWER | CELLFRACTION.95.UPPER | ALLELIC.IMBALANCE | FLAGGED | log.ratio | depth | prior.somatic | prior.contamination | on.target | seg.id | pon.count | gene.symbol
-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | --
C32T09757D_ffpe | chr5 | 1,78E+08 | 1,78E+08 | chr5:177554468_C/T | C | T | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | TRUE | 0 | 1 | 3 | 0 | 1 | FALSE | 0,295775 | 1 | 1 | 0,992125 | FALSE | FALSE | 1 | 0,97 | 1 | -35,5108 | TRUE | -0,06416 | 81 | 0,000099 | 0,01 | 2 | 159 | 0 |  



</body>

</html>

![image](https://user-images.githubusercontent.com/92018021/154942718-85990512-5162-4dd6-82d7-0f690d9268ec.png)

![image](https://user-images.githubusercontent.com/92018021/154942804-d3ea9755-298d-486c-8668-6f8d6f1938be.png)",maxanes,https://github.com/lima1/PureCN/issues/223
I_kwDOBew4us5EgizU," unable to find an inherited method for function ‘seqnames’ for signature ‘""list""’_ and extensive noise in tumours versus normals",CLOSED,2022-02-24T14:51:23Z,2022-02-25T17:31:44Z,2022-02-25T17:29:41Z,"I am running PureCN with a panel of normals which contains only 3 samples. I am incurring an error which I have debugged using the commands provided from prev. issues. From what I understand this may not be a PureCN issue itself and could be a non-purecn issue, please find a screenshot of the error attached and also below:

_Error in '$ <- data.frame '('*tmp*, ""arm"", value=""p"") : 
replacement has 1 row, data has 0_ 


PureCN seems to complete producing the output files and there are no error in the logs themselves. However, I am seeing the following 'Extensive noise in tumours compared to normals' 

Previous error which relates to this: https://github.com/lima1/PureCN/issues/107

I debugged using the commands you provide and the rds file: 

_Error in (function (classes, fdef, mtable)  : 
 unable to find an inherited method for function ‘seqnames’ for signature ‘""list""’__

My command for running PureCN is: 

### Run PureCN 

while read b; do


        # download the bam file
        aws s3 cp s3:/***/${b} ${INPUT_DIR}/tumour_bams
        aws s3 cp s3://***/${b}.bai ${INPUT_DIR}/tumour_bams

        echo ""Calculating coverage""
        # calculate the coverage
        Rscript $PURECN/Coverage.R --outdir ${OUT_DIR}/coverage/tumour \
                --bam  ${INPUT_DIR}/tumour_bams/${b##*/} \
                --intervals ${OUT_REF}/baits_hg19_intervals.txt \
                --cores 4 --force

        echo ""Run PureCN""
        # get the sample name itself
        bam=${b##*/}
        samp=${bam%.final.bam}
        # run PureCN on the bam file
        mkdir ${OUT_DIR}/purecn/${samp}
        Rscript $PURECN/PureCN.R --out ${OUT_DIR}/purecn/${samp}  \
        --tumor $OUT_DIR/coverage/tumour/${samp}.final_coverage_loess.txt.gz \
        --sampleid ${samp} \
        --vcf ${INPUT_DIR}/tumour_bams/${samp}.final-filtered.vcf \
        --funsegmentation PSCBS \
        --normaldb ${OUT_DIR}/normalDB/normalDB_agilent_v7_hg19.fa.rds \
        --mappingbiasfile ${OUT_DIR}/normalDB/mapping_bias_agilent_v7_hg19.rds \
        --intervals ${OUT_REF}/baits_hg19_intervals.txt \
        --genome hg19 --force --postoptimize --seed 123
        #--model betabin \

done < ""$bam_list""


## Log File: 

 Arguments: -tumor.coverage.file /home/rbell/PureCN/output_CNA/coverage/tumour/10300136701-IB200169-P0.final_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /home/rbell/PureCN/inputs/tumour_bams/10300136701-IB200169-P0.final-filtered.vcf -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /home/rbell/PureCN/output_CNA/normalDB/mapping_bias_agilent_v7_hg19.rds -args.segmentation 0.005,NULL -sampleid 10300136701-IB200169-P0 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /home/rbell/PureCN/output_CNA/reference_files/baits_hg19_intervals.txt -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM  -log.file /home/rbell/PureCN/output_CNA/purecn/10300136701-IB200169-P0/10300136701-IB200169-P0.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2022-02-23 17:41:19] Loading coverage files...
INFO [2022-02-23 17:41:22] Mean target coverages: 62X (tumor) 60X (normal).
INFO [2022-02-23 17:41:23] Mean coverages: chrX: 39.14, chrY: 78.22, chr1-22: 58.12.
INFO [2022-02-23 17:41:23] Mean coverages: chrX: 32.00, chrY: 78.12, chr1-22: 56.14.
INFO [2022-02-23 17:41:36] Removing 830 intervals with missing log.ratio.
INFO [2022-02-23 17:41:36] Removing 8277 intervals excluded in normalDB.
INFO [2022-02-23 17:41:36] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2022-02-23 17:41:36] Removing 7665 low coverage (< 0.0015X) intervals.
INFO [2022-02-23 17:41:37] Using 211445 intervals (211445 on-target, 0 off-target).
INFO [2022-02-23 17:41:37] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2022-02-23 17:41:37] AT/GC dropout: 1.02 (tumor), 1.06 (normal).
INFO [2022-02-23 17:41:37] Loading VCF...
INFO [2022-02-23 17:41:39] Found 90032 variants in VCF file.
INFO [2022-02-23 17:41:39] Removing 439 triallelic sites.
INFO [2022-02-23 17:41:40] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-02-23 17:41:40] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2022-02-23 17:41:40] 35418 (39.5%) variants annotated as likely germline (DB INFO flag).
WARN [2022-02-23 17:41:42] Found 4 variants with missing allelic fraction starting with 6:32489856_C/A. Removing them.
INFO [2022-02-23 17:41:42] 10300136701 is tumor in VCF file.
INFO [2022-02-23 17:41:42] 328 homozygous and 82 heterozygous variants on chrX.
INFO [2022-02-23 17:41:42] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 7.56).
INFO [2022-02-23 17:41:42] Detected MuTect2 VCF.
INFO [2022-02-23 17:41:43] Removing 56930 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-02-23 17:41:44] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-02-23 17:41:44] Removing 16306 variants with AF < 0.030 or AF >= 0.970 or less than 3 supporting reads or depth < 15.
WARN [2022-02-23 17:41:44] Variant ids contain NAs at filter step BQ.
INFO [2022-02-23 17:41:45] Removing 0 low quality variants with BQ < 25.
INFO [2022-02-23 17:41:45] Total size of targeted genomic region: 40.82Mb (59.17Mb with 50bp padding).
INFO [2022-02-23 17:41:45] 7.1% of targets contain variants.
INFO [2022-02-23 17:41:45] Removing 628 variants outside intervals.
INFO [2022-02-23 17:41:45] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2022-02-23 17:41:45] Loading mapping bias file mapping_bias_agilent_v7_hg19.rds...
INFO [2022-02-23 17:41:46] Imputing mapping bias for 6934 variants...
INFO [2022-02-23 17:43:23] Excluding 3502 novel or poor quality variants from segmentation.
INFO [2022-02-23 17:43:23] Sample sex: M
INFO [2022-02-23 17:43:23] Segmenting data...
INFO [2022-02-23 17:43:23] Interval weights found, will use weighted PSCBS.
INFO [2022-02-23 17:43:24] Setting undo.SD parameter to 1.000000.
INFO [2022-02-23 17:44:09] Found 501 segments, exceeding max.segments threshold of 300.
INFO [2022-02-23 17:44:09] Setting undo.SD parameter to 1.500000.
INFO [2022-02-23 17:44:47] Setting prune.hclust.h parameter to 0.200000.
INFO [2022-02-23 17:44:49] Found 279 segments with median size of 1.39Mb.
INFO [2022-02-23 17:44:49] Using 15725 variants.
INFO [2022-02-23 17:44:49] Mean standard deviation of log-ratios: 0.42
INFO [2022-02-23 17:44:49] 2D-grid search of purity and ploidy...
INFO [2022-02-23 17:47:55] Local optima: 0.31/2.2, 0.38/2, 0.42/2.4, 0.52/3, 0.78/3.2, 0.92/3.4,
0.68/4, 0.52/2, 0.78/2
INFO [2022-02-23 17:47:55] Testing local optimum 1/9 at purity 0.31 and total ploidy 2.20...
INFO [2022-02-23 17:48:25] Recalibrating log-ratios...
INFO [2022-02-23 17:48:25] Testing local optimum 1/9 at purity 0.31 and total ploidy 2.20...
INFO [2022-02-23 17:49:00] Testing local optimum 2/9 at purity 0.38 and total ploidy 2.00...
INFO [2022-02-23 17:49:41] Recalibrating log-ratios...
INFO [2022-02-23 17:49:41] Testing local optimum 2/9 at purity 0.38 and total ploidy 2.00...
INFO [2022-02-23 17:50:16] Testing local optimum 3/9 at purity 0.42 and total ploidy 2.40...
INFO [2022-02-23 17:50:58] Recalibrating log-ratios...
INFO [2022-02-23 17:50:58] Testing local optimum 3/9 at purity 0.42 and total ploidy 2.40...
INFO [2022-02-23 17:51:42] Testing local optimum 4/9 at purity 0.52 and total ploidy 3.00...
INFO [2022-02-23 17:52:18] Testing local optimum 5/9 at purity 0.78 and total ploidy 3.20...
INFO [2022-02-23 17:52:39] Testing local optimum 6/9 at purity 0.92 and total ploidy 3.40...
INFO [2022-02-23 17:52:59] Testing local optimum 7/9 at purity 0.68 and total ploidy 4.00...
INFO [2022-02-23 17:53:31] Testing local optimum 8/9 at purity 0.52 and total ploidy 2.00...
INFO [2022-02-23 17:53:57] Testing local optimum 9/9 at purity 0.78 and total ploidy 2.00...
INFO [2022-02-23 17:54:16] Skipping 3 solutions that converged to the same optima.
INFO [2022-02-23 17:54:16] Fitting variants with beta model for local optimum 1/9...
INFO [2022-02-23 17:54:17] Fitting variants for purity 0.36, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 17:55:32] Fitting variants for purity 0.32, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 17:56:45] Fitting variants for purity 0.33, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 17:57:54] Fitting variants for purity 0.34, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 17:59:06] Fitting variants for purity 0.35, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 18:00:18] Fitting variants for purity 0.37, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 18:01:31] Fitting variants for purity 0.38, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 18:02:51] Fitting variants for purity 0.39, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 18:04:06] Fitting variants for purity 0.40, tumor ploidy 4.16 and contamination 0.01.
INFO [2022-02-23 18:05:21] Optimized purity: 0.37
INFO [2022-02-23 18:05:21] Fitting variants with beta model for local optimum 4/9...
INFO [2022-02-23 18:05:22] Fitting variants for purity 0.57, tumor ploidy 4.61 and contamination 0.01.
INFO [2022-02-23 18:06:37] Rare karyotype solution. Skipping post-optimization.
INFO [2022-02-23 18:06:37] Optimized purity: 0.57
INFO [2022-02-23 18:06:37] Fitting variants with beta model for local optimum 5/9...
INFO [2022-02-23 18:06:38] Fitting variants for purity 0.80, tumor ploidy 3.68 and contamination 0.01.
INFO [2022-02-23 18:07:53] Poor goodness-of-fit (0.728). Skipping post-optimization.
INFO [2022-02-23 18:07:53] Optimized purity: 0.80
INFO [2022-02-23 18:07:53] Fitting variants with beta model for local optimum 7/9...
INFO [2022-02-23 18:07:54] Fitting variants for purity 0.78, tumor ploidy 5.39 and contamination 0.01.
INFO [2022-02-23 18:09:08] Rare karyotype solution. Skipping post-optimization.
INFO [2022-02-23 18:09:08] Optimized purity: 0.78
INFO [2022-02-23 18:09:08] Fitting variants with beta model for local optimum 8/9...
INFO [2022-02-23 18:09:09] Fitting variants for purity 0.48, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:10:23] Fitting variants for purity 0.44, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:11:37] Fitting variants for purity 0.45, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:12:51] Fitting variants for purity 0.46, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:14:06] Fitting variants for purity 0.47, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:15:20] Fitting variants for purity 0.49, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:16:34] Fitting variants for purity 0.50, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:17:47] Fitting variants for purity 0.51, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:19:04] Fitting variants for purity 0.52, tumor ploidy 3.28 and contamination 0.01.
INFO [2022-02-23 18:20:18] Optimized purity: 0.44
INFO [2022-02-23 18:20:18] Fitting variants with beta model for local optimum 9/9...
INFO [2022-02-23 18:20:20] Fitting variants for purity 0.59, tumor ploidy 2.69 and contamination 0.01.
INFO [2022-02-23 18:21:32] Poor goodness-of-fit (0.712). Skipping post-optimization.
INFO [2022-02-23 18:21:32] Optimized purity: 0.59
INFO [2022-02-23 18:21:33] Done.
INFO [2022-02-23 18:21:33] ------------------------------------------------------------
INFO [2022-02-23 18:21:37] Generating output files...
INFO [2022-02-23 18:21:53] Tumor/normal noise ratio: 15.846
WARN [2022-02-23 18:21:53] Extensive noise in tumor compared to normals.

## Panel of normals

I prepared the panel of normals using bcftools as I had a lot of problems retaining the 'AD' tag. I used a docker image of PureCN to create a genomicsDB which did not retain the flag and I also used the createsomaticpanelofnormals command which also did not retain the tag.

This is the bcftools command, I suspect this may be causing my issues: 

for vp in $v_pon
do

bcftools filter \
    --include 'FORMAT/AD[0:1]>1' \
    ${vp} | \
    sed -e 's/ID=RU,Number=1/ID=RU,Number=A/' -e 's/ID=AD,Number=R/ID=AD,Number=./' |
    bcftools norm \
    --fasta-ref ${OUT_REF}/hg19.fa \
    --check-ref s \
    --multiallelics -both \
    --output-type z \
    --output ${bcftools_dir}/${vp##*/}
done

bcftools merge \
    --merge none \
    --output-type z \
    --output ${bcftools_dir}combined_pon.vcf.gz \
    ${bcftools_dir}/*vcf.gz

tabix -p vcf  ${bcftools_dir}combined_pon.vcf.gz


I would like to:

a) Determine whether the original issue, not in the logs but displayed on stdout is a PureCN issue 
b) Determine whether my panel of normals is suitable. I have the mutect2 vcfs for these, do you have any recommendations on how to combined these whilst retaining the 'AD' tag

Thanks for your help ",rbell-img,https://github.com/lima1/PureCN/issues/224
I_kwDOBew4us5EjAVU,PON with Mutect2 in GATK4,CLOSED,2022-02-25T04:23:17Z,2022-03-01T03:46:01Z,2022-03-01T03:46:01Z,"**Describe the issue**
When attempting to build a normal DB with NormalDB.R from a GenomicsDB, I get the error using GATK v4.2.5.0 and PureCN v2.0.1:

```
Error in value_vars(value.var, names(data)) : 
  value.var values [AD] are not found in 'data'.
Calls: calculateMappingBiasGatk4 ... .parseADGenomicsDb -> dcast -> dcast.data.table -> value_vars
Execution halted
```

**To Reproduce**

I ran Mutect2 on all my normals (50 in total):

```
gatk Mutect2 -R hg19.fa -I normal1.bam -max-mnp-distance 0 -L intervals.bed --interval-padding 75 -O normal1.vcf.gz
```

then imported them into a GenomicsDB:

```
gatk GenomicsDBImport -R hg19.fa -L intervals.list --genomicsdb-workspace-path pon_db -V normal1.vcf.gz ...
```

Creating a PON for Mutect2 works fine:

```
gatk CreateSomaticPanelOfNormals -R hg19.fa -V gendb://pon_db -O mutect_pon.vcf.gz
```

I can use this PON to call tumour only samples; however, it has no genotype information so isn't accepted by NormalDB.R. I tried providing the GenomicsDB directly with the following command:

```
Rscript /usr/local/lib/R/site-library/PureCN/extdata/NormalDB.R \
    --out-dir purecn_pon \
    --coverage-files normal_coverages.list \
    --normal-panel pon_db \
    --genome hg19 \
    --assay idtxpc2
```
but get the error above.

**Expected behavior**

NormalDB.R to complete successfully and a DB to be created. Is there something I'm doing wrong?

**Log file**

```
INFO [2022-02-25 13:31:41] Loading PureCN 2.0.1...
INFO [2022-02-25 13:31:41] Creating mapping bias database.
Got GenomicsDB
INFO [2022-02-25 13:31:42] Found 86 contigs and 5 columns.
INFO [2022-02-25 13:31:42] Processing 1$2$249250621 (offset 0, length 249250621)...
INFO [2022-02-25 13:31:48] Processing 2$2$243199373 (offset 249250621, length 243199373)...
INFO [2022-02-25 13:31:52] Processing 3$2$198022430 (offset 492449994, length 198022430)...
INFO [2022-02-25 13:31:54] Processing 4$2$191154276 (offset 690472424, length 191154276)...
INFO [2022-02-25 13:31:56] Processing 5$2$180915260 (offset 881626700, length 180915260)...
INFO [2022-02-25 13:31:58] Processing 6$2$171115067 (offset 1062541960, length 171115067)...
INFO [2022-02-25 13:32:01] Processing 7$2$159138663 (offset 1233657027, length 159138663)...
INFO [2022-02-25 13:32:03] Processing 8$2$146364022 (offset 1392795690, length 146364022)...
INFO [2022-02-25 13:32:05] Processing 9$2$141213431 (offset 1539159712, length 141213431)...
INFO [2022-02-25 13:32:06] Processing 10$2$135534747 (offset 1680373143, length 135534747)...
INFO [2022-02-25 13:32:09] Processing 11$2$135006516 (offset 1815907890, length 135006516)...
INFO [2022-02-25 13:32:11] Processing 12$2$133851895 (offset 1950914406, length 133851895)...
INFO [2022-02-25 13:32:13] Processing 13$2$115169878 (offset 2084766301, length 115169878)...
INFO [2022-02-25 13:32:14] Processing 14$2$107349540 (offset 2199936179, length 107349540)...
INFO [2022-02-25 13:32:15] Processing 15$2$102531392 (offset 2307285719, length 102531392)...
INFO [2022-02-25 13:32:17] Processing 16$2$90354753 (offset 2409817111, length 90354753)...
INFO [2022-02-25 13:32:18] Processing 17$2$81195210 (offset 2500171864, length 81195210)...
INFO [2022-02-25 13:32:20] Processing 18$2$78077248 (offset 2581367074, length 78077248)...
INFO [2022-02-25 13:32:21] Processing 19$2$59128983 (offset 2659444322, length 59128983)...
INFO [2022-02-25 13:32:23] Processing 20$2$63025520 (offset 2718573305, length 63025520)...
INFO [2022-02-25 13:32:24] Processing 21$2$48129895 (offset 2781598825, length 48129895)...
INFO [2022-02-25 13:32:24] Processing 22$2$51304566 (offset 2829728720, length 51304566)...
INFO [2022-02-25 13:32:25] Processing X$2$155270560 (offset 2881033286, length 155270560)...
INFO [2022-02-25 13:32:26] Processing Y$2$59373566 (offset 3036303846, length 59373566)...
INFO [2022-02-25 13:32:26] Processing MT$2$16569 (offset 3095677412, length 16569)...
INFO [2022-02-25 13:32:27] Processing GL000191.1$2$106433 (offset 3097050401, length 106433)...
INFO [2022-02-25 13:32:27] Processing GL000192.1$2$547496 (offset 3101257243, length 547496)...
INFO [2022-02-25 13:32:27] Processing GL000193.1$2$189789 (offset 3100664812, length 189789)...
INFO [2022-02-25 13:32:27] Processing GL000194.1$2$191469 (offset 3100854601, length 191469)...
INFO [2022-02-25 13:32:27] Processing GL000195.1$2$182896 (offset 3099921162, length 182896)...
INFO [2022-02-25 13:32:27] Processing GL000196.1$2$38914 (offset 3096117080, length 38914)...
Error in value_vars(value.var, names(data)) : 
  value.var values [AD] are not found in 'data'.
Calls: calculateMappingBiasGatk4 ... .parseADGenomicsDb -> dcast -> dcast.data.table -> value_vars
Execution halted
```

**Session Info**

```
 version 4.1.2 (2021-11-01)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.3 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] PureCN_2.0.1                VariantAnnotation_1.40.0   
 [3] Rsamtools_2.10.0            Biostrings_2.62.0          
 [5] XVector_0.34.0              SummarizedExperiment_1.24.0
 [7] Biobase_2.54.0              GenomicRanges_1.46.1       
 [9] GenomeInfoDb_1.30.0         IRanges_2.28.0             
[11] S4Vectors_0.32.3            MatrixGenerics_1.6.0       
[13] matrixStats_0.61.0          BiocGenerics_0.40.0        
[15] DNAcopy_1.68.0             

loaded via a namespace (and not attached):
 [1] httr_1.4.2               VGAM_1.1-5               bit64_4.0.5             
 [4] splines_4.1.2            assertthat_0.2.1         BiocFileCache_2.2.0     
 [7] blob_1.2.2               BSgenome_1.62.0          GenomeInfoDbData_1.2.7  
[10] yaml_2.2.1               progress_1.2.2           pillar_1.6.4            
[13] RSQLite_2.2.9            lattice_0.20-45          glue_1.5.1              
[16] digest_0.6.29            RColorBrewer_1.1-2       colorspace_2.0-2        
[19] Matrix_1.3-4             XML_3.99-0.8             pkgconfig_2.0.3         
[22] biomaRt_2.50.1           zlibbioc_1.40.0          purrr_0.3.4             
[25] scales_1.1.1             BiocParallel_1.28.3      tibble_3.1.6            
[28] KEGGREST_1.34.0          ggplot2_3.3.5            generics_0.1.1          
[31] ellipsis_0.3.2           cachem_1.0.6             GenomicFeatures_1.46.1  
[34] mclust_5.4.8             magrittr_2.0.1           crayon_1.4.2            
[37] memoise_2.0.0            fansi_0.5.0              xml2_1.3.2              
[40] data.table_1.14.2        tools_4.1.2              prettyunits_1.1.1       
[43] hms_1.1.1                formatR_1.11             BiocIO_1.4.0            
[46] lifecycle_1.0.1          stringr_1.4.0            Rhdf5lib_1.16.0         
[49] munsell_0.5.0            DelayedArray_0.20.0      lambda.r_1.2.4          
[52] AnnotationDbi_1.56.2     compiler_4.1.2           rlang_0.4.12            
[55] rhdf5_2.38.0             futile.logger_1.4.3      grid_4.1.2              
[58] RCurl_1.98-1.5           rhdf5filters_1.6.0       rjson_0.2.20            
[61] rappdirs_0.3.3           bitops_1.0-7             gtable_0.3.0            
[64] restfulr_0.0.13          DBI_1.1.1                curl_4.3.2              
[67] R6_2.5.1                 gridExtra_2.3            GenomicAlignments_1.30.0
[70] dplyr_1.0.7              rtracklayer_1.54.0       fastmap_1.1.0           
[73] bit_4.0.4                utf8_1.2.2               filelock_1.0.2          
[76] futile.options_1.0.1     stringi_1.7.6            parallel_4.1.2          
[79] Rcpp_1.0.7               vctrs_0.3.8              png_0.1-7               
[82] dbplyr_2.1.1             tidyselect_1.1.1    
```
",jje42,https://github.com/lima1/PureCN/issues/225
I_kwDOBew4us5EzNX3,Out of memory issue with GenomicsDB import,CLOSED,2022-02-28T16:09:24Z,2022-03-05T21:46:12Z,2022-03-05T21:46:12Z,"> There might have been an easy fix. Can you try?
> 
> BiocManager::install(""lima1/PureCN"")

Hey.. FYI I have tried this and I am no longer seeing the 'AD' tag error. However I am running into memory issues after running the command for a while, is it possible to process in batches? 

```
[TileDB::FileSystem] Error: (get_dirs) Cannot open directory path=/home/rbell/PureCN/output_CNA/combined_pon/2$32743864$32744033 errno=24(Too many open files)
[TileDB::FileSystem] Error: (file_size) Cannot get file size; File opening error path=/home/rbell/PureCN/output_CNA/combined_pon/2$32743864$32744033/__array_schema.tdb errno=24(Too many open files)
[TileDB::StorageManager] Error: Storage Manager memory allocation error.
```


Additionally, would it be possible to use the output of createsomaticpanelofnormals without the AD tag? 

Thanks!

_Originally posted by @rbell-img in https://github.com/lima1/PureCN/issues/225#issuecomment-1054168100_",lima1,https://github.com/lima1/PureCN/issues/226
I_kwDOBew4us5FFuO9,Frequent noisy segmentation and low purity in output,CLOSED,2022-03-04T00:59:09Z,2022-03-07T21:24:42Z,2022-03-07T21:01:48Z,"I've run 155 sample through PureCN, but in the output 134 (86%) are ""flagged"". The majority of samples are flagged as noisy segmentation, low purity or both. I'd like to ask if there is anything obviously wrong with how I'm running the program or if these flags are OK to ignore. While it's possible to have a cohort of low purity samples, based on other evidence we think that 45% of these samples being < 30% is unlikely.

The 155 samples are a mix of solid tumour types, but were all fresh tissue samples (i.e., no FFPE). The normal DB was created with 100 blood samples. All samples (both test and control) have been processed with the same protocol by the same people in one lab sequenced on the same sequencer. I've used Mutect2 as the caller throughout with a PON of >400 (process matched) normals. My samples are all T/N pairs so for the somatic variant calling, I've using Mutect2 in tumour/normal pair mode. The variants have been filtered as per the GATK guidelines. For PureCN, I have only used the tumour sample as suggested in the best practices guideline.

I'm using v2.1.9.

The following is typical from a sample that is flagged as noisy segmentation (although some appear to much more noisy):

[sample-plots.pdf](https://github.com/lima1/PureCN/files/8182024/sample-2.pdf)

[sample.log](https://github.com/lima1/PureCN/files/8182011/PA982694-20201001-0005-20201002-0006-HTW2WDRXX-TruD-IdtXPC2.log)

I noticed that many samples warned of a low number of off-target intervals and the mean sd of off-target is typically much larger than on-target (typically ~0.3 / ~0.15 respectively), so I rebuilt my intervals/normalDB without the --offtarget flag. This hasn't really improved the data. The output for the same sample without --offtarget is

[sample-plots.pdf](https://github.com/lima1/PureCN/files/8182075/sample-2.pdf)

[sample.log](https://github.com/lima1/PureCN/files/8182070/PA982694-20201001-0005-20201002-0006-HTW2WDRXX-TruD-IdtXPC2.log)

My PureCN command is:

```
Rscript /usr/local/lib/R/site-library/PureCN/extdata/PureCN.R \                                                               
    --out output \                                                                                                                
    --tumor sample_coverage_loess.txt.gz \                                                                                                              
    --sampleid sample \                                                                                                           
    --vcf sample.filtered.vcf.gz \                                                                                                                                                                                                                      
    --fun-segmentation PSCBS \                                                                                                
    --normaldb normalDB_idtxpc2_hg19.rds \                                                                                                           
    --mapping-bias-file mapping_bias_idtxpc2_hg19.rds \                                                                                                  
    --intervals baits_hg19_intervals.txt \                                                                                                          
    --snp-blacklist hg19_simpleRepeats.bed \                                                                                                      
    --genome hg19 \                                                                                                           
    --model betabin \                                                                                                         
    --force \                                                                                                                 
    --post-optimize \                                                                                                         
    --seed 123 
```",jje42,https://github.com/lima1/PureCN/issues/227
I_kwDOBew4us5FRX6a,About local optima,CLOSED,2022-03-08T03:42:57Z,2022-03-11T22:16:49Z,2022-03-11T22:16:49Z,"Hi,
    I have a question about find local optima. Before SA, we use grid search and define a total-ploidy to search  max  likelihood, local optima is find in such likelihood matrix. But, actually, the total-ploidy is not equal p * tumor_ploidy + 2 * ( 1 - purity), why the true local optima is in above solution. 

   Thanks,
   XiangY.

   


",X1angyang,https://github.com/lima1/PureCN/issues/228
I_kwDOBew4us5FW8BR,WGS data,CLOSED,2022-03-09T08:35:50Z,2022-03-11T22:16:36Z,2022-03-11T22:16:36Z,"Hi,
I would like to try running PureCN on WGS data. 
Can you please tell me if it is possible to run WGS data and what should be used as an interval file?

Thank you.",maxanes,https://github.com/lima1/PureCN/issues/229
I_kwDOBew4us5GYI8P,Poor GOF,CLOSED,2022-03-25T12:23:54Z,2022-03-25T17:16:52Z,2022-03-25T17:16:52Z,"**Describe the issue**
For all of my samples I am seeing poor GOF. The normals are process matched, I am now using a panel of 4 PBMCs. 

""Sampleid"",""Purity"",""Ploidy"",""Sex"",""Contamination"",""Flagged"",""Failed"",""Curated"",""Comment""
""10300136984-IPSA-19036-NCGM-214-Imagen-Therapeutics-12D5-3_S211"",0.83,3.22178336190441,""Coverage: F VCF: M"",0,TRUE,FALSE,FALSE,""POOR GOF (53.4%);HIGH AT- OR GC-DROPOUT""

I also get excessive noise in tumour versus normals. 

**To Reproduce**

Rscript $PURECN/NormalDB.R \
--outdir normalDB \
--coveragefiles ${OUT_DIR}/coverage/normals/normal_coverages.list \
--normal_panel /home/rbell/PureCN/pon_db \
--genome  ${OUT_REF}/hg19.fa \
--assay agilent_v7


while read b; do

	# download the bam file
	aws s3 cp s3://imagen-therapeutics-ngs-datastore/${b} ${INPUT_DIR}/tumour_bams 
        aws s3 cp s3://imagen-therapeutics-ngs-datastore/${b}.bai ${INPUT_DIR}/tumour_bams
	
	echo ""Calculating coverage"" 
	# calculate the coverage 
	Rscript $PURECN/Coverage.R --outdir ${OUT_DIR}/coverage/tumour \
		--bam  ${INPUT_DIR}/tumour_bams/${b##*/} \
		--intervals ${OUT_REF}/baits_hg19_intervals.txt \
		--cores 4 --force

	echo ""Run PureCN""
	# get the sample name itself 
	bam=${b##*/}
	samp=${bam%.final.bam}
	# run PureCN on the bam file 
	mkdir ${OUT_DIR}/purecn/${samp}
        Rscript $PURECN/PureCN.R --out ${OUT_DIR}/purecn/${samp}  \
        --tumor $OUT_DIR/coverage/tumour/${samp}.final_coverage_loess.txt.gz \
        --sampleid ${samp} \
        --vcf ${INPUT_DIR}/tumour_bams/${samp}.final-filtered.vcf \
        --funsegmentation PSCBS \
        --normaldb ${OUT_DIR}/normalDB/normalDB_agilent_v7_hg19.fa.rds \
        --mappingbiasfile ${OUT_DIR}/normalDB/mapping_bias_agilent_v7_hg19.rds \
        --intervals ${OUT_REF}/baits_hg19_intervals.txt \
        --genome hg19 --force --postoptimize --seed 123
       

done < ""$bam_list""

**Expected behavior**
I did expect high purity for this sample which is confirmed by the output however this is inconsistent across samples 

**Log file**

INFO [2022-03-24 19:08:33] Arguments: -tumor.coverage.file /home/rbell/PureCN/output_CNA/coverage/tumour/10300136984-IPSA-19036-NCGM-214-Imagen-Therapeutics-12D5-3_S211.final_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /home/rbell/PureCN/inputs/tumour_bams/10300136984-IPSA-19036-NCGM-214-Imagen-Therapeutics-12D5-3_S211.final-filtered.vcf -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /home/rbell/PureCN/output_CNA/normalDB/mapping_bias_agilent_v7_hg19.fa.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 10300136984-IPSA-19036-NCGM-214-Imagen-Therapeutics-12D5-3_S211 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /home/rbell/PureCN/output_CNA/reference_files/baits_hg19_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -log.file /home/rbell/PureCN/output_CNA/purecn/10300136984-IPSA-19036-NCGM-214-Imagen-Therapeutics-12D5-3_S211/10300136984-IPSA-19036-NCGM-214-Imagen-Therapeutics-12D5-3_S211.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-03-24 19:08:33] Using BiocParallel for parallel optimization.
INFO [2022-03-24 19:08:33] Loading coverage files...
INFO [2022-03-24 19:08:37] Mean target coverages: 113X (tumor) 110X (normal).
INFO [2022-03-24 19:08:38] Mean coverages: chrX: 59.45, chrY: 1.04, chr1-22: 108.06.
INFO [2022-03-24 19:08:38] Mean coverages: chrX: 109.50, chrY: 1.05, chr1-22: 105.09.
INFO [2022-03-24 19:08:51] Removing 986 intervals with missing log.ratio.
INFO [2022-03-24 19:08:51] Removing 6272 intervals excluded in normalDB.
INFO [2022-03-24 19:08:51] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2022-03-24 19:08:51] Removing 4816 low count (< 100 total reads) intervals.
INFO [2022-03-24 19:08:51] Removing 1 low coverage (< 0.0015X) intervals.
INFO [2022-03-24 19:08:52] Using 215004 intervals (215004 on-target, 0 off-target).
INFO [2022-03-24 19:08:52] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2022-03-24 19:08:52] AT/GC dropout: 1.04 (tumor), 1.02 (normal), 1.06 (coverage log-ratio).
WARN [2022-03-24 19:08:52] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2022-03-24 19:08:52] Loading VCF...
INFO [2022-03-24 19:08:58] Found 245044 variants in VCF file.
INFO [2022-03-24 19:08:59] Removing 1138 triallelic sites.
INFO [2022-03-24 19:09:00] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-03-24 19:09:00] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2022-03-24 19:09:00] 57802 (23.7%) variants annotated as likely germline (DB INFO flag).
INFO [2022-03-24 19:09:05] 10300136984 is tumor in VCF file.
INFO [2022-03-24 19:09:06] 454 homozygous and 70 heterozygous variants on chrX.
INFO [2022-03-24 19:09:06] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 9.84).
WARN [2022-03-24 19:09:06] Sex mismatch of coverage and VCF. Could be because of noisy data, contamination, loss of chrY or a mis-alignment of coverage and VCF.
INFO [2022-03-24 19:09:06] Detected MuTect2 VCF.
INFO [2022-03-24 19:09:08] Removing 179773 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-03-24 19:09:11] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-03-24 19:09:12] Removing 35560 variants with AF < 0.030 or AF >= 0.970 or less than 4 supporting reads or depth < 15.
WARN [2022-03-24 19:09:12] Variant ids contain NAs at filter step BQ.
INFO [2022-03-24 19:09:12] Removing 0 low quality variants with BQ < 25.
INFO [2022-03-24 19:09:12] Total size of targeted genomic region: 44.47Mb (62.48Mb with 50bp padding).
INFO [2022-03-24 19:09:12] 11.5% of targets contain variants.
INFO [2022-03-24 19:09:12] Removing 2012 variants outside intervals.
INFO [2022-03-24 19:09:12] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2022-03-24 19:09:13] Loading mapping bias file mapping_bias_agilent_v7_hg19.fa.rds...
INFO [2022-03-24 19:09:13] Found 1200127 variants in mapping bias file.
INFO [2022-03-24 19:09:14] Imputing mapping bias for 13362 variants...
INFO [2022-03-24 19:10:47] Excluding 12038 novel or poor quality variants from segmentation.
INFO [2022-03-24 19:10:47] Sample sex: F
INFO [2022-03-24 19:10:47] Segmenting data...
INFO [2022-03-24 19:10:47] Interval weights found, will use weighted PSCBS.
INFO [2022-03-24 19:10:47] MAPD of 10482 allelic fractions: 0.09 (0.10 adjusted).
INFO [2022-03-24 19:10:48] Setting undo.SD parameter to 1.000000.
INFO [2022-03-24 19:11:26] Setting prune.hclust.h parameter to 0.200000.
INFO [2022-03-24 19:11:28] Found 260 segments with median size of 1.44Mb.
INFO [2022-03-24 19:11:28] Removing 1 variants outside segments.
INFO [2022-03-24 19:11:28] Using 26560 variants.
INFO [2022-03-24 19:11:29] Mean standard deviation of log-ratios: 0.29 (MAPD: 0.24)
INFO [2022-03-24 19:11:29] 2D-grid search of purity and ploidy...
INFO [2022-03-24 19:11:50] Local optima: 0.45/2.8, 0.29/2, 0.31/2.4, 0.58/3.6, 0.65/2.8, 0.48/2.1,
0.88/4, 0.58/2, 0.85/2.8, 0.88/4.8, 0.52/1.4, 0.78/2
INFO [2022-03-24 19:11:50] Testing local optimum 1/12 at purity 0.45 and total ploidy 2.80...
INFO [2022-03-24 19:11:50] Testing local optimum 2/12 at purity 0.29 and total ploidy 2.00...
INFO [2022-03-24 19:11:50] Testing local optimum 3/12 at purity 0.31 and total ploidy 2.40...
INFO [2022-03-24 19:11:50] Testing local optimum 4/12 at purity 0.58 and total ploidy 3.60...
INFO [2022-03-24 19:11:50] Testing local optimum 5/12 at purity 0.65 and total ploidy 2.80...
INFO [2022-03-24 19:11:50] Testing local optimum 6/12 at purity 0.48 and total ploidy 2.10...
INFO [2022-03-24 19:11:50] Testing local optimum 7/12 at purity 0.88 and total ploidy 4.00...
INFO [2022-03-24 19:11:50] Testing local optimum 8/12 at purity 0.58 and total ploidy 2.00...
INFO [2022-03-24 19:11:50] Testing local optimum 9/12 at purity 0.85 and total ploidy 2.80...
INFO [2022-03-24 19:11:50] Testing local optimum 10/12 at purity 0.88 and total ploidy 4.80...
INFO [2022-03-24 19:11:50] Testing local optimum 11/12 at purity 0.52 and total ploidy 1.40...
INFO [2022-03-24 19:11:50] Testing local optimum 12/12 at purity 0.78 and total ploidy 2.00...
INFO [2022-03-24 19:11:56] Recalibrating log-ratios...
INFO [2022-03-24 19:11:56] Testing local optimum 11/12 at purity 0.52 and total ploidy 1.40...
INFO [2022-03-24 19:12:01] Recalibrating log-ratios...
INFO [2022-03-24 19:12:01] Testing local optimum 11/12 at purity 0.52 and total ploidy 1.40...
INFO [2022-03-24 19:12:01] Recalibrating log-ratios...
INFO [2022-03-24 19:12:01] Testing local optimum 3/12 at purity 0.31 and total ploidy 2.40...
INFO [2022-03-24 19:12:06] Recalibrating log-ratios...
INFO [2022-03-24 19:12:06] Testing local optimum 11/12 at purity 0.52 and total ploidy 1.40...
INFO [2022-03-24 19:12:11] Recalibrating log-ratios...
INFO [2022-03-24 19:12:11] Testing local optimum 9/12 at purity 0.85 and total ploidy 2.80...
INFO [2022-03-24 19:12:17] Recalibrating log-ratios...
INFO [2022-03-24 19:12:17] Testing local optimum 5/12 at purity 0.65 and total ploidy 2.80...
INFO [2022-03-24 19:12:20] Recalibrating log-ratios...
INFO [2022-03-24 19:12:20] Testing local optimum 8/12 at purity 0.58 and total ploidy 2.00...
INFO [2022-03-24 19:12:22] Recalibrating log-ratios...
INFO [2022-03-24 19:12:22] Testing local optimum 1/12 at purity 0.45 and total ploidy 2.80...
INFO [2022-03-24 19:12:25] Recalibrating log-ratios...
INFO [2022-03-24 19:12:25] Testing local optimum 7/12 at purity 0.88 and total ploidy 4.00...
INFO [2022-03-24 19:12:33] Recalibrating log-ratios...
INFO [2022-03-24 19:12:33] Testing local optimum 12/12 at purity 0.78 and total ploidy 2.00...
INFO [2022-03-24 19:12:33] Recalibrating log-ratios...
INFO [2022-03-24 19:12:33] Testing local optimum 4/12 at purity 0.58 and total ploidy 3.60...
INFO [2022-03-24 19:12:33] Recalibrating log-ratios...
INFO [2022-03-24 19:12:33] Testing local optimum 6/12 at purity 0.48 and total ploidy 2.10...
INFO [2022-03-24 19:12:47] Recalibrating log-ratios...
INFO [2022-03-24 19:12:47] Testing local optimum 9/12 at purity 0.85 and total ploidy 2.80...
INFO [2022-03-24 19:12:56] Recalibrating log-ratios...
INFO [2022-03-24 19:12:56] Testing local optimum 1/12 at purity 0.45 and total ploidy 2.80...
INFO [2022-03-24 19:13:00] Recalibrating log-ratios...
INFO [2022-03-24 19:13:00] Testing local optimum 5/12 at purity 0.65 and total ploidy 2.80...
INFO [2022-03-24 19:13:03] Recalibrating log-ratios...
INFO [2022-03-24 19:13:03] Testing local optimum 2/12 at purity 0.29 and total ploidy 2.00...
INFO [2022-03-24 19:13:05] Recalibrating log-ratios...
INFO [2022-03-24 19:13:05] Testing local optimum 7/12 at purity 0.88 and total ploidy 4.00...
INFO [2022-03-24 19:13:11] Recalibrating log-ratios...
INFO [2022-03-24 19:13:11] Testing local optimum 4/12 at purity 0.58 and total ploidy 3.60...
INFO [2022-03-24 19:13:23] Recalibrating log-ratios...
INFO [2022-03-24 19:13:23] Testing local optimum 4/12 at purity 0.58 and total ploidy 3.60...
INFO [2022-03-24 19:13:37] Recalibrating log-ratios...
INFO [2022-03-24 19:13:37] Testing local optimum 1/12 at purity 0.45 and total ploidy 2.80...
INFO [2022-03-24 19:13:42] Recalibrating log-ratios...
INFO [2022-03-24 19:13:42] Testing local optimum 2/12 at purity 0.29 and total ploidy 2.00...
INFO [2022-03-24 19:13:47] Recalibrating log-ratios...
INFO [2022-03-24 19:13:47] Testing local optimum 7/12 at purity 0.88 and total ploidy 4.00...
INFO [2022-03-24 19:14:28] Skipping 1 solutions that converged to the same optima.
INFO [2022-03-24 19:14:28] Skipping 1 solutions exceeding max.non.clonal (0.20): 0.42/2.16 (purity/tumor ploidy)
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 1/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 2/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 3/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 5/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 6/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 7/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 8/12...
INFO [2022-03-24 19:14:28] Fitting variants with beta model for local optimum 9/12...
INFO [2022-03-24 19:14:29] Fitting variants with beta model for local optimum 10/12...
INFO [2022-03-24 19:14:29] Fitting variants with beta model for local optimum 12/12...
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.51, tumor ploidy 5.04 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.37, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.42, tumor ploidy 4.59 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.64, tumor ploidy 4.56 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.61, tumor ploidy 3.56 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.81, tumor ploidy 5.32 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.47, tumor ploidy 2.74 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.83, tumor ploidy 3.22 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.95, tumor ploidy 5.95 and contamination 0.01.
INFO [2022-03-24 19:14:30] Fitting variants for purity 0.60, tumor ploidy 2.24 and contamination 0.01.
INFO [2022-03-24 19:16:44] Rare karyotype solution. Skipping post-optimization.
INFO [2022-03-24 19:16:44] Optimized purity: 0.51
INFO [2022-03-24 19:16:44] Rare karyotype solution. Skipping post-optimization.
INFO [2022-03-24 19:16:44] Optimized purity: 0.81
INFO [2022-03-24 19:16:45] Poor goodness-of-fit (0.706). Skipping post-optimization.
INFO [2022-03-24 19:16:45] Optimized purity: 0.61
INFO [2022-03-24 19:16:45] Poor goodness-of-fit (0.680). Skipping post-optimization.
INFO [2022-03-24 19:16:45] Optimized purity: 0.47
INFO [2022-03-24 19:16:45] Poor goodness-of-fit (0.385). Skipping post-optimization.
INFO [2022-03-24 19:16:45] Optimized purity: 0.60
INFO [2022-03-24 19:16:45] Rare karyotype solution. Skipping post-optimization.
INFO [2022-03-24 19:16:45] Optimized purity: 0.42
INFO [2022-03-24 19:16:46] Rare karyotype solution. Skipping post-optimization.
INFO [2022-03-24 19:16:46] Optimized purity: 0.64
INFO [2022-03-24 19:16:46] Poor goodness-of-fit (0.534). Skipping post-optimization.
INFO [2022-03-24 19:16:46] Optimized purity: 0.83
INFO [2022-03-24 19:16:46] Rare karyotype solution. Skipping post-optimization.
INFO [2022-03-24 19:16:46] Optimized purity: 0.95
INFO [2022-03-24 19:16:46] Fitting variants for purity 0.33, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:19:02] Fitting variants for purity 0.34, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:21:18] Fitting variants for purity 0.35, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:23:34] Fitting variants for purity 0.36, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:25:49] Fitting variants for purity 0.38, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:28:06] Fitting variants for purity 0.39, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:30:22] Fitting variants for purity 0.40, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:32:38] Fitting variants for purity 0.41, tumor ploidy 4.26 and contamination 0.01.
INFO [2022-03-24 19:34:55] Optimized purity: 0.39
INFO [2022-03-24 19:34:55] Done.
INFO [2022-03-24 19:34:55] ------------------------------------------------------------
INFO [2022-03-24 19:35:05] Generating output files...
INFO [2022-03-24 19:35:30] Tumor/normal noise ratio: 13.902
WARN [2022-03-24 19:35:30] Extensive noise in tumor compared to normals.
INFO [2022-03-24 19:35:30] Using BiocParallel for parallel optimization.

**B-allele frequency plot**

![image](https://user-images.githubusercontent.com/92730922/160119694-1bc42d95-5efb-4474-9cc5-1394a3f1b191.png)


Additional info: 

Coverage from loess.txt

PBMC1:
mean.coverage.ontarget mean.coverage.offtarget mean.duplication.ontarget mean.duplication.offtarget mom.raw.ontarget mom.raw.offtarget mom.post.gc.ontarget mom.post.gc.offtarget mom.post.reptiming.ontarget mom.post.reptiming.offtarget
72.5941883560167  0.54299063158207  0.944767300768795  0.940291615335126  0.940291615335126

PBMC2:
mean.coverage.ontarget mean.coverage.offtarget mean.duplication.ontarget mean.duplication.offtarget mom.raw.ontarget mom.raw.offtarget mom.post.gc.ontarget mom.post.gc.offtarget mom.post.reptiming.ontarget mom.post.reptiming.offtarget
85.1058077064394  0.573190826645468  0.930463865180932  0.933829249391519  0.933829249391519

PBMC3:
mean.coverage.ontarget mean.coverage.offtarget mean.duplication.ontarget mean.duplication.offtarget mom.raw.ontarget mom.raw.offtarget mom.post.gc.ontarget mom.post.gc.offtarget mom.post.reptiming.ontarget mom.post.reptiming.offtarget
45.1083830133847  0.51011925457268  0.924617492664817  0.928424222220793  0.928424222220793

PBMC4:
mean.coverage.ontarget mean.coverage.offtarget mean.duplication.ontarget mean.duplication.offtarget mom.raw.ontarget mom.raw.offtarget mom.post.gc.ontarget mom.post.gc.offtarget mom.post.reptiming.ontarget mom.post.reptiming.offtarget
89.8301828978843  0.561431138818597  0.933530744693964  0.932766463936515  0.932766463936515

Would you advise removing PBMC3 from my panel? ",rbell-img,https://github.com/lima1/PureCN/issues/230
I_kwDOBew4us5HOdlG,parameter settiing for low-coverage whole genome sequencing data,CLOSED,2022-04-06T18:20:43Z,2022-04-12T14:45:19Z,2022-04-12T14:45:19Z,"Hi,
I am recently using pureCN based on cnvkit segments. I found many samples have not enough germline mutations to estimate ploidy and purity. 
Is this because the parameter I set is too strict to call? or because of the pretty low coverage of some samples? I have many samples only have ~5X-10X depth.

command:
`Rscript R/library/PureCN/extdata/PureCN.R --out /pureCN/purecn_output/1979_WGS --sampleid 1979_WGS --tumor pureCN/cnr_cnvkit/1979_WGS.T.cnr --seg-file pureCN/SEG_cnvkit/1979_WGS.seg --mapping-bias-file /pureCN/WGS_mapping_bias.rds --vcf /pureCN/mutect/1979_WGS.raw.vcf --snp-blacklist /pureCN/hg38_simpleRepeats.bed --genome hg38 --fun-segmentation none --force --post-optimize --seed 123 --sex M`


> INFO [2022-04-06 10:12:40] Loading coverage files...
> WARN [2022-04-06 10:12:42] Multiple chromosomes with very low coverage: chr15_KI270851v1_alt,chr22_KI270879v1_alt,chr7_KI270803v1_alt
> INFO [2022-04-06 10:12:43] Provided log2-ratio looks too noisy, using segmentation only.
> WARN [2022-04-06 10:12:43] Provided sampleid (1979_WGS) does not match 1979_WGS.T found in segmentation.
> INFO [2022-04-06 10:12:45] Removing 5 intervals with missing log.ratio.
> INFO [2022-04-06 10:12:45] Removing 6 intervals on non-standard chromosomes not listed in centromeres (chr1_KI270711v1_random,chr7_KI270803v1_alt,chr15_KI270850v1_alt,chr15_KI270851v1_alt,chr17_KI270909v1_alt,chr22_KI270879v1_alt).
> INFO [2022-04-06 10:12:45] Using 160335 intervals (160335 on-target, 0 off-target).
> INFO [2022-04-06 10:12:45] No off-target intervals. If this is hybrid-capture data, consider adding them.
> INFO [2022-04-06 10:12:45] Loading VCF...
> INFO [2022-04-06 10:15:47] Found 3042948 variants in VCF file.
> INFO [2022-04-06 10:15:59] Removing 8553 triallelic sites.
> WARN [2022-04-06 10:16:02] Found GERMQ info field with Phred scaled germline probabilities.
> INFO [2022-04-06 10:16:18] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
> WARN [2022-04-06 10:16:21] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
> INFO [2022-04-06 10:16:27] 2563776 (84.5%) variants annotated as likely germline (DB INFO flag).
> WARN [2022-04-06 10:17:51] Found 183134 variants with missing allelic fraction starting with chr1:39143_C/A. Removing them.
> INFO [2022-04-06 10:18:28] 1979_WGS is tumor in VCF file.
> INFO [2022-04-06 10:18:47] 1 homozygous and 4 heterozygous variants on chrX.
> INFO [2022-04-06 10:18:47] Sex from VCF: NA (Fisher's p-value: 0.261, odds-ratio: 4.02).
> INFO [2022-04-06 10:18:47] Detected MuTect2 VCF.
> INFO [2022-04-06 10:19:07] Removing 0 Mutect2 calls due to blacklisted failure reasons.
**> INFO [2022-04-06 10:19:13] Removing 2592950 non heterozygous (in matched normal) germline SNPs.**
> INFO [2022-04-06 10:19:15] Removing 86733 low quality variants with non-offset BQ < 25.
> INFO [2022-04-06 10:19:15] Base quality scores range from 24 to 32 (offset by 1)
> INFO [2022-04-06 10:19:15] Minimum number of supporting reads ranges from 2 to 15, depending on coverage and BQS.
> INFO [2022-04-06 10:19:53] Removing 168898 variants with AF < 0.030 or AF >= 1.000 or insufficient supporting reads or depth < 15.
> INFO [2022-04-06 10:19:59] Removing 1389 blacklisted variants.
> INFO [2022-04-06 10:19:59] Total size of targeted genomic region: 28.60Mb (44.53Mb with 50bp padding).
> INFO [2022-04-06 10:20:00] 0.0% of targets contain variants.
> INFO [2022-04-06 10:20:00] Removing 1289 variants outside intervals.
> INFO [2022-04-06 10:20:00] Found SOMATIC annotation in VCF.
> INFO [2022-04-06 10:20:00] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
> INFO [2022-04-06 10:20:00] Found SOMATIC annotation in VCF. Setting mapping bias to 0.651.
> INFO [2022-04-06 10:20:00] Loading mapping bias file WGS_mapping_bias.rds...
> INFO [2022-04-06 10:28:36] Found 80418457 variants in mapping bias file.
> INFO [2022-04-06 10:29:48] Imputing mapping bias for 0 variants...
> INFO [2022-04-06 10:29:51] Excluding 1 novel or poor quality variants from segmentation.
> INFO [2022-04-06 10:29:51] Excluding 0 variants not in pool of normals from segmentation.
> INFO [2022-04-06 10:29:51] Sample sex: M
> INFO [2022-04-06 10:29:51] Segmenting data...
> INFO [2022-04-06 10:29:51] Loaded provided segmentation file 1979_WGS.seg (format DNAcopy).
> WARN [2022-04-06 10:29:51] Provided sampleid (1979_WGS) does not match 1979_WGS.T found in segmentation.
> INFO [2022-04-06 10:29:51] Re-centering provided segment means (offset -0.1328).
> INFO [2022-04-06 10:29:51] Found 55 segments with median size of 42.53Mb.
> INFO [2022-04-06 10:29:51] Using 2 variants.
> INFO [2022-04-06 10:29:51] Mean standard deviation of log-ratios: 0.40 (MAPD: 0.00)
> INFO [2022-04-06 10:29:51] 2D-grid search of purity and ploidy...
> ERROR in: Rscript R/library/PureCN/extdata/PureCN.R --out /pureCN/purecn_output/1979_WGS --sampleid 1979_WGS --tumor pureCN/cnr_cnvkit/1979_WGS.T.cnr --seg-file pureCN/SEG_cnvkit/1979_WGS.seg --mapping-bias-file /pureCN/WGS_mapping_bias.rds --vcf /pureCN/mutect/1979_WGS.raw.vcf --snp-blacklist /pureCN/hg38_simpleRepeats.bed --genome hg38 --fun-segmentation none --force --post-optimize --seed 123 --sex M

Any suggestions might be appreciated.
Thanks,
Funan",hfl112,https://github.com/lima1/PureCN/issues/231
I_kwDOBew4us5IunId,PureCN with CNVkit output - Cannot find valid purity/ploidy solution,CLOSED,2022-04-29T08:08:20Z,2022-05-05T04:05:24Z,2022-05-05T04:05:24Z,"I recently got PureCN to work quite well with several of my exomes. I noticed that for some cnvkit output that over-segmented the sample, PSCBS instead of Hclust in PureCN gave me really clean results. However, for a couple samples, I could not get PureCN to run no matter what. For the most part, my pipeline to run pureCN from cnvkit follows this thread quite closely: https://www.biostars.org/p/472617/

I created a panel of normals for mutect2 to be used for all the tumours, and I used bcftools merge to create a panel of normals for normalDB.R.

In general my run looks like this:
` 
Rscript $PURECN/PureCN.R --out results/cnvkit-1.0_masked/pureCN/06-pureCN/idt/CLC01362/                  --sampleid CLC01362                 --tumor results/cnvkit-1.0_masked/pureCN/05-cnvkit-cnr/idt/CLC01362.cnr                 --seg-file results/cnvkit-1.0_masked/pureCN/03-cnvkit_seg/idt/CLC01362.seg                 --stats-file results/cnvkit-1.0_masked/pureCN/04-mutect2/idt/CLC01362/CLC01362.stats                 --vcf results/cnvkit-1.0_masked/pureCN/04-mutect2/idt/CLC01362/CLC01362.vcf.gz                 --snp-blacklist results/cnvkit-1.0_masked/pureCN/00-bam/repeatmasker.grch37.bed                 --mappingbiasfile results/cnvkit-1.0_masked/pureCN/02-pon/mapping_bias_idt_hg19.rds                 --genome hg19                 --fun-segmentation PSCBS                --max-copy-number 8                 --model betabin                 --cores 3                 --force --post-optimize --seed 123
`

From the 21 samples that failed, the error logs either look like this:
**Log file 1**
WARN [2022-04-28 20:36:43] Deprecated arguments, use --mapping-bias-file instead.
[1] ""/projects/dscott_scratch/CCSRI_1500/exomes/results_local/cnvkit-1.0_masked/pureCN/06-pureCN/idt/CLC01362""
INFO [2022-04-28 20:36:43] Loading PureCN 2.0.1...
Warning messages:
1: package ‘DNAcopy’ was built under R version 4.1.2
2: package ‘VariantAnnotation’ was built under R version 4.1.2
3: package ‘IRanges’ was built under R version 4.1.2
4: package ‘Biobase’ was built under R version 4.1.2
5: package ‘Rsamtools’ was built under R version 4.1.2
6: package ‘Biostrings’ was built under R version 4.1.2
7: package ‘XVector’ was built under R version 4.1.2
INFO [2022-04-28 20:36:44] Using BiocParallel MulticoreParam backend with 3 cores.
INFO [2022-04-28 20:36:44] ------------------------------------------------------------
INFO [2022-04-28 20:36:44] PureCN 2.0.1
INFO [2022-04-28 20:36:44] ------------------------------------------------------------
INFO [2022-04-28 20:36:44] Arguments: -normal.coverage.file  -tumor.coverage.file results/cnvkit-1.0_masked/pureCN/05-cnvkit-cnr/idt/CLC01362.cnr -log.ratio  -seg.file results/cnvkit-1.0_masked/pureCN/03-cnvkit_seg/idt/CLC01362.seg -vcf.file results/cnvkit-1.0_masked/pureCN/04-mutect2/idt/CLC01362/CLC01362.vcf.gz -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf results/cnvkit-1.0_masked/pureCN/02-pon/mapping_bias_idt_hg19.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid CLC01362 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -log.file results/cnvkit-1.0_masked/pureCN/06-pureCN/idt/CLC01362//CLC01362.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-04-28 20:36:44] Using BiocParallel for parallel optimization.
INFO [2022-04-28 20:36:44] Loading coverage files...
INFO [2022-04-28 20:36:48] Provided log2-ratio looks too noisy, using segmentation only.
INFO [2022-04-28 20:36:49] Mean coverages: chrX: 10.98, chrY: 15.89, chr1-22: 22.57.
INFO [2022-04-28 20:36:49] Mean coverages: chrX: 10.98, chrY: 15.89, chr1-22: 22.57.
INFO [2022-04-28 20:36:49] Removing 30 intervals with missing log.ratio.
INFO [2022-04-28 20:36:49] Using 227596 intervals (193310 on-target, 34286 off-target).
INFO [2022-04-28 20:36:49] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-04-28 20:36:49] Mean off-target bin size: 31623
INFO [2022-04-28 20:36:49] Loading VCF...
INFO [2022-04-28 20:36:56] Found 244079 variants in VCF file.
INFO [2022-04-28 20:36:57] Removing 1729 triallelic sites.
INFO [2022-04-28 20:36:58] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-04-28 20:36:58] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2022-04-28 20:36:58] 105610 (43.6%) variants annotated as likely germline (DB INFO flag).
INFO [2022-04-28 20:37:03] CLC01362 is tumor in VCF file.
INFO [2022-04-28 20:37:06] 170 homozygous and 105 heterozygous variants on chrX.
INFO [2022-04-28 20:37:06] Sex from VCF: NA (Fisher's p-value: < 0.0001, odds-ratio: 3.07).
WARN [2022-04-28 20:37:06] MuTect stats file lacks contig and position columns.
INFO [2022-04-28 20:37:17] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-04-28 20:37:18] Removing 211672 variants with AF < 0.030 or AF >= 0.970 or less than 3 supporting reads or depth < 15.
INFO [2022-04-28 20:37:24] Removing 2193 blacklisted variants.
WARN [2022-04-28 20:37:25] Variant ids contain NAs at filter step BQ.
INFO [2022-04-28 20:37:25] Removing 0 low quality variants with BQ < 25.
INFO [2022-04-28 20:37:25] Total size of targeted genomic region: 31.70Mb (50.24Mb with 50bp padding).
INFO [2022-04-28 20:37:25] 8.0% of targets contain variants.
INFO [2022-04-28 20:37:25] Removing 9458 variants outside intervals.
INFO [2022-04-28 20:37:25] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2022-04-28 20:37:25] Loading mapping bias file mapping_bias_idt_hg19.rds...
INFO [2022-04-28 20:38:20] Found 14273459 variants in mapping bias file.
INFO [2022-04-28 20:38:30] Imputing mapping bias for 3369 variants...
INFO [2022-04-28 20:43:42] Excluding 5315 novel or poor quality variants from segmentation.
INFO [2022-04-28 20:43:42] Excluding 3369 variants not in pool of normals from segmentation.
INFO [2022-04-28 20:43:42] Sample sex: M
INFO [2022-04-28 20:43:42] Segmenting data...
INFO [2022-04-28 20:43:42] Loaded provided segmentation file CLC01362.seg (format DNAcopy).
INFO [2022-04-28 20:43:42] Re-centering provided segment means (offset 0.0111).
INFO [2022-04-28 20:43:42] Setting prune.hclust.h parameter to 0.150000.
INFO [2022-04-28 20:43:42] Found 142 segments with median size of 6.38Mb.
INFO [2022-04-28 20:43:42] Removing 27 variants outside segments.
INFO [2022-04-28 20:43:42] Using 19000 variants.
INFO [2022-04-28 20:43:44] Mean standard deviation of log-ratios: 0.40 (MAPD: 0.00)
INFO [2022-04-28 20:43:44] Mean standard deviation of on-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2022-04-28 20:43:44] Mean standard deviation of off-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2022-04-28 20:43:44] 2D-grid search of purity and ploidy...
INFO [2022-04-28 20:47:32] Local optima: 0.17/2.4, 0.25/2.1, 0.33/2.8, 0.29/3, 0.88/5.8, 0.55/4.4,
0.52/3.2, 0.45/2.6, 0.45/4, 0.29/1.8, 0.85/4.8, 0.23/1.9, 0.21/2,
0.62/2.8, 0.45/1.6, 0.88/3, 0.58/2, 0.72/5.8, 0.78/2, 0.62/1.4
INFO [2022-04-28 20:47:32] Testing local optimum 1/20 at purity 0.17 and total ploidy 2.40...
INFO [2022-04-28 20:47:45] Recalibrating log-ratios...
INFO [2022-04-28 20:47:45] Testing local optimum 1/20 at purity 0.17 and total ploidy 2.40...
INFO [2022-04-28 20:47:56] Recalibrating log-ratios...
INFO [2022-04-28 20:47:56] Testing local optimum 1/20 at purity 0.17 and total ploidy 2.40...
INFO [2022-04-28 20:48:07] Recalibrating log-ratios...
INFO [2022-04-28 20:48:07] Testing local optimum 1/20 at purity 0.17 and total ploidy 2.40...
INFO [2022-04-28 20:48:19] Testing local optimum 2/20 at purity 0.25 and total ploidy 2.10...
INFO [2022-04-28 20:48:28] Recalibrating log-ratios...
INFO [2022-04-28 20:48:28] Testing local optimum 2/20 at purity 0.25 and total ploidy 2.10...
INFO [2022-04-28 20:48:38] Recalibrating log-ratios...
INFO [2022-04-28 20:48:38] Testing local optimum 2/20 at purity 0.25 and total ploidy 2.10...
INFO [2022-04-28 20:48:49] Recalibrating log-ratios...
INFO [2022-04-28 20:48:49] Testing local optimum 2/20 at purity 0.25 and total ploidy 2.10...
INFO [2022-04-28 20:48:59] Testing local optimum 3/20 at purity 0.33 and total ploidy 2.80...
INFO [2022-04-28 20:49:08] Recalibrating log-ratios...
INFO [2022-04-28 20:49:08] Testing local optimum 3/20 at purity 0.33 and total ploidy 2.80...
INFO [2022-04-28 20:49:18] Recalibrating log-ratios...
INFO [2022-04-28 20:49:18] Testing local optimum 3/20 at purity 0.33 and total ploidy 2.80...
INFO [2022-04-28 20:49:28] Recalibrating log-ratios...
INFO [2022-04-28 20:49:28] Testing local optimum 3/20 at purity 0.33 and total ploidy 2.80...
INFO [2022-04-28 20:49:39] Testing local optimum 4/20 at purity 0.29 and total ploidy 3.00...
INFO [2022-04-28 20:49:47] Recalibrating log-ratios...
INFO [2022-04-28 20:49:47] Testing local optimum 4/20 at purity 0.29 and total ploidy 3.00...
INFO [2022-04-28 20:49:57] Recalibrating log-ratios...
INFO [2022-04-28 20:49:57] Testing local optimum 4/20 at purity 0.29 and total ploidy 3.00...
INFO [2022-04-28 20:50:07] Recalibrating log-ratios...
INFO [2022-04-28 20:50:07] Testing local optimum 4/20 at purity 0.29 and total ploidy 3.00...
INFO [2022-04-28 20:50:17] Testing local optimum 5/20 at purity 0.88 and total ploidy 5.80...
INFO [2022-04-28 20:50:25] Recalibrating log-ratios...
INFO [2022-04-28 20:50:25] Testing local optimum 5/20 at purity 0.88 and total ploidy 5.80...
INFO [2022-04-28 20:50:34] Recalibrating log-ratios...
INFO [2022-04-28 20:50:34] Testing local optimum 5/20 at purity 0.88 and total ploidy 5.80...
INFO [2022-04-28 20:50:46] Recalibrating log-ratios...
INFO [2022-04-28 20:50:46] Testing local optimum 5/20 at purity 0.88 and total ploidy 5.80...
INFO [2022-04-28 20:50:54] Testing local optimum 6/20 at purity 0.55 and total ploidy 4.40...
INFO [2022-04-28 20:51:01] Recalibrating log-ratios...
INFO [2022-04-28 20:51:01] Testing local optimum 6/20 at purity 0.55 and total ploidy 4.40...
INFO [2022-04-28 20:51:08] Recalibrating log-ratios...
INFO [2022-04-28 20:51:08] Testing local optimum 6/20 at purity 0.55 and total ploidy 4.40...
INFO [2022-04-28 20:51:16] Recalibrating log-ratios...
INFO [2022-04-28 20:51:16] Testing local optimum 6/20 at purity 0.55 and total ploidy 4.40...
INFO [2022-04-28 20:51:24] Testing local optimum 7/20 at purity 0.52 and total ploidy 3.20...
INFO [2022-04-28 20:51:31] Recalibrating log-ratios...
INFO [2022-04-28 20:51:31] Testing local optimum 7/20 at purity 0.52 and total ploidy 3.20...
INFO [2022-04-28 20:51:39] Recalibrating log-ratios...
INFO [2022-04-28 20:51:39] Testing local optimum 7/20 at purity 0.52 and total ploidy 3.20...
INFO [2022-04-28 20:51:48] Recalibrating log-ratios...
INFO [2022-04-28 20:51:48] Testing local optimum 7/20 at purity 0.52 and total ploidy 3.20...
INFO [2022-04-28 20:47:32] Testing local optimum 8/20 at purity 0.45 and total ploidy 2.60...
INFO [2022-04-28 20:47:52] Recalibrating log-ratios...
INFO [2022-04-28 20:47:52] Testing local optimum 8/20 at purity 0.45 and total ploidy 2.60...
INFO [2022-04-28 20:48:09] Recalibrating log-ratios...
INFO [2022-04-28 20:48:09] Testing local optimum 8/20 at purity 0.45 and total ploidy 2.60...
INFO [2022-04-28 20:48:29] Recalibrating log-ratios...
INFO [2022-04-28 20:48:29] Testing local optimum 8/20 at purity 0.45 and total ploidy 2.60...
INFO [2022-04-28 20:48:49] Testing local optimum 9/20 at purity 0.45 and total ploidy 4.00...
INFO [2022-04-28 20:49:05] Recalibrating log-ratios...
INFO [2022-04-28 20:49:05] Testing local optimum 9/20 at purity 0.45 and total ploidy 4.00...
INFO [2022-04-28 20:49:23] Recalibrating log-ratios...
INFO [2022-04-28 20:49:23] Testing local optimum 9/20 at purity 0.45 and total ploidy 4.00...
INFO [2022-04-28 20:49:40] Recalibrating log-ratios...
INFO [2022-04-28 20:49:40] Testing local optimum 9/20 at purity 0.45 and total ploidy 4.00...
INFO [2022-04-28 20:49:59] Testing local optimum 10/20 at purity 0.29 and total ploidy 1.80...
INFO [2022-04-28 20:50:13] Recalibrating log-ratios...
INFO [2022-04-28 20:50:13] Testing local optimum 10/20 at purity 0.29 and total ploidy 1.80...
INFO [2022-04-28 20:50:29] Recalibrating log-ratios...
INFO [2022-04-28 20:50:29] Testing local optimum 10/20 at purity 0.29 and total ploidy 1.80...
INFO [2022-04-28 20:50:45] Recalibrating log-ratios...
INFO [2022-04-28 20:50:45] Testing local optimum 10/20 at purity 0.29 and total ploidy 1.80...
INFO [2022-04-28 20:51:01] Testing local optimum 11/20 at purity 0.85 and total ploidy 4.80...
INFO [2022-04-28 20:51:15] Recalibrating log-ratios...
INFO [2022-04-28 20:51:15] Testing local optimum 11/20 at purity 0.85 and total ploidy 4.80...
INFO [2022-04-28 20:51:30] Recalibrating log-ratios...
INFO [2022-04-28 20:51:30] Testing local optimum 11/20 at purity 0.85 and total ploidy 4.80...
INFO [2022-04-28 20:51:46] Recalibrating log-ratios...
INFO [2022-04-28 20:51:46] Testing local optimum 11/20 at purity 0.85 and total ploidy 4.80...
INFO [2022-04-28 20:52:01] Testing local optimum 12/20 at purity 0.23 and total ploidy 1.90...
INFO [2022-04-28 20:52:09] Recalibrating log-ratios...
INFO [2022-04-28 20:52:09] Testing local optimum 12/20 at purity 0.23 and total ploidy 1.90...
INFO [2022-04-28 20:52:18] Recalibrating log-ratios...
INFO [2022-04-28 20:52:18] Testing local optimum 12/20 at purity 0.23 and total ploidy 1.90...
INFO [2022-04-28 20:52:30] Recalibrating log-ratios...
INFO [2022-04-28 20:52:30] Testing local optimum 12/20 at purity 0.23 and total ploidy 1.90...
INFO [2022-04-28 20:52:37] Testing local optimum 13/20 at purity 0.21 and total ploidy 2.00...
INFO [2022-04-28 20:52:44] Recalibrating log-ratios...
INFO [2022-04-28 20:52:44] Testing local optimum 13/20 at purity 0.21 and total ploidy 2.00...
INFO [2022-04-28 20:52:50] Recalibrating log-ratios...
INFO [2022-04-28 20:52:50] Testing local optimum 13/20 at purity 0.21 and total ploidy 2.00...
INFO [2022-04-28 20:52:57] Recalibrating log-ratios...
INFO [2022-04-28 20:52:57] Testing local optimum 13/20 at purity 0.21 and total ploidy 2.00...
INFO [2022-04-28 20:47:33] Testing local optimum 14/20 at purity 0.62 and total ploidy 2.80...
INFO [2022-04-28 20:47:53] Recalibrating log-ratios...
INFO [2022-04-28 20:47:53] Testing local optimum 14/20 at purity 0.62 and total ploidy 2.80...
INFO [2022-04-28 20:48:11] Recalibrating log-ratios...
INFO [2022-04-28 20:48:11] Testing local optimum 14/20 at purity 0.62 and total ploidy 2.80...
INFO [2022-04-28 20:48:30] Recalibrating log-ratios...
INFO [2022-04-28 20:48:30] Testing local optimum 14/20 at purity 0.62 and total ploidy 2.80...
INFO [2022-04-28 20:48:51] Testing local optimum 15/20 at purity 0.45 and total ploidy 1.60...
INFO [2022-04-28 20:49:07] Recalibrating log-ratios...
INFO [2022-04-28 20:49:07] Testing local optimum 15/20 at purity 0.45 and total ploidy 1.60...
INFO [2022-04-28 20:49:24] Recalibrating log-ratios...
INFO [2022-04-28 20:49:24] Testing local optimum 15/20 at purity 0.45 and total ploidy 1.60...
INFO [2022-04-28 20:49:42] Recalibrating log-ratios...
INFO [2022-04-28 20:49:42] Testing local optimum 15/20 at purity 0.45 and total ploidy 1.60...
INFO [2022-04-28 20:50:00] Testing local optimum 16/20 at purity 0.88 and total ploidy 3.00...
INFO [2022-04-28 20:50:14] Recalibrating log-ratios...
INFO [2022-04-28 20:50:14] Testing local optimum 16/20 at purity 0.88 and total ploidy 3.00...
INFO [2022-04-28 20:50:29] Recalibrating log-ratios...
INFO [2022-04-28 20:50:29] Testing local optimum 16/20 at purity 0.88 and total ploidy 3.00...
INFO [2022-04-28 20:50:46] Recalibrating log-ratios...
INFO [2022-04-28 20:50:46] Testing local optimum 16/20 at purity 0.88 and total ploidy 3.00...
INFO [2022-04-28 20:51:01] Testing local optimum 17/20 at purity 0.58 and total ploidy 2.00...
INFO [2022-04-28 20:51:16] Recalibrating log-ratios...
INFO [2022-04-28 20:51:16] Testing local optimum 17/20 at purity 0.58 and total ploidy 2.00...
INFO [2022-04-28 20:51:32] Recalibrating log-ratios...
INFO [2022-04-28 20:51:32] Testing local optimum 17/20 at purity 0.58 and total ploidy 2.00...
INFO [2022-04-28 20:51:48] Recalibrating log-ratios...
INFO [2022-04-28 20:51:48] Testing local optimum 17/20 at purity 0.58 and total ploidy 2.00...
INFO [2022-04-28 20:52:03] Testing local optimum 18/20 at purity 0.72 and total ploidy 5.80...
INFO [2022-04-28 20:52:13] Recalibrating log-ratios...
INFO [2022-04-28 20:52:13] Testing local optimum 18/20 at purity 0.72 and total ploidy 5.80...
INFO [2022-04-28 20:52:23] Recalibrating log-ratios...
INFO [2022-04-28 20:52:23] Testing local optimum 18/20 at purity 0.72 and total ploidy 5.80...
INFO [2022-04-28 20:52:34] Recalibrating log-ratios...
INFO [2022-04-28 20:52:34] Testing local optimum 18/20 at purity 0.72 and total ploidy 5.80...
INFO [2022-04-28 20:52:42] Testing local optimum 19/20 at purity 0.78 and total ploidy 2.00...
INFO [2022-04-28 20:52:49] Recalibrating log-ratios...
INFO [2022-04-28 20:52:49] Testing local optimum 19/20 at purity 0.78 and total ploidy 2.00...
INFO [2022-04-28 20:52:55] Recalibrating log-ratios...
INFO [2022-04-28 20:52:55] Testing local optimum 19/20 at purity 0.78 and total ploidy 2.00...
INFO [2022-04-28 20:53:03] Recalibrating log-ratios...
INFO [2022-04-28 20:53:03] Testing local optimum 19/20 at purity 0.78 and total ploidy 2.00...
INFO [2022-04-28 20:53:10] Testing local optimum 20/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-04-28 20:53:17] Recalibrating log-ratios...
INFO [2022-04-28 20:53:17] Testing local optimum 20/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-04-28 20:53:24] Recalibrating log-ratios...
INFO [2022-04-28 20:53:24] Testing local optimum 20/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-04-28 20:53:32] Recalibrating log-ratios...
INFO [2022-04-28 20:53:32] Testing local optimum 20/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-04-28 20:53:41] Skipping 4 solutions that converged to the same optima.
INFO [2022-04-28 20:53:41] Skipping 16 solutions exceeding max.non.clonal (0.20): 0.66/733853548730.78, 0.61/831288636877.29, 0.82/670664672594.41, 0.78/822384016887.87, 0.95/483425316938.89, 0.95/151298065501.38, 0.15/508789115927.57, 0.95/417626848681.16, 0.15/676236070295.88, 0.39/1101604614794.06, 0.95/345701682242.99, 0.95/249885827089.28, 0.78/434832441773.93, 0.95/99932992340.11, 0.86/375762933953.84, 0.15/323299241819.74 (purity/tumor ploidy)
WARN [2022-04-28 20:53:41] Could not find valid purity and ploidy solution.
Error in results[[1]] : subscript out of bounds
Calls: runAbsoluteCN -> grepl -> is.factor
Execution halted

or this

** Log file 2 **
WARN [2022-04-28 20:36:43] Deprecated arguments, use --mapping-bias-file instead.
[1] ""/projects/dscott_scratch/CCSRI_1500/exomes/results_local/cnvkit-1.0_masked/pureCN/06-pureCN/idt/CCS_0898""
INFO [2022-04-28 20:36:43] Loading PureCN 2.0.1...
Warning messages:
1: package ‘DNAcopy’ was built under R version 4.1.2
2: package ‘VariantAnnotation’ was built under R version 4.1.2
3: package ‘IRanges’ was built under R version 4.1.2
4: package ‘Biobase’ was built under R version 4.1.2
5: package ‘Rsamtools’ was built under R version 4.1.2
6: package ‘Biostrings’ was built under R version 4.1.2
7: package ‘XVector’ was built under R version 4.1.2
INFO [2022-04-28 20:36:44] Using BiocParallel MulticoreParam backend with 3 cores.
INFO [2022-04-28 20:36:44] ------------------------------------------------------------
INFO [2022-04-28 20:36:44] PureCN 2.0.1
INFO [2022-04-28 20:36:44] ------------------------------------------------------------
INFO [2022-04-28 20:36:44] Arguments: -normal.coverage.file  -tumor.coverage.file results/cnvkit-1.0_masked/pureCN/05-cnvkit-cnr/idt/CCS_0898.cnr -log.ratio  -seg.file results/cnvkit-1.0_masked/pureCN/03-cnvkit_seg/idt/CCS_0898.seg -vcf.file results/cnvkit-1.0_masked/pureCN/04-mutect2/idt/CCS_0898/CCS_0898.vcf.gz -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf results/cnvkit-1.0_masked/pureCN/02-pon/mapping_bias_idt_hg19.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid CCS_0898 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -log.file results/cnvkit-1.0_masked/pureCN/06-pureCN/idt/CCS_0898//CCS_0898.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-04-28 20:36:44] Using BiocParallel for parallel optimization.
INFO [2022-04-28 20:36:44] Loading coverage files...
INFO [2022-04-28 20:36:48] Found log2-ratio in tumor coverage data.
INFO [2022-04-28 20:36:48] Mean coverages: chrX: 65.32, chrY: 72.17, chr1-22: 98.63.
INFO [2022-04-28 20:36:48] Mean coverages: chrX: 65.32, chrY: 72.17, chr1-22: 98.63.
INFO [2022-04-28 20:36:49] Using 225707 intervals (193440 on-target, 32267 off-target).
INFO [2022-04-28 20:36:49] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-04-28 20:36:49] Mean off-target bin size: 31696
INFO [2022-04-28 20:36:49] Loading VCF...
INFO [2022-04-28 20:36:55] Found 256791 variants in VCF file.
INFO [2022-04-28 20:36:57] Removing 4407 triallelic sites.
INFO [2022-04-28 20:36:57] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-04-28 20:36:57] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2022-04-28 20:36:58] 156989 (62.2%) variants annotated as likely germline (DB INFO flag).
WARN [2022-04-28 20:37:03] Found 1 variants with missing allelic fraction starting with 19:53302899_G/C. Removing them.
INFO [2022-04-28 20:37:05] CCS_0898 is tumor in VCF file.
INFO [2022-04-28 20:37:07] 990 homozygous and 296 heterozygous variants on chrX.
INFO [2022-04-28 20:37:07] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 5.83).
WARN [2022-04-28 20:37:07] MuTect stats file lacks contig and position columns.
INFO [2022-04-28 20:37:18] Initial testing for significant sample cross-contamination: maybe
INFO [2022-04-28 20:37:19] Removing 180792 variants with AF < 0.030 or AF >= 0.970 or less than 3 supporting reads or depth < 15.
INFO [2022-04-28 20:37:24] Removing 7093 blacklisted variants.
WARN [2022-04-28 20:37:24] Variant ids contain NAs at filter step BQ.
INFO [2022-04-28 20:37:25] Removing 0 low quality variants with BQ < 25.
INFO [2022-04-28 20:37:25] Total size of targeted genomic region: 31.72Mb (50.27Mb with 50bp padding).
INFO [2022-04-28 20:37:26] 11.6% of targets contain variants.
INFO [2022-04-28 20:37:26] Removing 34652 variants outside intervals.
INFO [2022-04-28 20:37:26] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2022-04-28 20:37:26] Loading mapping bias file mapping_bias_idt_hg19.rds...
INFO [2022-04-28 20:38:14] Found 14273459 variants in mapping bias file.
INFO [2022-04-28 20:38:27] Imputing mapping bias for 2288 variants...
INFO [2022-04-28 20:41:14] Excluding 7055 novel or poor quality variants from segmentation.
INFO [2022-04-28 20:41:14] Excluding 2288 variants not in pool of normals from segmentation.
INFO [2022-04-28 20:41:14] Sample sex: M
INFO [2022-04-28 20:41:14] Segmenting data...
INFO [2022-04-28 20:41:14] Loaded provided segmentation file CCS_0898.seg (format DNAcopy).
INFO [2022-04-28 20:41:14] Re-centering provided segment means (offset 0.0191).
INFO [2022-04-28 20:41:15] Setting prune.hclust.h parameter to 0.150000.
INFO [2022-04-28 20:41:15] Found 113 segments with median size of 9.03Mb.
INFO [2022-04-28 20:41:15] Removing 101 variants outside segments.
INFO [2022-04-28 20:41:15] Using 29745 variants.
INFO [2022-04-28 20:41:16] Mean standard deviation of log-ratios: 1.33 (MAPD: 0.32)
INFO [2022-04-28 20:41:16] Mean standard deviation of on-target log-ratios only: 0.35 (MAPD: 0.26)
INFO [2022-04-28 20:41:16] Mean standard deviation of off-target log-ratios only: 2.62 (MAPD: 1.30)
INFO [2022-04-28 20:41:16] 2D-grid search of purity and ploidy...
FATAL [2022-04-28 20:44:51] Cannot find valid purity/ploidy solution. This happens when input

FATAL [2022-04-28 20:44:51] segmentations are garbage, most likely due to a catastrophic sample QC

FATAL [2022-04-28 20:44:51] failure. Re-check standard QC metrics for this sample.

FATAL [2022-04-28 20:44:51]

FATAL [2022-04-28 20:44:51] This is most likely a user error due to invalid input data or

FATAL [2022-04-28 20:44:51] parameters (PureCN 2.0.1).

Error: Cannot find valid purity/ploidy solution. This happens when input
segmentations are garbage, most likely due to a catastrophic sample QC
failure. Re-check standard QC metrics for this sample.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.0.1).
Execution halted

** More information ** 
Since they both stop at the same step, I was wondering if there was any relationship with the errors.

I believe it may be from relatively low read depth in off-target sites. Notably, I have also tried to remove any cnvkit segments from the *.cnr files that were smaller than -8. Removing chrX and chrY did nothing. Neither did setting --sex M. I have also tried to raise --max-non-clonal to 0.4. I did notice that for these samples, there was very little coverage in AntiTarget regions in general (at least relative to the samples that did work).

Ideally I hope there is a fix that would let me just stick with my cnvkit output as input to pureCN. I have been using the pureCN conda environment.

Thanks for your help!
",Jwong684,https://github.com/lima1/PureCN/issues/232
I_kwDOBew4us5I6P7Y,Noisy BAF plot,CLOSED,2022-05-02T18:55:22Z,2022-05-25T17:24:28Z,2022-05-25T17:24:28Z,"Hello,

Thank you for making such a great tool. I'm trying to interpret the results I am getting (using CNVkit + pureCN pipeline with VCF germline/somatic calling by mutect2). I have WES from matched FFPE tumor/normal at 100x/50x. For all of the samples but one, I am seeing very noisy BAF plots with no gaps in BAF around 0.5 for areas of predicted gain/loss. I am not sure if this is due to lower coverage of either tumor/normal and/or if it is something to be concerned about in interpreting the confidence of the pureCN segmentation results. I have included below the outputs for the sample that I think looks as expected, and one of the many that look quite noisy.

For cnvkit, I am using the standard batch workflow with tumor and matched normal, setting a larger target and antitarget size corresponding to the mean calculated bin size from the cnvkit autobin function, and applying --drop-low-coverage. 

For mutect2, I am following the standard pipeline including creating a somatic panel of normals: https://gatk.broadinstitute.org/hc/en-us/articles/360035531132--How-to-Call-somatic-mutations-using-GATK4-Mutect2 with the addition of setting both --genotype-germline-sites and --genotype-pon-sites to true. I am also following recommendations for accounting for read orientation bias in FFPE samples.

The following is my input to PureCN.R:

`		Rscript PureCN.R --out   \
		    --sampleid tumor \
		    --tumor tumor \
		    --seg-file tumors.seg \
		    --vcf filtered.vcf \
		    --genome hg19 \
		    --fun-segmentation Hclust \
		    --force \
		    --post-optimize \
		    --seed 123 \
		    --cores 32`

This is the log file for a sample I believe to be of good quality/results:


INFO [2022-04-29 18:47:43] PureCN 2.0.2
INFO [2022-04-29 18:47:43] ------------------------------------------------------------
INFO [2022-04-29 18:47:43] Arguments: -normal.coverage.file  -tumor.coverage.file tumor.cnr -log.ratio  -seg.file tumors.seg -vcf.file filtered.vcf -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid tumor -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -log.file tumor.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-04-29 18:47:43] Using BiocParallel for parallel optimization.
INFO [2022-04-29 18:47:43] Loading coverage files...
INFO [2022-04-29 18:47:50] Provided log2-ratio looks too noisy, using segmentation only.
WARN [2022-04-29 18:47:50] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
INFO [2022-04-29 18:47:51] Mean coverages: chrX: 100.19, chrY: 0.48, chr1-22: 119.68.
INFO [2022-04-29 18:47:51] Mean coverages: chrX: 100.19, chrY: 0.48, chr1-22: 119.68.
INFO [2022-04-29 18:47:52] Using 267562 intervals (207826 on-target, 59736 off-target).
INFO [2022-04-29 18:47:52] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-04-29 18:47:52] Mean off-target bin size: 40314
INFO [2022-04-29 18:47:52] Loading VCF...
INFO [2022-04-29 18:48:06] Found 200535 variants in VCF file.
INFO [2022-04-29 18:48:07] Removing 3820 triallelic sites.
WARN [2022-04-29 18:48:07] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2022-04-29 18:48:10] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2022-04-29 18:48:11] 61182 (31.1%) variants annotated as likely germline (DB INFO flag).
WARN [2022-04-29 18:48:21] Found 1417 variants with missing allelic fraction starting with 1:1219524_CG/C. Removing them.
INFO [2022-04-29 18:48:22] tumor is tumor in VCF file.
INFO [2022-04-29 18:48:26] 341 homozygous and 613 heterozygous variants on chrX.
INFO [2022-04-29 18:48:26] Sex from VCF: F (Fisher's p-value: 0.632, odds-ratio: 1.03).
INFO [2022-04-29 18:48:26] Detected MuTect2 VCF.
INFO [2022-04-29 18:48:28] Removing 138991 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-04-29 18:48:29] Removing 21595 non heterozygous (in matched normal) germline SNPs.
INFO [2022-04-29 18:48:32] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-04-29 18:48:34] Removing 5119 variants with AF < 0.030 or AF >= 1.000 or less than 4 supporting reads or depth < 15.
WARN [2022-04-29 18:48:34] Variant ids contain NAs at filter step BQ.
INFO [2022-04-29 18:48:34] Removing 0 low quality variants with BQ < 25.
INFO [2022-04-29 18:48:34] Total size of targeted genomic region: 62.36Mb (81.49Mb with 50bp padding).
INFO [2022-04-29 18:48:35] 11.5% of targets contain variants.
INFO [2022-04-29 18:48:35] Removing 1965 variants outside intervals.
INFO [2022-04-29 18:48:35] Found SOMATIC annotation in VCF.
INFO [2022-04-29 18:48:35] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2022-04-29 18:48:36] Found SOMATIC annotation in VCF. Setting mapping bias to 0.981.
INFO [2022-04-29 18:48:36] Excluding 9439 novel or poor quality variants from segmentation.
INFO [2022-04-29 18:48:36] Sample sex: F
INFO [2022-04-29 18:48:36] Segmenting data...
INFO [2022-04-29 18:48:36] Loaded provided segmentation file batch2_tumors.seg (format DNAcopy).
WARN [2022-04-29 18:48:36] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
INFO [2022-04-29 18:48:36] Re-centering provided segment means (offset -0.0394).
INFO [2022-04-29 18:48:37] Setting prune.hclust.h parameter to 0.150000.
INFO [2022-04-29 18:48:37] Found 39 segments with median size of 62.90Mb.
INFO [2022-04-29 18:48:37] Using 27628 variants.
INFO [2022-04-29 18:48:39] Mean standard deviation of log-ratios: 0.40 (MAPD: 0.00)
INFO [2022-04-29 18:48:39] Mean standard deviation of on-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2022-04-29 18:48:39] Mean standard deviation of off-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2022-04-29 18:48:39] 2D-grid search of purity and ploidy...
INFO [2022-04-29 18:49:22] Local optima: 0.25/2.1, 0.27/2, 0.45/2.8, 0.55/3, 0.52/3.4, 0.82/5,
0.85/3.4, 0.52/2, 0.78/2, 0.15/2
INFO [2022-04-29 18:49:22] Testing local optimum 1/10 at purity 0.25 and total ploidy 2.10...
INFO [2022-04-29 18:49:22] Testing local optimum 2/10 at purity 0.27 and total ploidy 2.00...
INFO [2022-04-29 18:49:22] Testing local optimum 3/10 at purity 0.45 and total ploidy 2.80...
INFO [2022-04-29 18:49:22] Testing local optimum 4/10 at purity 0.55 and total ploidy 3.00...
INFO [2022-04-29 18:49:22] Testing local optimum 5/10 at purity 0.52 and total ploidy 3.40...
INFO [2022-04-29 18:49:23] Testing local optimum 6/10 at purity 0.82 and total ploidy 5.00...
INFO [2022-04-29 18:49:23] Testing local optimum 7/10 at purity 0.85 and total ploidy 3.40...
INFO [2022-04-29 18:49:23] Testing local optimum 8/10 at purity 0.52 and total ploidy 2.00...
INFO [2022-04-29 18:49:23] Testing local optimum 9/10 at purity 0.78 and total ploidy 2.00...
INFO [2022-04-29 18:49:23] Testing local optimum 10/10 at purity 0.15 and total ploidy 2.00...
INFO [2022-04-29 18:50:40] Skipping 2 solutions that converged to the same optima.
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 1/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 2/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 3/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 4/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 5/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 6/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 7/10...
INFO [2022-04-29 18:50:41] Fitting variants with beta model for local optimum 9/10...
INFO [2022-04-29 18:50:50] Fitting variants for purity 0.45, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 18:50:50] Fitting variants for purity 0.30, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 18:50:50] Fitting variants for purity 0.31, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 18:50:51] Fitting variants for purity 0.50, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 18:50:51] Fitting variants for purity 0.54, tumor ploidy 4.75 and contamination 0.01.
INFO [2022-04-29 18:50:51] Fitting variants for purity 0.82, tumor ploidy 5.80 and contamination 0.01.
INFO [2022-04-29 18:50:51] Fitting variants for purity 0.59, tumor ploidy 2.19 and contamination 0.01.
INFO [2022-04-29 18:50:52] Fitting variants for purity 0.65, tumor ploidy 3.81 and contamination 0.01.
INFO [2022-04-29 18:55:01] Fitting variants for purity 0.46, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 18:55:15] Fitting variants for purity 0.26, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 18:55:24] Rare karyotype solution. Skipping post-optimization.
INFO [2022-04-29 18:55:24] Optimized purity: 0.82
INFO [2022-04-29 18:55:24] Poor goodness-of-fit (0.689). Skipping post-optimization.
INFO [2022-04-29 18:55:24] Optimized purity: 0.65
INFO [2022-04-29 18:55:25] Fitting variants for purity 0.41, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 18:55:58] Fitting variants for purity 0.27, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 18:56:05] Poor goodness-of-fit (0.418). Skipping post-optimization.
INFO [2022-04-29 18:56:05] Optimized purity: 0.59
INFO [2022-04-29 18:56:07] Rare karyotype solution. Skipping post-optimization.
INFO [2022-04-29 18:56:07] Optimized purity: 0.54
INFO [2022-04-29 18:58:56] Fitting variants for purity 0.47, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 18:59:23] Fitting variants for purity 0.27, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 18:59:33] Fitting variants for purity 0.42, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:00:00] Fitting variants for purity 0.28, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:02:52] Fitting variants for purity 0.48, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:03:31] Fitting variants for purity 0.28, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 19:03:42] Fitting variants for purity 0.43, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:03:57] Fitting variants for purity 0.29, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:06:47] Fitting variants for purity 0.49, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:07:38] Fitting variants for purity 0.29, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 19:07:47] Fitting variants for purity 0.44, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:07:53] Fitting variants for purity 0.30, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:10:42] Fitting variants for purity 0.51, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:11:33] Fitting variants for purity 0.31, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 19:11:42] Fitting variants for purity 0.46, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:11:51] Fitting variants for purity 0.32, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:14:39] Fitting variants for purity 0.52, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:15:29] Fitting variants for purity 0.32, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 19:15:38] Fitting variants for purity 0.47, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:15:52] Fitting variants for purity 0.33, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:18:38] Fitting variants for purity 0.53, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:19:34] Fitting variants for purity 0.33, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 19:19:46] Fitting variants for purity 0.48, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:20:09] Fitting variants for purity 0.34, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:23:12] Fitting variants for purity 0.54, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:24:11] Fitting variants for purity 0.34, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-04-29 19:24:18] Fitting variants for purity 0.49, tumor ploidy 3.79 and contamination 0.01.
INFO [2022-04-29 19:24:44] Fitting variants for purity 0.35, tumor ploidy 2.91 and contamination 0.01.
INFO [2022-04-29 19:27:51] Optimized purity: 0.46
INFO [2022-04-29 19:28:46] Optimized purity: 0.28
INFO [2022-04-29 19:28:52] Optimized purity: 0.41
INFO [2022-04-29 19:29:29] Optimized purity: 0.30
INFO [2022-04-29 19:29:30] Done.
INFO [2022-04-29 19:29:30] ------------------------------------------------------------
INFO [2022-04-29 19:29:45] Generating output files...


The corresponding plots for the best selected solution:

![image](https://user-images.githubusercontent.com/75229061/166301825-02e26da2-59e2-4c72-bbbe-b14992f835ef.png)

In contrast, this is the log file for a sample that had a very noisy VAF plot (most samples):

INFO [2022-04-29 14:43:11] ------------------------------------------------------------
INFO [2022-04-29 14:43:11] PureCN 2.0.2
INFO [2022-04-29 14:43:11] ------------------------------------------------------------
INFO [2022-04-29 14:43:11] Arguments: -normal.coverage.file  -tumor.coverage.file tumor.cnr -log.ratio  -seg.file tumors.seg -vcf.file filtered.vcf -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid tumor -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -log.file tumor.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-04-29 14:43:11] Using BiocParallel for parallel optimization.
INFO [2022-04-29 14:43:11] Loading coverage files...
INFO [2022-04-29 14:43:20] Provided log2-ratio looks too noisy, using segmentation only.
INFO [2022-04-29 14:43:20] Mean coverages: chrX: 55.73, chrY: 4.52, chr1-22: 46.94.
INFO [2022-04-29 14:43:20] Mean coverages: chrX: 55.73, chrY: 4.52, chr1-22: 46.94.
INFO [2022-04-29 14:43:22] Using 334337 intervals (207929 on-target, 126408 off-target).
INFO [2022-04-29 14:43:22] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-04-29 14:43:22] Mean off-target bin size: 20022
INFO [2022-04-29 14:43:22] Loading VCF...
INFO [2022-04-29 14:43:28] Found 99816 variants in VCF file.
INFO [2022-04-29 14:43:29] Removing 1463 triallelic sites.
WARN [2022-04-29 14:43:29] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2022-04-29 14:43:30] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2022-04-29 14:43:30] 69124 (70.3%) variants annotated as likely germline (DB INFO flag).
WARN [2022-04-29 14:43:35] Found 7879 variants with missing allelic fraction starting with 1:173730_C/A. Removing them.
INFO [2022-04-29 14:43:36] tumor is tumor in VCF file.
INFO [2022-04-29 14:43:37] 311 homozygous and 670 heterozygous variants on chrX.
INFO [2022-04-29 14:43:37] Sex from VCF: F (Fisher's p-value: 0, odds-ratio: 1.28).
WARN [2022-04-29 14:43:37] Sex mismatch of coverage and VCF. Could be because of noisy data, contamination, loss of chrY or a mis-alignment of coverage and VCF.
INFO [2022-04-29 14:43:38] Detected MuTect2 VCF.
INFO [2022-04-29 14:43:39] Removing 39428 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-04-29 14:43:40] Removing 26567 non heterozygous (in matched normal) germline SNPs.
INFO [2022-04-29 14:43:41] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-04-29 14:43:42] Removing 2015 variants with AF < 0.030 or AF >= 1.000 or less than 4 supporting reads or depth < 15.
WARN [2022-04-29 14:43:42] Variant ids contain NAs at filter step BQ.
INFO [2022-04-29 14:43:42] Removing 0 low quality variants with BQ < 25.
INFO [2022-04-29 14:43:42] Total size of targeted genomic region: 62.34Mb (81.46Mb with 50bp padding).
INFO [2022-04-29 14:43:43] 9.3% of targets contain variants.
INFO [2022-04-29 14:43:43] Removing 740 variants outside intervals.
INFO [2022-04-29 14:43:43] Found SOMATIC annotation in VCF.
INFO [2022-04-29 14:43:43] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2022-04-29 14:43:44] Found SOMATIC annotation in VCF. Setting mapping bias to 0.983.
INFO [2022-04-29 14:43:44] Excluding 2802 novel or poor quality variants from segmentation.
INFO [2022-04-29 14:43:44] Sample sex: M
INFO [2022-04-29 14:43:44] Segmenting data...
INFO [2022-04-29 14:43:44] Loaded provided segmentation file batch1_tumors.seg (format DNAcopy).
INFO [2022-04-29 14:43:44] Re-centering provided segment means (offset 0.0061).
INFO [2022-04-29 14:43:44] Setting prune.hclust.h parameter to 0.100000.
INFO [2022-04-29 14:43:45] Found 36 segments with median size of 61.20Mb.
INFO [2022-04-29 14:43:45] Using 21724 variants.
INFO [2022-04-29 14:43:47] Mean standard deviation of log-ratios: 0.40 (MAPD: 0.00)
INFO [2022-04-29 14:43:47] Mean standard deviation of on-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2022-04-29 14:43:47] Mean standard deviation of off-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2022-04-29 14:43:47] 2D-grid search of purity and ploidy...
INFO [2022-04-29 14:44:35] Local optima: 0.15/2.1, 0.15/1.9, 0.23/2.6, 0.29/3, 0.17/2, 0.27/2,
0.62/4.4, 0.55/3.6, 0.52/2, 0.85/3, 0.78/2, 0.58/1.4
INFO [2022-04-29 14:44:35] Testing local optimum 1/12 at purity 0.15 and total ploidy 2.10...
INFO [2022-04-29 14:44:35] Testing local optimum 2/12 at purity 0.15 and total ploidy 1.90...
INFO [2022-04-29 14:44:35] Testing local optimum 3/12 at purity 0.23 and total ploidy 2.60...
INFO [2022-04-29 14:44:35] Testing local optimum 4/12 at purity 0.29 and total ploidy 3.00...
INFO [2022-04-29 14:44:35] Testing local optimum 5/12 at purity 0.17 and total ploidy 2.00...
INFO [2022-04-29 14:44:35] Testing local optimum 6/12 at purity 0.27 and total ploidy 2.00...
INFO [2022-04-29 14:44:35] Testing local optimum 7/12 at purity 0.62 and total ploidy 4.40...
INFO [2022-04-29 14:44:36] Testing local optimum 8/12 at purity 0.55 and total ploidy 3.60...
INFO [2022-04-29 14:44:36] Testing local optimum 9/12 at purity 0.52 and total ploidy 2.00...
INFO [2022-04-29 14:44:36] Testing local optimum 10/12 at purity 0.85 and total ploidy 3.00...
INFO [2022-04-29 14:44:36] Testing local optimum 11/12 at purity 0.78 and total ploidy 2.00...
INFO [2022-04-29 14:44:36] Testing local optimum 12/12 at purity 0.58 and total ploidy 1.40...
INFO [2022-04-29 14:44:59] Recalibrating log-ratios...
INFO [2022-04-29 14:44:59] Testing local optimum 12/12 at purity 0.58 and total ploidy 1.40...
INFO [2022-04-29 14:45:25] Recalibrating log-ratios...
INFO [2022-04-29 14:45:25] Testing local optimum 12/12 at purity 0.58 and total ploidy 1.40...
INFO [2022-04-29 14:45:45] Recalibrating log-ratios...
INFO [2022-04-29 14:45:45] Testing local optimum 12/12 at purity 0.58 and total ploidy 1.40...
INFO [2022-04-29 14:46:02] Skipping 2 solutions that converged to the same optima.
INFO [2022-04-29 14:46:02] Skipping 1 solutions exceeding max.non.clonal (0.20): 0.51/1.29 (purity/tumor ploidy)
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 2/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 3/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 4/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 5/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 7/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 8/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 9/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 10/12...
INFO [2022-04-29 14:46:03] Fitting variants with beta model for local optimum 11/12...
INFO [2022-04-29 14:46:13] Fitting variants for purity 0.23, tumor ploidy 4.68 and contamination 0.01.
INFO [2022-04-29 14:46:13] Fitting variants for purity 0.31, tumor ploidy 5.61 and contamination 0.01.
INFO [2022-04-29 14:46:14] Fitting variants for purity 0.64, tumor ploidy 6.00 and contamination 0.01.
INFO [2022-04-29 14:46:14] Fitting variants for purity 0.17, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 14:46:14] Fitting variants for purity 0.20, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 14:46:15] Fitting variants for purity 0.32, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 14:46:15] Fitting variants for purity 0.57, tumor ploidy 4.98 and contamination 0.01.
INFO [2022-04-29 14:46:15] Fitting variants for purity 0.65, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 14:46:16] Fitting variants for purity 0.59, tumor ploidy 2.17 and contamination 0.01.
INFO [2022-04-29 14:49:16] Rare karyotype solution. Skipping post-optimization.
INFO [2022-04-29 14:49:16] Optimized purity: 0.23
INFO [2022-04-29 14:49:26] Rare karyotype solution. Skipping post-optimization.
INFO [2022-04-29 14:49:26] Optimized purity: 0.31
INFO [2022-04-29 14:49:32] Fitting variants for purity 0.15, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 14:49:37] Rare karyotype solution. Skipping post-optimization.
INFO [2022-04-29 14:49:37] Optimized purity: 0.64
INFO [2022-04-29 14:49:44] Fitting variants for purity 0.16, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 14:49:47] Poor goodness-of-fit (0.639). Skipping post-optimization.
INFO [2022-04-29 14:49:47] Optimized purity: 0.59
INFO [2022-04-29 14:49:58] Fitting variants for purity 0.61, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 14:49:59] Fitting variants for purity 0.28, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 14:50:02] Rare karyotype solution. Skipping post-optimization.
INFO [2022-04-29 14:50:02] Optimized purity: 0.57
INFO [2022-04-29 14:52:29] Fitting variants for purity 0.16, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 14:52:55] Fitting variants for purity 0.62, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 14:52:56] Fitting variants for purity 0.17, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 14:52:58] Fitting variants for purity 0.29, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 14:55:25] Fitting variants for purity 0.18, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 14:55:56] Fitting variants for purity 0.30, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 14:55:59] Fitting variants for purity 0.63, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 14:56:09] Fitting variants for purity 0.18, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 14:58:22] Fitting variants for purity 0.19, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 14:58:54] Fitting variants for purity 0.31, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 14:59:00] Fitting variants for purity 0.64, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 14:59:22] Fitting variants for purity 0.19, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 15:01:18] Fitting variants for purity 0.20, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 15:01:51] Fitting variants for purity 0.33, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 15:02:01] Fitting variants for purity 0.66, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 15:02:32] Fitting variants for purity 0.21, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 15:04:14] Fitting variants for purity 0.21, tumor ploidy 2.68 and contamination 0.01.
INFO [2022-04-29 15:04:50] Fitting variants for purity 0.34, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 15:05:06] Fitting variants for purity 0.67, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 15:05:51] Fitting variants for purity 0.22, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 15:07:18] Optimized purity: 0.18
INFO [2022-04-29 15:07:48] Fitting variants for purity 0.35, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 15:08:11] Fitting variants for purity 0.68, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 15:09:03] Fitting variants for purity 0.23, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 15:10:46] Fitting variants for purity 0.36, tumor ploidy 1.98 and contamination 0.01.
INFO [2022-04-29 15:11:19] Fitting variants for purity 0.69, tumor ploidy 3.14 and contamination 0.01.
INFO [2022-04-29 15:12:12] Fitting variants for purity 0.24, tumor ploidy 1.87 and contamination 0.01.
INFO [2022-04-29 15:13:44] Optimized purity: 0.28
INFO [2022-04-29 15:14:24] Optimized purity: 0.61
INFO [2022-04-29 15:15:18] Optimized purity: 0.21
INFO [2022-04-29 15:15:18] Done.
INFO [2022-04-29 15:15:18] ------------------------------------------------------------
INFO [2022-04-29 15:15:30] Generating output files...


The corresponding plots for the best selected solution:

![image](https://user-images.githubusercontent.com/75229061/166306861-673ed6bb-b3e8-4e96-bdb7-238bd8b72bcb.png)


What do you think could be driving this noise in the BAF plot? Is it simply coverage is too low? Sample contamination? Should I be concerned about the validity of the copy number inference?

Also, as an aside, what is the difference between the navy-colored and black-colored segments in the middle log2 ratio plot?

Thank you
",dst53,https://github.com/lima1/PureCN/issues/233
I_kwDOBew4us5JGBPt,Interpretation of results,CLOSED,2022-05-05T07:52:38Z,2022-05-10T07:36:37Z,2022-05-10T07:36:37Z,"HI,
Could you please help me to understand the output result for SNV below?
![image](https://user-images.githubusercontent.com/92018021/166881806-e4984105-01c8-4849-8efe-e645e6bd4eb3.png)
Total CN is 2, major and minor allele should be 1, but multiplicity is 2, and is LOH  region? The purity predicted by pureCN is 32% and it has a POOR GOF (72%).

Thank you for help!
",maxanes,https://github.com/lima1/PureCN/issues/234
I_kwDOBew4us5Jemb6,user error due to invalid input data or parameters,CLOSED,2022-05-11T14:37:24Z,2022-05-25T15:52:49Z,2022-05-25T15:52:48Z,"**Describe the issue**
I am currently running the PureCN 2.3.0 with an input VCF file from Mutect2 (GATK v4.2.6.1), and the job was halted due to an error message below.

**To Reproduce**
Copy and paste your complete command line arguments from PureCN.R. If possible and potentially relevant, also copy the output of NormalDB.R and Coverage.R.

Rscript /data/anaconda3/envs/DNA-seq/lib/R/library/PureCN/extdata/PureCN.R   --out /data/projects/BC_Tan/GDC/PureCN/output   --tumor /data/projects/BC_Tan/GDC/PureCN/TN21-146507_fastqtosam.interleaved_coverage_loess.txt.gz   --sampleid TN21-146507   --vcf /data/projects/BC_Tan/GDC/TN21-146507.realignment-filtered.vcf    --normaldb /data/projects/BC_Tan/GDC/normal/normalDB_agilent_v6_hg38.rds   --intervals /data/projects/BC_Tan/GDC/PureCN/baits_hg38_intervals.txt   --mapping-bias-file /data/projects/BC_Tan/GDC/normal/mapping_bias_agilent_v6_hg38.rds   --fun-segmentation PSCBS   --genome hg38 --force   --post-optimize --seed 123


**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
Please copy and paste the log file (Sampleid.log) of a representative example
[1] ""/data/projects/BC_Tan/GDC/PureCN""
INFO [2022-05-11 10:25:19] Loading PureCN 2.3.0...
INFO [2022-05-11 10:25:25] Allosome coverage very low, cannot determine sex.
INFO [2022-05-11 10:25:25] Sample sex: NA
INFO [2022-05-11 10:25:26] ------------------------------------------------------------
INFO [2022-05-11 10:25:26] PureCN 2.3.0
INFO [2022-05-11 10:25:26] ------------------------------------------------------------
INFO [2022-05-11 10:25:26] Arguments: -tumor.coverage.file /data/projects/BC_Tan/GDC/PureCN/TN21-146507_fastqtosam.interleaved_coverage_l
oess.txt.gz -log.ratio  -seg.file  -vcf.file /data/projects/BC_Tan/GDC/TN21-146507.realignment-filtered.vcf -genome hg38 -sex ? -args.set
PriorVcf 6 -args.setMappingBiasVcf /data/projects/BC_Tan/GDC/normal/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args
.segmentation 0.005,NULL, -sampleid TN21-146507 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ra
tio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /data/projects/BC_Tan/GDC/PureCN/baits_hg38_intervals.txt -min.lo
gr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosm
ic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -BPPARAM  -log.file /data/projects/BC_Tan/GDC/PureCN/output.log -normal.cove
rage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heur
istics <data>
INFO [2022-05-11 10:25:26] Loading coverage files...
INFO [2022-05-11 10:25:30] Mean target coverages: 20X (tumor) 1X (normal).
WARN [2022-05-11 10:25:30] Large difference in coverage of tumor and normal.
WARN [2022-05-11 10:25:31] Large potential mis-calibration of on- and off-target log2 ratios: 0.67
INFO [2022-05-11 10:25:31] Allosome coverage very low, cannot determine sex.
INFO [2022-05-11 10:25:31] Mean coverages: chrX: 1.42, chrY: 0.03, chr1-22: 1.10.
WARN [2022-05-11 10:25:31] Sex tumor/normal mismatch: tumor =
INFO [2022-05-11 10:25:46] Removing 138713 intervals with missing log.ratio.
INFO [2022-05-11 10:25:46] Removing 63 low/high GC targets.
INFO [2022-05-11 10:25:47] Removing 8735 intervals excluded in normalDB.
INFO [2022-05-11 10:25:47] Removing 60282 intervals with low total coverage in normal (< 150.00 reads).
INFO [2022-05-11 10:25:47] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2022-05-11 10:25:47] Removing 5800 low count (< 100 total reads) intervals.
INFO [2022-05-11 10:25:47] Removing 862 low coverage (< 0.0015X) intervals.
INFO [2022-05-11 10:25:47] Using 14329 intervals (0 on-target, 14329 off-target).
INFO [2022-05-11 10:25:47] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-05-11 10:25:47] Mean off-target bin size: 129092
INFO [2022-05-11 10:25:47] Loading VCF...
INFO [2022-05-11 10:25:48] Found 3249 variants in VCF file.
INFO [2022-05-11 10:25:48] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-05-11 10:25:48] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele fre
quency > 0.001000 instead.
INFO [2022-05-11 10:25:49] 0 (0.0%) variants annotated as likely germline (DB INFO flag).
FATAL [2022-05-11 10:25:49] VCF either contains no germline variants or variants are not properly

FATAL [2022-05-11 10:25:49] annotated.

FATAL [2022-05-11 10:25:49]

FATAL [2022-05-11 10:25:49] This is most likely a user error due to invalid input data or

FATAL [2022-05-11 10:25:49] parameters (PureCN 2.3.0).

Error: VCF either contains no germline variants or variants are not properly
annotated.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.3.0).
In addition: Warning messages:
1: In (function (fmt, ...)  :
  3 arguments not used by format 'Sex tumor/normal mismatch: tumor = '
2: In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Execution halted


**B-allele frequency plot**
Please take a screenshot of the B-allele frequency plot of the maximum likelihood solution
(Sampleid.pdf).
NA

**Session Info**
Please start R, type sessionInfo() and paste the output.
R version 4.1.3 (2022-03-10)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: Ubuntu 14.04.5 LTS

Matrix products: default
BLAS/LAPACK: /data/anaconda3/envs/DNA-seq/lib/libopenblasp-r0.3.20.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_4.1.3
",paulhtyang,https://github.com/lima1/PureCN/issues/235
I_kwDOBew4us5KKRbd,PureCN with CNVkit and Mutect2 output - Cannot find valid purity/ploidy solution,CLOSED,2022-05-22T10:01:26Z,2022-06-07T21:29:09Z,2022-06-07T21:29:09Z,"**Describe the issue**
Hi!
When I run PureCN on my WES data, I meet errors in a sample. The input data of PureCN.R were from cnvkits and mutect2.
PurnCN was not working with or without the argument `--min-fraction-offtarget`, in which the log files were the same.
The segments on chromosomes XY were removed in the seg file from cnvkit2.

---
**To Reproduce**
Command-line arguments from NormalDB.R:
```
Rscript /public/home/hpc184606033/markusriester-purecn/opt/PureCN/NormalDB.R \
  --out-dir $OUT_REF --normal-panel $INPUT_REF \
  --assay wes  --genome hg38 --force
```

Command-line arguments from PureCN.R:
```
Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID  \
    --sampleid $SAMPLEID \
    --tumor /public/home/hpc184606033/PureCN/cnvkit2/${SAMPLEID}_CA_bqsr.cnr \
    --seg-file /public/home/hpc184606033/PureCN/cnvkit2/filter/segment/${SAMPLEID}.segment \
    --mapping-bias-file /public/home/hpc184606033/PureCN/purecn_reference_files/mapping_bias_wes_hg38.rds \
    --vcf /public/home/hpc184606033/PureCN/mutect/${SAMPLEID}_somatic.vcf.gz \
    --genome hg38 \
    --min-fraction-offtarget 0.95 \
    --fun-segmentation Hclust --cores 10 \
    --force --post-optimize --seed 123
```

---
**Log file**
```
INFO [2022-05-22 16:53:07] ------------------------------------------------------------
INFO [2022-05-22 16:53:07] PureCN 2.0.2
INFO [2022-05-22 16:53:07] ------------------------------------------------------------
INFO [2022-05-22 16:53:07] Arguments: -normal.coverage.file  -tumor.coverage.file /public/home/hpc184606033/PureCN/cnvkit2/zhangwenxi_CA_bqsr.cnr -log.ratio  -seg.file /public/home/hpc184606033/PureCN/cnvkit2/filter/segment/zhangwenxi.segment -vcf.file /public/home/hpc184606033/PureCN/mutect/zhangwenxi_somatic.vcf.gz -normalDB  -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /public/home/hpc184606033/PureCN/purecn_reference_files/mapping_bias_wes_hg38.rds -args.filterIntervals 100,0.95 -args.segmentation 0.005,NULL, -sampleid zhangwenxi -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -log.file /public/home/hpc184606033/PureCN/results_PureCN//zhangwenxi.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-05-22 16:53:07] Using BiocParallel for parallel optimization.
INFO [2022-05-22 16:53:07] Loading coverage files...
WARN [2022-05-22 16:53:09] Coverage data contains single nucleotide intervals.
INFO [2022-05-22 16:53:11] Found log2-ratio in tumor coverage data.
WARN [2022-05-22 16:53:11] log2-ratio contains outliers < -8, ignoring them...
INFO [2022-05-22 16:53:12] Mean coverages: chrX: 108.15, chrY: 54.81, chr1-22: 128.62.
INFO [2022-05-22 16:53:12] Mean coverages: chrX: 108.15, chrY: 54.81, chr1-22: 128.62.
INFO [2022-05-22 16:53:12] Removing 27 intervals with missing log.ratio.
INFO [2022-05-22 16:53:12] Using 290997 intervals (251637 on-target, 39360 off-target).
INFO [2022-05-22 16:53:12] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-05-22 16:53:12] Mean off-target bin size: 62587
INFO [2022-05-22 16:53:12] Loading VCF...
INFO [2022-05-22 16:53:14] Found 40356 variants in VCF file.
INFO [2022-05-22 16:53:14] Removing 870 triallelic sites.
WARN [2022-05-22 16:53:14] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2022-05-22 16:53:15] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2022-05-22 16:53:15] 36283 (91.9%) variants annotated as likely germline (DB INFO flag).
WARN [2022-05-22 16:53:16] Found 37 variants with missing allelic fraction starting with chr1:2194700_C/G. Removing them.
INFO [2022-05-22 16:53:16] zhangwenxi_CA is tumor in VCF file.
INFO [2022-05-22 16:53:17] 491 homozygous and 66 heterozygous variants on chrX.
INFO [2022-05-22 16:53:17] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 11.21).
INFO [2022-05-22 16:53:17] Detected MuTect2 VCF.
INFO [2022-05-22 16:53:17] Removing 8049 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-05-22 16:53:17] Removing 16072 non heterozygous (in matched normal) germline SNPs.
INFO [2022-05-22 16:53:18] Removing 86 variants with AF < 0.030 or AF >= 1.000 or less than 4 supporting reads or depth < 15.
WARN [2022-05-22 16:53:18] Variant ids contain NAs at filter step BQ.
INFO [2022-05-22 16:53:18] Removing 0 low quality variants with BQ < 25.
INFO [2022-05-22 16:53:18] Total size of targeted genomic region: 46.80Mb (67.30Mb with 50bp padding).
INFO [2022-05-22 16:53:19] 6.0% of targets contain variants.
INFO [2022-05-22 16:53:20] Removing 9 variants outside intervals.
INFO [2022-05-22 16:53:20] Found SOMATIC annotation in VCF.
INFO [2022-05-22 16:53:20] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2022-05-22 16:53:20] Found SOMATIC annotation in VCF. Setting mapping bias to 0.983.
INFO [2022-05-22 16:53:20] Loading mapping bias file mapping_bias_wes_hg38.rds...
INFO [2022-05-22 16:53:40] Found 28615620 variants in mapping bias file.
INFO [2022-05-22 16:53:45] Imputing mapping bias for 74 variants...
INFO [2022-05-22 16:54:05] Excluding 438 novel or poor quality variants from segmentation.
INFO [2022-05-22 16:54:05] Excluding 74 variants not in pool of normals from segmentation.
INFO [2022-05-22 16:54:05] Sample sex: M
INFO [2022-05-22 16:54:05] Segmenting data...
INFO [2022-05-22 16:54:05] Loaded provided segmentation file zhangwenxi.segment (format DNAcopy).
WARN [2022-05-22 16:54:05] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
INFO [2022-05-22 16:54:05] Re-centering provided segment means (offset 0.0369).
INFO [2022-05-22 16:54:07] Setting prune.hclust.h parameter to 0.200000.
INFO [2022-05-22 16:54:08] Found 1786 segments with median size of 0.42Mb.
INFO [2022-05-22 16:54:08] Using 15233 variants.
INFO [2022-05-22 16:54:11] Mean standard deviation of log-ratios: 0.28 (MAPD: 0.21)
INFO [2022-05-22 16:54:11] Mean standard deviation of on-target log-ratios only: 0.26 (MAPD: 0.19)
INFO [2022-05-22 16:54:11] Mean standard deviation of off-target log-ratios only: 0.37 (MAPD: 0.33)
INFO [2022-05-22 16:54:11] 2D-grid search of purity and ploidy...
INFO [2022-05-22 16:54:51] Local optima: 0.27/2
INFO [2022-05-22 16:54:51] Testing local optimum 1/1 at purity 0.27 and total ploidy 2.00...
INFO [2022-05-22 16:55:05] Recalibrating log-ratios...
INFO [2022-05-22 16:55:05] Testing local optimum 1/1 at purity 0.27 and total ploidy 2.00...
INFO [2022-05-22 16:55:18] Recalibrating log-ratios...
INFO [2022-05-22 16:55:18] Testing local optimum 1/1 at purity 0.27 and total ploidy 2.00...
INFO [2022-05-22 16:55:30] Recalibrating log-ratios...
INFO [2022-05-22 16:55:30] Testing local optimum 1/1 at purity 0.27 and total ploidy 2.00...
INFO [2022-05-22 16:55:42] Skipping 1 solutions exceeding max.non.clonal (0.20): 0.27/1.45 (purity/tumor ploidy)
WARN [2022-05-22 16:55:42] Could not find valid purity and ploidy solution.
```
---
Any suggestions might be appreciated.
Thanks,
Lin
",flower1996,https://github.com/lima1/PureCN/issues/236
I_kwDOBew4us5KR_S0,Pon of normals (NORMAL_PANEL),CLOSED,2022-05-24T09:01:47Z,2023-08-21T21:43:54Z,2022-06-07T21:29:26Z,"Hello Markus,

How create normal panel from PureCN ?? In the description need only the AD but mutect2 and CreateSomaticPanelOfNormals has other format:

chr16	61946583	.	AAT	TAT,A	.	.	BETA=1.00,1.00;FRACTION=1.00
chr16	61946587	.	G	C,GTCTGC	.	.	BETA=1.00,1.00;FRACTION=1.00
chr16	61946641	.	G	C,*	.	.	BETA=1.00,1.00;FRACTION=1.00

Is correct if i used mutect2 in tumor-only mode with normal samples and then use Mergevcf with min of 5 samples ?? 
",monolo90,https://github.com/lima1/PureCN/issues/237
I_kwDOBew4us5KekdO,Question,CLOSED,2022-05-26T12:47:41Z,2023-05-01T15:00:25Z,2023-05-01T15:00:25Z,"Hi,

May I ask you for some advice, in cases when I see that the selected model by pureCN is off e.g, lower purity than expected or mutations expected to be clonal are subclonal, or in tricky samples like FFPE, or lower coverage...
What are the most important parameters from the output that I should consider when selecting a new model that would fit more? GoF?

Thank you.
",maxanes,https://github.com/lima1/PureCN/issues/238
I_kwDOBew4us5Kn4TV,Improve sensitivity of low purity amplification calling pipeline,OPEN,2022-05-29T19:11:32Z,2022-05-29T19:11:32Z,,"- [ ] gene-level summary not necessarily best way of doing it. check if we can safely extend to neighboring baits. maybe start 500kb left and right, iteratively shorten to gene-level
- [ ] include allelic imbalance if SNPs with high confidence beta-bin fit are 

",lima1,https://github.com/lima1/PureCN/issues/239
I_kwDOBew4us5LQm5s,Inclusion/exclusion of genes in CSV,CLOSED,2022-06-07T02:36:34Z,2022-07-02T15:00:28Z,2022-07-02T15:00:28Z,"Regarding the genes CSV output file, I had assumed that all genes (as defined in the interval file) were present, but on closer inspection I realise that's not the case. My CSV output files contain most but not all genes, and it is not a consistent set of genes that are missing. I thought it might have something to do with coverage, but for the samples I've checked there appears to be good coverage for the ""missing"" genes (>200X). Is there some criteria for inclusion or exclusion from the output CSV?

Thanks.",jje42,https://github.com/lima1/PureCN/issues/240
I_kwDOBew4us5LdUFA,How are copy number thresholds defined for amplifications,CLOSED,2022-06-09T11:14:53Z,2023-05-01T15:02:39Z,2023-05-01T15:02:39Z,"Hi, I would like to know why arbitrary thresholds of 6/7 were selected to label amplifications - was an internal comparison performed to define these thresholds? Is it safe to consider copy numbers > 3 as gains

Thanks",rbell-img,https://github.com/lima1/PureCN/issues/241
I_kwDOBew4us5L2sUB,NormalDB stalling,CLOSED,2022-06-15T19:10:43Z,2022-06-16T07:41:44Z,2022-06-16T07:41:44Z,"**NormalDB stalls while trying to process normal vcf**
Hi Markus, I've been trying to regenerate a normalDB for my exomes for weeks now but it always stall at one specific part. I'm wondering if there is a way to speed up normalDB generation (it is currently only using one core) and if you know of any possible reason why it would stall here.


**To Reproduce**
`Rscript /projects/rmorin_scratch/conda_environments/3dff324bbbf34c5d73f8d8432add6757/lib/R/library/PureCN/extdata/NormalDB.R --out-dir results/cnvkit-1.0_masked/pureCN/02-pon/ --normal-panel results/cnvkit-1.0_masked/pureCN/02-pon/idt_database/  --assay idt --genome hg19 --force --coverage-files results/cnvkit-1.0_masked/pureCN/03-coverage/idt/cov_list.txt`

After running for around 15 hours or so, it consistently gets stuck here:

`INFO [2022-06-14 23:24:09] Clustering beta binomial fits...
INFO [2022-06-14 23:24:20] Assigning (907/50000) variants a clustered beta binomal fit.
INFO [2022-06-14 23:24:30] Processing variants 10450001 to 10500000...
INFO [2022-06-14 23:24:30] Position 14:81161866
INFO [2022-06-14 23:26:28] Clustering beta binomial fits...
INFO [2022-06-14 23:26:34] Assigning (588/50000) variants a clustered beta binomal fit.
INFO [2022-06-14 23:26:44] Processing variants 10500001 to 10550000...
INFO [2022-06-14 23:29:19] Clustering beta binomial fits...
INFO [2022-06-14 23:29:28] Assigning (764/50000) variants a clustered beta binomal fit.
INFO [2022-06-14 23:29:39] Processing variants 10550001 to 10600000...
INFO [2022-06-14 23:32:35] Clustering beta binomial fits...`

This same script has worked for my other exome set using the Agilent baits. The only difference between the two is that I have only 12 normals for Agilent and 58 normals for IDT. In terms of the total variants called for each, the Agilent had 9019778 and IDT had 14273459. Is this potentially just from a memory issue?

I could try to reduce the total number of normals or setting a max limit of normals used in the vcf generation, but I was wondering if there was a simpler solution to this.

Thank you!",Jwong684,https://github.com/lima1/PureCN/issues/242
I_kwDOBew4us5MDQ8t,Error: Only tiny segments.,CLOSED,2022-06-19T01:20:16Z,2022-07-02T14:59:34Z,2022-07-02T14:59:34Z,"Thanks a lot for this powerful tool, can you take some time to look at this error
![image](https://user-images.githubusercontent.com/50854682/174462018-0983dfcf-c92b-499e-bd36-0af6c32dafa2.png)
",asmlgkj,https://github.com/lima1/PureCN/issues/243
I_kwDOBew4us5Mp9b2,CRAM compatibility,OPEN,2022-06-27T16:41:52Z,2022-06-27T17:52:07Z,,"Hi Markus,

More of a general question - I was wondering if purecn would eventually be CRAM compatible? 

Thank you!
",Jwong684,https://github.com/lima1/PureCN/issues/244
I_kwDOBew4us5MwZ4F,NormalDB.R not accepting panel of normals,CLOSED,2022-06-28T19:00:17Z,2022-07-02T14:59:08Z,2022-07-02T14:59:08Z,"Hello,

I am trying to build a normal database for coverage normalization using large/public panels of normals, but I am receiving an error stating my files contain only a single sample. This question may be naive, but how does PureCN/NormalDB.R determine if the vcf contains only one sample, and could this error be coming from simply a formatting issue? 

1. 1000 Genome Project: somatic-hg38_1000g_pon.hg38.vcf.gz
- Described here https://gatk.broadinstitute.org/hc/en-us/articles/360035890631-Panel-of-Normals-PON-

3. NCI GCD: gatk4_mutect2_4136_pon.vcf.gz
- Described here https://gdc.cancer.gov/about-data/gdc-data-processing/gdc-reference-files

Thank you very much for any and all help
Jack

Command Line Log

$ Rscript $PURECN/NormalDB.R \
> --out-dir $REF \
> --coverage-files $PURECN_INTCOV/Normal_Coverages \
> --normal-panel $REF/somatic-hg38_1000g_pon.hg38.vcf.gz \
> --genome hg38
INFO [2022-06-28 11:47:53] Loading PureCN 2.2.0...
INFO [2022-06-28 11:47:53] Creating mapping bias database.
[W::hts_idx_load2] The index file is older than the data file: /media/seagate/jfreeland/PureCN/References/somatic-hg38_1000g_pon.hg38.vcf.gz.tbi
INFO [2022-06-28 11:47:55] Processing variants 1 to 50000...
FATAL [2022-06-28 11:47:55] The normal.panel.vcf.file contains only a single sample. 

FATAL [2022-06-28 11:47:55]  

FATAL [2022-06-28 11:47:55] This is most likely a user error due to invalid input data or 

FATAL [2022-06-28 11:47:55] parameters (PureCN 2.2.0). 

Error: The normal.panel.vcf.file contains only a single sample.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.2.0).
Execution halted

R Version: R version 4.2.0",jfreeland01,https://github.com/lima1/PureCN/issues/245
I_kwDOBew4us5NqEPy,Purecn 2.2.0 Coverage.R issues,CLOSED,2022-07-13T04:04:11Z,2022-10-10T14:17:46Z,2022-10-10T14:17:46Z,"Hi, 

I am trying to run Coverage.R from the latest Purecn docker.
The command that I am running is 
```
Rscript $PURECN/Coverage.R --out-dir normaldb/ --bam bam.list --intervals xgen-exome-research-panel-probesbe255a1532796e2eaa53ff00001c1b3c.hg38.bed.gz --cores 30
```
The error I got is below:
```
INFO [2022-07-13 03:51:54] Loading PureCN 2.2.0...
INFO [2022-07-13 03:51:54] Using BiocParallel MulticoreParam backend with 30 cores.
INFO [2022-07-13 03:51:54] Processing /mnt/SCRATCH/purecn/purecn_coverage/1c854b02-e522-4db8-b223-a4232639a8e7_wxs_gdc_realn_coverage.txt.gz...

INFO [2022-07-13 03:51:55] Processing /mnt/SCRATCH/purecn/purecn_coverage/7a310be2-73f3-49db-b1c1-7b887fbc11d4_wxs_gdc_realn_coverage.txt.gz...

INFO [2022-07-13 03:51:55] Processing /mnt/SCRATCH/purecn/purecn_coverage/8a4d7bd5-3943-4121-a566-ec33c99f5a3a_wxs_gdc_realn_coverage.txt.gz...

INFO [2022-07-13 03:51:54] Processing /mnt/SCRATCH/purecn/purecn_coverage/11748118-4168-4894-b7ff-b9106ec56614_wxs_gdc_realn_coverage.txt.gz...

Stop worker failed with the error: wrong args for environment subassignment
Error: BiocParallel errors
  2 remote errors, element index: 1, 2
  9 unevaluated and other errors
  first remote error:
Error in asMethod(object): The character vector to convert to a GRanges object must contain
  strings of the form ""chr:start-end"" or ""chr:start-end:strand"", with end
  >= start - 1, or ""chr:pos"" or ""chr:pos:strand"". For example:
  ""chr1:2501-2900"", ""chr1:2501-2900:+"", or ""chr1:740"". Note that "".."" is
  a valid alternate start/end separator. Strand can be ""+"", ""-"", ""*"", or
  missing.
Execution halted
```
It might suggest that my baits interval has invalid format against Purecn. 
Here is the format from my bait file.
```
chr1    69069   69189   469_378975_79501(OR4F5)_1_1     0       +
```
If it is the issue of format, I'm wondering if we have some documents on the format of intervals, and if it's not, do you have insight what might cause the issue?

---------------
After the failure, I tried to run GATK4 DepthOfCoverage and then convert the output by Coverage.R. I am able to run the GATK4 and get the `sample_interval_summary`. However, I'm unable to convert it by the `Coverage.R`.
Here is the command I used:
```
Rscript $PURECN/Coverage.R --out-dir purecn_coverage/ --coverage 11748118-4168-4894-b7ff-b9106ec56614_wxs_gdc_realn_depofcov/11748118-4168-4894-b7ff-b9106ec56614_wxs_gdc_realn_depofcov.sample_interval_summary --intervals xgen-exome-research-panel-probesbe255a1532796e2eaa53ff00001c1b3c.hg38.bed.gz
```
The error I got is:
```
INFO [2022-07-11 13:46:42] Loading PureCN 2.2.0...
WARN [2022-07-11 13:46:55] Coverage data contains single nucleotide intervals.
WARN [2022-07-11 13:46:55] Found 22910 overlapping intervals, starting at line 38.
FATAL [2022-07-11 13:46:57] Provided coverage is zero, most likely due to a corrupt BAM file.

FATAL [2022-07-11 13:46:57]

FATAL [2022-07-11 13:46:57] This is most likely a user error due to invalid input data or

FATAL [2022-07-11 13:46:57] parameters (PureCN 2.2.0).

Error: Provided coverage is zero, most likely due to a corrupt BAM file.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.2.0).
In addition: Warning message:
In max(raw$average.coverage[raw$on.target], na.rm = TRUE) :
  no non-missing arguments to max; returning -Inf
Execution halted
```
Not sure what I did wrong for the GATK4 part, but for your information, the GATK4 command that I ran is:
```
gatk DepthOfCoverage -R GRCh38.d1.vd1.fa -O 11748118-4168-4894-b7ff-b9106ec56614_wxs_gdc_realn_depofcov/11748118-4168-4894-b7ff-b9106ec56614_wxs_gdc_realn_depofcov -I 11748118-4168-4894-b7ff-b9106ec56614_wxs_gdc_realn.bam -L xgen-exome-research-panel-probesbe255a1532796e2eaa53ff00001c1b3c.hg38.bed.gz
```
Please let me know if you need additional information. Thanks!",Shenglai,https://github.com/lima1/PureCN/issues/246
I_kwDOBew4us5OR0Np,question regarding purity/AF,CLOSED,2022-07-21T13:49:19Z,2022-07-21T14:34:24Z,2022-07-21T14:20:00Z,"I have seen that in one reply (https://github.com/lima1/PureCN/issues/227#issuecomment-1058734178) you have suggested plotting 75 percentile against purity, could you please explain why 75 perc and not median or mean of AF?

Thank you.


",maxanes,https://github.com/lima1/PureCN/issues/247
I_kwDOBew4us5PLAdJ,Error in PureCN.R,CLOSED,2022-08-04T08:50:23Z,2023-05-01T15:02:21Z,2023-05-01T15:02:21Z,"**Describe the issue**
A error had happened whenI'm running PureCN.R.

**To Reproduce**
FATAL [2022-08-04 15:23:30] f not in expected range.

FATAL [2022-08-04 15:23:30]

FATAL [2022-08-04 15:23:30] This is most likely a user error due to invalid input data or

FATAL [2022-08-04 15:23:30] parameters (PureCN 2.0.2).


**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
INFO [2022-08-04 14:57:13] Loading coverage files...
INFO [2022-08-04 14:57:14] Mean target coverages: 405X (tumor) 406X (normal).
INFO [2022-08-04 14:57:15] Mean coverages: chrX: 201.04, chrY: 154.85, chr1-22: 403.43.
INFO [2022-08-04 14:57:15] Mean coverages: chrX: 208.06, chrY: 154.85, chr1-22: 407.28.
INFO [2022-08-04 14:57:22] Removing 119 intervals with missing log.ratio.
INFO [2022-08-04 14:57:22] Removing 26 low/high GC targets.
INFO [2022-08-04 14:57:22] Removing 667 intervals excluded in normalDB.
INFO [2022-08-04 14:57:22] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2022-08-04 14:57:22] Removing 1337 low count (< 100 total reads) intervals.
INFO [2022-08-04 14:57:22] Using 29201 intervals (14583 on-target, 14618 off-target).
INFO [2022-08-04 14:57:22] Ratio of mean on-target vs. off-target read counts: 6.89
INFO [2022-08-04 14:57:22] Mean off-target bin size: 173456
INFO [2022-08-04 14:57:23] AT/GC dropout: 0.97 (tumor), 0.97 (normal), 1.00 (coverage log-ratio).
INFO [2022-08-04 14:57:23] Loading VCF...
INFO [2022-08-04 14:57:25] Found 7400 variants in VCF file.
WARN [2022-08-04 14:57:25] vcf.file has no DB or POP_AF info field for membership in germline databases. Guessing it based on available dbSNP ID.
INFO [2022-08-04 14:57:26] 6441 (87.0%) variants annotated as likely germline (DB INFO flag).
INFO [2022-08-04 14:57:27] Y22S00143-B1TA is tumor in VCF file.
INFO [2022-08-04 14:57:27] 57 homozygous and 3 heterozygous variants on chrX.
INFO [2022-08-04 14:57:27] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 38.95).
INFO [2022-08-04 14:57:28] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-08-04 14:57:29] Removing 13 variants with AF < 0.030 or AF >= Inf or less than 6 supporting reads or depth < 15.
WARN [2022-08-04 14:57:29] Variant ids contain NAs at filter step BQ.
INFO [2022-08-04 14:57:29] Removing 0 low quality variants with BQ < 25.
INFO [2022-08-04 14:57:29] Total size of targeted genomic region: 3.40Mb (4.58Mb with 50bp padding).
INFO [2022-08-04 14:57:30] 38.0% of targets contain variants.
INFO [2022-08-04 14:57:30] Removing 345 variants outside intervals.
INFO [2022-08-04 14:57:31] Reading COSMIC VCF...
INFO [2022-08-04 14:59:43] Found COSMIC annotation in VCF. Requiring 6 hits.
INFO [2022-08-04 14:59:43] Setting somatic prior probabilities for hits to 0.995000 or to 0.500000 if in both COSMIC and dbSNP.
INFO [2022-08-04 14:59:43] Loading mapping bias file mapping_bias_PRCC-Normal-PoN_hg19.rds...
INFO [2022-08-04 14:59:43] Found 43496 variants in mapping bias file.
INFO [2022-08-04 14:59:46] Imputing mapping bias for 937 variants...
INFO [2022-08-04 15:00:15] Excluding 1944 novel or poor quality variants from segmentation.
INFO [2022-08-04 15:00:15] Excluding 937 variants not in pool of normals from segmentation.
INFO [2022-08-04 15:00:15] Sample sex: M
INFO [2022-08-04 15:00:15] Segmenting data...
INFO [2022-08-04 15:00:15] Interval weights found, will use weighted CBS.
INFO [2022-08-04 15:00:16] Loading pre-computed boundaries for DNAcopy...
INFO [2022-08-04 15:00:16] Setting undo.SD parameter to 0.500000.
INFO [2022-08-04 15:00:20] Setting prune.hclust.h parameter to 0.100000.
INFO [2022-08-04 15:00:20] Found 43 segments with median size of 50.03Mb.
INFO [2022-08-04 15:00:20] Using 7042 variants.
INFO [2022-08-04 15:00:21] Mean standard deviation of log-ratios: 0.25 (MAPD: 0.19)
INFO [2022-08-04 15:00:21] Mean standard deviation of on-target log-ratios only: 0.18 (MAPD: 0.13)
INFO [2022-08-04 15:00:21] Mean standard deviation of off-target log-ratios only: 0.31 (MAPD: 0.28)
INFO [2022-08-04 15:00:21] 2D-grid search of purity and ploidy...
INFO [2022-08-04 15:01:16] Local optima: 0.1/2.2, 0.12/2, 0.14/2.4, 0.3/3.2, 0.18/1.8, 0.45/3.8,
0.26/2, 0.55/4.2, 0.42/2.8, 0.52/3, 0.45/2.4, 0.62/5, 0.82/6, 0.38/1.6,
0.65/2.6, 0.85/2.8, 0.58/1.4, 0.52/2, 0.78/2
INFO [2022-08-04 15:01:16] Testing local optimum 1/19 at purity 0.10 and total ploidy 2.20...
INFO [2022-08-04 15:01:20] Testing local optimum 2/19 at purity 0.12 and total ploidy 2.00...
INFO [2022-08-04 15:01:24] Testing local optimum 3/19 at purity 0.14 and total ploidy 2.40...
INFO [2022-08-04 15:01:29] Testing local optimum 4/19 at purity 0.30 and total ploidy 3.20...
INFO [2022-08-04 15:01:43] Recalibrating log-ratios...
INFO [2022-08-04 15:01:43] Testing local optimum 4/19 at purity 0.30 and total ploidy 3.20...
INFO [2022-08-04 15:01:53] Testing local optimum 5/19 at purity 0.18 and total ploidy 1.80...
INFO [2022-08-04 15:01:58] Testing local optimum 6/19 at purity 0.45 and total ploidy 3.80...
INFO [2022-08-04 15:02:01] Testing local optimum 7/19 at purity 0.26 and total ploidy 2.00...
INFO [2022-08-04 15:02:05] Testing local optimum 8/19 at purity 0.55 and total ploidy 4.20...
INFO [2022-08-04 15:02:08] Testing local optimum 9/19 at purity 0.42 and total ploidy 2.80...
INFO [2022-08-04 15:02:11] Testing local optimum 10/19 at purity 0.52 and total ploidy 3.00...
INFO [2022-08-04 15:02:14] Testing local optimum 11/19 at purity 0.45 and total ploidy 2.40...
INFO [2022-08-04 15:02:18] Testing local optimum 12/19 at purity 0.62 and total ploidy 5.00...
INFO [2022-08-04 15:02:31] Recalibrating log-ratios...
INFO [2022-08-04 15:02:31] Testing local optimum 12/19 at purity 0.62 and total ploidy 5.00...
INFO [2022-08-04 15:02:35] Recalibrating log-ratios...
INFO [2022-08-04 15:02:35] Testing local optimum 12/19 at purity 0.62 and total ploidy 5.00...
INFO [2022-08-04 15:02:41] Recalibrating log-ratios...
INFO [2022-08-04 15:02:41] Testing local optimum 12/19 at purity 0.62 and total ploidy 5.00...
INFO [2022-08-04 15:02:51] Testing local optimum 13/19 at purity 0.82 and total ploidy 6.00...
INFO [2022-08-04 15:03:02] Testing local optimum 14/19 at purity 0.38 and total ploidy 1.60...
INFO [2022-08-04 15:03:14] Recalibrating log-ratios...
INFO [2022-08-04 15:03:14] Testing local optimum 14/19 at purity 0.38 and total ploidy 1.60...
INFO [2022-08-04 15:04:19] Recalibrating log-ratios...
INFO [2022-08-04 15:04:19] Testing local optimum 14/19 at purity 0.38 and total ploidy 1.60...
INFO [2022-08-04 15:04:31] Testing local optimum 15/19 at purity 0.65 and total ploidy 2.60...
INFO [2022-08-04 15:04:35] Testing local optimum 16/19 at purity 0.85 and total ploidy 2.80...
INFO [2022-08-04 15:04:38] Testing local optimum 17/19 at purity 0.58 and total ploidy 1.40...
INFO [2022-08-04 15:04:52] Recalibrating log-ratios...
INFO [2022-08-04 15:04:52] Testing local optimum 17/19 at purity 0.58 and total ploidy 1.40...
INFO [2022-08-04 15:06:18] Recalibrating log-ratios...
INFO [2022-08-04 15:06:18] Testing local optimum 17/19 at purity 0.58 and total ploidy 1.40...
INFO [2022-08-04 15:07:59] Testing local optimum 18/19 at purity 0.52 and total ploidy 2.00...
INFO [2022-08-04 15:08:02] Testing local optimum 19/19 at purity 0.78 and total ploidy 2.00...
INFO [2022-08-04 15:08:06] Skipping 2 solutions that converged to the same optima.
INFO [2022-08-04 15:08:06] Fitting variants with betabin model for local optimum 1/19...
INFO [2022-08-04 15:08:06] Fitting variants for purity 0.12, tumor ploidy 4.42 and contamination 0.01.
INFO [2022-08-04 15:09:00] Optimized purity: 0.12
INFO [2022-08-04 15:09:00] Fitting variants with betabin model for local optimum 2/19...
INFO [2022-08-04 15:09:00] Fitting variants for purity 0.13, tumor ploidy 2.21 and contamination 0.01.
INFO [2022-08-04 15:09:54] Optimized purity: 0.13
INFO [2022-08-04 15:09:54] Fitting variants with betabin model for local optimum 3/19...
INFO [2022-08-04 15:09:54] Fitting variants for purity 0.16, tumor ploidy 5.20 and contamination 0.01.
INFO [2022-08-04 15:10:47] Optimized purity: 0.16
INFO [2022-08-04 15:10:47] Fitting variants with betabin model for local optimum 4/19...
INFO [2022-08-04 15:10:47] Fitting variants for purity 0.34, tumor ploidy 5.08 and contamination 0.01.
INFO [2022-08-04 15:11:41] Optimized purity: 0.34
INFO [2022-08-04 15:11:41] Fitting variants with betabin model for local optimum 5/19...
INFO [2022-08-04 15:11:42] Fitting variants for purity 0.10, tumor ploidy 5.30 and contamination 0.01.
INFO [2022-08-04 15:12:32] Optimized purity: 0.10
INFO [2022-08-04 15:12:32] Fitting variants with betabin model for local optimum 6/19...
INFO [2022-08-04 15:12:33] Fitting variants for purity 0.47, tumor ploidy 5.96 and contamination 0.01.
INFO [2022-08-04 15:13:26] Optimized purity: 0.47
INFO [2022-08-04 15:13:26] Fitting variants with betabin model for local optimum 8/19...
INFO [2022-08-04 15:13:26] Fitting variants for purity 0.57, tumor ploidy 5.96 and contamination 0.01.
INFO [2022-08-04 15:14:18] Optimized purity: 0.57
INFO [2022-08-04 15:14:18] Fitting variants with betabin model for local optimum 9/19...
INFO [2022-08-04 15:14:19] Fitting variants for purity 0.46, tumor ploidy 4.05 and contamination 0.01.
INFO [2022-08-04 15:15:10] Optimized purity: 0.46
INFO [2022-08-04 15:15:11] Fitting variants with betabin model for local optimum 10/19...
INFO [2022-08-04 15:15:11] Fitting variants for purity 0.55, tumor ploidy 4.00 and contamination 0.01.
INFO [2022-08-04 15:16:03] Optimized purity: 0.55
INFO [2022-08-04 15:16:03] Fitting variants with betabin model for local optimum 11/19...
INFO [2022-08-04 15:16:03] Fitting variants for purity 0.50, tumor ploidy 3.00 and contamination 0.01.
INFO [2022-08-04 15:16:56] Optimized purity: 0.50
INFO [2022-08-04 15:16:56] Fitting variants with betabin model for local optimum 12/19...
INFO [2022-08-04 15:16:56] Fitting variants for purity 0.51, tumor ploidy 5.15 and contamination 0.01.
INFO [2022-08-04 15:17:48] Optimized purity: 0.51
INFO [2022-08-04 15:17:48] Fitting variants with betabin model for local optimum 13/19...
INFO [2022-08-04 15:17:48] Fitting variants for purity 0.77, tumor ploidy 6.00 and contamination 0.01.
INFO [2022-08-04 15:18:40] Optimized purity: 0.77
INFO [2022-08-04 15:18:40] Fitting variants with betabin model for local optimum 15/19...
INFO [2022-08-04 15:18:41] Fitting variants for purity 0.69, tumor ploidy 3.00 and contamination 0.01.
INFO [2022-08-04 15:19:33] Optimized purity: 0.69
INFO [2022-08-04 15:19:33] Fitting variants with betabin model for local optimum 16/19...
INFO [2022-08-04 15:19:34] Fitting variants for purity 0.95, tumor ploidy 3.00 and contamination 0.01.
INFO [2022-08-04 15:20:25] Optimized purity: 0.95
INFO [2022-08-04 15:20:25] Fitting variants with betabin model for local optimum 17/19...
INFO [2022-08-04 15:20:25] Fitting variants for purity 0.95, tumor ploidy 0.35 and contamination 0.01.
INFO [2022-08-04 15:21:18] Optimized purity: 0.95
INFO [2022-08-04 15:21:18] Fitting variants with betabin model for local optimum 18/19...
INFO [2022-08-04 15:21:18] Fitting variants for purity 0.32, tumor ploidy 2.00 and contamination 0.01.
INFO [2022-08-04 15:22:10] Optimized purity: 0.32
INFO [2022-08-04 15:22:10] Fitting variants with betabin model for local optimum 19/19...
INFO [2022-08-04 15:22:10] Fitting variants for purity 0.59, tumor ploidy 2.00 and contamination 0.01.
INFO [2022-08-04 15:23:02] Optimized purity: 0.59
INFO [2022-08-04 15:23:02] Done.
INFO [2022-08-04 15:23:02] ------------------------------------------------------------
INFO [2022-08-04 15:23:06] Generating output files...
FATAL [2022-08-04 15:23:30] f not in expected range.

FATAL [2022-08-04 15:23:30]

FATAL [2022-08-04 15:23:30] This is most likely a user error due to invalid input data or

FATAL [2022-08-04 15:23:30] parameters (PureCN 2.0.2).

**Session Info**
> sessionInfo()
R version 4.1.1 (2021-08-10)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: CentOS release 6.8 (Final)

Matrix products: default
BLAS/LAPACK: /share/work4/zhangyk4498/sysoft/anaconda3/envs/PureCN2.0.2/lib/libopenblasp-r0.3.20.so

locale:
 [1] LC_CTYPE=zh_CN.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=zh_CN.UTF-8        LC_COLLATE=zh_CN.UTF-8
 [5] LC_MONETARY=zh_CN.UTF-8    LC_MESSAGES=zh_CN.UTF-8
 [7] LC_PAPER=zh_CN.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=zh_CN.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_4.1.1
",ykzhang2022,https://github.com/lima1/PureCN/issues/248
I_kwDOBew4us5PsGd1,FilterVcf.R fails with NAs in BQ field,CLOSED,2022-08-12T09:17:43Z,2023-05-02T01:07:20Z,2023-05-02T01:07:20Z,"**Describe the issue**
When NAs are found in the BQ field `.readAndCheckVcf` crashes when trying to log a warning. The following if-statement is the culprit, since `n` is never defined:

```r
if (is.null(bq) || all(is.na(bq))) {
    vcf <- .addBqField(vcf, error)
} else if (any(is.na(bq))) {
    flog.warn(""BQ FORMAT field contains NAs. Removing %i variants."", n - length(vcf))
}
```

Furthermore, when using an ensembled VCF (eg. from `bcbio.variation.recall`) the BQ of a variant can be found in different places depending on what caller called the variant, but `.getBQFromVcf`will only use the first one it finds and consider the BQ of all other callers as NA. I suppose this could be ""fixed"" by changing the VCF such that all variants use the same field for BQ, but it would be nice if this was somehow handled internally.

**To Reproduce**
```
Rscript $PURECN/PureCN.R \
  --sampleid=$SAMPLE \
  --seg-file=$SEGMENTS \
  --log-ratio-file=$LOGRATIO \
  --mapping-bias-file=$MAPPINGBIAS \
  --tumor=$TUMOR \
  --vcf=$ENSEMBLED_VCF \
  --genome=hg19
  --out=$OUTPUT/$SAMPLE
```

Where $ENSEMBLED_VCF contains variants called by multiple callers (eg. freebayes and mutect2)

**Expected behavior**
PureCN functions normally and uses variants from all callers.

**Log file**
```
INFO [2022-08-12 11:14:41] Loading PureCN 2.2.0...
INFO [2022-08-12 11:14:42] Reading cnv_sv/gatk_cnv_denoise_read_counts/C021_T.clean.denoisedCR.tsv...
INFO [2022-08-12 11:14:42] Reading cnv_sv/gatk_cnv_collect_read_counts/C021_T.counts.hdf5...
INFO [2022-08-12 11:15:02] ------------------------------------------------------------
INFO [2022-08-12 11:15:02] PureCN 2.2.0
INFO [2022-08-12 11:15:02] ------------------------------------------------------------
INFO [2022-08-12 11:15:02] Arguments: -normal.coverage.file  -seg.file cnv_sv/gatk_cnv_model_segments/C021_T.clean.modelFinal.seg -vcf.file output/snv_indels/bcbio_variation_recall_ensemble/C021_T.ensembled.vcf.gz -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /home/xdemer/data/normaldb/purecn_normaldb/mapping_bias_twist_hg19.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid C021_T -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -BPPARAM  -log.file cnv_sv/purecn/C021_T.log -tumor.coverage.file <data> -log.ratio <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2022-08-12 11:15:02] Loading coverage files...
WARN [2022-08-12 11:15:02] Allosome coverage missing, cannot determine sex.
WARN [2022-08-12 11:15:02] Allosome coverage missing, cannot determine sex.
INFO [2022-08-12 11:15:03] Using 10958 intervals (10958 on-target, 0 off-target).
INFO [2022-08-12 11:15:03] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2022-08-12 11:15:03] Loading VCF...
INFO [2022-08-12 11:15:08] Found 43585 variants in VCF file.
INFO [2022-08-12 11:15:08] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-08-12 11:15:08] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
WARN [2022-08-12 11:15:09] DB INFO flag contains NAs
INFO [2022-08-12 11:15:09] 722 (1.7%) variants annotated as likely germline (DB INFO flag).
Error in layout(level, msg, ...) : object 'n' not found
Calls: runAbsoluteCN ... .readAndCheckVcf -> flog.warn -> .log_level -> layout
In addition: Warning message:
In for (i in seq_len(n)) { :
  closing unused connection 3 (cnv_sv/gatk_cnv_denoise_read_counts/C021_T.clean.denoisedCR.tsv)
Execution halted
```
",dodslaser,https://github.com/lima1/PureCN/issues/249
I_kwDOBew4us5QDMS5,"runAbsoluteCN stops at ""Setting prune.hclust.h parameter"". Possibly due to small panel",CLOSED,2022-08-18T12:15:39Z,2022-08-23T07:18:12Z,2022-08-23T07:18:12Z,"**Describe the issue**
I'm following the R package vignette with my own data. The panel I use consists of 683 intervals. I generated the interval file with
```
preprocessIntervals(
                    interval.file = intervals, 
                    reference.file = ref, 
                    output.file = ""ex2_gc_file.txt"",
                    average.target.width = 500)
```
I have a PON of 22 assay-matched normals, I created the normal DB with
```
lapply(normbams, function(u){
  norm_name <- gsub("".bam"","""",basename(u))
  calculateBamCoverageByInterval(bam.file = u,
                               interval.file = ""focalCNV/ex2_gc_file.txt"",
                               output.file = paste0(norm_name,"".txt""))
  #coverage bias
  correctCoverageBias(paste0(norm_name,"".txt""), 
                      ""ex2_gc_file.txt"",
                      output.file = paste0(norm_name,""_gc.txt""),
                      plot.bias = TRUE)
})

#coverage normalization
normalDB <- createNormalDatabase(list.files("""", ""*_gc.txt""))
pool <- calculateTangentNormal(""mytestfile_gc.txt"", normalDB)
```
then I run pureCN

```
ret <-runAbsoluteCN(normal.coverage.file = pool,
                    tumor.coverage.file = ""mytestfile_gc.txt"", 
                    vcf.file = vcf,
                    genome = ""hg38"", 
                    sampleid = ""mytestfile"",
                    interval.file = ""ex2_gc_file.txt"", 
                    normalDB = normalDB,
                    model = ""betabin"",
                    args.filterVcf=list(
                    ),
                    args.filterIntervals = list(
                    ),
                    post.optimize = TRUE, 
                    plot.cnv = FALSE, 
                    verbose = TRUE)
```
I get the following error, during the segmentation:

```
INFO [2022-08-18 13:50:01] ------------------------------------------------------------
INFO [2022-08-18 13:50:01] PureCN 2.2.0
INFO [2022-08-18 13:50:01] ------------------------------------------------------------
INFO [2022-08-18 13:50:01] Arguments: -tumor.coverage.file mytestfile_gc.txt -vcf.file xxx.vcf -genome hg38 -args.filterVcf  -args.filterIntervals  -sampleid mytestfile -interval.file ex2_gc_file.txt -plot.cnv FALSE -model betabin -post.optimize TRUE -verbose TRUE -normal.coverage.file <data> -normalDB <data>
INFO [2022-08-18 13:50:01] Loading coverage files...
INFO [2022-08-18 13:50:02] Mean target coverages: 555X (tumor) 502X (normal).
WARN [2022-08-18 13:50:02] Allosome coverage missing, cannot determine sex.
WARN [2022-08-18 13:50:02] Allosome coverage missing, cannot determine sex.
INFO [2022-08-18 13:50:02] Removing 4 intervals with missing log.ratio.
INFO [2022-08-18 13:50:02] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2022-08-18 13:50:02] Using 683 intervals (683 on-target, 0 off-target).
INFO [2022-08-18 13:50:02] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2022-08-18 13:50:02] AT/GC dropout: 1.17 (tumor), 1.03 (normal), 1.14 (coverage log-ratio). 
WARN [2022-08-18 13:50:02] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2022-08-18 13:50:02] Loading VCF...
INFO [2022-08-18 13:50:04] Found 34920 variants in VCF file.
INFO [2022-08-18 13:50:04] Removing 1369 triallelic sites.
INFO [2022-08-18 13:50:04] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2022-08-18 13:50:04] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2022-08-18 13:50:04] 22729 (67.7%) variants annotated as likely germline (DB INFO flag).
INFO [2022-08-18 13:50:05] sp2020_1247_S2 is tumor in VCF file.
INFO [2022-08-18 13:50:05] 291 homozygous and 328 heterozygous variants on chrX.
INFO [2022-08-18 13:50:05] Sex from VCF: F (Fisher's p-value: 0.003, odds-ratio: 1.28).
INFO [2022-08-18 13:50:05] Detected MuTect2 VCF.
INFO [2022-08-18 13:50:05] Removing 0 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-08-18 13:50:05] Removing 588 low quality variants with non-offset BQ < 25.
INFO [2022-08-18 13:50:05] Base quality scores range from 24 to 35 (offset by 1)
INFO [2022-08-18 13:50:06] Minimum number of supporting reads ranges from 2 to 21, depending on coverage and BQS.
INFO [2022-08-18 13:50:09] Initial testing for significant sample cross-contamination: unlikely
INFO [2022-08-18 13:50:10] Removing 15493 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2022-08-18 13:50:10] Total size of targeted genomic region: 0.14Mb (0.20Mb with 50bp padding).
INFO [2022-08-18 13:50:10] 21.5% of targets contain variants.
INFO [2022-08-18 13:50:10] Removing 17290 variants outside intervals.
INFO [2022-08-18 13:50:10] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2022-08-18 13:50:10] VCF does not contain somatic status. For best results, consider providing mapping.bias.file when matched normals are not available.
INFO [2022-08-18 13:50:10] Excluding 45 novel or poor quality variants from segmentation.
INFO [2022-08-18 13:50:10] Sample sex: ?
INFO [2022-08-18 13:50:10] Segmenting data...
INFO [2022-08-18 13:50:10] Interval weights found, will use weighted CBS.
INFO [2022-08-18 13:50:10] Loading pre-computed boundaries for DNAcopy...
INFO [2022-08-18 13:50:10] Setting undo.SD parameter to 1.000000.
INFO [2022-08-18 13:50:10] Setting prune.hclust.h parameter to 0.250000.
Error in sample.int(x, size, replace, prob) : 
  cannot take a sample larger than the population when 'replace = FALSE'
```
**Expected behavior**
I understand that the panel is very small, and that PureCN is designed for panels of at least 1Mb (#243 ). But I'm not sure if this is causing the error. Is there maybe a parameter I can set to at least finish the PureCN run? I know the results are maybe not reliable, but I just want to test the package.

**Session Info**
```
R version 4.2.1 (2022-06-23)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.4 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=de_CH.UTF-8        LC_COLLATE=en_US.UTF-8     LC_MONETARY=de_CH.UTF-8   
 [6] LC_MESSAGES=en_US.UTF-8    LC_PAPER=de_CH.UTF-8       LC_NAME=C                  LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=de_CH.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] PureCN_2.2.0                VariantAnnotation_1.42.1    Rsamtools_2.12.0            Biostrings_2.64.0           XVector_0.36.0             
 [6] SummarizedExperiment_1.26.1 Biobase_2.56.0              GenomicRanges_1.48.0        GenomeInfoDb_1.32.2         IRanges_2.30.0             
[11] S4Vectors_0.34.0            MatrixGenerics_1.8.0        matrixStats_0.62.0          BiocGenerics_0.42.0         DNAcopy_1.70.0             

loaded via a namespace (and not attached):
 [1] bitops_1.0-7             bit64_4.0.5              filelock_1.0.2           RColorBrewer_1.1-3       progress_1.2.2           httr_1.4.3              
 [7] tools_4.2.1              utf8_1.2.2               R6_2.5.1                 DBI_1.1.2                colorspace_2.0-3         rhdf5filters_1.8.0      
[13] tidyselect_1.1.2         gridExtra_2.3            prettyunits_1.1.1        bit_4.0.4                curl_4.3.2               compiler_4.2.1          
[19] cli_3.3.0                formatR_1.12             xml2_1.3.3               DelayedArray_0.22.0      rtracklayer_1.56.0       scales_1.2.0            
[25] rappdirs_0.3.3           stringr_1.4.0            digest_0.6.29            pkgconfig_2.0.3          dbplyr_2.1.1             fastmap_1.1.0           
[31] BSgenome_1.64.0          rlang_1.0.2              rstudioapi_0.13          RSQLite_2.2.14           VGAM_1.1-7               BiocIO_1.6.0            
[37] generics_0.1.2           mclust_5.4.10            BiocParallel_1.30.2      dplyr_1.0.9              RCurl_1.98-1.6           magrittr_2.0.3          
[43] GenomeInfoDbData_1.2.8   futile.logger_1.4.3      Matrix_1.4-1             Rhdf5lib_1.18.2          Rcpp_1.0.8.3             munsell_0.5.0           
[49] fansi_1.0.3              lifecycle_1.0.1          stringi_1.7.6            yaml_2.3.5               zlibbioc_1.42.0          rhdf5_2.40.0            
[55] BiocFileCache_2.4.0      grid_4.2.1               blob_1.2.3               parallel_4.2.1           crayon_1.5.1             lattice_0.20-45         
[61] splines_4.2.1            GenomicFeatures_1.48.1   hms_1.1.1                KEGGREST_1.36.0          pillar_1.7.0             rjson_0.2.21            
[67] biomaRt_2.52.0           futile.options_1.0.1     XML_3.99-0.9             glue_1.6.2               lambda.r_1.2.4           data.table_1.14.2       
[73] png_0.1-7                vctrs_0.4.1              gtable_0.3.0             purrr_0.3.4              assertthat_0.2.1         cachem_1.0.6            
[79] ggplot2_3.3.6            restfulr_0.0.13          tibble_3.1.7             GenomicAlignments_1.32.0 AnnotationDbi_1.58.0     memoise_2.0.1           
[85] ellipsis_0.3.2          
```
",sorjuela,https://github.com/lima1/PureCN/issues/250
I_kwDOBew4us5RGnHb,PureCN vs Sequenza results,CLOSED,2022-09-02T23:42:51Z,2022-09-27T12:03:11Z,2022-09-27T12:03:11Z,"**Describe the issue**
When I run PureCN on 10 tumor samples and use their paired 10 germline samples to create a reference, I get different cellularity and ploidy results from Sequenza. Moreover, I can only run the script if I exclude --off-targets parameter in Step 1 below. I am hoping to get some advice on whether my workflow is correct. I followed the steps from the vignette. 

**To Reproduce**
#Step 1 - Generating interval files
 ```
Rscript $PURECN/IntervalFile.R --in-file $BAIT_COORDINATES \
        --fasta $REF_GENOME_b37 --out-file $OUT_REF/baits_hg19_intervals.txt \
        --off-target --genome hg19 \
        --export $OUT_REF/baits_optimized_hg19.bed  \
        --mappability $MAPPABILITY_FILE_B37
```

 #Step 2 - Run mutect on 10 germline samples, create genomics db and use CreateSomaticPanelOfNormals
 ```
> $PURECN_G/G_sample_map

 	count=1
        while IFS='' read -r line
        do
        if [ ! -z $GERMLINE_PFX ] && [ ! -f $PURECN_G/${GERMLINE_PFX}.vcf.gz ] && [ $count -le 10 ]; then
                count=$((count+1))
                #Run mutect on 10 germline samples
                gatk Mutect2 \
                -R $REF_GENOME_b37 \
                -I $SAVEROOT/$TUMOR_PFX/recal/bqsr_${GERMLINE_PFX}*.bam \
                --max-mnp-distance 0 \
                --genotype-germline-sites true \
                --genotype-pon-sites true \
                --interval-padding 75 \
                --L $BEDFILE_0B \
                -O $PURECN_G/${GERMLINE_PFX}.vcf.gz

                #Create a map file of all germline vcfs
                echo -e ""$GERMLINE_PFX\t$PURECN_G/${GERMLINE_PFX}.vcf.gz"" >> $PURECN_G/G_sample_map
        fi

       done<$LIST_OF_SAMPLES

        #Create a Genomics DB from the normal Mutect2 calls 
        gatk GenomicsDBImport \
        -R $REF_GENOME_b37 \
        -L $BEDFILE_0B \
        --genomicsdb-workspace-path $PURECN_G/pon_db \
        --sample-name-map $PURECN_G/G_sample_map

        #Combine the normal calls using CreateSomaticPanelOfNormals
        gatk CreateSomaticPanelOfNormals \
        -R $REF_GENOME_b37 \
        --germline-resource $GERMLINE_RESOURCE \
        -V gendb://$PURECN_G/pon_db \
        -O $PURECN_G/pon.vcf.gz
```

#Step 3 - Run Mutect on unmatched tumor samples
```
while IFS='' read -r line
        do
                if [ ! -z $TUMOR_PFX ]  && [ ! -f $PURECN_T/${TUMOR_PFX}.vcf.gz ]; then
                        #Run Mutect2 for each tumor sample
                        gatk Mutect2 \
                        -R $REF_GENOME_b37 \
                        -I $SAVEROOT/$TUMOR_PFX/recal/bqsr_${TUMOR_PFX}*.bam \
                        -pon $PURECN_G/pon.vcf.gz \
                        --germline-resource $GERMLINE_RESOURCE\
                        --genotype-germline-sites true \
                        --genotype-pon-sites true \
                        --interval-padding 75 \
                        -L $BEDFILE_0B \
                        -O $PURECN_T/${TUMOR_PFX}.vcf.gz

                fi

       done<$LIST_OF_SAMPLES

```

#Step 4 - calculate gc normalized coverages for germlines
```
	count=1
        while IFS='' read -r line
        do
        if [ ! -z $GERMLINE_PFX ] && [ $count -le 10 ] && [ ! -f $PURECN_G/${GERMLINE_PFX}_coverage_loess.txt.gz ] ; then
                count=$((count+1))

                Rscript $PURECN/Coverage.R \
                --out-dir $PURECN_G \
                --bam $SAVEROOT/$TUMOR_PFX/recal/bqsr_${GERMLINE_PFX}*.bam \
                --intervals $OUT_REF/baits_hg19_intervals.txt
        fi

       done<$LIST_OF_SAMPLES
```

#Step 5 - calculate gc normalized coverages for tumors
```
	while IFS='' read -r line
        do
        if [ ! -z $TUMOR_PFX ] && [ ! -f $PURECN_T/${TUMOR_PFX}_coverage_loess.txt.gz ]; then

                Rscript $PURECN/Coverage.R \
                --out-dir $PURECN_T \
                --bam $SAVEROOT/$TUMOR_PFX/recal/bqsr_${TUMOR_PFX}*.bam \
                --intervals $OUT_REF/baits_hg19_intervals.txt
        fi

        done<$LIST_OF_SAMPLES

```

#Step 6 - create normal db
```
	ls -a $PURECN_G/*_loess.txt.gz | cat > $PURECN_G/normal_coverages.list
        ulimit -n 5000
        #For a Mutect2/GATK4 normal panel GenomicsDB (beta)
        Rscript $PURECN/NormalDB.R --out-dir $PURECN_G \
        --coverage-files $PURECN_G/normal_coverages.list \
        --normal-panel $PURECN_G/pon_db \
        --genome hg19

```

#Step 7 - calculate tumor cellularity and ploidy
```
while IFS='' read -r line
        do

                if [ ! -z $TUMOR_PFX ] && ! grep $TUMOR_PFX $PURECN_RESULTS/purecn_unpaired_tumor_cellularity_ploidy.txt; then

                        #For each tumor bam files
                        # Production pipeline run (dont need stats file if Mutect2 was run)
                        Rscript $PURECN/PureCN.R --out $PURECN_T \
                        --tumor $PURECN_T/bqsr_${TUMOR_PFX}_T_coverage_loess.txt.gz \
                        --sampleid $TUMOR_PFX \
                        --vcf $PURECN_T/${TUMOR_PFX}.vcf.gz \
                        --fun-segmentation PSCBS \
                        --normaldb $PURECN_G/normalDB_hg19.rds \
                        --mapping-bias-file $PURECN_G/mapping_bias_hg19.rds \
                        --intervals $OUT_REF/baits_hg19_intervals.txt \
                        --genome hg19 \
                        --model betabin \
                        --force --post-optimize --seed 123

```
**Expected behavior**
I thought I might get the same cellularity and ploidy results as I did from Sequenza but the results are significantly different. I might need to alter the workflow as the “HIGH AT- OR GC-DROPOUT” flags for PureCN results don’t reflect what is seen in lab QC results (samples do not show high dropout). 
Also, the off target% for our targeted capture assay is around 30% and so I expect the --off-targets to be included in Step 1 but it gives an error as shown below. 


**Log file**
If I include --off-targets parameter in Step 1, I get this error in Step 6.
```
INFO [2022-07-12 03:14:00] Removing 15793 intervals with low coverage in normalDB.
FATAL [2022-07-12 03:14:00] No intervals left after coverage checks.
FATAL [2022-07-12 03:14:00]
FATAL [2022-07-12 03:14:00] This is most likely a user error due to invalid input data or
FATAL [2022-07-12 03:14:00] parameters (PureCN 2.2.0).
Error: No intervals left after coverage checks.
This is most likely a user error due to invalid input data or
parameters (PureCN 2.2.0).
```

Here is some information from the logs of one of the tumor sample from Step 7.
```
Execution halted
INFO [2022-07-24 19:10:31] Mean target coverages: 170X (tumor) 159X (normal).
INFO [2022-07-24 19:10:34] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2022-07-24 19:10:34] AT/GC dropout: 1.07 (tumor), 1.03 (normal), 1.05 (coverage log-ratio). 
INFO [2022-07-24 19:10:40] Initial testing for significant sample cross-contamination: maybe.
INFO [2022-07-24 19:10:41] 14.3% of targets contain variants.
INFO [2022-07-24 19:11:12] Mean standard deviation of log-ratios: 0.33 (MAPD: 0.23).
INFO [2022-07-24 19:13:13] Tumor/normal noise ratio: 11.108
WARN [2022-07-24 19:13:13] Extensive noise in tumor compared to normals.
```",nithishak,https://github.com/lima1/PureCN/issues/251
I_kwDOBew4us5RPZFx,Seqlevels missing in provided segmentation error  in Target Amplicon sequence samples.,CLOSED,2022-09-06T09:29:54Z,2022-09-09T20:50:13Z,2022-09-09T20:50:13Z,"Hi Markus,

I encountered an error from PureCN Seqlevels missing in provided segmentation: chr20. VCF, seg, and cnr files contain chr20 information.  The error log is here.

NFO [2022-09-06 18:16:16] ------------------------------------------------------------
INFO [2022-09-06 18:16:16] PureCN 2.3.0
INFO [2022-09-06 18:16:16] ------------------------------------------------------------
INFO [2022-09-06 18:16:16] Arguments: -normal.coverage.file  -tumor.coverage.file /Volumes/Crucial/Remnant_PDA/cnvkit/RemPDAC_tumor_003_TY-2_prm.cnr -log.ratio  -seg.file /Volumes/Crucial/Remnant_PDA/cnvkit/RemPDAC.seg -vcf.file /Users/taito/RemPDAC_TY-2_filtered.vcf -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 003_TY-2_prm -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize FALSE -BPPARAM  -log.file TY-2.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2022-09-06 18:16:16] Loading coverage files...
INFO [2022-09-06 18:16:17] Found log2-ratio in tumor coverage data.
WARN [2022-09-06 18:16:17] Allosome coverage missing, cannot determine sex.
WARN [2022-09-06 18:16:17] Allosome coverage missing, cannot determine sex.
INFO [2022-09-06 18:16:17] Using 450 intervals (450 on-target, 0 off-target).
INFO [2022-09-06 18:16:17] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2022-09-06 18:16:17] Loading VCF...
INFO [2022-09-06 18:16:18] Found 2315 variants in VCF file.
INFO [2022-09-06 18:16:18] Removing 68 triallelic sites.
WARN [2022-09-06 18:16:18] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2022-09-06 18:16:18] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2022-09-06 18:16:18] 893 (39.7%) variants annotated as likely germline (DB INFO flag).
WARN [2022-09-06 18:16:18] Found 1 variants with missing allelic fraction starting with chr11:108159785_T/TG. Removing them.
INFO [2022-09-06 18:16:19] 003_TY-2_prm is tumor in VCF file.
INFO [2022-09-06 18:16:19] 0 homozygous and 53 heterozygous variants on chrX.
INFO [2022-09-06 18:16:19] Sex from VCF: F (Fisher's p-value: 1, odds-ratio: 0.00).
INFO [2022-09-06 18:16:19] Detected MuTect2 VCF.
INFO [2022-09-06 18:16:19] Removing 2059 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-09-06 18:16:20] Removing 64 non heterozygous (in matched normal) germline SNPs.
INFO [2022-09-06 18:16:20] Removing 117 low quality variants with non-offset BQ < 25.
INFO [2022-09-06 18:16:20] Base quality scores range from 24 to 27 (offset by 1)
INFO [2022-09-06 18:16:20] Minimum number of supporting reads ranges from 4 to 7, depending on coverage and BQS.
INFO [2022-09-06 18:16:20] Removing 0 variants with AF < 0.030 or AF >= 1.000 or insufficient supporting reads or depth < 15.
INFO [2022-09-06 18:16:20] Total size of targeted genomic region: 0.10Mb (0.13Mb with 50bp padding).
INFO [2022-09-06 18:16:20] 0.9% of targets contain variants.
INFO [2022-09-06 18:16:20] Removing 3 variants outside intervals.
INFO [2022-09-06 18:16:20] Found SOMATIC annotation in VCF.
INFO [2022-09-06 18:16:20] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2022-09-06 18:16:21] Found SOMATIC annotation in VCF. Setting mapping bias to 1.072.
INFO [2022-09-06 18:16:21] Excluding 1 novel or poor quality variants from segmentation.
INFO [2022-09-06 18:16:21] Sample sex: ?
INFO [2022-09-06 18:16:21] Segmenting data...
INFO [2022-09-06 18:16:21] Loaded provided segmentation file RemPDAC.seg (format DNAcopy).
WARN [2022-09-06 18:16:21] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
INFO [2022-09-06 18:16:21] Re-centering provided segment means (offset -0.0081).
INFO [2022-09-06 18:16:21] Loading pre-computed boundaries for DNAcopy...
INFO [2022-09-06 18:16:21] Setting undo.SD parameter to 0.500000.
INFO [2022-09-06 18:16:21] Setting prune.hclust.h parameter to 0.100000.
FATAL [2022-09-06 18:16:21] Seqlevels missing in provided segmentation: chr20 

FATAL [2022-09-06 18:16:21]  

FATAL [2022-09-06 18:16:21] This is most likely a user error due to invalid input data or 

FATAL [2022-09-06 18:16:21] parameters (PureCN 2.3.0). 

",leap-ahead225,https://github.com/lima1/PureCN/issues/252
I_kwDOBew4us5Rp9ZE,PurecN on TSO500 capture: no valid purity and ploidy solution,CLOSED,2022-09-12T13:54:48Z,2022-09-14T14:21:53Z,2022-09-14T14:21:53Z,"Hi Markus,

Hope you can help me, I'm trying to get PureCN to work with a TSO500 capture. I have tried running variant calling with the capture BED and without but both fail as purecn can't find a valid purity and ploidy solution. Are there any parameters I can change to try get this to process? Is there something I'm missing here? I am  running cnvkit and importing rather than running PureCN from BAM files.

log file attached:
[sample1.log](https://github.com/lima1/PureCN/files/9548584/sample1.log)

Thanks!
Warren
",waemm,https://github.com/lima1/PureCN/issues/253
I_kwDOBew4us5S8w7b,PureCN cell line output from Sanger DepMap,CLOSED,2022-09-30T00:39:09Z,2023-05-01T03:16:48Z,2023-05-01T03:16:48Z,"Hi Markus,

Could you help me understanding the PureCN output generated by [Sanger's DepMap ](https://depmap.sanger.ac.uk/documentation/datasets/copy-number/) for cell lines? The output can be found [here](https://cog.sanger.ac.uk/cmp/download/WES_pureCN_CNV_segments_20220623.zip). I picked the representative records that I am confused with (data of SIDM00673 model_id corresponding to HCC70; many other segment outputs does make sense to me). Likely this is the `callLOH` output.

<img width=""1702"" alt=""image"" src=""https://user-images.githubusercontent.com/7236497/193164872-5bbf2c57-5e43-4659-a6fb-02afdaa48fa1.png"">

My questions are:
1. How ""maf_observed"" can be 0? I thought as long as ""num_snps_het"" > 0,  there will be non zero AF for it. (I could be completely misunderstood).
2. The 6th, and 7th rows seems to be LOH to me. But it actually detected 1 copy of minor allele as compared to 4th row (LOH). On the other hand, 2nd and 5th rows were deem 1 copy for minor allele. Is it because `num_snps_het / num_snps` is relatively high?
3. How does pureCN found 1st and 4th rows to have 2 copy for minor allele?

There are very few information on how they processed the calls. I sincerely appreciate your comments.

Thank you very much,
Hanbin",hanbinlu,https://github.com/lima1/PureCN/issues/254
I_kwDOBew4us5TK1Yf,Set version in saveRDS,CLOSED,2022-10-03T21:22:28Z,2023-05-01T23:12:48Z,2023-05-01T23:12:48Z,Output generated by versions using 3.6+ are not readable by 3.5 or older. We should set a version explicitly and make it a command line option.,lima1,https://github.com/lima1/PureCN/issues/255
I_kwDOBew4us5TN5Bc,No variants to plot error.,CLOSED,2022-10-04T11:53:56Z,2023-05-01T15:05:29Z,2023-05-01T15:05:29Z,"Hi, 
I'm trying to calculate purity and ploidy in pancreatic cancer WES samples.
In some cases, ""No variant to plot"" error occored.  How can I fix it?

INFO [2022-10-04 18:13:47] ------------------------------------------------------------
INFO [2022-10-04 18:13:47] PureCN 2.3.0
INFO [2022-10-04 18:13:48] ------------------------------------------------------------
INFO [2022-10-04 18:13:48] Arguments: -normal.coverage.file  -tumor.coverage.file /Volumes/Crucial/cnvkitresult/SKH-001_INV.hs37d5.cnr -log.ratio  -seg.file /Volumes/Crucial/cnvkitresult/ePDAC.seg -vcf.file /Volumes/Crucial/ePDACMutectVCF/SKH-001_INV_filtered.vcf.gz -normalDB  -genome hg19 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /Volumes/Crucial/PureCN_Itoh/mapping_bias_agilent_v6_hs37d5.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid SKH-001_INV -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -log.file /Volumes/Crucial/PureCN_Itoh/SKH-001_INV/SKH-001_INV.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2022-10-04 18:13:48] Using BiocParallel for parallel optimization.
INFO [2022-10-04 18:13:48] Loading coverage files...
INFO [2022-10-04 18:13:52] Found log2-ratio in tumor coverage data.
WARN [2022-10-04 18:13:52] log2-ratio contains outliers < -8, ignoring them...
INFO [2022-10-04 18:13:53] Mean coverages: chrX: 36.50, chrY: 39.11, chr1-22: 60.68.
INFO [2022-10-04 18:13:53] Mean coverages: chrX: 36.50, chrY: 39.11, chr1-22: 60.68.
INFO [2022-10-04 18:13:54] Removing 26 intervals with missing log.ratio.
INFO [2022-10-04 18:13:54] Using 303011 intervals (262836 on-target, 40175 off-target).
INFO [2022-10-04 18:13:54] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2022-10-04 18:13:54] Mean off-target bin size: 59644
INFO [2022-10-04 18:13:54] Loading VCF...
INFO [2022-10-04 18:13:58] Found 118224 variants in VCF file.
INFO [2022-10-04 18:13:59] Removing 1641 triallelic sites.
WARN [2022-10-04 18:13:59] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2022-10-04 18:14:00] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2022-10-04 18:14:00] 56810 (48.7%) variants annotated as likely germline (DB INFO flag).
WARN [2022-10-04 18:14:03] Found 252 variants with missing allelic fraction starting with 1:11714443_C/CGCTGCTGTTCCGATGGTGTCTTTGATGTTGGGCTGATGAGGTCTGG. Removing them.
INFO [2022-10-04 18:14:05] SKH-001_INV is tumor in VCF file.
INFO [2022-10-04 18:14:05] 499 homozygous and 120 heterozygous variants on chrX.
INFO [2022-10-04 18:14:05] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 6.46).
INFO [2022-10-04 18:14:05] Detected MuTect2 VCF.
INFO [2022-10-04 18:14:07] Removing 69755 Mutect2 calls due to blacklisted failure reasons.
INFO [2022-10-04 18:14:07] Removing 22603 non heterozygous (in matched normal) germline SNPs.
INFO [2022-10-04 18:14:07] Removing 23074 low quality variants with non-offset BQ < 25.
INFO [2022-10-04 18:14:07] Base quality scores range from 24 to 29 (offset by 1)
INFO [2022-10-04 18:14:07] Minimum number of supporting reads ranges from 2 to 9, depending on coverage and BQS.
INFO [2022-10-04 18:14:08] Removing 685 variants with AF < 0.030 or AF >= 1.000 or insufficient supporting reads or depth < 15.
INFO [2022-10-04 18:14:19] Removing 27 blacklisted variants.
INFO [2022-10-04 18:14:19] Total size of targeted genomic region: 56.91Mb (76.96Mb with 50bp padding).
INFO [2022-10-04 18:14:19] 0.1% of targets contain variants.
INFO [2022-10-04 18:14:19] Removing 9 variants outside intervals.
WARN [2022-10-04 18:14:19] Less than half of variants in dbSNP. Make sure that VCF contains both germline and somatic variants.
INFO [2022-10-04 18:14:19] Found SOMATIC annotation in VCF.
INFO [2022-10-04 18:14:19] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
INFO [2022-10-04 18:14:19] Found SOMATIC annotation in VCF. Setting mapping bias to 0.932.
INFO [2022-10-04 18:14:19] Loading mapping bias file mapping_bias_agilent_v6_hs37d5.rds...
INFO [2022-10-04 18:14:21] Found 1385518 variants in mapping bias file.
INFO [2022-10-04 18:14:21] Imputing mapping bias for 134 variants...
INFO [2022-10-04 18:14:28] Excluding 173 novel or poor quality variants from segmentation.
INFO [2022-10-04 18:14:28] Excluding 134 variants not in pool of normals from segmentation.
INFO [2022-10-04 18:14:28] Sample sex: M
INFO [2022-10-04 18:14:28] Segmenting data...
INFO [2022-10-04 18:14:28] Loaded provided segmentation file ePDAC.seg (format DNAcopy).
WARN [2022-10-04 18:14:28] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
WARN [2022-10-04 18:14:28] Removing 2 short segments with log-ratio < -8.
INFO [2022-10-04 18:14:28] Re-centering provided segment means (offset -0.0518).
INFO [2022-10-04 18:14:28] Setting prune.hclust.h parameter to 0.100000.
INFO [2022-10-04 18:14:28] Found 152 segments with median size of 4.50Mb.
INFO [2022-10-04 18:14:28] Using 178 variants.
INFO [2022-10-04 18:14:29] Mean standard deviation of log-ratios: 0.39 (MAPD: 0.32)
INFO [2022-10-04 18:14:29] Mean standard deviation of on-target log-ratios only: 0.40 (MAPD: 0.32)
INFO [2022-10-04 18:14:29] Mean standard deviation of off-target log-ratios only: 0.35 (MAPD: 0.23)
INFO [2022-10-04 18:14:29] 2D-grid search of purity and ploidy...
INFO [2022-10-04 18:15:24] Local optima: 0.15/2, 0.15/2.2, 0.25/2, 0.21/1.8, 0.29/2.6, 0.42/2.8,
0.52/3, 0.33/3, 0.42/2.4, 0.55/4.2, 0.45/3.8, 0.35/1.6, 0.82/6,
0.65/5.2, 0.62/2.6, 0.52/2, 0.78/2.8, 0.95/3, 0.62/1.4, 0.78/2
INFO [2022-10-04 18:15:25] Testing local optimum 3/20 at purity 0.25 and total ploidy 2.00...
INFO [2022-10-04 18:15:25] Testing local optimum 5/20 at purity 0.29 and total ploidy 2.60...
INFO [2022-10-04 18:15:25] Testing local optimum 9/20 at purity 0.42 and total ploidy 2.40...
INFO [2022-10-04 18:15:25] Testing local optimum 1/20 at purity 0.15 and total ploidy 2.00...
INFO [2022-10-04 18:15:25] Testing local optimum 11/20 at purity 0.45 and total ploidy 3.80...
INFO [2022-10-04 18:15:25] Testing local optimum 7/20 at purity 0.52 and total ploidy 3.00...
INFO [2022-10-04 18:15:25] Testing local optimum 13/20 at purity 0.82 and total ploidy 6.00...
INFO [2022-10-04 18:15:25] Testing local optimum 17/20 at purity 0.78 and total ploidy 2.80...
INFO [2022-10-04 18:15:25] Testing local optimum 19/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-10-04 18:15:25] Testing local optimum 15/20 at purity 0.62 and total ploidy 2.60...
INFO [2022-10-04 18:15:35] Recalibrating log-ratios...
INFO [2022-10-04 18:15:35] Recalibrating log-ratios...
INFO [2022-10-04 18:15:35] Testing local optimum 13/20 at purity 0.82 and total ploidy 6.00...
INFO [2022-10-04 18:15:35] Testing local optimum 19/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-10-04 18:15:44] Recalibrating log-ratios...
INFO [2022-10-04 18:15:44] Testing local optimum 19/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-10-04 18:15:55] Recalibrating log-ratios...
INFO [2022-10-04 18:15:55] Testing local optimum 19/20 at purity 0.62 and total ploidy 1.40...
INFO [2022-10-04 18:16:05] Testing local optimum 20/20 at purity 0.78 and total ploidy 2.00...
INFO [2022-10-04 18:16:11] Testing local optimum 18/20 at purity 0.95 and total ploidy 3.00...
INFO [2022-10-04 18:16:20] Testing local optimum 2/20 at purity 0.15 and total ploidy 2.20...
INFO [2022-10-04 18:16:21] Testing local optimum 4/20 at purity 0.21 and total ploidy 1.80...
INFO [2022-10-04 18:16:23] Testing local optimum 6/20 at purity 0.42 and total ploidy 2.80...
INFO [2022-10-04 18:16:26] Testing local optimum 16/20 at purity 0.52 and total ploidy 2.00...
INFO [2022-10-04 18:16:26] Testing local optimum 10/20 at purity 0.55 and total ploidy 4.20...
INFO [2022-10-04 18:16:26] Testing local optimum 8/20 at purity 0.33 and total ploidy 3.00...
INFO [2022-10-04 18:16:28] Recalibrating log-ratios...
INFO [2022-10-04 18:16:28] Testing local optimum 11/20 at purity 0.45 and total ploidy 3.80...
INFO [2022-10-04 18:16:30] Recalibrating log-ratios...
INFO [2022-10-04 18:16:30] Testing local optimum 4/20 at purity 0.21 and total ploidy 1.80...
INFO [2022-10-04 18:16:36] Recalibrating log-ratios...
INFO [2022-10-04 18:16:36] Testing local optimum 13/20 at purity 0.82 and total ploidy 6.00...
INFO [2022-10-04 18:16:38] Recalibrating log-ratios...
INFO [2022-10-04 18:16:38] Testing local optimum 4/20 at purity 0.21 and total ploidy 1.80...
INFO [2022-10-04 18:16:48] Recalibrating log-ratios...
INFO [2022-10-04 18:16:48] Testing local optimum 4/20 at purity 0.21 and total ploidy 1.80...
INFO [2022-10-04 18:17:18] Recalibrating log-ratios...
INFO [2022-10-04 18:17:18] Testing local optimum 8/20 at purity 0.33 and total ploidy 3.00...
INFO [2022-10-04 18:17:21] Recalibrating log-ratios...
INFO [2022-10-04 18:17:21] Testing local optimum 10/20 at purity 0.55 and total ploidy 4.20...
INFO [2022-10-04 18:17:25] Recalibrating log-ratios...
INFO [2022-10-04 18:17:25] Testing local optimum 11/20 at purity 0.45 and total ploidy 3.80...
INFO [2022-10-04 18:17:29] Recalibrating log-ratios...
INFO [2022-10-04 18:17:29] Testing local optimum 13/20 at purity 0.82 and total ploidy 6.00...
INFO [2022-10-04 18:17:36] Testing local optimum 14/20 at purity 0.65 and total ploidy 5.20...
INFO [2022-10-04 18:17:42] Recalibrating log-ratios...
INFO [2022-10-04 18:17:42] Testing local optimum 14/20 at purity 0.65 and total ploidy 5.20...
INFO [2022-10-04 18:17:57] Recalibrating log-ratios...
INFO [2022-10-04 18:17:57] Testing local optimum 8/20 at purity 0.33 and total ploidy 3.00...
INFO [2022-10-04 18:18:00] Recalibrating log-ratios...
INFO [2022-10-04 18:18:00] Testing local optimum 10/20 at purity 0.55 and total ploidy 4.20...
INFO [2022-10-04 18:18:10] Recalibrating log-ratios...
INFO [2022-10-04 18:18:10] Testing local optimum 11/20 at purity 0.45 and total ploidy 3.80...
INFO [2022-10-04 18:18:18] Testing local optimum 12/20 at purity 0.35 and total ploidy 1.60...
INFO [2022-10-04 18:18:24] Recalibrating log-ratios...
INFO [2022-10-04 18:18:24] Testing local optimum 12/20 at purity 0.35 and total ploidy 1.60...
INFO [2022-10-04 18:18:25] Recalibrating log-ratios...
INFO [2022-10-04 18:18:25] Testing local optimum 14/20 at purity 0.65 and total ploidy 5.20...
INFO [2022-10-04 18:18:30] Recalibrating log-ratios...
INFO [2022-10-04 18:18:30] Testing local optimum 12/20 at purity 0.35 and total ploidy 1.60...
INFO [2022-10-04 18:18:35] Recalibrating log-ratios...
INFO [2022-10-04 18:18:35] Testing local optimum 12/20 at purity 0.35 and total ploidy 1.60...
INFO [2022-10-04 18:18:38] Recalibrating log-ratios...
INFO [2022-10-04 18:18:38] Testing local optimum 8/20 at purity 0.33 and total ploidy 3.00...
INFO [2022-10-04 18:18:48] Recalibrating log-ratios...
INFO [2022-10-04 18:18:48] Testing local optimum 10/20 at purity 0.55 and total ploidy 4.20...
INFO [2022-10-04 18:19:04] Recalibrating log-ratios...
INFO [2022-10-04 18:19:04] Testing local optimum 14/20 at purity 0.65 and total ploidy 5.20...
INFO [2022-10-04 18:19:32] Skipping 6 solutions that converged to the same optima.
INFO [2022-10-04 18:19:32] Skipping 6 solutions exceeding max.non.clonal (0.20): 0.23/1.11, 0.53/1.05, 0.33/1.07, 0.63/1.4, 0.65/1.18, 0.64/1.04 (purity/tumor ploidy)
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 8/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 2/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 7/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 10/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 20/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 17/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 18/20...
INFO [2022-10-04 18:19:32] Fitting variants with beta model for local optimum 15/20...
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.59, tumor ploidy 2.83 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.32, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.42, tumor ploidy 2.82 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.89, tumor ploidy 3.02 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.15, tumor ploidy 2.86 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.27, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.59, tumor ploidy 1.95 and contamination 0.01.
INFO [2022-10-04 18:19:37] Fitting variants for purity 0.19, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:19:44] Poor goodness-of-fit (0.725). Skipping post-optimization.
INFO [2022-10-04 18:19:44] Optimized purity: 0.42
INFO [2022-10-04 18:19:44] Fitting variants for purity 0.16, tumor ploidy 2.86 and contamination 0.01.
INFO [2022-10-04 18:19:44] Poor goodness-of-fit (0.373). Skipping post-optimization.
INFO [2022-10-04 18:19:44] Optimized purity: 0.59
INFO [2022-10-04 18:19:44] Fitting variants for purity 0.23, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:19:44] Poor goodness-of-fit (0.000). Skipping post-optimization.
INFO [2022-10-04 18:19:44] Poor goodness-of-fit (0.000). Skipping post-optimization.
INFO [2022-10-04 18:19:44] Optimized purity: 0.89
INFO [2022-10-04 18:19:44] Optimized purity: 0.59
INFO [2022-10-04 18:19:44] Fitting variants for purity 0.28, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:19:44] Fitting variants for purity 0.15, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:19:51] Fitting variants for purity 0.17, tumor ploidy 2.86 and contamination 0.01.
INFO [2022-10-04 18:19:51] Fitting variants for purity 0.24, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:19:51] Fitting variants for purity 0.29, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:19:51] Fitting variants for purity 0.16, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:19:57] Fitting variants for purity 0.25, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:19:57] Fitting variants for purity 0.17, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:19:57] Fitting variants for purity 0.30, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:19:57] Fitting variants for purity 0.18, tumor ploidy 2.86 and contamination 0.01.
INFO [2022-10-04 18:20:04] Fitting variants for purity 0.26, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:20:04] Fitting variants for purity 0.18, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:20:04] Fitting variants for purity 0.19, tumor ploidy 2.86 and contamination 0.01.
INFO [2022-10-04 18:20:04] Fitting variants for purity 0.31, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:20:10] Fitting variants for purity 0.28, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:20:10] Fitting variants for purity 0.20, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:20:11] Fitting variants for purity 0.33, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:20:11] Optimized purity: 0.15
INFO [2022-10-04 18:20:17] Fitting variants for purity 0.29, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:20:17] Fitting variants for purity 0.21, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:20:17] Fitting variants for purity 0.34, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:20:23] Fitting variants for purity 0.30, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:20:23] Fitting variants for purity 0.22, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:20:23] Fitting variants for purity 0.35, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:20:30] Fitting variants for purity 0.31, tumor ploidy 1.86 and contamination 0.01.
INFO [2022-10-04 18:20:30] Fitting variants for purity 0.23, tumor ploidy 2.10 and contamination 0.01.
INFO [2022-10-04 18:20:30] Fitting variants for purity 0.36, tumor ploidy 3.84 and contamination 0.01.
INFO [2022-10-04 18:20:36] Optimized purity: 0.27
INFO [2022-10-04 18:20:36] Optimized purity: 0.19
INFO [2022-10-04 18:20:36] Optimized purity: 0.32
INFO [2022-10-04 18:20:36] Done.
INFO [2022-10-04 18:20:36] ------------------------------------------------------------
INFO [2022-10-04 18:20:39] Generating output files...
WARN [2022-10-04 18:20:41] No variants to plot
WARN [2022-10-04 18:20:41] No variants to plot
WARN [2022-10-04 18:20:41] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot
WARN [2022-10-04 18:20:42] No variants to plot",leap-ahead225,https://github.com/lima1/PureCN/issues/256
I_kwDOBew4us5UPjKt,IntervalFile.R command line behaviour different than preprocessIntervals(),CLOSED,2022-10-18T14:48:05Z,2023-05-01T15:13:05Z,2023-05-01T15:13:05Z,"**Describe the issue**

Case 1: IntervalFile.R does not have an equivalent for the `off.target.padding` argument in `preprocessIntervals()`
Case 2: `preprocessIntervals()` does not keep the `Gene` column from a GRanges object specified in `interval.file`.

**To Reproduce**

Case 2:

```
bed.file <- system.file(""extdata"", ""ex2_intervals.bed"",
                        package = ""PureCN"", mustWork = TRUE)
reference.file <- system.file(""extdata"", ""ex2_reference.fa"",
                              package = ""PureCN"", mustWork = TRUE)
intervals <- import(bed.file)

#dummy gene names
intervals$Gene <- letters[1:5]

preprocessIntervals(interval.file = intervals,
                    reference.file = reference.file,
                    output.file = ""gc_file.txt""
)
```

gc_file.txt contents, have a point where the gene name should be:

```
@HD	VN:1.6
@SQ	SN:seq1	LN:800
@SQ	SN:seq2	LN:800
Target	gc_bias	mappability	reptiming	Gene	on_target
seq1:101-250	0.453333333333333	NA	NA	.	TRUE
seq1:301-650	0.505714285714286	NA	NA	.	TRUE
seq2:1-150	0.573333333333333	NA	NA	.	TRUE
seq2:401-550	0.48	NA	NA	.	TRUE
seq2:676-775	0.41	NA	NA	.	TRUE
```

**Expected behavior**

Case 2: In addition to the above, the command line IntervalFile.R automatically adds annotation, I would like to use custom gene names per bait.

**Session Info**

R version 4.2.1 (2022-06-23)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.5 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=de_CH.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=de_CH.UTF-8    LC_MESSAGES=en_US.UTF-8    LC_PAPER=de_CH.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C             LC_MEASUREMENT=de_CH.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] PureCN_2.2.0                VariantAnnotation_1.42.1    Rsamtools_2.12.0            Biostrings_2.64.0          
 [5] XVector_0.36.0              SummarizedExperiment_1.26.1 Biobase_2.56.0              GenomicRanges_1.48.0       
 [9] GenomeInfoDb_1.32.2         IRanges_2.30.0              S4Vectors_0.34.0            MatrixGenerics_1.8.0       
[13] matrixStats_0.62.0          BiocGenerics_0.42.0         DNAcopy_1.70.0             

loaded via a namespace (and not attached):
 [1] httr_1.4.3               VGAM_1.1-7               bit64_4.0.5              splines_4.2.1            assertthat_0.2.1        
 [6] BiocFileCache_2.4.0      blob_1.2.3               BSgenome_1.64.0          GenomeInfoDbData_1.2.8   yaml_2.3.5              
[11] progress_1.2.2           pillar_1.7.0             RSQLite_2.2.14           lattice_0.20-45          glue_1.6.2              
[16] digest_0.6.29            RColorBrewer_1.1-3       colorspace_2.0-3         Matrix_1.5-1             XML_3.99-0.9            
[21] pkgconfig_2.0.3          biomaRt_2.52.0           zlibbioc_1.42.0          purrr_0.3.4              scales_1.2.0            
[26] BiocParallel_1.30.2      tibble_3.1.7             KEGGREST_1.36.0          ggplot2_3.3.6            generics_0.1.2          
[31] ellipsis_0.3.2           cachem_1.0.6             GenomicFeatures_1.48.1   cli_3.3.0                mclust_5.4.10           
[36] magrittr_2.0.3           crayon_1.5.1             memoise_2.0.1            fansi_1.0.3              xml2_1.3.3              
[41] tools_4.2.1              data.table_1.14.2        prettyunits_1.1.1        hms_1.1.1                formatR_1.12            
[46] BiocIO_1.6.0             lifecycle_1.0.1          stringr_1.4.0            Rhdf5lib_1.18.2          munsell_0.5.0           
[51] DelayedArray_0.22.0      lambda.r_1.2.4           AnnotationDbi_1.58.0     compiler_4.2.1           rlang_1.0.2             
[56] rhdf5_2.40.0             futile.logger_1.4.3      grid_4.2.1               RCurl_1.98-1.6           rhdf5filters_1.8.0      
[61] rstudioapi_0.13          rjson_0.2.21             rappdirs_0.3.3           bitops_1.0-7             gtable_0.3.0            
[66] restfulr_0.0.13          DBI_1.1.2                curl_4.3.2               R6_2.5.1                 gridExtra_2.3           
[71] GenomicAlignments_1.32.0 dplyr_1.0.9              rtracklayer_1.56.0       fastmap_1.1.0            bit_4.0.4               
[76] utf8_1.2.2               filelock_1.0.2           futile.options_1.0.1     stringi_1.7.6            parallel_4.2.1          
[81] Rcpp_1.0.8.3             vctrs_0.4.1              png_0.1-7                dbplyr_2.1.1             tidyselect_1.1.2
",sorjuela,https://github.com/lima1/PureCN/issues/257
I_kwDOBew4us5Vn3St,Coverage.R and NormalDB.R check wrong directory for write permissions,CLOSED,2022-11-04T18:59:40Z,2023-05-01T21:44:31Z,2023-05-01T21:44:30Z,"PureCN scripts Coverage.R, NormalDB.R check one level above output directory for write permissions rather than output directory itself.

I found that if I'm using a docker container with user id other than ""root"" and work directory in the root directory (e.g. `/work_dir`) scripts produce an error `Error: Permission denied to write in --outdir.`

I believe that the reason is an unnecessary usage of `dirname` function.
The scripts contain the following code:
```
outdir <- normalizePath(opt$out_dir, mustWork = TRUE)
if (file.access(dirname(outdir), 2) < 0) stop(""Permission denied to write in --outdir."")
``` 

As the scripts require directory name as input the `dirname(outdir)` will cut the last level of directory.

For example"":
```
outdir <- ""/work_dir""
dirname(outdir)

[1] ""/""
```

**Expected behavior**
Check output directory permissions.",sleyn,https://github.com/lima1/PureCN/issues/258
I_kwDOBew4us5Vvy-I,GDC GATK version incompatible with PureCN?,CLOSED,2022-11-07T15:57:44Z,2023-04-06T14:57:31Z,2023-04-06T14:57:31Z,"I am trying to use the vcf files generated from WES data in the TCGA (https://portal.gdc.cancer.gov/repository). I tried running PureCN using the MuTect2 vcfs (controlled access), but this resulted in an error: 

`Error: Segmentation and VCF do not overlap.`

I noticed in your documentation that MuTect2 from GATK <4.1.7 will not work with PureCN. The GDC pipeline website shows the MuTect2 vcfs were generated with GATK 4.0.4.0 (https://docs.gdc.cancer.gov/Data/Bioinformatics_Pipelines/DNA_Seq_Variant_Calling_Pipeline/).

Is this an issue with GDC vcfs?

java -Djava.io.tmpdir=/tmp/job_tmp_3 -d64 -jar -Xmx3G -XX:+UseSerialGC \
/bin/**gatk-4.0.4.0/gatk-package-4.0.4.0-local.jar** \
Mutect2 \
-R GRCh38.d1.vd1.fa \
-L chr4:1-190214555 \ # Specify chromosome
-I Tumor_Sample_Alignment.bam \
-O 3.mt2.vcf \
-tumor <tumor_sample_name> \ # From step 4
--af-of-alleles-not-in-resource 2.5e-06 \
--germline-resource af-only-gnomad.hg38.vcf.gz \ # Germline reference from gnomad
-pon gatk4_mutect2_4136_pon.vcf.gz # New panel of normal created by 4136 TCGA curated normal samples, using GATK4
",N/A,https://github.com/lima1/PureCN/issues/259
I_kwDOBew4us5WiqGs,No handling of NA values from .matrixTotalPloidyToTumorPloidy function,CLOSED,2022-11-16T16:40:01Z,2023-06-20T15:06:28Z,2023-06-20T15:06:28Z,"Hello,

**Describe the issue**
I was running `PureCN.R` from the 2.2.0 docker file and received an error:
```
Error in quantile.default(xc, p = 0.2) :
  missing values and NaN's not allowed if 'na.rm' is FALSE
Calls: plotAbs ... .plotTypeOverview -> quantile -> quantile -> quantile.default
```

**To Reproduce**
I can't provide a reproducible example as I can't share the data.

However there some of my investigations:

The reason of the error are couple `NA` in the results `.matrixTotalPloidyToTumorPloidy` function in `plotAbs.R`.
More specific lines 124-126:
```
  tumor.ploidy.i <- lapply(tumor.ploidy, function(x)
    sapply(ploidy, function(i) ifelse(min(abs(x-i)) < 1,
                                      which.min(abs(x-i)), NA)))
```

Subsequently these `NAs` are used to sample `res$candidates$all` matrix from the `runAbsoluteCN` output that in turn produces `NAs` in the output of `.matrixTotalPloidyToTumorPloidy`.

```
cc <- do.call(cbind, lapply(seq_along(tumor.ploidy.i), function(i)
    ca[tumor.ploidy.i[[i]],i]))
```

Then `NAs` are not handled and go to `.plotTypeOverview` function where they hit line 610 in `plotAbs.R`:
```
xc[xc < quantile(xc, p=0.2)] <- quantile(xc, p=0.2)
```

What supposed to happen with these `NAs`?
Does it mean that my results are wrong or is it ok to have couple of `NAs`?

Thanks,
Semion

",sleyn,https://github.com/lima1/PureCN/issues/260
I_kwDOBew4us5WqtPk,Question,CLOSED,2022-11-17T21:44:07Z,2023-04-06T14:49:09Z,2023-04-06T14:49:09Z,"Hi Markus,
I have a question related to PureCN output. When I look at the multiplicity of the mutations, all somatic mutations that have CCF less than 0.9 are a multiplicity of 1, and higher CCF than 0.9 have all multiplicities 1-7. 
Is it possible that no mutation with lower CCF has a higher than 1 multiplicity?",maxanes,https://github.com/lima1/PureCN/issues/261
I_kwDOBew4us5W6u_t,Minimal run for accurate purity/ploidy,CLOSED,2022-11-21T16:33:21Z,2023-04-06T14:50:19Z,2023-04-06T14:50:19Z,"I was wondering if the following minimal steps (for a relatively quicker run) would enable accurate purity estimation with PureCN?:

1. extract manufacturer's bait intervals overlapping common SNPs (snp151Common)
2. Get allelic counts with GATK4 CollectAllelicCounts
3. Back in R, perform readAllelicCountsFile to read these counts
4. Then:
```
runAbsoluteCN(seg.file = seg.file, interval.file = interval.file, vcf.file = vcf.ac, max.candidate.solutions = 1, genome = ""hg38"", test.purity = seq(0.05,0.95,by = 0.05),post.optimize = TRUE, BPPARAM = multicoreParam, cosmic.vcf.file = cosmic.vcf.file, verbose = TRUE, plot.cnv = FALSE)
#seg.file = third party segmentation file
#interval.file = ""ex2_gc_file.txt"" from preprocessIntervals
#vcf.ac = from step 3
```

If one was only interested in purity estimation from PureCN, would this be the quickest method with relatively good accuracy? Thanks!",N/A,https://github.com/lima1/PureCN/issues/262
I_kwDOBew4us5ZjTEE,Error in running PureCN,CLOSED,2022-12-19T07:09:06Z,2023-05-11T13:50:33Z,2023-05-11T13:50:33Z,"Hi,

   I was running PureCN.R from the 2.0.2 and received an error:

""""""
Error in if (p.t > 0.2) { : missing value where TRUE/FALSE needed
Calls: runAbsoluteCN -> do.call -> <Anonymous> -> .pruneByVCF
""""""

Operating parameters:
""""""
PureCN.R --out  --tumor  --sampleid  --vcf  --fun-segmentation CBS --normaldb --intervals --genome hg19 --force --seed 123 --model betabin --mapping-bias-file  --cosmic-vcf-file  --model-homozygous --max-non-clonal 0.95
""""""

   Thank you!",ykzhang2022,https://github.com/lima1/PureCN/issues/263
I_kwDOBew4us5aPl_2,Errors with vcf file and PON,CLOSED,2022-12-29T20:37:15Z,2023-01-03T16:31:47Z,2023-01-03T16:31:47Z,,yqkiuo,https://github.com/lima1/PureCN/issues/264
I_kwDOBew4us5bYW6k,PureCN DNAcopy.seg output,CLOSED,2023-01-14T02:59:38Z,2023-01-22T02:20:04Z,2023-01-22T02:20:04Z,"Hi Markus,

I wanted to confirm something in the igv seg output as a sanity check.

In the output {sample_id}_dnacopy.seg, there are 7 columns:

```
ID      chrom   loc.start       loc.end num.mark        seg.mean        C
CL_PBL1T        1       12081   675653.5        76      0.26309240699952        2
CL_PBL1T        1       675653.5        1640337 464     -0.130242704302764      1
CL_PBL1T        1       1640338 1667719.5       31      -0.204790648698986      1.13874637873724
```

From documentation seg.mean is the log2 ratios not adjusted for purity/ploidy and C would be the segment integer copy number after using the formula `(2^(seg$seg.mean + log.ratio.offset) *  total.ploidy)/p - ((2 * (1 - p))/p)`. For downstream processes (like GISTIC), is it correct to just take the C value at face value? When compiling seg files and viewing on IGV, I've previously been just using the seg.mean, but I realize that C is probably the correct value to use. This does convert several large segments in some of my samples that were previously ~0 seg.mean into losses (CN =1) for a ploidy = 2 sample. ",Jwong684,https://github.com/lima1/PureCN/issues/265
I_kwDOBew4us5bs19p,Issue running runAbsoluteCN.R,CLOSED,2023-01-18T18:34:23Z,2023-01-20T16:24:28Z,2023-01-20T16:24:28Z,"**Describe the issue**
I am having trouble running the runAbsoluteCN function while following all of the code blocks in the [main vignette](https://bioconductor.org/packages/devel/bioc/vignettes/PureCN/inst/doc/PureCN.pdf). When I try to run runAbsoluteCN to generate **ret**, I am running into an error that seemingly has to due with Fortran for the DNAcopy package:
`Error in .Fortran(""smoothLR"", as.integer(n), as.double(genomdat[ina]),  : 
  ""smoothlr"" not available for .Fortran() for package ""DNAcopy""`
In case it's relevant, when I was setting up PureCN I was able to install but not load the DNAcopy dependency. I fixed this by [installing gfortran](https://mac.r-project.org/tools/) and subsequently installing the source package locally:
`$ gfortran --version`
`GNU Fortran (Homebrew GCC 12.2.0) 12.2.0
Copyright (C) 2022 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.`

`BiocManager::install(""DNAcopy"", type = ""source"")`

**To Reproduce**
library(DNAcopy)
library(PureCN)
set.seed(1234)
ac.file <- system.file(""extdata"", ""example_allelic_counts.tsv"", 
          package=""PureCN"")
vcf.ac <- readAllelicCountsFile(ac.file)

reference.file <- system.file(""extdata"", ""ex2_reference.fa"", 
    package = ""PureCN"", mustWork = TRUE)
bed.file <- system.file(""extdata"", ""ex2_intervals.bed"", 
        package = ""PureCN"", mustWork = TRUE)
mappability.file <- system.file(""extdata"", ""ex2_mappability.bigWig"", 
        package = ""PureCN"", mustWork = TRUE)

intervals <- import(bed.file)
mappability <- import(mappability.file)

preprocessIntervals(intervals, reference.file, 
    mappability = mappability, output.file = ""ex2_gc_file.txt"")

bam.file <- system.file(""extdata"", ""ex1.bam"", package=""PureCN"", 
    mustWork = TRUE)
interval.file <- system.file(""extdata"", ""ex1_intervals.txt"", 
    package = ""PureCN"", mustWork = TRUE)

calculateBamCoverageByInterval(bam.file = bam.file, 
 interval.file = interval.file, output.file = ""ex1_coverage.txt"")

library(PureCN)

normal.coverage.file <- system.file(""extdata"", ""example_normal.txt.gz"",
    package = ""PureCN"") 
normal2.coverage.file <- system.file(""extdata"", ""example_normal2.txt.gz"", 
    package = ""PureCN"") 
normal.coverage.files <- c(normal.coverage.file, normal2.coverage.file) 
tumor.coverage.file <- system.file(""extdata"", ""example_tumor.txt.gz"", 
    package = ""PureCN"") 
seg.file <- system.file(""extdata"", ""example_seg.txt"",
    package = ""PureCN"")
vcf.file <- system.file(""extdata"", ""example.vcf.gz"", package = ""PureCN"")
interval.file <- system.file(""extdata"", ""example_intervals.txt"", 
    package = ""PureCN"")

correctCoverageBias(normal.coverage.file, interval.file, 
    output.file = ""example_normal_loess.txt.gz"", plot.bias = TRUE)

normalDB <- createNormalDatabase(normal.coverage.files)
saveRDS(normalDB, file = ""normalDB.rds"")

normalDB <- readRDS(""normalDB.rds"")
pool <- calculateTangentNormal(tumor.coverage.file, normalDB)

normal.panel.vcf.file <- system.file(""extdata"", ""normalpanel.vcf.gz"",
                                     package = ""PureCN"")

bias <- calculateMappingBiasVcf(normal.panel.vcf.file, genome = ""h19"")
saveRDS(bias, ""mapping_bias.rds"")
mapping.bias.file <- ""mapping_bias.rds""

downloadFromUCSC <- FALSE
if (downloadFromUCSC) {
    library(rtracklayer)
    mySession <- browserSession(""UCSC"")
    genome(mySession) <- ""hg19""
    simpleRepeats <- track(ucscTableQuery(mySession, 
        track = ""Simple Repeats"", table = ""simpleRepeat""))
    export(simpleRepeats, ""hg19_simpleRepeats.bed"")
}

snp.blacklist <- ""hg19_simpleRepeats.bed""

ret <-runAbsoluteCN(normal.coverage.file = pool,
    tumor.coverage.file = tumor.coverage.file, vcf.file = vcf.file, 
    genome = ""hg19"", sampleid = ""Sample1"", 
    interval.file = interval.file, normalDB = normalDB,
#args.setMappingBiasVcf=list(
        # mapping.bias.file = mapping.bias.file
#),
    args.filterVcf=list(
        # snp.blacklist = snp.blacklist, 
        # stats.file = mutect.stats.file
    ),
    args.filterIntervals = list(
        min.total.counts = 50
    ), 
    post.optimize = FALSE, plot.cnv = FALSE, verbose = FALSE)

**Expected behavior**
I expected the output of this to look like 
`WARN [2023-01-18 12:11:21] Allosome coverage missing, cannot determine sex.`
`WARN [2023-01-18 12:11:21] Allosome coverage missing, cannot determine sex.`

but the actual output is 
`WARN [2023-01-18 12:11:21] Allosome coverage missing, cannot determine sex.`
`WARN [2023-01-18 12:11:21] Allosome coverage missing, cannot determine sex.`
`Error in .Fortran(""smoothLR"", as.integer(n), as.double(genomdat[ina]),  : 
  ""smoothlr"" not available for .Fortran() for package ""DNAcopy""`

I am not sure what is causing this .Fortran error for ""DNAcopy"" and can't find a resolution elsewhere. Any guidance is appreciated - thank you! 

**Session Info**

`R version 4.2.0 (2022-04-22)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Monterey 12.5

Matrix products: default
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] PureCN_2.4.0                DNAcopy_1.72.2              BiocManager_1.30.19        
 [4] VariantAnnotation_1.44.0    Rsamtools_2.14.0            Biostrings_2.66.0          
 [7] XVector_0.38.0              SummarizedExperiment_1.28.0 Biobase_2.58.0             
[10] MatrixGenerics_1.10.0       matrixStats_0.63.0          GenomicRanges_1.50.2       
[13] GenomeInfoDb_1.34.6         IRanges_2.32.0              S4Vectors_0.36.1           
[16] BiocGenerics_0.44.0        

loaded via a namespace (and not attached):
  [1] googledrive_2.0.0        VGAM_1.1-7               colorspace_2.0-3         rjson_0.2.21            
  [5] ellipsis_0.3.2           rprojroot_2.0.3          mclust_6.0.0             futile.logger_1.4.3     
  [9] fs_1.5.2                 rstudioapi_0.14          farver_2.1.1             remotes_2.4.2           
 [13] DT_0.27                  bit64_4.0.5              AnnotationDbi_1.60.0     fansi_1.0.3             
 [17] xml2_1.3.3               R.methodsS3_1.8.2        codetools_0.2-18         splines_4.2.0           
 [21] cachem_1.0.6             knitr_1.41               jsonlite_1.8.4           dbplyr_2.3.0            
 [25] R.oo_1.25.0              png_0.1-8                compiler_4.2.0           httr_1.4.4              
 [29] assertthat_0.2.1         Matrix_1.5-3             fastmap_1.1.0            gargle_1.2.1            
 [33] cli_3.6.0                formatR_1.14             htmltools_0.5.4          prettyunits_1.1.1       
 [37] tools_4.2.0              gtable_0.3.1             glue_1.6.2               GenomeInfoDbData_1.2.9  
 [41] dplyr_1.0.10             rappdirs_0.3.3           Rcpp_1.0.9               cellranger_1.1.0        
 [45] rhdf5filters_1.10.0      vctrs_0.5.1              rtracklayer_1.58.0       xfun_0.36               
 [49] stringr_1.5.0            ps_1.7.2                 lifecycle_1.0.3          restfulr_0.0.15         
 [53] XML_3.99-0.13            googlesheets4_1.0.1      zlibbioc_1.44.0          scales_1.2.1            
 [57] BSgenome_1.66.2          hms_1.1.2                parallel_4.2.0           rhdf5_2.42.0            
 [61] lambda.r_1.2.4           RColorBrewer_1.1-3       yaml_2.3.6               curl_5.0.0              
 [65] memoise_2.0.1            gridExtra_2.3            ggplot2_3.4.0            biomaRt_2.54.0          
 [69] stringi_1.7.12           RSQLite_2.2.20           desc_1.4.2               BiocIO_1.8.0            
 [73] GenomicFeatures_1.50.3   filelock_1.0.2           pkgbuild_1.4.0           BiocParallel_1.32.5     
 [77] rlang_1.0.6              pkgconfig_2.0.3          bitops_1.0-7             evaluate_0.20           
 [81] lattice_0.20-45          purrr_1.0.1              Rhdf5lib_1.20.0          labeling_0.4.2          
 [85] GenomicAlignments_1.34.0 htmlwidgets_1.6.1        processx_3.8.0           bit_4.0.5               
 [89] tidyselect_1.2.0         magrittr_2.0.3           R6_2.5.1                 generics_0.1.3          
 [93] DelayedArray_0.24.0      DBI_1.1.3                pillar_1.8.1             withr_2.5.0             
 [97] KEGGREST_1.38.0          RCurl_1.98-1.9           tibble_3.1.8             crayon_1.5.2            
[101] futile.options_1.0.1     utf8_1.2.2               BiocFileCache_2.6.0      rmarkdown_2.19          
[105] progress_1.2.2           grid_4.2.0               data.table_1.14.6        callr_3.7.3             
[109] blob_1.2.3               digest_0.6.31            R.utils_2.12.2           openssl_2.0.5           
[113] munsell_0.5.0            askpass_1.1   `
",adriennebrackey,https://github.com/lima1/PureCN/issues/266
I_kwDOBew4us5d_HKq,Cellular fraction calculation,CLOSED,2023-02-08T21:30:01Z,2023-02-17T14:44:59Z,2023-02-17T14:44:59Z,"Can someone please advise which of the functions included in this package compute cellular fraction? Additionally, if you can point out the lines of code where this calculation is done, that'd be very helpful. Thanks!  ",adriennebrackey,https://github.com/lima1/PureCN/issues/267
I_kwDOBew4us5ey6uN,PureCN docker can not run or start with no logs,CLOSED,2023-02-18T17:10:39Z,2023-03-15T12:57:55Z,2023-03-15T12:57:55Z,"Hello the authors,

I have pulled the docker image of PureCN (both 2.2.0, 2.0.2) and tried to run it on my local server. But when I executed docker run, the container showed the exit status, and docker start could not keep it running. I tried to retrieve the logs by using docker logs, however, no information was provided. In short, I can not even access the bash of PureCN image, which is the case for 2.2.0 and 2.0.2 Thanks for your help.

Xuezhu S Wang

<img width=""973"" alt=""image"" src=""https://user-images.githubusercontent.com/51666666/219878650-2c7e1e1e-2469-4ddd-a1c2-1553fde31612.png"">
",Selecton98,https://github.com/lima1/PureCN/issues/268
I_kwDOBew4us5fxtQN,Custom capture and its impact on CNV,CLOSED,2023-03-02T14:03:50Z,2023-03-10T19:36:45Z,2023-03-10T19:36:45Z,"Hi Markus!

I am starting to analyse data from a custom exome capture where a subset (5%) of target regions have ~ 3-5x higher coverage than the rest of the regions. I have a number of normal samples available for this although I am curious if I can expect the PureCN algorithm to be able to deal with this with default parameter settings? Do you have any suggestions on additional parameters I should consider? 

Thanks!
",waemm,https://github.com/lima1/PureCN/issues/269
I_kwDOBew4us5ge69W,Problem with preprocessIntervals,CLOSED,2023-03-10T10:20:31Z,2023-05-01T15:01:59Z,2023-05-01T15:01:59Z,"**Describe the issue**
I get an error when running preprocessIntervals.
The input files are a reference genome (hg19.fa, an index file, .fai, are in the same folder), a baits file in .bed.gz format (containing the columns: chr, start, stop, gene-name, also the index file, gzi are in the same folder), and a mappability file in .bigwig format from UCSC (wgEncodeCrgMapabilityAlign100mer.bigWig). 

**To Reproduce**
When running preprocessIntervals I get the following output:

WARN [2023-03-10 10:01:27] Found 434 overlapping intervals, starting at line 4.
WARN [2023-03-10 10:01:27] Found small target regions (< 100bp). Will resize them.
INFO [2023-03-10 10:01:29] Splitting 602 large targets to an average width of 400.
INFO [2023-03-10 10:01:30] Removing 1 intervals with low mappability score (<0.60).
WARN [2023-03-10 10:01:30] No reptiming scores provided.
INFO [2023-03-10 10:01:30] Calculating GC-content...
[E::faidx_fetch_seq2] Failed to retrieve block. (Seeking in a compressed, .gzi unindexed, file?)
Error in value[[3L]](cond) :  record 379 (chr12:993843-993942) failed
  file: C:/work/R/purecn/hg19.fa

**Session Info**
R version 4.2.2 (2022-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22621)

Matrix products: default

locale:
[1] LC_COLLATE=Swedish_Sweden.utf8  LC_CTYPE=Swedish_Sweden.utf8    LC_MONETARY=Swedish_Sweden.utf8
[4] LC_NUMERIC=C                    LC_TIME=Swedish_Sweden.utf8    

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] PureCN_2.4.0                VariantAnnotation_1.44.1    Rsamtools_2.14.0           
 [4] Biostrings_2.66.0           XVector_0.38.0              SummarizedExperiment_1.28.0
 [7] Biobase_2.58.0              GenomicRanges_1.50.2        GenomeInfoDb_1.34.9        
[10] IRanges_2.32.0              S4Vectors_0.36.2            MatrixGenerics_1.10.0      
[13] matrixStats_0.63.0          BiocGenerics_0.44.0         DNAcopy_1.72.3             

loaded via a namespace (and not attached):
 [1] httr_1.4.5               VGAM_1.1-7               bit64_4.0.5              splines_4.2.2           
 [5] R.utils_2.12.2           BiocFileCache_2.6.1      blob_1.2.3               BSgenome_1.66.3         
 [9] GenomeInfoDbData_1.2.9   yaml_2.3.7               progress_1.2.2           pillar_1.8.1            
[13] RSQLite_2.3.0            lattice_0.20-45          glue_1.6.2               digest_0.6.31           
[17] RColorBrewer_1.1-3       colorspace_2.1-0         R.oo_1.25.0              Matrix_1.5-3            
[21] XML_3.99-0.13            pkgconfig_2.0.3          biomaRt_2.54.0           zlibbioc_1.44.0         
[25] scales_1.2.1             BiocParallel_1.32.5      tibble_3.1.8             KEGGREST_1.38.0         
[29] ggplot2_3.4.1            generics_0.1.3           ellipsis_0.3.2           cachem_1.0.7            
[33] GenomicFeatures_1.50.4   cli_3.6.0                mclust_6.0.0             magrittr_2.0.3          
[37] crayon_1.5.2             memoise_2.0.1            R.methodsS3_1.8.2        fansi_1.0.4             
[41] xml2_1.3.3               tools_4.2.2              data.table_1.14.8        prettyunits_1.1.1       
[45] hms_1.1.2                formatR_1.14             BiocIO_1.8.0             lifecycle_1.0.3         
[49] stringr_1.5.0            Rhdf5lib_1.20.0          munsell_0.5.0            DelayedArray_0.23.2     
[53] lambda.r_1.2.4           AnnotationDbi_1.60.0     compiler_4.2.2           rlang_1.0.6             
[57] rhdf5_2.42.0             futile.logger_1.4.3      grid_4.2.2               RCurl_1.98-1.10         
[61] rhdf5filters_1.10.0      rjson_0.2.21             rappdirs_0.3.3           bitops_1.0-7            
[65] gtable_0.3.1             restfulr_0.0.15          codetools_0.2-19         DBI_1.1.3               
[69] curl_5.0.0               R6_2.5.1                 gridExtra_2.3            GenomicAlignments_1.34.0
[73] dplyr_1.1.0              rtracklayer_1.58.0       fastmap_1.1.1            bit_4.0.5               
[77] utf8_1.2.3               filelock_1.0.2           futile.options_1.0.1     stringi_1.7.12          
[81] parallel_4.2.2           Rcpp_1.0.10              vctrs_0.5.2              png_0.1-8               
[85] dbplyr_2.3.1             tidyselect_1.2.0  
",stumye,https://github.com/lima1/PureCN/issues/270
I_kwDOBew4us5huSuk,Remove copynumber dependency,OPEN,2023-03-24T14:42:46Z,2023-03-24T14:43:02Z,,"Obsolete in Bioc. ASCAT has a good replacement function, needs some work to incorporate.",lima1,https://github.com/lima1/PureCN/issues/271
I_kwDOBew4us5iFs5G,--bai option in Coverage.R has no effect,CLOSED,2023-03-29T12:02:00Z,2023-03-29T12:17:00Z,2023-03-29T12:17:00Z,"**Describe the issue**
The parser allows to specify a `--bai` option to load a ""non standard naming"" BAM index but apparently it doesn't ultimately get used.

(The issue will be closed if the actual cause is not found).

**To Reproduce**
Run `Coverage.R` with a BAM that has a different index naming than what PureCN expects (PureCN expects `.bai`, but other software uses `.bam.bai`, for example) specifying it with the `--bai`. 

**Expected behavior**
The BAM index should be picked up by PureCN.",lbeltrame,https://github.com/lima1/PureCN/issues/272
I_kwDOBew4us5izB0c,Add heterozygous SNP test for homozygous deletions,OPEN,2023-04-06T14:34:42Z,2023-04-06T14:34:42Z,,"Calling homozygous deletions should be accompanied by a double check of SNPs in the segment. If not balanced, then flag. If no SNPs, flag unless high likelihood of deleted. ",lima1,https://github.com/lima1/PureCN/issues/273
I_kwDOBew4us5i9F8A,Error in PureCN.R,CLOSED,2023-04-10T03:39:51Z,2023-05-09T13:05:27Z,2023-05-09T13:04:45Z,"
When I using the PureCN.R to calculate the purity and ploidy, I got the following error message:

**Error in if (is.na(posterior) || posterior < 0.5) flag <- TRUE :
  missing value where TRUE/FALSE needed
Calls: runAbsoluteCN ... .calcMsSegment -> lapply -> lapply -> FUN -> .calcMsSegmentC
Execution halted**
[PABP12.log](https://github.com/lima1/PureCN/files/11187448/PABP12.log)


I have used Mutect1 to prepare the mutation data. Among the 200 samples I  calculated, about 30 sample met the same error message.  Would you help check the log file to see which caused the error, and kindly tell me which I can do?
",WubinQ,https://github.com/lima1/PureCN/issues/274
I_kwDOBew4us5jTXZd,Question: Using Paired PSCBS algorithm,CLOSED,2023-04-13T09:04:33Z,2023-04-26T13:40:41Z,2023-04-26T13:40:41Z,"Hello
I'm working on (among other things) on matched tumor-normal data. My understanding is that PSCBS is good for low purity and or noisy samples.
Looking at the PSCBS package, it seems there is a Paired mode which considers normal data, and would give better results when matched data is available. However, PureCN only seems to implement the UnPaired PSCBS method. Assuming both statements are correct, how can I use Paired PSCBS? Should I use it as an external algorithm and give PureCN the segmented results?

Thank you,

Uri David",akaviaLab,https://github.com/lima1/PureCN/issues/275
I_kwDOBew4us5kEWSJ,stucked at generating mapping_bias.rds,CLOSED,2023-04-21T17:27:41Z,2023-04-25T18:25:14Z,2023-04-25T17:53:40Z,"Hi,
**I was trying to generate the WES mapping bias by:**
library(PureCN)
normal.panel.vcf.file <- ""PON/pon_WES.merge.vcf.gz""
bias <- calculateMappingBiasVcf(normal.panel.vcf.file, genome = ""hg38"")
saveRDS(bias, ""/pureCN/WES_mapping_bias.rds"")


**but it has been stuck since April 18:**
WARN [2023-04-18 22:11:02] Could not fit beta binomial dist for chr2:201824798 (alt 15,8,8,5,8,33,2,19,12,9,17,5,16,10, ref 0,0,0,0,0,0,0,0,0,0,0,0,0,0, fa 0.429,0.267,0.163,0.385,0.116,0.579,0.074,0.38,0.429,0.391,0.378,0.25,0.444,0.385).

INFO [2023-04-18 22:11:18] Clustering beta binomial fits...
INFO [2023-04-18 22:11:25] Assigning (1127/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:11:31] Processing variants 2750001 to 2800000...
INFO [2023-04-18 22:12:41] Clustering beta binomial fits...
INFO [2023-04-18 22:12:47] Assigning (990/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:12:54] Processing variants 2800001 to 2850000...
INFO [2023-04-18 22:14:30] Clustering beta binomial fits...
INFO [2023-04-18 22:14:41] Assigning (1262/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:14:49] Processing variants 2850001 to 2900000...
INFO [2023-04-18 22:16:10] Clustering beta binomial fits...
INFO [2023-04-18 22:16:15] Assigning (907/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:16:20] Processing variants 2900001 to 2950000...
INFO [2023-04-18 22:17:59] Clustering beta binomial fits...
INFO [2023-04-18 22:18:12] Assigning (1350/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:18:18] Processing variants 2950001 to 3000000...
INFO [2023-04-18 22:18:18] Position chr2:237139550
INFO [2023-04-18 22:20:21] Clustering beta binomial fits...
INFO [2023-04-18 22:20:39] Assigning (1425/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:20:47] Processing variants 3000001 to 3050000...
INFO [2023-04-18 22:22:11] Clustering beta binomial fits...
INFO [2023-04-18 22:22:18] Assigning (1005/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:22:25] Processing variants 3050001 to 3100000...
INFO [2023-04-18 22:23:53] Clustering beta binomial fits...
INFO [2023-04-18 22:24:04] Assigning (1252/50000) variants a clustered beta binomal fit.
INFO [2023-04-18 22:24:10] Processing variants 3100001 to 3150000...
INFO [2023-04-18 22:25:16] Clustering beta binomial fits...


**It seems there are some warnings showing like this:**
There were 12 warnings (use warnings() to see them)
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  :
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.


**I can generate the mapping bias for another dataset, but for this one, it got stuck in the middle (at chromosome 2). Is there any suggestions to check the input or solve this problem?
Another question is:  can I run this step using multiple cpus?
Thanks**

",hfl112,https://github.com/lima1/PureCN/issues/276
I_kwDOBew4us5kQLdu,Snp panel design,CLOSED,2023-04-24T20:16:34Z,2023-04-25T19:55:07Z,2023-04-25T19:55:07Z,"Hi Markus, 

We're looking at designing a new capture panel for CNV calling. I just wanted to get your advice on the design. You mentioned before that ideally you want a snp per 1mb to improve CNV calling with PureCN. 

1. What depth do you think is reasonable for these?
2. Is it worth including more snps in a finer grain around genes of interest for improved CNV calling?
3. Is it worth reducing snps in areas we care less about and increasing those in chromosomes or regions we care about?
4. Our estimates on the number of extra megabases was around 1-2, just curious if this lines up with your experience.

Thanks!",waemm,https://github.com/lima1/PureCN/issues/277
I_kwDOBew4us5kSOO0,different result when using same sample but with diff reference (of hg19 and hg38),CLOSED,2023-04-25T06:12:31Z,2023-05-05T13:56:36Z,2023-05-01T15:01:23Z,"hi

I have a question,  sample P  use different reference to align -> get bam， VCF(mutect2);  then use pureCN package to get `purity` and `ploidy`,  eg: hg19 an hg38
Q： is there some difference on algorithm， maybe will get difference result?  
eg:

I get one results use `hg19` ref

```
""Sampleid"",""Purity"",""Ploidy"",""Sex"",""Contamination"",""Flagged"",""Failed"",""Curated"",""Comment""
""P1_T"",0.22,1.99988171373899,""M"",0,TRUE,FALSE,FALSE,""NON-ABERRANT;LOW PURITY""
```

anther result use `hg38` ref:

```
""Sampleid"",""Purity"",""Ploidy"",""Sex"",""Contamination"",""Flagged"",""Failed"",""Curated"",""Comment""
""P1_T"",0.17,1.99878440469478,""M"",0,TRUE,FALSE,FALSE,""NON-ABERRANT;LOW PURITY""
```

they are purity `0.05`(0.22-0.17) diff , could you tell me the reason, which result should I belive?",nameOnStone,https://github.com/lima1/PureCN/issues/278
I_kwDOBew4us5ktRco,Error running PureCN.R,CLOSED,2023-04-29T15:04:52Z,2023-05-01T15:01:43Z,2023-05-01T15:01:43Z,"Hi,

I am running PureCN.R script with my WES data.  The script runs successfully for most of the samples.  But it failed for a few samples with the following error:

INFO [2023-04-29 08:05:55] Loading coverage files...
INFO [2023-04-29 08:05:59] Mean target coverages: 220X (tumor) 201X (normal).
INFO [2023-04-29 08:06:01] Mean coverages: chrX: 174.03, chrY: 90.76, chr1-22: 197.32.
INFO [2023-04-29 08:06:01] Mean coverages: chrX: 125.07, chrY: 90.86, chr1-22: 188.87.
INFO [2023-04-29 08:06:17] Removing 5448 intervals with missing log.ratio.
INFO [2023-04-29 08:06:17] Removing 21219 intervals excluded in normalDB.
INFO [2023-04-29 08:06:17] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-04-29 08:06:17] Removing 34 low count (< 100 total reads) intervals.
INFO [2023-04-29 08:06:17] Removing 8893 low coverage (< 0.0015X) intervals.
WARN [2023-04-29 08:06:18] Low number of off-target intervals. You might want to exclude them (217925 on-target, 18160 off-target, ratio 0.08).
INFO [2023-04-29 08:06:18] Using 236085 intervals (217925 on-target, 18160 off-target).
INFO [2023-04-29 08:06:18] Ratio of mean on-target vs. off-target read counts: 0.23
INFO [2023-04-29 08:06:18] Mean off-target bin size: 107712
INFO [2023-04-29 08:06:18] AT/GC dropout: 1.03 (tumor), 1.04 (normal), 0.98 (coverage log-ratio). 
INFO [2023-04-29 08:06:18] Loading VCF...
INFO [2023-04-29 08:06:26] Found 151623 variants in VCF file.
INFO [2023-04-29 08:06:27] Removing 1640 triallelic sites.
INFO [2023-04-29 08:06:27] 142385 (94.9%) variants annotated as likely germline (DB INFO flag).
WARN [2023-04-29 08:06:31] Found 6 variants with missing allelic fraction starting with chr1:31579040_G/GTTTAATTTCAGTGAGAGCTGGTGTGTCTATGTGTGTGTGTGTGTGATGTCTTCAGTTATAA. Removing them.
INFO [2023-04-29 08:06:31] SL250767_st_t is tumor in VCF file.
INFO [2023-04-29 08:06:31] 1853 homozygous and 528 heterozygous variants on chrX.
INFO [2023-04-29 08:06:31] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 7.52).
INFO [2023-04-29 08:06:31] Detected MuTect2 VCF.
INFO [2023-04-29 08:06:32] Removing 0 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-04-29 08:06:33] Removing 0 low quality variants with non-offset BQ < 25.
INFO [2023-04-29 08:06:33] Base quality scores range from 29 to 49 (offset by 1)
INFO [2023-04-29 08:06:33] High median base quality score (49). UMI-barcoded data?
INFO [2023-04-29 08:06:33] Minimum number of supporting reads ranges from 2 to 17, depending on coverage and BQS.
INFO [2023-04-29 08:06:53] Initial testing for significant sample cross-contamination: maybe
INFO [2023-04-29 08:06:54] Removing 45242 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2023-04-29 08:06:54] Total size of targeted genomic region: 66.31Mb (81.86Mb with 50bp padding).
INFO [2023-04-29 08:06:55] 25.3% of targets contain variants.
INFO [2023-04-29 08:06:55] Removing 33104 variants outside intervals.
INFO [2023-04-29 08:06:55] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2023-04-29 08:06:55] Loading mapping bias file mapping_bias_hg38.NIM.rds...
INFO [2023-04-29 08:06:57] Found 1095970 variants in mapping bias file.
INFO [2023-04-29 08:07:19] Imputing mapping bias for 7262 variants...
INFO [2023-04-29 08:09:32] Excluding 10559 novel or poor quality variants from segmentation.
INFO [2023-04-29 08:09:33] Excluding 7262 variants not in pool of normals from segmentation.
INFO [2023-04-29 08:09:33] Sample sex: M
INFO [2023-04-29 08:09:33] Segmenting data...
INFO [2023-04-29 08:09:33] Interval weights found, will use weighted PSCBS.
INFO [2023-04-29 08:09:33] MAPD of 44346 allelic fractions: 0.06 (0.07 adjusted).
INFO [2023-04-29 08:09:34] Setting undo.SD parameter to 0.750000.
INFO [2023-04-29 08:09:34] On-target much cleaner than off-target, finding on-target breakpoints first...
INFO [2023-04-29 08:09:34] Using 154725 high quality (out of 226471) on-target intervals for initial breakpoint calculation.
INFO [2023-04-29 08:10:31] Setting prune.hclust.h parameter to 0.200000.
INFO [2023-04-29 08:12:09] Found 1152 segments, exceeding max.segments threshold of 300.
INFO [2023-04-29 08:12:09] Setting undo.SD parameter to 1.125000.
INFO [2023-04-29 08:12:09] On-target much cleaner than off-target, finding on-target breakpoints first...
INFO [2023-04-29 08:12:09] Using 154725 high quality (out of 226471) on-target intervals for initial breakpoint calculation.
INFO [2023-04-29 08:12:59] Setting prune.hclust.h parameter to 0.200000.
Error: ‘nbrOfTCNsAfter >= nbrOfTCNsBefore’ is not TRUE but 
Execution halted

Any suggestions what I should do?  Thanks so much for your help.


",bosmont,https://github.com/lima1/PureCN/issues/279
I_kwDOBew4us5lAJc9,NormalDB.R exits with status 1 when it run for CNVkit,CLOSED,2023-05-03T17:52:50Z,2023-05-05T19:56:51Z,2023-05-05T19:56:50Z,"**Describe the issue**
I'm trying to test PureCN with CNVkit data.
The tutorial suggests to make mapping bias file:

```
Rscript $PURECN/NormalDB.R --out-dir $OUT_REF --normal-panel $NORMAL_PANEL \
    --assay agilent_v6 --genome hg19 --force
```

However if I'm doing this I get exit status: 1.
The file `mapping_bias_hg38.rds` is generated, but if I try to incorporate this step to the pipeline engine it thinks that the script failed.

The reason for exit status 1 is this part from NormalDB.R:

```
if (is.null(opt$coverage_files)) {
    if (is.null(opt$normal_panel)) stop(""need --coverage-files."")
    flog.warn(""No --coverage-files provided. Skipping normal coverage database generation."")
    q(status = 1)
}
```

Should it be `q(status = 0)` as it is expected to stop script here?

**To Reproduce**
I don't have data to share but to reproduce the issue you should need to execute the command from the tutorial.

**Expected behavior**
Exit with status 0.

**Log file**
There are no errors in the log. If I would not use pipeline engine I would not know that there is anything out of order.
",sleyn,https://github.com/lima1/PureCN/issues/284
I_kwDOBew4us5ly5cw,Subsampling SNP data,CLOSED,2023-05-12T15:37:10Z,2023-05-18T10:35:20Z,2023-05-18T10:33:51Z,"Hi Markus!

We have done some experiments with a large snpbackbone. We are interested in seeing what happens if we subsample the available SNPs to see the effect on segmentation and copy number output. I was just curious if there is a simple way to do this without having to rebuild the PON for instance. As a simple approximation I was thinking of simply removing the SNPS from the VCFs ? I'm not sure if this would work though as we would still get the offtarget coverage. Any suggestions would be appreciated though!!

Warren",waemm,https://github.com/lima1/PureCN/issues/286
I_kwDOBew4us5mD_3q,error/warning with NormalDB.R,CLOSED,2023-05-16T16:08:24Z,2023-05-18T17:17:08Z,2023-05-18T17:17:08Z,"Hi,  I am trying the create a normaldb with the following command:

Rscript /NormalDB.R --out-dir ~/work/WES/PureCN/normalDB --coverage-files ~/work/WES/PureCN/normal_coverages.list --normal-panel ~/work/WES/PureCN/germline_merged.vcf.gz --genome hg38

But I am getting the following:

############
INFO [2023-05-16 09:40:14] Loading PureCN 2.4.0...
INFO [2023-05-16 09:40:15] Creating mapping bias database.
INFO [2023-05-16 09:40:20] Processing variants 1 to 50000...
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
WARN [2023-05-16 09:50:55] Could not fit beta binomial dist for chr1:236739260 (alt 73,64,71,47,48,64,49, ref 0,0,0,0,0,0,0, fa 0.487,0.557,0.518,0.547,0.571,0.525,0.57).
INFO [2023-05-16 09:52:19] Clustering beta binomial fits...
INFO [2023-05-16 09:53:27] Assigning (7435/50000) variants a clustered beta binomal fit.
INFO [2023-05-16 09:53:31] Processing variants 50001 to 100000...
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
WARN [2023-05-16 09:54:12] Could not fit beta binomial dist for chr2:47161627 (alt 26,29,33,24,23,46,59,25,15,24,20,14,33,26,34,15,19, ref 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, fa 0.565,0.446,0.579,0.6,0.605,0.469,0.551,0.472,0.469,0.632,0.455,0.7,0.579,0.464,0.63,0.385,0.576).
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
WARN [2023-05-16 09:54:37] Could not fit beta binomial dist for chr2:68217039 (alt 22,19,14,25,6,16,21, ref 0,0,0,0,0,0,0, fa 0.688,0.594,0.519,0.595,0.207,0.471,0.525).
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
WARN [2023-05-16 09:56:26] Could not fit beta binomial dist for chr2:127637302 (alt 41,31,37,13,39,34,43,20,53,28,65,60, ref 0,0,0,0,0,0,0,0,0,0,0,0, fa 0.512,0.443,0.529,0.619,0.459,0.486,0.434,0.364,0.52,0.483,0.556,0.55).
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
WARN [2023-05-16 10:00:55] Could not fit beta binomial dist for chr3:20099809 (alt 21,11,11,14,32,18,13, ref 0,0,0,0,0,0,0, fa 0.5,0.407,0.44,0.538,0.444,0.419,0.52).
Error in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2,  : 
  could not obtain valid initial values. Try using 'etastart', 'coefstart' or 'mustart', else family-specific arguments such as 'imethod'.
In addition: There were 50 or more warnings (use warnings() to see the first 50)
WARN [2023-05-16 10:03:01] Could not fit beta binomial dist for chr3:98264547 (alt 66,76,85,60,141,73,109,90,71,99, ref 0,0,0,0,0,0,0,0,0,0, fa 0.471,0.535,0.528,0.42,0.456,0.474,0.441,0.443,0.399,0.483).
INFO [2023-05-16 10:05:39] Clustering beta binomial fits...
################

the script still runs even with the errors and warnings.  Is this a concern?  Anything I can do to fix the problem?

Thanks so much for your help
",bosmont,https://github.com/lima1/PureCN/issues/287
I_kwDOBew4us5mPt8w,Instability purity/ploidy output with same seed,CLOSED,2023-05-18T10:29:41Z,2023-05-26T13:58:39Z,2023-05-26T13:58:39Z,"Hi Markus,

We're having an issue in one of our samples with purity/ploidy instability, where running the test multiple times results in two possible outcomes occuring at roughly the same frequency ( over a sample of ~ 20 reruns)

""Sampleid"",""Purity"",""Ploidy"",""Sex"",""Contamination"",""Flagged"",""Failed"",""Curated"",""Comment""
""X1"",0.65,5.05043949141049,""F"",0.000322322020896157,TRUE,FALSE,FALSE,""RARE KARYOTYPE""

""Sampleid"",""Purity"",""Ploidy"",""Sex"",""Contamination"",""Flagged"",""Failed"",""Curated"",""Comment""
""X1"",0.58,4.31649445691918,""F"",0.00135930442034594,TRUE,FALSE,FALSE,""POTENTIAL SAMPLE CONTAMINATION""

We have set the seed but this does not seem to help. Is there anything else we can do here? 

We are using the 3rd party CNVkit input and also a relatively old version of PureCN (PureCN 1.22.2), could this be the issue?

Thanks!

",waemm,https://github.com/lima1/PureCN/issues/288
I_kwDOBew4us5nKFku,The distribution of purity,CLOSED,2023-05-29T12:43:06Z,2023-06-25T15:53:20Z,2023-06-25T15:53:20Z,"I compared the purity result from ABSOLUTE and PureCN, here you can see there are lots of duplicated values (~0.3) in PureCN. How can I optimize the PureCN pipeline?

Here are my code (WES data, Mutect2 + CNVkit results as input)

`# Run PureCN by providing the *.cnr and *.seg files from CNVkit
Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID \
    --sampleid=$SAMPLEID \
    --tumor $SAMPLEID"".converted.cnr"" \
    --segfile $SAMPLEID"".seg"" \
    --mapping-bias-file /proj/sens2022005/nobackup/data/PREDIX_HER2_WES/PureCN/data/mapping_bias_agilent_v6_hg38.rds
    --minpurity 0.1 \
    --max-non-clonal 0.4\
    --rds=rda \
    --sex=F \
    --vcf $SAMPLEID"".vcf"" \
    --genome hg38 \
    --funsegmentation Hclust \
    --force --postoptimize --seed 123 \
    --cores 16",WangKang-Leo,https://github.com/lima1/PureCN/issues/290
I_kwDOBew4us5nYrYw,Error in segmentByPairedPSCBS.default: All genotypes ('muN') are NAs,CLOSED,2023-05-31T15:48:05Z,2023-06-02T14:07:02Z,2023-06-02T14:07:02Z,"Hello,

I'm encountering an issue while running a pipeline that uses the segmentByPairedPSCBS.default function. The error message I receive is:

INFO [2023-05-31 23:29:25] ------------------------------------------------------------
INFO [2023-05-31 23:29:25] PureCN 2.6.1
INFO [2023-05-31 23:29:25] ------------------------------------------------------------
INFO [2023-05-31 23:29:25] Arguments: -tumor.coverage.file /mnt/nas/PureCN/TAS/tumors/001_AMU-001_CIS_coverage.txt.gz -log.ratio  -seg.file  -vcf.file /mnt/nas/PCGAv3/torrentvcf/001_AMU-001_CIS_IonXpress_050_dbsnp.vcf.gz -genome hg19 -sex F -args.setPriorVcf 6 -args.setMappingBiasVcf /mnt/nas/Reference/mapping_bias_pcga_v3_hg19.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 001_AMU-001_CIS -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /mnt/nas/Reference/baits_hg19_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -log.file PureCN/001_AMU-001_CIS/001_AMU-001_CIS.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2023-05-31 23:29:25] Using BiocParallel for parallel optimization.
INFO [2023-05-31 23:29:25] Loading coverage files...
INFO [2023-05-31 23:29:25] Mean target coverages: 4537X (tumor) 4541X (normal).
INFO [2023-05-31 23:29:25] Removing 2 low/high GC targets.
INFO [2023-05-31 23:29:25] Removing 14 intervals excluded in normalDB.
INFO [2023-05-31 23:29:25] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-05-31 23:29:25] Using 460 intervals (460 on-target, 0 off-target).
INFO [2023-05-31 23:29:25] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2023-05-31 23:29:25] AT/GC dropout: 1.18 (tumor), 1.18 (normal), 1.00 (coverage log-ratio). 
INFO [2023-05-31 23:29:26] High GC-bias in normal and/or tumor coverage.
INFO [2023-05-31 23:29:26] Loading VCF...
INFO [2023-05-31 23:29:26] Found 47 variants in VCF file.
INFO [2023-05-31 23:29:26] Removing 7 triallelic sites.
INFO [2023-05-31 23:29:27] 35 (87.5%) variants annotated as likely germline (DB INFO flag).
INFO [2023-05-31 23:29:27] 001_AMU-001_CIS is tumor in VCF file.
INFO [2023-05-31 23:29:27] 0 homozygous and 2 heterozygous variants on chrX.
INFO [2023-05-31 23:29:27] Sex from VCF: F (Fisher's p-value: 0.179, odds-ratio: 0.00).
INFO [2023-05-31 23:29:27] Removing 3 low quality variants with non-offset BQ < 25.
INFO [2023-05-31 23:29:27] Global base quality score of 49
INFO [2023-05-31 23:29:27] High median base quality score (49). UMI-barcoded data?
INFO [2023-05-31 23:29:27] Minimum number of supporting reads ranges from 2 to 4, depending on coverage and BQS.
INFO [2023-05-31 23:29:28] Initial testing for significant sample cross-contamination: maybe
INFO [2023-05-31 23:29:28] Removing 18 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2023-05-31 23:29:41] Removing 0 blacklisted variants.
INFO [2023-05-31 23:29:41] Total size of targeted genomic region: 0.11Mb (0.14Mb with 50bp padding).
INFO [2023-05-31 23:29:41] 3.9% of targets contain variants.
INFO [2023-05-31 23:29:41] Removing 2 variants outside intervals.
INFO [2023-05-31 23:29:42] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2023-05-31 23:29:42] Loading mapping bias file mapping_bias_pcga_v3_hg19.rds...
INFO [2023-05-31 23:29:44] Found 1436959 variants in mapping bias file.
INFO [2023-05-31 23:29:44] Imputing mapping bias for 0 variants...
INFO [2023-05-31 23:29:45] Excluding 6 novel or poor quality variants from segmentation.
INFO [2023-05-31 23:29:45] Excluding 0 variants not in pool of normals from segmentation.
INFO [2023-05-31 23:29:45] Sample sex: F
INFO [2023-05-31 23:29:45] Segmenting data...
INFO [2023-05-31 23:29:45] Interval weights found, will use weighted PSCBS.
INFO [2023-05-31 23:29:45] MAPD of 11 allelic fractions: 0.02 (0.04 adjusted).
INFO [2023-05-31 23:29:45] Very clean log-ratios, will increase default undo.SD parameter by a factor of 2.0.
INFO [2023-05-31 23:29:45] Setting undo.SD parameter to 1.000000.

Error in segmentByPairedPSCBS.default(CT = CT, thetaT = thetaT, thetaN = thetaN):
All genotypes ('muN') are NAs: 1 (100%) out of 1
In addition: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Execution halted


This error occurs during the execution of the runAbsoluteCN function. I'm using data that has been sequenced on an Ion Torrent sequencer and analyzed using a Target Amplicon Sequencing approach.

I've checked my input data and it seems to be in the correct format, but I'm still encountering this issue. Could you please help me understand what might be causing this error and how I might resolve it?

Thank you in advance for your assistance.",leap-ahead225,https://github.com/lima1/PureCN/issues/291
I_kwDOBew4us5nvFEn,callAlterations always outputs first solution,CLOSED,2023-06-04T14:07:43Z,2023-06-11T16:26:06Z,2023-06-11T16:26:06Z,"Hi,

Thank you for providing the great tool.

We can specify ID of solution in callAlterations function, but it seems to report first solution regardless of the specified ID. This is probably caused by the code below, which retrieve first solutions.
At row 54 of callAlterations.R
calls <- res$results[[1]]$gene.calls

I'm sorry if I misunderstood something.",un-saku,https://github.com/lima1/PureCN/issues/292
I_kwDOBew4us5oR9-L,Question - command to use with GATK panel of normals,CLOSED,2023-06-09T09:41:53Z,2023-06-11T17:57:08Z,2023-06-11T17:57:08Z,"**Describe the issue**
Hi.
We've been using Mutect2 to generate VCFs, which are merged by `bcftools  merge -O z -o` into one merged VCF file.
When running PureCN NormalDB.R, we've been using `--normal_panel merged.VCF.gz`
We're also creating a Genomics DB `gatk GenomicsDBImport` on all the unmerged files to use as gatk Panel of normals.

Should we run `NormalDB.R --normal_panel $GENOMICSDB-WORKSPACE-PATH/pon_db` or is this equivalent to using the merged.VCF? If not equivalent, what are the differences between the two commands please?

Thank you,

Uri David",akaviaLab,https://github.com/lima1/PureCN/issues/293
I_kwDOBew4us5oXf1B,Potential input for phylogenic analyses,CLOSED,2023-06-10T14:21:35Z,2023-07-16T20:31:10Z,2023-07-16T20:31:10Z,"I want to use allele specific copy number of multiple samples for phylogenic analyses, like PycloneIV, PhylogenicNDT. But I found the loh.csv file have some NA values on ""M"" column (minor copy number). Here I attached my LOH results.
[sample1_LOH.txt](https://github.com/lima1/PureCN/files/11712610/sample1_LOH.txt)
",WangKang-Leo,https://github.com/lima1/PureCN/issues/294
I_kwDOBew4us5oeIau,Update GenomicsDB functions for new API,CLOSED,2023-06-12T13:05:23Z,2023-06-12T22:56:33Z,2023-06-12T22:56:33Z,Seems like recent changes in GenomicsDB-R broke the import of GenomicsDB.,lima1,https://github.com/lima1/PureCN/issues/296
I_kwDOBew4us5pTDO-,Strange notation in _genes.csv,CLOSED,2023-06-21T03:17:03Z,2023-06-26T18:54:31Z,2023-06-26T18:54:31Z,"I am using the output of CNVkit as pureCN input, and recently found the following problem in _genes.csv.
_______________
MRDBR-074,OR4F3,chr1,450740,181368225,2,NA,-0.351381147174662,1,6,-0.30202443974233,-0.33964643974233,-0.22678043974233,FALSE,20,NA,371,1,FALSE,FALSE
MRDBR-074,OR4F16,chr1,450740,181368225,2,NA,-0.351381147174662,1,6,-0.30202443974233,-0.33964643974233,-0.22678043974233,FALSE,20,NA,371,1,FALSE,FALSE
MRDBR-074,OR4F29,chr1,450740,181368225,2,NA,-0.351381147174662,1,6,-0.30202443974233,-0.33964643974233,-0.22678043974233,FALSE,20,NA,371,1,FALSE,FALSE
___________
It contains pretty much most of chr1, which is very strange.
I checked .cnr, the output of CNVkit, which becomes the input.
___________
chr1	450739	451208	OR4F3,OR4F16,OR4F29	0.230672	271.296	0.785925
chr1	451208	451678	OR4F3,OR4F16,OR4F29	0.207457	565.611	0.567737
chr1	685715	686184	OR4F3,OR4F29,OR4F16	0.237672	262.896	0.844498
chr1	686184	686654	OR4F3,OR4F29,OR4F16	0.217322	573.151	0.550964
chr5	181367286	181367755	OR4F16,OR4F29,OR4F3	0.220797	567.045	0.602314
chr5	181367755	181368225	OR4F16,OR4F29,OR4F3	0.184312	253.955	0.810909
________________
It seems to me that pureCN is using the start position of chr1 and the end position of chr5 of the gene.
I've been trying to find an option to isolate this but couldn't figure it out.
Is there any way to isolate this?
As a result of checking, more genes show this pattern than expected.
I think they should be separated by position, at least if they are on different chromosomes.
If the feature is already implemented, can you tell me how to handle it?

I enter the command as follows
(This is the part of the shell script that receives the variable from earlier)
______________________
Rscript ${pureCN}/PureCN.R --out ${output_dir} \\
--sampleid ${donor} \\
--tumor ${output_dir}/${donor}.cnr \\
--seg-file ${output_dir}/${donor}.seg \\
--vcf ${PBMC_vcf} \\
--snp-blacklist ${blacklist} \\
--genome hg38 \\
--fun-segmentation Hclust \\
--base-quality-offset 0 \\
--force --post-optimize --seed 765 ",Jongseong-Ahn,https://github.com/lima1/PureCN/issues/298
I_kwDOBew4us5qCTYa,Dimension of Tangent Normal Projection,CLOSED,2023-06-28T13:46:29Z,2023-06-30T12:15:20Z,2023-06-30T12:15:20Z,"I was wondering, what is the motivation behind the choice of the default value num.eigen=20 in processMultipleSamples() function, i.e. the dimension of the tangent normal projection? Is there some informal rule which allows to choose this number depending on the size of the pool of normals, and the total number of targets? In my case, the available pool size is 22, and the number of targets is around 150_000.",artuuge,https://github.com/lima1/PureCN/issues/300
I_kwDOBew4us5qIqI8,Inconsistent VCF File Validation Request for Utilizing pureCN with MuTect,CLOSED,2023-06-29T11:41:14Z,2023-07-08T13:44:15Z,2023-07-08T13:44:15Z,"Issue Description:
We are currently working on utilizing pureCN with MuTect, but we have encountered inconsistencies with our VCF files. To ensure the accuracy and reliability of our analysis, we are seeking assistance to validate our VCF files.

Request:
We kindly request guidance or suggestions on how to validate our VCF files effectively and transform them in pureCN friendly format. Any insights or recommended tools for validating VCF files would be greatly appreciated.


**Error log:**
`
WARN [2023-06-28 08:00:30] Allosome coverage missing, cannot determine sex.
WARN [2023-06-28 08:00:30] Allosome coverage missing, cannot determine sex.
[W::bcf_hrec_check] Invalid tag name: "".""
[W::bcf_hrec_check] Invalid tag name: "".""
WARN [2023-06-28 08:00:35] VCF contains both DB and POPAF INFO fields. Will ignore POPAF.
Error in if (sum(idx)) { : the condition has length > 1
Calls: runAbsoluteCN -> .readAndCheckVcf
In addition: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Execution halted
`

Thank you for your support!
",DimitrisGrig,https://github.com/lima1/PureCN/issues/301
I_kwDOBew4us5qXd6V,mpileup vcf error DB info field,CLOSED,2023-07-02T08:58:46Z,2023-07-06T11:43:16Z,2023-07-05T17:41:38Z,"When I call variants using the mpileup workflow and annotate my vcfs using annovar using the databases refGene,cytoBand,exac03,avsnp147,dbnsfp30a,cosmic92_noncoding,cosmic92_coding and run

Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEIDOUT \
--tumor $covout/${SAMPLEID}_coverage_loess.txt.gz \
--sampleid $SAMPLEID \
--funsegmentation PSCBS \
--vcf $INPUT_VCF \
--normaldb $normal_db/normalDB_agilent_v6_hg38.rds \
--intervals $baits \
--snpblacklist $srr \
--genome hg38 \
--postoptimize \
--force --seed 123 \
--modelhomozygous True \
--minpurity=0.75\
--parallel TRUE \
--cores=4

I get the error:

Error: vcf.file has no %s or %s info field for membership in germline
databases.DBPOP_AF

This is most likely a user error due to invalid input data or
parameters (PureCN 1.22.2).

Any suggestion how to fix this?

Everything works well with Mutect2-derived vcfs - but I want to use Mpileup here since its cell lines.",kristianunger,https://github.com/lima1/PureCN/issues/302
I_kwDOBew4us5qdMlS,Error in PureCN Integration with Nextflow: misalignment between tumor coverage file and normalDB,CLOSED,2023-07-03T12:02:22Z,2023-07-06T13:28:11Z,2023-07-06T13:28:10Z,"Hi Markus,
We are currently working on integrating PureCN with Nextflow and, in particular, with nf-core tools.

In particular, to ensure reproducibility, we used the toy datasets present in repo: https://github.com/lima1/PureCN/tree/devel/inst/extdata

These datasets have proven to work smoothly for PureCN/Coverage, PureCN/Intervalfile, and PureCN/NormalDB operations, as evidenced by this successful example: https://github.com/nf-core/modules/pull/3127

However, when building the test workflow for PureCN/run, the pipeline raises the following error:

`Error: tumor.coverage.file and normalDB do not align.`

To construct the test workflow, we employed the file `ex1.bam` for generating the coverage file, utilized the `ex1_intervals.txt` file as the interval file, and employed the files `example_normal.txt.gz` and `example_normal2.txt.gz` to build the normalDB.

Is there a known solution to resolve this misalignment issue? Alternatively, should we consider avoiding the use of the toy datasets altogether?

",aldosr,https://github.com/lima1/PureCN/issues/303
I_kwDOBew4us5qzLp4,"How to extract BAF from PureCN output files, which file to use ?",CLOSED,2023-07-06T15:40:30Z,2023-08-09T15:43:17Z,2023-07-08T13:43:46Z,,lmanchon,https://github.com/lima1/PureCN/issues/306
I_kwDOBew4us5rHoMn,Potential VCF issue - char '/' not in lookup table,CLOSED,2023-07-10T16:54:41Z,2023-07-11T10:29:12Z,2023-07-11T10:29:12Z,"Hi,

I'm having a problem running PureCN, which seems to be a problem with the vcf file - I've attached this. This is a Varscan vcf, but I can't figure out what's wrong with it. The error references "" char '/' "" being an issue, but I can't identify the cause of this in the vcf. I'm using the latest conda version of PureCN.

```
INFO [2023-07-10 17:34:48] Arguments: -normal.coverage.file  -tumor.coverage.file IS001_13_cnvkit_results/IS001-13_R1_001.sorted.cnr -log.ratio  -seg.file IS001_13_cnvkit_results/IS001_13_cnvkit.seg -vcf.file Varscan/IS001_13_normal-tumour.snp.vcf -normalDB  -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid IS001_13 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file  -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -BPPARAM  -log.file IS001_13_pureCN/IS001_13.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-07-10 17:34:48] Loading coverage files...
INFO [2023-07-10 17:34:52] Found log2-ratio in tumor coverage data.
INFO [2023-07-10 17:34:52] Mean coverages: chrX: 178.55, chrY: 166.11, chr1-22: 314.94.
INFO [2023-07-10 17:34:52] Mean coverages: chrX: 178.55, chrY: 166.11, chr1-22: 314.94.
INFO [2023-07-10 17:34:53] Using 220214 intervals (189647 on-target, 30567 off-target).
INFO [2023-07-10 17:34:53] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2023-07-10 17:34:53] Mean off-target bin size: 69216
INFO [2023-07-10 17:34:53] Loading VCF...
Error in h(simpleError(msg, call)) : 
  error in evaluating the argument 'flesh' in selecting a method for function 'relist': key 47 (char '/') not in lookup table
Calls: runAbsoluteCN ... make_XStringSet_from_strings -> .Call2 -> .handleSimpleError -> h
```

Any advice would be really appreciated!

Thanks,
Emma


[IS001_13_normal-tumour.snp.txt](https://github.com/lima1/PureCN/files/12004458/IS001_13_normal-tumour.snp.txt)
",emmabailey94,https://github.com/lima1/PureCN/issues/307
I_kwDOBew4us5sNOtC,Question: Using other variant callers?,CLOSED,2023-07-21T08:41:00Z,2023-09-06T22:20:54Z,2023-09-06T22:20:54Z,"**Describe the issue**
My company is having discussions about using variant callers other than Mutect2. One person mentioned that he read (or thinks he read) that PureCN relies on specific parts of the Mutetct2 algorithm or output. Is this correct?
Can we use variant callers in addition to Mutect2?

One discussion we're having is if we're using additional variant callers, is it better to use Intersect or Union for PureCN? In general, we get less False Positives if use Intersect.

If this is in the documentation, I apologize.

Thank you,

Uri David",akaviaLab,https://github.com/lima1/PureCN/issues/308
I_kwDOBew4us5sNROk,Question: testing additional SNPS,CLOSED,2023-07-21T08:48:27Z,2023-09-06T22:20:37Z,2023-09-06T22:20:37Z,"**Describe the issue**
We've been working on a capture kit that has coverage for WES, plus regions that we are more interested in. It turns out our capture kitS are missing some sections, so we decided to add a third one.
Due to prodcution issues when buying them, we can't just get one capture kit that will have all regions.

We're trying to run the same samples with spiking in the NEW capture kit at different attempted coverage levels - 0, 10, 25, 50, 100. The samples we are planning to run include 7 cancer samples, and one normal sample as a control.

The goal is to see which concentration/dilution of the NEW capture kit improves our results, comparing to other methods of ascertaining copy number on these samples.

Problem - we don't have a PON using the NEW capture kit. We only have PON samples using the previous two (combined).
After figuring out the optimal concentration, we will make a PON using more samples and use it going forward.

First question - do we need a PON? Opinions are divided - I think we need a PON of some samples (minimum 4). Do we need a PON? Is there a minimum number of samples considering we're doing 8 samples in total?
Second question - What will we be able to tell from this experiment with or without PON?
Third question - assuming we can only do one concentration of NEW capture kit spike in for the PON (which is what we've been discussing with the lab people), is there a best concentration of spike in to use?

I'm sorry about bombarding you with questions, but you've been super helpful, and I hope you ran into something similar.

Thank you,

Uri David",akaviaLab,https://github.com/lima1/PureCN/issues/309
I_kwDOBew4us5sNYCo,Question about solutions interpretation and PON,CLOSED,2023-07-21T09:07:51Z,2023-10-09T14:48:16Z,2023-10-09T14:48:16Z,"Hello!

I am analysing WES data (expected coverage 200x) derived from archival FFPE samples. Some samples have a matched control (peritumoral tissue) some are tumor-only. A group of blood samples from unrelated healthy individuals were also sequenced in order to build a PON for artifacts filtering. I was running PureCN with PSBCS segmentation and following the best parctices (but for some samples the quality is not great as you can imagine)

Estimating purity and ploidy , I tried to look at the solutions considering the information I have from the pathology (which I suppose in many cases is overestimated). Given it is the first time I am analysing these data, I would kindly ask information about how to interpret some solutions. This would help a lot to get some experience on what to look for!

I am attaching three examples (all flagged because of poor GOF) for which I am in doubt about the solution to select, you can see on the left the VAF density plot, in the middle the maximum likelihood solution, and on the right another less likely solution on which I have doubts. Could you tell me if for you in each case the best solution is the more supportive one looking at the graphs? 

In general, my main doubts are about:
•	BAF plots in which BAF appears to be at 0.5 for extensive regions of the genome (Image 1 and 2). Are there any considerations I can make to determine whether the tetraploid state or the diploid state is more appropriate? Is a double peak in the VAF plot a sign of being tertraploid? 
•	BAF plots that are quite noisy (Image 3 and 4). If the signal is not clear, would you keep the selected solution or choose a more conservative (lower ploidy) state?
•	In case conflicting results between pathology purity estimation and the best solution provided by tools such PureCN, which considerations would you do? Are there any considerations based on VAF that could be made to guide the solution curation?

Regarding technical details, as confirmation I wanted to know if it is fine to build a PON using normal blood samples that were sequenced at lower coverage (60x) vs the FFPE tumor samples (200x)? Moreover, since I have also 6 FFPE paired normal samples, I was creating a PON using both normal bloods and  normal tissues to possibly increase the  artifacts filtering due to FFPE. The algorithm worked and I obtained lower levels of tumor/normal noise ratio with respect with the PON build only with blood normal samples. Do you think it is fine to proceed like this?

Thank you very much for the time and suggestions you may dedicate!
Have a nice day! 

Francesca  

![CNA_Image1_sample_18_T_1_MA](https://github.com/lima1/PureCN/assets/133041633/fe848407-a550-46ab-9900-deca62576e1e)
![CNA_Image2_sample_14_T_1_MA](https://github.com/lima1/PureCN/assets/133041633/d1f0a770-914a-41fa-b126-426d8b6f53b8)
![CNA_Image3_sample_23_T_1_MA](https://github.com/lima1/PureCN/assets/133041633/60d65065-a780-41dc-aad9-cd0ba5910771)
![CNA_Image4_sample_17_T_1_MA](https://github.com/lima1/PureCN/assets/133041633/81f4bd0c-00c8-4208-8b64-911f0b2f1678)
",tettamanzif,https://github.com/lima1/PureCN/issues/310
I_kwDOBew4us5snMTc,Question regarding version 2.4 PureCN,CLOSED,2023-07-26T11:33:04Z,2023-09-11T07:35:32Z,2023-09-09T14:23:48Z,"Hi,

We are using version bioconductor-purecn V 2.0.2 for our analysis of the selection of clonal mutations, recently we have tried V 2.4.0 and noticed that many mutations are filtered out specifically ones that have BQ < 25, but our VCF file has only MBQ, meaning that uses that for filtering?
The problem is that those are mutations relevant to us such as KRAS/TP53 and so on. We have tried to set min.supporting reds =0 but didn't turn off this filter. Have you any comments/recommendations for the version to use?
Attached are log files for the same sample run with both versions
[C14_ffpe.purecn_V2.0.2.log](https://github.com/lima1/PureCN/files/12171082/C14_ffpe.purecn_V2.0.2.log)
[C14_ffpe.purecn_V2.4.0.log](https://github.com/lima1/PureCN/files/12171083/C14_ffpe.purecn_V2.4.0.log)
Thank you in advance.",maxanes,https://github.com/lima1/PureCN/issues/311
I_kwDOBew4us5tznOm,Question regarding the vcf output,CLOSED,2023-08-08T23:49:32Z,2023-08-10T19:56:20Z,2023-08-10T19:56:20Z,"Hello,

I have a question about the `--out-vcf` flag when running `PureCN`. Does the output `vcf` contain only somatic variants?
After I used this flag, I got germline and somatic variants too.

Thank you in advance for your time and reply!",mkyriak,https://github.com/lima1/PureCN/issues/312
I_kwDOBew4us5uGbG5,poor GOF in most samples,CLOSED,2023-08-11T17:20:06Z,2023-09-06T21:28:35Z,2023-09-06T20:51:55Z,"**Describe the issue**
I have run pureCN using the best practices from the vignette (except using mutect 4.2.6.1) on a set of mostly FFPE samples on a large panel data. I have 40 FFPE normal samples I made these into a normal database and then ran pureCN on an additional 24 samples. For 23 of the 24 samples I get a POOR GOF flag, do you have any suggestions on how to improve these?

Thanks for your time.

**To Reproduce**
Rscript PureCN/PureCN.R \
--out ${results_dir}/${sample_id} \
--tumor ${results_dir}/${sample_id}/${sample_id}.hg38.final_coverage_loess.txt.gz \
--sampleid $sample_id \
--vcf $results_dir/case_tgc2_files/${sample_id}.mutect2.filtered.vcf \
--fun-segmentation PSCBS \
--normaldb $results_dir/normalDB_opxv8_hg38.rds \
--mapping-bias-file $results_dir/mapping_bias_opxv8_hg38.rds \
--intervals $invervals_ot_txt \
--snp-blacklist $work_dir/hg38_simpleRepeats.bed \
--genome hg38 \
--model betabin \
--cores 8 \
--cosmic-vcf-file ${cosmic_vcf} \
--out-vcf \
--force \
--post-optimize \
--seed 123

**Log file**
INFO [2023-08-10 19:28:33] ------------------------------------------------------------
INFO [2023-08-10 19:28:33] PureCN 2.6.4
INFO [2023-08-10 19:28:33] ------------------------------------------------------------
INFO [2023-08-10 19:28:33] Arguments: -tumor.coverage.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/007R24_H03_OPXv8_KB0093/007R24_H03_OPXv8_KB0093.hg38.final_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/case_tgc2_files/007R24_H03_OPXv8_KB0093.mutect2.filtered.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/mapping_bias_opxv8_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 007R24_H03_OPXv8_KB0093 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/OPXv8.032423.interval.off_target.hg38.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file /mnt/home/atimms/misc/purecn_test/COSMICv97.GRCh38.Variants.normalized.dedup.vcf.gz -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -log.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/007R24_H03_OPXv8_KB0093/007R24_H03_OPXv8_KB0093.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2023-08-10 19:28:33] Using BiocParallel for parallel optimization.
INFO [2023-08-10 19:28:33] Loading coverage files...
INFO [2023-08-10 19:28:34] Mean target coverages: 207X (tumor) 200X (normal).
INFO [2023-08-10 19:28:35] Mean coverages: chrX: 99.39, chrY: 25.97, chr1-22: 188.89.
INFO [2023-08-10 19:28:35] Mean coverages: chrX: 108.91, chrY: 25.97, chr1-22: 185.96.
INFO [2023-08-10 19:28:39] Removing 104 intervals with missing log.ratio.
INFO [2023-08-10 19:28:39] Removing 18 low/high GC targets.
INFO [2023-08-10 19:28:39] Removing 438 intervals excluded in normalDB.
INFO [2023-08-10 19:28:39] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-08-10 19:28:39] Removing 9079 low count (< 100 total reads) intervals.
INFO [2023-08-10 19:28:39] Removing 678 low coverage (< 0.0015X) intervals.
INFO [2023-08-10 19:28:39] Using 19170 intervals (12163 on-target, 7007 off-target).
INFO [2023-08-10 19:28:39] Ratio of mean on-target vs. off-target read counts: 3.97
INFO [2023-08-10 19:28:39] Mean off-target bin size: 176896
INFO [2023-08-10 19:28:39] AT/GC dropout: 1.05 (tumor), 1.07 (normal), 0.98 (coverage log-ratio). 
INFO [2023-08-10 19:28:39] Loading VCF...
INFO [2023-08-10 19:28:40] Found 13323 variants in VCF file.
INFO [2023-08-10 19:28:41] Removing 1083 triallelic sites.
INFO [2023-08-10 19:28:41] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2023-08-10 19:28:41] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2023-08-10 19:28:41] 5891 (48.1%) variants annotated as likely germline (DB INFO flag).
INFO [2023-08-10 19:28:42] 007R24_H03_OPXv8_KB0093 is tumor in VCF file.
INFO [2023-08-10 19:28:42] 93 homozygous and 12 heterozygous variants on chrX.
INFO [2023-08-10 19:28:42] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 13.59).
INFO [2023-08-10 19:28:42] Detected MuTect2 VCF.
INFO [2023-08-10 19:28:42] Removing 6321 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-08-10 19:28:42] Removing 5422 low quality variants with non-offset BQ < 25.
INFO [2023-08-10 19:28:43] Base quality scores range from 24 to 31 (offset by 1)
INFO [2023-08-10 19:28:43] Minimum number of supporting reads ranges from 2 to 15, depending on coverage and BQS.
INFO [2023-08-10 19:28:44] Initial testing for significant sample cross-contamination: unlikely
INFO [2023-08-10 19:28:44] Removing 185 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2023-08-10 19:28:49] Removing 19 blacklisted variants.
INFO [2023-08-10 19:28:49] Total size of targeted genomic region: 2.68Mb (3.66Mb with 50bp padding).
INFO [2023-08-10 19:28:49] 2.1% of targets contain variants.
INFO [2023-08-10 19:28:49] Removing 28 variants outside intervals.
INFO [2023-08-10 19:30:27] ------------------------------------------------------------
INFO [2023-08-10 19:30:27] PureCN 2.6.4
INFO [2023-08-10 19:30:27] ------------------------------------------------------------
INFO [2023-08-10 19:30:27] Arguments: -tumor.coverage.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/007R24_H03_OPXv8_KB0093/007R24_H03_OPXv8_KB0093.hg38.final_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/case_tgc2_files/007R24_H03_OPXv8_KB0093.mutect2.filtered.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/mapping_bias_opxv8_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 007R24_H03_OPXv8_KB0093 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/OPXv8.032423.interval.off_target.hg38.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file /mnt/home/atimms/misc/purecn_test/COSMICv97.GRCh38.Variants.normalized.dedup.vcf.gz -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -log.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/007R24_H03_OPXv8_KB0093/007R24_H03_OPXv8_KB0093.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2023-08-10 19:30:27] Using BiocParallel for parallel optimization.
INFO [2023-08-10 19:30:27] Loading coverage files...
INFO [2023-08-10 19:30:28] Mean target coverages: 207X (tumor) 200X (normal).
INFO [2023-08-10 19:30:28] Mean coverages: chrX: 99.39, chrY: 25.97, chr1-22: 188.89.
INFO [2023-08-10 19:30:28] Mean coverages: chrX: 108.91, chrY: 25.97, chr1-22: 185.96.
INFO [2023-08-10 19:30:33] Removing 104 intervals with missing log.ratio.
INFO [2023-08-10 19:30:33] Removing 18 low/high GC targets.
INFO [2023-08-10 19:30:33] Removing 438 intervals excluded in normalDB.
INFO [2023-08-10 19:30:33] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-08-10 19:30:33] Removing 9079 low count (< 100 total reads) intervals.
INFO [2023-08-10 19:30:33] Removing 678 low coverage (< 0.0015X) intervals.
INFO [2023-08-10 19:30:33] Using 19170 intervals (12163 on-target, 7007 off-target).
INFO [2023-08-10 19:30:33] Ratio of mean on-target vs. off-target read counts: 3.97
INFO [2023-08-10 19:30:33] Mean off-target bin size: 176896
INFO [2023-08-10 19:30:33] AT/GC dropout: 1.05 (tumor), 1.07 (normal), 0.98 (coverage log-ratio). 
INFO [2023-08-10 19:30:33] Loading VCF...
INFO [2023-08-10 19:30:35] Found 13323 variants in VCF file.
INFO [2023-08-10 19:30:35] Removing 1083 triallelic sites.
INFO [2023-08-10 19:30:35] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2023-08-10 19:30:35] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2023-08-10 19:30:35] 5891 (48.1%) variants annotated as likely germline (DB INFO flag).
INFO [2023-08-10 19:30:36] 007R24_H03_OPXv8_KB0093 is tumor in VCF file.
INFO [2023-08-10 19:30:36] 93 homozygous and 12 heterozygous variants on chrX.
INFO [2023-08-10 19:30:36] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 13.59).
INFO [2023-08-10 19:30:36] Detected MuTect2 VCF.
INFO [2023-08-10 19:30:36] Removing 6321 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-08-10 19:30:37] Removing 5422 low quality variants with non-offset BQ < 25.
INFO [2023-08-10 19:30:37] Base quality scores range from 24 to 31 (offset by 1)
INFO [2023-08-10 19:30:37] Minimum number of supporting reads ranges from 2 to 15, depending on coverage and BQS.
INFO [2023-08-10 19:30:38] Initial testing for significant sample cross-contamination: unlikely
INFO [2023-08-10 19:30:38] Removing 185 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2023-08-10 19:30:45] Removing 19 blacklisted variants.
INFO [2023-08-10 19:30:45] Total size of targeted genomic region: 2.68Mb (3.66Mb with 50bp padding).
INFO [2023-08-10 19:30:45] 2.1% of targets contain variants.
INFO [2023-08-10 19:30:45] Removing 28 variants outside intervals.
INFO [2023-08-10 19:30:46] Reading COSMIC VCF...
INFO [2023-08-10 19:30:54] Found COSMIC annotation in VCF. Requiring 6 hits.
INFO [2023-08-10 19:30:54] Setting somatic prior probabilities for hits to 0.995000 or to 0.500000 if in both COSMIC and dbSNP.
INFO [2023-08-10 19:30:54] Loading mapping bias file mapping_bias_opxv8_hg38.rds...
INFO [2023-08-10 19:30:54] Found 142859 variants in mapping bias file.
INFO [2023-08-10 19:30:55] Imputing mapping bias for 9 variants...
INFO [2023-08-10 19:30:55] Excluding 111 novel or poor quality variants from segmentation.
INFO [2023-08-10 19:30:55] Excluding 9 variants not in pool of normals from segmentation.
INFO [2023-08-10 19:30:56] Sample sex: M
INFO [2023-08-10 19:30:56] Segmenting data...
INFO [2023-08-10 19:30:56] Interval weights found, will use weighted PSCBS.
INFO [2023-08-10 19:30:56] MAPD of 38 allelic fractions: 0.10 (0.12 adjusted).
INFO [2023-08-10 19:30:56] Setting undo.SD parameter to 0.750000.
INFO [2023-08-10 19:30:56] On-target much cleaner than off-target, finding on-target breakpoints first...
INFO [2023-08-10 19:30:56] Using 11752 high quality (out of 12163) on-target intervals for initial breakpoint calculation.
INFO [2023-08-10 19:31:17] Setting prune.hclust.h parameter to 0.200000.
INFO [2023-08-10 19:31:42] Setting prune.hclust.h parameter to 0.200000.
INFO [2023-08-10 19:31:44] Found 90 segments with median size of 13.49Mb.
INFO [2023-08-10 19:31:44] Using 265 variants.
INFO [2023-08-10 19:31:44] Mean standard deviation of log-ratios: 0.25 (MAPD: 0.20)
INFO [2023-08-10 19:31:44] Mean standard deviation of on-target log-ratios only: 0.21 (MAPD: 0.17)
INFO [2023-08-10 19:31:44] Mean standard deviation of off-target log-ratios only: 0.27 (MAPD: 0.25)
INFO [2023-08-10 19:31:44] 2D-grid search of purity and ploidy...
INFO [2023-08-10 19:31:53] Local optima: 0.38/2, 0.45/2.4, 0.88/2.8, 0.68/2, 0.55/1.4, 0.33/2.2,
0.55/3, 0.38/1.6, 0.33/2.6, 0.85/4.4, 0.45/2.8, 0.52/3.4, 0.95/5.6
INFO [2023-08-10 19:31:53] Testing local optimum 1/13 at purity 0.38 and total ploidy 2.00...
INFO [2023-08-10 19:31:53] Testing local optimum 3/13 at purity 0.88 and total ploidy 2.80...
INFO [2023-08-10 19:31:54] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:31:54] Testing local optimum 7/13 at purity 0.55 and total ploidy 3.00...
INFO [2023-08-10 19:31:54] Testing local optimum 9/13 at purity 0.33 and total ploidy 2.60...
INFO [2023-08-10 19:31:54] Testing local optimum 11/13 at purity 0.45 and total ploidy 2.80...
INFO [2023-08-10 19:31:54] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:31:55] Recalibrating log-ratios...
INFO [2023-08-10 19:31:55] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:31:55] Recalibrating log-ratios...
INFO [2023-08-10 19:31:55] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:31:57] Recalibrating log-ratios...
INFO [2023-08-10 19:31:57] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:31:59] Recalibrating log-ratios...
INFO [2023-08-10 19:31:59] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:32:00] Testing local optimum 4/13 at purity 0.68 and total ploidy 2.00...
INFO [2023-08-10 19:32:00] Testing local optimum 6/13 at purity 0.33 and total ploidy 2.20...
INFO [2023-08-10 19:32:00] Testing local optimum 2/13 at purity 0.45 and total ploidy 2.40...
INFO [2023-08-10 19:32:02] Recalibrating log-ratios...
INFO [2023-08-10 19:32:02] Testing local optimum 9/13 at purity 0.33 and total ploidy 2.60...
INFO [2023-08-10 19:32:03] Recalibrating log-ratios...
INFO [2023-08-10 19:32:03] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:32:04] Recalibrating log-ratios...
INFO [2023-08-10 19:32:04] Testing local optimum 7/13 at purity 0.55 and total ploidy 3.00...
INFO [2023-08-10 19:32:05] Recalibrating log-ratios...
INFO [2023-08-10 19:32:05] Testing local optimum 11/13 at purity 0.45 and total ploidy 2.80...
INFO [2023-08-10 19:32:08] Recalibrating log-ratios...
INFO [2023-08-10 19:32:08] Testing local optimum 2/13 at purity 0.45 and total ploidy 2.40...
INFO [2023-08-10 19:32:09] Recalibrating log-ratios...
INFO [2023-08-10 19:32:09] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:32:09] Recalibrating log-ratios...
INFO [2023-08-10 19:32:09] Testing local optimum 6/13 at purity 0.33 and total ploidy 2.20...
INFO [2023-08-10 19:32:13] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:32:13] Testing local optimum 12/13 at purity 0.52 and total ploidy 3.40...
INFO [2023-08-10 19:32:14] Recalibrating log-ratios...
INFO [2023-08-10 19:32:14] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:32:16] Recalibrating log-ratios...
INFO [2023-08-10 19:32:16] Recalibrating log-ratios...
INFO [2023-08-10 19:32:16] Testing local optimum 12/13 at purity 0.52 and total ploidy 3.40...
INFO [2023-08-10 19:32:16] Testing local optimum 2/13 at purity 0.45 and total ploidy 2.40...
INFO [2023-08-10 19:32:17] Recalibrating log-ratios...
INFO [2023-08-10 19:32:17] Testing local optimum 7/13 at purity 0.55 and total ploidy 3.00...
INFO [2023-08-10 19:32:20] Recalibrating log-ratios...
INFO [2023-08-10 19:32:20] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:32:25] Testing local optimum 8/13 at purity 0.38 and total ploidy 1.60...
INFO [2023-08-10 19:32:26] Recalibrating log-ratios...
INFO [2023-08-10 19:32:26] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:32:32] Recalibrating log-ratios...
INFO [2023-08-10 19:32:32] Testing local optimum 8/13 at purity 0.38 and total ploidy 1.60...
INFO [2023-08-10 19:32:41] Skipping 5 solutions that converged to the same optima.
INFO [2023-08-10 19:32:41] Skipping 2 solutions exceeding max.non.clonal (0.20): 0.45/1.88, 0.8/1.11 (purity/tumor ploidy)
INFO [2023-08-10 19:32:41] Fitting variants with betabin model for local optimum 2/13...
INFO [2023-08-10 19:32:41] Fitting variants with betabin model for local optimum 3/13...
INFO [2023-08-10 19:32:41] Fitting variants with betabin model for local optimum 6/13...
INFO [2023-08-10 19:32:41] Fitting variants with betabin model for local optimum 9/13...
INFO [2023-08-10 19:32:41] Fitting variants with betabin model for local optimum 11/13...
INFO [2023-08-10 19:32:41] Fitting variants with betabin model for local optimum 13/13...
INFO [2023-08-10 19:32:41] Fitting variants for purity 0.60, tumor ploidy 4.20 and contamination 0.01.
INFO [2023-08-10 19:32:41] Fitting variants for purity 0.95, tumor ploidy 3.10 and contamination 0.01.
INFO [2023-08-10 19:32:42] Fitting variants for purity 0.47, tumor ploidy 2.26 and contamination 0.01.
INFO [2023-08-10 19:32:42] Fitting variants for purity 0.44, tumor ploidy 5.17 and contamination 0.01.
INFO [2023-08-10 19:32:42] Fitting variants for purity 0.44, tumor ploidy 3.21 and contamination 0.01.
INFO [2023-08-10 19:32:42] Fitting variants for purity 0.67, tumor ploidy 2.10 and contamination 0.01.
INFO [2023-08-10 19:32:57] Poor goodness-of-fit (0.549). Skipping post-optimization.
INFO [2023-08-10 19:32:57] Optimized purity: 0.47
INFO [2023-08-10 19:32:57] Poor goodness-of-fit (0.653). Skipping post-optimization.
INFO [2023-08-10 19:32:57] Optimized purity: 0.44
INFO [2023-08-10 19:32:58] Poor goodness-of-fit (0.431). Skipping post-optimization.
INFO [2023-08-10 19:32:58] Optimized purity: 0.95
INFO [2023-08-10 19:32:58] Poor goodness-of-fit (0.681). Skipping post-optimization.
INFO [2023-08-10 19:32:58] Optimized purity: 0.44
INFO [2023-08-10 19:32:58] Poor goodness-of-fit (0.473). Skipping post-optimization.
INFO [2023-08-10 19:32:58] Optimized purity: 0.67
INFO [2023-08-10 19:32:59] Poor goodness-of-fit (0.620). Skipping post-optimization.
INFO [2023-08-10 19:32:59] Optimized purity: 0.60
INFO [2023-08-10 19:32:59] Done.
INFO [2023-08-10 19:32:59] ------------------------------------------------------------
INFO [2023-08-10 19:32:59] Generating output files...
INFO [2023-08-10 19:33:02] Tumor/normal noise ratio: 2.290
INFO [2023-08-10 19:33:02] Using BiocParallel for parallel optimization.
WARN [2023-08-10 19:33:26] No variants to plot
INFO [2023-08-10 19:38:41] ------------------------------------------------------------
INFO [2023-08-10 19:38:41] PureCN 2.6.4
INFO [2023-08-10 19:38:41] ------------------------------------------------------------
INFO [2023-08-10 19:38:41] Arguments: -tumor.coverage.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/007R24_H03_OPXv8_KB0093/007R24_H03_OPXv8_KB0093.hg38.final_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/case_tgc2_files/007R24_H03_OPXv8_KB0093.mutect2.filtered.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/mapping_bias_opxv8_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 007R24_H03_OPXv8_KB0093 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/OPXv8.032423.interval.off_target.hg38.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file /mnt/home/atimms/misc/purecn_test/COSMICv97.GRCh38.Variants.normalized.dedup.vcf.gz -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -log.file /mnt/home/atimms/misc/purecn_test/opxv8_006r_007r/007R24_H03_OPXv8_KB0093/007R24_H03_OPXv8_KB0093.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2023-08-10 19:38:41] Using BiocParallel for parallel optimization.
INFO [2023-08-10 19:38:41] Loading coverage files...
INFO [2023-08-10 19:38:42] Mean target coverages: 207X (tumor) 200X (normal).
INFO [2023-08-10 19:38:43] Mean coverages: chrX: 99.39, chrY: 25.97, chr1-22: 188.89.
INFO [2023-08-10 19:38:43] Mean coverages: chrX: 108.91, chrY: 25.97, chr1-22: 185.96.
INFO [2023-08-10 19:38:46] Removing 104 intervals with missing log.ratio.
INFO [2023-08-10 19:38:46] Removing 18 low/high GC targets.
INFO [2023-08-10 19:38:47] Removing 438 intervals excluded in normalDB.
INFO [2023-08-10 19:38:47] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-08-10 19:38:47] Removing 9079 low count (< 100 total reads) intervals.
INFO [2023-08-10 19:38:47] Removing 678 low coverage (< 0.0015X) intervals.
INFO [2023-08-10 19:38:47] Using 19170 intervals (12163 on-target, 7007 off-target).
INFO [2023-08-10 19:38:47] Ratio of mean on-target vs. off-target read counts: 3.97
INFO [2023-08-10 19:38:47] Mean off-target bin size: 176896
INFO [2023-08-10 19:38:47] AT/GC dropout: 1.05 (tumor), 1.07 (normal), 0.98 (coverage log-ratio). 
INFO [2023-08-10 19:38:47] Loading VCF...
INFO [2023-08-10 19:38:48] Found 13323 variants in VCF file.
INFO [2023-08-10 19:38:48] Removing 1083 triallelic sites.
INFO [2023-08-10 19:38:48] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2023-08-10 19:38:48] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2023-08-10 19:38:49] 5891 (48.1%) variants annotated as likely germline (DB INFO flag).
INFO [2023-08-10 19:38:49] 007R24_H03_OPXv8_KB0093 is tumor in VCF file.
INFO [2023-08-10 19:38:50] 93 homozygous and 12 heterozygous variants on chrX.
INFO [2023-08-10 19:38:50] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 13.59).
INFO [2023-08-10 19:38:50] Detected MuTect2 VCF.
INFO [2023-08-10 19:38:50] Removing 6321 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-08-10 19:38:50] Removing 5422 low quality variants with non-offset BQ < 25.
INFO [2023-08-10 19:38:50] Base quality scores range from 24 to 31 (offset by 1)
INFO [2023-08-10 19:38:50] Minimum number of supporting reads ranges from 2 to 15, depending on coverage and BQS.
INFO [2023-08-10 19:38:52] Initial testing for significant sample cross-contamination: unlikely
INFO [2023-08-10 19:38:52] Removing 185 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2023-08-10 19:38:57] Removing 19 blacklisted variants.
INFO [2023-08-10 19:38:57] Total size of targeted genomic region: 2.68Mb (3.66Mb with 50bp padding).
INFO [2023-08-10 19:38:57] 2.1% of targets contain variants.
INFO [2023-08-10 19:38:57] Removing 28 variants outside intervals.
INFO [2023-08-10 19:38:57] Reading COSMIC VCF...
INFO [2023-08-10 19:39:02] Found COSMIC annotation in VCF. Requiring 6 hits.
INFO [2023-08-10 19:39:02] Setting somatic prior probabilities for hits to 0.995000 or to 0.500000 if in both COSMIC and dbSNP.
INFO [2023-08-10 19:39:02] Loading mapping bias file mapping_bias_opxv8_hg38.rds...
INFO [2023-08-10 19:39:02] Found 142859 variants in mapping bias file.
INFO [2023-08-10 19:39:03] Imputing mapping bias for 9 variants...
INFO [2023-08-10 19:39:03] Excluding 111 novel or poor quality variants from segmentation.
INFO [2023-08-10 19:39:03] Excluding 9 variants not in pool of normals from segmentation.
INFO [2023-08-10 19:39:03] Sample sex: M
INFO [2023-08-10 19:39:03] Segmenting data...
INFO [2023-08-10 19:39:04] Interval weights found, will use weighted PSCBS.
INFO [2023-08-10 19:39:04] MAPD of 38 allelic fractions: 0.10 (0.12 adjusted).
INFO [2023-08-10 19:39:04] Setting undo.SD parameter to 0.750000.
INFO [2023-08-10 19:39:04] On-target much cleaner than off-target, finding on-target breakpoints first...
INFO [2023-08-10 19:39:04] Using 11752 high quality (out of 12163) on-target intervals for initial breakpoint calculation.
INFO [2023-08-10 19:39:25] Setting prune.hclust.h parameter to 0.200000.
INFO [2023-08-10 19:39:50] Setting prune.hclust.h parameter to 0.200000.
INFO [2023-08-10 19:39:52] Found 90 segments with median size of 13.49Mb.
INFO [2023-08-10 19:39:52] Using 265 variants.
INFO [2023-08-10 19:39:52] Mean standard deviation of log-ratios: 0.25 (MAPD: 0.20)
INFO [2023-08-10 19:39:53] Mean standard deviation of on-target log-ratios only: 0.21 (MAPD: 0.17)
INFO [2023-08-10 19:39:53] Mean standard deviation of off-target log-ratios only: 0.27 (MAPD: 0.25)
INFO [2023-08-10 19:39:53] 2D-grid search of purity and ploidy...
INFO [2023-08-10 19:40:00] Local optima: 0.38/2, 0.45/2.4, 0.88/2.8, 0.68/2, 0.55/1.4, 0.33/2.2,
0.55/3, 0.38/1.6, 0.33/2.6, 0.85/4.4, 0.45/2.8, 0.52/3.4, 0.95/5.6
INFO [2023-08-10 19:40:00] Testing local optimum 1/13 at purity 0.38 and total ploidy 2.00...
INFO [2023-08-10 19:40:01] Testing local optimum 3/13 at purity 0.88 and total ploidy 2.80...
INFO [2023-08-10 19:40:01] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:40:01] Testing local optimum 7/13 at purity 0.55 and total ploidy 3.00...
INFO [2023-08-10 19:40:01] Testing local optimum 9/13 at purity 0.33 and total ploidy 2.60...
INFO [2023-08-10 19:40:01] Testing local optimum 11/13 at purity 0.45 and total ploidy 2.80...
INFO [2023-08-10 19:40:01] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:40:02] Recalibrating log-ratios...
INFO [2023-08-10 19:40:02] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:40:02] Recalibrating log-ratios...
INFO [2023-08-10 19:40:02] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:40:04] Recalibrating log-ratios...
INFO [2023-08-10 19:40:04] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:40:05] Recalibrating log-ratios...
INFO [2023-08-10 19:40:05] Testing local optimum 5/13 at purity 0.55 and total ploidy 1.40...
INFO [2023-08-10 19:40:06] Testing local optimum 6/13 at purity 0.33 and total ploidy 2.20...
INFO [2023-08-10 19:40:07] Testing local optimum 4/13 at purity 0.68 and total ploidy 2.00...
INFO [2023-08-10 19:40:07] Testing local optimum 2/13 at purity 0.45 and total ploidy 2.40...
INFO [2023-08-10 19:40:09] Recalibrating log-ratios...
INFO [2023-08-10 19:40:09] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:40:10] Recalibrating log-ratios...
INFO [2023-08-10 19:40:10] Testing local optimum 7/13 at purity 0.55 and total ploidy 3.00...
INFO [2023-08-10 19:40:10] Recalibrating log-ratios...
INFO [2023-08-10 19:40:10] Testing local optimum 9/13 at purity 0.33 and total ploidy 2.60...
INFO [2023-08-10 19:40:13] Recalibrating log-ratios...
INFO [2023-08-10 19:40:13] Testing local optimum 11/13 at purity 0.45 and total ploidy 2.80...
INFO [2023-08-10 19:40:15] Recalibrating log-ratios...
INFO [2023-08-10 19:40:15] Testing local optimum 2/13 at purity 0.45 and total ploidy 2.40...
INFO [2023-08-10 19:40:15] Recalibrating log-ratios...
INFO [2023-08-10 19:40:15] Testing local optimum 13/13 at purity 0.95 and total ploidy 5.60...
INFO [2023-08-10 19:40:16] Recalibrating log-ratios...
INFO [2023-08-10 19:40:16] Testing local optimum 6/13 at purity 0.33 and total ploidy 2.20...
INFO [2023-08-10 19:40:21] Testing local optimum 12/13 at purity 0.52 and total ploidy 3.40...
INFO [2023-08-10 19:40:21] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:40:22] Recalibrating log-ratios...
INFO [2023-08-10 19:40:22] Testing local optimum 7/13 at purity 0.55 and total ploidy 3.00...
INFO [2023-08-10 19:40:23] Recalibrating log-ratios...
INFO [2023-08-10 19:40:23] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:40:23] Recalibrating log-ratios...
INFO [2023-08-10 19:40:23] Testing local optimum 12/13 at purity 0.52 and total ploidy 3.40...
INFO [2023-08-10 19:40:24] Recalibrating log-ratios...
INFO [2023-08-10 19:40:24] Testing local optimum 2/13 at purity 0.45 and total ploidy 2.40...
INFO [2023-08-10 19:40:29] Testing local optimum 8/13 at purity 0.38 and total ploidy 1.60...
INFO [2023-08-10 19:40:29] Recalibrating log-ratios...
INFO [2023-08-10 19:40:29] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:40:34] Recalibrating log-ratios...
INFO [2023-08-10 19:40:34] Testing local optimum 10/13 at purity 0.85 and total ploidy 4.40...
INFO [2023-08-10 19:40:34] Recalibrating log-ratios...
INFO [2023-08-10 19:40:34] Testing local optimum 8/13 at purity 0.38 and total ploidy 1.60...
INFO [2023-08-10 19:40:43] Skipping 5 solutions that converged to the same optima.
INFO [2023-08-10 19:40:43] Skipping 2 solutions exceeding max.non.clonal (0.20): 0.45/1.88, 0.8/1.11 (purity/tumor ploidy)
INFO [2023-08-10 19:40:43] Fitting variants with betabin model for local optimum 2/13...
INFO [2023-08-10 19:40:43] Fitting variants with betabin model for local optimum 3/13...
INFO [2023-08-10 19:40:43] Fitting variants with betabin model for local optimum 6/13...
INFO [2023-08-10 19:40:43] Fitting variants with betabin model for local optimum 9/13...
INFO [2023-08-10 19:40:43] Fitting variants with betabin model for local optimum 11/13...
INFO [2023-08-10 19:40:43] Fitting variants with betabin model for local optimum 13/13...
INFO [2023-08-10 19:40:43] Fitting variants for purity 0.60, tumor ploidy 4.20 and contamination 0.01.
INFO [2023-08-10 19:40:43] Fitting variants for purity 0.95, tumor ploidy 3.10 and contamination 0.01.
INFO [2023-08-10 19:40:43] Fitting variants for purity 0.47, tumor ploidy 2.26 and contamination 0.01.
INFO [2023-08-10 19:40:43] Fitting variants for purity 0.44, tumor ploidy 5.17 and contamination 0.01.
INFO [2023-08-10 19:40:43] Fitting variants for purity 0.44, tumor ploidy 3.21 and contamination 0.01.
INFO [2023-08-10 19:40:44] Fitting variants for purity 0.67, tumor ploidy 2.10 and contamination 0.01.
INFO [2023-08-10 19:40:59] Poor goodness-of-fit (0.620). Skipping post-optimization.
INFO [2023-08-10 19:40:59] Optimized purity: 0.60
INFO [2023-08-10 19:40:59] Poor goodness-of-fit (0.653). Skipping post-optimization.
INFO [2023-08-10 19:40:59] Poor goodness-of-fit (0.549). Skipping post-optimization.
INFO [2023-08-10 19:40:59] Optimized purity: 0.44
INFO [2023-08-10 19:40:59] Optimized purity: 0.47
INFO [2023-08-10 19:41:00] Poor goodness-of-fit (0.681). Skipping post-optimization.
INFO [2023-08-10 19:41:00] Optimized purity: 0.44
INFO [2023-08-10 19:41:00] Poor goodness-of-fit (0.473). Skipping post-optimization.
INFO [2023-08-10 19:41:00] Optimized purity: 0.67
INFO [2023-08-10 19:41:00] Poor goodness-of-fit (0.431). Skipping post-optimization.
INFO [2023-08-10 19:41:00] Optimized purity: 0.95
INFO [2023-08-10 19:41:00] Done.
INFO [2023-08-10 19:41:00] ------------------------------------------------------------
INFO [2023-08-10 19:41:01] Generating output files...
INFO [2023-08-10 19:41:04] Tumor/normal noise ratio: 2.290
INFO [2023-08-10 19:41:04] Using BiocParallel for parallel optimization.
WARN [2023-08-10 19:41:27] No variants to plot

**B-allele frequency plot**
<img width=""1569"" alt=""007R24_H03_OPXv8_KB0093"" src=""https://github.com/lima1/PureCN/assets/40042149/03237e3c-6c09-4c2d-b478-30113def4690"">

**Session Info**
I used the docker image, so not sure how to do this.

Thanks for any help.

Andrew",atimms,https://github.com/lima1/PureCN/issues/313
I_kwDOBew4us5uY16w,Error in the first step of PureCN,CLOSED,2023-08-15T19:30:38Z,2023-12-07T21:55:19Z,2023-12-07T21:55:19Z,"Hi

I put the path to PureCN but when running I get this error permanently

```

fi1d18@RBGO-Server2:/opt/R/4.1.2/lib/R/site-library/PureCN/extdata$ Rscript --vanilla Coverage.R
Error in library(optparse) : there is no package called ‘optparse’
Calls: suppressPackageStartupMessages -> withCallingHandlers -> library
Execution halted
fi1d18@RBGO-Server2:/opt/R/4.1.2/lib/R/site-library/PureCN/extdata$ 
```
I have already installed `optparse` package and I can load that in Rstudio

Thank you for any help",fi1d18,https://github.com/lima1/PureCN/issues/314
I_kwDOBew4us5ujG8g,Error creating NormalDB from GATK CreateSomaticPanelOfNormals output,CLOSED,2023-08-17T10:10:36Z,2023-08-19T10:33:38Z,2023-08-19T10:33:38Z,"Hi Markus, 

so first of all thank you for providing such a valuable tool to the community. I am currently trying to create the normal reference. To create this I used GATK CreateSomaticPanelofNormal function following the instructions of GATK. I am using your newest docker image, running it with apptainer like this: 

```
BASE_DIR=""/ptmp/gref/data/results_pMCL_twist/variant_calling/purecn""
PURECN_NORMAL=""/opt/PureCN/NormalDB.R""
OUT_REF=""/ptmp/gref/data/results_pMCL_twist/variant_calling/purecn""
NORMAL_PANEL=""/ptmp/gref/data/wes/refractory/normals/pon_db/pon.vcf.gz""

#Create pureCN Normal Reference
apptainer run  --bind /ptmp/gref/data/:/ptmp/gref/data/ /u/graefm/software/purecn.sif Rscript $PURECN_NORMAL --out-dir $OUT_REF --normal-panel $NORMAL_PANEL \
    --assay twist --genome hg19 --force
```
    
Which gives me this error 
```
INFO [2023-08-17 11:26:22] Loading PureCN 2.6.4...
INFO [2023-08-17 11:26:22] Creating mapping bias database.
INFO [2023-08-17 11:26:23] Processing variants 1 to 50000...
FATAL [2023-08-17 11:26:23] The normal.panel.vcf.file contains only a single sample.

FATAL [2023-08-17 11:26:23]

FATAL [2023-08-17 11:26:23] This is most likely a user error due to invalid input data or

FATAL [2023-08-17 11:26:23] parameters (PureCN 2.6.4).

Error: The normal.panel.vcf.file contains only a single sample.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.6.4).
In addition: Warning message:
In .vcf_usertag(map, tag, nm, verbose) :
  ScanVcfParam 'geno' fields not found in  header: 'AD'
Execution halted

```
This has been discussed before, the problem is that the PON normal does not contain sample ids. The files can still be used if GenomicsDB-R is installed, which also comes along with your docker image. The set up worked fine, no errors, no warnings and I can find all files in /opt/GenomicsDB. What could be the issue here? 

Thanks for your help! 

Best, 
Moritz",Moe94,https://github.com/lima1/PureCN/issues/315
I_kwDOBew4us5u95_x,PureCN segmentation and VCF do not overlap,OPEN,2023-08-22T15:35:51Z,2023-09-06T14:19:50Z,,"**Describe the issue**
When running PureCN with my segmentation and VCF files, I encounter an error that says ""Segmentation and VCF do not overlap."" This stops the execution of the program.

**To Reproduce**
I've tried doing everything from scratch and still getting the same error

starting by doing the IntervalFile

Rscript $PURECN/IntervalFile.R --in-file /Users/mateopava/Desktop/KAPA_HyperExome_primary_targets.bed \ 
    --fasta /Users/mateopava/Desktop/hg38/hg38.fa --out-file $OUT_REF/baits_hg38_intervals.txt \
    --off-target --genome hg38 \
    --export $OUT_REF/baits_optimized_hg38.bed \
    --mappability /Users/mateopava/Desktop/hg38/GCA_000001405.15_GRCh38_no_alt_analysis_set_100.bw \

then Coverage

 Rscript $PURECN/Coverage.R --out-dir $OUT/PRO001 \ 
    --bam /Users/mateopava/Desktop/PRO001_18-27110_DNAFFPE_NA_C_HN00131668.recal.bam \
    --intervals $OUT_REF/baits_hg38_intervals.txt

Rscript $PURECN/Coverage.R --out-dir $OUT/normals \ 
    --bam normals.list \
    --intervals $OUT_REF/baits_hg38_intervals.txt \
    --cores 4

then NormalDB

Rscript $PURECN/NormalDB.R --out-dir $OUT_REF \
    --coverage-files example_normal_coverages.list \
    --genome hg38

then RunPureCN

Rscript $PURECN/PureCN.R --out $OUT/PRO001\
    --tumor $OUT/PRO001_18-27110_DNAFFPE_NA_C_HN00131668.recal_coverage_loess.txt.gz \
    --sampleid PRO001\
    --vcf /Users/mateopava/Desktop/PRO001_18-27110_DNAFFPE_NA_C_HN00131668_vs_PRO001_NA_DNASAL_NA_C_HN00131668.mutect2.filtered.vcf.gz \
    --normaldb $OUT_REF/normalDB_hg38.rds \
    --intervals $OUT_REF/baits_hg38_intervals.txt \
    --genome hg38

_______________________________________________________________________

I've tried by using a thirdparty segmentation file (DNAcopy format)
Rscript $PURECN/PureCN.R --out $OUT/PRO001  \
    --sampleid PRO001 \
    --seg-file /Users/mateopava/Desktop/PRO001.seg \
    --vcf /Users/mateopava/Desktop/PRO001xxxmutect2.filtered.vcf.gz \
    --intervals $OUT_REF/baits_hg38_intervals.txt \
    --genome hg38

**Expected behavior**
I expected PureCN to process the files and provide an output without any errors.

**Log file** following the PureCN best practices

(base) mateopava@Mateos-MacBook-Pro Desktop % Rscript $PURECN/PureCN.R --out $OUT/PRO001\
    --tumor $OUT/PRO001_18-27110_DNAFFPE_NA_C_HN00131668.recal_coverage_loess.txt.gz \
    --sampleid PRO001\
    --vcf /Users/mateopava/Desktop/PRO001xxxmutect2.filtered.vcf.gz \
    --normaldb $OUT_REF/normalDB_hg38.rds \
    --intervals $OUT_REF/baits_hg38_intervals.txt \
    --genome hg38
[1] ""/Users/mateopava/Desktop/PRO001""
INFO [2023-08-22 16:53:35] Loading PureCN 2.6.4...
INFO [2023-08-22 16:53:39] Mean coverages: chrX: 18.53, chrY: 20.37, chr1-22: 32.40.
INFO [2023-08-22 16:53:39] Sample sex: M
WARN [2023-08-22 16:53:39] Recommended to provide --fun-segmentation PSCBS.
INFO [2023-08-22 16:53:39] ------------------------------------------------------------
INFO [2023-08-22 16:53:39] PureCN 2.6.4
INFO [2023-08-22 16:53:39] ------------------------------------------------------------
INFO [2023-08-22 16:53:39] Arguments: -tumor.coverage.file /Users/mateopava/Desktop/PRO001_18-27110_DNAFFPE_NA_C_HN00131668.recal_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /Users/mateopava/Desktop/PRO001xxxmutect2.filtered.vcf.gz -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid PRO001 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /Users/mateopava/Desktop/reference_files/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize FALSE -BPPARAM  -log.file /Users/mateopava/Desktop/PRO001/PRO001.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-08-22 16:53:39] Loading coverage files...
INFO [2023-08-22 16:53:41] Mean target coverages: 32X (tumor) 32X (normal).
INFO [2023-08-22 16:53:42] Mean coverages: chrX: 18.53, chrY: 20.37, chr1-22: 32.40.
INFO [2023-08-22 16:53:42] Mean coverages: chrX: 18.40, chrY: 17.87, chr1-22: 31.68.
INFO [2023-08-22 16:53:49] Removing 4993 intervals with missing log.ratio.
INFO [2023-08-22 16:53:49] Removing 11982 intervals excluded in normalDB.
INFO [2023-08-22 16:53:49] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-08-22 16:53:49] Removing 81022 low count (< 100 total reads) intervals.
INFO [2023-08-22 16:53:49] Removing 3262 low coverage (< 0.0015X) intervals.
INFO [2023-08-22 16:53:49] Using 151376 intervals (130716 on-target, 20660 off-target).
INFO [2023-08-22 16:53:49] Ratio of mean on-target vs. off-target read counts: 0.10
INFO [2023-08-22 16:53:49] Mean off-target bin size: 97601
INFO [2023-08-22 16:53:49] AT/GC dropout: 0.97 (tumor), 0.98 (normal), 1.01 (coverage log-ratio). 
INFO [2023-08-22 16:53:49] Loading VCF...
INFO [2023-08-22 16:53:51] Found 71062 variants in VCF file.
INFO [2023-08-22 16:53:51] Removing 560 triallelic sites.
WARN [2023-08-22 16:53:51] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2023-08-22 16:53:51] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2023-08-22 16:53:51] 520 (0.7%) variants annotated as likely germline (DB INFO flag).
INFO [2023-08-22 16:53:52] 1_PRO001_18-27110_DNAFFPE_NA_C_HN00131668 is tumor in VCF file.
INFO [2023-08-22 16:53:53] No homozygous variants in VCF, provide unfiltered VCF.
INFO [2023-08-22 16:53:53] Detected MuTect2 VCF.
INFO [2023-08-22 16:53:54] Removing 59300 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-08-22 16:53:54] Removing 45 non heterozygous (in matched normal) germline SNPs.
INFO [2023-08-22 16:53:54] Removing 5210 low quality variants with non-offset BQ < 25.
INFO [2023-08-22 16:53:54] Base quality scores range from 24 to 38 (offset by 1)
INFO [2023-08-22 16:53:54] Minimum number of supporting reads ranges from 2 to 9, depending on coverage and BQS.
INFO [2023-08-22 16:53:55] Removing 1481 variants with AF < 0.030 or AF >= 1.000 or insufficient supporting reads or depth < 15.
INFO [2023-08-22 16:53:55] Total size of targeted genomic region: 25.30Mb (36.42Mb with 50bp padding).
INFO [2023-08-22 16:53:55] 1.6% of targets contain variants.
INFO [2023-08-22 16:53:55] Removing 2125 variants outside intervals.
WARN [2023-08-22 16:53:55] Less than half of variants in dbSNP. Make sure that VCF contains both germline and somatic variants.
INFO [2023-08-22 16:53:55] Found SOMATIC annotation in VCF.
INFO [2023-08-22 16:53:55] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
WARN [2023-08-22 16:53:55] Calculated mapping bias from somatic SNVs is not a number. Setting it to 0.49 but there is likely an issue with your input VCF.
INFO [2023-08-22 16:53:55] Found SOMATIC annotation in VCF. Setting mapping bias to 0.490.
INFO [2023-08-22 16:53:55] Excluding 2341 novel or poor quality variants from segmentation.
INFO [2023-08-22 16:53:55] Sample sex: M
INFO [2023-08-22 16:53:55] Segmenting data...
INFO [2023-08-22 16:53:55] Interval weights found, will use weighted CBS.
INFO [2023-08-22 16:53:55] Loading pre-computed boundaries for DNAcopy...
INFO [2023-08-22 16:53:55] Setting undo.SD parameter to 1.000000.
Setting multi-figure configuration
FATAL [2023-08-22 16:53:59] Segmentation and VCF do not overlap. 

FATAL [2023-08-22 16:53:59]  

FATAL [2023-08-22 16:53:59] This is most likely a user error due to invalid input data or 

FATAL [2023-08-22 16:53:59] parameters (PureCN 2.6.4). 

Error: Segmentation and VCF do not overlap.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.6.4).
Además: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Ejecución interrumpida

**Log file** for thirdparty segmentation
 
Rscript $PURECN/PureCN.R --out $OUT/PRO001  \
    --sampleid PRO001 \
    --seg-file /Users/mateopava/Desktop/PRO001.seg \
    --vcf /Users/mateopava/Desktop/PRO001xxxmutect2.filtered.vcf.gz \
    --intervals $OUT_REF/baits_hg38_intervals.txt \
    --genome hg38
[1] ""/Users/mateopava/Desktop/PRO001""
INFO [2023-08-22 17:15:14] Loading PureCN 2.6.4...
WARN [2023-08-22 17:15:14] Recommended to provide --fun-segmentation Hclust.
INFO [2023-08-22 17:15:14] ------------------------------------------------------------
INFO [2023-08-22 17:15:14] PureCN 2.6.4
INFO [2023-08-22 17:15:14] ------------------------------------------------------------
INFO [2023-08-22 17:15:14] Arguments: -normal.coverage.file  -tumor.coverage.file  -log.ratio  -seg.file /Users/mateopava/Desktop/PRO001.seg -vcf.file /Users/mateopava/Desktop/PRO001xxxmutect2.filtered.vcf.gz -normalDB  -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf NULL -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid PRO001 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /Users/mateopava/Desktop/reference_files/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize FALSE -BPPARAM  -log.file /Users/mateopava/Desktop/PRO001/PRO001.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-08-22 17:15:14] Loading coverage files...
WARN [2023-08-22 17:15:17] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
INFO [2023-08-22 17:15:18] Mean coverages: chrX: 16.00, chrY: 16.00, chr1-22: 16.00.
INFO [2023-08-22 17:15:18] Mean coverages: chrX: 16.00, chrY: 16.00, chr1-22: 16.00.
INFO [2023-08-22 17:15:25] Removing 2351 intervals with missing log.ratio.
INFO [2023-08-22 17:15:25] Using 250284 intervals (227382 on-target, 22902 off-target).
INFO [2023-08-22 17:15:25] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2023-08-22 17:15:25] Mean off-target bin size: 90427
INFO [2023-08-22 17:15:25] Loading VCF...
INFO [2023-08-22 17:15:26] Found 71062 variants in VCF file.
INFO [2023-08-22 17:15:27] Removing 560 triallelic sites.
WARN [2023-08-22 17:15:27] Found GERMQ info field with Phred scaled germline probabilities.
WARN [2023-08-22 17:15:28] vcf.file has no DB info field for membership in germline databases. Found and used somatic status instead.
INFO [2023-08-22 17:15:28] 520 (0.7%) variants annotated as likely germline (DB INFO flag).
INFO [2023-08-22 17:15:29] 1_PRO001_18-27110_DNAFFPE_NA_C_HN00131668 is tumor in VCF file.
INFO [2023-08-22 17:15:29] No homozygous variants in VCF, provide unfiltered VCF.
INFO [2023-08-22 17:15:29] Detected MuTect2 VCF.
INFO [2023-08-22 17:15:29] Removing 59300 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-08-22 17:15:29] Removing 45 non heterozygous (in matched normal) germline SNPs.
INFO [2023-08-22 17:15:29] Removing 5210 low quality variants with non-offset BQ < 25.
INFO [2023-08-22 17:15:29] Base quality scores range from 24 to 38 (offset by 1)
INFO [2023-08-22 17:15:29] Minimum number of supporting reads ranges from 2 to 9, depending on coverage and BQS.
INFO [2023-08-22 17:15:30] Removing 1481 variants with AF < 0.030 or AF >= 1.000 or insufficient supporting reads or depth < 15.
INFO [2023-08-22 17:15:30] Total size of targeted genomic region: 38.30Mb (58.38Mb with 50bp padding).
INFO [2023-08-22 17:15:30] 1.3% of targets contain variants.
INFO [2023-08-22 17:15:30] Removing 1274 variants outside intervals.
WARN [2023-08-22 17:15:30] Less than half of variants in dbSNP. Make sure that VCF contains both germline and somatic variants.
INFO [2023-08-22 17:15:30] Found SOMATIC annotation in VCF.
INFO [2023-08-22 17:15:30] Setting somatic prior probabilities for somatic variants to 0.999000 or to 0.000100 otherwise.
WARN [2023-08-22 17:15:30] Calculated mapping bias from somatic SNVs is not a number. Setting it to 0.49 but there is likely an issue with your input VCF.
INFO [2023-08-22 17:15:30] Found SOMATIC annotation in VCF. Setting mapping bias to 0.490.
INFO [2023-08-22 17:15:30] Excluding 3192 novel or poor quality variants from segmentation.
INFO [2023-08-22 17:15:30] Sample sex: M
INFO [2023-08-22 17:15:30] Segmenting data...
INFO [2023-08-22 17:15:30] Loaded provided segmentation file PRO001.seg (format DNAcopy).
WARN [2023-08-22 17:15:30] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
INFO [2023-08-22 17:15:30] Re-centering provided segment means (offset -2.8481).
INFO [2023-08-22 17:15:30] Loading pre-computed boundaries for DNAcopy...
INFO [2023-08-22 17:15:30] Setting undo.SD parameter to 0.000000.
Setting multi-figure configuration
FATAL [2023-08-22 17:15:38] Segmentation and VCF do not overlap. 

FATAL [2023-08-22 17:15:38]  

FATAL [2023-08-22 17:15:38] This is most likely a user error due to invalid input data or 

FATAL [2023-08-22 17:15:38] parameters (PureCN 2.6.4). 

Error: Segmentation and VCF do not overlap.

This is most likely a user error due to invalid input data or
parameters (PureCN 2.6.4).
Además: Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Ejecución interrumpida


",pavamateo,https://github.com/lima1/PureCN/issues/316
I_kwDOBew4us5vgpOx,NOISY SEGMENTATION in most samples,CLOSED,2023-08-29T03:46:46Z,2023-09-11T13:48:08Z,2023-09-11T13:48:08Z,"**Describe the issue**
I followed your suggestion, run the PureCN from scratch. The distribution of purity becomes better, but it is commented on by Noisy Segmentation in most of the samples. Could you please help to look into one sample.
**To Reproduce**
#Step1 reference files
Rscript $PURECN/IntervalFile.R --in-file /proj/sens2019581/nobackup/PureCN/reference_files/Twist_Exome_RefSeq_targets_hg38_100bp_padding.bed \
    --fasta /sw/data/uppnex/ToolBox/hg38bundle/Homo_sapiens_assembly38.fasta \
    --genome hg38 \
    --mappability /proj/sens2019581/nobackup/PureCN/reference_files/GCA_000001405.15_GRCh38_no_alt_analysis_set_100.bw \
    --out-file $OUT_REF/Twist_Exome_RefSeq_targets_hg38_intervals.txt
#Step2 Coverage
Rscript $PURECN/Coverage.R --out-dir $OUT \
    --bam /proj/sens2019581/nobackup/PureCN/data/normal_bam.list \
    --intervals $OUT_REF/Twist_Exome_RefSeq_targets_hg38_intervals.txt \
    --cores 64 --parallel
Rscript $PURECN/Coverage.R --out-dir $OUT \
    --bam /proj/sens2019581/nobackup/PureCN/data/tumor_bam.list \
    --intervals $OUT_REF/Twist_Exome_RefSeq_targets_hg38_intervals.txt \
    --cores 64 --parallel
#NormalDB
Rscript $PURECN/NormalDB.R --out-dir $OUT_REF \
    --coverage-files /proj/sens2019581/nobackup/PureCN/data/Normal/BEVPAC_normal_coverages.list \
    --genome hg38 --assay Twist_Exome
#PureCN run
Rscript $PURECN/PureCN.R --out $OUT/$Sample \
    --tumor /proj/sens2019581/nobackup/PureCN/data/Tumor/$Sample"".recal_coverage_loess.txt.gz"" \
    --sampleid $Sample \
    --vcf /proj/sens2019581/nobackup/PureCN/data/$Sample"".vcf"" \
    --fun-segmentation PSCBS \
    --normaldb $OUT_REF/normalDB_Twist_Exome_hg38.rds \
    --intervals $OUT_REF/Twist_Exome_RefSeq_targets_hg38_intervals.txt \
    --snp-blacklist $OUT_REF/hg38-blacklist.v2.bed \
    --genome hg38 \
    --minpurity 0.05 --max-copy-number 8 \
    --rds=rda \
    --max-non-clonal 0.3 \
    --model betabin \
    --force --post-optimize --seed 123 \
    --cores 32

**Log file**
[UE-2971-1106-0.log](https://github.com/lima1/PureCN/files/12460014/UE-2971-1106-0.log)
[UE-2971-1106-0.csv](https://github.com/lima1/PureCN/files/12460015/UE-2971-1106-0.csv)

**B-allele frequency plot**
![1693280778723](https://github.com/lima1/PureCN/assets/49832670/144ba676-bcdb-47df-9fa9-3be854b5018d)
",WangKang-Leo,https://github.com/lima1/PureCN/issues/317
I_kwDOBew4us5vmM7V,pureCN output genes.csv vs loh.csv,CLOSED,2023-08-29T19:35:13Z,2023-09-16T01:10:32Z,2023-09-16T01:10:32Z,"
Hi developers,
I've been curious trying to get the major CN and minor CN from the output, but both genes ouput and loh ouput have the ""C"" and ""M"" columns, so which file should I consider.
I saw something comments online, said ""segment of LOH is more robust"" is this correct?
Any comments about this will be appreciated
Thanks
Funan",hfl112,https://github.com/lima1/PureCN/issues/318
I_kwDOBew4us5wEr5d,Encountering error while  running preprocessIntervals function,CLOSED,2023-09-04T13:19:26Z,2024-03-12T12:08:21Z,2024-03-12T12:08:21Z,">extdata<-setwd(""C:/Users/gagan.kumar/"")
> library(PureCN)
> intervals <- import(""C:/Users/gagan.kumar/bedfile.bed"")
> preprocessIntervals(intervals,""C:/Users/gagan.kumar/Homo_sapiens_assembly38.fasta"", output.file = ""ex2_gc_file.txt"")
WARN [2023-09-04 18:40:17] Found 70970 overlapping intervals, starting at line 37.
WARN [2023-09-04 18:40:18] Target intervals were not sorted.
INFO [2023-09-04 18:41:42] Splitting 2513 large targets to an average width of 400.
WARN [2023-09-04 18:41:42] No mappability scores provided.
WARN [2023-09-04 18:41:42] No reptiming scores provided.
INFO [2023-09-04 18:41:42] Calculating GC-content...
[E::faidx_fetch_seq2] Failed to retrieve block. (Seeking in a compressed, .gzi unindexed, file?)
Error in value[[3L]](cond) : 
   record 1742 (chr14:23182954-23183343) failed
  file: C:/Users/gagan.kumar/Homo_sapiens_assembly38.fasta


i have even create .gzi file using bgzip -i Homo_sapiens_assembly38.fasta command ",gagank4911,https://github.com/lima1/PureCN/issues/319
I_kwDOBew4us5wUzc8,Mutect2 drops MBQ to 20 in overlapped reads,OPEN,2023-09-06T18:00:51Z,2023-09-06T22:19:34Z,,"Hello,

Just encountered the issue using Mutect2 (tried several versions) with PureCN 2.2.0. PureCN has failed for most samples with majority of variants filtered out by BQ<25 filter.

I've figured out what happen:
I have a 150x paired end data with very short insert size (median insert size compared to read length). In this case majority of nucleotides in the data are in the overlapped parts of reads (on both forward and reverse read). In this case Mutect2 starts to be concerned about PCR errors. If the nucleotide came from PCR error and it is supported by two reads it could have very high variant quality. So for its error model Mutect2 adjust base quality (by default to min(20, original_base_quality) in overlapped parts of the reads. It results in drop of MBQ. 20 is a half of 40 which is Phred score of 10^-4 - default PCR error rate in Mutect2 (could be changed by `--pcr-snv-qual` parameter). In my case just most of variants had MBQ=20 and therefore were filtered out by PureCN.

Some links about this issue:
[https://github.com/broadinstitute/gatk/issues/4958](https://github.com/broadinstitute/gatk/issues/4958) - quite old discussion, but Mutect2 code follows the same logic.
[https://gatk.broadinstitute.org/hc/en-us/community/posts/18479740841755-Mutect2-overlapping-reads-behavior-with-pcr-snv-qual-parameter](https://gatk.broadinstitute.org/hc/en-us/community/posts/18479740841755-Mutect2-overlapping-reads-behavior-with-pcr-snv-qual-parameter) - My question to GATK team about using `--pcr-snv-qual`.

I'm not sure what should be the best way to deal with it in case of PureCN:
1) Cut overalled part of the reads. Should it also improve coverage calculations by Coverage.R?
2) Turn off PCR error correction for setting `--pcr-snv-qual` hight.
3) Make MBQ filter in PureCN adjustable.

Best,
Semen",sleyn,https://github.com/lima1/PureCN/issues/320
I_kwDOBew4us5wfIec,Effect of --max-copy-number parameter on purity/ploidy and copy number estimates,CLOSED,2023-09-08T08:28:49Z,2024-01-17T10:37:20Z,2023-12-07T21:54:32Z,"I am running simulations (whole-exome, bam files generated with synggen 1.5, 1 tumor and 2 normals for NormalDB, loess normalization, simulated purity=0.8, expected ploidy~2.8) for PureCN benchmarking, and I was confused by the effect of --max-copy-number, specifically why the copy numbers are off by roughly a factor of 2 if the --max-copy-number is too high. I believe I have figured it out, so this is more of a question whether my understanding is correct, and if it is, a suggestion to improve the part in the documentation that I found to be confusing:

""Defaults are well calibrated and should produce close to ideal results for most samples. A few common cases where changing defaults makes sense:
High purity and high quality: For cancer types with a high expected purity, such as ovarian cancer, AND when quality is expected to be very good (high coverage, young samples), --max-copy-number 8. (PureCN reports copy numbers greater than this value, but will stop fitting SNP allelic fractions to the exact allele-specific copy number because this will get impossible very quickly with high copy numbers - and computationally expensive.)""

- My understanding now (based on the experiments below) is that PureCN uses the provided --max-copy-number for both purity and ploidy grid search, and final calculation of segment copy numbers. This is not specific to --max-copy-number 8, therefore I would move the note in the parenthesis to the documentation of --max-copy-number, in Rscript $PureCN/PureCN.R --help in particular, and mention that purity and ploidy grid search is affected.
- Was the recommended value of --max-copy-number 8 for high-purity, high-quality samples determined experimentally or is there something special about 8 after all? It seems strange at first that the recommendation changes from 7 to only 8, however, based on my results below it makes sense to increase the default with caution. The problem in my simulations was not the computational effort, but the wrong global purity/ploidy optima at --max-copy-number 12 and above 14 - in which the copy numbers are scaled by a factor of ~2x.
- To avoid this particular 2x-scaled purity/ploidy solution, wouldn't it make sense to set --max ploidy to a lower value, if we know that the tumor sample is more or less diploid? Based on my understanding, 4 seems to be a good choice.

The experimental setup is:

```
for maxCN in 4 5 6 7 8 9 10 11 12 13 14 15 20 50 100
do
Rscript $PURECN/PureCN.R --out $OUT/${SAMPLEID}_maxCN${maxCN}_with-vcf  --tumor $OUT/tumor/${SAMPLEID}_coverage_loess.txt.gz  --sampleid $OUT/${SAMPLEID}_loess_maxCN${maxCN}  --normaldb $OUT/normalDB_experiment2_loess_hg38.rds --intervals $OUT/S07604624_Covered_human_all_v6_plus_UTR.liftover.to.hg38_chr.cleaned.sorted.intervals_no_off_targets.txt  --genome hg38 --force --max-copy-number $maxCN --vcf synggen_NV_T_1_tc08_v02_R.vcf.gz
done
```

My log2 ratio spectrum from *segmentation.pdf:


![log2_ratios_maxCN12](https://github.com/lima1/PureCN/assets/15612230/ce67509b-0756-46ad-9c67-d75c2e68d22e)

Plot of best estimates for ploidy/purity for different maxCN:

![synggen_NV_T_1_tc08_v02_R_maxCNXXX_with-vcf_purity_ploidy](https://github.com/lima1/PureCN/assets/15612230/eefc86df-8d5c-4c23-ab5b-64b5a05db07f)


Plot of CN in simulated truth vs. PureCN output at --max-copy-number 12, segments in truth and PureCN output are matched with bedtools intersect -f 0.5 (reciprocal overlap 0.5):


![CN_truth_vs_pureCN_maxCN12](https://github.com/lima1/PureCN/assets/15612230/b794bc23-a197-4421-8a8f-ce14fa74e77d)

It seems that at maxCN=12, unreliable (due to noise) high raw log2 ratios in the purity/ploidy search lead to the wrong optimal solution, scaling the CN in the output by ~2x - which intuitively makes sense, as scaling the whole spectrum of log2-ratios by 2x should provide the next-best fit, at lower estimated purity. At --max-copy-number 13 and 14, the newly included, high, but less noisy log2 ratios happen to outweigh the noise, leading to correct global purity/estimates again.

Thanks in advance

Dmitriy",ddrichel,https://github.com/lima1/PureCN/issues/321
I_kwDOBew4us5xBIv1,"'long flag ""seg-file"" is invalid'",CLOSED,2023-09-14T09:13:29Z,2023-09-23T16:41:15Z,2023-09-23T16:39:47Z,"Hi,
I Run PureCN with CNVkit segmentation:
`cnvkit.py export seg ${SAMPLE}_cnvkit.cns --enumerate-chroms -o ${SAMPLE}_cnvkit.seg`

`Rscript /data/envsoft/R-4.0.0/lib64/R/library/PureCN/extdata/PureCN.R --out ./${SAMPLE} \

    --sampleid $SAMPLE \

    --tumor ${SAMPLE}_cnvkit.cnr \

    --seg-file ${SAMPLE}_cnvkit.seg \

    --vcf ${SAMPLE}_mutect.vcf \

    --snp-blacklist hg19_simpleRepeats.bed \

    --genome hg19 \

    --fun-segmentation Hclust \

    --force --post-optimize --seed 123`
The VCF contains matched normal information. Then got the error, with no results:
`/data/envsoft/R-4.0.0/lib64/R/library/PureCN/extdata/PureCN.R: error: Error in getopt(spec = spec, opt = args) : 
     long flag ""seg-file"" is invalid`",h170607,https://github.com/lima1/PureCN/issues/322
I_kwDOBew4us5xIlh3,PureCN with ultra-deep sequenced plasma gene-panels,CLOSED,2023-09-15T09:41:54Z,2023-10-17T15:09:14Z,2023-10-17T15:09:14Z,"
Hello,

I work with ultra-deep sequencing data from plasma on a small panel (about 200 kb), and I am looking for a tool that allows me to estimate the tumor fraction of my plasma samples. Do you have any advice on the parameters to use with PureCN for this type of data to obtain good results for purity and ploidy?

Thanks in advance,
Romain",RomainBosselut,https://github.com/lima1/PureCN/issues/323
I_kwDOBew4us5xIzjK,How to set up sex of PON,CLOSED,2023-09-15T10:19:40Z,2023-10-17T15:08:57Z,2023-10-17T15:08:57Z,"**Describe the issue**
build PON from multiples samples, all samples are males

**To Reproduce**
Rscript $PURECN/Coverage.R --out-dir $OUTPUTS/normals --bam normals.list --intervals $OUT_REF/hg38_intervals.txt --cores 12 --force
ls -a $OUTPUTS/normals/*_loess.txt.gz | cat > PON_normal_coverages.list
Rscript $PURECN/NormalDB.R --out-dir $OUT_REF --coverage-files PON_normal_coverages.list --genome hg38 --assay PON --force

How to set up sex male if all my normal samples are males ?
I know that in cnvkit tool i can set --male-reference for male when i build reference (PON).

thank you--

",lmanchon,https://github.com/lima1/PureCN/issues/324
I_kwDOBew4us5x9HEp,FFPE Tumor Samples: Poor Goodness of Fit,CLOSED,2023-09-25T16:07:00Z,2023-12-07T21:53:28Z,2023-12-07T21:53:28Z,"Dear Marcus, 

once again thank you for providing this tool and the great effort you put into this project. 

I am currently struggling to set up PureCN correctly and/or to interpret the results. I have WES data of tumor patients without matched normal. The tumor material is FFPE derived and for quite a lot of these samples I also see quite a lot of noise. Some parameters of my workflow: 
- variant calling is done with Mutect2, I use a padded target interval file (50bp), the flags --genotype-germline-sites true --genotype-pon-sites true are used, I use a PoN with 30 samples
- PureCN is then run with the internal segmentation, a bait bed file could not be provided by the manufacturer, so I had to use the target bed file, the NormalDB was created with the PoN generated with Mutect2, there were too few off target counts so I had to remove the --off-target flag and re-run.

For all of my samples I get a poor goodness of fit flag. A log file of representative samples is attached and here is a snippet: 
![image](https://github.com/lima1/PureCN/assets/235535/ad430a9d-0ff2-47e2-a7c7-2f548cc8e800)

Do you have an idea what might cause this issue? Thank you so much for your help!

Best, 
Moritz
[S81_copy.log](https://github.com/lima1/PureCN/files/12717382/S81_copy.log)

 ",Moe94,https://github.com/lima1/PureCN/issues/327
I_kwDOBew4us5yE7w9,UMI affect on PureCN estimates,CLOSED,2023-09-26T16:33:23Z,2023-11-16T17:13:56Z,2023-11-16T17:13:56Z,"Hi Markus,

We are busy testing some datasets using umi barcodes, given that these have lower coverage than our non-umi data we seem to see a trend for lower CNV estimates compared to before. I am not sure if there is a way to correct for this or if there are any parameters we can look at including to improve PureCN outputs? 

Thanks!
Warren",waemm,https://github.com/lima1/PureCN/issues/328
I_kwDOBew4us5y67aQ,PureCN writes only a fraction of the variants reported in vcf,CLOSED,2023-10-05T11:25:40Z,2023-12-15T08:09:21Z,2023-11-13T16:29:17Z,"Dear Team 
I ran the following pipeline to estimate the CCF of the variants reported in a mutect 2.1 VCF.
The pipeline goes well but in the ""sorted_variants.csv"" output are printed out only 30000 variants (almost all are germline)
I expected that all the variants be printed in the final report.
Any tips?
thank you


This is my pipeline

I/home/elisa/anaconda3/envs/musica/bin/Rscript $PURECN/IntervalFile.R --infile exome.bed --fasta /data/PIPELINE/GENOMES/hg38/hg38.fa --outfile $OUT_REF/baits_hg38_intervals.txt --offtarget --genome hg38 --export $OUT_REF/baits_optimized_hg38.bed --force;


awk 'NR==1{print}NR>1{print $0}' REF/baits_hg38_intervals.txt >REF/baits_hg38_intervals2.txt 


# Calculate and GC-normalize coverage from a BAM file 
 /home/elisa/anaconda3/envs/musica/bin/Rscript $PURECN/Coverage.R --outdir $OUT_REF --bam $INPUTDIR/EXOME/ALIGNMENT/BAM/final_uniqueTUMOR_sorted.bam --intervals $OUT_REF/baits_hg38_intervals2.txt --cores 40;
 
 /home/elisa/anaconda3/envs/musica/bin/Rscript $PURECN/Coverage.R --outdir $OUT_REF --bam $INPUTDIR/EXOME/ALIGNMENT/BAM/final_uniqueCONTROL_sorted.bam --intervals $OUT_REF/baits_hg38_intervals2.txt --cores 40;
wait;
 
 java $temp -jar $gatk Mutect2 -R $GENOMEDIR/hg38.fa -I $INPUTDIR/EXOME/ALIGNMENT/BAM/final_uniqueTUMOR_sorted.bam -tumor TUMOR -I $INPUTDIR/EXOME/ALIGNMENT/BAM/final_uniqueCONTROL_sorted.bam -normal CONTROL -O mutect.vcf --genotype-germline-sites true --genotype-pon-sites true --native-pair-hmm-threads 50 --germline-resource /data/PIPELINE/GENOMES/hg38/somatic-hg38_af-only-gnomad.hg38.vcf.gz --minimum-allele-fraction 0.10
 
/home/elisa/anaconda3/envs/musica/bin/Rscript $PURECN/PureCN.R --out $OUT_REF --tumor $OUT_REF/final_uniqueTUMOR_sorted_coverage_loess.txt.gz --normal $OUT_REF/final_uniqueCONTROL_sorted_coverage_loess.txt.gz --sampleid final_uniqueTUMOR_sorted --vcf mutect.vcf --intervals $OUT_REF/baits_hg38_intervals2.txt --genome hg38 


this is my sessionInfo

> sessionInfo()
R version 4.0.5 (2021-03-31)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: Ubuntu 18.04.6 LTS

Matrix products: default
BLAS/LAPACK: /home/elisa/anaconda3/envs/musica/lib/libopenblasp-r0.3.21.so

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
 [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
 [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats4    parallel  stats     graphics  grDevices utils     datasets 
[8] methods   base     

other attached packages:
 [1] PureCN_1.20.0               VariantAnnotation_1.36.0   
 [3] Rsamtools_2.6.0             Biostrings_2.58.0          
 [5] XVector_0.30.0              SummarizedExperiment_1.20.0
 [7] Biobase_2.50.0              GenomicRanges_1.42.0       
 [9] GenomeInfoDb_1.26.7         IRanges_2.24.1             
[11] S4Vectors_0.28.1            MatrixGenerics_1.2.1       
[13] matrixStats_1.0.0           BiocGenerics_0.36.1        
[15] DNAcopy_1.64.0             

loaded via a namespace (and not attached):
 [1] httr_1.4.7               VGAM_1.1-9               bit64_4.0.5             
 [4] splines_4.0.5            askpass_1.2.0            BiocFileCache_1.14.0    
 [7] blob_1.2.4               BSgenome_1.58.0          GenomeInfoDbData_1.2.4  
[10] progress_1.2.2           pillar_1.9.0             RSQLite_2.3.1           
[13] lattice_0.21-9           glue_1.6.2               RColorBrewer_1.1-3      
[16] colorspace_2.1-0         Matrix_1.6-1.1           XML_3.99-0.14           
[19] pkgconfig_2.0.3          biomaRt_2.46.3           zlibbioc_1.36.0         
[22] scales_1.2.1             BiocParallel_1.24.1      tibble_3.2.1            
[25] openssl_2.1.1            generics_0.1.3           ggplot2_3.4.3           
[28] cachem_1.0.8             GenomicFeatures_1.42.3   cli_3.6.1               
[31] magrittr_2.0.3           crayon_1.5.2             memoise_2.0.1           
[34] fansi_1.0.4              xml2_1.3.5               tools_4.0.5             
[37] data.table_1.14.8        prettyunits_1.2.0        hms_1.1.3               
[40] formatR_1.14             lifecycle_1.0.3          stringr_1.5.0           
[43] Rhdf5lib_1.12.1          munsell_0.5.0            DelayedArray_0.16.3     
[46] AnnotationDbi_1.52.0     lambda.r_1.2.4           compiler_4.0.5          
[49] rlang_1.1.1              rhdf5_2.34.0             futile.logger_1.4.3     
[52] grid_4.0.5               RCurl_1.98-1.12          rhdf5filters_1.2.1      
[55] rappdirs_0.3.3           bitops_1.0-7             gtable_0.3.4            
[58] DBI_1.1.3                curl_4.3.2               R6_2.5.1                
[61] gridExtra_2.3            GenomicAlignments_1.26.0 dplyr_1.1.3             
[64] rtracklayer_1.50.0       fastmap_1.1.1            bit_4.0.5               
[67] utf8_1.2.3               futile.options_1.0.1     stringi_1.7.12          
[70] vctrs_0.6.3              dbplyr_2.3.4             tidyselect_1.2.0 


",GuidoLeoni,https://github.com/lima1/PureCN/issues/329
I_kwDOBew4us5zWqTc,How to cite in the manuscript if running PureCN with GATK segmentation,CLOSED,2023-10-10T12:59:42Z,2023-10-10T13:25:59Z,2023-10-10T13:25:58Z,"Hi, I recently ran the WES using PureCN, and GATK segmentation was applied. Could you please clarify that GATK represents GATK-gCNV (https://www-nature-com.proxy.kib.ki.se/articles/s41588-023-01449-0) or conventional GATK (https://gatk.broadinstitute.org/hc/en-us/articles/360035535892-Somatic-copy-number-variant-discovery-CNVs-)? 

Thanks in advance!
Kang",WangKang-Leo,https://github.com/lima1/PureCN/issues/330
I_kwDOBew4us50wRoW,Missing chromosomename prefix in DNAcopy output file after PSCBS,CLOSED,2023-10-24T09:00:32Z,2023-10-27T14:18:38Z,2023-10-27T14:18:38Z,"**Describe the issue**
We are using GRCh38.d1.vd1 (which has `chr` prefix in their chromosome names), and when we select the `PSCBS` segmentation, we notice that this prefix is missing in the `<sample>_dnacopy.seg` file, and in this file only.

The `<sample>_dnacopy.seg` file looks like:

```
$ head output/<sample>_dnacopy.seg 
ID	chrom	loc.start	loc.end	num.mark	seg.mean	C
<sample>	1	925932	122026458	11983	-0.0481143805497686	2
<sample>	1	124932725	152060910	887	0.0376277667132479	2
<sample>	1	152060910	152929951	165	0.269045736247666	3
<sample>	1	152929951	248918032	8992	0.0376277667132479	2
<sample>	2	41547	27520613	1806	-0.0475065381774023	2
<sample>	2	27520613	27582676	47	0.226940040709251	3
<sample>	2	27582676	73448316	2993	-0.0475065381774023	2
<sample>	2	73448317	73454437	17	0.320080262369761	4
<sample>	2	73454437	73625221	22	0.0920044179441789	2
```

**To Reproduce**
Command issued using the docker container:

```
Rscript /opt/PureCN/PureCN.R \
    --genome hg38 \
    --sampleid $sample \
    --tumor /input/coverage/$sample/bwa.${sample}_coverage_loess.txt.gz \
    --vcf /input/vcfs/bwa.mutect2.$sample.vcf.gz \
    --normaldb /input/panel_of_normals/normalDB_SureSelectv8_hg38.rds \
    --intervals /input/extra/intervals.list \
    --fun-segmentation PSCBS --model betabin --post-optimize --seed 1234567 \
    --out /output/$sample --out-vcf
```

The same behaviour is observed using the code from github.

**Expected behavior**
The first lines of `<sample>_dnacopy.seg` should look like

```
ID	chrom	loc.start	loc.end	num.mark	seg.mean	C
<sample>	chr1	925932	122026458	11983	-0.0481143805497686	2
<sample>	chr1	124932725	152060910	887	0.0376277667132479	2
<sample>	chr1	152060910	152929951	165	0.269045736247666	3
<sample>	chr1	152929951	248918032	8992	0.0376277667132479	2
<sample>	chr2	41547	27520613	1806	-0.0475065381774023	2
<sample>	chr2	27520613	27582676	47	0.226940040709251	3
<sample>	chr2	27582676	73448316	2993	-0.0475065381774023	2
<sample>	chr2	73448317	73454437	17	0.320080262369761	4
<sample>	chr2	73454437	73625221	22	0.0920044179441789	2
```

**Session Info**

Docker label: `RELEASE_3_17`

For the run based on the github code: 

```
> sessionInfo()
R version 4.3.1 (2023-06-16)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.6 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0 
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=de_DE.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=de_DE.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C       

time zone: Europe/Berlin
tzcode source: system (glibc)

attached base packages:
[1] stats4    stats     graphics  grDevices utils     datasets  methods  
[8] base     

other attached packages:
 [1] PureCN_2.7.12               VariantAnnotation_1.46.0   
 [3] Rsamtools_2.16.0            Biostrings_2.68.1          
 [5] XVector_0.40.0              SummarizedExperiment_1.30.2
 [7] Biobase_2.60.0              GenomicRanges_1.52.0       
 [9] GenomeInfoDb_1.36.3         IRanges_2.34.1             
[11] S4Vectors_0.38.2            MatrixGenerics_1.12.3      
[13] matrixStats_1.0.0           BiocGenerics_0.46.0        
[15] DNAcopy_1.74.1             

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.0         dplyr_1.1.3              blob_1.2.4              
 [4] filelock_1.0.2           bitops_1.0-7             fastmap_1.1.1           
 [7] RCurl_1.98-1.12          BiocFileCache_2.8.0      GenomicAlignments_1.36.0
[10] XML_3.99-0.14            digest_0.6.33            lifecycle_1.0.3         
[13] KEGGREST_1.40.0          RSQLite_2.3.1            magrittr_2.0.3          
[16] compiler_4.3.1           rlang_1.1.1              progress_1.2.2          
[19] tools_4.3.1              utf8_1.2.3               yaml_2.3.7              
[22] data.table_1.14.8        rtracklayer_1.60.1       lambda.r_1.2.4          
[25] prettyunits_1.2.0        S4Arrays_1.0.6           mclust_6.0.0            
[28] bit_4.0.5                curl_5.0.2               DelayedArray_0.26.7     
[31] xml2_1.3.5               RColorBrewer_1.1-3       abind_1.4-5             
[34] BiocParallel_1.34.2      grid_4.3.1               fansi_1.0.4             
[37] colorspace_2.1-0         Rhdf5lib_1.22.1          ggplot2_3.4.3           
[40] scales_1.2.1             biomaRt_2.56.1           cli_3.6.1               
[43] crayon_1.5.2             generics_0.1.3           httr_1.4.7              
[46] rjson_0.2.21             rhdf5_2.44.0             DBI_1.1.3               
[49] cachem_1.0.8             stringr_1.5.0            zlibbioc_1.46.0         
[52] splines_4.3.1            parallel_4.3.1           AnnotationDbi_1.62.2    
[55] formatR_1.14             restfulr_0.0.15          vctrs_0.6.3             
[58] Matrix_1.6-0             VGAM_1.1-9               hms_1.1.3               
[61] bit64_4.0.5              GenomicFeatures_1.52.2   glue_1.6.2              
[64] codetools_0.2-19         gtable_0.3.4             stringi_1.7.12          
[67] futile.logger_1.4.3      BiocIO_1.10.0            munsell_0.5.0           
[70] tibble_3.2.1             pillar_1.9.0             rhdf5filters_1.12.1     
[73] rappdirs_0.3.3           GenomeInfoDbData_1.2.10  BSgenome_1.68.0         
[76] R6_2.5.1                 dbplyr_2.3.4             lattice_0.21-8          
[79] futile.options_1.0.1     png_0.1-8                memoise_2.0.1           
[82] gridExtra_2.3            pkgconfig_2.0.3         
```

**Additional context**

We have tried to add the chromosome names to `.PSCBSoutput2DNAcopy`, giving the function `chr.hash` as an extra argument. It appears to be working in our limited tests: the chromosome names are with prefix in the `*_dnacopy.seg` file, and there are no change to the 5 `*.csv` files, to the vcf file, and no apparent changes to the pdf files.

For completeness, the diff of the changes to file `segmentationPSCBS` are below:

```
$ diff PureCN_orig/R/segmentationPSCBS.R PureCN_modif/R/segmentationPSCBS.R 
136c136
<             segot <- .PSCBSoutput2DNAcopy(segPSCBSot, sampleid)
---
>             segot <- .PSCBSoutput2DNAcopy(segPSCBSot, sampleid, chr.hash)
150c150
<         seg <- .PSCBSoutput2DNAcopy(segPSCBS, sampleid)
---
>         seg <- .PSCBSoutput2DNAcopy(segPSCBS, sampleid, chr.hash)
156c156
<             segusd <- .PSCBSoutput2DNAcopy(segusd, sampleid)
---
>             segusd <- .PSCBSoutput2DNAcopy(segusd, sampleid, chr.hash)
243c243
< .PSCBSoutput2DNAcopy <- function(seg, sampleid) {
---
> .PSCBSoutput2DNAcopy <- function(seg, sampleid, chr.hash) {
249a250
> 	sx$chrom <- .add.chr.name(sx$chrom, chr.hash)
```",ericblanc20,https://github.com/lima1/PureCN/issues/331
I_kwDOBew4us51Y08l,PureCN.R returns many warnings. Possible issue with Panel of Normals.,CLOSED,2023-10-31T00:47:33Z,2023-12-06T19:55:57Z,2023-12-06T19:55:57Z,"
Hi, I am running PureCN on a set of variants combined from mutect2 and varscan2 results and using a panel of normals derived from 1000G exon capture samples. Running PureCN has produced a set of warnings, some of which I do not see in the existing issues. Here are the warnings that came up across the 18 samples I am running:

WARN  AD field misses ref counts.
WARN  Did not find base quality scores, will use global error rate of 0.0010 instead.
WARN  High GC-bias in normalized tumor vs normal log2 ratio.
WARN  --intervals does not contain gene symbols. Not generating gene-level calls.
WARN  Low number of off-target intervals. You might want to exclude them (182161 on-target, 17889 off-target, ratio 0.09).
WARN  vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.

I can see that the VarScan2 vcf formatting is the cause of the first “AD missing” error. The reporting of ref and alt alleles are split into two different INFO tags, instead of being reported under AD as a vector. I think I can find a way to modify vcf inputs to contain DB info field. Are base quality scores necessary and if so, is there a recommended procedure for including base quality scores in the VCF?
Although PureCN was able to return results for Purity and Ploidy, I am concerned about the high GC-bias in the normalized tumor vs normal log2 ratio and the low number of off-target intervals. I believe that the 1000G samples that I used for the panel of normals use the same exon capture kit as my samples, however I’m aware of a ~10-fold difference in the coverage. 1000G samples have ~30x while my samples have ~275x coverage. Could this discrepancy be contributing to these patterns?
I’m concerned that some upstream aspect of the analysis is causing these warnings, and I would be grateful for suggestions on troubleshooting.

**To Reproduce**
```
## Commands ###
#Generate an interval file from a BED file containing baits coordinates
Rscript $PURECN/IntervalFile.R --in-file $BAITS \
        --fasta $REF_GEN --out-file $OUT_REF/baits_hg38_intervals.txt \
        --off-target --genome hg38 \
        --export $OUT_REF/baits_optimized_grch38.bed \
        --mappability $MAP

#Calculate and GC-normalize coverage from a BAM file
for SAMPLEID in $( ls ${SAMPLEDIR}/*.bam ); do
        SAMPNAME=$( echo $SAMPLEID | xargs -n 1 basename )
        mkdir -p $COV/${SAMPNAME%.bam}
        Rscript $PURECN/Coverage.R --outdir $COV/${SAMPNAME%.bam} \
                --bam ${SAMPLEID} \
                --intervals $OUT_REF/baits_hg38_intervals.txt \
                --cores 24
done
# Create a normals list from 1000G exome alignment bams
ls ./exome_alignment/*bam > normals.list

# Calculate and GC-normalize coverage from a list of BAM files
mkdir -p $COV/normals
Rscript $PURECN/Coverage.R --out-dir $COV/normals \
        --bam normals.list \
        --intervals $OUT_REF/baits_hg38_intervals.txt \
        --cores 24

ls -a $COV/normals/*_loess.txt.gz | cat > example_normal_coverages.list


#create tabix index for merged file
module load samtools
tabix $NORMAL_PANEL

# When normal panel VCF is available (highly recommended for
# unmatched samples)
Rscript $PURECN/NormalDB.R --out-dir $OUT_REF \
        --coverage-files example_normal_coverages.list \
        --normal-panel $NORMAL_PANEL \
        --genome hg38 \
        --assay agilent_v6

# Production pipeline run

mkdir -p $OUT/$SAMPLEID

Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEID \
        --tumor $COV/${SAMPLEID}_accepted_hits/${SAMPLEID}_accepted_hits_coverage_loess.txt.gz \
        --sampleid $SAMPLEID \
        --vcf $TUMOR_VCF/${SAMPLEID}_anno.vcf \
        --fun-segmentation PSCBS \
        --normaldb $OUT_REF/normalDB_agilent_v6_hg38.rds \
        --mapping-bias-file $OUT_REF/mapping_bias_agilent_v6_hg38.rds \
        --intervals $OUT_REF/baits_hg38_intervals.txt \
        --snp-blacklist /blue/scripps-bas/clients/janiszewska/mseq/grch38/blacklist/hg38-blacklist.v2.bed \
        --genome hg38 \
        --model betabin \
        --force --post-optimize --seed 123 \
        --popaf-info-field ANNO.1000G \
        --min-af 0.01
```
**Expected behavior**
The GC-bias and off-target interval warnings are unexpected, I also do not expect poor goodness of fit warnings.

**Log file**
INFO [2023-06-13 12:30:47] ------------------------------------------------------------
INFO [2023-06-13 12:30:47] PureCN 2.4.0
INFO [2023-06-13 12:30:47] ------------------------------------------------------------
INFO [2023-06-13 12:30:47] Arguments: -tumor.coverage.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/coverage/OS11_accepted_hits/OS11_accepted_hits_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/filtering/OS11_final.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid OS11 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -BPPARAM  -log.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/results/OS11/OS11.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-06-13 12:30:47] Loading coverage files...
INFO [2023-06-13 12:30:50] Mean target coverages: 179X (tumor) 172X (normal).
INFO [2023-06-13 12:30:51] Mean coverages: chrX: 153.34, chrY: 64.43, chr1-22: 146.87.
INFO [2023-06-13 12:30:51] Mean coverages: chrX: 110.83, chrY: 64.35, chr1-22: 140.48.
INFO [2023-06-13 12:30:54] Removing 738 intervals with missing log.ratio.
INFO [2023-06-13 12:30:54] Removing 7 low/high GC targets.
INFO [2023-06-13 12:30:54] Removing 66853 intervals excluded in normalDB.
INFO [2023-06-13 12:30:54] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-06-13 12:30:54] Removing 1064 low count (< 100 total reads) intervals.
INFO [2023-06-13 12:30:54] Removing 8406 low coverage (< 0.0015X) intervals.
WARN [2023-06-13 12:30:54] Low number of off-target intervals. You might want to exclude them (182227 on-target, 18450 off-target, ratio 0.09).
INFO [2023-06-13 12:30:54] Removing 17 intervals on non-standard chromosomes not listed in centromeres (chr1_KI270706v1_random,chr1_KI270711v1_random,chr1_KI270766v1_alt,chr4_GL000008v2_random,chr7_KI270803v1_alt,chr8_KI270821v1_alt,chr14_GL000009v2_random,chr14_KI270846v1_alt,chr15_KI270850v1_alt,chr17_KI270857v1_alt,chr17_KI270909v1_alt,chr19_KI270938v1_alt,chr22_KI270879v1_alt,chr22_KI270928v1_alt,chrUn_KI270742v1).
INFO [2023-06-13 12:30:54] Using 200660 intervals (182223 on-target, 18437 off-target).
INFO [2023-06-13 12:30:55] Ratio of mean on-target vs. off-target read counts: 1.10
INFO [2023-06-13 12:30:55] Mean off-target bin size: 80566
INFO [2023-06-13 12:30:55] AT/GC dropout: 1.06 (tumor), 1.00 (normal), 1.08 (coverage log-ratio).
WARN [2023-06-13 12:30:55] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2023-06-13 12:30:55] Loading VCF...
INFO [2023-06-13 12:30:55] Found 24688 variants in VCF file.
FATAL [2023-06-13 12:30:55] vcf.file has no %s or %s info field for membership in germline

FATAL [2023-06-13 12:30:55] databases.DBPOP_AF

FATAL [2023-06-13 12:30:55]

FATAL [2023-06-13 12:30:55] This is most likely a user error due to invalid input data or

FATAL [2023-06-13 12:30:55] parameters (PureCN 2.4.0).

INFO [2023-09-07 15:26:14] ------------------------------------------------------------
INFO [2023-09-07 15:26:14] PureCN 2.4.0
INFO [2023-09-07 15:26:14] ------------------------------------------------------------
INFO [2023-09-07 15:26:14] Arguments: -tumor.coverage.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/coverage/OS11_accepted_hits/OS11_accepted_hits_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/filtering/OS11_final.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid OS11 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field ANNO.1000G -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -BPPARAM  -log.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/results/OS11/OS11.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-09-07 15:26:14] Loading coverage files...
INFO [2023-09-07 15:26:17] Mean target coverages: 179X (tumor) 172X (normal).
INFO [2023-09-07 15:26:18] Mean coverages: chrX: 153.34, chrY: 64.43, chr1-22: 146.87.
INFO [2023-09-07 15:26:18] Mean coverages: chrX: 110.83, chrY: 64.35, chr1-22: 140.48.
INFO [2023-09-07 15:26:21] Removing 738 intervals with missing log.ratio.
INFO [2023-09-07 15:26:21] Removing 7 low/high GC targets.
INFO [2023-09-07 15:26:21] Removing 66853 intervals excluded in normalDB.
INFO [2023-09-07 15:26:21] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-09-07 15:26:21] Removing 1064 low count (< 100 total reads) intervals.
INFO [2023-09-07 15:26:21] Removing 8406 low coverage (< 0.0015X) intervals.
WARN [2023-09-07 15:26:21] Low number of off-target intervals. You might want to exclude them (182227 on-target, 18450 off-target, ratio 0.09).
INFO [2023-09-07 15:26:21] Removing 17 intervals on non-standard chromosomes not listed in centromeres (chr1_KI270706v1_random,chr1_KI270711v1_random,chr1_KI270766v1_alt,chr4_GL000008v2_random,chr7_KI270803v1_alt,chr8_KI270821v1_alt,chr14_GL000009v2_random,chr14_KI270846v1_alt,chr15_KI270850v1_alt,chr17_KI270857v1_alt,chr17_KI270909v1_alt,chr19_KI270938v1_alt,chr22_KI270879v1_alt,chr22_KI270928v1_alt,chrUn_KI270742v1).
INFO [2023-09-07 15:26:21] Using 200660 intervals (182223 on-target, 18437 off-target).
INFO [2023-09-07 15:26:21] Ratio of mean on-target vs. off-target read counts: 1.10
INFO [2023-09-07 15:26:21] Mean off-target bin size: 80566
INFO [2023-09-07 15:26:22] AT/GC dropout: 1.06 (tumor), 1.00 (normal), 1.08 (coverage log-ratio).
WARN [2023-09-07 15:26:22] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2023-09-07 15:26:22] Loading VCF...
INFO [2023-09-07 15:26:22] Found 24688 variants in VCF file.
FATAL [2023-09-07 15:26:22] vcf.file has no %s or %s info field for membership in germline

FATAL [2023-09-07 15:26:22] databases.DBANNO.1000G

FATAL [2023-09-07 15:26:22]

FATAL [2023-09-07 15:26:22] This is most likely a user error due to invalid input data or

FATAL [2023-09-07 15:26:22] parameters (PureCN 2.4.0).

INFO [2023-09-07 15:32:18] ------------------------------------------------------------
INFO [2023-09-07 15:32:18] PureCN 2.4.0
INFO [2023-09-07 15:32:18] ------------------------------------------------------------
INFO [2023-09-07 15:32:18] Arguments: -tumor.coverage.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/coverage/OS11_accepted_hits/OS11_accepted_hits_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/vcf_anno/bcftools/OS11_anno.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid OS11 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field ANNO.1000G -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -BPPARAM  -log.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/results/OS11/OS11.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-09-07 15:32:18] Loading coverage files...
INFO [2023-09-07 15:32:22] Mean target coverages: 179X (tumor) 172X (normal).
INFO [2023-09-07 15:32:22] Mean coverages: chrX: 153.34, chrY: 64.43, chr1-22: 146.87.
INFO [2023-09-07 15:32:22] Mean coverages: chrX: 110.83, chrY: 64.35, chr1-22: 140.48.
INFO [2023-09-07 15:32:25] Removing 738 intervals with missing log.ratio.
INFO [2023-09-07 15:32:25] Removing 7 low/high GC targets.
INFO [2023-09-07 15:32:25] Removing 66853 intervals excluded in normalDB.
INFO [2023-09-07 15:32:25] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-09-07 15:32:25] Removing 1064 low count (< 100 total reads) intervals.
INFO [2023-09-07 15:32:25] Removing 8406 low coverage (< 0.0015X) intervals.
WARN [2023-09-07 15:32:26] Low number of off-target intervals. You might want to exclude them (182227 on-target, 18450 off-target, ratio 0.09).
INFO [2023-09-07 15:32:26] Removing 17 intervals on non-standard chromosomes not listed in centromeres (chr1_KI270706v1_random,chr1_KI270711v1_random,chr1_KI270766v1_alt,chr4_GL000008v2_random,chr7_KI270803v1_alt,chr8_KI270821v1_alt,chr14_GL000009v2_random,chr14_KI270846v1_alt,chr15_KI270850v1_alt,chr17_KI270857v1_alt,chr17_KI270909v1_alt,chr19_KI270938v1_alt,chr22_KI270879v1_alt,chr22_KI270928v1_alt,chrUn_KI270742v1).
INFO [2023-09-07 15:32:26] Using 200660 intervals (182223 on-target, 18437 off-target).
INFO [2023-09-07 15:32:26] Ratio of mean on-target vs. off-target read counts: 1.10
INFO [2023-09-07 15:32:26] Mean off-target bin size: 80566
INFO [2023-09-07 15:32:26] AT/GC dropout: 1.06 (tumor), 1.00 (normal), 1.08 (coverage log-ratio).
WARN [2023-09-07 15:32:26] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2023-09-07 15:32:26] Loading VCF...
INFO [2023-09-07 15:32:27] Found 94798 variants in VCF file.
INFO [2023-09-07 15:32:27] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2023-09-07 15:32:27] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2023-09-07 15:32:27] 68221 (72.0%) variants annotated as likely germline (DB INFO flag).
WARN [2023-09-07 15:32:27] AD field misses ref counts.
WARN [2023-09-07 15:32:28] Did not find base quality scores, will use global error rate of 0.0010 instead.
INFO [2023-09-07 15:32:29] Sample1 is tumor in VCF file.
INFO [2023-09-07 15:32:29] 735 homozygous and 152 heterozygous variants on chrX.
INFO [2023-09-07 15:32:29] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 8.35).
INFO [2023-09-07 15:32:29] Removing 0 low quality variants with non-offset BQ < 25.
INFO [2023-09-07 15:32:29] Global base quality score of 29
INFO [2023-09-07 15:32:29] Minimum number of supporting reads ranges from 4 to 9, depending on coverage and BQS.
INFO [2023-09-07 15:32:33] Initial testing for significant sample cross-contamination: maybe
INFO [2023-09-07 15:32:33] Removing 29139 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2023-09-07 15:32:33] Removing 0 blacklisted variants.
INFO [2023-09-07 15:32:33] Total size of targeted genomic region: 41.37Mb (55.55Mb with 50bp padding).
INFO [2023-09-07 15:32:33] 15.0% of targets contain variants.
INFO [2023-09-07 15:32:33] Removing 31771 variants outside intervals.
INFO [2023-09-07 15:32:33] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2023-09-07 15:32:33] Loading mapping bias file mapping_bias_agilent_v6_hg38.rds...
INFO [2023-09-07 15:33:39] Found 26569405 variants in mapping bias file.
INFO [2023-09-07 15:33:56] Imputing mapping bias for 4146 variants...
INFO [2023-09-07 15:40:00] Excluding 9131 novel or poor quality variants from segmentation.
INFO [2023-09-07 15:40:00] Excluding 4146 variants not in pool of normals from segmentation.
INFO [2023-09-07 15:40:00] Sample sex: M
INFO [2023-09-07 15:40:00] Segmenting data...
FATAL [2023-09-07 15:40:00] segmentationPSCBS requires the PSCBS package.

FATAL [2023-09-07 15:40:00]

FATAL [2023-09-07 15:40:00] This is most likely a user error due to invalid input data or

FATAL [2023-09-07 15:40:00] parameters (PureCN 2.4.0).

INFO [2023-09-08 11:56:44] ------------------------------------------------------------
INFO [2023-09-08 11:56:44] PureCN 2.4.0
INFO [2023-09-08 11:56:44] ------------------------------------------------------------
INFO [2023-09-08 11:56:44] Arguments: -tumor.coverage.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/coverage/OS11_accepted_hits/OS11_accepted_hits_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/vcf_anno/bcftools/OS11_anno.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid OS11 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/reference_files/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field ANNO.1000G -Cosmic.CNT.info.field Cosmic.CNT -model betabin -post.optimize TRUE -BPPARAM  -log.file /blue/scripps-bas/clients/janiszewska/mseq/grch38/purecn/results/OS11/OS11.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-09-08 11:56:44] Loading coverage files...
INFO [2023-09-08 11:56:47] Mean target coverages: 179X (tumor) 172X (normal).
INFO [2023-09-08 11:56:47] Mean coverages: chrX: 153.34, chrY: 64.43, chr1-22: 146.87.
INFO [2023-09-08 11:56:47] Mean coverages: chrX: 110.83, chrY: 64.35, chr1-22: 140.48.
INFO [2023-09-08 11:56:50] Removing 738 intervals with missing log.ratio.
INFO [2023-09-08 11:56:50] Removing 7 low/high GC targets.
INFO [2023-09-08 11:56:51] Removing 66853 intervals excluded in normalDB.
INFO [2023-09-08 11:56:51] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-09-08 11:56:51] Removing 1064 low count (< 100 total reads) intervals.
INFO [2023-09-08 11:56:51] Removing 8406 low coverage (< 0.0015X) intervals.
WARN [2023-09-08 11:56:51] Low number of off-target intervals. You might want to exclude them (182227 on-target, 18450 off-target, ratio 0.09).
INFO [2023-09-08 11:56:51] Removing 17 intervals on non-standard chromosomes not listed in centromeres (chr1_KI270706v1_random,chr1_KI270711v1_random,chr1_KI270766v1_alt,chr4_GL000008v2_random,chr7_KI270803v1_alt,chr8_KI270821v1_alt,chr14_GL000009v2_random,chr14_KI270846v1_alt,chr15_KI270850v1_alt,chr17_KI270857v1_alt,chr17_KI270909v1_alt,chr19_KI270938v1_alt,chr22_KI270879v1_alt,chr22_KI270928v1_alt,chrUn_KI270742v1).
INFO [2023-09-08 11:56:51] Using 200660 intervals (182223 on-target, 18437 off-target).
INFO [2023-09-08 11:56:51] Ratio of mean on-target vs. off-target read counts: 1.10
INFO [2023-09-08 11:56:51] Mean off-target bin size: 80566
INFO [2023-09-08 11:56:51] AT/GC dropout: 1.06 (tumor), 1.00 (normal), 1.08 (coverage log-ratio).
WARN [2023-09-08 11:56:51] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2023-09-08 11:56:51] Loading VCF...
INFO [2023-09-08 11:56:52] Found 94798 variants in VCF file.
INFO [2023-09-08 11:56:52] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2023-09-08 11:56:52] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2023-09-08 11:56:52] 68221 (72.0%) variants annotated as likely germline (DB INFO flag).
WARN [2023-09-08 11:56:52] AD field misses ref counts.
WARN [2023-09-08 11:56:54] Did not find base quality scores, will use global error rate of 0.0010 instead.
INFO [2023-09-08 11:56:54] Sample1 is tumor in VCF file.
INFO [2023-09-08 11:56:54] 735 homozygous and 152 heterozygous variants on chrX.
INFO [2023-09-08 11:56:54] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 8.35).
INFO [2023-09-08 11:56:54] Removing 0 low quality variants with non-offset BQ < 25.
INFO [2023-09-08 11:56:54] Global base quality score of 29
INFO [2023-09-08 11:56:54] Minimum number of supporting reads ranges from 4 to 9, depending on coverage and BQS.
INFO [2023-09-08 11:56:58] Initial testing for significant sample cross-contamination: maybe
INFO [2023-09-08 11:56:58] Removing 27993 variants with AF < 0.010 or AF >= 0.990 or insufficient supporting reads or depth < 15.
INFO [2023-09-08 11:56:58] Removing 0 blacklisted variants.
INFO [2023-09-08 11:56:58] Total size of targeted genomic region: 41.37Mb (55.55Mb with 50bp padding).
INFO [2023-09-08 11:56:58] 15.3% of targets contain variants.
INFO [2023-09-08 11:56:59] Removing 32129 variants outside intervals.
INFO [2023-09-08 11:56:59] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2023-09-08 11:56:59] Loading mapping bias file mapping_bias_agilent_v6_hg38.rds...
INFO [2023-09-08 11:58:03] Found 26569405 variants in mapping bias file.
INFO [2023-09-08 11:58:19] Imputing mapping bias for 4474 variants...
INFO [2023-09-08 12:04:41] Excluding 9571 novel or poor quality variants from segmentation.
INFO [2023-09-08 12:04:41] Excluding 4474 variants not in pool of normals from segmentation.
INFO [2023-09-08 12:04:41] Sample sex: M
INFO [2023-09-08 12:04:41] Segmenting data...
INFO [2023-09-08 12:04:41] Interval weights found, will use weighted PSCBS.
INFO [2023-09-08 12:04:41] MAPD of 17967 allelic fractions: 0.05 (0.06 adjusted).
INFO [2023-09-08 12:04:42] Setting undo.SD parameter to 1.250000.
INFO [2023-09-08 12:04:54] Setting prune.hclust.h parameter to 0.200000.
INFO [2023-09-08 12:04:54] Found 82 segments with median size of 9.67Mb.
INFO [2023-09-08 12:04:55] Removing 5 variants outside segments.
INFO [2023-09-08 12:04:55] Using 34671 variants.
INFO [2023-09-08 12:04:56] Mean standard deviation of log-ratios: 0.76 (MAPD: 0.57)
INFO [2023-09-08 12:04:56] Mean standard deviation of on-target log-ratios only: 0.78 (MAPD: 0.60)
INFO [2023-09-08 12:04:56] Mean standard deviation of off-target log-ratios only: 0.39 (MAPD: 0.25)
INFO [2023-09-08 12:04:56] 2D-grid search of purity and ploidy...
INFO [2023-09-08 12:07:57] Local optima: 0.48/2.4, 0.35/2, 0.42/1.9, 0.29/2.1, 0.55/3, 0.78/4.2,
0.52/2, 0.95/5.8, 0.78/2
INFO [2023-09-08 12:07:57] Testing local optimum 1/9 at purity 0.48 and total ploidy 2.40...
INFO [2023-09-08 12:08:10] Testing local optimum 2/9 at purity 0.35 and total ploidy 2.00...
INFO [2023-09-08 12:08:25] Testing local optimum 3/9 at purity 0.42 and total ploidy 1.90...
INFO [2023-09-08 12:08:34] Testing local optimum 4/9 at purity 0.29 and total ploidy 2.10...
INFO [2023-09-08 12:08:50] Testing local optimum 5/9 at purity 0.55 and total ploidy 3.00...
INFO [2023-09-08 12:09:09] Testing local optimum 6/9 at purity 0.78 and total ploidy 4.20...
INFO [2023-09-08 12:09:25] Testing local optimum 7/9 at purity 0.52 and total ploidy 2.00...
INFO [2023-09-08 12:09:36] Testing local optimum 8/9 at purity 0.95 and total ploidy 5.80...
INFO [2023-09-08 12:09:38] Recalibrating log-ratios...
INFO [2023-09-08 12:09:38] Testing local optimum 8/9 at purity 0.95 and total ploidy 5.80...
INFO [2023-09-08 12:09:50] Recalibrating log-ratios...
INFO [2023-09-08 12:09:50] Testing local optimum 8/9 at purity 0.95 and total ploidy 5.80...
INFO [2023-09-08 12:10:05] Recalibrating log-ratios...
INFO [2023-09-08 12:10:05] Testing local optimum 8/9 at purity 0.95 and total ploidy 5.80...
INFO [2023-09-08 12:10:22] Testing local optimum 9/9 at purity 0.78 and total ploidy 2.00...
INFO [2023-09-08 12:10:33] Skipping 2 solutions that converged to the same optima.
INFO [2023-09-08 12:10:33] Fitting variants with betabin model for local optimum 1/9...
INFO [2023-09-08 12:10:33] Fitting variants for purity 0.49, tumor ploidy 2.93 and contamination 0.01.
INFO [2023-09-08 12:12:05] Poor goodness-of-fit (0.422). Skipping post-optimization.
INFO [2023-09-08 12:12:05] Optimized purity: 0.49
INFO [2023-09-08 12:12:05] Fitting variants with betabin model for local optimum 2/9...
INFO [2023-09-08 12:12:05] Fitting variants for purity 0.34, tumor ploidy 2.22 and contamination 0.01.
INFO [2023-09-08 12:13:39] Poor goodness-of-fit (0.424). Skipping post-optimization.
INFO [2023-09-08 12:13:39] Optimized purity: 0.34
INFO [2023-09-08 12:13:39] Fitting variants with betabin model for local optimum 3/9...
INFO [2023-09-08 12:13:39] Fitting variants for purity 0.45, tumor ploidy 1.96 and contamination 0.01.
INFO [2023-09-08 12:15:10] Poor goodness-of-fit (0.427). Skipping post-optimization.
INFO [2023-09-08 12:15:10] Optimized purity: 0.45
INFO [2023-09-08 12:15:10] Fitting variants with betabin model for local optimum 4/9...
INFO [2023-09-08 12:15:10] Fitting variants for purity 0.40, tumor ploidy 3.24 and contamination 0.01.
INFO [2023-09-08 12:16:47] Poor goodness-of-fit (0.470). Skipping post-optimization.
INFO [2023-09-08 12:16:47] Optimized purity: 0.40
INFO [2023-09-08 12:16:47] Fitting variants with betabin model for local optimum 5/9...
INFO [2023-09-08 12:16:47] Fitting variants for purity 0.61, tumor ploidy 3.99 and contamination 0.01.
INFO [2023-09-08 12:18:24] Poor goodness-of-fit (0.496). Skipping post-optimization.
INFO [2023-09-08 12:18:24] Optimized purity: 0.61
INFO [2023-09-08 12:18:24] Fitting variants with betabin model for local optimum 6/9...
INFO [2023-09-08 12:18:24] Fitting variants for purity 0.86, tumor ploidy 5.00 and contamination 0.01.
INFO [2023-09-08 12:19:58] Poor goodness-of-fit (0.549). Skipping post-optimization.
INFO [2023-09-08 12:19:58] Optimized purity: 0.86
INFO [2023-09-08 12:19:58] Fitting variants with betabin model for local optimum 9/9...
INFO [2023-09-08 12:19:58] Fitting variants for purity 0.59, tumor ploidy 2.90 and contamination 0.01.
INFO [2023-09-08 12:21:33] Poor goodness-of-fit (0.350). Skipping post-optimization.
INFO [2023-09-08 12:21:33] Optimized purity: 0.59
INFO [2023-09-08 12:21:33] Initial guess of contamination rate: 0.050
INFO [2023-09-08 12:21:33] Optimizing contamination rate of optimum 1/5...
INFO [2023-09-08 12:23:08] Optimized contamination rate: 0.056
INFO [2023-09-08 12:23:08] Initial guess of contamination rate: 0.051
INFO [2023-09-08 12:23:08] Optimizing contamination rate of optimum 2/5...
INFO [2023-09-08 12:24:43] Optimized contamination rate: 0.057
INFO [2023-09-08 12:24:43] Initial guess of contamination rate: 0.033
INFO [2023-09-08 12:24:43] Optimizing contamination rate of optimum 3/5...
INFO [2023-09-08 12:26:19] Optimized contamination rate: 0.042
INFO [2023-09-08 12:26:19] Initial guess of contamination rate: 0.048
INFO [2023-09-08 12:26:19] Optimizing contamination rate of optimum 4/5...
INFO [2023-09-08 12:27:53] Optimized contamination rate: 0.054
INFO [2023-09-08 12:27:53] Initial guess of contamination rate: 0.017
INFO [2023-09-08 12:27:53] Optimizing contamination rate of optimum 5/5...
INFO [2023-09-08 12:29:29] Optimized contamination rate: 0.040
INFO [2023-09-08 12:29:29] Done.
INFO [2023-09-08 12:29:29] ------------------------------------------------------------
INFO [2023-09-08 12:29:34] Generating output files...
WARN [2023-09-08 12:29:48] --intervals does not contain gene symbols. Not generating gene-level calls.
**B-allele frequency plot**
 
![ballelefreqplot](https://github.com/lima1/PureCN/assets/52607204/31dc84cb-6fa2-4990-b1dd-2b0fbcace773)


**Session Info**
R version 4.2.3 (2023-03-15)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.2 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C
 [9] LC_ADDRESS=C               LC_TELEPHONE=C
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base

loaded via a namespace (and not attached):
[1] compiler_4.2.3

I would also like to attach the aggregate results. As you can see, there are no failures, but many issues flagged.
<html xmlns:o=""urn:schemas-microsoft-com:office:office""
xmlns:x=""urn:schemas-microsoft-com:office:excel""
xmlns=""http://www.w3.org/TR/REC-html40"">

<head>

<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content=""Microsoft Excel 15"">
<link id=Main-File rel=Main-File
href=""file:///C:/Users/AJA4F9~1.TRO/AppData/Local/Temp/msohtmlclip1/01/clip.htm"">
<link rel=File-List
href=""file:///C:/Users/AJA4F9~1.TRO/AppData/Local/Temp/msohtmlclip1/01/clip_filelist.xml"">
<style>
<!--table
	{mso-displayed-decimal-separator:""\."";
	mso-displayed-thousand-separator:""\,"";}
@page
	{margin:.75in .7in .75in .7in;
	mso-header-margin:.3in;
	mso-footer-margin:.3in;}
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
td
	{padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:black;
	font-size:11.0pt;
	font-weight:400;
	font-style:normal;
	text-decoration:none;
	font-family:Calibri, sans-serif;
	mso-font-charset:0;
	mso-number-format:General;
	text-align:general;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;}
-->
</style>
</head>

<body link=""#0563C1"" vlink=""#954F72"">



Sampleid | Purity | Ploidy | Sex | Contamination | Flagged | Failed | Curated | Comment
-- | -- | -- | -- | -- | -- | -- | -- | --
OS11 | 0.45 | 1.964282 | M | 0.055606 | TRUE | FALSE | FALSE | POOR GOF (41.2%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS12 | 0.59 | 2.02072 | M | 0.078143 | TRUE | FALSE | FALSE | POOR GOF (57.4%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS13 | 0.59 | 1.964874 | M | 0.081329 | TRUE | FALSE | FALSE | POOR GOF (57.1%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS14 | 0.59 | 2.090946 | M | 0.081519 | TRUE | FALSE | FALSE | POOR GOF (55.5%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS15 | 0.82 | 2.536787 | M | 0.027567 | TRUE | FALSE | FALSE | POOR GOF (35.4%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS16 | 0.32 | 2.180455 | M | 0.082852 | TRUE | FALSE | FALSE | POOR GOF (68%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS31 | 0.42 | 1.997302 | M | 0.08345 | TRUE | FALSE | FALSE | POOR GOF (66.5%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS32 | 0.56 | 1.988732 | M | 0.085572 | TRUE | FALSE | FALSE | POOR GOF (63.3%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS33 | 0.86 | 1.990658 | M | 0.058915 | TRUE | FALSE | FALSE | POOR GOF (39%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS34 | 0.66 | 1.989603 | M | 0.088028 | TRUE | FALSE | FALSE | POOR GOF (58.8%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS35 | 0.87 | 1.997795 | M | 0.054135 | TRUE | FALSE | FALSE | POOR GOF (37.2%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS37 | 0.69 | 1.998294 | M | 0.084497 | TRUE | FALSE | FALSE | POOR GOF (58.6%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS71 | 0.44 | 1.980068 | M | 0.085305 | TRUE | FALSE | FALSE | POOR GOF (63.9%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS72 | 0.4 | 1.982376 | M | 0.080135 | TRUE | FALSE | FALSE | EXCESSIVE LOSSES;POOR GOF (64.5%);NOISY LOG-RATIO;HIGH AT- OR   GC-DROPOUT;POTENTIAL SAMPLE CONTAMINATION
OS73 | 0.29 | 1.978832 | M | 0.083472 | TRUE | FALSE | FALSE | LOW PURITY;POOR GOF (63.3%);NOISY LOG-RATIO;HIGH AT- OR   GC-DROPOUT;POTENTIAL SAMPLE CONTAMINATION
OS74 | 0.72 | 1.999794 | M | 0.065739 | TRUE | FALSE | FALSE | POOR GOF (52.1%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS75 | 0.56 | 1.999169 | M | 0.080766 | TRUE | FALSE | FALSE | POOR GOF (59.5%);NOISY LOG-RATIO;HIGH AT- OR GC-DROPOUT;POTENTIAL SAMPLE   CONTAMINATION
OS76 | 0.35 | 1.973285 | M | 0.089372 | TRUE | FALSE | FALSE | EXCESSIVE LOSSES;POOR GOF (63.8%);NOISY LOG-RATIO;HIGH AT- OR   GC-DROPOUT;POTENTIAL SAMPLE CONTAMINATION



</body>

</html>

",alextrouerntrend,https://github.com/lima1/PureCN/issues/332
I_kwDOBew4us54iE8G,Installation error,CLOSED,2023-12-02T20:49:18Z,2023-12-04T15:29:56Z,2023-12-03T08:01:04Z,"**Description**
I'm in a Ubuntu (latest) Docker container. I've just installed R through conda:
`RUN mamba install -y -c conda-forge r-base=4.3.2`

When I run this command:
`RUN R -e 'BiocManager::install(""PureCN"", dependencies=TRUE, ask = F)'`

I get the error below.

```
...
ranlib libstreamvbyte.a 
make[2]: ranlib: No such file or directory
make[2]: *** [Makefile:27: libstreamvbyte.a] Error 127
make[2]: Leaving directory '/tmp/RtmpSR9TfQ/R.INSTALL12d7724e3388c/rhdf5filters/src/vbz/third_party/streamvbyte'
make[1]: *** [Makefile:30: streamvbyte] Error 2
make[1]: Leaving directory '/tmp/RtmpSR9TfQ/R.INSTALL12d7724e3388c/rhdf5filters/src/vbz'
make: *** [Makevars:29: libH5Zvbz.so] Error 2
ERROR: compilation failed for package ‘rhdf5filters’
* removing ‘/root/miniforge3/lib/R/library/rhdf5filters’
ERROR: dependency ‘rhdf5filters’ is not available for package ‘rhdf5’
* removing ‘/root/miniforge3/lib/R/library/rhdf5’
ERROR: dependency ‘rhdf5’ is not available for package ‘PureCN’
* removing ‘/root/miniforge3/lib/R/library/PureCN’

The downloaded source packages are in
        ‘/tmp/RtmpDvJHJY/downloaded_packages’
Updating HTML index of packages in '.Library'
Making 'packages.html' ... done
Warning messages:
1: In install.packages(...) :
  installation of package ‘rhdf5filters’ had non-zero exit status
2: In install.packages(...) :
  installation of package ‘rhdf5’ had non-zero exit status
3: In install.packages(...) :
  installation of package ‘PureCN’ had non-zero exit status
```

What am I doing wrong?

** Env **
Bioconductor version 3.18 (BiocManager 1.30.22), R 4.3.2 (2023-10-31)

**Session Info**
R version 4.3.2 (2023-10-31)
Platform: x86_64-conda-linux-gnu (64-bit)
Running under: Ubuntu 22.04.3 LTS

Matrix products: default
BLAS/LAPACK: /root/miniforge3/lib/libopenblasp-r0.3.25.so;  LAPACK version 3.11.0

locale:
 [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
 [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
 [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       

time zone: NA
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] BiocManager_1.30.22

loaded via a namespace (and not attached):
[1] compiler_4.3.2 tools_4.3.2
",mazzalab,https://github.com/lima1/PureCN/issues/334
I_kwDOBew4us55Yi0e,[PON] The normal.panel.vcf.file contains only a single sample,CLOSED,2023-12-11T20:31:20Z,2023-12-17T10:58:57Z,2023-12-17T10:58:57Z,"Following the GATK4 guidelines here https://gatk.broadinstitute.org/hc/en-us/articles/360035531132--How-to-Call-somatic-mutations-using-GATK4-Mutect2#:~:text=The%20three%20steps%20to%20create%20a%20panel%20of%20normals%20are%3A
I've made my PON.

I've then tried to import it into PureCN with the command:
```
Rscript $PURECN/NormalDB.R --out-dir $OUT_REF --normal-panel $NORMAL_PANEL \
    --assay agilent_v6 --genome hg19 --force
```
where $HORMAL_PANEL is my ""pon.vcf.gz"" file made above, but I get the following error:
`FATAL [2023-12-10 22:35:04] The normal.panel.vcf.file contains only a single sample.`

Even if the PON contains two and not one sample.

Note 1: I'm running PureCN in a Nextflow pipeline
Note 2: I was not able to install PureCN on my custom Docker machine. Hence, I'm using this image (the latest): `https://hub.docker.com/r/markusriester/purecn` where I'm supposed to find GenomicsDB-R installed and properly working.

Can you suggest how to make the function above working?


**Complete Log**
Command error:
```
  INFO [2023-12-10 22:35:03] Loading PureCN 2.8.1...
  INFO [2023-12-10 22:35:03] Creating mapping bias database.
  INFO [2023-12-10 22:35:04] Processing variants 1 to 50000...
  FATAL [2023-12-10 22:35:04] The normal.panel.vcf.file contains only a single sample. 
  
  FATAL [2023-12-10 22:35:04]  
  
  FATAL [2023-12-10 22:35:04] This is most likely a user error due to invalid input data or 
  
  FATAL [2023-12-10 22:35:04] parameters (PureCN 2.8.1). 
  
  Error: The normal.panel.vcf.file contains only a single sample.
  
  This is most likely a user error due to invalid input data or
  parameters (PureCN 2.8.1).
  In addition: Warning message:
  In .vcf_usertag(map, tag, nm, verbose) :
    ScanVcfParam ‘geno’ fields not found in  header: ‘AD’
  Execution halted
```",mazzalab,https://github.com/lima1/PureCN/issues/336
I_kwDOBew4us55x3iO,In case this may be of help,OPEN,2023-12-15T08:12:52Z,2023-12-15T08:12:52Z,,"              In case this may be of help
the log file tells me that almost all the somatic variants were removed because not in het in the panel of normal .


INFO [2023-10-24 08:55:04] Loading coverage files...
INFO [2023-10-24 08:55:08] Mean target coverages: 240X (tumor) 235X (normal).
INFO [2023-10-24 08:55:10] Mean coverages: chrX: 113.73, chrY: 120.12, chr1-22: 228.96.
INFO [2023-10-24 08:55:11] Mean coverages: chrX: 121.64, chrY: 120.12, chr1-22: 227.41.
INFO [2023-10-24 08:55:26] Removing 3516 intervals with missing log.ratio.
INFO [2023-10-24 08:55:26] Removing 21 low/high GC targets.
INFO [2023-10-24 08:55:27] Removing 6377 intervals excluded in normalDB.
INFO [2023-10-24 08:55:27] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-10-24 08:55:27] Removing 61 low count (< 100 total reads) intervals.
INFO [2023-10-24 08:55:27] Removing 8523 low coverage (< 0.0015X) intervals.
WARN [2023-10-24 08:55:27] Low number of off-target intervals. You might want to exclude them (209557 on-target, 21660 off-target, ratio 0.09).
INFO [2023-10-24 08:55:27] Using 231217 intervals (209557 on-target, 21660 off-target).
INFO [2023-10-24 08:55:27] Ratio of mean on-target vs. off-target read counts: 0.19
INFO [2023-10-24 08:55:27] Mean off-target bin size: 96126
INFO [2023-10-24 08:55:29] AT/GC dropout: 1.03 (tumor), 1.01 (normal), 1.01 (coverage log-ratio). 
INFO [2023-10-24 08:55:29] Loading VCF...
INFO [2023-10-24 08:57:03] Found 3115993 variants in VCF file.
INFO [2023-10-24 08:57:09] Removing 69933 triallelic sites.
WARN [2023-10-24 08:57:11] Found GERMQ info field with Phred scaled germline probabilities.
INFO [2023-10-24 08:57:20] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2023-10-24 08:57:25] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2023-10-24 08:57:29] 1951294 (64.1%) variants annotated as likely germline (DB INFO flag).
WARN [2023-10-24 08:58:37] Found 590496 variants with missing allelic fraction starting with chr1:10439_AC/A. Removing them.
INFO [2023-10-24 08:59:06] TUMOR is tumor in VCF file.
INFO [2023-10-24 08:59:22] 1792 homozygous and 1547 heterozygous variants on chrX.
INFO [2023-10-24 08:59:22] Sex from VCF: NA (Fisher's p-value: < 0.0001, odds-ratio: 3.63).
INFO [2023-10-24 08:59:22] Detected MuTect2 VCF.
INFO [2023-10-24 08:59:37] Removing 0 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-10-24 08:59:42] Removing 2053349 non heterozygous (in matched normal) germline SNPs.
INFO [2023-10-24 08:59:42] Base quality scores range from -1 to 37 (offset by 1)
INFO [2023-10-24 08:59:43] Minimum number of supporting reads ranges from 1 to 41, depending on coverage and BQS.
INFO [2023-10-24 09:01:09] Initial testing for significant sample cross-contamination: unlikely
INFO [2023-10-24 09:01:11] Removing 209124 variants with AF < 0.030 or AF >= 1.000 or insufficient supporting reads or depth < 15.
INFO [2023-10-24 09:01:11] Total size of targeted genomic region: 34.90Mb (53.62Mb with 50bp padding).
INFO [2023-10-24 09:01:14] 11.1% of targets contain variants.
INFO [2023-10-24 09:01:14] Removing 166082 variants outside intervals.
INFO [2023-10-24 09:01:14] Found SOMATIC annotation in VCF.

_Originally posted by @GuidoLeoni in https://github.com/lima1/PureCN/issues/329#issuecomment-1857451123_
            ",GuidoLeoni,https://github.com/lima1/PureCN/issues/338
I_kwDOBew4us56F6T4,Error with overlapping gaps when running PureCN,OPEN,2023-12-19T10:32:12Z,2023-12-19T16:44:36Z,,"**Describe the issue**
Running PureCN on a sample fails with Detected overlapping gaps on chromosome , : INTERNAL ERROR: Detected overlapping gaps on chromosome 10 in argument gaps . Calls: runAbsoluteCN ... gapsToSegments.data.frame -> throw -> throw.default

This is a Paired End sample, where I stitched the reads together using BBMerge before aligning, variant calling and PureCN.

**To Reproduce**
Copy and paste your complete command line arguments from PureCN.R. If possible and potentially relevant, also copy the output of NormalDB.R and Coverage.R.
Coverage.R
+ Rscript /usr/local/lib/R/site-library/PureCN/extdata/Coverage.R --force --bam /home/dnanexus/inputs/input17659710669220063763/ewes-heme-001_markdup.recalibrated.bam --intervals /home/dnanexus/inputs/input17659710669220063763/eWES_neogenomics_hg38_merged_probes_intervals.withGenes.txt --outdir out
exit $rcINFO [2023-12-18 15:47:33] Loading PureCN 1.22.2...
INFO [2023-12-18 15:47:33] Processing /home/dnanexus/work/out/ewes-heme-001_markdup.recalibrated_coverage.txt.gz...
[W::hts_idx_load2] The index file is older than the data file: /home/dnanexus/inputs/input17659710669220063763/ewes-heme-001_markdup.recalibrated.bam.bai
Warning messages:Dec 18 2023, 4:02 PM
1: stat_contour(): Zero contours were generated
2: In min(x) : no non-missing arguments to min; returning Inf
3: In max(x) : no non-missing arguments to max; returning -Inf
4: stat_contour(): Zero contours were generated
5: In min(x) : no non-missing arguments to min; returning Inf
6: In max(x) : no non-missing arguments to max; returning -Inf
7: Removed 1 row(s) containing missing values (geom_path).

PureCN.R
Rscript /usr/local/lib/R/site-library/PureCN/extdata/PureCN.R --force --postoptimize --seed 123 --outvcf --funsegmentation PSCBS --genome hg38 --sampleid pureCN_ewes-heme-001 --tumor out/ewes-heme-001_markdup.recalibrated_coverage_loess.txt.gz --vcf /home/dnanexus/inputs/input17659710669220063763/ewes-heme-001_markdup.recalibrated_mutect2_unfiltered-final-annotation.vcf.gz --mappingbiasfile /home/dnanexus/inputs/input17659710669220063763/mapping_bias_eWES_heme_merge_hg38_PON_hg38.rds --normaldb /home/dnanexus/inputs/input17659710669220063763/normalDB_eWES_neogenomics_hg38_merged_hg38.rds --intervals /home/dnanexus/inputs/input17659710669220063763/eWES_neogenomics_hg38_merged_probes_intervals.withGenes.txt --out pureCN_ewes-heme-001

**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
INFO [2023-12-18 16:02:12] Loading PureCN 1.22.2...
INFO [2023-12-18 16:02:21] Mean coverages: chrX: 35.90, chrY: 36.46, chr1-22: 61.30.
INFO [2023-12-18 16:02:21] Sample sex: M
INFO [2023-12-18 16:02:22] ------------------------------------------------------------
INFO [2023-12-18 16:02:22] PureCN 1.22.2
INFO [2023-12-18 16:02:22] ------------------------------------------------------------
INFO [2023-12-18 16:02:22] Arguments: -tumor.coverage.file /home/dnanexus/work/out/ewes-heme-001_markdup.recalibrated_coverage_loess.txt.gz -log.ratio -seg.file -vcf.file /home/dnanexus/inputs/input17659710669220063763/ewes-heme-001_markdup.recalibrated_mutect2_unfiltered-final-annotation.vcf.gz -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /home/dnanexus/inputs/input17659710669220063763/mapping_bias_eWES_heme_merge_hg38_PON_hg38.rds -args.filterIntervals 100 -args.segmentation 0.005,NULL, -sampleid pureCN_ewes-heme-001 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /home/dnanexus/inputs/input17659710669220063763/eWES_neogenomics_hg38_merged_probes_intervals.withGenes.txt -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -DB.info.flag DB -POPAF.info.field POP_AF -model beta -post.optimize TRUE -BPPARAM -log.file pureCN_ewes-heme-001.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2023-12-18 16:02:22] Loading coverage files...
INFO [2023-12-18 16:02:25] Mean target coverages: 72X (tumor) 91X (normal).
INFO [2023-12-18 16:02:26] Mean coverages: chrX: 35.90, chrY: 36.46, chr1-22: 61.30.
INFO [2023-12-18 16:02:27] Mean coverages: chrX: 32.16, chrY: 36.46, chr1-22: 61.27.
INFO [2023-12-18 16:02:42] Removing 733 intervals with missing log.ratio.
INFO [2023-12-18 16:02:42] Removing 3 low/high GC targets.
INFO [2023-12-18 16:02:43] Removing 4576 intervals excluded in normalDB.
INFO [2023-12-18 16:02:43] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2023-12-18 16:02:43] Removing 9351 low coverage (< 0.0015X) intervals.
INFO [2023-12-18 16:02:43] Removing 11549 low count (< 100 total reads) intervals.
INFO [2023-12-18 16:02:43] Using 245171 intervals (228926 on-target, 16245 off-target).
INFO [2023-12-18 16:02:43] Ratio of mean on-target vs. off-target read counts: 0.64
INFO [2023-12-18 16:02:43] Mean off-target bin size: 112269
INFO [2023-12-18 16:02:44] AT/GC dropout: 1.01 (tumor), 1.06 (normal), 0.98 (coverage log-ratio).
INFO [2023-12-18 16:02:44] Loading VCF...
INFO [2023-12-18 16:02:52] Found 117065 variants in VCF file.
INFO [2023-12-18 16:02:53] Removing 6471 triallelic sites.
WARN [2023-12-18 16:02:53] VCF contains both DB and POPAF INFO fields. Will ignore POPAF.
INFO [2023-12-18 16:02:53] 49384 (44.7%) variants annotated as likely germline (DB INFO flag).
INFO [2023-12-18 16:02:55] ewes-heme-001 is tumor in VCF file.
INFO [2023-12-18 16:02:57] 589 homozygous and 143 heterozygous variants on chrX.
INFO [2023-12-18 16:02:57] Sex from VCF: M (Fisher's p-value: < 0.0001, odds-ratio: 6.99).
INFO [2023-12-18 16:02:57] Detected MuTect2 VCF.
INFO [2023-12-18 16:02:58] Removing 24823 Mutect2 calls due to blacklisted failure reasons.
INFO [2023-12-18 16:03:02] Initial testing for significant sample cross-contamination: unlikely
INFO [2023-12-18 16:03:03] Removing 47344 variants with AF < 0.030 or AF >= 0.970 or less than 3 supporting reads or depth < 15.
WARN [2023-12-18 16:03:03] Variant ids contain NAs at filter step BQ.
INFO [2023-12-18 16:03:03] Removing 0 low quality variants with BQ < 25.
INFO [2023-12-18 16:03:03] Total size of targeted genomic region: 41.36Mb (61.24Mb with 50bp padding).
INFO [2023-12-18 16:03:04] 11.9% of targets contain variants.
INFO [2023-12-18 16:03:04] Removing 8042 variants outside intervals.
INFO [2023-12-18 16:03:04] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2023-12-18 16:03:04] Loading mapping bias file mapping_bias_eWES_heme_merge_hg38_PON_hg38.rds...
INFO [2023-12-18 16:03:05] Found 459221 variants in mapping bias file.
INFO [2023-12-18 16:03:09] Imputing mapping bias for 3042 variants...
INFO [2023-12-18 16:04:15] Excluding 7952 novel or poor quality variants from segmentation.Dec 18 2023, 4:04 PM
INFO [2023-12-18 16:04:15] Sample sex: M
INFO [2023-12-18 16:04:15] Segmenting data...
INFO [2023-12-18 16:04:15] Interval weights found, will use weighted PSCBS.
INFO [2023-12-18 16:04:16] Setting undo.SD parameter to 0.750000.
INFO [2023-12-18 16:04:16] On-target much cleaner than off-target, finding on-target breakpoints first...
INFO [2023-12-18 16:04:16] Using 166683 high quality (out of 230168) on-target intervals for initial breakpoint calculation.
CPU: 7% (16 cores) * Memory: 4544/31066MB * Storage: 19/376GB * Net: 0↓/0↑MBps
INFO [2023-12-18 16:05:39] Setting prune.hclust.h parameter to 0.200000.
chromosome start end
1 1 -Inf 1776227.0
2 1 1776228.0 1858181.0
3 1 1858182.0 2184880.5
4 1 2184881.5 2203536.0
5 1 2203537.0 2543400.0
6 1 2543401.0 2587809.5
7 1 2587810.5 2587808.5
8 1 2587809.5 3045882.0
9 1 3045883.0 3045881.0
10 1 3045882.0 3448321.5
11 1 3448322.5 3664836.0
12 1 3664837.0 3742697.5
13 1 3742698.5 7771758.5
14 1 7771759.5 7886818.0
15 1 7886819.0 7886817.0
16 1 7886818.0 7950714.5
17 1 7950715.5 7950713.5
18 1 7950714.5 7994801.0
19 1 7994802.0 7994800.0
20 1 7994801.0 8166772.0
21 1 8166773.0 9666191.5
22 1 9666192.5 9728659.0
23 1 9728660.0 11103552.0
24 1 11103553.0 11179803.0
25 1 11179804.0 11179802.0
26 1 11179803.0 11197002.5
27 1 11197003.5 11674144.5
28 1 11674145.5 11684252.0
29 1 11684253.0 11790184.5
30 1 11790185.5 11804595.0
31 1 11804596.0 15433130.5
32 1 15433131.5 15454603.5
33 1 15454604.5 16125075.5
34 1 16125076.5 16151953.5
35 1 16151954.5 17018750.0
36 1 17018751.0 17061294.0
37 1 17061295.0 17621162.0
38 1 17621163.0 18557214.5
39 1 18557215.5 18557213.5
40 1 18557214.5 18792258.0
41 1 18792259.0 22774835.5
42 1 22774836.5 22933353.5
43 1 22933354.5 23544773.5
44 1 23544774.5 23719832.5
45 1 23719833.5 32261234.5
46 1 32261235.5 32333879.0
47 1 32333880.0 35146397.0
48 1 35146398.0 35230914.5
49 1 35230915.5 36178278.0
50 1 36178279.0 36305252.5
51 1 36305253.5 36305251.5
52 1 36305252.5 36334684.0
53 1 36334685.0 36334683.0
54 1 36334684.0 36377439.5
55 1 36377440.5 36377438.5
56 1 36377439.5 36465069.0
57 1 36465070.0 36465068.0
58 1 36465069.0 36642132.5
59 1 36642133.5 39890349.0
60 1 39890350.0 39928279.0
61 1 39928280.0 43330189.5
62 1 43330190.5 43352769.0
63 1 43352770.0 44817112.5
64 1 44817113.5 44846846.0
65 1 44846847.0 45328361.5
66 1 45328362.5 45340585.0
67 1 45340586.0 46039625.5
68 1 46039626.5 46156844.0
69 1 46156845.0 46156843.0
70 1 46156844.0 46234129.5
71 1 46234130.5 46234128.5
72 1 46234129.5 46278377.5
73 1 46278378.5 51046373.0
74 1 51046374.0 51350780.0
75 1 51350781.0 51350779.0
76 1 51350780.0 51476967.0
77 1 51476968.0 55024011.0
78 1 55024012.0 55063727.5
79 1 55063728.5 64832651.5
80 1 64832652.5 64967428.0
81 1 64967429.0 71244128.0
82 1 71244129.0 74034013.0
83 1 74034014.0 77943983.0
84 1 77943984.0 77991950.0
85 1 77991951.0 85258900.0
86 1 85258901.0 85298890.5
87 1 85298891.5 92431445.5
88 1 92431446.5 92498535.5
89 1 92498536.5 92498534.5
90 1 92498535.5 92812163.5
91 1 92812164.5 92812162.5
92 1 92812163.5 92842545.5
93 1 92842546.5 97076218.0
94 1 97076219.0 98291224.5
95 1 98291225.5 110310904.0
96 1 110310905.0 110354604.0
97 1 110354605.0 113813561.5
98 1 113813562.5 113876252.5
99 1 113876253.5 113876251.5
100 1 113876252.5 113897023.0
101 1 113897024.0 113897022.0
102 1 113897023.0 113901367.5
103 1 113901368.5 114275579.5
104 1 114275580.5 114539472.0
105 1 114539473.0 114708185.0
106 1 114708186.0 114717046.0
107 1 114717047.0 117134254.0
108 1 117134255.0 117170937.5
109 1 117170938.5 117170936.5
110 1 117170937.5 117573923.5
111 1 117573924.5 117573922.5
112 1 117573923.5 117747171.0
113 1 117747172.0 119417418.0
114 1 119417419.0 119568388.5
115 1 119568389.5 122026458.0
116 1 122026459.0 124932724.0
117 1 124932725.0 147453504.0
118 1 147453505.0 147634146.0
119 1 147634147.0 150344636.5
120 1 150344637.5 150403292.5
121 1 150403293.5 150568840.0
122 1 150568841.0 150604184.0
123 1 150604185.0 150604183.0
124 1 150604184.0 150810078.0
125 1 150810079.0 150810077.0
126 1 150810078.0 150885282.0
127 1 150885283.0 152133720.5
128 1 152133721.5 152157171.5
129 1 152157172.5 152910148.5
130 1 152910149.5 153103992.0
131 1 153103993.0 154167497.5
132 1 154167498.5 154195615.5
133 1 154195616.5 154195614.5
134 1 154195615.5 154271687.0
135 1 154271688.0 154271686.0
136 1 154271687.0 154299362.0
137 1 154299363.0 154299361.0
138 1 154299362.0 154376074.0
139 1 154376075.0 154376073.0
140 1 154376074.0 154467779.5
141 1 154467780.5 155184911.5
142 1 155184912.5 155194335.0
143 1 155194336.0 155305490.0
144 1 155305491.0 155320644.0
145 1 155320645.0 155890737.5
146 1 155890738.5 155912394.5
147 1 155912395.5 156098207.0
148 1 156098208.0 156147126.0
149 1 156147127.0 156759948.5
150 1 156759949.5 156803725.5
151 1 156803726.5 156803724.5
152 1 156803725.5 156859683.0
153 1 156859684.0 156859682.0
154 1 156859683.0 156892538.0
155 1 156892539.0 157563859.0
156 1 157563860.0 157638259.5
157 1 157638260.5 161435776.0
158 1 161435777.0 161692328.5
159 1 161692329.5 162675707.0
160 1 162675708.0 162816720.0
161 1 162816721.0 162816719.0
162 1 162816720.0 163957530.5
163 1 163957531.5 163957529.5
164 1 163957530.5 164866870.5
165 1 164866871.5 170608733.0
166 1 170608734.0 170840734.5
167 1 170840735.5 175979390.5
168 1 175979391.5 176381549.0
169 1 176381550.0 179101293.0
170 1 179101294.0 179265912.5
171 1 179265913.5 188543146.0
172 1 188543147.0 191306996.5
173 1 191306997.5 193113738.0
174 1 193113739.0 193251086.5
175 1 193251087.5 201345848.0
176 1 201345849.0 201377467.5
177 1 201377468.5 202007737.0
178 1 202007738.0 202069037.0
179 1 202069038.0 202325446.5
180 1 202325447.5 202342197.0
181 1 202342198.0 205608410.5
182 1 205608411.5 205691329.5
183 1 205691330.5 206467081.0
184 1 206467082.0 206501829.5
185 1 206501830.5 206501828.5
186 1 206501829.5 206750556.5
187 1 206750557.5 206750555.5
188 1 206750556.5 206772593.0
189 1 206772594.0 228419832.0
190 1 228419833.0 228493443.5
191 1 228493444.5 231359647.5
192 1 231359648.5 231421919.5
193 1 231421920.5 241298169.0
194 1 241298170.0 241525907.0
195 1 241525908.0 243487777.0
196 1 243487778.0 243948408.0
197 1 243948409.0 Inf
198 2 -Inf 3566815.0
199 2 3566816.0 3591889.0
200 2 3591890.0 15941166.0
201 2 15941167.0 16249473.5
202 2 16249474.5 17752990.5
203 2 17752991.5 17799208.0
204 2 17799209.0 24028112.0
205 2 24028113.0 24046567.0
206 2 24046568.0 24493301.0
207 2 24493302.0 24779325.0
208 2 24779326.0 25199410.5
209 2 25199411.5 25345573.5
210 2 25345574.5 25345572.5
211 2 25345573.5 25697255.0
212 2 25697256.0 25697254.0
213 2 25697255.0 25903518.5
214 2 25903519.5 26782183.0
215 2 26782184.0 26845800.5
216 2 26845801.5 36831765.0
217 2 36831766.0 36973918.5
218 2 36973919.5 38069939.0
219 2 38069940.0 38075455.0
220 2 38075456.0 39150279.0
221 2 39150280.0 39239941.5
222 2 39239942.5 42113549.0
223 2 42113550.0 42332831.0
224 2 42332832.0 46336284.0
225 2 46336285.0 46432518.5
226 2 46432519.5 60656621.5
227 2 60656622.5 60839399.5
228 2 60839400.5 60839398.5
229 2 60839399.5 60932339.0
230 2 60932340.0 61474666.5
231 2 61474667.5 61679994.5
232 2 61679995.5 73972554.0
233 2 73972555.0 74135437.5
234 2 74135438.5 88803823.5
235 2 88803824.5 92188144.0
236 2 92188145.0 92188144.0
237 2 92188145.0 94090557.0
238 2 94090558.0 96253630.0
239 2 96253631.0 96265591.5
240 2 96265592.5 96331937.5
241 2 96331938.5 96435717.0
242 2 96435718.0 98459176.0
243 2 98459177.0 98588759.0
244 2 98588760.0 99516742.5
245 2 99516743.5 100058442.0
246 2 100058443.0 108723510.0
247 2 108723511.0 108785264.5
248 2 108785265.5 111123148.0
249 2 111123149.0 111582587.5
250 2 111582588.5 113217908.0
251 2 113217909.0 113278544.5
252 2 113278545.5 127232545.5
253 2 127232546.5 127298674.0
254 2 127298675.0 136050085.0
255 2 136050086.0 136500062.0
256 2 136500063.0 144159110.0
257 2 144159111.0 146154616.0
258 2 146154617.0 146154615.0
259 2 146154616.0 147931344.0
260 2 147931345.0 157737316.0
261 2 157737317.0 157808855.0
262 2 157808856.0 167912540.5
263 2 167912541.5 168351898.0
264 2 168351899.0 172530928.0
265 2 172530929.0 172665848.5
266 2 172665849.5 174799827.5
267 2 174799828.5 174974789.5
268 2 174974790.5 176091339.0
269 2 176091340.0 176097203.5
270 2 176097204.5 176097202.5
271 2 176097203.5 176107179.5
272 2 176107180.5 176107178.5
273 2 176107179.5 176112899.5
274 2 176112900.5 177223592.5
275 2 177223593.5 177328580.0
276 2 177328581.0 189783633.5
277 2 189783634.5 189967216.5
278 2 189967217.5 191021869.0
279 2 191021870.0 191197952.5
280 2 191197953.5 201245807.0
281 2 201245808.0 201289048.0
282 2 201289049.0 203600829.5
283 2 203600830.5 203904672.5
284 2 203904673.5 207579316.5
285 2 207579317.5 208210248.0
286 2 208210249.0 208210247.0
287 2 208210248.0 208267120.5
288 2 208267121.5 211031364.0
289 2 211031365.0 212366117.0
290 2 212366118.0 231988189.5
291 2 231988190.5 232361126.0
292 2 232361127.0 233759715.5
293 2 233759716.5 233772614.0
294 2 233772615.0 236543786.0
295 2 236543787.0 236833644.0
296 2 236833645.0 237817152.0
297 2 237817153.0 237828317.5
298 2 237828318.5 241833838.0
299 2 241833839.0 241864210.0
300 2 241864211.0 241864209.0
301 2 241864210.0 241900314.0
302 2 241900315.0 Inf
303 3 -Inf 10102660.0
304 3 10102661.0 10133911.5
305 3 10133912.5 10133910.5
306 3 10133911.5 10163839.5
307 3 10163840.5 12269428.5
308 3 12269429.5 12452413.5
309 3 12452414.5 12452412.5
310 3 12452413.5 12584164.0
311 3 12584165.0 12584163.0
312 3 12584164.0 12641297.0
313 3 12641298.0 13450178.5
314 3 13450179.5 13502973.0
315 3 13502974.0 14124853.0
316 3 14124854.0 14141855.0
317 3 14141856.0 14141854.0
318 3 14141855.0 14144095.0
319 3 14144096.0 14144094.0
320 3 14144095.0 14178591.0
321 3 14178592.0 30606615.0
322 3 30606616.0 30691951.5
323 3 30691952.5 32922382.0
324 3 32922383.0 32957800.5
325 3 32957801.5 36992936.0
326 3 36992937.0 37052229.0
327 3 37052230.0 38137710.5
328 3 38137711.5 38153158.0
329 3 38153159.0 38483580.5
330 3 38483581.5 38549702.0
331 3 38549703.0 40497069.0
332 3 40497070.0 40521225.5
333 3 40521226.5 40521224.5
334 3 40521225.5 40878352.0
335 3 40878353.0 40878351.0
336 3 40878352.0 41239445.5
337 3 41239446.5 46845870.0
338 3 46845871.0 46872099.0
339 3 46872100.0 49876215.5
340 3 49876216.5 49904457.0
341 3 49904458.0 50223549.0
342 3 50223550.0 50263765.0
343 3 50263766.0 52400842.5
344 3 52400843.5 52411282.0
345 3 52411283.0 60003234.5
346 3 60003235.5 61049517.5
347 3 61049518.5 69562660.0
348 3 69562661.0 69965912.5
349 3 69965913.5 69965911.5
350 3 69965912.5 70958643.0
351 3 70958644.0 70958642.0
352 3 70958643.0 71441400.0
353 3 71441401.0 71441399.0
354 3 71441400.0 72081246.5
355 3 72081247.5 72081245.5
356 3 72081246.5 72875154.5
357 3 72875155.5 88787421.0
358 3 88787422.0 90772457.0
359 3 90772458.0 90772457.0
360 3 90772458.0 93655574.0
361 3 93655575.0 100704325.0
362 3 100704326.0 100749418.0
363 3 100749419.0 105615358.0
364 3 105615359.0 106623409.5
365 3 106623410.5 114265367.5
366 3 114265368.5 114323509.5
367 3 114323510.5 119822027.0
368 3 119822028.0 120130138.5
369 3 120130139.5 122181624.5
370 3 122181625.5 122285192.0
371 3 122285193.0 122794342.5
372 3 122794343.5 122894654.0
373 3 122894655.0 124733098.0
374 3 124733099.0 124744048.5
375 3 124744049.5 124744047.5
376 3 124744048.5 124970871.5
377 3 124970872.5 124970870.5
378 3 124970871.5 125013508.0
379 3 125013509.0 128480777.5
380 3 128480778.5 128720081.5
381 3 128720082.5 134904973.0
382 3 134904974.0 135630340.0
383 3 135630341.0 138644109.0
384 3 138644110.0 138946929.0
385 3 138946930.0 149509713.0
386 3 149509714.0 149703885.0
387 3 149703886.0 155870131.5
388 3 155870132.5 156024971.0
389 3 156024972.0 158543756.0
390 3 158543757.0 158625740.5
391 3 158625741.5 168589953.0
392 3 168589954.0 169766198.5
393 3 169766199.5 170202110.5
394 3 170202111.5 170328768.5
395 3 170328769.5 176414635.5
396 3 176414636.5 177943553.5
397 3 177943554.5 177943552.5
398 3 177943553.5 179196947.5
399 3 179196948.5 179196946.5
400 3 179196947.5 179242486.0
401 3 179242487.0 182942692.5
402 3 182942693.5 182997839.0
403 3 182997840.0 183460050.5
404 3 183460051.5 183602932.0
405 3 183602933.0 184372219.5
406 3 184372220.5 184379309.0
407 3 184379310.0 185067387.5
408 3 185067388.5 185172535.5
409 3 185172536.5 185172534.5
410 3 185172535.5 185269720.5
411 3 185269721.5 185269719.5
412 3 185269720.5 185488436.5
413 3 185488437.5 185993162.5
414 3 185993163.5 186127835.5
415 3 186127836.5 186763599.0
416 3 186763600.0 186789492.5
417 3 186789493.5 187710429.0
418 3 187710430.0 189032588.0
419 3 189032589.0 189032587.0
420 3 189032588.0 189631317.5
421 3 189631318.5 189631316.5
422 3 189631317.5 189894867.5
423 3 189894868.5 195979842.5
424 3 195979843.5 196137628.5
425 3 196137629.5 Inf
426 4 -Inf 1769381.0
427 4 1769382.0 1810751.0
428 4 1810752.0 1810750.0
429 4 1810751.0 1874843.5
430 4 1874844.5 24309638.5
431 4 24309639.5 24691959.5
432 4 24691960.5 25540277.0
433 4 25540278.0 25716705.5
434 4 25716706.5 40125132.5
435 4 40125133.5 40289751.0
436 4 40289752.0 41745579.5
437 4 41745580.5 41843957.5
438 4 41843958.5 49712060.0
439 4 49712061.0 51743951.0
440 4 51743952.0 53371698.5
441 4 53371699.5 53460425.5
442 4 53460426.5 53460424.5
443 4 53460425.5 54167973.5
444 4 54167974.5 54295395.0
445 4 54295396.0 54477608.5
446 4 54477609.5 54477607.5
447 4 54477608.5 54738515.0
448 4 54738516.0 56468599.5
449 4 56468600.5 56493294.0
450 4 56493295.0 64866563.5
451 4 64866564.5 66580872.0
452 4 66580873.0 70993656.5
453 4 70993657.5 71132859.0
454 4 71132860.0 71132858.0
455 4 71132859.0 71568543.0
456 4 71568544.0 71568542.0
457 4 71568543.0 71656539.0
458 4 71656540.0 80235083.5
459 4 80235084.5 80311291.5
460 4 80311292.5 83459622.0
461 4 83459623.0 83529365.0
462 4 83529366.0 86819889.0
463 4 86819890.0 86919935.5
464 4 86919936.5 86919934.5
465 4 86919935.5 87149520.0
466 4 87149521.0 98243039.0
467 4 98243040.0 98457235.5
468 4 98457236.5 98457234.5
469 4 98457235.5 98887072.5
470 4 98887073.5 98887071.5
471 4 98887072.5 98962377.5
472 4 98962378.5 104840909.0
473 4 104840910.0 105322988.5
474 4 105322989.5 108041693.5
475 4 108041694.5 108455072.5
476 4 108455073.5 109891655.0
477 4 109891656.0 110031370.5
478 4 110031371.5 122450568.0
479 4 122450569.0 122522271.5
480 4 122522272.5 122522270.5
481 4 122522271.5 122785534.0
482 4 122785535.0 122785533.0
483 4 122785534.0 122892470.0
484 4 122892471.0 152041790.0
485 4 152041791.0 152527310.0
486 4 152527311.0 153669550.0
487 4 153669551.0 153707685.5
488 4 153707686.5 184303119.0
489 4 184303120.0 184529117.0
490 4 184529118.0 187356320.5
491 4 187356321.5 188147097.0
492 4 188147098.0 Inf
493 5 -Inf 92203.0
494 5 92204.0 212880.5
495 5 212881.5 3600254.0
496 5 3600255.0 5195908.5
497 5 5195909.5 7868376.5
498 5 7868377.5 7899988.5
499 5 7899989.5 31362200.5
500 5 31362201.5 31530470.0
501 5 31530471.0 35832278.0
502 5 35832279.0 35876463.5
503 5 35876464.5 38480870.0
504 5 38480871.0 38562602.5
505 5 38562603.5 38562601.5
506 5 38562602.5 38937677.5
507 5 38937678.5 44003754.5
508 5 44003755.5 44598742.0
509 5 44598743.0 44598741.0
510 5 44598742.0 46485899.0
511 5 46485900.0 46485899.0
512 5 46485900.0 50059807.0
513 5 50059808.0 55932464.5
514 5 55932465.5 56038149.0
515 5 56038150.0 56038148.0
516 5 56038149.0 56793591.0
517 5 56793592.0 56793590.0
518 5 56793591.0 56901880.5
519 5 56901881.5 56901879.5
520 5 56901880.5 57968409.0
521 5 57968410.0 57968408.0
522 5 57968409.0 58477206.5
523 5 58477207.5 67711562.0
524 5 67711563.0 68695781.0
525 5 68695782.0 80654138.0
526 5 80654139.0 80918195.0
527 5 80918196.0 122285422.0
528 5 122285423.0 122619371.5
529 5 122619372.5 132877451.5
530 5 132877452.5 132948842.0
531 5 132948843.0 138279957.0
532 5 138279958.0 138339635.5
533 5 138339636.5 138455664.5
534 5 138455665.5 138488236.5
535 5 138488237.5 138488235.5
536 5 138488236.5 138678529.5
537 5 138678530.5 138678528.5
538 5 138678529.5 138850313.5
539 5 138850314.5 138850312.5
540 5 138850313.5 138877900.5
541 5 138877901.5 138877899.5
542 5 138877900.5 138940454.0
543 5 138940455.0 139474342.0
544 5 139474343.0 139540893.5
545 5 139540894.5 149438384.5
546 5 149438385.5 149551399.0
547 5 149551400.0 150402040.5
548 5 150402041.5 150428522.0
549 5 150428523.0 157071096.5
550 5 157071097.5 157123776.5
551 5 157123777.5 157123775.5
552 5 157123776.5 157173372.5
553 5 157173373.5 157173371.5
554 5 157173372.5 157253013.5
555 5 157253014.5 158278952.5
556 5 158278953.5 159151339.0
557 5 159151340.0 159151338.0
558 5 159151339.0 160058019.0
559 5 160058020.0 160058018.0
560 5 160058019.0 160159089.5
561 5 160159090.5 161616275.5
562 5 161616276.5 161774501.0
563 5 161774502.0 177510733.5
564 5 177510734.5 177519405.5
565 5 177519406.5 Inf
566 6 -Inf 393056.0
567 6 393057.0 447013.5
568 6 447014.5 447012.5
569 6 447013.5 1312313.0
570 6 1312314.0 1312312.0
571 6 1312313.0 1351806.5
572 6 1351807.5 3046804.0
573 6 3046805.0 3116223.0
574 6 3116224.0 14047646.5
575 6 14047647.5 14723319.0
576 6 14723320.0 18121677.0
577 6 18121678.0 18153838.5
578 6 18153839.5 18153837.5
579 6 18153838.5 18223759.0
580 6 18223760.0 18223758.0
581 6 18223759.0 18331639.0
582 6 18331640.0 18331638.0
583 6 18331639.0 20472002.0
584 6 20472003.0 20472001.0
585 6 20472002.0 20518325.5
586 6 20518326.5 26018895.0
587 6 26018896.0 26071887.5
588 6 26071888.5 26071886.5
589 6 26071887.5 26115732.5
590 6 26115733.5 26115731.5
591 6 26115732.5 26279233.5
592 6 26279234.5 26865396.0
593 6 26865397.0 27194156.0
594 6 27194157.0 27194155.0
595 6 27194156.0 27641104.0
596 6 27641105.0 27641103.0
597 6 27641104.0 27900944.5
598 6 27900945.5 28739866.5
599 6 28739867.5 28959323.5
600 6 28959324.5 29700343.0
601 6 29700344.0 29945722.0
602 6 29945723.0 30418121.0
603 6 30418122.0 30519291.5
604 6 30519292.5 30519290.5
605 6 30519291.5 30569890.0
606 6 30569891.0 30569889.0
607 6 30569890.0 30596124.5
608 6 30596125.5 30695604.5
609 6 30695605.5 30717712.5
610 6 30717713.5 31575422.5
611 6 31575423.5 31578144.5
612 6 31578145.5 31736287.5
613 6 31736288.5 31762687.5
614 6 31762688.5 32256218.5
615 6 32256219.5 32422440.5
616 6 32422441.5 32422439.5
617 6 32422440.5 32819520.5
618 6 32819521.5 32897166.0
619 6 32897167.0 32962269.0
620 6 32962270.0 32962268.0
621 6 32962269.0 32993719.5
622 6 32993720.5 32993718.5
623 6 32993719.5 33139964.0
624 6 33139965.0 33317587.5
625 6 33317588.5 33325891.0
626 6 33325892.0 34198843.5
627 6 34198844.5 34423807.5
628 6 34423808.5 35439064.5
629 6 35439065.5 35466323.5
630 6 35466324.5 36561215.5
631 6 36561216.5 36694940.0
632 6 36694941.0 37099075.5
633 6 37099076.5 37193145.0
634 6 37193146.0 41668910.0
635 6 41668911.0 41736888.5
636 6 41736889.5 41934055.0
637 6 41934056.0 41996454.0
638 6 41996455.0 43579259.5
639 6 43579260.5 43615540.0
640 6 43615541.0 43615539.0
641 6 43615540.0 43770304.5
642 6 43770305.5 43770303.5
643 6 43770304.5 43789542.0
644 6 43789543.0 44258236.5
645 6 44258237.5 44269285.5
646 6 44269286.5 58553887.0
647 6 58553888.0 59829934.0
648 6 59829935.0 89022059.5
649 6 89022060.5 89091276.5
650 6 89091277.5 103398951.0
651 6 103398952.0 104898309.0
652 6 104898310.0 104898308.0
653 6 104898309.0 105724776.0
654 6 105724777.0 111631396.5
655 6 111631397.5 112072095.0
656 6 112072096.0 113900616.0
657 6 113900617.0 114014004.0
658 6 114014005.0 117454033.0
659 6 117454034.0 117555739.5
660 6 117555740.5 117555738.5
661 6 117555739.5 118194977.0
662 6 118194978.0 126729678.5
663 6 126729679.5 127238807.0
664 6 127238808.0 134111274.0
665 6 134111275.0 134617854.5
666 6 134617855.5 134617853.5
667 6 134617854.5 135144364.0
668 6 135144365.0 135144363.0
669 6 135144364.0 135251284.0
670 6 135251285.0 136257969.5
671 6 136257970.5 136309889.0
672 6 136309890.0 137178136.5
673 6 137178137.5 137356275.0
674 6 137356276.0 137356274.0
675 6 137356275.0 137776056.0
676 6 137776057.0 137776055.0
677 6 137776056.0 137986655.0
678 6 137986656.0 138802950.0
679 6 138802951.0 138904941.0
680 6 138904942.0 149650004.0
681 6 149650005.0 149723198.0
682 6 149723199.0 151359383.5
683 6 151359384.5 151389280.5
684 6 151389281.5 151389279.5
685 6 151389280.5 151718925.0
686 6 151718926.0 151718924.0
687 6 151718925.0 152099058.5
688 6 152099059.5 158765655.0
689 6 158765656.0 158845772.0
690 6 158845773.0 159476855.5
691 6 159476856.5 159731697.5
692 6 159731698.5 161126690.0
693 6 161126691.0 161349788.0
694 6 161349789.0 161349787.0
695 6 161349788.0 162727896.5
696 6 162727897.5 162727895.5
697 6 162727896.5 163364962.0
698 6 163364963.0 163364961.0
699 6 163364962.0 163641508.5
700 6 163641509.5 166956302.0
701 6 166956303.0 167088123.0
702 6 167088124.0 167088122.0
703 6 167088123.0 167584157.5
704 6 167584158.5 167584156.5
705 6 167584157.5 168109509.5
706 6 168109510.5 Inf
707 7 -Inf 5871271.0
708 7 5871272.0 6004227.5
709 7 6004228.5 13274173.5
710 7 13274174.5 13988756.5
711 7 13988757.5 26187961.5
712 7 26187962.5 26201714.0
713 7 26201715.0 27159206.5
714 7 27159207.5 27221418.0
715 7 27221419.0 27221417.0
716 7 27221418.0 27830662.0
717 7 27830663.0 27830661.0
718 7 27830662.0 28141151.5
719 7 28141152.5 37902153.0
720 7 37902154.0 37918627.5
721 7 37918628.5 37918626.5
722 7 37918627.5 38237667.5
723 7 38237668.5 38237666.5
724 7 38237667.5 38357730.0
725 7 38357731.0 41274929.5
726 7 41274930.5 41702741.5
727 7 41702742.5 50318735.0
728 7 50318736.0 50422844.0
729 7 50422845.0 58169652.0
730 7 58169653.0 61528020.0
731 7 61528021.0 79794165.0
732 7 79794166.0 80672313.5
733 7 80672314.5 86644226.0
734 7 86644227.0 86877953.5
735 7 86877954.5 97794217.0
736 7 97794218.0 98003173.0
737 7 98003174.0 99638975.5
738 7 99638976.5 99679943.0
739 7 99679944.0 102276498.0
740 7 102276499.0 102284041.5
741 7 102284042.5 105520164.5
742 7 105520165.5 105568309.5
743 7 105568310.5 106764009.0
744 7 106764010.0 106975125.5
745 7 106975126.5 107762204.5
746 7 107762205.5 107843733.0
747 7 107843734.0 116683995.5
748 7 116683996.5 116796169.0
749 7 116796170.0 116796168.0
750 7 116796169.0 117479653.5
751 7 117479654.5 124764123.5
752 7 124764124.5 124805828.0
753 7 124805829.0 124805827.0
754 7 124805828.0 125712559.5
755 7 125712560.5 127634069.5
756 7 127634070.5 127999426.0
757 7 127999427.0 127999425.0
758 7 127999426.0 128052326.5
759 7 128052327.5 128052325.5
760 7 128052326.5 128166957.5
761 7 128166958.5 129178412.5
762 7 129178413.5 129296881.0
763 7 129296882.0 137862881.0
764 7 137862882.0 137941750.5
765 7 137941751.5 137941749.5
766 7 137941750.5 138288796.0
767 7 138288797.0 138288795.0
768 7 138288796.0 138589706.5
769 7 138589707.5 139365732.0
770 7 139365733.0 139437790.0
771 7 139437791.0 140724003.5
772 7 140724004.5 140967443.0
773 7 140967444.0 142276644.0
774 7 142276645.0 142532731.5
775 7 142532732.5 142532730.5
776 7 142532731.5 142617434.0
777 7 142617435.0 142617433.0
778 7 142617434.0 142769448.5
779 7 142769449.5 142769447.5
780 7 142769448.5 142790651.5
781 7 142790652.5 142790650.5
782 7 142790651.5 142838554.5
783 7 142838555.5 142939948.5
784 7 142939949.5 142994102.0
785 7 142994103.0 143354020.5
786 7 143354021.5 143370220.5
787 7 143370221.5 148803448.5
788 7 148803449.5 148865624.0
789 7 148865625.0 150902944.5
790 7 150902945.5 150960732.5
791 7 150960733.5 151455161.5
792 7 151455162.5 151876732.5
793 7 151876733.5 151876731.5
794 7 151876732.5 152129132.5
795 7 152129133.5 Inf
796 8 -Inf 11640646.5
797 8 11640647.5 11758567.5
798 8 11758568.5 23201256.5
799 8 23201257.5 23258369.0
800 8 23258370.0 23258368.0
801 8 23258369.0 23287987.0
802 8 23287988.0 23287986.0
803 8 23287987.0 23626467.0
804 8 23626468.0 23626466.0
805 8 23626467.0 23692599.0
806 8 23692600.0 26168221.0
807 8 26168222.0 26376702.5
808 8 26376703.5 37315794.5
809 8 37315795.5 37718175.5
810 8 37718176.5 37718174.5
811 8 37718175.5 37781033.0
812 8 37781034.0 37781032.0
813 8 37781033.0 37843288.5
814 8 37843289.5 38144863.0
815 8 38144864.0 38272330.0
816 8 38272331.0 38272329.0
817 8 38272330.0 38370262.5
818 8 38370263.5 38370261.5
819 8 38370262.5 38412022.0
820 8 38412023.0 38412021.0
821 8 38412022.0 38464476.0
822 8 38464477.0 39875472.0
823 8 39875473.0 39938578.5
824 8 39938579.5 42101740.5
825 8 42101741.5 42232182.0
826 8 42232183.0 42232181.0
827 8 42232182.0 42334962.0
828 8 42334963.0 42892377.0
829 8 42892378.0 43043200.5
830 8 43043201.5 44033743.0
831 8 44033744.0 45877265.0
832 8 45877266.0 45877265.0
833 8 45877266.0 47755961.5
834 8 47755962.5 53964225.5
835 8 53964226.5 54031474.5
836 8 54031475.5 54031473.5
837 8 54031474.5 54302711.5
838 8 54302712.5 54302710.5
839 8 54302711.5 54468569.0
840 8 54468570.0 55910891.5
841 8 55910892.5 56039873.0
842 8 56039874.0 56039872.0
843 8 56039873.0 56139889.0
844 8 56139890.0 56139888.0
845 8 56139889.0 56259352.0
846 8 56259353.0 70091519.5
847 8 70091520.5 70579041.5
848 8 70579042.5 76922981.5
849 8 76922982.5 79714939.5
850 8 79714940.5 79714938.5
851 8 79714939.5 79843227.5
852 8 79843228.5 89930298.0
853 8 89930299.0 89992950.0
854 8 89992951.0 91677584.0
855 8 91677585.0 92618589.0
856 8 92618590.0 107699118.5
857 8 107699119.5 108355889.5
858 8 108355890.5 116813442.5
859 8 116813443.5 116902367.0
860 8 116902368.0 116902366.0
861 8 116902367.0 117665101.5
862 8 117665102.5 117665100.5
863 8 117665101.5 118111226.0
864 8 118111227.0 124463472.0
865 8 124463473.0 124499844.0
866 8 124499845.0 127146223.0
867 8 127146224.0 128744720.0
868 8 128744721.0 132112649.5
869 8 132112650.5 132127542.0
870 8 132127543.0 133238597.5
871 8 133238598.5 133380824.0
872 8 133380825.0 144511132.0
873 8 144511133.0 144518662.0
874 8 144518663.0 Inf
875 9 -Inf 5007132.0
876 9 5007133.0 5102264.0
877 9 5102265.0 5102263.0
878 9 5102264.0 5446011.5
879 9 5446012.5 5446010.5
880 9 5446011.5 5680847.0
881 9 5680848.0 13667890.0
882 9 13667891.0 14575408.5
883 9 14575409.5 15462567.5
884 9 15462568.5 15517298.5
885 9 15517299.5 20066460.0
886 9 20066461.0 20668737.5
887 9 20668738.5 21641984.5
888 9 21641985.5 22053680.5
889 9 22053681.5 27109335.0
890 9 27109336.0 27229231.5
891 9 27229232.5 35073861.5
892 9 35073862.5 35084223.0
893 9 35084224.0 36758792.5
894 9 36758793.5 37023521.5
895 9 37023522.5 43389634.0
896 9 43389635.0 45518558.0
897 9 45518559.0 83962706.5
898 9 83962707.5 83989539.5
899 9 83989540.5 83989538.5
900 9 83989539.5 84505602.5
901 9 84505603.5 84505601.5
902 9 84505602.5 85284131.0
903 9 85284132.0 90728776.5
904 9 90728777.5 91054829.0
905 9 91054830.0 92409772.5
906 9 92409773.5 92437284.5
907 9 92437285.5 95101251.0
908 9 95101252.0 95346017.5
909 9 95346018.5 95346016.5
910 9 95346017.5 95446265.0
911 9 95446266.0 97673208.5
912 9 97673209.5 97775465.0
913 9 97775466.0 98802105.0
914 9 98802106.0 98896436.0
915 9 98896437.0 99069113.0
916 9 99069114.0 99149519.5
917 9 99149520.5 99149518.5
918 9 99149519.5 99524605.5
919 9 99524606.5 99524604.5
920 9 99524605.5 99922000.0
921 9 99922001.0 107407594.0
922 9 107407595.0 108171866.5
923 9 108171867.5 125146464.5
924 9 125146465.5 125195032.5
925 9 125195033.5 127815419.5
926 9 127815420.5 127861243.5
927 9 127861244.5 129884996.0
928 9 129884997.0 130063195.0
929 9 130063196.0 130713921.5
930 9 130713922.5 130889521.0
931 9 130889522.0 132895787.5
932 9 132895788.5 132957671.5
933 9 132957672.5 132957670.5
934 9 132957671.5 133077358.0
935 9 133077359.0 133077357.0
936 9 133077358.0 133151220.5
937 9 133151221.5 134030119.0
938 9 134030120.0 134096619.5
939 9 134096620.5 134096618.5
940 9 134096619.5 134355054.0
941 9 134355055.0 134355053.0
942 9 134355054.0 134539185.0
943 9 134539186.0 136898578.5
944 9 136898579.5 136933360.5
945 9 136933361.5 Inf

The stderror is
Error in throw.default(""INTERNAL ERROR: Detected overlapping gaps on chromosome "", :Dec 18 2023, 4:05 PM
  INTERNAL ERROR: Detected overlapping gaps on chromosome 10 in argument 'gaps'.
Calls: runAbsoluteCN ... gapsToSegments.data.frame -> throw -> throw.default
In addition: There were 50 or more warnings (use warnings() to see the first 50)
Execution halted

**Session Info**
R version 4.1.0 (2021-05-18)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.2 LTS

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] compiler_4.1.0
",akaviaLab,https://github.com/lima1/PureCN/issues/339
I_kwDOBew4us56YYOL,question about cfDNA run,CLOSED,2023-12-22T00:32:21Z,2024-01-04T08:09:05Z,2024-01-04T08:09:05Z,"Hi Markus,

I'm planning to run PureCN on some cfDNA samples (WES), and I've set up the following configuration. Any suggestion is welcome :)
```
Rscript ${{CONDA_PREFIX}}/lib/R/library/PureCN/extdata/PureCN.R \
            --out ${{out_FOLDER}} \
            --vcf {inputs['purecn_vcf_file']} \
            --tumor {inputs['purecn_tumor_coverage_file']} \
            --normaldb {inputs['panel_of_normals']} \
            --intervals {inputs['bait_intervals']} \
            --sampleid {manager.config['sample-names']['tumor']} \
            --fun-segmentation PSCBS \
            --min-purity 0.1 \
            --min-af 0.001 \
            --genome hg38 \
            --model betabin \
            --force \
            --post-optimize \
            --seed 42
```
thank you",maxanes,https://github.com/lima1/PureCN/issues/340
I_kwDOBew4us57LgkH,Running PureCN with only one normal samples,OPEN,2024-01-05T02:08:57Z,2024-02-01T15:56:04Z,,"Hello!

I have to questions:
1) What is the recommended way to run PureCN with only one normal sample (if there is any)?
2) Related to this more technical - why does the minimum coverage value is used differently with and without NormalDB (explained below)?

NormalDB.R refuses to build NormalDB with less than two samples. I know that PureCN manual recommends using panel of normals but I want to look at the results with only one normal to investigate some issues with the data.

I'm trying to run:

```bash
Rscript \
    /opt/PureCN/PureCN.R \
    --out . \
    --cores 4 \
    --fun-segmentation CBS \
    --genome hg19 \
    --intervals data/interval.txt \
    --vcf data/sample1.vcf.filtered.vcf.gz \
    --normal data/normal1.bam_coverage_loess.txt.gz \
    --post-optimize \
    --sampleid sample1 \
    --snp-blacklist data/hg19_simpleRepeats.bed \
    --tumor data/sample1.bam_coverage_loess.txt.gz
```

This way PureCN finishes without errors but removes all off-target intervals due to low coverage.

I've traced this issue and found that in the `filterIntervals` function there is code:

```r
    if (!is.null(normalDB)) {
        min.coverage <- min.coverage / 10000
        flog.info(""normalDB provided. Setting minimum coverage for segmentation to %.4fX."", min.coverage)
    } else {
        flog.warn(""No normalDB provided. Provide one for better results."")
    }
```

If NormalDB is provided `min.coverage` value decreases 4 times but if not - it is remained untouched and 15X is too high for off-target coverage. Is it intended behavior?",sleyn,https://github.com/lima1/PureCN/issues/341
I_kwDOBew4us58AQFJ,Support for non-diploid allosome alterations,OPEN,2024-01-13T19:15:22Z,2024-01-13T19:15:22Z,,Important for example for prostate cancer AR amplifications.,lima1,https://github.com/lima1/PureCN/issues/342
I_kwDOBew4us58RauT,GATK segmentation might fail when all variants on a chromosome are filtered out.,OPEN,2024-01-16T21:10:54Z,2024-01-29T15:33:21Z,,Headers then lack the contig and gatk stops because of different contigs in input files.,lima1,https://github.com/lima1/PureCN/issues/343
I_kwDOBew4us58mxL_,plotting error with cell line samples and --min-purity 0.98 --max-purity 0.99,CLOSED,2024-01-19T13:10:11Z,2024-01-22T16:57:16Z,2024-01-22T16:57:16Z,"with the following settings I get a plotting error for all my ~400 cell line samples and Mutect2 VCF:

	--genome GRCh38
	--min-af 0.03
	--min-purity 0.98
	--max-purity 0.99
	--min-ploidy 1.4
	--max-ploidy 6.0
	--max-copy-number 7
	--max-segments 300
	--max-non-clonal 0.2
	--min-total-counts 100
	--model-homozygous 
	--model beta
	--fun-segmentation CBS
	--post-optimize 
	--seed 42 

example SDTOUT,SDTERR:
...
Generating output files...
Warning message:
In .bcfHeaderAsSimpleList(header) :
  duplicate keys in header will be forced to unique rownames
Error in plot.window(...) : need finite 'ylim' values
Calls: plotAbs ... .plotTypeBAF -> plot -> plot.default -> localWindow -> plot.window
In addition: Warning messages:
1: In .Call(.make_vcf_geno, filename, fixed, names(geno), as.list(geno),  :
  converting NULL pointer to R NULL
2: In plot.default(xLogRatio, logRatio$log.ratio, ylab = ""Copy Number log-ratio"",  :
  NaNs produced
Execution halted


PureCN did not finish successfully for sample CELL_143B!

Any idea what the problem could be or how I can track the problem?",ThomasGro,https://github.com/lima1/PureCN/issues/344
I_kwDOBew4us59BT6z,Applicable for WES (not hybridization capture) ,CLOSED,2024-01-24T06:09:48Z,2024-01-24T14:45:56Z,2024-01-24T14:45:56Z,"Hi, 
Thanks for the useful tool and continous updates.
My question is how is the performance of PureCN in WES data that used for example SureSelect Human All Exon V6?
I read that PureCN was first developed for hybridization capture-targeted sequencing which is totally different.
Would it be okay to use PureCN for analyzing tumor-only WES data that used SureSelect Human All Exon V6? What should be aware of if so?

If I understood anything wrong, please correct me.
Thanks,
jen








**Describe the issue**
A clear and concise description of what the issue is.

**To Reproduce**
Copy and paste your complete command line arguments from PureCN.R. If possible and potentially relevant, also copy the output of NormalDB.R and Coverage.R.

**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
Please copy and paste the log file (Sampleid.log) of a representative example

**B-allele frequency plot**
Please take a screenshot of the B-allele frequency plot of the maximum likelihood solution
(Sampleid.pdf).

**Session Info**
Please start R, type sessionInfo() and paste the output.
",jennyp76,https://github.com/lima1/PureCN/issues/345
I_kwDOBew4us59JBmC,Commercial use of PureCN,CLOSED,2024-01-25T03:58:12Z,2024-01-25T13:52:49Z,2024-01-25T04:26:04Z,"Hi, 
Can PureCN be used as a CNV caller for commercial pipeline? 

Thanks, 
jen


**Describe the issue**
A clear and concise description of what the issue is.

**To Reproduce**
Copy and paste your complete command line arguments from PureCN.R. If possible and potentially relevant, also copy the output of NormalDB.R and Coverage.R.

**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
Please copy and paste the log file (Sampleid.log) of a representative example

**B-allele frequency plot**
Please take a screenshot of the B-allele frequency plot of the maximum likelihood solution
(Sampleid.pdf).

**Session Info**
Please start R, type sessionInfo() and paste the output.
",jennyp76,https://github.com/lima1/PureCN/issues/346
I_kwDOBew4us59ewmj,Question regarding the third-party segmentation file,CLOSED,2024-01-29T10:54:55Z,2024-02-01T15:54:49Z,2024-02-01T15:54:49Z,"Hi,
I have previously asked about WGS data and PureCN usage. I have segmentation output files from Sequenza which seems to do a decent segmentation for WGS data, this is an example of a segmentation file below. Is it possible to use this file in PureCN?
![image](https://github.com/lima1/PureCN/assets/92018021/3f6a0822-7a46-4620-a5a5-abf311ad3450)

Thank you.
Marijana

",maxanes,https://github.com/lima1/PureCN/issues/347
I_kwDOBew4us59uUH-,IntervalFile.R,CLOSED,2024-01-31T05:06:41Z,2024-01-31T15:42:22Z,2024-01-31T15:42:22Z," Rscript $PURECN/IntervalFile.R --in-file OncoMonitor_targets.bed \
    -
-fasta Homo_sapiens_assembly38.fasta --out-file $OUT_REF/baits_hg19_intervals.txt \
    --off-target --genome hg38 \
    --export $OUT_REF/OncoMonitor_targets_optimized.bed \
    --mappability GCA_000001405.15_GRCh38_no_alt_analysis_set_100.bw \
    --reptiming GCA_000001405.15_GRCh38_no_alt_analysis_set_76.bw
Usage: /home/gagan_indx/R/x86_64-pc-linux-gnu-library/4.1/PureCN/extdata/IntervalFile.R [options]

/home/gagan_indx/R/x86_64-pc-linux-gnu-library/4.1/PureCN/extdata/IntervalFile.R: error: Error in getopt(spec = spec, opt = args) :
  "" "" is not a valid option, or does not support an argument

--fasta: command not found



**Describe the issue**
A clear and concise description of what the issue is.

**To Reproduce**
Copy and paste your complete command line arguments from PureCN.R. If possible and potentially relevant, also copy the output of NormalDB.R and Coverage.R.

**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
Please copy and paste the log file (Sampleid.log) of a representative example

**B-allele frequency plot**
Please take a screenshot of the B-allele frequency plot of the maximum likelihood solution
(Sampleid.pdf).

**Session Info**
Please start R, type sessionInfo() and paste the output.
",gagank4911,https://github.com/lima1/PureCN/issues/348
I_kwDOBew4us5-nTg7,Mismatch between tumor purity and number of copy number alterations ,CLOSED,2024-02-08T02:13:49Z,2024-02-13T17:57:13Z,2024-02-13T17:57:13Z,"Hello,
Thank you for developing this tool and your helpful responses on github! I am running PureCN on fresh frozen anal precancer samples. We have previously run Ichor on ULP-WGS samples from the same tissue type and are getting much lower tumor purity (.05 to .10) with clearer copy number alterations. Many of the samples that have a relatively higher tumor purity for the tumor we are working with (~.30) have very few copy number alterations. I'm wondering if any parameters that I'm using can be adjusted or how to interpret this change. Here are the PureCN commands I used: 

Rscript $PURECN/IntervalFile.R --force 
--in-file /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/purecn/interval_list.bed
 --fasta
/sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/scratch/Homo_sapiens_assembly19.fasta 
--out-file baits_hg19_intervals_mappability.txt --off-target
 --mappability /sc/arion/projects/BiNGS/bings_analysis/projects/2023/keithsigel/analprecancer_wes/damleg01/wgEncodeCrgMapabilityAlign100mer.bigWig 

Rscript $PURECN/Coverage.R --out-dir /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/purecn/normal_test 
--bam /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/raw/bam_2/38359A/v1/38359A.bam --intervals baits_hg19_intervals_mappability.tx

Rscript $PURECN/Coverage.R --out-dir /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/purecn/tumor_test 
--bam /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/raw/bam_2/37258A/v1/37258A.bam 
--intervals baits_hg19_intervals_mappability.txt""

Rscript $PURECN/PureCN.R 
--out /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/purecn/purecn_command_output_0121/ 
--tumor
/sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/purecn/tumor_test/37258A_coverage_loess.txt.gz
 --sampleid 37258A 
--vcf /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/mutect/FilterMutectCalls/37258A-filtered-gatk43.vcf
 --normaldb /sc/arion/projects/BiNGS/bings_omics/data/bings/2023/keithsigel/analprecancer_wes/purecn/normaldb/normalDB_hg19.rds 
--intervals baits_hg19_intervals.txt --genome hg19

Log file of a sample with relatively higher purity and low number of alterations: 
[37258A.log](https://github.com/lima1/PureCN/files/14203335/37258A.log)

B-allele frequency plot of the maximum likelihood solution:
![image](https://github.com/lima1/PureCN/assets/68788534/6f6305ca-4917-4a3a-97fb-64ca6e117329)


**Session Info**
R version 4.2.0 (2022-04-22)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: CentOS Linux 7 (Core)

Matrix products: default
BLAS/LAPACK: /hpc/packages/minerva-centos7/intel/parallel_studio_xe_2019/compilers_and_libraries_2019.0.117/linux/mkl/lib/intel64_lin/libmkl_gf_lp64.so

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
[1] compiler_4.2.0
Please let me know if anything else is needed!",gargid98,https://github.com/lima1/PureCN/issues/349
I_kwDOBew4us5-oTE7,Annotation using different database,OPEN,2024-02-08T07:09:48Z,2024-02-08T15:00:10Z,,"Hi, 
First of all, thank you for the wonderful tool. It been a lot of help.

I am trying to compare the total copy number between PureCN and CNVkit based on genes. 
So, comparing the total copy number of a gene detected from PureCN and CNVkit. 
Therefore, keeping the database used for annotation should be the same. 
1. Would there be a method to annotate genes using the 4th column of the BED file instead of TxDb.Hsapiens.UCSC.hg38.knownGene R package? 
2. And it this ""https://hgdownload.soe.ucsc.edu/gbdb/hg38/knownGene.txt"" is the annotation file used in PureCN for annotation? 


Thanks, jen





**Describe the issue**
A clear and concise description of what the issue is.

**To Reproduce**
Copy and paste your complete command line arguments from PureCN.R. If possible and potentially relevant, also copy the output of NormalDB.R and Coverage.R.

**Expected behavior**
A clear and concise description of what you expected to happen.

**Log file**
Please copy and paste the log file (Sampleid.log) of a representative example

**B-allele frequency plot**
Please take a screenshot of the B-allele frequency plot of the maximum likelihood solution
(Sampleid.pdf).

**Session Info**
Please start R, type sessionInfo() and paste the output.
",jennyp76,https://github.com/lima1/PureCN/issues/350
I_kwDOBew4us5_rVyj,how to improve detection of short CNV ?,CLOSED,2024-02-19T10:43:41Z,2024-02-28T15:16:29Z,2024-02-28T15:11:27Z,"--Hi,

i can't detect short CNV. Is there a way to improve the detection ?
I use these parameters:

Rscript $PURECN/PureCN.R --out $OUTPUTS/$lib  --tumor $OUTPUTS/${lib}""_recalibrated_coverage_loess.txt.gz"" --sampleid $lib --vcf $OUTPUT_GATK_CNV/${lib}""_Mutect2.vcf.gz"" --fun-segmentation PSCBS --max-segments 350 --sex=diploid --cores=16 --min-base-quality 20 --min-af 0.01 --normaldb $OUT_REF/normalDB_TWIST_hg38.rds --mapping-bias-file $OUT_REF/mapping_bias_TWIST_hg38.rds --intervals $OUT_REF/DIGI_BED_hg38_intervals.txt --genome hg38 --model betabin --minpurity 0.05 --max-copy-number 8 --rds=rda --max-non-clonal 0.3 --post-optimize --seed 123 --force


Thank you --
",lmanchon,https://github.com/lima1/PureCN/issues/351
I_kwDOBew4us6Ay1Zx,HRD score from PureCN outputs,OPEN,2024-02-29T09:34:04Z,2024-03-11T21:14:22Z,,"Dear developers, can you recommend a tool or script for calculating HDR from PureCN outputs?",ShvartsmanIrina,https://github.com/lima1/PureCN/issues/352
I_kwDOBew4us6BEpZk,Question about different version.,CLOSED,2024-03-03T18:16:07Z,2024-03-06T15:44:27Z,2024-03-06T15:44:26Z,"My name is Shenglai Li, and I am reaching out from GDC regarding an issue we encountered while investigating the possibility of upgrading the version of PureCN for our new release.

We have been using PureCN version 2.2.0 for our production environment, and it has been functioning well. However, upon testing the upgraded version (2.6.4 and the latest), we encountered failures when using a specific capture kit (Sureselect v5). Unfortunately, due to data privacy concerns, we are unable to share the data with you for debugging purposes.

I have attached the logs from both versions (purecn.2.2.0.log and purecn.2.6.4.log) for your reference.

[purecn.2.2.0.log](https://github.com/lima1/PureCN/files/14474096/purecn.2.2.0.log)
[purecn.2.6.4.log](https://github.com/lima1/PureCN/files/14474097/purecn.2.6.4.log)

I apologize that the uuids and file names do not look like the same but I am pretty sure there are a few cases they failed on new version and passed on older version. Also I tried not only version 2.6.4 but also the latest version, I think they will fail as well.

Given the circumstances, we would greatly appreciate your insight on which parts of the code we should investigate independently. Any guidance or suggestions you can provide would be immensely helpful in resolving this issue.",Shenglai,https://github.com/lima1/PureCN/issues/353
I_kwDOBew4us6Bdh4T,Tumor only PureCN filtering failure,CLOSED,2024-03-06T16:54:37Z,2024-03-06T19:54:01Z,2024-03-06T19:53:48Z,"Hi, I'm investigating some tumor only jobs from GDC that were failed to low germline variants ratio. Most of them failed when only <0.5% germline variants were detected or <2% but the total amount of normal variants is less than 10.

However, I noticed there were 2 jobs failed with relatively large amount of germline variants.
```
[2024-01-20 08:57:53] 2998 (4.6%) variants annotated as likely germline (DB INFO flag).
[2023-11-10 00:33:36] 5711 (6.4%) variants annotated as likely germline (DB INFO flag).
```

[error.1.log](https://github.com/lima1/PureCN/files/14513100/error.1.log)
[error.2.log](https://github.com/lima1/PureCN/files/14513101/error.2.log)


Attached are the job logs of them, I think the error messages are different from the others. I'm wondering if you could provide insight on why they will fail, and also would like to what is the minimum ratio or amount of germline variants PureCN needs.

Thanks a lot in advance.",Shenglai,https://github.com/lima1/PureCN/issues/354
I_kwDOBew4us6BgyXb, Could not find valid purity and ploidy solution,OPEN,2024-03-07T03:13:00Z,2024-03-12T06:38:13Z,,"INFO [2024-03-08 13:27:10] ------------------------------------------------------------
INFO [2024-03-08 13:27:10] PureCN 2.8.1
INFO [2024-03-08 13:27:10] ------------------------------------------------------------
INFO [2024-03-08 13:27:10] Arguments: -tumor.coverage.file /t_c_data/4139_NA_LIB2652_M__S48_sentieon_match_4.1_deduped_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file ../in_vcf/4139_NA_LIB2652_M__S48_TNscope.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf ../n_out/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 4139_NA_LIB2652_M__S48 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file ../ref_file/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize FALSE -BPPARAM  -log.file ../out_data//4139_NA_LIB2652_M__S48.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2024-03-08 13:27:10] Loading coverage files...
INFO [2024-03-08 13:27:11] Mean target coverages: 580X (tumor) 596X (normal).
WARN [2024-03-08 13:27:12] Allosome coverage missing, cannot determine sex.
WARN [2024-03-08 13:27:12] Allosome coverage missing, cannot determine sex.
INFO [2024-03-08 13:27:17] Removing 19604 intervals with missing log.ratio.
INFO [2024-03-08 13:27:17] Removing 49 low/high GC targets.
INFO [2024-03-08 13:27:17] Removing 27539 intervals excluded in normalDB.
INFO [2024-03-08 13:27:17] Removing 146 intervals with low total coverage in normal (< 150.00 reads).
INFO [2024-03-08 13:27:17] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2024-03-08 13:27:17] Removing 2000 low count (< 100 total reads) intervals.
INFO [2024-03-08 13:27:17] Removing 621 low coverage (< 0.0015X) intervals.
INFO [2024-03-08 13:27:17] Using 21071 intervals (3178 on-target, 17893 off-target).
INFO [2024-03-08 13:27:17] Ratio of mean on-target vs. off-target read counts: 7.49
INFO [2024-03-08 13:27:17] Mean off-target bin size: 139312
INFO [2024-03-08 13:27:18] AT/GC dropout: 1.23 (tumor), 2.74 (normal), 38.59 (coverage log-ratio).
WARN [2024-03-08 13:27:18] High GC-bias in normalized tumor vs normal log2 ratio.
INFO [2024-03-08 13:27:18] Loading VCF...
INFO [2024-03-08 13:27:18] Found 9603 variants in VCF file.
INFO [2024-03-08 13:27:19] 3431 (35.7%) variants annotated as likely germline (DB INFO flag).
INFO [2024-03-08 13:27:19] 4139_NA_LIB2652_M__S48 is tumor in VCF file.
INFO [2024-03-08 13:27:19] 34 homozygous and 16 heterozygous variants on chrX.
INFO [2024-03-08 13:27:19] Sex from VCF: NA (Fisher's p-value: < 0.0001, odds-ratio: 3.77).
WARN [2024-03-08 13:27:19] Many variants removed by min.base.quality (20) filter. You might want to lower the cutoff.
INFO [2024-03-08 13:27:19] Removing 5155 low quality variants with non-offset BQ < 20.
INFO [2024-03-08 13:27:19] Base quality scores range from 19 to 49 (offset by 1)
INFO [2024-03-08 13:27:19] High median base quality score (49). UMI-barcoded data?
INFO [2024-03-08 13:27:20] Minimum number of supporting reads ranges from 1 to 41, depending on coverage and BQS.
INFO [2024-03-08 13:27:21] Initial testing for significant sample cross-contamination: unlikely
INFO [2024-03-08 13:27:21] Removing 1870 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2024-03-08 13:27:21] Total size of targeted genomic region: 0.39Mb (0.50Mb with 50bp padding).
INFO [2024-03-08 13:27:22] 9.9% of targets contain variants.
INFO [2024-03-08 13:27:22] Removing 2250 variants outside intervals.
INFO [2024-03-08 13:27:22] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2024-03-08 13:27:22] Loading mapping bias file mapping_bias_agilent_v6_hg38.rds...
INFO [2024-03-08 13:27:22] Found 37415 variants in mapping bias file.
INFO [2024-03-08 13:27:23] Imputing mapping bias for 86 variants...
INFO [2024-03-08 13:27:24] Excluding 126 novel or poor quality variants from segmentation.
INFO [2024-03-08 13:27:24] Sample sex: ?
INFO [2024-03-08 13:27:24] Segmenting data...
INFO [2024-03-08 13:27:25] Interval weights found, will use weighted PSCBS.
INFO [2024-03-08 13:27:25] MAPD of 176 allelic fractions: 0.02 (0.02 adjusted).
INFO [2024-03-08 13:27:25] Setting undo.SD parameter to 0.750000.
INFO [2024-03-08 13:27:39] Setting prune.hclust.h parameter to 0.250000.
INFO [2024-03-08 13:27:39] Found 78 segments with median size of 21.28Mb.
INFO [2024-03-08 13:27:39] Using 328 variants.
INFO [2024-03-08 13:27:39] Mean standard deviation of log-ratios: 0.66 (MAPD: 0.29)
INFO [2024-03-08 13:27:39] Mean standard deviation of on-target log-ratios only: 0.71 (MAPD: 0.22)
INFO [2024-03-08 13:27:39] Mean standard deviation of off-target log-ratios only: 0.50 (MAPD: 0.30)
INFO [2024-03-08 13:27:39] 2D-grid search of purity and ploidy...
INFO [2024-03-08 13:28:01] Local optima: 0.19/2.4, 0.29/2.4, 0.15/2, 0.29/3, 0.23/2.1, 0.52/3.2,
0.55/4.4, 0.42/3.8, 0.88/5.8, 0.45/2.6, 0.27/1.8, 0.95/4, 0.92/3,
0.62/2.8, 0.27/2, 0.65/1.4, 0.45/1.6, 0.52/2, 0.85/2.1
INFO [2024-03-08 13:28:01] Testing local optimum 1/19 at purity 0.19 and total ploidy 2.40...
INFO [2024-03-08 13:28:02] Recalibrating log-ratios...
INFO [2024-03-08 13:28:02] Testing local optimum 1/19 at purity 0.19 and total ploidy 2.40...
INFO [2024-03-08 13:28:02] Recalibrating log-ratios...
INFO [2024-03-08 13:28:02] Testing local optimum 1/19 at purity 0.19 and total ploidy 2.40...
INFO [2024-03-08 13:28:03] Recalibrating log-ratios...
INFO [2024-03-08 13:28:03] Testing local optimum 1/19 at purity 0.19 and total ploidy 2.40...
INFO [2024-03-08 13:28:04] Testing local optimum 2/19 at purity 0.29 and total ploidy 2.40...
INFO [2024-03-08 13:28:04] Recalibrating log-ratios...
INFO [2024-03-08 13:28:04] Testing local optimum 2/19 at purity 0.29 and total ploidy 2.40...
INFO [2024-03-08 13:28:05] Recalibrating log-ratios...
INFO [2024-03-08 13:28:05] Testing local optimum 2/19 at purity 0.29 and total ploidy 2.40...
INFO [2024-03-08 13:28:06] Recalibrating log-ratios...
INFO [2024-03-08 13:28:06] Testing local optimum 2/19 at purity 0.29 and total ploidy 2.40...
INFO [2024-03-08 13:28:07] Testing local optimum 3/19 at purity 0.15 and total ploidy 2.00...
INFO [2024-03-08 13:28:07] Recalibrating log-ratios...
INFO [2024-03-08 13:28:07] Testing local optimum 3/19 at purity 0.15 and total ploidy 2.00...
INFO [2024-03-08 13:28:08] Recalibrating log-ratios...
INFO [2024-03-08 13:28:08] Testing local optimum 3/19 at purity 0.15 and total ploidy 2.00...
INFO [2024-03-08 13:28:09] Recalibrating log-ratios...
INFO [2024-03-08 13:28:09] Testing local optimum 3/19 at purity 0.15 and total ploidy 2.00...
INFO [2024-03-08 13:28:09] Testing local optimum 4/19 at purity 0.29 and total ploidy 3.00...
INFO [2024-03-08 13:28:10] Recalibrating log-ratios...
INFO [2024-03-08 13:28:10] Testing local optimum 4/19 at purity 0.29 and total ploidy 3.00...
INFO [2024-03-08 13:28:11] Recalibrating log-ratios...
INFO [2024-03-08 13:28:11] Testing local optimum 4/19 at purity 0.29 and total ploidy 3.00...
INFO [2024-03-08 13:28:11] Recalibrating log-ratios...
INFO [2024-03-08 13:28:11] Testing local optimum 4/19 at purity 0.29 and total ploidy 3.00...
INFO [2024-03-08 13:28:12] Testing local optimum 5/19 at purity 0.23 and total ploidy 2.10...
INFO [2024-03-08 13:28:13] Recalibrating log-ratios...
INFO [2024-03-08 13:28:13] Testing local optimum 5/19 at purity 0.23 and total ploidy 2.10...
INFO [2024-03-08 13:28:14] Recalibrating log-ratios...
INFO [2024-03-08 13:28:14] Testing local optimum 5/19 at purity 0.23 and total ploidy 2.10...
INFO [2024-03-08 13:28:14] Recalibrating log-ratios...
INFO [2024-03-08 13:28:14] Testing local optimum 5/19 at purity 0.23 and total ploidy 2.10...
INFO [2024-03-08 13:28:15] Testing local optimum 6/19 at purity 0.52 and total ploidy 3.20...
INFO [2024-03-08 13:28:16] Recalibrating log-ratios...
INFO [2024-03-08 13:28:16] Testing local optimum 6/19 at purity 0.52 and total ploidy 3.20...
INFO [2024-03-08 13:28:16] Recalibrating log-ratios...
INFO [2024-03-08 13:28:16] Testing local optimum 6/19 at purity 0.52 and total ploidy 3.20...
INFO [2024-03-08 13:28:17] Recalibrating log-ratios...
INFO [2024-03-08 13:28:17] Testing local optimum 6/19 at purity 0.52 and total ploidy 3.20...
INFO [2024-03-08 13:28:18] Testing local optimum 7/19 at purity 0.55 and total ploidy 4.40...
INFO [2024-03-08 13:28:20] Recalibrating log-ratios...
INFO [2024-03-08 13:28:20] Testing local optimum 7/19 at purity 0.55 and total ploidy 4.40...
INFO [2024-03-08 13:28:20] Recalibrating log-ratios...
INFO [2024-03-08 13:28:20] Testing local optimum 7/19 at purity 0.55 and total ploidy 4.40...
INFO [2024-03-08 13:28:21] Recalibrating log-ratios...
INFO [2024-03-08 13:28:21] Testing local optimum 7/19 at purity 0.55 and total ploidy 4.40...
INFO [2024-03-08 13:28:22] Testing local optimum 8/19 at purity 0.42 and total ploidy 3.80...
INFO [2024-03-08 13:28:23] Recalibrating log-ratios...
INFO [2024-03-08 13:28:23] Testing local optimum 8/19 at purity 0.42 and total ploidy 3.80...
INFO [2024-03-08 13:28:23] Recalibrating log-ratios...
INFO [2024-03-08 13:28:23] Testing local optimum 8/19 at purity 0.42 and total ploidy 3.80...
INFO [2024-03-08 13:28:24] Recalibrating log-ratios...
INFO [2024-03-08 13:28:24] Testing local optimum 8/19 at purity 0.42 and total ploidy 3.80...
INFO [2024-03-08 13:28:25] Testing local optimum 9/19 at purity 0.88 and total ploidy 5.80...
INFO [2024-03-08 13:28:26] Recalibrating log-ratios...
INFO [2024-03-08 13:28:26] Testing local optimum 9/19 at purity 0.88 and total ploidy 5.80...
INFO [2024-03-08 13:28:26] Recalibrating log-ratios...
INFO [2024-03-08 13:28:26] Testing local optimum 9/19 at purity 0.88 and total ploidy 5.80...
INFO [2024-03-08 13:28:27] Recalibrating log-ratios...
INFO [2024-03-08 13:28:27] Testing local optimum 9/19 at purity 0.88 and total ploidy 5.80...
INFO [2024-03-08 13:28:28] Testing local optimum 10/19 at purity 0.45 and total ploidy 2.60...
INFO [2024-03-08 13:28:28] Recalibrating log-ratios...
INFO [2024-03-08 13:28:28] Testing local optimum 10/19 at purity 0.45 and total ploidy 2.60...
INFO [2024-03-08 13:28:29] Recalibrating log-ratios...
INFO [2024-03-08 13:28:29] Testing local optimum 10/19 at purity 0.45 and total ploidy 2.60...
INFO [2024-03-08 13:28:30] Recalibrating log-ratios...
INFO [2024-03-08 13:28:30] Testing local optimum 10/19 at purity 0.45 and total ploidy 2.60...
INFO [2024-03-08 13:28:30] Testing local optimum 11/19 at purity 0.27 and total ploidy 1.80...
INFO [2024-03-08 13:28:31] Recalibrating log-ratios...
INFO [2024-03-08 13:28:31] Testing local optimum 11/19 at purity 0.27 and total ploidy 1.80...
INFO [2024-03-08 13:28:32] Recalibrating log-ratios...
INFO [2024-03-08 13:28:32] Testing local optimum 11/19 at purity 0.27 and total ploidy 1.80...
INFO [2024-03-08 13:28:32] Recalibrating log-ratios...
INFO [2024-03-08 13:28:32] Testing local optimum 11/19 at purity 0.27 and total ploidy 1.80...
INFO [2024-03-08 13:28:33] Testing local optimum 12/19 at purity 0.95 and total ploidy 4.00...
INFO [2024-03-08 13:28:34] Recalibrating log-ratios...
INFO [2024-03-08 13:28:34] Testing local optimum 12/19 at purity 0.95 and total ploidy 4.00...
INFO [2024-03-08 13:28:34] Recalibrating log-ratios...
INFO [2024-03-08 13:28:34] Testing local optimum 12/19 at purity 0.95 and total ploidy 4.00...
INFO [2024-03-08 13:28:35] Recalibrating log-ratios...
INFO [2024-03-08 13:28:35] Testing local optimum 12/19 at purity 0.95 and total ploidy 4.00...
INFO [2024-03-08 13:28:35] Testing local optimum 13/19 at purity 0.92 and total ploidy 3.00...
INFO [2024-03-08 13:28:36] Recalibrating log-ratios...
INFO [2024-03-08 13:28:36] Testing local optimum 13/19 at purity 0.92 and total ploidy 3.00...
INFO [2024-03-08 13:28:37] Recalibrating log-ratios...
INFO [2024-03-08 13:28:37] Testing local optimum 13/19 at purity 0.92 and total ploidy 3.00...
INFO [2024-03-08 13:28:38] Recalibrating log-ratios...
INFO [2024-03-08 13:28:38] Testing local optimum 13/19 at purity 0.92 and total ploidy 3.00...
INFO [2024-03-08 13:28:38] Testing local optimum 14/19 at purity 0.62 and total ploidy 2.80...
INFO [2024-03-08 13:28:39] Recalibrating log-ratios...
INFO [2024-03-08 13:28:39] Testing local optimum 14/19 at purity 0.62 and total ploidy 2.80...
INFO [2024-03-08 13:28:40] Recalibrating log-ratios...
INFO [2024-03-08 13:28:40] Testing local optimum 14/19 at purity 0.62 and total ploidy 2.80...
INFO [2024-03-08 13:28:40] Recalibrating log-ratios...
INFO [2024-03-08 13:28:40] Testing local optimum 14/19 at purity 0.62 and total ploidy 2.80...
INFO [2024-03-08 13:28:41] Testing local optimum 15/19 at purity 0.27 and total ploidy 2.00...
INFO [2024-03-08 13:28:42] Recalibrating log-ratios...
INFO [2024-03-08 13:28:42] Testing local optimum 15/19 at purity 0.27 and total ploidy 2.00...
INFO [2024-03-08 13:28:42] Recalibrating log-ratios...
INFO [2024-03-08 13:28:42] Testing local optimum 15/19 at purity 0.27 and total ploidy 2.00...
INFO [2024-03-08 13:28:43] Recalibrating log-ratios...
INFO [2024-03-08 13:28:43] Testing local optimum 15/19 at purity 0.27 and total ploidy 2.00...
INFO [2024-03-08 13:28:44] Testing local optimum 16/19 at purity 0.65 and total ploidy 1.40...
INFO [2024-03-08 13:28:44] Recalibrating log-ratios...
INFO [2024-03-08 13:28:44] Testing local optimum 16/19 at purity 0.65 and total ploidy 1.40...
INFO [2024-03-08 13:28:45] Recalibrating log-ratios...
INFO [2024-03-08 13:28:45] Testing local optimum 16/19 at purity 0.65 and total ploidy 1.40...
INFO [2024-03-08 13:28:46] Recalibrating log-ratios...
INFO [2024-03-08 13:28:46] Testing local optimum 16/19 at purity 0.65 and total ploidy 1.40...
INFO [2024-03-08 13:28:47] Testing local optimum 17/19 at purity 0.45 and total ploidy 1.60...
INFO [2024-03-08 13:28:47] Recalibrating log-ratios...
INFO [2024-03-08 13:28:47] Testing local optimum 17/19 at purity 0.45 and total ploidy 1.60...
INFO [2024-03-08 13:28:48] Recalibrating log-ratios...
INFO [2024-03-08 13:28:48] Testing local optimum 17/19 at purity 0.45 and total ploidy 1.60...
INFO [2024-03-08 13:28:49] Recalibrating log-ratios...
INFO [2024-03-08 13:28:49] Testing local optimum 17/19 at purity 0.45 and total ploidy 1.60...
INFO [2024-03-08 13:28:50] Testing local optimum 18/19 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-08 13:28:50] Recalibrating log-ratios...
INFO [2024-03-08 13:28:50] Testing local optimum 18/19 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-08 13:28:51] Recalibrating log-ratios...
INFO [2024-03-08 13:28:51] Testing local optimum 18/19 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-08 13:28:52] Recalibrating log-ratios...
INFO [2024-03-08 13:28:52] Testing local optimum 18/19 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-08 13:28:53] Testing local optimum 19/19 at purity 0.85 and total ploidy 2.10...
INFO [2024-03-08 13:28:53] Recalibrating log-ratios...
INFO [2024-03-08 13:28:53] Testing local optimum 19/19 at purity 0.85 and total ploidy 2.10...
INFO [2024-03-08 13:28:54] Recalibrating log-ratios...
INFO [2024-03-08 13:28:54] Testing local optimum 19/19 at purity 0.85 and total ploidy 2.10...
INFO [2024-03-08 13:28:54] Recalibrating log-ratios...
INFO [2024-03-08 13:28:54] Testing local optimum 19/19 at purity 0.85 and total ploidy 2.10...
INFO [2024-03-08 13:28:55] Skipping 6 solutions that converged to the same optima.
INFO [2024-03-08 13:28:55] Skipping 13 solutions exceeding max.non.clonal (0.20): 0.68/76.38, 0.78/50.04, 0.15/101.42, 0.78/44.52, 0.95/35.97, 0.91/43.52, 0.95/29.28, 0.15/65.92, 0.95/25.36, 0.16/39.07, 0.15/48.83, 0.64/30.67, 0.95/17.1 (purity/tumor ploidy)
WARN [2024-03-08 13:28:55] Could not find valid purity and ploidy solution.",gagank4911,https://github.com/lima1/PureCN/issues/355
I_kwDOBew4us6B8GuC,Seems forgotten assignmet operator,CLOSED,2024-03-11T19:15:06Z,2024-03-28T21:56:33Z,2024-03-28T21:56:33Z,"Hello!

I was looking on implementation of tangent normalization and found an operaton without an assignment operator: `fcnts_std_final - median(apply(fcnts_std_final,2,median))` in `createNormalDatabase.R`.

It looks like it should be `fcnts_std_final <- fcnts_std_final - median(apply(fcnts_std_final,2,median))`

https://github.com/lima1/PureCN/blob/c7fddf087671538c995cd665b85a5d354a3aa9ef/R/createNormalDatabase.R#L217C5-L217C62
",sleyn,https://github.com/lima1/PureCN/issues/356
I_kwDOBew4us6B8-LC,Error: VCF either contains no germline variants or variants are not properly ,CLOSED,2024-03-11T21:11:37Z,2024-04-10T16:33:19Z,2024-04-10T16:33:19Z,"Hello lima,
I'm trying to run PureCN with NormalDB, but I get Error:
INFO [2024-03-11 20:23:58] PureCN 2.8.1
INFO [2024-03-11 20:23:58] ------------------------------------------------------------
INFO [2024-03-11 20:23:58] Arguments: -tumor.coverage.file /cromwell-executions/PurecnTumor/a9de9374-76c9-44cd-a3c6-e68e5fe130a8/call-PureCN/inputs/-285599999/102_S544_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file /cromwell-executions/PurecnTumor/a9de9374-76c9-44cd-a3c6-e68e5fe130a8/call-PureCN/inputs/1991514784/102_S544.vcf -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf /cromwell-executions/PurecnTumor/a9de9374-76c9-44cd-a3c6-e68e5fe130a8/call-PureCN/inputs/1662463198/mapping_bias_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 102_S544 -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file /cromwell-executions/PurecnTumor/a9de9374-76c9-44cd-a3c6-e68e5fe130a8/call-PureCN/inputs/1241338070/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -BPPARAM  -log.file ./102_S544.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2024-03-11 20:23:58] Loading coverage files...
INFO [2024-03-11 20:24:02] Mean target coverages: 6X (tumor) 6X (normal).
INFO [2024-03-11 20:24:04] Mean coverages: chrX: 1.68, chrY: 0.95, chr1-22: 1.73.
INFO [2024-03-11 20:24:04] Mean coverages: chrX: 2.30, chrY: 0.95, chr1-22: 1.55.
INFO [2024-03-11 20:24:14] Removing 129536 intervals with missing log.ratio.
INFO [2024-03-11 20:24:14] Removing 100 low/high GC targets.
INFO [2024-03-11 20:24:15] Removing 43878 intervals excluded in normalDB.
INFO [2024-03-11 20:24:15] Removing 9905 intervals with low total coverage in normal (< 150.00 reads).
INFO [2024-03-11 20:24:15] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2024-03-11 20:24:15] Removing 17731 low count (< 100 total reads) intervals.
INFO [2024-03-11 20:24:15] Removing 1383 low coverage (< 0.0015X) intervals.
INFO [2024-03-11 20:24:15] Using 42217 intervals (23238 on-target, 18979 off-target).
INFO [2024-03-11 20:24:15] Ratio of mean on-target vs. off-target read counts: 0.11
INFO [2024-03-11 20:24:15] Mean off-target bin size: 99902
INFO [2024-03-11 20:24:15] AT/GC dropout: 0.83 (tumor), 0.79 (normal), 1.04 (coverage log-ratio). 
INFO [2024-03-11 20:24:15] High GC-bias in normal and/or tumor coverage.
INFO [2024-03-11 20:24:15] Loading VCF...
INFO [2024-03-11 20:24:29] Found 593360 variants in VCF file.
INFO [2024-03-11 20:24:31] Removing 4120 triallelic sites.
INFO [2024-03-11 20:24:32] Maximum of POPAP INFO is > 1, assuming -log10 scaled values
WARN [2024-03-11 20:24:32] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele frequency > 0.001000 instead.
INFO [2024-03-11 20:24:33] 0 (0.0%) variants annotated as likely germline (DB INFO flag).
FATAL [2024-03-11 20:24:33] VCF either contains no germline variants or variants are not properly 

FATAL [2024-03-11 20:24:33] annotated. 

FATAL [2024-03-11 20:24:33]  

FATAL [2024-03-11 20:24:33] This is most likely a user error due to invalid input data or 

FATAL [2024-03-11 20:24:33] parameters (PureCN 2.8.1). 

I'm using Muteck2 both for building NormalDB and tumor sample:
gatk Mutect2 \
-R ~{ref_fasta} \
-I ~{bam} \
-O ~{BAM_pre}.vcf \
--genotype-germline-sites true \
--genotype-pon-sites true \
--interval-padding 50

my tumor.vcf is:
##fileformat=VCFv4.2
##FORMAT=<ID=AD,Number=R,Type=Integer,Description=""Allelic depths for the ref and alt alleles in the order listed"">
##FORMAT=<ID=AF,Number=A,Type=Float,Description=""Allele fractions of alternate alleles in the tumor"">
##FORMAT=<ID=DP,Number=1,Type=Integer,Description=""Approximate read depth (reads with MQ=255 or with bad mates are filtered)"">
##FORMAT=<ID=F1R2,Number=R,Type=Integer,Description=""Count of reads in F1R2 pair orientation supporting each allele"">
##FORMAT=<ID=F2R1,Number=R,Type=Integer,Description=""Count of reads in F2R1 pair orientation supporting each allele"">
##FORMAT=<ID=FAD,Number=R,Type=Integer,Description=""Count of fragments supporting each allele."">
##FORMAT=<ID=GQ,Number=1,Type=Integer,Description=""Genotype Quality"">
##FORMAT=<ID=GT,Number=1,Type=String,Description=""Genotype"">
##FORMAT=<ID=PGT,Number=1,Type=String,Description=""Physical phasing haplotype information, describing how the alternate alleles are phased in relation to one another; will always be heterozygous and is not intended to describe called alleles"">
##FORMAT=<ID=PID,Number=1,Type=String,Description=""Physical phasing ID information, where each unique ID within a given sample (but not across samples) connects records within a phasing group"">
##FORMAT=<ID=PL,Number=G,Type=Integer,Description=""Normalized, Phred-scaled likelihoods for genotypes as defined in the VCF specification"">
##FORMAT=<ID=PS,Number=1,Type=Integer,Description=""Phasing set (typically the position of the first variant in the set)"">
##FORMAT=<ID=SB,Number=4,Type=Integer,Description=""Per-sample component statistics which comprise the Fisher's Exact Test to detect strand bias."">
##GATKCommandLine=<ID=Mutect2,CommandLine=""Mutect2 --genotype-pon-sites true --genotype-germline-sites true --output 102_S544.vcf --interval-padding 50 --input /cromwell-executions/Mutect2/34dc964c-ae1e-4d3a-9d62-fd1164a46541/call-M1/inputs/-1728826228/102_S544.bam --reference /cromwell-executions/Mutect2/34dc964c-ae1e-4d3a-9d62-fd1164a46541/call-M1/inputs/1253363328/hg38.fa --f1r2-median-mq 50 --f1r2-min-bq 20 --f1r2-max-depth 200 --flow-likelihood-parallel-threads 0 --flow-likelihood-optimized-comp false --trim-to-haplotype true --exact-matching false --flow-use-t0-tag false --flow-probability-threshold 0.003 --flow-remove-non-single-base-pair-indels false --flow-remove-one-zero-probs false --flow-quantization-bins 121 --flow-fill-empty-bins-value 0.001 --flow-symmetric-indel-probs false --flow-report-insertion-or-deletion false --flow-disallow-probs-larger-than-call false --flow-lump-probs false --flow-retain-max-n-probs-base-format false --flow-probability-scaling-factor 10 --flow-order-cycle-length 4 --keep-boundary-flows false --af-of-alleles-not-in-resource -1.0 --mitochondria-mode false --mutect3-training-mode false --mutect3-ref-downsample 10 --mutect3-alt-downsample 20 --mutect3-non-artifact-ratio 20 --tumor-lod-to-emit 3.0 --initial-tumor-lod 2.0 --pcr-snv-qual 40 --pcr-indel-qual 40 --base-qual-correction-factor 5 --max-population-af 0.01 --downsampling-stride 1 --callable-depth 10 --max-suspicious-reads-per-alignment-start 0 --normal-lod 2.2 --ignore-itr-artifacts false --gvcf-lod-band -2.5 --gvcf-lod-band -2.0 --gvcf-lod-band -1.5 --gvcf-lod-band -1.0 --gvcf-lod-band -0.5 --gvcf-lod-band 0.0 --gvcf-lod-band 0.5 --gvcf-lod-band 1.0 --minimum-allele-fraction 0.0 --independent-mates false --flow-mode NONE --disable-adaptive-pruning false --kmer-size 10 --kmer-size 25 --dont-increase-kmer-sizes-for-cycles false --allow-non-unique-kmers-in-ref false --num-pruning-samples 1 --min-dangling-branch-length 4 --recover-all-dangling-branches false --max-num-haplotypes-in-population 128 --min-pruning 2 --adaptive-pruning-initial-error-rate 0.001 --pruning-lod-threshold 2.302585092994046 --pruning-seeding-lod-threshold 9.210340371976184 --max-unpruned-variants 100 --linked-de-bruijn-graph false --disable-artificial-haplotype-recovery false --enable-legacy-graph-cycle-detection false --debug-assembly false --debug-graph-transformations false --capture-assembly-failure-bam false --num-matching-bases-in-dangling-end-to-recover -1 --error-correction-log-odds -Infinity --error-correct-reads false --kmer-length-for-read-error-correction 25 --min-observations-for-kmer-to-be-solid 20 --likelihood-calculation-engine PairHMM --base-quality-score-threshold 18 --dragstr-het-hom-ratio 2 --dont-use-dragstr-pair-hmm-scores false --pair-hmm-gap-continuation-penalty 10 --expected-mismatch-rate-for-read-disqualification 0.02 --pair-hmm-implementation FASTEST_AVAILABLE --pcr-indel-model CONSERVATIVE --phred-scaled-global-read-mismapping-rate 45 --disable-symmetric-hmm-normalizing false --disable-cap-base-qualities-to-map-quality false --enable-dynamic-read-disqualification-for-genotyping false --dynamic-read-disqualification-threshold 1.0 --native-pair-hmm-threads 4 --native-pair-hmm-use-double-precision false --flow-hmm-engine-min-indel-adjust 6 --flow-hmm-engine-flat-insertion-penatly 45 --flow-hmm-engine-flat-deletion-penatly 45 --pileup-detection false --use-pdhmm false --use-pdhmm-overlap-optimization false --make-determined-haps-from-pd-code false --print-pileupcalling-status false --fallback-gga-if-pdhmm-fails true --pileup-detection-enable-indel-pileup-calling false --pileup-detection-active-region-phred-threshold 0.0 --num-artificial-haplotypes-to-add-per-allele 5 --artifical-haplotype-filtering-kmer-size 10 --pileup-detection-snp-alt-threshold 0.1 --pileup-detection-indel-alt-threshold 0.1 --pileup-detection-absolute-alt-depth 0.0 --pileup-detection-snp-adjacent-to-assembled-indel-range 5 --pileup-detection-snp-basequality-filter 12 --pileup-detection-bad-read-tolerance 0.0 --pileup-detection-proper-pair-read-badness true --pileup-detection-edit-distance-read-badness-threshold 0.08 --pileup-detection-chimeric-read-badness true --pileup-detection-template-mean-badness-threshold 0.0 --pileup-detection-template-std-badness-threshold 0.0 --pileup-detection-filter-assembly-alt-bad-read-tolerance 0.0 --pileup-detection-edit-distance-read-badness-for-assembly-filtering-threshold 0.12 --bam-writer-type CALLED_HAPLOTYPES --dont-use-soft-clipped-bases false --override-fragment-softclip-check false --min-base-quality-score 10 --smith-waterman FASTEST_AVAILABLE --emit-ref-confidence NONE --max-mnp-distance 1 --force-call-filtered-alleles false --reference-model-deletion-quality 30 --soft-clip-low-quality-ends false --allele-informative-reads-overlap-margin 2 --smith-waterman-dangling-end-match-value 25 --smith-waterman-dangling-end-mismatch-penalty -50 --smith-waterman-dangling-end-gap-open-penalty -110 --smith-waterman-dangling-end-gap-extend-penalty -6 --smith-waterman-haplotype-to-reference-match-value 200 --smith-waterman-haplotype-to-reference-mismatch-penalty -150 --smith-waterman-haplotype-to-reference-gap-open-penalty -260 --smith-waterman-haplotype-to-reference-gap-extend-penalty -11 --smith-waterman-read-to-haplotype-match-value 10 --smith-waterman-read-to-haplotype-mismatch-penalty -15 --smith-waterman-read-to-haplotype-gap-open-penalty -30 --smith-waterman-read-to-haplotype-gap-extend-penalty -5 --flow-assembly-collapse-hmer-size 0 --flow-assembly-collapse-partial-mode false --flow-filter-alleles false --flow-filter-alleles-qual-threshold 30.0 --flow-filter-alleles-sor-threshold 3.0 --flow-filter-lone-alleles false --flow-filter-alleles-debug-graphs false --min-assembly-region-size 50 --max-assembly-region-size 300 --active-probability-threshold 0.002 --max-prob-propagation-distance 50 --force-active false --assembly-region-padding 100 --padding-around-indels 75 --padding-around-snps 20 --padding-around-strs 75 --max-extension-into-assembly-region-padding-legacy 25 --max-reads-per-alignment-start 50 --enable-legacy-assembly-region-trimming false --interval-set-rule UNION --interval-exclusion-padding 0 --interval-merging-rule ALL --read-validation-stringency SILENT --seconds-between-progress-updates 10.0 --disable-sequence-dictionary-validation false --create-output-bam-index true --create-output-bam-md5 false --create-output-variant-index true --create-output-variant-md5 false --max-variants-per-shard 0 --lenient false --add-output-sam-program-record true --add-output-vcf-command-line true --cloud-prefetch-buffer 40 --cloud-index-prefetch-buffer -1 --disable-bam-index-caching false --sites-only-vcf-output false --help false --version false --showHidden false --verbosity INFO --QUIET false --use-jdk-deflater false --use-jdk-inflater false --gcs-max-retries 20 --gcs-project-for-requester-pays  --disable-tool-default-read-filters false --minimum-mapping-quality 20 --max-read-length 2147483647 --min-read-length 30 --disable-tool-default-annotations false --enable-all-annotations false"",Version=""4.5.0.0"",Date=""March 11, 2024 at 1:44:25 PM GMT"">
##INFO=<ID=AS_SB_TABLE,Number=1,Type=String,Description=""Allele-specific forward/reverse read counts for strand bias tests. Includes the reference and alleles separated by |."">
##INFO=<ID=AS_UNIQ_ALT_READ_COUNT,Number=A,Type=Integer,Description=""Number of reads with unique start and mate end positions for each alt at a variant site"">
##INFO=<ID=CONTQ,Number=1,Type=Float,Description=""Phred-scaled qualities that alt allele are not due to contamination"">
##INFO=<ID=DP,Number=1,Type=Integer,Description=""Approximate read depth; some reads may have been filtered"">
##INFO=<ID=ECNT,Number=1,Type=Integer,Description=""Number of events in this haplotype"">
##INFO=<ID=GERMQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles are not germline variants"">
##INFO=<ID=MBQ,Number=R,Type=Integer,Description=""median base quality by allele"">
##INFO=<ID=MFRL,Number=R,Type=Integer,Description=""median fragment length by allele"">
##INFO=<ID=MMQ,Number=R,Type=Integer,Description=""median mapping quality by allele"">
##INFO=<ID=MPOS,Number=A,Type=Integer,Description=""median distance from end of read"">
##INFO=<ID=NALOD,Number=A,Type=Float,Description=""Negative log 10 odds of artifact in normal with same allele fraction as tumor"">
##INFO=<ID=NCount,Number=1,Type=Integer,Description=""Count of N bases in the pileup"">
##INFO=<ID=NLOD,Number=A,Type=Float,Description=""Normal log 10 likelihood ratio of diploid het or hom alt genotypes"">
##INFO=<ID=OCM,Number=1,Type=Integer,Description=""Number of alt reads whose original alignment doesn't match the current contig."">
##INFO=<ID=PON,Number=0,Type=Flag,Description=""site found in panel of normals"">
##INFO=<ID=POPAF,Number=A,Type=Float,Description=""negative log 10 population allele frequencies of alt alleles"">
##INFO=<ID=ROQ,Number=1,Type=Float,Description=""Phred-scaled qualities that alt allele are not due to read orientation artifact"">
##INFO=<ID=RPA,Number=R,Type=Integer,Description=""Number of times tandem repeat unit is repeated, for each allele (including reference)"">
##INFO=<ID=RU,Number=1,Type=String,Description=""Tandem repeat unit (bases)"">
##INFO=<ID=SEQQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles are not sequencing errors"">
##INFO=<ID=STR,Number=0,Type=Flag,Description=""Variant is a short tandem repeat"">
##INFO=<ID=STRANDQ,Number=1,Type=Integer,Description=""Phred-scaled quality of strand bias artifact"">
##INFO=<ID=STRQ,Number=1,Type=Integer,Description=""Phred-scaled quality that alt alleles in STRs are not polymerase slippage errors"">
##INFO=<ID=TLOD,Number=A,Type=Float,Description=""Log 10 likelihood ratio score of variant existing versus not existing"">
##MutectVersion=2.2
##contig=<ID=chr1,length=248956422>
##contig=<ID=chr10,length=133797422>
##contig=<ID=chr11,length=135086622>
##contig=<ID=chr11_KI270721v1_random,length=100316>
##contig=<ID=chr12,length=133275309>
##contig=<ID=chr13,length=114364328>
##contig=<ID=chr14,length=107043718>
##contig=<ID=chr14_GL000009v2_random,length=201709>
....
##filtering_status=Warning: unfiltered Mutect 2 calls.  Please run FilterMutectCalls to remove false positives.
##source=Mutect2
##tumor_sample=102_S544
#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	102_S544
chr1	13273	.	G	C	.	.	AS_SB_TABLE=18,17|11,10;DP=60;ECNT=1;MBQ=40,40;MFRL=195,214;MMQ=27,24;MPOS=27;POPAF=7.30;TLOD=48.28	GT:AD:AF:DP:F1R2:F2R1:FAD:SB	0/1:35,21:0.407:56:22,14:8,7:31,21:18,17,11,10
chr1	13417	.	C	CGAGA	.	.	AS_SB_TABLE=0,7|0,4;DP=14;ECNT=1;MBQ=40,40;MFRL=201,210;MMQ=22,24;MPOS=31;POPAF=7.30;RPA=2,4;RU=GA;STR;TLOD=14.22	GT:AD:AF:DP:F1R2:F2R1:FAD:SB	0/1:7,4:0.377:11:1,0:1,0:7,4:0,7,0,4
chr1	17385	.	G	A	.	.	AS_SB_TABLE=9,0|3,0;DP=12;ECNT=1;MBQ=40,40;MFRL=219,180;MMQ=34,34;MPOS=47;POPAF=7.30;TLOD=8.67	GT:AD:AF:DP:F1R2:F2R1:FAD:SB	0/1:9,3:0.286:12:2,0:7,3:9,3:9,0,3,0
chr1	69511	.	A	G	.	.	AS_SB_TABLE=0,0|24,14;DP=39;ECNT=1;MBQ=0,40;MFRL=0,195;MMQ=60,48;MPOS=20;POPAF=7.30;TLOD=140.01	GT:AD:AF:DP:F1R2:F2R1:FAD:SB	0/1:0,38:0.972:38:0,18:0,14:0,33:0,0,24,14
chr1	121009	.	C	T	.	.	AS_SB_TABLE=0,0|0,0;DP=3;ECNT=1;MBQ=40,40;MFRL=180,233;MMQ=29,60;MPOS=25;POPAF=7.30;TLOD=3.65	GT:AD:AF:DP:F1R2:F2R1:FAD:SB	0/1:1,1:0.500:2:0,0:1,1:1,1:0,1,0,1

I would really appreciate your help!",ShvartsmanIrina,https://github.com/lima1/PureCN/issues/357
I_kwDOBew4us6CBkPZ,WARN [2024-03-12 11:57:13] Could not find valid purity and ploidy solution. Error in results[[1]] : subscript out of bounds,OPEN,2024-03-12T12:03:10Z,2024-03-12T12:03:10Z,,"INFO [2024-03-12 11:54:46] Loading PureCN 2.8.1...
WARN [2024-03-12 11:54:46] Recommended to provide --fun-segmentation Hclust.
INFO [2024-03-12 11:54:46] ------------------------------------------------------------
INFO [2024-03-12 11:54:46] PureCN 2.8.1
INFO [2024-03-12 11:54:46] ------------------------------------------------------------
INFO [2024-03-12 11:54:46] Arguments: -normal.coverage.file  -tumor.coverage.file  -log.ratio  -seg.file ../bam_in/4139.seg -vcf.file ../bam_in/4139_NA_LIB2652_M__S48_TNscope.vcf -normalDB  -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf ../ref_file/mapping_bias_agilent_v6_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid 4139_NA_LIB2652_M__S48_sentieon_match_4.1_deduped -min.ploidy 1.4 -max.ploidy 6 -max.non.clonal 0.2 -max.homozygous.loss 0.05,1e+07 -log.ratio.calibration 0.1 -model.homozygous FALSE -error 0.001 -interval.file ../ref_file/baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 300 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize FALSE -BPPARAM  -log.file ../out_data//4139_NA_LIB2652_M__S48_sentieon_match_4.1_deduped.log -args.filterVcf <data> -fun.segmentation <data> -test.num.copy <data> -test.purity <data> -speedup.heuristics <data>
INFO [2024-03-12 11:54:46] Loading coverage files...
WARN [2024-03-12 11:54:47] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
WARN [2024-03-12 11:54:47] Allosome coverage missing, cannot determine sex.
WARN [2024-03-12 11:54:47] Allosome coverage missing, cannot determine sex.
INFO [2024-03-12 11:54:54] Removing 577 intervals with missing log.ratio.
INFO [2024-03-12 11:54:54] Using 70453 intervals (49235 on-target, 21218 off-target).
INFO [2024-03-12 11:54:54] Ratio of mean on-target vs. off-target read counts: NaN
INFO [2024-03-12 11:54:54] Mean off-target bin size: 129575
INFO [2024-03-12 11:54:54] Loading VCF...
INFO [2024-03-12 11:54:55] Found 9603 variants in VCF file.
INFO [2024-03-12 11:54:55] 3431 (35.7%) variants annotated as likely germline (DB INFO flag).
INFO [2024-03-12 11:54:55] 4139_NA_LIB2652_M__S48 is tumor in VCF file.
INFO [2024-03-12 11:54:55] 34 homozygous and 16 heterozygous variants on chrX.
INFO [2024-03-12 11:54:55] Sex from VCF: NA (Fisher's p-value: < 0.0001, odds-ratio: 3.77).
WARN [2024-03-12 11:54:55] Many variants removed by min.base.quality (25) filter. You might want to lower the cutoff.
INFO [2024-03-12 11:54:55] Removing 5215 low quality variants with non-offset BQ < 25.
INFO [2024-03-12 11:54:55] Base quality scores range from 24 to 49 (offset by 1)
INFO [2024-03-12 11:54:55] High median base quality score (49). UMI-barcoded data?
INFO [2024-03-12 11:54:56] Minimum number of supporting reads ranges from 2 to 31, depending on coverage and BQS.
INFO [2024-03-12 11:54:57] Initial testing for significant sample cross-contamination: unlikely
INFO [2024-03-12 11:54:57] Removing 1811 variants with AF < 0.030 or AF >= 0.970 or insufficient supporting reads or depth < 15.
INFO [2024-03-12 11:54:57] Total size of targeted genomic region: 5.92Mb (8.79Mb with 50bp padding).
INFO [2024-03-12 11:54:57] 3.3% of targets contain variants.
INFO [2024-03-12 11:54:57] Removing 381 variants outside intervals.
INFO [2024-03-12 11:54:57] Setting somatic prior probabilities for dbSNP hits to 0.000500 or to 0.500000 otherwise.
INFO [2024-03-12 11:54:57] Loading mapping bias file mapping_bias_agilent_v6_hg38.rds...
INFO [2024-03-12 11:54:57] Found 37415 variants in mapping bias file.
INFO [2024-03-12 11:54:59] Imputing mapping bias for 1850 variants...
INFO [2024-03-12 11:55:32] Excluding 593 novel or poor quality variants from segmentation.
INFO [2024-03-12 11:55:32] Sample sex: ?
INFO [2024-03-12 11:55:32] Segmenting data...
INFO [2024-03-12 11:55:32] Loaded provided segmentation file 4139.seg (format DNAcopy).
WARN [2024-03-12 11:55:32] Expecting numeric chromosome names in seg.file, assuming file is properly sorted.
WARN [2024-03-12 11:55:32] Removing 0 short segments with log-ratio < -8.
INFO [2024-03-12 11:55:32] Re-centering provided segment means (offset 0.7026).
INFO [2024-03-12 11:55:32] Loading pre-computed boundaries for DNAcopy...
INFO [2024-03-12 11:55:32] Setting undo.SD parameter to 0.000000.
Setting multi-figure configuration
INFO [2024-03-12 11:55:34] Setting prune.hclust.h parameter to 0.250000.
INFO [2024-03-12 11:55:34] Found 166 segments with median size of 5.64Mb.
INFO [2024-03-12 11:55:34] Removing 16 variants outside segments.
INFO [2024-03-12 11:55:34] Using 2180 variants.
INFO [2024-03-12 11:55:35] Mean standard deviation of log-ratios: 0.40 (MAPD: 0.00)
INFO [2024-03-12 11:55:35] Mean standard deviation of on-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2024-03-12 11:55:35] Mean standard deviation of off-target log-ratios only: 0.00 (MAPD: 0.00)
INFO [2024-03-12 11:55:35] 2D-grid search of purity and ploidy...
INFO [2024-03-12 11:56:35] Local optima: 0.42/2.1, 0.52/2.4, 0.52/2, 0.72/3.2, 0.85/3.4, 0.78/2
INFO [2024-03-12 11:56:35] Testing local optimum 1/6 at purity 0.42 and total ploidy 2.10...
INFO [2024-03-12 11:56:37] Recalibrating log-ratios...
INFO [2024-03-12 11:56:37] Testing local optimum 1/6 at purity 0.42 and total ploidy 2.10...
INFO [2024-03-12 11:56:38] Recalibrating log-ratios...
INFO [2024-03-12 11:56:38] Testing local optimum 1/6 at purity 0.42 and total ploidy 2.10...
INFO [2024-03-12 11:56:40] Recalibrating log-ratios...
INFO [2024-03-12 11:56:40] Testing local optimum 1/6 at purity 0.42 and total ploidy 2.10...
INFO [2024-03-12 11:56:42] Testing local optimum 2/6 at purity 0.52 and total ploidy 2.40...
INFO [2024-03-12 11:56:43] Recalibrating log-ratios...
INFO [2024-03-12 11:56:43] Testing local optimum 2/6 at purity 0.52 and total ploidy 2.40...
INFO [2024-03-12 11:56:45] Recalibrating log-ratios...
INFO [2024-03-12 11:56:45] Testing local optimum 2/6 at purity 0.52 and total ploidy 2.40...
INFO [2024-03-12 11:56:47] Recalibrating log-ratios...
INFO [2024-03-12 11:56:47] Testing local optimum 2/6 at purity 0.52 and total ploidy 2.40...
INFO [2024-03-12 11:56:48] Testing local optimum 3/6 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-12 11:56:50] Recalibrating log-ratios...
INFO [2024-03-12 11:56:50] Testing local optimum 3/6 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-12 11:56:51] Recalibrating log-ratios...
INFO [2024-03-12 11:56:51] Testing local optimum 3/6 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-12 11:56:53] Recalibrating log-ratios...
INFO [2024-03-12 11:56:53] Testing local optimum 3/6 at purity 0.52 and total ploidy 2.00...
INFO [2024-03-12 11:56:55] Testing local optimum 4/6 at purity 0.72 and total ploidy 3.20...
INFO [2024-03-12 11:56:56] Recalibrating log-ratios...
INFO [2024-03-12 11:56:56] Testing local optimum 4/6 at purity 0.72 and total ploidy 3.20...
INFO [2024-03-12 11:56:58] Recalibrating log-ratios...
INFO [2024-03-12 11:56:58] Testing local optimum 4/6 at purity 0.72 and total ploidy 3.20...
INFO [2024-03-12 11:56:59] Recalibrating log-ratios...
INFO [2024-03-12 11:56:59] Testing local optimum 4/6 at purity 0.72 and total ploidy 3.20...
INFO [2024-03-12 11:57:01] Testing local optimum 5/6 at purity 0.85 and total ploidy 3.40...
INFO [2024-03-12 11:57:03] Recalibrating log-ratios...
INFO [2024-03-12 11:57:03] Testing local optimum 5/6 at purity 0.85 and total ploidy 3.40...
INFO [2024-03-12 11:57:04] Recalibrating log-ratios...
INFO [2024-03-12 11:57:04] Testing local optimum 5/6 at purity 0.85 and total ploidy 3.40...
INFO [2024-03-12 11:57:06] Recalibrating log-ratios...
INFO [2024-03-12 11:57:06] Testing local optimum 5/6 at purity 0.85 and total ploidy 3.40...
INFO [2024-03-12 11:57:07] Testing local optimum 6/6 at purity 0.78 and total ploidy 2.00...
INFO [2024-03-12 11:57:09] Recalibrating log-ratios...
INFO [2024-03-12 11:57:09] Testing local optimum 6/6 at purity 0.78 and total ploidy 2.00...
INFO [2024-03-12 11:57:10] Recalibrating log-ratios...
INFO [2024-03-12 11:57:10] Testing local optimum 6/6 at purity 0.78 and total ploidy 2.00...
INFO [2024-03-12 11:57:12] Recalibrating log-ratios...
INFO [2024-03-12 11:57:12] Testing local optimum 6/6 at purity 0.78 and total ploidy 2.00...
INFO [2024-03-12 11:57:13] Skipping 6 solutions exceeding max.non.clonal (0.20): 0.15/7.32151366171102e+69, 0.29/6.4975043500027e+69, 0.15/1.75075056629748e+70, 0.93/4.62651304294153e+67, 0.95/4.9331070195215e+69, 0.29/1.14927951762391e+71 (purity/tumor ploidy)
WARN [2024-03-12 11:57:13] Could not find valid purity and ploidy solution.
Error in results[[1]] : subscript out of bounds
Calls: runAbsoluteCN -> grepl -> is.factor
Execution halted
root@095bb1c61e92:/opt#",gagank4911,https://github.com/lima1/PureCN/issues/358
I_kwDOBew4us6ECJuT,purity and ploidy corrected CN,CLOSED,2024-03-29T11:22:04Z,2024-04-25T18:00:47Z,2024-04-25T18:00:47Z,"Hi, I would really appreciate your help. 
Even though, I read through all issues related to ploidy and purity adjustment, I'm still confused.

1. Based on one of the issues #40 , you mentioned that PureCN provides ""ploidy **AND** purity-adjusted CN"". 
    So you mean the C and M in the {sample_id}_genes.csv file are ""ploidy **AND** purity-adjusted? 
    The ploidy value in {sample_id}.csv is calculated presuming the purity of tumor sample is 1? From #40, it would be 'T(tumor ploidy). 

2. Yet the `seg.mean` in the {sample_id}_dnacopy.seg, is **NOT** ploidy **NOR** purity-adjusted? 
Isn't the log2-ratio already been adjusted for ploidy and purity?

3.  So, if I want to use `seg.mean` for GISTIC2.0, I would have to calculate purity-adjusted log2 ratio by myself using the formula mentioned in https://www.nature.com/articles/ng.2760 (section Impurity-corrected GISTIC)? 

I'm sorry for asking basic questions.
Thanks, in advance.
Jen",jennyp76,https://github.com/lima1/PureCN/issues/360
I_kwDOBew4us6EssjI,Single standard deviation vs. segment-centric standard deviation for logR likelihood,CLOSED,2024-04-04T19:04:55Z,2024-04-04T22:11:34Z,2024-04-04T22:11:34Z,"Hi @lima1,

This is more of a question than an issue.

I was re-reading the PureCN paper and reviewing the equation of the original paper (https://scfbm.biomedcentral.com/articles/10.1186/s13029-016-0060-z):

$$
r_{i} \sim N \Bigg(log_{2} \frac{pC_{i} + (1-p)2}{p\Big(\sum_{j}l_{j}C_{j}\Big) / \sum_{j}l_{j} + (1-p)2}, \sigma_{ri} \Bigg)
$$


The standard deviation ($\sigma_{ri}$) of the normal distribution is set to be:

> the average standard deviation of log-ratios in a segment

I am just curious as to what the rationale is for using a single standard deviation value (learned across all segments) rather than have the standard deviation set to be segment-centric? 
",tinyheero,https://github.com/lima1/PureCN/issues/361
I_kwDOBew4us6FRTTz,Multi region curation,CLOSED,2024-04-10T15:39:41Z,2024-04-20T17:23:56Z,2024-04-20T17:23:56Z,"Hi Markus,

Thank you for creating such a useful and transparent copy number caller! 

I am working on a dataset with multiple regions per patient, and have run pureCN on each sample. I have found that the in most cases there is pretty strong agreement between regions of the same tumor, but in other cases there are a lot of conserved breakpoints but the actual copy number of the breakpoints is ploidy shifted (for example balanced diploid vs balanced tetraploid). Do you think it is advisable to do manual curation across regions of the same tumor? If so, do you have any recommendations for how to approach this? I was thinking maybe mapping the solutions of each region to their equivalent solutions in other regions (either by ploidy or by the actual segmentation) and then determining which set of similar solutions has the highest overall score across all regions. Do you think this makes sense?",jberg1999,https://github.com/lima1/PureCN/issues/362
I_kwDOBew4us6FbX8h,Small panel triggers an error in the `.getAverageWeightPV` function,CLOSED,2024-04-11T20:29:40Z,2024-04-24T19:18:15Z,2024-04-24T18:52:00Z,"Hi,

I've got a small panel (< 800 targets) that I am trying to run through PureCN just to see if it would work (I recognize that it isn't the best dataset to use). 

I've hit the following error:

```r
cannot take a sample larger than the population when 'replace = FALSE'
```

I've traced the issue down to the [.getAverageWeightPV()](https://github.com/lima1/PureCN/blob/devel/R/segmentationCBS.R#L438-L451) function that is called during CBS segmentation. In particular, the line:

```r
permutations <- lapply(num_marks, function(l)
        sapply(sample(length(weights), perm), .do_permutation, l))
```

is causing this issue as `perm` is hardcoded to 2000. As such, it can't sample 2000 without replacement since we have < 800 targets. 

I am not sure what these weights are being used for. I am just curious as to whether lowering this parameter is a good idea or not to get past this issue?

",tinyheero,https://github.com/lima1/PureCN/issues/363
I_kwDOBew4us6Fm0GC,allelic copy number for segments,OPEN,2024-04-13T12:41:20Z,2024-04-13T12:43:40Z,,"Hi, I want to know the allelic copy number for each segment listed in _dnacopy.seg file. 
Previous you mentioned that such information is provided by callLOH() (loh.csv) file. 
Yet, I found different start and end positions for some segments. I attached the difference below comparing _dnacopy.seg file and loh.csv file.  More precisely, the start position and the end position for each chromosome is different. 
What I am intending to do is calculate whole-genome duplicated rate. A sample is considered to have undergone WGD if greater than 50% of their autosomal genome had an major-copy nuumber greater than or equal to two. 
For this, I need allelic copy number for segment listed in _dnacopy.seg file.
I have already calculated genome alteration rate based on the segments in the _dnacopy.seg.file. 

Thank you
<log.csv file>
<img width=""684"" alt=""image"" src=""https://github.com/lima1/PureCN/assets/77954045/23446448-68da-43ad-928a-26aaa9ce9824"">

<dnacopy.seg>
<img width=""575"" alt=""image"" src=""https://github.com/lima1/PureCN/assets/77954045/d50f6c1c-4a5c-415c-96f7-adeddf5f1f7f"">

",jennyp76,https://github.com/lima1/PureCN/issues/364
I_kwDOBew4us6H66GN,PSCBS segmentation failed --> Error in write permission for R directory .cache,CLOSED,2024-05-06T08:48:29Z,2024-05-28T14:38:44Z,2024-05-28T14:38:44Z,"--Hi,
 
PureCN.R used with PSCBS segmentation need write permission to personal .cache directory and sometimes (on HPC cluster) it failed with:

Error in getWritablePathname.Arguments(static, file = ""dummy-not-created"",  :
  No write permission for directory: /nfs/home/users/.cache/R/R.cache/PSCBS/segmentByCBS/sbdry
  
 I have modified the PureCN.R script at the beginnig to change my .cache directory by using R.cache library, such as:

library(""R.cache"")
setCacheRootPath(path=""/tmp/.cache/R/R.cache"")

and now it works.

Laurent --

  
",lmanchon,https://github.com/lima1/PureCN/issues/367
I_kwDOBew4us6I-dqk,Question regrading the results ,OPEN,2024-05-15T14:18:44Z,2024-05-15T14:18:44Z,,"Hi,
Recently I had a few samples where a single model couldn't effectively fit all of the data, as in the example below. Do you have any suggestions for handling such cases?
 Thank you.""
Model 1
![image](https://github.com/lima1/PureCN/assets/92018021/9a99a6fe-b454-4b10-994f-107d73580218)
Model 2
![image](https://github.com/lima1/PureCN/assets/92018021/f4efcd0c-ffd4-4113-8994-e9e550d2bc29)
Model 3
![image](https://github.com/lima1/PureCN/assets/92018021/ca5670a1-49a9-4b11-87db-59b167729525)

there are 9 models more but worse than 1 and 2
",maxanes,https://github.com/lima1/PureCN/issues/368
I_kwDOBew4us6K3bGd,"Error in h(simpleError(msg, call))",CLOSED,2024-06-02T17:39:44Z,2024-06-04T09:54:47Z,2024-06-04T09:54:46Z,"Hi Markus,

I recently ran into the following error when running

It's the latest PureCN version 2.11.0 as part of the the docker image kristianunger/purecndocker:0624

singularity run -B purecndocker_0624.sif Rscript $PURECN/PureCN.R --out $OUT/$SAMPLEIDOUT
--tumor {SAMPLEID}_coverage_loess.txt.gz
--fun-segmentation PSCBS
--sampleid $SAMPLEID
--vcf $INPUT_VCF
--statsfile $statsfile
--normaldb $normal_db/normalDB_agilent_v6_hg38.rds
--intervals $baits
--snpblacklist $srr
--genome hg38
--postoptimize
--model betabin
--force --seed 123

INFO [2024-06-02 14:48:31] Segmenting data...
INFO [2024-06-02 14:48:32] Interval weights found, will use weighted PSCBS.
Error in h(simpleError(msg, call)) :
error in evaluating the argument 'x' in selecting a method for function 'median': non-numeric argument to mathematical function
Calls: runAbsoluteCN ... .log_level -> layout -> median -> .handleSimpleError -> h
In addition: Warning message:
In .bcfHeaderAsSimpleList(header) :
duplicate keys in header will be forced to unique rownames
Execution halted

Can you give me an idea what might be the problem?

Best wishes

Kristian",kristianunger,https://github.com/lima1/PureCN/issues/369
I_kwDOBew4us6M1h0k,PureCN-Steps,CLOSED,2024-06-19T17:18:34Z,2024-08-13T15:16:22Z,2024-08-13T15:16:21Z,"Hi,
I am performing PureCn as an entry-level bioinformatician while matched normal is not available to estimate tumour purity.

I have my own tumour and normal samples bam and vcf files. Also my fatsa format hg19 as a reference genome.

I know it takes your time, But I would be appreciative if you could support and guide me.

I was wondering if,

1.We need generating interval file from baits BED files while our vcf files and bam files are ready?

2.we should focus on Run PureCN with third-party segmentation and ignore Run with internal segmentation since we have prepared our files through GATK?

If we need generating interval file from a BED, I got this conclusion that we need these files. Could you please do me a favor and confirm I am on a right track?

1.baits_hg19.bed (BED file containing bait coordinates for hg19 specific to our capture kit)). How can I access this file? Download or prepare it from our own fasta or bam files?

2.hg19.fa in fasta format .
(Should I use the fasta file that I have or download from this package?)

""The --genome version is needed to annotate exons with gene symbols. Use hg19/hg38 for human genomes, not b37/b38. You might get a warning that an annotation package is missing. For hg19, install [TxDb.Hsapiens.UCSC.hg19.knownGene](https://bioconductor.org/packages/3.20/TxDb.Hsapiens.UCSC.hg19.knownGene) in R.""


3.Mappability File: provides mappability scores for 100-mers.
 Download at
 wgEncodeCrgMapabilityAlign100mer.bigWig from the UCSC Genome Browser.

4.Replication timing file: download at
 wgEncodeUwRepliSeqK562WaveSignalRep1.bigWig from the UCSC Genome website.

Thank you for your support",ElhamJa63,https://github.com/lima1/PureCN/issues/370
I_kwDOBew4us6SI418,PureCN unintentionally filters out reads with supplementary alignments,OPEN,2024-08-06T22:40:48Z,2024-08-08T16:55:45Z,,"In the `.calculateBamCoverageByInterval()` function:

```r
.calculateBamCoverageByInterval <- function(intervalGr, ...) {
  param <- ScanBamParam(what = c(""pos"", ""qwidth"", ""flag""),
              which = intervalGr,
              flag = scanBamFlag(isUnmappedQuery = FALSE,
                           isNotPassingQualityControls = FALSE,
                           isSecondaryAlignment = FALSE,
                           isDuplicate = NA
                   ),
              ...
           )

  xAll <- scanBam(bam.file, index = index.file, param = param)
  xDupFiltered <- .filterDuplicates(xAll)
```

There is no explicit use of the `isSupplementaryAlignment` argument in the `scanBamFlag()` call leading one to believe that reads with supplementary alignments are not filtered out. However the call to the `.filterDuplicates()` function:

```r
.filterDuplicates <- function(x) {
    lapply(x, function(y) {
        idx <- y$flag < 1024
        lapply(y, function(z) z[idx])
    })
}
```

Will retain reads that have a SAM flag less than 1024. 

However, reads with supplementary alignments have a SAM flag of 2048. 

```bash
$> samtools flag
About: Convert between textual and numeric flag representation
Usage: samtools flags FLAGS...

Each FLAGS argument is either an INT (in decimal/hexadecimal/octal) representing
a combination of the following numeric flag values, or a comma-separated string
NAME,...,NAME representing a combination of the following flag names:

   0x1     1  PAIRED         paired-end / multiple-segment sequencing technology
   0x2     2  PROPER_PAIR    each segment properly aligned according to aligner
   0x4     4  UNMAP          segment unmapped
   0x8     8  MUNMAP         next segment in the template unmapped
  0x10    16  REVERSE        SEQ is reverse complemented
  0x20    32  MREVERSE       SEQ of next segment in template is rev.complemented
  0x40    64  READ1          the first segment in the template
  0x80   128  READ2          the last segment in the template
 0x100   256  SECONDARY      secondary alignment
 0x200   512  QCFAIL         not passing quality controls or other filters
 0x400  1024  DUP            PCR or optical duplicate
 0x800  2048  SUPPLEMENTARY  supplementary alignment

```

This means reads with supplementary alignments will always be filtered out regardless of whether they are a PCR duplicate or not when the `filterDuplicates` function is called.

This doesn't seem intentional? ",tinyheero,https://github.com/lima1/PureCN/issues/371
I_kwDOBew4us6SN11e,A high duplication rate for WGS,OPEN,2024-08-07T10:10:09Z,2024-08-07T10:11:53Z,,"Hi I can WGS on cell lines. When I use  `wgs_calling_regions.hg38.bed` as an input for making interval file and when I set `off-target regions` to  `130000` for coverage calculation, I get things as below; Do you think I should be worry about duplication rate?
<img width=""400"" alt=""Picture 1"" src=""https://github.com/user-attachments/assets/d453fb8b-7db9-4268-a762-fae2f26f12db"">


1. mean.coverage.ontarget: This value represents the average coverage of the target regions. In this case, it is approximately 8.77, meaning on average, each base in the target regions was sequenced 8.77 times.
2.	mean.coverage.offtarget: This value represents the average coverage of the off-target regions, which is about 0.16. This is significantly lower than the on-target coverage, as expected in targeted sequencing where the focus is primarily on specific regions of interest.
### 3.	mean.duplication.ontarget: This indicates the mean duplication rate of the on-target regions, approximately 0.99. A high duplication rate close to 1.0 suggests that almost all on-target reads are duplicates, which can happen if the library complexity is low or if there is an over-amplification during the library preparation.
4.	mean.duplication.offtarget: Similar to the on-target duplication rate, this value represents the mean duplication rate of the off-target regions, also approximately 0.99.
5.	mom.raw.ontarget: This stands for “median of means” of the raw coverage data for the on-target regions. The value 0.991334418167518 suggests high uniformity in coverage across the target regions before any normalization.
6.	mom.raw.offtarget: This is the “median of means” of the raw coverage data for the off-target regions. It is similar to the on-target raw data value, indicating consistency across off-target areas.
7.	mom.post.gc.ontarget: This is the “median of means” after GC bias correction for on-target regions. The correction attempts to account for GC-content bias in sequencing. The value 0.991334418167518 suggests minimal deviation from uniformity post-GC correction.
8.	mom.post.gc.offtarget: This value, similar to the on-target GC correction, applies to the off-target regions. The value shows how the coverage looks after adjusting for GC content across non-targeted regions.
9.	mom.post.reptiming.ontarget: After considering replication timing (the phase of DNA replication when particular sequences are duplicated), this metric shows the coverage median of means for the on-target areas, remaining unchanged in your case.
10.	mom.post.reptiming.offtarget: Like the on-target replication timing metric, this value is for off-target regions. It remains unchanged, indicating consistent coverage and bias corrections.


Thanks for any idea",MaryGoAround,https://github.com/lima1/PureCN/issues/372
I_kwDOBew4us6T42-a,I need advice when there is no normal,OPEN,2024-08-22T15:41:10Z,2024-10-10T14:03:43Z,,"I have targeted DNA sequencing for a tumour and I do not have any normal samples (matched or even non matched)

I am trying this but I get error

```
 Rscript /R/x86_64-pc-linux-gnu-library/4.4/PureCN/extdata/PureCN.R --out purecn_output --tumor sample_coverage_loess.txt.gz --vcf tumor.vcf.gz --sampleid sample --genome hg38 --post-optimize --force --fun-segmentation Hclust
[1] ""folder""
INFO [2024-08-22 16:33:26] Loading PureCN 2.10.0...
Error in .getNormalCoverage(normal.coverage.file) : 
  Need either normalDB or normal.coverage.file
Execution halted

```

Please give me an advice how to use this software in the case

Thanks a lot

![sample_coverage_loess](https://github.com/user-attachments/assets/06e2622b-58b1-4b90-b6d6-1f148d0be602)
",MaryGoAround,https://github.com/lima1/PureCN/issues/373
I_kwDOBew4us6URE0N,Cancer Cell Fraction for CNVs,CLOSED,2024-08-26T18:31:27Z,2024-08-27T20:13:22Z,2024-08-27T20:13:22Z,"Hi Markus,

Thank you for your help with my previous issue! I am now interested calculating the cancer cell fraction of CNVs called by PureCN. I know this information is available for SNPs, and I found that there is a subclonal probability in the C.Posterior dataframe. However I am interested in the equivalent of the SNP columns CELLFRACTION, CELLFRACTION.95.LOWER, and CELLFRACTION.95.UPPER except for the CNVs. Is this data computed by PureCN or available anywhere in the PureCN output? 

Thanks!",jberg1999,https://github.com/lima1/PureCN/issues/374
I_kwDOBew4us6Vqh_R,No off-target,OPEN,2024-09-06T18:05:40Z,2024-09-06T21:53:50Z,,"Hi,
I have a baits exome probe BED file, tumor bam and vcf files . I used 8 unmatched normal sampoles to create my NormalDB.
I run all steps in default situation.
However, I think something is not correct with my interval files which results in unreasinable output for mu PureCN.
I have pasted the output for my different steps here:
Run INTERVAL step:
[Output .docx](https://github.com/user-attachments/files/16911580/Output.docx)
Thanks,
",El84Ja,https://github.com/lima1/PureCN/issues/375
I_kwDOBew4us6YpI-h,An unknown error happening,OPEN,2024-10-02T08:09:08Z,2024-10-02T08:09:08Z,,"Hi

Finally I managed to run PureCN but I get an error after hours 

```
[@login006 ]$ more purecn.out
INFO [2024-10-01 10:25:46] Loading PureCN 2.10.0...
INFO [2024-10-01 10:28:34] Mean coverages: chrX: 24.86, chrY: 0.48, chr1-22: 24.17.
INFO [2024-10-01 10:28:34] Sample sex: F
INFO [2024-10-01 10:28:54] Using default BiocParallel backend. You can change the default in your ~/.Rprofile file.
INFO [2024-10-01 10:28:54] ------------------------------------------------------------
INFO [2024-10-01 10:28:54] PureCN 2.10.0
INFO [2024-10-01 10:28:54] ------------------------------------------------------------
INFO [2024-10-01 10:28:55] Arguments: -tumor.coverage.file LM1.recal_coverage_loess.txt.gz -log.ratio  -seg.file  -vcf.file tumor.vcf.gz -genome hg38 -sex ? -args.setPriorVcf 6 -args.setMappingBiasVcf mapping_bias_wgs_hg38.rds -args.filterIntervals 100,0.05 -args.segmentation 0.005,NULL, -sampleid LM1.recal -min.plo
idy 1.4 -max.ploidy 6 -test.purity 0.9,0.91,0.92,0.93,0.94,0.95 -max.non.clonal 0.3 -max.homozygous.loss 0.5 -log.ratio.calibration 0.1
 -model.homozygous TRUE -error 0.001 -interval.file baits_hg38_intervals.txt -min.logr.sdev 0.15 -max.segments 1000 -plot.cnv TRUE -vcf.field.prefix PureCN. -cosmic.vcf.file  -DB.info.flag DB
 -POPAF.info.field POP_AF -Cosmic.CNT.info.field Cosmic.CNT -model beta -post.optimize TRUE -log.file output.log -normal.coverage.file <data> -normalDB <data> -args.filterVcf <data> -fun.segmentation <data> -test.nu
m.copy <data> -speedup.heuristics <data> -BPPARAM <data>
INFO [2024-10-01 10:28:55] Using BiocParallel for parallel optimization.
INFO [2024-10-01 10:28:55] Loading coverage files...
INFO [2024-10-01 10:30:35] Mean target coverages: 24X (tumor) 25X (normal).
INFO [2024-10-01 10:30:56] Mean coverages: chrX: 24.86, chrY: 0.48, chr1-22: 24.17.
INFO [2024-10-01 10:30:57] Mean coverages: chrX: 33.76, chrY: 0.50, chr1-22: 24.43.
INFO [2024-10-01 10:33:13] Removing 34356 intervals with missing log.ratio.
INFO [2024-10-01 10:33:26] Removing 2396 intervals excluded in normalDB.
INFO [2024-10-01 10:33:26] Removing 317 intervals with low total coverage in normal (< 150.00 reads).
INFO [2024-10-01 10:33:26] normalDB provided. Setting minimum coverage for segmentation to 0.0015X.
INFO [2024-10-01 10:33:26] Removing 19125 low count (< 100 total reads) intervals.
INFO [2024-10-01 10:33:30] Removing 52 low coverage (< 0.0015X) intervals.
INFO [2024-10-01 10:33:36] Using 5674884 intervals (5674884 on-target, 0 off-target).
INFO [2024-10-01 10:33:36] No off-target intervals. If this is hybrid-capture data, consider adding them.
INFO [2024-10-01 10:33:52] AT/GC dropout: 1.00 (tumor), 1.00 (normal), 1.01 (coverage log-ratio). 
INFO [2024-10-01 10:33:52] Loading VCF...
INFO [2024-10-01 10:35:49] Found 5209457 variants in VCF file.
INFO [2024-10-01 10:36:06] Removing 114572 triallelic sites.
INFO [2024-10-01 10:36:14] Maximum of POPAF INFO is > 1, assuming -log10 scaled values
WARN [2024-10-01 10:36:18] vcf.file has no DB info field for membership in germline databases. Found and used valid population allele f
requency > 0.001000 instead.
INFO [2024-10-01 10:36:25] 4625437 (90.8%) variants annotated as likely germline (DB INFO flag).
WARN [2024-10-01 10:39:30] Found 111 variants with missing allelic fraction starting with chr1:152196088_T/C. Removing them.
INFO [2024-10-01 10:40:09] LM1 is tumor in VCF file.
INFO [2024-10-01 10:40:51] 40704 homozygous and 83308 heterozygous variants on chrX.
INFO [2024-10-01 10:40:52] Sex from VCF: F (Fisher's p-value: < 0.0001, odds-ratio: 1.06).
INFO [2024-10-01 10:40:55] Detected MuTect2 VCF.
INFO [2024-10-01 10:41:26] Removing 0 Mutect2 calls due to blacklisted failure reasons.
INFO [2024-10-01 10:41:49] Removing 27429 low quality variants with non-offset BQ < 20.
INFO [2024-10-01 10:41:57] Base quality scores range from 19 to 36 (offset by 1)
INFO [2024-10-01 10:41:59] Minimum number of supporting reads ranges from 1 to 41, depending on coverage and BQS.
INFO [2024-10-01 11:23:05] Initial testing for significant sample cross-contamination: unlikely
INFO [2024-10-01 11:23:46] Removing 867833 variants with AF < 0.030 or AF >= Inf or insufficient supporting reads or depth < 15.
INFO [2024-10-01 11:23:46] Total size of targeted genomic region: 2269.94Mb (2332.15Mb with 50bp padding).
INFO [2024-10-01 11:24:08] 42.3% of targets contain variants.
INFO [2024-10-01 11:24:32] Removing 923690 variants outside intervals.
INFO [2024-10-01 11:24:34] Setting somatic prior probabilities for likely germline hits to 0.000500 or to 0.500000 otherwise.
INFO [2024-10-01 11:24:41] Loading mapping bias file mapping_bias_wgs_hg38.rds...
INFO [2024-10-01 11:24:44] Found 7147265 variants in mapping bias file.
INFO [2024-10-01 11:30:03] Imputing mapping bias for 663118 variants...
INFO [2024-10-01 16:40:14] Excluding 249449 novel or poor quality variants from segmentation.
INFO [2024-10-01 16:40:22] Sample sex: F
INFO [2024-10-01 16:40:22] Segmenting data...
INFO [2024-10-01 16:40:27] Interval weights found, will use weighted PSCBS.
INFO [2024-10-01 16:40:44] MAPD of 2937956 allelic fractions: 0.09 (0.09 adjusted).
INFO [2024-10-01 16:41:10] Setting undo.SD parameter to 0.750000.
INFO [2024-10-01 18:11:06] Found 36352 segments, exceeding max.segments threshold of 1000.
INFO [2024-10-01 18:11:06] Setting undo.SD parameter to 1.125000.
INFO [2024-10-01 19:24:57] Found 33924 segments, exceeding max.segments threshold of 1000.
INFO [2024-10-01 21:39:44] Setting prune.hclust.h parameter to 0.150000.
INFO [2024-10-01 23:26:34] Found 33918 segments with median size of 0.02Mb.
INFO [2024-10-01 23:26:39] Removing 5 variants outside segments.
INFO [2024-10-01 23:26:40] Using 3275817 variants.
INFO [2024-10-01 23:36:21] Mean standard deviation of log-ratios: 0.24 (MAPD: 0.20)
INFO [2024-10-01 23:36:21] 2D-grid search of purity and ploidy...
INFO [2024-10-01 23:40:49] Local optima: 0.93/4.8, 0.9/5.6, 0.9/3.8, 0.9/2.8, 0.9/2

[@login006]$ more purecn.err 
INFO [2024-10-01 23:40:51] Testing local optimum 5/5 at purity 0.90 and total ploidy 2.00...

Stop worker failed with the error: wrong args for environment subassignment
Error: BiocParallel errors
  0 remote errors, element index: 
  5 unevaluated and other errors
  first remote error:
Execution halted
```
Thanks for any help",MaryGoAround,https://github.com/lima1/PureCN/issues/376
I_kwDOBew4us6Z2zAD,Interpreting results,OPEN,2024-10-11T12:35:25Z,2024-10-11T12:35:25Z,,"Hi

I could run PureCN on one cell line (tumour)

```
for BAM in $TUMOR_BAMS; do
    SAMPLE_ID=$(basename $BAM .bam)
    VCF_PATH=""tumor.vcf.gz""
    Rscript $PURECN/PureCN.R --out output \
        --tumor coverage_loess.txt.gz \
        --sampleid $SAMPLE_ID --vcf $VCF_PATH --normaldb normalDB_wgs_hg38.rds \
        --intervals baits_hg38_intervals.txt --genome hg38 \
        --mapping-bias-file mapping_bias_wgs_hg38.rds \
        --fun-segmentation PSCBS --force --post-optimize --seed 123 --max-copy-number 8 --min-purity 0.9 --max-purity 0.99 \
        --model-homozygous TRUE
```

I got this plots

<img width=""946"" alt=""Picture 1"" src=""https://github.com/user-attachments/assets/0956c6d2-3724-4ef4-aff6-397b55838f95"">
<img width=""952"" alt=""Picture 2"" src=""https://github.com/user-attachments/assets/7ab63700-fc22-444b-bc77-7a808448fc23"">


Am I right there is  some loss in chr8 and some gain chr16?

Please correct me if I interpret the plot correctly

Gray dots: Represent individual copy number bins for segments across the genome. These points reflect raw copy number values.
Purple and Red Lines: Indicate the segmented copy number. The two lines represent the major allele (C1) and minor allele (C2).
Purple Line: Major allele (C1)
Red Line: Minor allele (C2)

Thanks for any thoughts",MaryGoAround,https://github.com/lima1/PureCN/issues/377
I_kwDOBew4us6i0yp-,readAllelicCountsFile() can be very slow (with suggested fix),OPEN,2024-12-11T03:49:40Z,2024-12-11T16:59:34Z,,"I was running PureCN on results generated by the GATK4 Somatic CNV workflow upstream, and I notice that it takes hours for readAllelicCountsFile() to parse an allelic counts tsv file. Admittedly my tsv file is fairly large (~2.4M lines), but this is still way too time-consuming. 

It turns out that most of the time is spent on a single line of code (readAllelicCountsFile.R, line 79):
```r
alt(vcf) <- DNAStringSetList(lapply(inputCounts$ALT_NUCLEOTIDE, DNAStringSet))
``` 
As far as I understand it, lapply() is basically equivalent to the native R for loop and it is not very efficient. So I replace it with the following line:
```r
alt(vcf) <- DNAStringSetList( split( inputCounts$ALT_NUCLEOTIDE, 1:length(vcf) ) )
``` 
And it drastically reduces the running time of this function to a few minutes. Therefore, I recommend the developers to incorporate this fix so that future users won't have to solve the same problem when they are running PureCN on GATK4 outputs. Thank you very much for maintaining this amazing project!",luyh-xp,https://github.com/lima1/PureCN/issues/378
