id,title,state,created_at,updated_at,closed_at,body,user,url
I_kwDOKqRFqs58xq4u,bcftools doesn't like tag name '1kGPoN',CLOSED,2024-01-22T08:52:58Z,2024-01-29T04:38:10Z,2024-01-29T04:38:10Z,"I am getting ""[W::bcf_hrec_check] Invalid tag name: ""1kGPoN"""" error when processing the vcf generated by ClairS-TO pipeline.

My understanding is that bcftools doesn't like any tag that starts with a number. 

Can you change the tag name to PoN instead in shared/vcf.py line 24 and src/nonsomatic_tagging.py line 294?

Thanks a lot in advance.",ymcki,https://github.com/HKU-BAL/ClairS-TO/issues/3
I_kwDOKqRFqs5918-d,IndexError during STEP1,CLOSED,2024-02-01T01:31:25Z,2024-02-02T02:59:27Z,2024-02-02T02:59:27Z,"I got heaps of IndexError while running clairs_to with the latest docker image on Singularity:
```
Traceback (most recent call last):
  File ""/opt/bin/clairs_to.py"", line 107, in <module>
    main()
  File ""/opt/bin/clairs_to.py"", line 101, in main
    submodule.main()
  File ""/opt/bin/src/extract_candidates_calling.py"", line 597, in main
    extract_pair_candidates(args)
  File ""/opt/bin/src/extract_candidates_calling.py"", line 341, in extract_pair_candidates
    select_indel_candidates=select_indel_candidates
  File ""/opt/bin/src/extract_candidates_calling.py"", line 91, in decode_pileup_bases
    base_list[-1][1] = base + pileup_bases[base_idx: base_idx + advance]  # add indel seq
IndexError: list index out of range
```
I wonder if this is expected, or am I actually losing these candidate indels due to the error.",ChangqingW,https://github.com/HKU-BAL/ClairS-TO/issues/5
I_kwDOKqRFqs6AsBJ5,IndexError in STEP5,CLOSED,2024-02-28T13:51:54Z,2024-03-04T05:56:29Z,2024-03-04T05:56:29Z,"I am getting the following IndexError in STEP 5 while running ClairS_TO with the latest docker image and I am using PacBio Hifi data (haplotagged.bam file) as the input.

Traceback (most recent call last):
  File ""/opt/bin/clairs_to.py"", line 107, in <module>
    main()
  File ""/opt/bin/clairs_to.py"", line 101, in main
    submodule.main()
  File ""/opt/bin/src/postprocess_vcf.py"", line 231, in main
    merge_vcf(args)
  File ""/opt/bin/src/postprocess_vcf.py"", line 99, in merge_vcf
    qual = float(columns[5])
IndexError: list index out of range

Even with the error, the final output file output.vcf.gz is generated but I am concerned about the output. Could you please help me with that?
",naziafrin,https://github.com/HKU-BAL/ClairS-TO/issues/6
I_kwDOKqRFqs6EII_E,Get a large number of variants from ClairS-TO,CLOSED,2024-03-31T01:09:16Z,2024-04-25T12:16:32Z,2024-04-25T12:16:32Z,"Hi, I am using Clairs-TO to call somatic small variant from PacBio Revio tumor data. As a result, ClairS-TO detected ~28000 variants, which is much larger than I expected. I am not sure whether there are many false positive and thus post this issue to enquire if it's normal condition when using ClairS-TO.

Thanks!",ywzhang071394,https://github.com/HKU-BAL/ClairS-TO/issues/7
I_kwDOKqRFqs6GyH-G,Value Error in Step 2-3 CALL_VARIANTS,CLOSED,2024-04-24T13:19:34Z,2024-04-28T14:27:37Z,2024-04-28T14:27:37Z,"Hi, I am using ClairS-TO to call SNVs in tumor data (Ilmn). In step 2-3 (pileup Model Calling Variants), roughly 6 hours into the job, I run into this problem:

[INFO] Pileup Model Calling Variants
[INFO] RUN THE FOLLOWING COMMAND:
( parallel --joblog /hpc/pmc_holstege/rstudio/oscar_nanopore/snv_clairsto/SNV_called/logs/parallel_2-3_call_variants.log -j 24 python3 /opt/bin/clairs_to.py call_variants --predict_fn /hpc/pmc_holstege/rstudio/oscar_nanopore/snv_clairsto/SNV_called/tmp/predict/{1/}  --call_fn /hpc/pmc_holstege/rstudio/oscar_nanopore/snv_clairsto/SNV_called/tmp/vcf_output/p_{1/}.vcf --platform ilmn --likelihood_matrix_data /opt/micromamba/envs/clairs-to/bin/clairs-to_models/ilmn/likelihood_matrix.txt  :::: /hpc/pmc_holstege/rstudio/oscar_nanopore/snv_clairsto/SNV_called/tmp/candidates/CANDIDATES_FILES ) 2>&1 | tee /hpc/pmc_holstege/rstudio/oscar_nanopore/snv_clairsto/SNV_called/logs/2-3_CALL_VARIANTS.log

[INFO] Calling tumor-only somatic variants ...
[INFO] Total time elapsed: 0.04 s
[INFO] Calling tumor-only somatic variants ...
Traceback (most recent call last):
  File ""/opt/bin/clairs_to.py"", line 107, in <module>
    main()
  File ""/opt/bin/clairs_to.py"", line 101, in main
    submodule.main()
  File ""/opt/bin/clairs/call_variants.py"", line 646, in main
    call_variants_from_probability(args)
  File ""/opt/bin/clairs/call_variants.py"", line 567, in call_variants_from_probability
    output_vcf_from_probability(
  File ""/opt/bin/clairs/call_variants.py"", line 234, in output_vcf_from_probability
    best_match_alt_list, tumor_supported_reads_count_list = rank_variant_alt(
ValueError: too many values to unpack (expected 2)

The traceback is repeated hundreds of times. Step 3 seems to work fine even with this issue, but the vcf file doesn't contain any SNVs in the end.

do you have any suggestions on what might be the cause? Thanks",oscargamarra,https://github.com/HKU-BAL/ClairS-TO/issues/8
I_kwDOKqRFqs6IXnFh,F1 scores and high coverage datasets,CLOSED,2024-05-09T15:09:05Z,2024-05-10T04:13:21Z,2024-05-10T04:13:20Z,"Hi there!! We're currently testing ClairS-To using ONT DNA reads and a variant truth set to call SNPs. We have noticed; however, that the F1 score decreases relevently whenever the coverage is above 1000x (e.g. F1 of 0.90 if cov. 1000x, F1 of 0.5 when using higher coverage).

Therefore, I wanted to kindly ask: could there be a reason for this behaviour?

Thank you very much for any reply in advance and thank you very much for ClairS-TO
Cheers!",sq101,https://github.com/HKU-BAL/ClairS-TO/issues/9
I_kwDOKqRFqs6JW_cY,Error at Haplotag BAM step,CLOSED,2024-05-19T08:51:15Z,2024-07-20T00:53:35Z,2024-07-20T00:53:35Z,"Hi

Thank you for this important piece of software. Using fresh pull of singularity image for ClairS-TO, but at the haplotagging stage get the output below.

I've made sure I am not loading a local instance of conda before I run the pipeline on a slurm node, but the image seems to be picking up pysam locally rather than using the instance inside the container - which it can see as it runs fine on other steps.

Command used to run ($A represents sample ID passed from slurm):

`singularity exec ~/beggsa-clinicalnanopore/software/clairs-to_latest.sif /opt/bin/run_clairs_to -T ""$A"".sorted.bam -R ~/beggsa-clinicalnanopore/genomes/grch38/genome.fa -o clairs-to/ -t 32 -p ont_r10_dorado_hac_4khz --conda_prefix /opt/micromamba/envs/clairs-to
`
OS: RedHat Enterprise 8.3

Output:

```
parsing contig/chromosome: chrEBV ... skip
writeResult ... 2s

[INFO] Haplotag the Tumor BAM
[INFO] RUN THE FOLLOWING COMMAND:
( parallel --joblog /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/logs/phasing_log/parallel_3_haplotag_tumor.log -j 32 /opt/micromamba/envs/clairs-to/bin/whatshap haplotag --output /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/tmp/phasing_output/phased_bam_output/tumor_{1}.bam --reference /rds/homes/b/beggsa/beggsa-clinicalnanopore/genomes/grch38/genome.fa --regions {1}  --ignore-read-groups /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/tmp/phasing_output/phased_vcf_output/tumor_phased_{1}.vcf.gz /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/S475276.sorted.bam :::: /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/tmp/CONTIGS ) 2>&1 | tee /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/logs/phasing_log/3_tumor_haplotag.log && parallel -j 32 samtools index  -@32 /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/tmp/phasing_output/phased_bam_output/tumor_{1}.bam :::: /rds/projects/b/beggsa-sarcomaaccelerator/LongRead/LA95_Sarcoma_03-05-24/S475276/20240503_1646_3A_PAW55915_ceedab86/clairs-to/tmp/CONTIGS

Traceback (most recent call last):
  File ""/opt/micromamba/envs/clairs-to/bin/whatshap"", line 7, in <module>
    from whatshap.__main__ import main
  File ""/opt/micromamba/envs/clairs-to/lib/python3.9/site-packages/whatshap/__main__.py"", line 7, in <module>
    import whatshap.cli as cli_package
  File ""/opt/micromamba/envs/clairs-to/lib/python3.9/site-packages/whatshap/cli/__init__.py"", line 5, in <module>
    from whatshap.bam import (
  File ""/opt/micromamba/envs/clairs-to/lib/python3.9/site-packages/whatshap/bam.py"", line 6, in <module>
    import pysam
  File ""/rds/homes/b/beggsa/.local/lib/python3.9/site-packages/pysam/__init__.py"", line 4, in <module>
    from pysam.libchtslib import *
ImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.27' not found (required by /rds/homes/b/beggsa/.local/lib/python3.9/site-packages/pysam/../pysam.libs/libssh-f4fb36c6.so.4.8.7)
Traceback (most recent call last):
  File ""/opt/micromamba/envs/clairs-to/bin/whatshap"", line 7, in <module>
    from whatshap.__main__ import main
  File ""/opt/micromamba/envs/clairs-to/lib/python3.9/site-packages/whatshap/__main__.py"", line 7, in <module>
    import whatshap.cli as cli_package
  File ""/opt/micromamba/envs/clairs-to/lib/python3.9/site-packages/whatshap/cli/__init__.py"", line 5, in <module>
    from whatshap.bam import (
  File ""/opt/micromamba/envs/clairs-to/lib/python3.9/site-packages/whatshap/bam.py"", line 6, in <module>
    import pysam
  File ""/rds/homes/b/beggsa/.local/lib/python3.9/site-packages/pysam/__init__.py"", line 4, in <module>
    from pysam.libchtslib import *
ImportError: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.27' not found (required by /rds/homes/b/beggsa/.local/lib/python3.9/site-packages/pysam/../pysam.libs/libssh-f4fb36c6.so.4.8.7)
```",adbeggs,https://github.com/HKU-BAL/ClairS-TO/issues/10
I_kwDOKqRFqs6J2r0r,RefCall variants,CLOSED,2024-05-23T12:36:37Z,2024-05-24T08:24:08Z,2024-05-24T08:24:08Z,"Hi there! We are testing clairS-TO with the `--print_ref_calls` option. My question is: what does the RefCall flag mean? Could you further elaborate on it? 

I am aware that in other software it can mean that the variant was proposed as mutation but later is rejected by the variant caller; however, I would appreciate if you can provide further information on what it means in ClairS-TO.

Thank you very much and thank you as well for your tool!
Regards!",sq101,https://github.com/HKU-BAL/ClairS-TO/issues/11
I_kwDOKqRFqs6KN8MK,Indexing error at phasing step,CLOSED,2024-05-27T11:17:35Z,2024-07-20T00:53:18Z,2024-07-20T00:53:18Z,"Hi,

Firstly, many thanks for this incredibly useful tool.

I am running ClairS-TO with the singularity container on a ONT WGS run. The library was basecalled and aligned using dorado 0.6.2. 

Command used to run

```
singularity exec -B ${input_dir},${ref_dir},${output_dir} --bind=/local:/local:rw /b06x-isilon/b06x-m/mnp_nanopore/software/clairs-to_latest.sif \
          /opt/bin/run_clairs_to \
          --tumor_bam_fn ${input_dir}/${id}.hg38.bam \
          --sample_name ${id} \
          --ref_fn ${ref_dir}/hg38.fa \
          --threads ${params.threads} \
          --platform ${params.platform} \
          --output_dir ${output_dir} \
          --conda_prefix /opt/micromamba/envs/clairs-to \
```

All the previous steps run fine and then it runs into this error at the phasing step:

```
[INFO] Phase the Tumor BAM
[INFO] RUN THE FOLLOWING COMMAND:
( parallel --joblog /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/logs/phasing_log/parallel_2_phase_tumor.log -j 8 /opt/micromamba/envs/clairs-to/bin/longphase phase  -s /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/phasing_output/vcf/{1}.vcf -b /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/bam/392718.calls.mods.sorted.hg38.bam -r /b06x-isilon/b06x-m/mnp_nanopore/software/hg38/hg38.fa -t 8 -o /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/phasing_output/phased_vcf_output/tumor_phased_{1} --ont :::: /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/CONTIGS && parallel -j 8 bgzip -f /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/phasing_output/phased_vcf_output/tumor_phased_{1}.vcf :::: /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/CONTIGS ) 2>&1 | tee /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/logs/phasing_log/2_phase_tumor.log && parallel -j 8 tabix -f -p vcf /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/phasing_output/phased_vcf_output/tumor_phased_{1}.vcf.gz :::: /b06x-isilon/b06x-m/mnp_nanopore/analysis/ONT_R00200/snv/ClairsTo/tmp/CONTIGS

parsing VCF ... [W::vcf_parse] Contig '##contig=<ID=chr1,length=248387328>' is not defined in the header. (Quick workaround: index the file with tabix.)
[W::bcf_hrec_check] Invalid contig name: ""##contig=<ID=chr1,length=248387328>""
pos 0 missing GT value
parsing VCF ... [W::vcf_parse] Contig '##contig=<ID=chr1,length=248387328>' is not defined in the header. (Quick workaround: index the file with tabix.)
[W::bcf_hrec_check] Invalid contig name: ""##contig=<ID=chr1,length=248387328>""
pos 0 missing GT value
parsing VCF ... [W::vcf_parse] Contig '##contig=<ID=chr1,length=248387328>' is not defined in the header. (Quick workaround: index the file with tabix.)
[W::bcf_hrec_check] Invalid contig name: ""##contig=<ID=chr1,length=248387328>""
pos 0 missing GT value
```

The full log file is here- 
[run_clairs_to.log](https://github.com/HKU-BAL/ClairS-TO/files/15455163/run_clairs_to.log)


Could you please help me with this?

Many thanks,
Areeba.",areebapatel,https://github.com/HKU-BAL/ClairS-TO/issues/12
I_kwDOKqRFqs6KyHo8,Different output,CLOSED,2024-05-31T18:38:01Z,2024-07-20T00:53:11Z,2024-07-20T00:53:11Z,"Hi,

First of all thank you for ClairS-TO. 
I have been trying to use it with bed file option.
I get different output for the same sample if I re-run it.
In some output, it skips certain positions of a chromosome. It shows in the tmp file if I check individual chromosome vcf file. But some positions or entire chromosome get missed out in a merged output vcf. Also does not show phasing in a final vcf.

Thank you in advance.

Shreya ",pcr876,https://github.com/HKU-BAL/ClairS-TO/issues/13
I_kwDOKqRFqs6NHqP9,Documentation: training data to create a model,CLOSED,2024-06-22T06:07:16Z,2024-07-20T00:52:39Z,2024-07-20T00:52:39Z,"Hi @aquaskyline,

Thanks for developing such a great tool! I am currently testing your variant caller with ONT data originated from different organisms, and it could nicely recognize SNPs but I am having troubles with short deletions.
I was wondering whether it makes sense for me to train it with my own data to create a model. I saw that for Clair3 it is explained in the documentation how to train data, but I did not find the documentation for ClairS-TO.
If this is possible, would you please add in the documentation how users can create their own models?

Thank you very much!",RunningMatcha,https://github.com/HKU-BAL/ClairS-TO/issues/14
I_kwDOKqRFqs6QJMWe,Stalling at Step6,CLOSED,2024-07-19T08:13:21Z,2024-08-11T15:38:07Z,2024-08-11T15:38:07Z,"Hi, I had to reinstall ClairS-TO and did at first not notice that there was an update last week. Whenever I ran my pipeline it stalled at step 6, when writing logs I think. After downgrading to version 0.1.0 it runs again through as before. Does someone else see this issue?",hpf0815,https://github.com/HKU-BAL/ClairS-TO/issues/15
I_kwDOKqRFqs6Qs2bS,DP seems downsampling in ClairS-TO,CLOSED,2024-07-24T14:00:21Z,2024-08-11T15:38:07Z,2024-08-11T15:38:07Z,"Hello,

Thank you for developing these great long-read small variants callers! We have some Cas9 edited, PCR-based Nanopore samples (Dorado duplex basecalling dna_r10.4.1_e8.2_5khz_stereo@v1.2 and dna_r10.4.1_e8.2_400bps_sup@v4.3.0), and want to quantify the editing percentage. 

The sequencing depth (DP) is 372 k reads, and the mutation type should be T->TA at chr4:123 (based on BAM file IGV visualization, and previous edited samples). I have tried the following three mutation calling programs:

1. Run Clair3 with an old **ont_guppy5** model. The mutation type is T deletion which is inconsistent with IGV visualization T->TA. 

chr4	123	.	**T	.**	10.36	RefCall	P	GT:GQ:**DP**:AD:AF	0/0:10:**372419**:186689:0.5013

```
hkubal/clair3:v1.0.8 /opt/bin/run_clair3.sh \
--bam_fn=/input.bam \
--ref_fn=/hg38.fna --threads=8 \
--platform=""ont"" --model_path=""/opt/models/ont_guppy5"" --output=/input/clair3/ \
--var_pct_full=1 --var_pct_phasing=1 --ref_pct_full=1
```

2. Run Clair3 with the newest model ""**r1041_e82_400bps_sup_v430**"". **No INDEL at chr14:123 detected**. So I assume it's not germline so try solution 3. 

3. Run ClairS-TO. The DP is 7071, which is different from 372k reads, so it's hard to quantify the editing percentage. 

chr4   123        .       T       TA      15.2734 PASS    FAU=21;FCU=0;FGU=13;FTU=3436;RAU=1;RCU=0;RGU=0;RTU=113;SB=0.08341       GT:GQ:**DP**:AF:AD:AU:CU:GU:TU      0/1:15:**7071**:0.3793:3549,2682:22:0:13:3549


```
  hkubal/clairs-to:v0.2.0 /opt/bin/run_clairs_to \
  --tumor_bam_fn /input.bam \
  --ref_fn /hg38.fna \
  --threads 8 \
  --platform ont_r10_dorado_sup_4khz \
  --output_dir /input/clairs_to/
```

Please let me know which caller and parameters are best suitable for the PCR-based editing sample for editing performance evaluation. Thank you!

Best, 
Ermin",ErminZ,https://github.com/HKU-BAL/ClairS-TO/issues/16
I_kwDOKqRFqs6WIai8,make read start/end filter available in parameters,CLOSED,2024-09-11T07:20:44Z,2024-10-12T02:42:49Z,2024-10-12T02:42:49Z,"Hi,
we want to analyze somatic mutations on ONT short reads (300-500bps).
You are filtering and removing variants that are close (100bp?, reported qual set to 0, filter: LowQual;ReadStartEnd) 
to start and end of a read. 
Is there a way to change this filtering (via parameters?) or would you generally advise no to use clairs-to for variant calling of such sort reads (we find the quality at the start and end of our reads sufficient for this purpose).
Thank you.

",maxstengl,https://github.com/HKU-BAL/ClairS-TO/issues/17
I_kwDOKqRFqs6XjbSi,training more models,OPEN,2024-09-23T13:25:21Z,2024-10-14T04:51:46Z,,"I would like to try using ClairS-TO with my data but there isn't the right models available. Are any of these likely to become available any time soon? 

dna_r10.4.1_e8.2_400bps_hac (5khz)
dna_r9.4.1_e8_hac (4khz)

Or would one of the existing models be suitable?",eesiribloom,https://github.com/HKU-BAL/ClairS-TO/issues/18
I_kwDOKqRFqs6aKhKr,"Does ClairS-TO support the basecalling results from dorado moel ""dna_r10.4.1_e8.2_400bps_hac@v5.0.0 ""?",OPEN,2024-10-14T15:53:59Z,2024-10-15T04:41:49Z,,"Hi there,

I see the latest version for dorado is r10.4.1_e8.2_400bps_sup@v4.2.0 Does ClairS-TO support the basecalling results from dorado moel ""dna_r10.4.1_e8.2_400bps_hac@v5.0.0 ""? 

Best,

Keren",kerenzhou062,https://github.com/HKU-BAL/ClairS-TO/issues/19
I_kwDOKqRFqs6cOxSP,how to enable phasing of final outputs clairTumorOnly,OPEN,2024-10-29T12:35:42Z,2024-11-01T04:42:45Z,,"i see option to phase intermediate vcf and bams plus option to`disable_intermediate_phasing `. is there anyway to enable phasing of final outputs ? i don't see it. 
is there deliberate reason? 
thanks in advance!",sahuno,https://github.com/HKU-BAL/ClairS-TO/issues/20
